var vre=Object.defineProperty;var Ire=(t,e,i)=>e in t?vre(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var $e=(t,e,i)=>(Ire(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function i(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=i(n);fetch(n.href,a)}})();const _j="tournament_title_block",$j="tournaments_control",uC="tournaments_table",yre="tournament_events",Bj="tournament_logo",sN="tournaments",iT="tournament",Ty="splash",bre=[sN,iT,Ty];var wre=Object.defineProperty,gt=(t,e)=>{for(var i in e)wre(t,i,{get:e[i],enumerable:!0})};function rT(){return"2.1.0"}var Vj={};gt(Vj,{competitionGovernor:()=>jj,drawsGovernor:()=>ET,entriesGovernor:()=>j6,eventGovernor:()=>K6,generationGovernor:()=>l4,matchUpFormatGovernor:()=>v4,matchUpGovernor:()=>I4,mocksGovernor:()=>tx,participantGovernor:()=>c5,policyGovernor:()=>v6,publishingGovernor:()=>O5,queryGovernor:()=>w6,reportGovernor:()=>j5,scheduleGovernor:()=>hx,scoreGovernor:()=>VO,tieFormatGovernor:()=>eY,tournamentGovernor:()=>uY,venueGovernor:()=>wY});var jj={};gt(jj,{getLinkedTournamentIds:()=>Ly,getTournamentIds:()=>xy,linkTournaments:()=>kH,mutate:()=>Gj,query:()=>LH,unlinkTournament:()=>FH,unlinkTournaments:()=>xH});var Gj={};gt(Gj,{linkTournaments:()=>kH,unlinkTournament:()=>FH,unlinkTournaments:()=>xH});var Ure={};gt(Ure,{addNotice:()=>lt,callListener:()=>UC,createInstanceState:()=>vne,cycleMutationStatus:()=>BN,deepCopyEnabled:()=>$N,deleteNotice:()=>VN,deleteNotices:()=>Ny,disableNotifications:()=>sH,enableNotifications:()=>KU,getDevContext:()=>Ra,getMethods:()=>cH,getNotices:()=>dH,getProvider:()=>SC,getTopics:()=>Vo,getTournamentId:()=>Xm,getTournamentRecord:()=>jN,getTournamentRecords:()=>Zm,globalLog:()=>hH,handleCaughtError:()=>IT,removeTournamentRecord:()=>mH,setDeepCopy:()=>UI,setDevContext:()=>wI,setGlobalLog:()=>oH,setGlobalMethods:()=>lH,setGlobalSubscriptions:()=>yne,setMethods:()=>uH,setStateMethods:()=>fH,setStateProvider:()=>gne,setSubscriptions:()=>bne,setTournamentId:()=>SI,setTournamentRecord:()=>pH,setTournamentRecords:()=>vT,timeKeeper:()=>Ine});function Qn(t){return typeof t=="function"}function Ki(t){return typeof t=="string"}function Ut(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Sre(t,e){if(!Ut(t)||!Ut(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function Hj(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Ut).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Tre=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function cC(t,e){if(t===void 0)return null;if(!Ut(t)||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>cC(a))}:{[n]:e?r(t[n]):cC(t[n])}))}function dC(t){return Array.isArray(t)?t.length+t.map(dC).reduce((e,i)=>e+i,0):Ut(t)&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>dC(t[e])).reduce((e,i)=>e+i,0):0}function Dre(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=dC(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}var X={success:!0},Pre="error",Rre={SUCCESS:X,ERROR:Pre},pC={message:"Chronological error; time violation.",code:"ANACHRONISM"},yI={message:"Duplicate entry",code:"DUPLICATE_ENTRY"},zj={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},mC={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Di={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},fe={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Dy={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},vf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Xp={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},xe={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Wj={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},Pa={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},sp={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},lN={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},uN={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},If={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},qj={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Yj={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Ere={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},cN={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Py={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},nT={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Ig={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},yg={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},dN={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},aT={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},pN={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Ry={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Ds={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Kj={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Jj={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Xj={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Zj={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Qj={message:"Invalid action",code:"ERR_INVALID_ACTION"},hC={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},eG={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},tG={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},iG={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},mN={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},rG={message:"Existing round",code:"ERR_EXISTING_ROUND"},Cre={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Aa={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ti={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},hN={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Gc={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},nG={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Ml={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},ni={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},sa={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},aG={message:"Event exists",code:"ERR_EXISTING_EVENT"},oG={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},sG={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},fN={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},gN={message:"Missing stage",code:"ERR_MISSING_STAGE"},lp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},lG={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},uG={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},cG={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},fC={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Ey={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},qU={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},bg={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},uu={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},vN={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},IN={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},dG={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},wg={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},pn={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Wm={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},tn={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Fu={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Hn={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},zn={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},yN={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},oT={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Mre={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},pG={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},bN={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},mG={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},wN={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Nre={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Zp={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Are={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},UN={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Ore={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},sT={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},kre={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},xre={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},qm={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},ze={message:"Missing value",code:"ERR_MISSING_VALUE"},hG={message:"Missing birthdate",code:"ERR_MISSING_BIRTH_DATE"},fG={message:"Missing date",code:"ERR_MISSING_DATE"},gG={message:"No valid dates",code:"ERR_NO_VALID_DATES"},NS={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},YU={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},vG={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},yn={message:"Invalid Date",code:"ERR_INVALID_DATE"},go={message:"Invalid time",code:"ERR_INVALID_TIME"},IG={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},gC={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},yG={message:"Invalid score",code:"ERR_INVALID_SCORE"},lT={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Fre={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},SN={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},bG={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},uT={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},vC={message:"Participant category mismatch",code:"ERR_CATEGORY_MISMATCH"},TN={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Ym={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},ps={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},na={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},wG={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},ms={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},UG={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Km={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Cy={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},lr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Li={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},SG={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Lre={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},TG={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Hc={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},DG={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},PG={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},RG={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Ug={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},cT={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},DN={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},IC={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},EG={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},_re={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},$re={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},CG={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},MG={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},yC={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},NG={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},PN={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},AG={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},RN={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},yf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},OG={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},Sg={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},kG={message:"Court exists",code:"ERR_EXISTING_COURT"},xG={message:"Venue exists",code:"ERR_EXISTING_VENUE"},Jm={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},zc={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},FG={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},EN={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},LG={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},_G={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Bre={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},CN={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},$G={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},MN={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},NN={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},dT={message:"Missing context",code:"ERR_MISSING_CONTEXT"},BG={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},My={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},VG={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},Tg={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},jG={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},pT={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},GG={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},HG={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Lu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},Wv={message:"Invalid gender",code:"ERR_INVALID_GENDER"},bI={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},le={message:"Invalid values",code:"ERR_INVALID_VALUES"},zG={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},AN={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},WG={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},mT={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},ON={message:"Value unchanged",code:"ABORT_UNCHANGED"},Nr={message:"Not found",code:"ERR_NOT_FOUND"},hT={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},qG={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},kN={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},YG={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},KG={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},bC={message:"Existing stage",code:"ERR_EXISTING_STAGE"},xN={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},fT={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},JG={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},gT={message:"Scores present",code:"ERR_SCORES_PRESENT"},Vre={ANACHRONISM:pC,CANNOT_CHANGE_WINNING_SIDE:TN,CANNOT_MODIFY_TIEFORMAT:SN,CANNOT_MODIFY_PARTICIPANT_TYPE:bG,CANNOT_REMOVE_MAIN_STRUCTURE:zj,CANNOT_REMOVE_PARTICIPANTS:uT,CATEGORY_MISMATCH:vC,COURT_EXISTS:kG,COURT_NOT_FOUND:Sg,DRAW_DEFINITION_NOT_FOUND:Pa,DRAW_ID_EXISTS:Kj,DRAW_POSITION_ACTIVE:nT,DRAW_POSITION_ASSIGNED:If,DRAW_POSITION_NOT_CLEARED:Yj,DRAW_POSITION_NOT_FOUND:Ere,DRAW_SIZE_MISMATCH:pN,DUPLICATE_ENTRY:yI,DUPLICATE_VALUE:zG,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:MG,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:CG,EVENT_EXISTS:aG,EVENT_NOT_FOUND:sa,EXISTING_DRAW_DEFINITIONS:Wj,EXISTING_END_TIME:EN,EXISTING_FLIGHT:qG,EXISTING_MATCHUP_ID:KG,EXISTING_OUTCOME:YG,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Ug,EXISTING_PARTICIPANT:cT,EXISTING_POLICY_TYPE:wN,EXISTING_PROFILE:kN,EXISTING_ROUND:rG,EXISTING_STAGE:bC,EXISTING_STRUCTURE:xN,INCOMPATIBLE_MATCHUP_STATUS:qU,INCOMPLETE_SOURCE_STRUCTURE:lN,INSUFFICIENT_DRAW_POSITIONS:PN,INVALID_ACTION:Qj,INVALID_ASSIGNMENT:hC,INVALID_BOOKINGS:NS,INVALID_CATEGORY:bI,INVALID_COLLECTION_DEFINITION:HG,INVALID_CONFIGURATION:GG,INVALID_DATE_AVAILABILITY:YU,INVALID_DATE:yn,INVALID_DRAW_DEFINITION:Xp,INVALID_DRAW_POSITION_FOR_SEEDING:uN,INVALID_DRAW_POSITION:Ig,INVALID_DRAW_SIZE:aT,INVALID_END_TIME:FG,INVALID_ENTRIES:sG,INVALID_EVENT_TYPE:Ml,INVALID_GAME_SCORES:gC,INVALID_GENDER:Wv,INVALID_MATCHUP_FORMAT:vN,INVALID_MATCHUP_STATUS:bg,INVALID_MATCHUP_STATUS_BYE:cG,INVALID_MATCHUP:zn,INVALID_OBJECT:Lu,INVALID_PARTICIPANT_ID:ps,INVALID_PARTICIPANT_IDS:na,INVALID_PARTICIPANT_ROLE:wG,INVALID_PARTICIPANT_SEEDING:Jj,INVALID_PARTICIPANT_TYPE:ms,INVALID_PARTICIPANT:Ym,INVALID_POLICY_DEFINITION:mG,INVALID_RECORDS:mC,INVALID_SCALE_ITEM:My,INVALID_SEED_NUMBER:tG,INVALID_SEED_POSITION:iG,INVALID_SET_NUMBER:Ore,INVALID_SIDE_NUMBER:UN,INVALID_SCORE:yG,INVALID_STAGE:lp,INVALID_START_TIME:_G,INVALID_STRUCTURE:sp,INVALID_STOP_TIME:LG,INVALID_TIE_FORMAT:uu,INVALID_TIME:go,INVALID_TIME_ITEM:CN,INVALID_TOURNAMENT_DATES:IG,INVALID_TOURNAMENT_RECORD:Dy,INVALID_VALUES:le,INVALID_WINNING_SIDE:lT,MATCHUP_NOT_FOUND:tn,METHOD_NOT_FOUND:fT,MISSING_ASSIGNMENTS:fN,MISSING_ASYNC_STATE_PROVIDER:$G,MISSING_AVOIDANCE_POLICY:pG,MISSING_BIRTH_DATE:hG,MISSING_COLLECTION_DEFINITION:dG,MISSING_COURT_ID:qm,MISSING_COURTS_INFO:OG,MISSING_DATE_AVAILABILITY:vG,MISSING_DATE:fG,MISSING_DRAW_DEFINITION:xe,MISSING_DRAW_ID:Ds,MISSING_DRAW_POSITION:yg,MISSING_DRAW_POSITIONS:Py,MISSING_DRAW_SIZE:Ry,MISSING_ENTRIES:oG,MISSING_EVENT:ni,MISSING_MATCHUP_FORMAT:IN,MISSING_MATCHUP_ID:pn,MISSING_MATCHUP_IDS:Wm,MISSING_MATCHUP:Hn,MISSING_MATCHUPS:Fu,MISSING_PARTICIPANT_COUNT:DG,MISSING_PARTICIPANT_ID:lr,MISSING_PARTICIPANT_IDS:Hc,MISSING_PARTICIPANT_ROLE:UG,MISSING_PARTICIPANT:Km,MISSING_PARTICIPANTS:Cy,MISSING_PENALTY_ID:RN,MISSING_PENALTY_TYPE:AG,MISSING_PERSON_DETAILS:RG,MISSING_POLICY_ATTRIBUTES:bN,MISSING_POLICY_DEFINITION:oT,MISSING_POLICY_TYPE:yN,MISSING_POSITION_ASSIGNMENTS:uG,MISSING_ROUND_NUMBER:Cre,MISSING_SCHEDULE:BG,MISSING_SCORING_POLICY:Are,MISSING_SEED_ASSIGNMENTS:eG,MISSING_SEEDCOUNT_THRESHOLDS:Zj,MISSING_SEEDING_POLICY:Mre,MISSING_SET_NUMBER:kre,MISSING_SET_OBJECT:sT,MISSING_SIDE_NUMBER:xre,MISSING_STAGE:gN,MISSING_STRUCTURE_ID:Aa,MISSING_STRUCTURE:Gc,MISSING_STRUCTURES:hN,MISSING_TARGET_LINK:mN,MISSING_TIE_FORMAT:wg,MISSING_TIME_ITEM:MN,MISSING_TIME_ITEMS:NN,MISSING_TOURNAMENT_ID:vf,MISSING_TOURNAMENT_RECORD:fe,MISSING_TOURNAMENT_RECORDS:Di,MISSING_VALUE:ze,MISSING_VENUE_ID:zc,MODIFICATIONS_FAILED:VG,NO_CANDIDATES:pT,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:NG,NO_MODIFICATIONS_APPLIED:Tg,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:yC,NO_PARTICIPANT_REMOVED:TG,NO_VALID_ACTIONS:WG,NO_VALID_ATTRIBUTES:mT,NO_VALID_DATES:gG,NOT_FOUND:Nr,NOT_IMPLEMENTED:hT,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:DN,PARTICIPANT_ID_EXISTS:SG,PARTICIPANT_NOT_CHECKED_IN:PG,PARTICIPANT_NOT_FOUND:Li,PARTICIPANT_PAIR_EXISTS:Lre,PENALTY_NOT_FOUND:yf,POLICY_NOT_ATTACHED:Nre,POLICY_NOT_FOUND:Zp,SCHEDULE_NOT_CLEARED:qj,SCHEDULED_MATCHUPS:JG,SCORES_PRESENT:gT,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Xj,STAGE_SEQUENCE_LIMIT:lG,STRUCTURE_NOT_FOUND:Ti,TEAM_NOT_FOUND:AN,UNABLE_TO_ASSIGN_COURT:jG,UNLINKED_STRUCTURES:nG,UNRECOGNIZED_DRAW_TYPE:cN,UNRECOGNIZED_MATCHUP_FORMAT:Ey,UNRECOGNIZED_MATCHUP_STATUS:fC,VALUE_UNCHANGED:ON,VENUE_EXISTS:xG},wi={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},XG={addNotice:Qre,callListener:nne,cycleMutationStatus:Zre,deleteNotice:ine,deleteNotices:tne,disableNotifications:jre,enableNotifications:Gre,getMethods:FN,getNotices:ene,getTopics:rne,getTournamentId:ZG,getTournamentRecord:Hre,getTournamentRecords:zre,removeTournamentRecord:Kre,setMethods:Xre,setSubscriptions:Jre,setTournamentId:qre,setTournamentRecord:Wre,setTournamentRecords:Yre,handleCaughtError:ane};function jre(){wi.disableNotifications=!0}function Gre(){wi.disableNotifications=!1}function ZG(){return wi.tournamentId}function Hre(t){return wi.tournamentRecords[t]}function zre(){return wi.tournamentRecords}function Wre(t){let e=t==null?void 0:t.tournamentId;return e?(wi.tournamentRecords[e]=t,{success:!0}):{error:Dy}}function qre(t){return t?wi.tournamentRecords[t]?(wi.tournamentId=t,{success:!0}):{error:fe}:(wi.tournamentId=void 0,{success:!0})}function Yre(t){wi.tournamentRecords=t;let e=Object.keys(t);e.length===1?wi.tournamentId=e[0]:e.length||(wi.tournamentId=void 0)}function Kre(t){if(typeof t!="string")return{error:le};if(!wi.tournamentRecords[t])return{error:Nr};delete wi.tournamentRecords[t];let e=Object.keys(wi.tournamentRecords);return e.length===1?wi.tournamentId=e[0]:e.length||(wi.tournamentId=void 0),{success:!0}}function Jre(t){return typeof t.subscriptions!="object"?{error:le}:(Object.keys(t.subscriptions).forEach(e=>{wi.subscriptions[e]=t.subscriptions[e]}),{...X})}function Xre(t){return typeof t!="object"?{error:le}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(wi.methods[e]=t[e])}),{...X})}function Zre(){let t=wi.modified;return wi.modified=!1,t}function Qre({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(wi.disableNotifications||(wi.modified=!0),!(wi.disableNotifications||!wi.subscriptions[t]&&!r)))return i&&(wi.notices=wi.notices.filter(n=>!(n.topic===t&&n.key===i))),wi.notices.push({topic:t,payload:e,key:i}),{...X}}function FN(){return wi.methods??{}}function ene({topic:t}){return wi.notices.filter(e=>e.topic===t).map(e=>e.payload)}function tne(){wi.notices=[]}function ine({topic:t,key:e}){wi.notices=wi.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function rne(){return{topics:Object.keys(wi.subscriptions)}}function nne({topic:t,notices:e},i){let r=wi.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function ane({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:ZG(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}function ar(t,e){return(t??0)-(e??0)}function Je(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function hs(t){return isNaN(t)?!1:t&&(t&t-1)===0}function dB(t){if(!t.length)return;let e=[...t].sort(ar),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function one(t){if(!hs(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function LN(t){return isNaN(t)?0:t%2&&t+1||t}function _N(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Mi(t){return!isNaN(parseFloat(t))}function QG(t){let e=Je(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function Dg(t){if(isNaN(t))return!1;for(;!hs(t);)t++;return t}function ja(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function rt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function sne(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function lne(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function eH(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=eH(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=lne(s,r)),parseFloat(s.toFixed(n))}function AS(t,e=2){return parseFloat(Number(Math.round(t*1e3)/1e3).toFixed(e))}function mt(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function une(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function fn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function bf(t){return rt(t)?t:1/0}function la(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function cne(t){return tH(la(t))}function tH(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function dne(t,e,i){return i.indexOf(t)===e}function iH(t){return t.filter(dne)}function ia(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Zn(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Re(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function xs(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Vi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function pB(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function bn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function pne(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function mne(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function Ar(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function rH(t,[e,...i]){return t.length?[t.slice(0,e),...rH(t.slice(e),[...i,e])]:[]}function hne(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function nH(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function aH(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function wC(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function fne(t,e=1){if(!Array.isArray(t)||!t.every(rt))return[];let i=Math.min(...t,e),r=Math.max(...t);return Re(i,r+1).filter(n=>!t.includes(n))}var Xt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Or=XG,mB=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function gne(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Vi(Object.keys(t),mB).length!==mB.length)throw new Error("Global state provider is missing required methods");return Or=t,{success:!0}}function vne(){if(Or.createInstanceState){try{Or.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:$G}}function Ra(t){return!t||typeof t!="object"?Xt.devContext??!1:typeof Xt.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Xt.devContext)==null?void 0:i[e])===t[e]})&&Xt.devContext}function Ine(t="reset",e="default"){var r,n;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Xt.timers).filter(a=>a!=="default"||Xt.timers[a].startTime).map(a=>{let o=Xt.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:Xt.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Xt.timers[e].state==="stopped"?0:(i-(((r=Xt.timers[e])==null?void 0:r.startTime)??0))/1e3,o=Xt.timers[e].elapsedTime+a;return{state:Xt.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!Xt.timers[e]||t==="reset"){if(e==="allTimers")return Xt.timers={default:{elapsedTime:0}},!0;Xt.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Xt.timers[e].elapsedTime||(Xt.timers[e].elapsedTime=0),t==="stop"&&Xt.timers[e].state!=="stopped"&&(Xt.timers[e].state="stopped")&&(Xt.timers[e].elapsedTime+=(i-(((n=Xt.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&(Xt.timers[e].startTime=i)&&(Xt.timers[e].state="active"),Xt.timers[e]}function oH(t){Qn(t)?Xt.globalLog=t:delete Xt.globalLog}function wI(t){Xt.devContext=t}function sH(){Or.disableNotifications()}function KU(){Or.enableNotifications()}function UI(t,e){typeof t=="boolean"&&(Xt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Xt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Xt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Xt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Xt.deepCopyAttributes.threshold=e.threshold))}function $N(){return{enabled:Xt.deepCopy,...Xt.deepCopyAttributes}}function yne(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Xt.globalSubscriptions[e]=t.subscriptions[e]}),{...X}):{error:ze,info:"missing subscriptions"}}function bne(t){return t!=null&&t.subscriptions?Or.setSubscriptions({subscriptions:t.subscriptions}):{error:ze,info:"missing subscriptions"}}function lH(t){return t?typeof t!="object"?{error:le}:(Object.keys(t).forEach(e=>{Qn(t[e])&&(Xt.globalMethods[e]=t[e])}),{...X}):{error:ze,info:"missing method declarations"}}function uH(t){return t?typeof t!="object"?{error:le}:Or.setMethods(t):{error:ze,info:"missing method declarations"}}function BN(){return Or.cycleMutationStatus()}function lt(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Xt.globalSubscriptions[t.topic];return Or.addNotice(t,e)}function cH(){return{...Xt.globalMethods,...Or.getMethods()}}function dH(t){return Or.getNotices(t)}function VN({key:t,topic:e}){return Or.deleteNotice({key:t,topic:e})}function Ny(){return Or.deleteNotices()}function Vo(){return Or.getTopics()}async function UC(t){return Or.callListener(t,Xt.globalSubscriptions)}function Xm(){return Or.getTournamentId()}function jN(t){return Or.getTournamentRecord(t)}function Zm(){return Or.getTournamentRecords()}function pH(t){return Or.setTournamentRecord(t)}function vT(t){return Or.setTournamentRecords(t)}function SI(t){return Or.setTournamentId(t)}function mH(t){return Or.removeTournamentRecord(t)}function SC(){return Or}function IT({engineName:t,methodName:e,params:i,err:r}){return(Qn(Or.handleCaughtError)&&Or.handleCaughtError||XG.handleCaughtError)({engineName:t,methodName:e,params:i,err:r})}function hH(t,e){if(Xt.globalLog)try{Xt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),oH()}else console.log(e,t)}function fH(t,e,i,r){if(!Ut(t))return{error:le};Mi||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(c=>{Qn(s[c])?a[c]=s[c]:Ut(s[c])&&(e===!0||n!=null&&n.includes(c))&&(i===void 0||l<i)&&o(s[c],l+1)})};return o(t),r?lH(a):uH(a),{methods:a}}function wne(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function Ge(t,e,i,r){var o;if(typeof t!="object"||t===null)return t;(o=$N())!=null&&o.enabled||(r=!0);let n=["",void 0,null];e&&n.push(!1);let a=wne(t,n,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>Ge(l))}:{[s]:r?t[s]:Ge(t[s])}))}function Q({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,Ge(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...X}),e??{success:!0}}var wf="resourceSubType",Uf="resourceType",Sf="identifier",Une={RESOURCE_SUB_TYPE:wf,RESOURCE_TYPE:Uf,IDENTIFIER:Sf},Gs="SINGLES",wm="SINGLES",eo="DOUBLES",Uc="DOUBLES",or="TEAM",to="TEAM",Sne="AGE",Tne="RATING",Dne="BOTH",gH={AGE:Sne,BOTH:Dne,DOUBLES:eo,DOUBLES_EVENT:Uc,RATING:Tne,SINGLES:Gs,SINGLES_EVENT:wm,TEAM_EVENT:to,TEAM:or},rn="tournamentRecords",GN="policyDefinitions",Fn="tournamentRecord",HN="onlineResource",ya="drawDefinition",zN="matchUpFormat",Nl="participantId",vH="scheduleDates",Pne="tournamentId",Rne="scheduleDate",Ene="roundNumber",yT="structureId",WN="participant",Ay="matchUpIds",Cne="policyType",IH="structures",al="matchUpId",qN="eventType",bT="inContext",YN="structure",wT="courtIds",Mne="personId",UT="venueIds",yH="matchUps",bH="courtId",wH="eventId",Yl="matchUp",UH="drawId",vl="error",up="event",Pg="param",Nne="uuids",Ane="averageMatchUpMinutes",One="recoveryMinutes",kne="periodLength",xne="number",Sa="object",Mn="array",ea="_validate",SH="_message",fs="_invalid",so="_ofType",KN="_anyOf",TI="_oneOf",hB={[qN]:t=>[Gs,eo,or].includes(t),[HN]:t=>Vi(Object.keys(t),[wf,Uf,Sf]).length===3},Fne={[rn]:Di,[Fn]:fe,[GN]:oT,[ya]:xe,[Nl]:lr,[zN]:IN,[Pne]:vf,[yT]:Aa,[Ay]:Wm,[WN]:Km,[HN]:Lu,[qN]:Ml,[IH]:hN,[al]:pn,[YN]:Gc,[bH]:qm,[yH]:Fu,[wH]:sa,[Yl]:Hn,[wT]:ze,[UT]:ze,[UH]:Ds,[up]:ni},Lne={[rn]:Sa,[GN]:Sa,[Fn]:Sa,[ya]:Sa,[HN]:Sa,[vH]:Mn,[WN]:Sa,[Ay]:Mn,[IH]:Mn,[YN]:Sa,[wT]:Mn,[UT]:Mn,[yH]:Mn,[Yl]:Sa,[up]:Sa,[Nne]:Mn};function it(t,e,i){if(!t&&!Ut(t))return{error:le};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:le};let{paramError:r,errorParam:n}=Bne(t,e);if(!r)return{valid:!0};let a=(t==null?void 0:t[n])===void 0?Fne[n]||r[vl]||r[fs]||le:r[ea]&&(r[vl]||r[fs])||le,o=n??(r[TI]&&Object.keys(r[TI]).join(", "));return Q({info:{param:o,message:r[SH]},result:{error:a},stack:i})}function TH(t,e){let i=Object.keys(t),r=Object.keys(e);return Vi(i,r)}function _ne(t,e){if(!e)return;let i=TH(t,e);return i.length!==1?{error:le}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function $ne(t,e){if(!e)return;let i=TH(t,e).filter(r=>t[r]);return i.length<1?{error:le}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function Bne(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...c})=>{let u=a&&_ne(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=o&&$ne(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(h=>typeof c[h]=="boolean"),m=p.find(h=>{let f=s&&!Qn(s),g=t[h]!==void 0&&!s&&Vne(t,h,n),v=c[h]&&[void 0,null].includes(t[h]),I=f||g||v||s&&t[h]!==void 0&&!jne(t[h],s)||hB[h]&&!hB[h](t[h]);return I&&(i=h,r=l),I});return!p.length||m}),errorParam:i,paramInfo:r}}function Vne(t,e,i){return i=i||Lne[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function jne(t,e){return Qn(e)?e(t):!0}var JN="DYNAMIC",Sc="RANKING",vc="RATING",Nd="SCALE",Il="SEEDING",Gne={RANKING:Sc,RATING:vc,SCALE:Nd,SEEDING:Il};function Rg(t){var n;let e=it(t,[{[WN]:!0}]);if(e.error)return e;let i=(n=t.participant.timeItems)==null?void 0:n.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Nd))&&[Sc,vc,Il].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),o=mt(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,c,u,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=c===Il&&"seedings"||c===Sc&&"rankings"||"ratings";r[h][u]||(r[h][u]=[]),r[h][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...X,...r}}function Um(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),c=Object.keys(o),u=Object.assign({},...c.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=u[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(I=>{let y={};return n(I,f,y)!==!1?y:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var OS=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,DH=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Al=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Dd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function kS(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=ut(t.scheduledTime)),!e)return;let i=mi(t.scheduledTime),r=ut(e);return r&&i&&(r+=`T${i}`),r}function Hne(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function Eg(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Dd.test(Qm(t,!0,!0)))}function aa(t){return Ad(t)||OS.test(t)}function zne(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return Wne(i,{displaySeconds:!1})}function Wne(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(za).join(":")}var XN=t=>{let e=DI(t)||Ad(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${za(r)}-${za(e.getUTCDate())}`};function qne(t){let e=DI(t)||Ad(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function os(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function xS(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Yne(t){return xS(t).getTime()}function DI(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Tf(t,e){if(!aa(t)||!aa(e))return[];let i=ut(t)+"T00:00",r=ut(e)+"T00:00",n=new Date(i),a=new Date(r),o=DI(a)&&DI(n)&&c(n,a),s=[],l=0;if(o){let u=n,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>os(u));function c(u,d){return u<=d}}var Kne=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Ad(t){return typeof t!="string"?!1:Kne.test(t)}function ZN(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function Dt(t){let e=mi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function Jne(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[za(e),za(i)].join(":")}function FS(t){return ZN(t)?t.split(":").slice(0,2).map(za).join(":"):void 0}function mi(t){return Ad(t)&&t.indexOf("T")>0?FS(t.split("T").reverse()[0]):FS(t)}function ut(t){return Ad(t)||Al.test(t)?t.split("T")[0]:void 0}function Gv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),ut(i.toISOString())}function LS(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function Xne(t){let e=LS(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(za).join(":")}function Zne(t){var i;let e=LS(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Qm(t,e,i){let r=ut(t),n=mi(t),a=r?n:t;return t?e&&(r&&i&&t||Xne(a))||Zne(a):void 0}function PH(t,e){let i=LS(t),r=LS(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function RH(t,e=7){let i=ut(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return os(n)}function Qne(t){return RH(t)}function eae(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),os(n,i)}function tae(t,e,i){let r=new Date(t,0);return os(new Date(r.setDate(e)),i)}function Qi(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(za),n=xS(e).setHours(i,r,0,0);return xS(n)}function Oy(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function Vn(t,e){let i=mi(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return mi(QN(Qi(i),r).toISOString())}function QN(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function za(t){return t.toString()[1]?t:"0"+t}function Ol(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var EH={addDays:RH,addWeek:Qne,addMinutesToTimeString:Vn,convertTime:Qm,getIsoDateString:kS,getUTCdateString:XN,DateHHMM:zne,extractDate:ut,extractTime:mi,formatDate:os,getDateByWeek:eae,isISODateString:Ad,isDate:DI,isTimeString:ZN,offsetDate:xS,offsetTime:Yne,sameDay:Ol,timeStringMinutes:Dt,timeToDate:Qi,timeUTC:qne,validTimeValue:Eg,validDateString:OS,timeValidation:Dd,dateValidation:Al};function ke(t,e,i,r,n=0){if(SC().makeDeepCopy)return SC().makeDeepCopy(t,e,i,r);let a=$N(),{stringify:o,toJSON:s,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||Qn(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||Qn(l)&&!l(m)),p=(m,h)=>{u[m]=Qn(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=Qn(c)?c(h):void 0;if(f!==void 0)u[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=eA(h);Object.assign(u,...g)}else r&&m==="extensions"?u[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&Qn(h==null?void 0:h.toJSON)?u[m]=h.toJSON():h===null?u[m]=void 0:Hne(h)?u[m]=new Date(h).toISOString():u[m]=ke(h,e,i,r,n+1)}return u}function eA(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}var TC="voluntaryConsolation",iu="competitiveBands",tA="roundRobinTally",Sm="positionActions",Pr="matchUpActions",JU="rankingPoints",Df="roundNaming",ky="participant",PI="progression",Wc="scheduling",_S="avoidance",iae="display",gs="scoring",es="seeding",Pf="feedIn",rae="audit",$S="draws",nae={POLICY_TYPE_VOLUNTARY_CONSOLATION:TC,POLICY_TYPE_COMPETITIVE_BANDS:iu,POLICY_TYPE_ROUND_ROBIN_TALLY:tA,POLICY_TYPE_POSITION_ACTIONS:Sm,POLICY_TYPE_MATCHUP_ACTIONS:Pr,POLICY_TYPE_RANKING_POINTS:JU,POLICY_TYPE_ROUND_NAMING:Df,POLICY_TYPE_PARTICIPANT:ky,POLICY_TYPE_PROGRESSION:PI,POLICY_TYPE_SCHEDULING:Wc,POLICY_TYPE_AVOIDANCE:_S,POLICY_TYPE_DISPLAY:iae,POLICY_TYPE_FEED_IN:Pf,POLICY_TYPE_SCORING:gs,POLICY_TYPE_SEEDING:es,POLICY_TYPE_AUDIT:rae,POLICY_TYPE_DRAWS:$S};function Tc({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=ke(o,!1,n);if(s){let l=e==null?void 0:e[ky];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=Rg({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return Um({template:l.participant,source:s})}return s}var aae="element required",oae="missing name";function gn(t){if(!t||typeof t!="object")return{error:ze};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:le};if(!(t!=null&&t.name))return{error:ze,info:oae};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=gn({element:i,name:t.name});if(r.error)return Q({result:r,stack:"removeExtension"})}return{...X}}return{error:ze,info:aae}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...X}):{...X,info:Nr}}function Hs({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Ct(t){if(typeof t!="object")return{error:ze};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return Q({result:{error:le},stack:e});if(!Hs({extension:t.extension}))return Q({result:{error:le,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Ct({extension:t.extension,element:r});if(n.error)return Q({result:n,stack:e})}return{...X}}else return Q({result:{error:ze},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...X}}function iA(t){return!t||typeof t!="object"?{error:ze}:t.tournamentRecord?Ct({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:fe}}function ST(t){return!t||typeof t!="object"?{error:ze}:t.drawDefinition?Ct({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:Pa}}function qc(t){return!t||typeof t!="object"?{error:ze}:t.event?Ct({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:sa}}function CH(t){var r;if(!t||typeof t!="object")return{error:ze};if(!t.participantId)return{error:lr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Tc({participantId:t.participantId,tournamentParticipants:e});return i?Ct({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Li}}function rA(t){return!t||typeof t!="object"?{error:ze}:t.tournamentRecord?gn({element:t.tournamentRecord,name:t.name}):{error:fe}}function MH(t){return!t||typeof t!="object"?{error:ze}:t.drawDefinition?gn({element:t.drawDefinition,name:t.name}):{error:Pa}}function TT(t){return!t||typeof t!="object"?{error:ze}:t!=null&&t.event?gn({element:t.event,name:t.name}):{error:sa}}function NH(t){var r;if(!t||typeof t!="object")return{error:ze};if(!t.participantId)return{error:lr};let e=((r=t.tournamentRecord)==null?void 0:r.participants)||[],i=Tc({participantId:t.participantId,tournamentParticipants:e});return i?gn({element:i,name:t.name}):{error:Li}}function xy({tournamentRecords:t}){return{tournamentIds:Ut(t)?Object.keys(t):[],...X}}var sae="extensionQueries";function dt({discover:t,element:e,name:i,...r}){var a;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=r[c])==null?void 0:u.extensions)?r[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:Nr}}return Q({result:{error:ze},stack:sae})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let n=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:n,info:n?void 0:Nr}}var lae="activeSuspension",RI="appliedPolicies",AH="context",DT="delegatedOutcome",ss="disabled",Tm="disableAutoCalc",PT="disableLinks",BS="display",qv="drawDeletions",uae="drawProfile",VS="entryProfile",cae="eventProfile",dae="eventWithdrawalRequests",pae="factory",No="flightProfile",DC="groupingAttribute",hu="lineUps",Od="linkedTournamentsIds",RT="matchUpHistory",nA="participantRepresentatives",Cg="personRequests",Yv="positionActions",mae="rankingPoints",hae="registration",ol="roundTarget",Fy="scheduleLimits",fu="scheduleTiming",Dm="schedulingProfile",fae="statusDetail",Rf="subOrder",Dc="tally",Kv="tieFormatModification",OH={ACTIVE_SUSPENSION:lae,APPLIED_POLICIES:RI,CONTEXT:AH,DELEGATED_OUTCOME:DT,DISABLED:ss,DISABLE_LINKS:PT,DISABLE_AUTO_CALC:Tm,DISPLAY:BS,DRAW_DELETIONS:qv,DRAW_PROFILE:uae,ENTRY_PROFILE:VS,EVENT_PROFILE:cae,EVENT_WITHDRAWAL_REQUESTS:dae,FLIGHT_PROFILE:No,GROUPING_ATTRIBUTE:DC,LINEUPS:hu,LINKED_TOURNAMENTS:Od,MATCHUP_HISTORY:RT,PARTICIPANT_REPRESENTATIVES:nA,PERSON_REQUESTS:Cg,POSITION_ACTIONS:Yv,RANKING_POINTS:mae,REGISTRATION:hae,ROUND_TARGET:ol,SCHEDULE_LIMITS:Fy,SCHEDULE_TIMING:fu,SCHEDULING_PROFILE:Dm,STATUS_DETAIL:fae,SUB_ORDER:Rf,TALLY:Dc,TIE_FORMAT_MODIFICATIONS:Kv,FACTORY:pae},fB=[DT,ss,Tm,PT,No,hu,Od,RT,nA,Cg,ol,Fy,fu,Dm,Rf,Dc,Kv];function kH({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Di};let e=xy({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Ct({tournamentRecords:t,discover:!0,extension:{name:Od,value:{tournamentIds:i}}}):{...X}}function xH({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Di};let e=gn({name:Od,tournamentRecords:t,discover:!0});return Q({result:e,stack:"unlinkTournaments"})}function FH({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:le};if(!e)return{error:vf};let i=xy({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:vf};let n;return r.every(a=>{var d;let o=t[a],{extension:s}=dt({element:o,name:Od});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=rA({name:Od,tournamentRecord:o});return p.error&&(n=p.error),p.success}let c=l.filter(p=>p!==e);s.value={tournamentIds:c};let u=iA({tournamentRecord:o,extension:s});return u.error&&(n=u.error),u.success}),n?{error:n}:{...X}}var LH={};gt(LH,{getLinkedTournamentIds:()=>Ly,getTournamentIds:()=>xy});function Ly({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Di}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],r=i==null?void 0:i.tournamentId,{extension:n}=dt({element:i,name:Od}),a=(((o=n==null?void 0:n.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==r);return{[e]:a}}))}}var ET={};gt(ET,{adHocPositionSwap:()=>GW,addAdHocMatchUps:()=>uD,addDrawDefinitionTimeItem:()=>pO,addFinishingRounds:()=>ib,addGoesTo:()=>Vd,addPlayoffStructures:()=>lD,addQualifyingStructure:()=>jW,addVoluntaryConsolationStage:()=>FW,addVoluntaryConsolationStructure:()=>QA,allPlayoffPositionsFilled:()=>uO,alternateDrawPositionAssignment:()=>yW,assignDrawPosition:()=>gq,assignDrawPositionBye:()=>xa,attachConsolationStructures:()=>pq,attachPlayoffStructures:()=>EO,attachQualifyingStructure:()=>dO,attachStructures:()=>sD,autoSeeding:()=>Fde,automatedPlayoffPositioning:()=>mb,automatedPositioning:()=>pb,checkValidEntries:()=>pD,deleteAdHocMatchUps:()=>Iq,drawMatic:()=>XO,findDrawDefinition:()=>OO,generateAdHocMatchUps:()=>mD,generateAdHocRounds:()=>JO,generateAndPopulatePlayoffStructures:()=>RO,generateDrawDefinition:()=>Ab,generateDrawMaticRound:()=>BO,generateDrawStructuresAndLinks:()=>LO,generateDrawTypeAndModifyDrawDefinition:()=>_O,generateQualifyingStructure:()=>IO,generateVoluntaryConsolation:()=>jq,getAssignedParticipantIds:()=>fp,getAvailableMatchUpsCount:()=>cD,getAvailablePlayoffProfiles:()=>fb,getDrawDefinitionTimeItem:()=>OA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>Oo,getDrawTypeCoercion:()=>Tb,getEligibleVoluntaryConsolationParticipants:()=>MO,getMatchUpsMap:()=>Jr,getParticipantIdFinishingPositions:()=>AO,getPositionAssignments:()=>$I,getPositionsPlayedOff:()=>jg,getSeedingThresholds:()=>rO,getSeedsCount:()=>Db,getStructureSeedAssignments:()=>ro,getTeamLineUp:()=>Bd,getValidGroupSizes:()=>cb,isAdHoc:()=>Wn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>FO,luckyLoserDrawPositionAssignment:()=>IW,modifyDrawDefinition:()=>mq,modifyDrawName:()=>CO,modifySeedAssignment:()=>PW,mutate:()=>_H,positionActions:()=>xO,pruneDrawDefinition:()=>fq,qualifierDrawPositionAssignment:()=>DW,query:()=>wq,removeDrawPositionAssignment:()=>FI,removeRoundMatchUps:()=>yq,removeSeededParticipant:()=>VW,removeStructure:()=>kW,renameStructures:()=>OW,resetDrawDefinition:()=>hq,resetVoluntaryConsolationStructure:()=>oz,setDrawParticipantRepresentativeIds:()=>$H,setPositionAssignments:()=>SW,setStructureOrder:()=>NW,setSubOrder:()=>bq,shiftAdHocRounds:()=>UW,swapAdHocRounds:()=>TW,swapDrawPositionAssignments:()=>$W,updateTeamLineUp:()=>ph,withdrawParticipantAtDrawPosition:()=>cW});var _H={};gt(_H,{adHocPositionSwap:()=>GW,addAdHocMatchUps:()=>uD,addDrawDefinitionTimeItem:()=>pO,addPlayoffStructures:()=>lD,addQualifyingStructure:()=>jW,addVoluntaryConsolationStage:()=>FW,addVoluntaryConsolationStructure:()=>QA,alternateDrawPositionAssignment:()=>yW,assignDrawPosition:()=>gq,assignDrawPositionBye:()=>xa,attachConsolationStructures:()=>pq,attachPlayoffStructures:()=>EO,attachQualifyingStructure:()=>dO,attachStructures:()=>sD,automatedPlayoffPositioning:()=>mb,automatedPositioning:()=>pb,deleteAdHocMatchUps:()=>Iq,luckyLoserDrawPositionAssignment:()=>IW,modifyDrawDefinition:()=>mq,modifyDrawName:()=>CO,modifySeedAssignment:()=>PW,pruneDrawDefinition:()=>fq,qualifierDrawPositionAssignment:()=>DW,removeDrawPositionAssignment:()=>FI,removeRoundMatchUps:()=>yq,removeSeededParticipant:()=>VW,removeStructure:()=>kW,renameStructures:()=>OW,resetDrawDefinition:()=>hq,resetVoluntaryConsolationStructure:()=>oz,setDrawParticipantRepresentativeIds:()=>$H,setPositionAssignments:()=>SW,setStructureOrder:()=>NW,setSubOrder:()=>bq,shiftAdHocRounds:()=>UW,swapAdHocRounds:()=>TW,swapDrawPositionAssignments:()=>$W,updateTeamLineUp:()=>ph,withdrawParticipantAtDrawPosition:()=>cW});var aA=t=>e=>t[e],oA=(t=[])=>t.map(br).filter(Boolean),PC=(t=[])=>t.map(vt).filter(Boolean),vt=(t={})=>aA(t)("participantId"),br=(t={})=>aA(t)("matchUpId"),EI=(t={})=>aA(t)("drawId");function $H({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:Pa};if(!Array.isArray(t))return{error:le};let i=PC((e==null?void 0:e.entries)||[]);return t.length&&Vi(t,i).length<t.length?{error:le}:ST({drawDefinition:e,extension:{name:nA,value:t}})}var Ea="ABANDONED",eh="AWAITING_RESULT",xt="BYE",_u="CANCELLED",_i="COMPLETED",Mg="DEAD_RUBBER",Rt="DEFAULTED",mr="DOUBLE_DEFAULT",tr="DOUBLE_WALKOVER",jo="IN_PROGRESS",vs="INCOMPLETE",sA="NOT_PLAYED",nn="RETIRED",Yc="SUSPENDED",ji="TO_BE_PLAYED",Lt="WALKOVER",gae=[eh,_i,Rt,jo,vs,nn,Yc],BH=[eh,_i,Rt,tr,mr,jo,vs,nn,Yc,Lt],VH=[Ea,eh,xt,_u,_i,Mg,Rt,tr,mr,jo,vs,sA,nn,Yc,ji,Lt],jH=[xt,tr,mr,_i,Rt,nn,Lt],GH=[Ea,eh,_u,Mg,jo,vs,sA,Yc,ji,void 0],fr=[_u,Ea,_i,Mg,Rt,tr,mr,nn,Lt],lA=[Ea,_i,Rt,tr,mr,jo,nn,Lt],HH=[jo,vs,Yc,ji],zH={ABANDONED:Ea,AWAITING_RESULT:eh,BYE:xt,CANCELLED:_u,COMPLETED:_i,DEAD_RUBBER:Mg,DEFAULTED:Rt,DOUBLE_WALKOVER:tr,DOUBLE_DEFAULT:mr,IN_PROGRESS:jo,INCOMPLETE:vs,NOT_PLAYED:sA,RETIRED:nn,SUSPENDED:Yc,TO_BE_PLAYED:ji,WALKOVER:Lt},Ae="MAIN",We="QUALIFYING",Wr="CONSOLATION",Rr="VOLUNTARY_CONSOLATION",xi="PLAY_OFF",uA=[Ae,We,Wr,xi,Rr],Pm={[We]:1,[Ae]:2,[xi]:3,[Wr]:3,[Rr]:4},WH="finishingPositions",qH="aggregateEventStructures",YH={[Ae]:1,[xi]:2,[Wr]:3,[We]:4,[Rr]:5},vae={[xi]:1,[Ae]:2,[Wr]:3,[We]:4,[Rr]:5},cA="CLUSTER",Iae="SEPARATE",kd="WATERFALL",CT="ITEM",En="CONTAINER",yo="DRAW",MT="RANDOM",wo="TOP_DOWN",xd="BOTTOM_UP",gu="POSITION",vu="WINNER",kl="LOSER",xl="FIRST_MATCHUP",io="AD_HOC",yae="AD_HOC",Ng="FEED_IN",Ef="COMPASS",Cf="OLYMPIC",bae="SINGLE_ELIMINATION",Fs="SINGLE_ELIMINATION",_y="DOUBLE_ELIMINATION",Mf="FIRST_MATCH_LOSER_CONSOLATION",$y="FIRST_ROUND_LOSER_CONSOLATION",cp="LUCKY_DRAW",NT="CURTIS_CONSOLATION",wae="CURTIS_CONSOLATION",dA="FEED_IN_CHAMPIONSHIP_TO_SF",CI="FEED_IN_CHAMPIONSHIP_TO_SF",pA="FEED_IN_CHAMPIONSHIP_TO_QF",MI="FEED_IN_CHAMPIONSHIP_TO_QF",mA="FEED_IN_CHAMPIONSHIP_TO_R16",NI="FEED_IN_CHAMPIONSHIP_TO_R16",KH="MODIFIED_FEED_IN_CHAMPIONSHIP",AI="MODIFIED_FEED_IN_CHAMPIONSHIP",By="FEED_IN_CHAMPIONSHIP",Uae="DOUBLE_ROUND_ROBIN",Ao="ROUND_ROBIN",Fl="ROUND_ROBIN_WITH_PLAYOFF",JH="DECIDER",XH="BACKDRAW",hA={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},fA={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},Ag="WIN_RATIO",th="ROUND_OUTCOME",ZH=[Ef,NT,MI,NI,CI,By,pA,mA,dA,Mf,$y,cp,AI,Cf,xi,Fl],Sae=[io,Ef,NT,_y,MI,NI,CI,By,Ng,Mf,$y,cp,AI,Cf,xi,Ao,Fl,Fs],AT={MAIN:Ae,QUALIFYING:We,CONSOLATION:Wr,ITEM:CT,CONTAINER:En,FIRST_MATCHUP:xl,WINNER:vu,LOSER:kl,AD_HOC:io,FEED_IN:Ng,FLEX_ROUNDS:yae,COMPASS:Ef,PLAY_OFF:xi,OLYMPIC:Cf,KNOCKOUT:bae,SINGLE_ELIMINATION:Fs,DOUBLE_ELIMINATION:_y,CURTIS:NT,FICSF:dA,FICQF:pA,FICR16:mA,MFIC:KH,VOLUNTARY_CONSOLATION:Rr,FIRST_MATCH_LOSER_CONSOLATION:Mf,FIRST_ROUND_LOSER_CONSOLATION:$y,MODIFIED_FEED_IN_CHAMPIONSHIP:AI,FEED_IN_CHAMPIONSHIP_TO_R16:NI,FEED_IN_CHAMPIONSHIP_TO_QF:MI,FEED_IN_CHAMPIONSHIP_TO_SF:CI,FEED_IN_CHAMPIONSHIP:By,LUCKY_DRAW:cp,ROUND_ROBIN_WITH_PLAYOFF:Fl,ROUND_ROBIN:Ao,DECIDER:JH,BACKDRAW:XH,COMPASS_ATTRIBUTES:hA,OLYMPIC_ATTRIBUTES:fA,DRAW:yo,RANDOM:MT,TOP_DOWN:wo,BOTTOM_UP:xd,WATERFALL:kd,WIN_RATIO:Ag,ROUND_OUTCOME:th,MULTI_STRUCTURE_DRAWS:ZH,generatedDrawTypes:Sae,stageOrder:Pm,finishOrder:YH,AGGREGATE_EVENT_STRUCTURES:qH,FINISHING_POSITIONS:WH},Tae=AT;function ih(t,e,i){var d,p;let r=m=>{var h,f;return(f=(h=dt({element:m,name:ol}))==null?void 0:h.extension)==null?void 0:f.value},n=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===qH&&vae,o=(i==null?void 0:i.mode)===WH&&YH,s=o||a||Pm,l=m=>(m==null?void 0:m.stage)===Ae&&(m==null?void 0:m.stageSequence)===1,c=m=>l(m)?-1:s[m==null?void 0:m.stage],u=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>fr.includes(h)?1:-1);return n&&u(t)-u(e)||a&&c(t)-c(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(r(t)||0)-(r(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(jS(t)||0)-(jS(e)||0)}function jS(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function Qe(t){let e=it(t,[{[ya]:!0,[yT]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=Oo({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ti};let s=o.structureType===CT?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function Oo({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var h;let l=!e&&xe||!(e!=null&&e.structures)&&hN||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=f=>{var v,I;let g=(I=(v=dt({element:f,name:ol}))==null?void 0:v.extension)==null?void 0:I.value;return!n||n===g},u=((h=e==null?void 0:e.structures)==null?void 0:h.filter(p).filter(m).filter(c).sort((f,g)=>ih(f,g,a)))??[],d=t?Object.assign({},...uA.map(f=>{let g=u==null?void 0:u.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function m(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function QH({drawDefinition:t}){if(!t)return{error:xe};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=Qt({structure:i}),a=(n==null?void 0:n.map(vt).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Qt({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:xe};if({structure:i,error:r}=Qe({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>Qt({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=uG,{positionAssignments:n,error:r}}function Ur({drawDefinition:t,structureId:e,structure:i}){var c;let r=((c=Qt({drawDefinition:t,structureId:e,structure:i}))==null?void 0:c.positionAssignments)||[],n=r==null?void 0:r.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&(r==null?void 0:r.length)===(n==null?void 0:n.length),o=r==null?void 0:r.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),s=r==null?void 0:r.filter(u=>!u.participantId&&u.bye),l=r==null?void 0:r.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:o,assignedPositions:n,qualifierPositions:l,byePositions:s}}var gA="addDrawDefinition",OT="addMatchUps",Pc="addParticipants",vA="addScaleItems",IA="addVenue",Nf="audit",yA="dataIssue",bA="deleteParticipants",wA="deleteVenue",UA="deletedDrawIds",SA="deletedMatchUpIds",TA="modifyDrawDefinition",ez="modifyDrawEntries",tz="modifyEventEntries",DA="modifyMatchUp",qr="modifyParticipants",PA="modifyPositionAssignments",RA="modifySeedAssignments",rh="modifyTournamentDetail",dp="modifyVenue",RC="mutations",EC="publishEvent",iz="publishEventSeeding",rz="publishOrderOfPlay",nz="publishParticipants",EA="unPublishEvent",CA="unPublishEventSeeding",MA="unPublishOrderOfPlay",Dae="unPublishParticipants",kT="updateInContextMatchUp",Pae={ADD_DRAW_DEFINITION:gA,ADD_MATCHUPS:OT,ADD_PARTICIPANTS:Pc,ADD_SCALE_ITEMS:vA,ADD_VENUE:IA,AUDIT:Nf,DATA_ISSUE:yA,DELETE_PARTICIPANTS:bA,DELETE_VENUE:wA,DELETED_DRAW_IDS:UA,DELETED_MATCHUP_IDS:SA,MODIFY_DRAW_DEFINITION:TA,MODIFY_DRAW_ENTRIES:ez,MODIFY_EVENT_ENTRIES:tz,MODIFY_MATCHUP:DA,MODIFY_PARTICIPANTS:qr,MODIFY_POSITION_ASSIGNMENTS:PA,MODIFY_SEED_ASSIGNMENTS:RA,MODIFY_TOURNAMENT_DETAIL:rh,MODIFY_VENUE:dp,MUTATIONS:RC,PUBLISH_EVENT_SEEDING:iz,PUBLISH_EVENT:EC,PUBLISH_ORDER_OF_PLAY:rz,PUBLISH_PARTICIPANTS:nz,UNPUBLISH_EVENT_SEEDING:CA,UNPUBLISH_EVENT:EA,UNPUBLISH_ORDER_OF_PLAY:MA,UPDATE_INCONTEXT_MATCHUP:kT};function xT(t,e){var a;if(!t)return{error:xe};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let r=new Date(i).toISOString(),n=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(n!=null&&n.length)||n!=null&&n.includes(o.structureId))&&(o.updatedAt=r)}),{...X}}function Rc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&xT(t),lt({payload:{matchUps:i,tournamentId:e,eventId:r},topic:OT}),{...X}}function $u({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&xT(t),lt({topic:SA,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)VN({key:a});return{...X}}function St({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&ai({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),lt({topic:DA,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...X}):(console.log(Hn),{error:Hn})}function Rae({tournamentId:t,inContextMatchUp:e}){return e?(lt({payload:{inContextMatchUp:e,tournamentId:t},topic:kT,key:e.matchUpId}),{...X}):{error:Hn}}function Vy({tournamentId:t,eventId:e,drawDefinition:i}){return i?(xT(i),lt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:gA,key:i.drawId}),{...X}):(console.log(xe),{error:xe})}function Eae({tournamentId:t,eventId:e,drawId:i}){return lt({payload:{drawId:i,tournamentId:t,eventId:e},topic:UA,key:i}),VN({key:i}),{...X}}function ai({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(xT(t,i),lt({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:TA,key:t.drawId}),{...X}):{error:xe}}function az({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:xe};if(!i)return{error:Gc};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return lt({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:RA,key:t.drawId}),ai({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...X}}function Ec({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:xe};if(!i)return{error:Gc};let n=Qt({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return lt({topic:PA,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),ai({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...X}}function oz({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var o,s;if(!e)return{error:xe};let n=(o=e.structures)==null?void 0:o.find(l=>l.stage===Rr);if(!n)return{error:Ti};let a=((s=n.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return n.positionAssignments=[],n.seedAssignments=[],n.matchUps=[],$u({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Rr)),ai({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[n.structureId]}),{...X}}function NA({drawPositions:t,structure:e}){var r;if([We,Ae].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Qt({structure:e});(r=i==null?void 0:i.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||r.forEach(n=>{Ct({element:n,extension:{name:PT,value:!0}})})}function FT(t){var s,l;let{appliedPolicies:e,positionAction:i,drawDefinition:r}=t;if(((s=e==null?void 0:e.audit)==null?void 0:s[Yv])===!1)return;let{extension:n}=dt({name:Yv,element:r}),a=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(a!=null&&a.length)){let c=r.structures.find(u=>u.stage===Ae);if(c){let u=(l=Qt({structure:c}).positionAssignments)==null?void 0:l.map(({drawPosition:d,participantId:p,bye:m,qualifier:h})=>({drawPosition:d,participantId:p,qualifier:h,bye:m}));a.push({name:"initialMainAssignments",initialAssignments:u})}}let o={value:a.concat(i),name:Yv};Ct({element:r,extension:o})}function Og({tournamentRecord:t,drawDefinition:e,event:i}){var s;let r=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],n={},a={},o=r.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of o){let{structures:c,structureId:u}=l??{};c&&u&&(n[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:n,containerStructures:a}}var Qp="SINGLES",vi="SINGLES",Fd="DOUBLES",ri="DOUBLES",zs="TEAM",ci="TEAM",Cae={SINGLES_MATCHUP:Qp,SINGLES:vi,DOUBLES_MATCHUP:Fd,DOUBLES:ri,TEAM_MATCHUP:zs,TEAM:ci};function LT(t){var a;let{sides:e,matchUpType:i}=t||{},r=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===ri?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],n=(e||[]).map(o=>{var s;return i===ri&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:n.concat(r).flat(),enteredIndividualParticipantIds:n,potentialIndividualParticipantIds:r}}function lo(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}var jy="SIGN_IN_STATUS",sz="SIGNED_OUT",OI="SIGNED_IN",Ja="TEAM",It="INDIVIDUAL",Oa="GROUP",ot="PAIR",Kt="TEAM",Jv={TEAM_PARTICIPANT:Ja,INDIVIDUAL:It,GROUP:Oa,TEAM:Kt,PAIR:ot},lz={INDIVIDUAL:It,GROUP:Oa,PAIR:ot,TEAM:Kt,SIGN_IN_STATUS:jy,SIGNED_OUT:sz,SIGNED_IN:OI};function AA({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?ke(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===Kt),o=n.filter(l=>l.participantType===Oa),s=n.filter(l=>l.participantType===ot);return n.forEach(l=>{if(l.participantType===It){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),r.get(u.participantId)||r.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}var em=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function uz({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let c=em.find(({iso:u})=>u===l);i&&(c!=null&&c.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&(c!=null&&c.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}a.forEach(o)}function Mae({participantMap:t,template:e}){var r;let i=Object.values(t);for(let n of i){let a=n.participant;if((r=a.individualParticipantIds)!=null&&r.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Um({template:e,source:s}):s)}}}}function Kc(t){var n;let{tournamentRecord:e,participantId:i}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(r)){let o=(n=a.participants)==null?void 0:n.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Li}}function cz(t){let{tournamentRecord:e,participantId:i}=t;if(i){let n=Kc({tournamentRecord:e,participantId:i});return n.participant??n}return t.element||t.drawDefinition||t.event||t.tournamentRecord||{error:ze}}function Go(t){let{returnPreviousValues:e,itemSubTypes:i,itemType:r}=t,n=cz(t);if(n.error)return n;if(i&&!Array.isArray(i))return{error:le,context:{itemSubTypes:i}};if(!Array.isArray(n.timeItems))return{error:NN};let a=n.timeItems.filter(s=>(s==null?void 0:s.itemType)===r).filter(s=>!(i!=null&&i.length)||i.some(l=>{var c;return(c=s==null?void 0:s.itemSubTypes)==null?void 0:c.includes(l)})).sort((s,l)=>{let c=new Date(s.createdAt||void 0).getTime(),u=new Date(l.createdAt||void 0).getTime();return c-u}),o=a.pop();if(o){let s={timeItem:o,...X};return e&&Object.assign(s,{previousItems:a}),s}else return{info:Nr}}function OA({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Ds};if(!e.timeItems)return{info:Nr};let{timeItem:n,previousItems:a,info:o}=Go({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Gy({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:ni};if(!r.timeItems)return{info:Nr};let{timeItem:n,previousItems:a,info:o}=Go({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function _T({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:fe};if(!e.timeItems)return{info:Nr};let{timeItem:n,previousItems:a,info:o}=Go({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function kA({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:fe};if(!i)return{error:lr};let a=Kc({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Nr};let{timeItem:s,previousItems:l,info:c}=Go({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:c}}var Nae={[Oa]:"groupParticipantIds",[ot]:"pairParticipantIds",[Kt]:"teamParticipantIds"},Aae={[Oa]:"groups",[Kt]:"teams"};function dz({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let c of i.participants??[]){let u=c==null?void 0:c.participantId;u&&xae({participantMap:l,participantId:u})}for(let c of i.participants??[]){let u=ke(c,e,a),{participantId:d,individualParticipantIds:p,participantType:m}=u;if(Object.assign(l[d].participant,u),p&&kae({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:m,participantId:d}),r&&(l[d].participant.signedIn=Oae(u)),n){let{ratings:h,rankings:f,seedings:g}=Rg({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=f,l[d].participant.ratings=h}(s||o)&&uz({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let c=Ut(t)?t:void 0;Mae({participantMap:l,template:c})}return{participantMap:l}}function Oae(t){let{timeItem:e}=Go({itemType:jy,element:t});return(e==null?void 0:e.itemValue)===OI}function kae({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){for(let a of t){let o=i[a].participant;if(o[Nae[r]].push(n),[Kt,Oa].includes(r)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e,p=Aae[r];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(r===ot){let s=t.find(l=>l!==a);i[a].pairIdMap[n]=s,i[a].pairIdMap[s]=n}}}function xae({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[vi]:{...i},[ri]:{...i},[Kt]:{...i},...i}}}function nh({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){var s;if(e)return{participantMap:(s=dz({...t,...r,tournamentRecord:i}))==null?void 0:s.participantMap};let a=ke(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(l=>uz({participant:l,...t}));let o;if((n||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=AA({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let l of a){let{ratings:c,rankings:u}=Rg({participant:l});l.rankings=u,l.ratings=c}return{participants:a,groupInfo:o}}function Nt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:yN};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...X};function s(l){var u,d;let c=(d=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===RI))==null?void 0:d.value;if(c)for(let p of Object.keys(c))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=ke(c[p],!1,!0))}}function Bu({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:yN};let{appliedPolicies:a}=Nt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Zp.message}}var pz="WALKOVER",gB="RETIRED",xA="COMPETITIVE",kI="ROUTINE",xI="DECISIVE",XU="winRatio",Fae={[iu]:{policyName:"Competitive Bands Default",profileBands:{[xI]:20,[kI]:50}}},FA=Fae;function Vu({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=Bu({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[iu])??(o==null?void 0:o[iu])??FA[iu];a.policies[iu]=s}return a}function pp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:fe};let{appliedPolicies:a}=Nt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:Zp==null?void 0:Zp.message}}function Hy({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var s,l,c,u,d,p;e=e??((s=r==null?void 0:r.category)==null?void 0:s.categoryName)??((l=r==null?void 0:r.category)==null?void 0:l.ageCategoryCode),i=i??((c=r==null?void 0:r.category)==null?void 0:c.categoryType)??((u=r==null?void 0:r.category)==null?void 0:u.subType);let{policy:n}=pp({policyType:Wc,tournamentRecord:t,event:r}),a=(d=t?dt({element:t,name:fu}).extension:void 0)==null?void 0:d.value,o=(p=r&&dt({name:fu,element:r}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:n}}}function LA({drawDefinition:t,attributes:e}){let{extension:i}=dt({element:t,name:VS}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:VS,value:r},ST({drawDefinition:t,extension:i}),{entryProfile:r}}function zy({drawDefinition:t}){let{extension:e}=dt({element:t,name:VS});return{entryProfile:(e==null?void 0:e.value)||{}}}var To="ALTERNATE",Wy="CONFIRMED",ua="DIRECT_ACCEPTANCE",qy="FEED_IN",Yy="JUNIOR_EXEMPT",Iu="LUCKY_LOSER",Ky="ORGANISER_ACCEPTANCE",Jy="QUALIFIER",Lae="REGISTERED",Xy="SPECIAL_EXEMPT",Ho="UNGROUPED",mp="UNPAIRED",Af="WILDCARD",yu="WITHDRAWN",ZU=[Wy,ua,Yy,Ky,Xy],mz=[qy,Iu,Jy],hp=[Wy,ua,qy,Yy,Ky,Xy,Af],zo=[Wy,ua,Yy,Iu,Jy,Ky,Xy,Af],hz=[To,Wy,ua,qy,Yy,Iu,Ky,Jy,Lae,Xy,Ho,mp,Af,yu],_ae={ALTERNATE:To,CONFIRMED:Wy,DIRECT_ACCEPTANCE:ua,DIRECT_ENTRY_STATUSES:hp,DRAW_SPECIFIC_STATUSES:mz,EQUIVALENT_ACCEPTANCE_STATUSES:ZU,FEED_IN:qy,JUNIOR_EXEMPT:Yy,LUCKY_LOSER:Iu,ORGANISER_ACCEPTANCE:Ky,QUALIFIER:Jy,SPECIAL_EXEMPT:Xy,STRUCTURE_SELECTED_STATUSES:zo,UNGROUPED:Ho,UNPAIRED:mp,VALID_ENTRY_STATUSES:hz,WILDCARD:Af,WITHDRAWN:yu};function _A({stage:t,drawDefinition:e}){let{entryProfile:i}=zy({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&uA.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return LA({drawDefinition:e,attributes:n}),!0}return r}function $ae({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=zy({drawDefinition:e});return((r=i[t])==null?void 0:r.alternates)||0}function Bae({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=zy({drawDefinition:e});return((r=i[t])==null?void 0:r.wildcardsCount)||0}function CC({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function ah({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var v,I;let m=(I=(v=dt({name:ol,element:p}))==null?void 0:v.extension)==null?void 0:I.value,h=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),f=!n||p.entryStatus&&n.includes(p.entryStatus),g=p.entryStageSequence??1;return h&&(!r||g===r)&&f&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===xi){let{playoffEntries:d,error:p}=Vae({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(m=>!e||m.placementGroup===e)}return c}function Vae({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===gu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=Qe({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===En&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(f=>{var I;let{participantId:g}=f,v=(I=dt({element:f,name:Dc}).extension)==null?void 0:I.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],I=v.groupOrder||t&&v.provisionalOrder;return f.includes(I)||f.push(I),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:I,GEMscore:y}=g,b=v||t&&I,S=[...a??[]].sort(ar).indexOf(b)+1;r.push({entryStage:xi,entryStatus:qy,placementGroup:S,groupingValue:d,participantId:f,GEMscore:y})})})}return{playoffEntries:r}}function jae({stage:t,drawDefinition:e}){return hp.reduce((i,r)=>(CC({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ro({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var h;let a,o=[];n||({structure:n,error:a}=Qe({drawDefinition:i,structureId:r}));let s=Qt({structure:n}).positionAssignments;if(a||!n)return{seedAssignments:[],error:Ti};r||(r=n.structureId);let{stage:l,stageSequence:c}=n,u=l===xi&&i&&ah({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:r,stage:l}),d=u?u.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:n.seedAssignments?o=n.seedAssignments:a=eG;let m=n.seedLimit??((h=n==null?void 0:n.positionAssignments)==null?void 0:h.length);return{seedAssignments:o,stageSequence:c,seedLimit:m,stage:l,error:a}}var Gae=(t,e)=>(t||0)+(e||0);function fz(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&pz||i<=e[xI]&&xI||i<=e[kI]&&kI||xA}function gz({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(Gae)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function Hae(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function vz(t){return t.map(Hae).sort().map(e=>parseFloat(e.toFixed(2)))}function Zy({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Hn};let{score:r,winningSide:n}=i;if(!n)return{error:le};let a=!e&&t&&pp({policyType:iu,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||FA[iu].profileBands,s=gz({score:r}),l=vz([s]),c=fz(l,o),u=Array.isArray(l)?l[0]:l;return{...X,competitiveness:c,pctSpread:u}}function Iz({matchUp:t}){var o,s,l;if(!t)return{error:Hn};if(t&&!t.sides)return{error:zn};if(t&&!t.hasContext)return{error:dT};let e=(o=t.sides??[])==null?void 0:o.map(c=>c==null?void 0:c.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===It}).map(c=>c.participantId).filter(Boolean))??[],r=(((l=t.sides??[])==null?void 0:l.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),n=[...i,...r.flat()].filter(Boolean)??[],a=mt(n.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:r,allRelevantParticipantIds:a,individualParticipantIds:n,sideParticipantIds:e,...X}}var GS="CHECK_IN",HS="CHECK_OUT",zae="SCHEDULE",kg="SCHEDULE.ASSIGNMENT.VENUE",bu="SCHEDULE.ALLOCATION.COURTS",Ld="SCHEDULE.ASSIGNMENT.COURT",$T="SCHEDULE.COURT.ORDER",xg="SCHEDULE.DATE",Wae="COMPLETED.DATE",yz="HOME_PARTICIPANT_ID",bz="SCHEDULE.ASSIGN.OFFICIAL",Fg="SCHEDULE.TIME.SCHEDULED",ts="SCHEDULE.TIME.START",cu="SCHEDULE.TIME.STOP",yl="SCHEDULE.TIME.RESUME",wu="SCHEDULE.TIME.END",$A="SCHEDULE.TIME.MODIFIERS",wz="TO_BE_ANNOUNCED",Uz="NEXT_AVAILABLE",Sz="FOLLOWED_BY",Tz="AFTER_REST",Dz="RAIN_DELAY",qae="NOT_BEFORE",MC=[wz,Uz,Sz,Tz,Dz],Yae="ELIGIBILITY",Kae="REGISTRATION",Jae="SUSPENSION",Xae="MEDICAL",Zae="PENALTY",Pz="SCALE",Rz="RATING",Ez="RANKING",BA="SEEDING",Jc="PUBLISH",ka="PUBLIC",Xc="STATUS",Qae="MODIFICATION",eoe="RETRIEVAL",toe="other",ioe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:MC,AFTER_REST:Tz,ALLOCATE_COURTS:bu,ASSIGN_COURT:Ld,ASSIGN_OFFICIAL:bz,ASSIGN_VENUE:kg,CHECK_IN:GS,CHECK_OUT:HS,COMPLETED_DATE:Wae,COURT_ORDER:$T,ELIGIBILITY:Yae,END_TIME:wu,FOLLOWED_BY:Sz,MEDICAL:Xae,MODIFICATION:Qae,NEXT_AVAILABLE:Uz,NOT_BEFORE:qae,OTHER:toe,PENALTY:Zae,PUBLIC:ka,PUBLISH:Jc,RANKING:Ez,RATING:Rz,RAIN_DELAY:Dz,REGISTRATION:Kae,RESUME_TIME:yl,RETRIEVAL:eoe,SCALE:Pz,SCHEDULE:zae,SCHEDULED_DATE:xg,SCHEDULED_TIME:Fg,SEEDING:BA,START_TIME:ts,STATUS:Xc,STOP_TIME:cu,SUSPENSION:Jae,TIME_MODIFIERS:$A,TO_BE_ANNOUNCED:wz};function oh({matchUp:t}){if(!t)return{error:Hn};if(!t.hasContext)return{error:dT};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:zn};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=Iz({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[GS,HS].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===GS);e==null||e.forEach((s,l)=>{let c=r==null?void 0:r[l],u=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...X}}var Cz={[vi]:[vi,"S"],[ri]:[ri,"D"],[ci]:[ci,"T"],S:[vi,"S"],D:[ri,"D"],T:[ci,"T"]},$i=t=>e=>{let i=Ut(e)&&(e==null?void 0:e.matchUpType)||Ki(e)&&e;return i&&Cz[t].includes(i)};function Xv(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},r=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],n=r.includes(i)?i:r[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>n===l))&&s))==null?void 0:a.averageTimes}function Zv(t){var n;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:r}=t||{};return(n=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:c=360}=o;if(i>l&&i<c)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:n.recoveryTimes}function Mz({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function roe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&Zv({...e,averageMinutes:i,matchUpFormat:n}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&Zv({...t,averageMinutes:i,matchUpFormat:n}),u=(s==null?void 0:s.matchUpRecoveryTimes)&&Zv({...s,averageMinutes:i,matchUpFormat:n}),d=[l,c,u,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,r==null?void 0:r.recoveryTimes];return Mz({categoryName:a,categoryType:o,timesBlockArray:d})}function noe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&Xv({...a,matchUpFormat:t}),l=(n==null?void 0:n.matchUpAverageTimes)&&Xv({...n,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&Xv({...o,matchUpFormat:t}),u=[s,l,c,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,r==null?void 0:r.averageTimes];return Mz({categoryName:e,categoryType:i,timesBlockArray:u})}var Nz="DOUBLES_SINGLES",Az="SINGLES_DOUBLES",Do="total",NC="participantConflict",sc="matchUpConflict",Oz="ISSUE_IDS",md="CONFLICT",hd="WARNING",AC="ERROR",OC="ISSUE",QU="STATE",aoe={SINGLES_DOUBLES:Az,DOUBLES_SINGLES:Nz,TOTAL:Do,CONFLICT_MATCHUP_ORDER:sc,CONFLICT_PARTICIPANTS:NC,SCHEDULE_ISSUE_IDS:Oz,SCHEDULE_CONFLICT:md,SCHEDULE_WARNING:hd,SCHEDULE_ERROR:AC,SCHEDULE_ISSUE:OC,SCHEDULE_STATE:QU};function Qy({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:fe};o=o??(s==null?void 0:s.eventType)??wm;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=Hy({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),u={...c,matchUpFormat:r,categoryType:a,defaultTiming:l};return BT({eventType:o,timingDetails:u})}function BT({timingDetails:t,eventType:e}){let i=noe(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=roe({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=$i(wm)(e)?Az:Nz,c=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function MU(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Zc({visibilityThreshold:t,timeItems:e,itemType:i}){let r=e.filter(a=>a&&a.itemType===i&&(!t||MU(a)<new Date(t).getTime())).sort((a,o)=>MU(a)-MU(o)).pop(),n=r&&MU(r);return{itemValue:r==null?void 0:r.itemValue,timeStamp:n}}function kC({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:Fg,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:n}:i}function _d({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:xg,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:n}:i}function kz({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:bu,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:ke(n,!1,!0)}:i}function xz({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:Ld,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:n}:i}function Fz({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:kg,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:n}:i}function VA({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:$A,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:n}:i}function Bp(t){if(DH.test(t)){let e=XN();return new Date(`${e}T${t}`)}else return new Date(t)}function ooe({matchUp:t}){if(!t)return{error:Hn};if(!t.timeItems)return{error:NN};let e=t.timeItems.filter(r=>[ts,cu,yl,wu].includes(r==null?void 0:r.itemType)).sort((r,n)=>Bp(r.itemValue).getTime()-Bp(n.itemValue).getTime()),i=e.reduce((r,n)=>{var l,c;let a,o=(l=n==null?void 0:n.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((c=n==null?void 0:n.itemType)==null?void 0:c.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case ts:a=0;break;case wu:if(r.lastValue&&[ts,yl].includes(r.lastType)){let u=Bp(n.itemValue).getTime()-Bp(r.lastValue).getTime();a=r.milliseconds+u}else a=r.milliseconds;break;case cu:if([ts,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let u=Bp(n.itemValue).getTime()-Bp(r.lastValue).getTime();a=r.milliseconds+u}else a=r.milliseconds;break;default:a=r.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([ts,yl].includes(i.lastType)){let r=new Date().getTime()-Bp(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:soe(i.milliseconds),relevantTimeItems:e}}function soe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function loe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Zc({timeItems:(r==null?void 0:r.timeItems)||[],itemType:$T,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:n}:i}function uoe({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(r=e.reduce((n,a)=>{let o=a.itemType===ts&&a;return o&&(!n||i(o)<i(n))?o:n},void 0))==null?void 0:r.itemValue}}function coe(t=1){return Re(0,t).map(Vt)}function Vt(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[r&63|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[n&255]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]}function eb(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:le};let n=lo(t);i.venueId||(i.venueId=Vt());let a;for(let o of Object.values(n)){let s=doe({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||lt({topic:IA,payload:{venue:i}}),Ge({...X,venue:a})}function doe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Vt()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:xG}:(i&&Ct({element:r,extension:{value:i,name:AH}}),t.venues.push(r),e||lt({payload:{venue:r,tournamentId:t.tournamentId},topic:IA}),{...X,venue:ke(r)})):{error:ze,info:"missing venue"}:{error:fe}}function ju({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:fe};if(!i)return{error:zc};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(Ly({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=ju({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return eb({tournamentRecord:e,venue:s.venue}),{...X,venue:r}}}return r?{...X,venue:r}:{error:Jm}}function jA({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=ju({tournamentRecords:i,tournamentRecord:r,venueId:n});return ke(a,t,!0)}function sh({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:fe};if(!i)return{error:qm};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...X,court:n,venue:a};if(t){let o=(Ly({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],c=sh({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&eb({tournamentRecord:e,venue:c.venue}),{...X,court:n,venue:a}}}return Q({result:{error:Sg},stack:r})}function Lz(t){return ke(sh(t),!1,!0)}function VT({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:fe};if(!i)return{error:qm};let r=sh({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...X,courtInfo:ke(n,!1,e)}}function Of({tournamentRecord:t,venueId:e}){var o;if(!t)return{error:fe};if(!e)return{error:zc};let i=ju({tournamentRecord:t,venueId:e});if(i.error)return i;let r=(((o=i.venue)==null?void 0:o.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(VT({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),n=i.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(i.venue),a=n&&{...n,courtsInfo:r};return{...X,venueData:ke(a,!1,!0)}}function poe({matchUp:t}){var r;let e=(t==null?void 0:t.timeItems)||[],i=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(r=e.reduce((n,a)=>{let o=a.itemType===wu&&a;return o&&(!n||i(o)>i(n))?o:n},void 0))==null?void 0:r.itemValue}}function qi({event:t,eventId:e}){var n,a;if(!t)return{error:ni};let i=(n=dt({name:No,element:t}))==null?void 0:n.extension,r=e?ke(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=r==null?void 0:r.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:r}}function An(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(r){let c,u=s.find(d=>{var m,h,f;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(p)c=p,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((m=qi({event:d}))==null?void 0:m.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...Q({result:{error:sa},stack:n})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...Q({result:{error:Pa},context:{drawId:r,eventId:i},stack:n})}}function jT(t){let{visibilityThreshold:e,timeStamp:i,schedule:r,matchUp:n}=t,a=it(t,[{[Yl]:!0}]);if(a.error)return a;let{itemValue:o,timeStamp:s}=Zc({timeItems:(n==null?void 0:n.timeItems)||[],itemType:yz,visibilityThreshold:e});return!r||s&&i&&new Date(s).getTime()>new Date(i).getTime()?{homeParticipantId:o}:r}function GT(t){var w,U,T,P,R,D,E,N,A;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:r,afterRecoveryTimes:n,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:Hn};if(n&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let M=(w=e==null?void 0:e.drawDefinitions)==null?void 0:w.find(O=>O.drawId===u.drawId);!M&&a&&({drawDefinition:M,event:e}=An({tournamentRecord:a,drawId:u.drawId}));let C=u.structureId&&((U=M==null?void 0:M.structures)==null?void 0:U.find(({structureId:O})=>O===u.structureId));i=t.matchUpType||(C==null?void 0:C.matchUpType)||(M==null?void 0:M.matchUpType)||(e==null?void 0:e.eventType)!==or&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=ooe({matchUp:u}),{startTime:m}=uoe({matchUp:u}),{endTime:h}=poe({matchUp:u}),f,{visibilityThreshold:g,eventIds:v,drawIds:I}=r??{};if((!v||v.includes(u.eventId))&&(!I||I.includes(u.drawId))){let M={matchUp:u,visibilityThreshold:g},{allocatedCourts:C}=kz(M),{homeParticipantId:O}=jT(M),{scheduledTime:k}=kC(M),{timeModifiers:x}=VA(M),{scheduledDate:F}=_d(M),{venueId:$}=Fz(M),{courtId:_}=xz(M),{courtOrder:L}=loe(M),B,V,G,j,H,W=u.matchUpType??i;if(s&&k&&n&&W){let ie={matchUpFormat:u.matchUpFormat??l,...s};({averageMinutes:V=0,recoveryMinutes:G=0,typeChangeRecoveryMinutes:j=0}=BT({timingDetails:ie,eventType:W})),(V||G)&&(B=h?Vn(mi(h),G):Vn(k,V+G)),j&&(H=h?Vn(mi(h),j):Vn(k,V+j))}!F&&k&&(F=ut(k));let Y=kS({scheduledDate:F,scheduledTime:k}),q={},re=((T=a&&$&&Of({tournamentRecord:a,venueId:$}))==null?void 0:T.venueData)||{};$&&(q[$]=re);let{venueName:K,venueAbbreviation:z,courtsInfo:te}=re,J=(P=_&&(te==null?void 0:te.find(ie=>ie.courtId===_)))==null?void 0:P.courtName;for(let ie of C||[]){if(!a)break;ie.venueId&&!q[ie.venueid]&&(q[ie.venueId]=(R=Of({venueId:ie.venueId,tournamentRecord:a}))==null?void 0:R.venueData);let ne=q[ie.venueId];ie.venueName=ne==null?void 0:ne.venueName;let ue=(D=ne==null?void 0:ne.courtsInfo)==null?void 0:D.find(ae=>ae.courtId===ie.courtId);ie.courtName=ue==null?void 0:ue.courtName}f=Ge({typeChangeTimeAfterRecovery:H,timeAfterRecovery:B,scheduledDate:F,scheduledTime:k,isoDateString:Y,allocatedCourts:C,homeParticipantId:O,timeModifiers:x,venueAbbreviation:z,venueName:K,venueId:$,courtOrder:L,courtName:J,courtId:_,typeChangeRecoveryMinutes:j,recoveryMinutes:G,averageMinutes:V,milliseconds:d,startTime:m,endTime:h,time:p})}else f=Ge({milliseconds:d,startTime:m,endTime:h,time:p});let{scheduledDate:y}=_d({matchUp:u}),{scheduledTime:b}=kC({matchUp:u});if(o&&((E=c==null?void 0:c.displaySettings)!=null&&E.draws)){let M=c.displaySettings.draws,C=(N=(M==null?void 0:M[u.drawId])??(M==null?void 0:M.default))==null?void 0:N.scheduleDetails;if(C){let O=(A=C.find(k=>{var x;return y&&((x=k.dates)==null?void 0:x.includes(y))})??C.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:A.attributes;if(O){let k=Object.assign({},...Object.keys(f).map(x=>({[x]:!0})),O);f=Um({source:f,template:k})}}}let S=u.matchUpStatus&&fr.includes(u.matchUpStatus)&&(ut(h)||ut(y)||ut(b))||void 0;return{schedule:f,endDate:S}}function Ns(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function Qv({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(l=>t.tieFormatId===l.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function un({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:Qv({item:i,drawDefinition:t,structure:e,event:r})||Qv({item:e,drawDefinition:t,structure:e,event:r})||Ns(t)||Ns(r)}}function moe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function Jr({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=o;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{r.push(u),u.tieMatchUps&&r.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function $d({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(c=>Object.assign(ke(c,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}function _z({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Ar(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(ar);return i.map(n=>r.indexOf(n)+1)}function HT(t){if(!Ut(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>rt(a)||a===void 0||a===null);return r&&n}function uo(t){return Array.isArray(t)?t.every(HT):!1}function wn({matchUps:t=[],interpolate:e}){var d;if(!uo(t))return{roundMatchUps:[],error:le};let i=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Je(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(ar).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===ci)?m.filter(({matchUpType:g})=>g===ci):m,f=g=>g.sort((v,I)=>ar(v.roundPosition,I.roundPosition));return{[p]:f(h)}}),r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Je(m.roundNumber):m.roundNumber;return p[h]||(p[h]=Ge({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),n=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(n).map(h=>Je(h)).filter(h=>!isNaN(h))),m=(d=n[p])==null?void 0:d.length;if(m>1&&hs(m)){let h=p+1,f=h+m/2;Re(h,f).forEach((g,v)=>{n[g]=Re(0,m/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(n).map(p=>{var g,v,I;let m=(g=n[p])==null?void 0:g.length,h=(I=(v=n[p])==null?void 0:v.filter(y=>{var b;return!fr.includes(y.matchUpStatus)&&!((b=y.score)!=null&&b.scoreStringSide1)}))==null?void 0:I.length,f=m&&m===h;return a=Math.max(a,m),{[p]:{matchUpsCount:m,inactiveCount:h,inactiveRound:f}}})),s=0,l=0,c=Object.keys(n).map(p=>Je(p)).filter(p=>!isNaN(p));c.forEach(p=>{var f,g,v,I,y;let m=n[p].sort((b,S)=>b.roundPosition-S.roundPosition),h=m.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(f=r[p])==null?void 0:f.finishingRound,o[p].roundName=(g=r[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=r[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(y=(I=n[p])==null?void 0:I[0])==null?void 0:y.finishingPositionRange,p===1||!o[p-1]){let b=h.sort(ar),S=Ar(b,2);o[p].drawPositions=b,o[p].pairedDrawPositions=S}else{let b=o[p-1],S=b.drawPositions,w=b.matchUpsCount/o[p].matchUpsCount,U=Ar(S,w),T=m.map(P=>{let{roundPosition:R}=P,D=[...P.drawPositions||[],void 0,void 0].slice(0,2);if(!R)return D;let E=(D==null?void 0:D.filter(Boolean))||[];if(!(E!=null&&E.length))return[void 0,void 0];if(p<3&&(E==null?void 0:E.length)===2)return D==null?void 0:D.slice().sort(ar);let N=Vi(S,E).length!==(E==null?void 0:E.length);if(E!=null&&E.length&&N)return(E==null?void 0:E.length)===1?[E[0],void 0]:D==null?void 0:D.slice().sort(ar);let A=(R-1)*2;return U.slice(A,A+2).map(M=>E==null?void 0:E.find(C=>M.includes(C)))});o[p].drawPositions=T==null?void 0:T.flat(),o[p].pairedDrawPositions=T}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let u=!!Object.values(o).find(({matchUpsCount:p})=>!hs(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:n,roundNumbers:c,roundProfile:o,...X}}function eS(t){if(!Array.isArray(t))return"";let e=t.filter(Mi);return e.length?mt([Math.min(...e),Math.max(...e)]).join("-"):""}function hoe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:xe};if(!e)return{error:Aa};let{structure:r}=Qe({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==Wr)return{error:lp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=$d({structureId:d,matchUpsMap:i}),m=wn({matchUps:p}).roundProfile;return{[d]:m}})),l=$d({matchUpsMap:i,structureId:e}),{roundProfile:c}=wn({matchUps:l}),u={};return a==null||a.forEach(d=>{var E,N,A;let{structureId:p,roundNumber:m}=d.source,{feedProfile:h,groupedOrder:f,positionInterleave:g,roundNumber:v}=d.target,I=s[p],y=(E=I[1])==null?void 0:E.drawPositions,b=(N=I[m])==null?void 0:N.matchUpsCount;if(!b)return;let S=b?y.length/b:0,w=y.length/S,U=y.slice(),T=_z({roundPositionsCount:w,groupedOrder:f}),P=(T==null?void 0:T.length)||1;if(P<=w){let M=y.length/P,C=Ar(U,M);h===xd&&C.forEach(O=>O.reverse()),U=(T==null?void 0:T.length)&&(T==null?void 0:T.map(O=>C[O-1]).flat())||U}let R=Ar(U,S);if(g){let M=Re(0,g.interleave).map(()=>{}),C=Re(0,g.offset).map(()=>{});R=R.map(k=>[k,...M]),R.unshift(C),R=R.flat(1);let O=R.length-g.offset;R=R.slice(0,O)}u[v]||(u[v]={});let D=(A=c==null?void 0:c[v])!=null&&A.feedRound?2:1;R.forEach((M,C)=>{let O=1+C*D;u[v][O]||(u[v][O]=eS(M))})}),{sourceDrawPositionRanges:u}}function foe({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let r=[void 0,void 0];if(aH(t))return{orderedDrawPositions:r,displayOrder:r};let n=e==null?void 0:e[i],a=((s=n==null?void 0:n.pairedDrawPositions)==null?void 0:s.find(l=>bn(l||[],t.filter(Boolean))))??r,o=n==null?void 0:n.feedRound;if(nH(t)){let l=[...t].sort(ar);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(c=>!isNaN(Je(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function zS({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;r.includes(l)||(c&&n.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),r=r.filter(d=>d!==c),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function ko({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:fe};if(!Array.isArray(i)||i.length>2)return{error:na};if(!i.length)return Q({result:{error:Hc},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===ot&&Vi(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return Q({result:{error:Li},stack:r});let o=ke(n.slice(1),!1,!0);return{participant:ke(a),duplicatedPairParticipants:o,...X}}function Bd({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:xe};if(typeof e!="string")return{error:lr};let{extension:i}=dt({element:t,name:hu});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function goe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:m})=>{var g,v,I,y;let{assignedParticipantIds:h,substitutions:f}=zS({collectionPosition:i,collectionId:o,lineUp:p});if(l===ri){if((h==null?void 0:h.length)<=2){let b=(v=(g=n==null?void 0:n[h[0]])==null?void 0:g.pairIdMap)==null?void 0:v[h[1]],S=(y=b&&((I=n[b])==null?void 0:I.participant)||ko({participantIds:h,tournamentParticipants:t}).participant)==null?void 0:y.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:f}}}else if((h==null?void 0:h.length)>2)return{[d]:{teamParticipant:m,substitutions:f}}}else{let b=h==null?void 0:h[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:f}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:m,sideNumber:h}=p,f=p.lineUp||((g=Bd({participantId:m.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return c({attribute:h,lineUp:f,teamParticipant:m})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(r==null?void 0:r.map(d=>{var g,v,I;let p=(g=e.find(y=>y.drawPosition===d))==null?void 0:g.participantId,m=s==null?void 0:s.find(y=>(y==null?void 0:y.drawPosition)===d),h=(m==null?void 0:m.teamParticipant)||p&&((v=n==null?void 0:n[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:y})=>y===p)),f=(m==null?void 0:m.lineUp)||((I=Bd({participantId:p,drawDefinition:a}))==null?void 0:I.lineUp);return c({attribute:d,lineUp:f,teamParticipant:h})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function $z({drawDefinition:t}){if(typeof t!="object")return{error:Xp};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){o[l]||(o[l]=[]),s==="0"&&[Wr,xi].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=c);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(y=>y.structureId===g).stage,I=[v,g,f,h].join("|");if(u[I])return;u[I]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:u,stage:v})}}}function voe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var o;if(!t)return{error:xe};if(!i)return{error:Aa};if(!e){let s=$d({matchUpsMap:r,structureId:i});if({roundProfile:e}=wn({matchUps:s}),!e)return{error:ze}}let n=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,I;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,c=((I=e==null?void 0:e[1])==null?void 0:I.drawPositions)??[],u=Ar(c,c.length/l),d=u.map(eS),p=u.map(y=>y.map(b=>b-n)).map(eS),m=a.map(y=>{var S;if(y>s)return;let b=((S=e==null?void 0:e[y])==null?void 0:S.drawPositions)??[];return Ar(b,b.length/l)}).filter(Boolean),h=Re(0,l).map(y=>m.map(b=>b[y]).flat().filter(Boolean).sort(ar)).map(y=>mt(y)),f=h.map(y=>hne(y).map(eS).join(", ")),g=Object.assign({},...Re(0,l).map(y=>({[y+1]:{firstRoundDrawPositionsRange:d[y],firstRoundOffsetDrawPositionsRange:p[y],possibleDrawPositions:h[y],drawPositionsRange:f[y]}})));return{[s]:g}}))}}function GA({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var a;if(!i)return!1;r=r??i.matchUps??[],t=t??wn({matchUps:r}).roundsNotPowerOf2;let n=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==cp)&&!(i!=null&&i.structures)&&t&&n}function Wn({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Rr&&(!e.length||!i&&!r)}var Bz={[Df]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Ae]:"",[xi]:"P",[We]:"Q",[Wr]:"C"}}},Ioe=Bz;function yoe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var E,N,A;let{roundProfile:n,roundMatchUps:a}=wn({matchUps:r}),{structureAbbreviation:o,stage:s}=i,l=Wn({structure:i}),c=GA({structure:i}),u=i.structures,d={},p=Bz[Df],m=i.stage===We,h=m?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===We).map(({stageSequence:M})=>M??1),0):0,f=(i.stageSequence??1)<h?i.stageSequence??1:"",g=f&&(((E=t==null?void 0:t.affixes)==null?void 0:E.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},I=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},y=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,b=((A=t==null?void 0:t.affixes)==null?void 0:A.roundNumber)||p.affixes.roundNumber,S=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==Ae?s[0]:"",U=(t==null?void 0:t.stageConstants)||p.stageConstants,T=s&&(U==null?void 0:U[s])||w,P=`${g}${T}${f}`,R=n?Object.keys(n):[],D=m&&(U!=null&&U[We])?`${U==null?void 0:U[We]}-`:"";if(u||l||c)Object.assign(d,...R.map(M=>{let C=`${D}${S} ${M}`,O=`${b}${M}`;return{[M]:{roundName:C,abbreviatedRoundName:O}}}));else{let M=m&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...R.map(C=>{if(!(n!=null&&n[C]))return;let{matchUpsCount:O,preFeedRound:k}=n[C],x=O*2,F=(M==null?void 0:M[n==null?void 0:n[C].finishingRound])||M&&`${b}${x}`||v[O]||`${b}${x}`,$=k?`-${y}`:"",_=`${F}${$}`,L=[P,o,_].filter(Boolean).join("-"),B=`${I[O]||`${b}${x}`}${$}`,V=[P,o,B].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:d,roundProfile:n,roundMatchUps:a}}function zT(t){var n,a,o;let e=it(t,[{[Yl]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,r=i==null?void 0:i.matchUpType;if(!r&&((n=i==null?void 0:i.sides)!=null&&n.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;r=s===It&&vi||s===ot&&ri||s===Kt&&Kt||void 0}return{matchUpType:r}}var boe="normal",vB="timed",woe="final",HA="NOAD",tS="SET",Uoe={S:boe,F:woe};function Ln(t){if(typeof t=="string"){let e=t.startsWith("T")&&vB||t.startsWith(tS)&&tS||"";if(e===vB){let i=jz(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===tS)return Soe(t)}}function Soe(t){let e=t.split("-"),i=tb(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&IB(e[1]),o=e&&IB(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,c=!e[2]||o,u=a,d=Ge({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&u&&c)return d}function IB(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=Uoe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=yB(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return jz(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&Gz(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?tb(n[1]):void 0,l=Vz(r),c=l!==!1,u=c&&l||s,d=yB(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=u):m.noTiebreak=!0,s&&o&&p&&c&&m||!1}}}function Vz(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?tb(i[1]):i[1])||!1}function yB(t){if(t)if(t.startsWith("TB")){let e=Vz(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&Gz(i[2]),a=!(i!=null&&i[2])||n,o=tb(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!rt(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function jz(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),r=tb(i==null?void 0:i[1]);if(!r)return;let n={timed:!0,minutes:r},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(n.modifier=l,n):void 0}return a&&(n.based=i[2]),n}function Gz(t){return t&&t.indexOf(HA)>=0}function tb(t){return isNaN(Number(t))?0:Number(t)}function WT(t,e){return!Array.isArray(t)||!Ki(e)?!1:Vi(t,Cz[e]).length}function ru(t){if(!Array.isArray(t.matchUps))return[];let{matchUps:e,excludeMatchUpStatuses:i,hasParticipantsCount:r,isCollectionMatchUp:n,matchUpStatuses:a,hasWinningSide:o,matchUpFormats:s,roundPositions:l,matchUpFormat:c,collectionIds:u,isMatchUpTie:d,roundNumbers:p,matchUpIds:m,roundNames:h,filterMatchUpTypes:f=!0,filterMatchUpIds:g=!0,stageSequences:v,scheduledDates:I,scheduledDate:y,participantIds:b,processContext:S,tournamentIds:w,matchUpTypes:U,structureIds:T,readyToScore:P,courtIds:R,eventIds:D,venueIds:E,drawIds:N,stages:A}=t,M=Array.isArray(b)?b.filter(Boolean):[],C=Array.isArray(a)?a.filter(Boolean):[],O=Array.isArray(i)?i.filter(Boolean):[],k=Array.isArray(A)?A.filter(Boolean):[],x=Array.isArray(v)?v.filter(Boolean):[],F=Array.isArray(u)?u.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],_=Array.isArray(p)?p.filter(Boolean):[],L=Array.isArray(l)?l.filter(Boolean):[],B=Array.isArray(m)&&g?m.filter(Boolean):[],V=Array.isArray(U)&&f?U.filter(Boolean):[],G=Array.isArray(R)?R.filter(Boolean):[],j=Array.isArray(E)?E.filter(Boolean):[],H=Array.isArray(s)&&s.filter(Boolean)||typeof c=="string"&&[c]||[],W=Array.isArray(I)&&I.filter(Boolean)||typeof y=="string"&&y.length&&[y]||[],Y=Array.isArray(w)?w.filter(Boolean):[],q=Array.isArray(D)?D.filter(Boolean):[],re=Array.isArray(N)?N.filter(Boolean):[],K=Array.isArray(T)?T.filter(Boolean):[];return e.filter(z=>{var te;if(P&&!$i(zs)(z)&&!z.readyToScore||z.winningSide&&o&&![1,2].includes(z.winningSide)||d!==void 0&&(d&&!z.tieMatchUps||!d&&z.tieMatchUps)||n!==void 0&&(n&&!z.collectionId||!n&&z.collectionId)||k.length&&!k.includes(z.stage)||x.length&&!x.includes(z.stageSequence)||F.length&&(!z.collectionId||!F.includes(z.collectionId))||$.length&&(!z.roundName||!$.includes(z.roundName))||_.length&&(!z.roundNumber||!_.includes(z.roundNumber))||L.length&&(!z.roundPosition||!L.includes(z.roundPosition))||C.length&&(!z.matchUpStatus||!C.includes(z.matchUpStatus))||O.length&&z.matchUpStatus&&O.includes(z.matchUpStatus)||B.length&&!B.includes(z.matchUpId)||V.length&&(!z.matchUpType||!WT(V,z.matchUpType))||H.length&&(!z.matchUpFormat||!H.includes(z.matchUpFormat)))return!1;if(W!=null&&W.length){let{scheduledTime:J}=kC({matchUp:z}),{scheduledDate:ie}=_d({matchUp:z}),ne=ut(J)||ie;if(!W.find(ue=>Ol(ue,ne)))return!1}if(G.length){let{courtId:J}=xz({matchUp:z}),{allocatedCourts:ie}=kz({matchUp:z}),ne=ie==null?void 0:ie.map(({courtId:ue})=>ue);if(!G.filter(Boolean).includes(J)||ne!=null&&ne.includes(J))return!1}if(j.length){let{venueId:J}=Fz({matchUp:z});if(!j.filter(Boolean).includes(J))return!1}if(S){if(Y.length&&!Y.includes(z.tournamentId)||q.length&&!q.includes(z.eventId)||re.length&&!re.includes(z.drawId)||K.length&&!K.includes(z.structureId))return!1;let J=((te=z.sides)==null?void 0:te.map(({participantId:ie})=>ie).filter(Boolean))??[];if(r&&J.length<r||M.length&&!M.some(ie=>J.includes(ie)))return!1}return!0})}function Toe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var m,h,f,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),c=a&&t,u=s&&e,d=c?(m=c[a])==null?void 0:m.participantId:l==null?void 0:l.participantId,p=l?Doe({displaySideNumber:r,seedAssignments:n,participantId:d,assignment:l,sideNumber:s}):{...u==null?void 0:u[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let v=(h=c[a])==null?void 0:h.teamParticipant,I=(f=c[a])==null?void 0:f.participant,y=(g=c[a])==null?void 0:g.substitutions;I&&(p.participant=I),y&&(p.substitutions=y),v&&(p.teamParticipant=v)}return p}function Doe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=Poe({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function Poe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var Is="ANY",ti="MALE",Gn="MIXED",Pd="OTHER",yi="FEMALE",qT={ANY:Is,MALE:ti,FEMALE:yi,MIXED:Gn,OTHER:Pd};function _t({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:m,contextProfile:h,drawDefinition:f,publishStatus:g,context:v={},exitProfiles:I,matchUpsMap:y,structure:b,inContext:S,event:w}){var pe,Se,Be,Pe,at;let U={},T={};if(r=r??(o==null?void 0:o.participants),!b)return{collectionPositionMatchUps:U,error:Gc,roundMatchUps:T,matchUps:[]};let P=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],R=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],D=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],E=!(v!=null&&v.eventId)||!(P!=null&&P.length)&&!((pe=c==null?void 0:c.eventIds)!=null&&pe.filter(Boolean).length)||(P==null?void 0:P.includes(v.eventId))||((Se=c==null?void 0:c.eventIds)==null?void 0:Se.includes(v.eventId)),N=!(R!=null&&R.length)||R.includes(b.structureId),A=!f||!(D!=null&&D.length)||D.includes(f.drawId);if(!E||!N||!A)return{collectionPositionMatchUps:U,roundMatchUps:T,matchUps:[]};h&&!u&&(u=Vu({tournamentRecord:o,contextProfile:h,drawDefinition:f}));let{appliedPolicies:M}=Nt({drawDefinition:f}),C={...e,...M,...a},O=(Be=C==null?void 0:C.scoring)==null?void 0:Be.structures,k=b.stage&&(O==null?void 0:O.stage)&&(O==null?void 0:O.stage[b.stage]),x=b.stageSequence&&(k==null?void 0:k.stageSequence)&&k.stageSequence[b.stageSequence],F=((Pe=C==null?void 0:C.scoring)==null?void 0:Pe.requireAllPositionsAssigned)||(k==null?void 0:k.requireAllPositionsAssigned)||(x==null?void 0:x.requireAllPositionsAssigned);y||(y=Jr({drawDefinition:f,structure:b}));let{positionAssignments:$,allPositionsAssigned:_}=Ur({structure:b}),L=!F||_,{seedAssignments:B}=ro({provisionalPositioning:i,drawDefinition:f,structure:b});s=s??B;let{roundOffset:V,structureId:G,structureName:j,stage:H,stageSequence:W}=b,{drawId:Y,drawName:q,drawType:re}=f??{};I=I||f&&$z({drawDefinition:f}).exitProfiles;let K=I==null?void 0:I[G],z=(K==null?void 0:K.length)&&(K[0].split("-").map(de=>parseInt(de)).reduce((de,Ie)=>de+Ie)||0),te=!!b.structures,J=$d({matchUpsMap:y,structureId:G,inContext:S}),ie=C==null?void 0:C[Df],ne=yoe({roundNamingPolicy:ie,drawDefinition:f,structure:b,matchUps:J}),{roundNamingProfile:ue,roundProfile:ae}=ne;if(T=(ne==null?void 0:ne.roundMatchUps)??[],d&&(J=ru({matchUps:J,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),S){let{sourceDrawPositionRanges:de}=hoe({drawDefinition:f,matchUpsMap:y,structureId:G}),Ie=f?voe({drawDefinition:f,roundProfile:ae,matchUpsMap:y,structureId:G}).drawPositionsRanges:void 0;J=J.map(me=>ce({scheduleVisibilityFilters:t,sourceDrawPositionRanges:de,drawPositionsRanges:Ie,roundNamingProfile:ue,initialRoundOfPlay:z,appliedPolicies:C,usePublishState:l,publishStatus:g,isRoundRobin:te,roundProfile:ae,matchUp:me,event:w})),(J==null?void 0:J.filter(me=>Array.isArray(me.tieMatchUps))).forEach(me=>{let Me=me.tieMatchUps;J=J.concat(...Me)}),c&&(J=ru({processContext:!0,...c,matchUps:J}))}else(J==null?void 0:J.filter(de=>Array.isArray(de.tieMatchUps))).forEach(de=>{let Ie=de.tieMatchUps;J=J.concat(...Ie)});return d&&(J=ru({matchUps:J,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(J=ru({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:J})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||S)&&(T=wn({matchUps:J}).roundMatchUps??[]),(at=un({drawDefinition:f,structure:b,event:w}))!=null&&at.tieFormat&&({collectionPositionMatchUps:U}=moe({matchUps:J})),{collectionPositionMatchUps:U,roundMatchUps:T,isRoundRobin:te,roundProfile:ae,matchUpsMap:y,matchUps:J};function ce({scheduleVisibilityFilters:de,sourceDrawPositionRanges:Ie,drawPositionsRanges:me,initialRoundOfPlay:Me,additionalContext:be,roundNamingProfile:_e,tieDrawPositions:Ne,appliedPolicies:se,isCollectionBye:ge,usePublishState:we,publishStatus:De,matchUpTieId:Le,isRoundRobin:ye,roundProfile:Te,sideLineUps:Ze,matchUp:je,event:ve}){var kv,IU,yU,bU,xv,wU,Fv,UU,SU,TU,DU,_p,Ci,Lv,PU;be=be??{};let qt=(kv=un({drawDefinition:f,structure:b,matchUp:je,event:ve}))==null?void 0:kv.tieFormat,Xi=qt==null?void 0:qt.collectionDefinitions,Ke=je.collectionId&&(Xi==null?void 0:Xi.find(zt=>zt.collectionId===je.collectionId)),At=je.collectionId?Ke==null?void 0:Ke.matchUpFormat:je.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(f==null?void 0:f.matchUpFormat)??(ve==null?void 0:ve.matchUpFormat),Ei=je.matchUpType||(Ke==null?void 0:Ke.matchUpType)||(b==null?void 0:b.matchUpType)||(f==null?void 0:f.matchUpType)||!$i(or)(ve==null?void 0:ve.eventType)&&(ve==null?void 0:ve.eventType),dr=ge?xt:je.matchUpStatus,{schedule:mn,endDate:cl}=GT({scheduleVisibilityFilters:de,afterRecoveryTimes:n,tournamentRecord:o,usePublishState:we,scheduleTiming:m,matchUpFormat:At,publishStatus:De,matchUpType:Ei,matchUp:je,event:ve}),ba=Ne??je.drawPositions??[],{collectionPosition:wa,collectionId:Es,roundPosition:ho}=je,Qr=je.roundNumber??be.roundNumber,dl=Es?goe({tournamentParticipants:r,positionAssignments:$,collectionPosition:wa,drawDefinition:f,participantMap:p,drawPositions:ba,collectionId:Es,sideLineUps:Ze,matchUpType:Ei}):void 0,pl=((IU=_e==null?void 0:_e[Qr])==null?void 0:IU.roundName)||be.roundName,Cs=((yU=_e==null?void 0:_e[Qr])==null?void 0:yU.abbreviatedRoundName)||be.abbreviatedRoundName,hU=(bU=Te==null?void 0:Te[Qr])==null?void 0:bU.feedRound,Ba=(xv=Te==null?void 0:Te[Qr])==null?void 0:xv.preFeedRound,zh=(wU=Te==null?void 0:Te[Qr])==null?void 0:wU.roundFactor,Fp=me==null?void 0:me[Qr],oE=ho?Fp==null?void 0:Fp[ho]:void 0,Ov=Ie==null?void 0:Ie[Qr],sE=Ke!=null&&Ke.category?{...(v==null?void 0:v.category)||{},...Ke.category}:(v==null?void 0:v.category)??(ve==null?void 0:ve.category),Lp=((Fv=je.processCodes)==null?void 0:Fv.length)&&je.processCodes||((UU=Ke==null?void 0:Ke.processCodes)==null?void 0:UU.length)&&(Ke==null?void 0:Ke.processCodes)||((SU=b==null?void 0:b.processCodes)==null?void 0:SU.length)&&(b==null?void 0:b.processCodes)||((TU=f==null?void 0:f.processCodes)==null?void 0:TU.length)&&(f==null?void 0:f.processCodes)||((DU=ve==null?void 0:ve.processCodes)==null?void 0:DU.length)&&(ve==null?void 0:ve.processCodes)||(o==null?void 0:o.processCodes),lE=(h==null?void 0:h.withCompetitiveness)&&Zy({...u,matchUp:je}),fU=je.finishingPositionRange??be.finishingPositionRange,rc=zt=>Ge(zt,void 0,!0),Ht={...rc(v),...rc({matchUpFormat:je.matchUpType===or?void 0:At,tieFormat:je.matchUpType!==or?void 0:qt,gender:(Ke==null?void 0:Ke.gender)??(ve==null?void 0:ve.gender),roundOfPlay:H!==We&&rt(Me)&&Me+(Qr||0),endDate:je.endDate??cl,discipline:ve==null?void 0:ve.discipline,category:sE,finishingPositionRange:fU,abbreviatedRoundName:Cs,drawPositionsRange:oE,competitiveProfile:lE,structureName:j,stageSequence:W,drawPositions:ba,matchUpStatus:dr,processCodes:Lp,isRoundRobin:ye,matchUpTieId:Le,preFeedRound:Ba,matchUpType:Ei,roundFactor:zh,roundOffset:V,structureId:G,roundNumber:Qr,feedRound:hU,roundName:pl,drawName:q,drawType:re,schedule:mn,drawId:Y,stage:H}),...ke(rc(je),!0,!0)};if(At&&((_p=je.score)!=null&&_p.scoreStringSide1)){let zt=Ln(At),{bestOf:ln,finalSetFormat:Ye,setFormat:pt}=zt??{};(Ye!=null&&Ye.tiebreakSet||pt!=null&&pt.tiebreakSet||pt!=null&&pt.timed)&&(Ht.score.sets=Ht.score.sets.sort((Jt,pr)=>Jt.setNumber-pr.setNumber).map((Jt,pr)=>(pr+1===ln?(Ye!=null&&Ye.tiebreakSet||Ye!=null&&Ye.timed)&&(Jt.tiebreakSet=!0):(pt!=null&&pt.tiebreakSet||pt!=null&&pt.timed)&&(Jt.tiebreakSet=!0),Jt)))}if(Array.isArray(ba)){let{orderedDrawPositions:zt,displayOrder:ln}=foe({drawPositions:ba,roundProfile:Te,roundNumber:Qr}),Ye=(Ci=Te==null?void 0:Te[Qr])==null?void 0:Ci.feedRound,pt=ln[0]!==zt[0],Jt=zt.concat(void 0,void 0).slice(0,2).map((pr,si)=>{var CU;let bi=si+1,Ua=pt?3-bi:bi,$p=Toe({...dl,positionAssignments:$,displaySideNumber:Ua,seedAssignments:s,drawPosition:pr,isFeedRound:Ye,sideNumber:bi}),nc=(CU=je.sides)==null?void 0:CU.find(uE=>uE.sideNumber===bi),RU=ho?(ho-1)*2+si+1:void 0,EU=RU?Ov==null?void 0:Ov[RU]:void 0;return rc({sourceDrawPositionRange:EU,...nc,...$p})});Object.assign(Ht,ke({sides:Jt},!0,!0))}if(r&&Ht.sides){let zt=se==null?void 0:se[ky],ln=Ye=>{var Jt;let pt=(Jt=p==null?void 0:p[Ye])==null?void 0:Jt.participant;return pt&&Um({template:zt==null?void 0:zt.participant,source:pt})};if(Ht.sides.filter(Boolean).forEach(Ye=>{var pt,Jt,pr;if(Ye.participantId){let si=ke(ln(Ye.participantId)||r&&Tc({policyDefinitions:se,participantId:Ye.participantId,tournamentParticipants:r,internalUse:!0,contextProfile:h}),void 0,!0);if(si){if(f!=null&&f.entries){let bi=f.entries.find(Ua=>Ua.participantId===Ye.participantId);bi!=null&&bi.entryStatus&&(si.entryStatus=bi.entryStatus),bi!=null&&bi.entryStage&&(si.entryStage=bi.entryStage)}Object.assign(Ye,{participant:si})}}if((Jt=(pt=Ye==null?void 0:Ye.participant)==null?void 0:pt.individualParticipantIds)!=null&&Jt.length&&!((pr=Ye.participant.individualParticipants)!=null&&pr.length)){let si=Ye.participant.individualParticipantIds.map(bi=>ln(bi)||r&&Tc({policyDefinitions:se,tournamentParticipants:r,internalUse:!0,contextProfile:h,participantId:bi}));Object.assign(Ye.participant,{individualParticipants:si})}}),!Ht.matchUpType){let{matchUpType:Ye}=zT({matchUp:Ht});Ye&&Object.assign(Ht,{matchUpType:Ye})}if(h!=null&&h.inferGender&&(!Ht.gender||Ht.gender===Gn)&&((Lv=Ht.sides)==null?void 0:Lv.length)===2&&Ht.matchUpType!==or){let Ye=Ht.sides.map(pt=>{var Jt,pr,si,bi;if($i(vi)(Ht.matchUpType))return(pr=(Jt=pt.participant)==null?void 0:Jt.person)==null?void 0:pr.sex;if(((bi=(si=pt.participant)==null?void 0:si.individualParticipants)==null?void 0:bi.length)===2){let Ua=mt(pt.participant.individualParticipants.map($p=>{var nc;return(nc=$p.person)==null?void 0:nc.sex})).filter(Boolean);if(Ua.length===1)return Ua[0]}});if(Ye.filter(Boolean).length===2&&mt(Ye).length===1){let pt=Ye[0];Ht.inferredGender=pt}}}if(Ht.tieMatchUps){let zt=Ht.matchUpStatus===xt,ln=(PU=Ht.sides)==null?void 0:PU.map(({participant:Ye,drawPosition:pt,sideNumber:Jt,lineUp:pr})=>{let si=(Ye==null?void 0:Ye.participantType)===or&&Ye;return{teamParticipant:si&&Ge({participantRoleResponsibilities:si.participantRoleResponsibilities,participantOtherName:si.participanOthertName,participantName:si.participantName,participantId:si.participantId,teamId:si.teamId}),drawPosition:pt,sideNumber:Jt,lineUp:pr}});Ht.tieMatchUps=Ht.tieMatchUps.map(Ye=>{let pt=Ht.matchUpId,Jt={finishingPositionRange:Ht.finishingPositionRange,abbreviatedRoundName:Cs,roundNumber:Qr,roundName:pl};return ce({tieDrawPositions:ba,scheduleVisibilityFilters:de,sourceDrawPositionRanges:Ie,sideLineUps:ln,drawPositionsRanges:me,initialRoundOfPlay:Me,roundNamingProfile:_e,additionalContext:Jt,appliedPolicies:se,isCollectionBye:zt,usePublishState:we,publishStatus:De,matchUpTieId:pt,isRoundRobin:ye,roundProfile:Te,matchUp:Ye,event:ve})})}let gU=Ht.sides&&Ht.sides.filter(zt=>zt==null?void 0:zt.participantId).length===2,vU=!Ht.winningSide;if(Object.assign(Ht,{readyToScore:L&&gU&&vU,hasContext:!0}),gU){let{allParticipantsCheckedIn:zt,checkedInParticipantIds:ln}=oh({matchUp:Ht});Object.assign(Ht,{allParticipantsCheckedIn:zt,checkedInParticipantIds:ln})}return Array.isArray(h==null?void 0:h.exclude)&&(h==null||h.exclude.forEach(zt=>delete Ht[zt])),Ht}}function Ed({matchUp:t}){return t?fr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function YT({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:m,contextProfile:h,drawDefinition:f,exitProfiles:g,matchUpsMap:v,structureId:I,inContext:y,structure:b,context:S,event:w}){!b&&I&&({structure:b}=Qe({drawDefinition:f,structureId:I}));let U=_t({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:m,contextProfile:h,drawDefinition:f,exitProfiles:g,matchUpsMap:v,structure:b,inContext:y,context:S,event:w}),T=[],P=[],R=[],D=[],E=[];if(U.error)return U;let{matchUps:N}=U,{assignedPositions:A}=Ur({structure:b}),M=A==null?void 0:A.filter(O=>O.participantId).map(O=>O.drawPosition),C;return N.filter(O=>{var x;let k=((x=l==null?void 0:l.matchUpTypes)==null?void 0:x.length)===1&&l.matchUpTypes[0]===ci;return!(O.matchUpType!==ci&&k)}).forEach(O=>{var V,G,j,H;if(O.matchUpStatus===Ea){T.push(O);return}O.matchUpType===ci&&(C=!0);let k=O.collectionId,x=k&&((V=O.sides)==null?void 0:V.every(W=>W.participantId)),F=!k&&((G=O.drawPositions)==null?void 0:G.filter(Boolean).length)===2,$=!k&&((j=O.drawPositions)==null?void 0:j.every(W=>M==null?void 0:M.includes(W))),_=A==null?void 0:A.filter(W=>W.bye).map(W=>W.drawPosition),L=!k&&((H=O.drawPositions)==null?void 0:H.find(W=>_==null?void 0:_.includes(W))),B=HH.includes(O.matchUpStatus)&&(x||F&&(!t||$));return L?E.push(O):Ed({matchUp:O})?P.push(O):B?R.push(O):D.push(O)}),{includesTeamMatchUps:C,abandonedMatchUps:T,completedMatchUps:P,upcomingMatchUps:R,pendingMatchUps:D,byeMatchUps:E,structure:b}}function Roe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:xe};if(!i)return{error:Aa};let{links:r}=Lg({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function cE({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var a;let n=r.find(o=>{var l,c;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||bn(t,(c=o.source)==null?void 0:c.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[vu,kl].includes(n==null?void 0:n.linkType)&&!((a=n==null?void 0:n.source)!=null&&a.roundNumber)?Q({result:{error:le},stack:"getTargetLink",context:n}):n}function Lg({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:Aa}:{error:xe}}function Eoe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function dE({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var P;if(!n)return{error:mN};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:c}}=n,{structure:u}=Qe({drawDefinition:r,structureId:a}),{positionAssignments:d}=Qt({structure:u}),p=(e==null?void 0:e.filter(R=>R.structureId===(u==null?void 0:u.structureId))).filter(R=>R.roundNumber===l&&!R.matchUpTieId),m=p.length,h=Re(1,m+1),f=m/t,g=Math.ceil(f*i),v=1-i%2;if(c!=null&&c.interleave&&f!==.5){let R=c.offset+(i-1)*c.interleave,D=i+R;g=Math.ceil(D/2),v=1-D%2}let I=h,y=h[g-1],b=_z({roundPositionsCount:h.length,groupedOrder:s}),S=(b==null?void 0:b.length)||1;if(S<=h.length){let R=m/S,D=Ar(h,R);o===xd&&D.forEach(E=>E.reverse()),I=(b==null?void 0:b.length)&&(b==null?void 0:b.map(E=>D[E-1]).flat())||I}o===wo?y=I[g-1]:o===xd?((!(b!=null&&b.length)||S>h.length)&&(g=p.length+1-g),y=I[g-1]):o===MT&&Ra()&&console.log(hT,{feedProfile:o});let w=y&&p.reduce((R,D)=>D.roundPosition===y?D:R,void 0),U;w!=null&&w.feedRound?(v=0,U=Math.min(...(w.drawPositions||[]).filter(Boolean))):U=((P=w==null?void 0:w.drawPositions)==null?void 0:P.length)===2&&(w==null?void 0:w.drawPositions[v]);let T=d==null?void 0:d.find(({drawPosition:R})=>R===U);if(T){let{extension:R}=dt({element:T,name:PT});if(R!=null&&R.value)return{disabledDrawPosition:U}}return{matchUp:w,targetDrawPosition:U,matchUpDrawPositionIndex:v}}function Un({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=Qe({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===th?Coe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):Moe({matchUp:a})}function Coe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var E,N,A;let{winnerMatchUpId:a,loserMatchUpId:o}=n,{links:s}=Roe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),l=s==null?void 0:s.source,c=cE({source:l,linkType:vu}),u=cE({linkCondition:xl,linkType:kl,source:l}),d=cE({source:l,linkType:kl}),p=u&&d;d||(d=u);let m=(E=c==null?void 0:c.target)==null?void 0:E.feedProfile,h=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,f=(A=u==null?void 0:u.target)==null?void 0:A.feedProfile,g,v,I,y,b,S,w,U,T,P;if(e&&(a||o)&&(w=a&&m!==yo&&t.find(({matchUpId:M})=>M===a),y=o&&h!==yo&&t.find(({matchUpId:M})=>M===o),w||y))return{matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:y,winnerMatchUp:w}};let{roundPosition:R}=n;P=P||t.filter(M=>M.structureId===r.structureId);let D=P.reduce((M,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?M+1:M,0);return d&&!y&&h!==yo&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:y}=dE({targetLink:d,sourceRoundMatchUpCount:D,inContextDrawMatchUps:t,sourceRoundPosition:R,drawDefinition:i})),p&&f!==yo&&({matchUpDrawPositionIndex:I,targetDrawPosition:v,matchUp:g}=dE({targetLink:u,sourceRoundMatchUpCount:D,inContextDrawMatchUps:t,sourceRoundPosition:R,drawDefinition:i})),c&&!w&&m!==yo&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=dE({targetLink:c,sourceRoundMatchUpCount:D,inContextDrawMatchUps:t,sourceRoundPosition:R,drawDefinition:i})),w||(P=P||t.filter(M=>M.structureId===r.structureId),{matchUp:w}=Eoe({structureMatchUps:P,matchUp:n})),Ge({matchUp:n,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:T,loserMatchUpDrawPositionIndex:S,byeMatchUpDrawPositionIndex:I,winnerTargetDrawPosition:U,loserTargetDrawPosition:b,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:y,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function Moe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function Noe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var l,c,u,d,p,m;let{matchUpId:n,structureId:a,drawPositions:o=[]}=r,{structure:s}=Qe({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===Ag){let{roundNumber:h}=r,f=h&&Je(h)+1,g=s.matchUps??[],{roundMatchUps:v}=wn({matchUps:g});if(f&&(v!=null&&v[f])){let I=[...o].sort(ar).map((y,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(y)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:s.structureName}});Object.assign(r,{sidesTo:I})}}else{let h=Un({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:n}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=pE({upcomingMatchUp:f}),I=pE({upcomingMatchUp:g});if(r.matchUpStatus!==xt&&(g==null?void 0:g.matchUpStatus)===xt){let{matchUp:b}=Hz({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};I=b&&pE({upcomingMatchUp:b})||I}let y=(l=r.schedule)==null?void 0:l.timeAfterRecovery;if(y&&((c=v==null?void 0:v.schedule)!=null&&c.scheduledTime&&Dt(v.schedule.scheduledTime)<Dt(y)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(u=I==null?void 0:I.schedule)!=null&&u.scheduledTime&&Dt(I.schedule.scheduledTime)<Dt(y)&&(i[I.matchUpId]=r.matchUpId,I.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:I}),(d=r.drawPositions)==null?void 0:d.filter(Boolean).length){let b=((m=(p=h.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:m.linkCondition)===xl,S=Aoe(r);if(S.length){let w=PC(f==null?void 0:f.sides),U=PC(g==null?void 0:g.sides),T=S.find(({participantId:R})=>w.includes(R))?[]:S,P=S.find(({participantId:R})=>U.includes(R))?[]:S;g&&b&&P.length<2&&P.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:R})=>R===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),P!=null&&P.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:R})=>R===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(P))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Aoe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function Hz({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:r,matchUpStatus:n,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===ji)return{matchUp:t};if(n===xt){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=Un({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:o.targetMatchUps)||{},Hz({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function pE(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function ur(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=_g(t);if(i.error)return Q({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function _g(t){if(!(t!=null&&t.drawDefinition))return{error:xe};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:I,nextMatchUps:y,inContext:b,context:S,event:w}=t,U=[],T=[],P=[],R=[],D=[];v&&!i&&(i=Vu({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let E;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(b||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:E}=AA({participants:e,participantsProfile:s})));let{structures:N}=Oo({drawDefinition:I});if(!N)return{error:Ti};r||(r=Jr({drawDefinition:I}));let A=I&&$z({drawDefinition:I}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=YT({matchUpFilters:y?void 0:m,contextFilters:y?void 0:p,inContext:b||y||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:I,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),P=P.concat(...F),R=R.concat(...x),D=D.concat(...k)});let M=O=>(!m&&!y&&!p||(m&&(O=ru({matchUps:O,...m})),p&&(O=ru({matchUps:O,...p,processContext:!0}))),O),C={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(P),pendingMatchUps:M(R),byeMatchUps:M(D),matchUpsMap:r,...X,groupInfo:E};if(y){let O=typeof y=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&P||[],...$&&R||[],..._&&D||[]);Noe({inContextDrawMatchUps:L,drawDefinition:I})}return C}function Kl(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:ni};let{eventId:I,eventName:y,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},P={...g,...Ge({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:T,eventName:y,eventType:S,category:w,eventId:I,gender:U})};b&&(P.endDate=b),p&&!i&&(i=Vu({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let R;if(!(e!=null&&e.length)&&!r&&u){let N=nh({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],R=N.groupInfo}let D=v.drawDefinitions??[],E=Hy({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:D.flatMap(N=>{let{matchUps:A}=ur({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:P,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:E,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:R}}function kr(t){let e=it(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:fe};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];r||({participants:r,participantMap:i}=nh({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:I}=Nt({tournamentRecord:c}),y={...f,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},b=Vu({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return y.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,Kl({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:I,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:u,event:S}).matchUps??[]}).concat(...c.matchUps??[])}}function ys({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof r!="object"||!Object.keys(r).length)return{error:Di};let c=Object.keys(r).map(u=>{let d=r[u];return kr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:d,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat();return{...X,matchUps:c}}function lh(t,e){return Ooe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function Ooe(t,e){return(Pm[t==null?void 0:t.stage]||0)-(Pm[e==null?void 0:e.stage]||0)}function vn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:I}=t,{eventId:y,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:P}=I??{},R={...v,surfaceCategory:(I==null?void 0:I.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:P,eventType:w,eventName:b,category:U,eventId:y,endDate:S,gender:T},D;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:D}=nh({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:m,inContext:g})),m&&!r&&(r=Vu({policyDefinitions:l,tournamentRecord:u,contextProfile:m,drawDefinition:h,event:I})),{...ur({context:R,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:I}),groupInfo:D}}function tm({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=ke(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,m]of c.entries())if(l!=null&&l[m]){let h=c.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===c.length-1&&["string","number"].includes(typeof p)){let h=u?p.slice(0,u):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var zz=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=tm({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=tm({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&tm({element:e,accessor:t}))==null?void 0:i.value)},ca=zz;function ib({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var g;if(!uo(a))return[];let{roundProfile:l,roundNumbers:c=[]}=wn({interpolate:!0,matchUps:a});r=r??Math.max(...c,0);let u=n?r-n:0,d=u&&((g=l==null?void 0:l[r-u])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(ca("matchUpsCount")),m=(v,I)=>{let y=Math.min(...v);d&&I&&y===1&&(y=d);let b=Math.max(...v);return e&&b>e&&(b=e),[y,b]},h=l&&Object.assign({},...c.map(v=>{let I=(r??0)+1-v-u,y=l[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:I},S=p==null?void 0:p.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,P=Re(U,o?U+y*2:S+U+T),R=S+T-y,D=m(P.slice(R)),E=m(P.slice(0,R),!0);return b.finishingPositionRange={loser:D,winner:E},{[v]:b}})),f=Ra({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let I=v.roundNumber&&h[v.roundNumber];f&&!I&&console.log({roundFinishingData:h,matchUp:v}),v.finishingRound=I==null?void 0:I.finishingRound,v.finishingPositionRange=I==null?void 0:I.finishingPositionRange}),a}function Vd({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:xe};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=ur({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];ib({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Un({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,m=$d({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(r.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:r}}function Wo(t){var I;let e=lo(t),i=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:n,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:Fu};if(!Array.isArray(r))return{error:Ds};let s=(I=t.matchUpIds)!=null&&I.length?t.matchUpIds:i.map(y=>y.matchUpId);if(!Array.isArray(s))return{error:Wm};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),m=p.reduce((y,b)=>y.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:y})=>y===gu),h=i;if(m.length){h=ys({nextMatchUps:!0,tournamentRecords:e}).matchUps;let y=m.reduce((b,S)=>{var T,P;let w=(T=S.source)==null?void 0:T.structureId,U=(P=S.target)==null?void 0:P.structureId;return w&&U&&(u[U]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of y)l[b]=[];for(let b of h??[]){let S=b.containerStructureId||b.structureId;y.includes(S)&&l[S].push(b.matchUpId)}}let f=y=>{c[y]||(c[y]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[y]=[])},g=(y,b)=>{c[y].matchUpIds.forEach(S=>{c[b].matchUpIds.push(S)}),c[b].matchUpIds.push(y),c[y].dependentMatchUpIds.push(b),n&&c[y].participantIds.forEach(S=>c[b].participantIds.push(S))},v=y=>{let b=Object.keys(l).length;for(let S of y||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!s.length||s.includes(w)){if(f(w),n){let{individualParticipantIds:D}=LT(S);c[w].participantIds=D}U&&(f(U),g(w,U),d[U].push(w)),T&&(f(T),g(w,T),d[T].push(w)),c[w].sources.push(d[w]);let P=d[w].map(D=>c[D].sources[0]).flat(),R=d[w].map(D=>c[D].sources[1]).flat();if(c[w].sources.push(P,R),b){let D=S.containerStructureId||S.structureId,E=u[D];if(l[E])for(let N of l[E])f(N),g(N,w),d[N].push(w)}}}};if(o)Vd({drawDefinition:o}),h!=null&&h.length||(h=vn({drawDefinition:o}).matchUps),v(h);else{if(h!=null&&h.length||(h=ys({nextMatchUps:!0,tournamentRecords:e}).matchUps),!r.length){let y=p!=null&&p.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];y&&(r=y)}for(let y of r){let b=h==null?void 0:h.filter(S=>S.drawId===y).sort(lh);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=An({tournamentRecord:e[S==null?void 0:S.tournamentId],drawId:y});w&&Vd({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:h,...X}}function gr(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),r=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:n,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:c}=r||{},u=n||a||o||s||l||c;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||u)}function rb({matchUpStatus:t}){return jH.includes(t)}function koe({matchUpStatus:t}){return lA.includes(t)}function xC({matchUpStatus:t}){return GH.includes(t)}function zA({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var s;let a=r==null?void 0:r.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter(zA))==null?void 0:s.length;return gr({score:n})||o||e&&a||t&&koe({matchUpStatus:t})&&![Rt,Lt,jo].includes(t)}function nb(t){var U;let{drawDefinition:e,findContainer:i,structureId:r,event:n}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=Og({drawDefinition:e}),l=r?s[r]||[]:[];if(!a){let T=Qe({drawDefinition:e,structureId:r});if(T.error)return T;a=i?T.containingStructure??T.structure:T.structure}if(Wn({structure:a}))return{structure:a,isAdHoc:!0,error:Ig};let{matchUps:c}=ur({inContext:!0,matchUpFilters:o,drawDefinition:e,event:n}),u=c==null?void 0:c.filter(T=>T.structureId===r||l.includes(T.structureId)),{matchUpDependencies:d}=Wo({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],m=[],h={},f=[];for(let T of c??[]){if(T.structureId===r||l.includes(T.structureId)){m.push(...T.drawPositions??[]);let P=T.roundNumber;for(let R of(T.drawPositions??[]).filter(Boolean))(!h[R]||P&&h[R]>P)&&(h[R]=P)}zA(T)&&(f.push(T),p.push(T.matchUpId,...((U=d==null?void 0:d[T==null?void 0:T.matchUpId])==null?void 0:U.matchUpIds)||[]))}let g=mt(m.filter(Boolean)).sort(ar),v=mt(p),I=mt(u==null?void 0:u.map(({matchUpId:T,drawPositions:P})=>v.includes(T)?P:[]).flat().filter(Boolean)).sort(ar),{positionAssignments:y}=Qt({drawDefinition:e,structure:a}),b=y==null?void 0:y.filter(T=>T.bye).map(T=>T.drawPosition),S=y==null?void 0:y.filter(T=>T.qualifier).map(T=>T.drawPosition),w=(g==null?void 0:g.filter(T=>!I.includes(T)))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:h,activeDependentMatchUpIds:v,qualifyingDrawPositions:S,inactiveDrawPositions:w,positionAssignments:y,activeDrawPositions:I,byeDrawPositions:b,activeMatchUps:f,structure:a}}function Rm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(ar)[0]}}var ac={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},WS=[];function Xa(t,e){typeof t=="string"&&(t={method:t}),(e||Ra())&&WS.push(t)}function xoe(t){let e=WS.slice();return t&&(WS.length=0),e}function Foe(t){let e=xoe(t).map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(ac).includes(r)?ac[r]:ac.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=n&&Object.keys(n).includes(u)&&ac[n[u]]?ac[n[u]]:ac.brightwhite;return`${ac.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,c,ac.white,l,ac.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function Loe(){WS.length=0}function xa({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var P,R,D;if(!r)return{error:xe};if(s||({structure:s}=Qe({drawDefinition:r,structureId:o})),!s)return{error:Ti};o||({structureId:o}=s);let c="assignDrawPositionBye";Xa({method:c,color:"cyan",drawPosition:n}),a||(a=Jr({drawDefinition:r}));let{positionAssignments:u}=Qt({structure:s}),{activeDrawPositions:d}=nb({drawDefinition:r,structureId:o});if((P=u==null?void 0:u.find(E=>E.drawPosition===n))!=null&&P.bye)return{...X};if(d!=null&&d.includes(n))return{error:nT};let p=u==null?void 0:u.find(E=>E.drawPosition===n);if(!p)return{error:Ig};let{filled:m,containsBye:h,assignedParticipantId:f}=_oe(p);if(h)return{...X};if(m&&!h)return Q({result:{error:If},stack:c});let g=Nt({tournamentRecord:i,drawDefinition:r,event:l}).appliedPolicies??{},v=ur({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],I={isCollectionMatchUp:!1},{matchUps:y}=_t({provisionalPositioning:t,drawDefinition:r,matchUpFilters:I,matchUpsMap:a,structure:s});if(u==null||u.forEach(E=>{E.drawPosition===n&&(E.bye=!0)}),s.structureType===En)return $oe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:y}),Ec({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),bB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:c});let{roundProfile:b,roundMatchUps:S}=wn({matchUps:y}),w=(R=b&&Object.keys(b).map(E=>parseInt(E)).reverse())==null?void 0:R.find(E=>{var N;return(N=b==null?void 0:b[E].drawPositions)==null?void 0:N.includes(n)}),U=w?S==null?void 0:S[w].find(({drawPositions:E})=>E==null?void 0:E.includes(n)):void 0;U&&Wz({tournamentRecord:i,drawDefinition:r,matchUp:U,event:l});let T=(D=U==null?void 0:U.drawPositions)==null?void 0:D.find(E=>E!==n);if(U&&T){let E=WA({sourceDrawPositions:U.drawPositions,matchUpId:U.matchUpId,inContextDrawMatchUps:v,drawPositionToAdvance:T,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(E.error)return E}return Ec({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),bB({assignedParticipantId:f,isPositionAction:e,appliedPolicies:g,drawDefinition:r,drawPosition:n,structureId:o,stack:c})}function bB({assignedParticipantId:t,isPositionAction:e,appliedPolicies:i,drawDefinition:r,drawPosition:n,structureId:a,stack:o}){return e&&FT({appliedPolicies:i,drawDefinition:r,positionAction:{removedParticipantId:t,drawPosition:n,structureId:a,name:o}}),Q({result:{...X},stack:o})}function _oe(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function Wz({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:xt,score:void 0,winningSide:void 0}),St({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function $oe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&Wz({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function WA({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var y,b;Xa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(S=>S.matchUpId===o),c=(y=e.find(S=>S.matchUpId===o))==null?void 0:y.structureId,{structure:u}=Qe({drawDefinition:n,structureId:c}),{positionAssignments:d}=Qt({structure:u}),p=d==null?void 0:d.filter(S=>S.bye).map(S=>S.drawPosition),m=(b=l==null?void 0:l.drawPositions)==null?void 0:b.find(S=>S!==t),h=m&&(p==null?void 0:p.includes(m)),{targetLinks:{loserTargetLink:f},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:I}}=Un({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(v&&v.structureId===(u==null?void 0:u.structureId)&&Boe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&h&&g.structureId!==(u==null?void 0:u.structureId)){let{roundNumber:S}=g;if(S===1){let w=xa({structureId:f.target.structureId,drawPosition:I,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else qz({loserTargetDrawPosition:I,tournamentRecord:r,loserTargetLink:f,drawDefinition:n,loserMatchUp:g,matchUpsMap:a,event:s})}return{...X}}function Boe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var A,M,C,O,k,x;let l="advanceWinner",c=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),u=(A=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:A.structureId,{structure:d}=Qe({drawDefinition:n,structureId:u}),{positionAssignments:p}=Qt({structure:d}),m=(M=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:M.bye,h=(C=c.drawPositions)==null?void 0:C.filter(Boolean),f=p==null?void 0:p.filter(F=>h==null?void 0:h.includes(F.drawPosition)),g=p==null?void 0:p.find(({drawPosition:F})=>F===t),v=i==null?void 0:i.find(F=>F!==t),I=(O=v&&(f==null?void 0:f.find(({drawPosition:F})=>F===v)))==null?void 0:O.bye,y=m&&I;if(y&&console.log({isByeAdvancedBye:y}),(h==null?void 0:h.length)>1&&m&&!I)return Q({result:{error:If},stack:l});let b=h==null?void 0:h.find(F=>F!==t),S=y,w=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),U=w.map(F=>!F&&!S||F===t?(S=!0,t):F).sort(ar);if(!S)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:f}),Q({result:{error:If},stack:l});let T=(k=p==null?void 0:p.find(({drawPosition:F})=>F===b))==null?void 0:k.bye,P=(x=p==null?void 0:p.find(({drawPosition:F})=>F===t))==null?void 0:x.bye;Object.assign(c,{matchUpStatus:P||T?xt:ji,score:void 0,winningSide:void 0,drawPositions:U});let R=c.drawPositions.find(F=>!w.includes(F));Xa({method:l,color:"brightyellow",changedDrawPosition:R,pairedDrawPositionIsBye:T,drawPositionIsBye:P}),St({tournamentId:r==null?void 0:r.tournamentId,matchUp:c,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:n});let{targetLinks:{loserTargetLink:D},targetMatchUps:{loserMatchUp:E,loserTargetDrawPosition:N}}=Un({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(T||P){let F=T?t:b;if(F)WA({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(P&&D&&E)if(E.feedRound)qz({loserTargetDrawPosition:N,tournamentRecord:r,loserTargetLink:D,drawDefinition:n,loserMatchUp:E,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=E.drawPositions[$],L=xa({structureId:D.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function qz({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Xa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:c}=Rm({drawPosition:t,matchUps:l});if(c===s){let u=xa({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(u.error)return u}}function Yz({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=_t({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?xt:ji}),St({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function ab(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:c}=Qe({drawDefinition:a,structureId:o}),u=(Ur({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(u&&i&&!r&&(r=u==null?void 0:u.drawPosition),!r)return{error:yg};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=nb({drawDefinition:a,structureId:o});return d.includes(r)?{error:nT}:(e||({matchUps:e}=ur({inContext:!0,drawDefinition:a,matchUpsMap:s})),FC({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(Ec({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:c,event:l}),{...X,participantId:i}):{error:Yj})}function FC({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var v,I;let{structure:s}=Qe({drawDefinition:i,structureId:a});if(!s)return{error:Ti};let l=Ur({drawDefinition:i,structure:s}).positionAssignments||[],c=l.some(y=>{if(y.drawPosition===r)return delete y.participantId,delete y.qualifier,delete y.bye,!0});if(s.structureType===En)return Yz({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:s}),{drawPositionCleared:c,...X};let u={isCollectionMatchUp:!1},{matchUps:d}=_t({drawDefinition:i,matchUpFilters:u,matchUpsMap:n,structure:s,event:o}),{roundProfile:p,roundMatchUps:m}=wn({matchUps:d}),h=(v=p&&Object.keys(p))==null?void 0:v.map(y=>Je(y)),f=r,g=(I=h==null?void 0:h.map(y=>{var E,N,A,M;let b=(N=(E=p==null?void 0:p[y])==null?void 0:E.pairedDrawPositions)==null?void 0:N.find(C=>C.includes(f)),S=b==null?void 0:b.find(C=>C!==f),w=l.find(C=>C.drawPosition===S),U=p==null?void 0:p[y+1],T=w==null?void 0:w.bye,P=(A=U==null?void 0:U.pairedDrawPositions)==null?void 0:A.find(C=>C.includes(S)),R=T&&P&&U&&((M=U.drawPositions)==null?void 0:M.includes(S)),D=b&&{pairedDrawPositionByeAdvancedPair:!R&&P,pairedDrawPosition:S,targetDrawPosition:f,relevantPair:b,roundNumber:y};return R&&(f=S),D}).filter(y=>y==null?void 0:y.targetDrawPosition))==null?void 0:I.reduce((y,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:P}=b,R={roundNumber:S,targetDrawPosition:U,relevantPair:w},D=P&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:P,subsequentRoundRemoval:!0},E=[R,D].filter(Boolean);return y.concat(...E)},[]);return g==null||g.forEach(({roundNumber:y,targetDrawPosition:b,relevantPair:S})=>{let w=m==null?void 0:m[y].find(U=>{var T;return bn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(Voe({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:y,matchUpsMap:n}),Kz({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:s,event:o}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function Voe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=Qe({drawDefinition:r,structureId:o});if(!s)return{error:Ti};if(s.structureType===En)return;n=n||Jr({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:c}=Rm({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==c&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=Qt({drawDefinition:r,structureId:o}).positionAssignments??[];return u==null||u.forEach(p=>Kz({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...X}}function Kz({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var U,T,P,R,D,E;let c="removeDrawPosition",u=(U=n.drawPositions)==null?void 0:U.slice(),d=n.matchUpStatus,p=n.winningSide;o=o??Jr({drawDefinition:r});let m=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:h}=Rm({drawPosition:a,matchUps:m});if(n.roundNumber&&h&&n.roundNumber>h){let N=(n.drawPositions??[]).map(A=>A===a?void 0:A);n.drawPositions=N}if(n.matchUpType===ci){let N=(((T=t==null?void 0:t.find(A=>A.matchUpId===n.matchUpId))==null?void 0:T.sides)??[]).reduce((A,M,C)=>M.drawPosition===a?C:A,void 0);N!==void 0&&((R=(P=n.sides)==null?void 0:P[N])!=null&&R.lineUp)&&((D=n.sides)==null||delete D[N].lineUp,St({tournamentId:i==null?void 0:i.tournamentId,context:`${c}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let f=Un({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:I,loserMatchUpDrawPositionIndex:y}}=f,b=e.filter(({drawPosition:N})=>{var A;return(A=n.drawPositions)==null?void 0:A.includes(N)}).filter(N=>N.bye).length,S=b&&xt||n.matchUpStatus&&[Rt,Lt].includes(n.matchUpStatus)&&n.matcHUpStatus||((E=n.drawPositions)==null?void 0:E.length)===2&&ji||void 0;n.matchUpStatus=S,n.matchUpStatus&&[Lt,Rt].includes(n.matchUpStatus)&&(n.winningSide=void 0);let w=u==null?void 0:u.find(N=>{var A;return!((A=n.drawPositions)!=null&&A.includes(N))});if(u!=null&&u.includes(a)&&d===n.matchUpStatus&&p===n.winningSide||(w&&Xa({method:c,color:"brightyellow",removedDrawPosition:w}),St({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:n,context:`${c}-${a}`,drawDefinition:r})),v&&v.structureId!==f.matchUp.structureId&&!b){let{drawPositions:N,roundNumber:A}=v;if(A===1){let M=N[y];FC({structureId:v.structureId,drawPosition:M,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let M=Math.min(...N.filter(Boolean)),C=joe({loserMatchUpDrawPosition:M,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:v,matchUpsMap:o,event:l});if(C.error)return Q({result:C,stack:c});let O=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:k}=Rm({drawPosition:M,matchUps:O});k===1&&(Xa({method:c,color:"brightyellow",loserMatchUpDrawPosition:M}),FC({structureId:v.structureId,drawPosition:M,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return I&&I.structureId!==f.matchUp.structureId&&g.target.feedProfile,{...X}}function joe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var c;let{structure:s}=Qe({structureId:n.structureId,drawDefinition:r}),{positionAssignments:l}=Qt({structure:s});if((c=l==null?void 0:l.find(u=>u.drawPosition===t))!=null&&c.bye){let u=ab({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(u.error)return u}return{...X}}function fp({drawDefinition:t,stages:e}){if(!t)return{error:xe};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=mt(i.map(n=>{let{positionAssignments:a}=Qt({structure:n});return a?a.map(vt):[]}).flat().filter(Boolean));return{...X,assignedParticipantIds:r}}function ls(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Ae}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function vd(t){return[mp,Ho].includes(t)}function qS({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var P,R,D,E,N,A,M,C,O,k,x,F;if(!n||!Array.isArray(n))return{error:ps,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:ni};if(a&&!hz.includes(a))return{error:IC};if(o&&!uA.includes(o))return{error:lp};let p="modifyEntriesStatus",m=[];if(!a&&!s)return Q({result:{error:ze},info:"Missing entryStatus",stack:p});if(s&&!Hs({extension:s,requiredAttributes:["name"]}))return Q({result:{error:le},info:"Invalid extension",context:{extension:s},stack:p});let h=[];(P=d==null?void 0:d.drawDefinitions)==null||P.forEach($=>{let _=fp({stages:u&&[u],drawDefinition:$}).assignedParticipantIds??[];h.push(..._)});let f=(i==null?void 0:i.participants)??[];if(!n.every($=>{var L;let _=(L=Tc({tournamentParticipants:f,participantId:$}))==null?void 0:L.participantType;return!(_&&[ot,Ja].includes(_)&&vd(a))&&!(a&&(d!=null&&d.eventType)&&_===It&&[eo,to].includes(d.eventType)&&[To,...ZU].includes(a))}))return{error:IC};let g=d&&qi({event:d}).flightProfile,v=(R=g==null?void 0:g.flights)==null?void 0:R.find($=>$.drawId===c),I=$=>{let _=($||[]).filter(B=>!u||!B.entryStage||u===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&h.includes(B.participantId)&&!(ZU.includes(B.entryStatus)&&ZU.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?Ct({element:B,extension:s}):gn({element:B,name:s.name})),!0))?{...X}:{error:Ug}},y=({flight:$,drawDefinition:_})=>{d&&(d.entries=ls({entries:d.entries??[]})),$&&($.drawEntries=ls({entries:$.drawEntries})),_&&(_.entries=ls({entries:_.entries}))},b=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=I(_.drawEntries);if(V.error)return Q({result:V,stack:B})}if(L){let V=I(L.entries);if(V.error)return Q({result:V,stack:B});m.includes(L.drawId)||m.push(L.drawId)}return{...X}},S=((D=d==null?void 0:d.entries)==null?void 0:D.find(({entryPosition:$})=>$))??(((E=v==null?void 0:v.drawEntries)==null?void 0:E.find(({entryPosition:$})=>$))||((N=r==null?void 0:r.entries)==null?void 0:N.find(({entryPosition:$})=>$)));if(t&&!S&&y({flight:v,drawDefinition:r}),v||r){let $=b({flight:v,drawDefinition:r});if($.error)return Q({result:$,stack:p})}let w=((A=d==null?void 0:d.drawDefinitions)==null?void 0:A.map(({drawId:$})=>$))??[],U=((M=g==null?void 0:g.flights)==null?void 0:M.filter($=>!w.includes($.drawId)))||[];for(let $ of U){let _=$&&b({flight:$});if(_!=null&&_.error)return Q({result:_,stack:p})}let T=((C=g==null?void 0:g.flights)==null?void 0:C.length)===1&&(((O=d==null?void 0:d.drawDefinitions)==null?void 0:O.length)??0)<=((k=g==null?void 0:g.flights)==null?void 0:k.length);if(!v&&!r&&a&&mz.includes(a))return{error:MG};if(!v&&!r||a===yu||l&&T){let $=I(d==null?void 0:d.entries);if($!=null&&$.error)return Q({result:$,stack:p});let _;if(a===yu&&((x=g==null?void 0:g.flights)==null||x.every(L=>{let B=I(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(F=d==null?void 0:d.drawDefinitions)==null||F.every(L=>{var V;let B=I(L.entries);return B.error?(_=B.error,!1):(L.entries=(V=L.entries)==null?void 0:V.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return Q({result:{error:_},stack:p})}t&&y({flight:v,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])m.length&&!m.includes($.drawId)||ai({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...X}}function bl({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:Km};if(!Ut(e))return{error:le};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,c=[Nd,o,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,m,h]=((r=u.itemType)==null?void 0:r.split("."))??[];if(d!==Nd)return{error:My};let f=((n=a&&tm({element:u.itemValue,accessor:a}))==null?void 0:n.value)||u.itemValue,g={eventType:m,scaleDate:u.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...X,scaleItem:g}}}return{...X,scaleItem:void 0}}function Goe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var u,d,p;let a={},o=m=>[Nd,Il,n.eventType,m].join("."),s=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Il).map(({itemType:m,itemValue:h})=>({[m]:h}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),c=Vi(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((u=t==null?void 0:t.drawIds)!=null&&u.length)||c.length)&&c.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=o(t.stageSeedingScaleNames[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else if(c){let m=c.map(h=>s[h]);a.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=o(i[f]),v=s[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);a.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let I={eventType:n.eventType,scaleType:Il,scaleName:v},y=bl({scaleAttributes:I,participant:r});if(y.scaleItem){g=y.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function Hoe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...eA(d??[])):{},m=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:o,eventId:a});i.events[a]=Ge(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function Jz(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||r===xt||e[i].scheduleItems.push({...u,scheduledDate:ut(u==null?void 0:u.scheduledDate),scheduledTime:mi(u==null?void 0:u.scheduledTime),checkScoreHasValue:gr({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function ob(t){var a,o,s;let e=it(t,[{[Fn]:!0}]);if(e.error)return e;let{tournamentRecord:i,status:r=ka}=t,n=`${Jc}.${Xc}`;return ke((s=(o=(a=_T({tournamentRecord:i,itemType:n}))==null?void 0:a.timeItem)==null?void 0:o.itemValue)==null?void 0:s[r],!1,!0)}function zoe(t){let{tournamentId:e}=t??{};return!!e}function co({event:t,status:e=ka}){var r,n,a;let i=`${Jc}.${Xc}`;return(a=(n=(r=Gy({itemType:i,event:t}))==null?void 0:r.timeItem)==null?void 0:n.itemValue)==null?void 0:a[e]}function qA({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function uh(t){var d,p,m,h,f,g,v,I,y;let{tournamentRecord:e,drawDefinition:i,eventIds:r,eventId:n,drawIds:a,drawId:o,event:s}=t??{};if(e&&!zoe(e))return{error:le};if(n&&!s)return{error:sa};if(Array.isArray(r)&&(r!=null&&r.length)){let b={};for(let S of r){if(!Ki(S))return{error:le};let w=(d=An({tournamentRecord:e,eventId:S}))==null?void 0:d.event;if(!w)return{error:sa};let U=mE({event:w});b[S]=U}return{...X,publishState:b}}if(s){let b=mE({event:s}),S={};if(o)return i?{publishState:{status:{published:!!((p=b.status.publishedDrawIds)!=null&&p.includes(o)),drawDetail:(m=b.status.drawDetails)==null?void 0:m[o]},...X}}:{error:Pa};if(Array.isArray(a)&&(a!=null&&a.length)){let w=((h=s.drawDefinitions)==null?void 0:h.map(EI))??[];for(let U of a){if(!Ki(U))return{error:le};if(!w.includes(U))return{error:Pa};S[U]={status:{published:!!b.status.publishedDrawIds.includes(U),drawDetail:(f=b.status.drawDetails)==null?void 0:f[U]}}}}else S=b;return{...X,publishState:S}}let l=[],c=!1,u={};for(let b of(e==null?void 0:e.events)??[]){let S=mE({event:b});u[b.eventId]=S,S.status.published&&(l.push(b.eventId),c=!0);for(let{drawId:w}of b.drawDefinitions??[]){let U=(v=(g=S.status)==null?void 0:g.publishedDrawIds)==null?void 0:v.includes(w);U&&(u[w]={status:{published:U}})}}if(e){let b=ob({tournamentRecord:e});u.tournament=b??{},((I=b==null?void 0:b.orderOfPlay)!=null&&I.published||(y=b==null?void 0:b.participants)!=null&&y.published)&&(c=!0),u.tournament.status={published:c,publishedEventIds:l}}return{...X,publishState:u}}function mE({event:t}){var a;let e=co({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let r=e.drawDetails??{};for(let o of((a=t.drawDefinitions)==null?void 0:a.map(EI))||[])r[o]||(r[o]={publishingDetail:{published:!1}});let n=r&&Object.keys(r).length&&Object.keys(r).filter(o=>qA({drawDetails:r,drawId:o}))||e.drawIds;return{status:{published:n&&n.length>0,publishedDrawIds:n,publishedSeeding:i,drawDetails:r}}}function KT(t,e){return(t||"").localeCompare(e||"")}function Woe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],m=I=>Math.abs(I[0]-I[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:u});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===Lt&&(h.walkoverWinCount+=1),n===Rt&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=c,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function wB(t){var M,C,O,k,x,F,$,_,L,B;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:r,participantMap:n,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:m,structureId:h,score:f,stage:g,withRankingProfile:v,tieWinningSide:I,roundPosition:y,matchUpTieId:b,matchUpSides:S,collectionId:w,matchUpType:U,winningSide:T,matchUpId:P,schedule:R,eventId:D,drawId:E,sides:N}=t,A=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:V},G)=>{let j=N[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of N){let{participantId:G,sideNumber:j,bye:H}=V;if(H)continue;let W=T===j,Y=K=>{var ie,ne;let z=(ie=n[K])==null?void 0:ie.participant,te=z==null?void 0:z.participantType,J=[{participantId:K,participantType:te}];if(te!==Ja)for(let ue of(z==null?void 0:z.individualParticipantIds)||[]){let ae=(ne=n[ue])==null?void 0:ne.participant;J.push({participantType:ae==null?void 0:ae.participantType,participantId:ue})}return J},q=(K,z)=>{if(o){if(n[K].matchUps[P]={participantWon:W,matchUpType:U,structureId:h,sideNumber:j,matchUpId:P,eventId:D,drawId:E,stage:g},a){let te=Y(z);n[K].matchUps[P].opponentParticipantInfo=te}w&&(n[K].matchUps[P].collectionId=w)}a&&z&&(n[K].opponents[z]={participantId:z,matchUpId:P,eventId:D,drawId:E}),v&&Woe({finishingPositionRange:c,participantMap:n,participantWon:W,finishingRound:u,matchUpStatus:d,participantId:K,stageSequence:p,roundNumber:m,structureId:h,matchUpId:P,drawId:E,stage:g}),(i||e)&&Jz({participantMap:n,participantId:K,matchUpStatus:d,roundPosition:y,matchUpType:U,roundNumber:m,structureId:h,matchUpId:P,schedule:R,drawId:E,score:f})},re=({participant:K,partnerParticipantId:z})=>{var J,ie,ne;let te=(ue,ae)=>{ue&&(ue.partnerParticipantIds||(ue.partnerParticipantIds=[]),ue.partnerParticipantIds.includes(ae)||ue.partnerParticipantIds.push(ae))};l&&te((J=K==null?void 0:K.draws)==null?void 0:J[E],z),s&&te((ie=K==null?void 0:K.events)==null?void 0:ie[D],z),o&&te((ne=K==null?void 0:K.matchUps)==null?void 0:ne[P],z)};if(G&&n[G]){let K=A==null?void 0:A[j];q(G,K);let z=((M=n[G])==null?void 0:M.participant.participantType)===ot,te=((C=n[G])==null?void 0:C.participant.individualParticipantIds)||[];if(b){if(r){let J=ie=>n[ie].matchUps[b]={participantWon:I===j,matchUpId:b,matchUpType:ci,sideNumber:j};J(G),te.forEach(J)}if(l&&!n[G].draws[E]){let J=(k=(O=S.find(ue=>ue.sideNumber===j))==null?void 0:O.participant)==null?void 0:k.participantId,ie=($=(F=(x=n[J])==null?void 0:x.draws)==null?void 0:F[E])==null?void 0:$.entryStatus,ne=ue=>n[ue].draws[E]={entryStatus:ie,eventId:D,drawId:E};ne(G),te.forEach(ne)}}if(z&&(te.forEach(J=>n[J]&&q(J,K)),te.forEach((J,ie)=>{let ne=te[1-ie],ue=n[J];ue&&re({participant:ue,partnerParticipantId:ne})}),s&&S)){let J=(L=(_=S.find(ie=>ie.sideNumber===j))==null?void 0:_.participant)==null?void 0:L.participantId;if(J){let ie=(B=n[J])==null?void 0:B.events[D];ie?(n[G].events[D]={...ie},te.forEach(ne=>n[ne].events[D]={...ie})):console.log("Missing teamEntry",{eventId:D,teamParticipantId:J})}}if(T){let J=ie=>{W?(n[ie].counters[U].wins+=1,n[ie].counters.wins+=1,d===Lt&&(n[ie].counters[U].walkoverWins+=1,n[ie].counters.walkoverWins+=1),d===Rt&&(n[ie].counters[U].defaultWins+=1,n[ie].counters.defaultWins+=1)):(n[ie].counters[U].losses+=1,n[ie].counters.losses+=1,d===Lt&&(n[ie].counters[U].walkovers+=1,n[ie].counters.walkovers+=1),d===Rt&&(n[ie].counters[U].defaults+=1,n[ie].counters.defaults+=1))};J(G),te.forEach(J)}}}}function qoe(t){var N,A,M,C,O,k,x;let{participantFilters:e,convertExtensions:i,policyDefinitions:r,tournamentRecord:n,usePublishState:a,contextProfile:o,participantMap:s,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,withOpponents:h,withMatchUps:f,withSeeding:g,withEvents:v,withDraws:I}=t,y=e==null?void 0:e.participantIds,b=F=>{var _,L;let $=[F];return(L=(_=s[F])==null?void 0:_.participant.individualParticipantIds)==null||L.forEach(B=>$.push(B)),$.some(B=>!(y!=null&&y.length)||y.includes(B))?$:[]},S={withMatchUps:f||c,withEvents:v||c,withDraws:I||c,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:m,participantMap:s,withOpponents:h,withSeeding:g},w=[],U={},T=[],P={},R={},D={},E=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G,j;return(j=(G=(V=(B=(L=s[_])==null?void 0:L.participant)==null?void 0:B.rankings)==null?void 0:V[F])==null?void 0:G.find(H=>$.includes(H.scaleName)))==null?void 0:j.scaleValue};for(let F of(n==null?void 0:n.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:H}=F,{flightProfile:W}=qi({event:F}),Y=(W==null?void 0:W.flights)??[],q=uh({event:F}).publishState;q&&(P[j]=q);let re=(N=q==null?void 0:q.status)==null?void 0:N.publishedSeeding;if(v||g||c){let z=i?Object.assign({},...eA(_??[])):{};R[j]={...z,eventName:B,eventType:L,category:V,eventId:j,gender:H};let te=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let J of G){let{participantId:ie}=J;if(!ie||!s[ie])continue;let ne=E({eventType:L,scaleNames:te,participantId:ie}),ue,ae;if(g){let pe=s[ie].participant;({seedAssignments:ue,seedValue:ae}=Goe({publishedSeeding:re,usePublishState:a,withSeeding:g,participant:pe,event:F}))}let ce=pe=>{var Be,Pe;if((Pe=(Be=s[pe])==null?void 0:Be.events)!=null&&Pe[j])return;let Se=s[pe];Hoe({convertExtensions:i,seedAssignments:ue,participant:Se,withSeeding:g,seedValue:ae,eventId:j,ranking:ne,entry:J})};ce(ie),(s[ie].participant.individualParticipantIds||[]).forEach(ce)}}let K=(A=P==null?void 0:P[j])==null?void 0:A.publishedSeeding;if(I||c||g){let z=J=>J?Object.assign({},...J.map(({participantId:ie,seedValue:ne,seedNumber:ue})=>({[ie]:{seedValue:ne,seedNumber:ue}}))):void 0,te=mt([...$.map(EI),...Y.map(EI)]);for(let J of te){let ie=$.find(ye=>ye.drawId===J),ne=Y==null?void 0:Y.find(ye=>ye.drawId===J),ue=(ie==null?void 0:ie.entries)||(ne==null?void 0:ne.drawEntries),{structures:ae=[],drawOrder:ce,drawName:pe,drawType:Se}=ie??{},Be=ne==null?void 0:ne.flightNumber,Pe=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),at=((ie==null?void 0:ie.structures)||[]).sort((ye,Te)=>ih(ye,Te)).map(({structureId:ye,structures:Te})=>[ye,...(Te||[]).map(({structureId:Ze})=>Ze)]).flat(1/0),de,Ie,me,Me,be=0,_e=ae.filter(({stage:ye,stageSequence:Te})=>ye===Ae&&Te===1||ye===We).flatMap(ye=>{let{seedAssignments:Te,stageSequence:Ze,stage:je}=ye,{positionAssignments:ve}=Qt({structure:ye});return je===Ae?(be=(ve==null?void 0:ve.length)??0,me=ve,Me=Te):Ze===1&&(de=ve,Ie=Te),ve}).map(({participantId:ye})=>ye).filter(Boolean),Ne=z(Me),se=z(Ie),ge=ie?ue.filter(({participantId:ye})=>_e.includes(ye)):ue,we=!a||(K==null?void 0:K.published)&&(((M=K==null?void 0:K.drawIds)==null?void 0:M.length)===0||((C=K==null?void 0:K.drawIds)==null?void 0:C.includes(J)));for(let ye of ge){if(!s[ye.participantId])continue;let{entryStatus:Te,entryStage:Ze,entryPosition:je,participantId:ve}=ye,qt=E({participantId:ve,scaleNames:Pe,eventType:L}),Xi=Ke=>{var Es,ho,Qr,dl,pl;if(!s[Ke]||(Es=s[Ke].draws)!=null&&Es[J])return;let At=g&&we,Ei=At?{}:void 0,dr=At?((ho=Ne==null?void 0:Ne[ve])==null?void 0:ho.seedValue)||((Qr=Ne==null?void 0:Ne[ve])==null?void 0:Qr.seedNumber):void 0,mn=dr?Ne==null?void 0:Ne[ve]:void 0,cl=At?((dl=se==null?void 0:se[ve])==null?void 0:dl.seedValue)||((pl=se==null?void 0:se[ve])==null?void 0:pl.seedNumber):void 0,ba=cl?se==null?void 0:se[ve]:void 0;Ei&&dr&&(Ei[Ae]=mn),Ei&&cl&&(Ei[We]=ba);let wa=dr||cl;wa&&(s[Ke].participant.seedings[L]||(s[Ke].participant.seedings[L]=[]),mn&&s[Ke].participant.seedings[L].push({...mn,scaleName:J}),ba&&s[Ke].participant.seedings[L].push({...ba,scaleName:J}),Ei&&(s[Ke].events[j].seedAssignments||(s[Ke].events[j].seedAssignments={}),Object.keys(Ei).forEach(Cs=>s[Ke].events[j].seedAssignments[Cs]=Ei[Cs]))),(I||c)&&(s[Ke].draws[J]=Ge({seedAssignments:Ei,entryPosition:je,entryStatus:Te,entryStage:Ze,seedValue:wa,eventId:j,ranking:qt,drawId:J},!1,!1,!0))};[Ho,mp].includes(Te)||(Xi(ve),(O=s[ve].participant.individualParticipantIds||[])==null||O.forEach(Xi))}let De=((ie==null?void 0:ie.structures)??[]).reduce((ye,Te)=>(ye.includes(Te.stage)||ye.push(Te.stage),ye),[]),Le=((ie==null?void 0:ie.links)??[]).length;D[J]={qualifyingPositionAssignments:de,qualifyingSeedAssignments:Ie,mainPositionAssignments:me,qualifyingSeedingMap:se,mainSeedAssignments:Me,orderedStructureIds:at,mainSeedingMap:Ne,flightNumber:Be,linksCount:Le,drawOrder:ce,drawName:pe,drawType:Se,drawSize:be,drawId:J,stages:De}}}if(c||d||p||m||h||f||I){let z=!!d||l,te=((k=Kl({afterRecoveryTimes:!!d,policyDefinitions:r,tournamentRecord:n,inContext:!0,contextProfile:o,participantMap:s,nextMatchUps:z,event:F}))==null?void 0:k.matchUps)??[];for(let J of te){let{finishingPositionRange:ie,potentialParticipants:ne,tieMatchUps:ue=[],sides:ae=[],winningSide:ce,matchUpType:pe,matchUpId:Se,eventId:Be,drawId:Pe,collectionId:at,stageSequence:de,finishingRound:Ie,matchUpStatus:me,roundPosition:Me,roundNumber:be,structureId:_e,schedule:Ne,score:se,stage:ge}=J;U[Se]=J;let we={finishingPositionRange:ie,finishingRound:Ie,stageSequence:de,roundPosition:Me,collectionId:at,roundNumber:be,structureId:_e,schedule:Ne,eventId:Be,drawId:Pe,score:se,stage:ge};wB({...we,...S,matchUpStatus:me,winningSide:ce,matchUpType:pe,matchUpId:Se,sides:ae});for(let De of ue){let{winningSide:Le,sides:ye=[],matchUpId:Te,matchUpStatus:Ze,matchUpType:je}=De;wB({...we,...S,winningSide:Le,tieWinningSide:ce,matchUpTieId:Se,matchUpId:Te,sides:ye,matchUpSides:ae,matchUpStatus:Ze,matchUpType:je})}Array.isArray(ne)&&(z||d||u)&&((x=ne.flat().map(vt).filter(Boolean))==null||x.forEach(De=>{var Le;(Le=b(De))==null||Le.forEach(ye=>{s[ye]&&(s[ye].potentialMatchUps[Se]=Ge({tournamentId:n==null?void 0:n.tournamentId,matchUpId:Se,eventId:Be,drawId:Pe}))}),(d||u)&&Jz({potential:!0,participantMap:s,participantId:De,matchUpStatus:me,roundPosition:Me,structureId:_e,matchUpType:pe,roundNumber:be,matchUpId:Se,schedule:Ne,drawId:Pe,score:se})}))}T.push(...te)}}if(m||c||d){let F=Object.values(s);for(let $ of F){let{wins:_,losses:L,[vi]:{wins:B,losses:V},[ri]:{wins:G,losses:j}}=$.counters,H=(W,Y,q)=>{let re=Y+q,K=Y,z=re&&K/re;$.statistics[W]={denominator:re,numerator:K,statValue:z,statCode:W}};if(m&&(H(XU,_,L),H(`${XU}.${vi}`,B,V),H(`${XU}.${ri}`,G,j)),c){let W=(Y=[])=>Math.abs(Y[0]-Y[1]);for(let Y of Object.keys($.draws)){let{orderedStructureIds:q=[],flightNumber:re}=D[Y]||{};if($.structureParticipation&&q.length){let K,z=0,te=q.map(J=>{let ie=$.structureParticipation[J];if(!ie)return;K||(K=ie==null?void 0:ie.finishingPositionRange),W(K)>W(ie==null?void 0:ie.finishingPositionRange)&&(K=ie==null?void 0:ie.finishingPositionRange);let ne=ie.stage!==We;return ne&&(z+=1),Ge({...ie,participationOrder:ne?z:void 0,flightNumber:re})}).filter(Boolean);$.draws[Y]&&($.draws[Y].finishingPositionRange=K,$.draws[Y].structureParticipation=te)}}}if(d){let W=Ut(d)?d.scheduledMinutesDifference:0,Y=$.scheduleItems||[],q=$.potentialMatchUps||{},re=Y.reduce((z,te)=>{let{scheduledDate:J,scheduledTime:ie}=te;return z[J]||(z[J]=[]),ie&&z[J].push(te),z},{});Object.values(re).forEach(z=>z.sort(PH));for(let z of Y){let{typeChangeTimeAfterRecovery:te,timeAfterRecovery:J,scheduledDate:ie,scheduledTime:ne}=z,ue=re[ie],ae=Dt(ne);for(let ce of ue){if(ce.matchUpId===z.matchUpId||[Lt,Rt].includes(ce.matchUpStatus)&&!ce.checkScoreHasValue)continue;let pe=z.matchUpType!==ce.matchUpType&&te||J,Se=z.drawId===ce.drawId,Be=q[z.matchUpId]&&q[ce.matchUpId],Pe=Dt(ce.scheduledTime),at=Math.abs(Pe-ae),de=Pe>=ae;if((W&&!isNaN(W)?at<=W:de&&Dt(ce.scheduledTime)<Dt(pe))&&!(Be&&Se)&&de){let Ie=[z.matchUpId,ce.matchUpId].sort(KT).join("|");$.scheduleConflicts[Ie]={priorScheduledMatchUpId:z.matchUpId,matchUpIdWithConflict:ce.matchUpId}}}}let K=$.participant.participantId;Object.keys($.scheduleConflicts).length&&w.push(K),s[K].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:P,derivedEventInfo:R,derivedDrawInfo:D,mappedMatchUps:U,participantMap:s,matchUps:T}}function sb({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var b;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:n,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:m,genders:h}=t,f=ml(m)&&((b=e==null?void 0:e.events)==null?void 0:b.filter(S=>m==null?void 0:m.includes(S.eventId)))||(e==null?void 0:e.events)||[],g=n&&Yoe({drawEntryStatuses:n,tournamentEvents:f}),v=o&&Koe({eventEntryStatuses:o,tournamentEvents:f}),I=a!==void 0&&[!0,!1].includes(a)&&f.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>QH({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),y=S=>r==null?void 0:r.reduce((w,U)=>{let{accessor:T,value:P}=U,{values:R}=tm({element:S,accessor:T});return w&&(R==null?void 0:R.includes(P))},!0);if(i=i==null?void 0:i.filter(S=>{var N,A;let w=(A=(N=Go({element:S,itemType:jy}))==null?void 0:N.timeItem)==null?void 0:A.itemValue,{participantRoleResponsibilities:U,participantType:T,participantRole:P,participantId:R,person:D}=S,E=Array.isArray(h)&&(h==null?void 0:h.length)&&(D==null?void 0:D.sex)&&h.includes(D.sex);return p?h&&E||a&&I.includes(R)||a===!1&&!I.includes(R)||(g==null?void 0:g.includes(R))||(v==null?void 0:v.includes(R))||(u==null?void 0:u.includes(R))||d&&w===d||c&&T&&ml(c)&&c.includes(T)||s&&P&&ml(s)&&s.includes(P)||l&&ml(U)&&ml(l)&&l.find(M=>U==null?void 0:U.includes(M))||(r==null?void 0:r.length)&&ml(r)&&y(S):(!h||E)&&(a===void 0||a&&I.includes(R)||a===!1&&!I.includes(R))&&(!g||g.includes(R))&&(!v||v.includes(R))&&(!u||u.includes(R))&&(!d||w===d)&&(!c||T&&ml(c)&&c.includes(T))&&(!s||P&&ml(s)&&s.includes(P))&&(!l||ml(U)&&ml(l)&&l.find(M=>U==null?void 0:U.includes(M)))&&(!(r!=null&&r.length)||ml(r)&&y(S))}),f.length&&m){let S=f.filter(w=>m.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(P=>P.participantId);if($i(Gs)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(P=>U.includes(P.participantId)).map(P=>P.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function ml(t){return t&&Array.isArray(t)&&t.length}function Yoe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return mt(e.reduce((r,n)=>{var l,c;let{flightProfile:a}=qi({event:n}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(vt):[]).flat())||[],s=((c=n.drawDefinitions)==null?void 0:c.map(({entries:u})=>u?u.filter(i).map(vt):[]))||[];return r.concat(...o,...s)},[]))}function Koe({eventEntryStatuses:t,tournamentEvents:e}){return mt(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(vt);return i.concat(...n)},[]))}function Gi(t){var L;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:r,withRankingProfile:n,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:m,contextProfile:h,withStatistics:f,withOpponents:g,withMatchUps:v,internalUse:I,withSeeding:y,withEvents:b,withDraws:S,withISO2:w,withIOC:U}=t;if(!l)return{error:fe};(v||n)&&Wo({tournamentRecord:l});let{participantMap:T}=dz({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:I,withISO2:w,withIOC:U}),P=qoe({withMatchUps:v??n,withEvents:b??n,withDraws:S??n,withPotentialMatchUps:r,participantFilters:i,withRankingProfile:n,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:m,withStatistics:f,participantMap:T,withOpponents:g,contextProfile:h,withSeeding:y}),{participantIdsWithConflicts:R,eventsPublishStatuses:D,derivedEventInfo:E,derivedDrawInfo:N,mappedMatchUps:A}=P,M=P.matchUps;T=P.participantMap;let C=c??r,O=({potentialMatchUps:B,scheduleConflicts:V,scheduleItems:G,participant:j,statistics:H,opponents:W,matchUps:Y,events:q,draws:re})=>{let K=Object.values(re),z=Object.values(W);return g&&(K==null||K.forEach(te=>{te.opponents=z.filter(J=>J.drawId===te.drawId)})),Ge({...j,scheduleConflicts:c?Object.values(V):void 0,draws:S||n?K:void 0,events:b||n?Object.values(q):void 0,matchUps:v||n?Object.values(Y):void 0,opponents:g?z:void 0,potentialMatchUps:C?Object.values(B):void 0,statistics:f?Object.values(H):void 0,scheduleItems:s?G:void 0},!1,!1,!0)},k=new Map;for(let B of Object.keys(T))k.set(B,O(T[B]));let x=[...k.values()],F=(L=o==null?void 0:o[ky])==null?void 0:L.participant,$=sb({participants:x,participantFilters:i,tournamentRecord:l});if(e){let B=Ut(e)?e:void 0;for(let V of $)for(let G of V.individualParticipantIds??[]){V.individualParticipants||(V.individualParticipants=[]);let j=k.get(G);V.individualParticipants.push(B?Um({template:B,source:j}):j)}}let _=F?$.map(B=>Um({source:B,template:F})):$;return{participantIdsWithConflicts:R,eventsPublishStatuses:D,derivedEventInfo:E,derivedDrawInfo:N,mappedMatchUps:A,participantMap:T,participants:_,...X,matchUps:M}}function im({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var a;if(!e)return{error:xe};let n=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&n}function $g(t){var m,h,f,g,v,I,y,b,S;let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,structureId:n,stage:a}=t;if(!i)return{error:xe};let{entryProfile:o}=zy({drawDefinition:i}),s=a&&r&&((f=(h=(m=o==null?void 0:o[a])==null?void 0:m.stageSequence)==null?void 0:h[r])==null?void 0:f.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!n)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:c}=Qe({drawDefinition:i,structureId:n}),u=(v=i.links)==null?void 0:v.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(c==null?void 0:c.structureId)}),d=0;if(u!=null&&u.length)for(let w of u){let U=(I=Qe({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:I.structure;if((U==null?void 0:U.stage)===We){let T=w.source.roundNumber,P=w.target.roundNumber,R=0;if(U.structureType===En){let D=((y=U.structures)==null?void 0:y.length)??0,E=((b=w.source.finishingPositions)==null?void 0:b.length)??0;R=D*E}else R=((S=_t({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:S.length)||0;l[P]||(l[P]=0),l[P]+=R,d+=R}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function YS({stage:t,drawDefinition:e}){var r;let{entryProfile:i}=zy({drawDefinition:e});return((r=i==null?void 0:i[t])==null?void 0:r.drawSize)||0}function Joe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=YS({stage:n,drawDefinition:i}),{qualifiersCount:o}=$g({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function Xz({stage:t,drawDefinition:e}){return!!(t===Rr||_A({stage:t,drawDefinition:e})&&YS({stage:t,drawDefinition:e}))}function Zz({entryStatus:t=ua,drawDefinition:e,stageSequence:i,stage:r}){if(t===To)return $ae({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...X}:{error:CG};let n=Joe({drawDefinition:e,stageSequence:i,stage:r}),a=Bae({drawDefinition:e,stage:r}),o=CC({entryStatus:Af,drawDefinition:e,stage:r}),s=CC({entryStatus:ua,drawDefinition:e,stage:r}),l=o+s,c=l>=n,u=n-l;return r!==Rr&&c?{error:yC}:t===Af?o<a?{...X}:{error:yC}:{positionsAvailable:u,...X}}function Qz(t){let{suppressDuplicateEntries:e=!0,entryStatus:i=ua,entryStageSequence:r,entryStage:n=Ae,ignoreStageSpace:a,drawDefinition:o,entryPosition:s,participant:l,roundTarget:c,extensions:u,extension:d,drawType:p,event:m}=t,h="addDrawEntry";if(!o)return{error:xe};if(!n)return{error:gN};if(p!==io&&!Xz({stage:n,drawDefinition:o}))return Q({result:{error:lp},stack:h});let f=Zz({stageSequence:r,stage:n,drawDefinition:o,entryStatus:i});if(!a&&!f.success&&(!p||p!==io))return{error:f.error};if(d&&!Hs({extension:d}))return Q({result:{error:le},info:"Invalid extension",context:{extension:d},stack:h});let g=t.participantId||(l==null?void 0:l.participantId);if(!g)return Q({result:{error:lr},stack:h});let v=i===Iu&&im({participantId:g,drawDefinition:o,entryStatus:i}),I=n===Rr&&im({participantId:g,drawDefinition:o,entryStage:n}),y=im({participantId:g,drawDefinition:o}),b=i!==Iu&&n!==Rr&&y;if(b)return e?(lt({payload:{drawId:o.drawId,eventId:m==null?void 0:m.eventId,error:yI,participantId:g},topic:yA}),{...X}):Q({result:{error:yI},context:{participantId:g},stack:h});if(v||I)return Q({context:{invalidEntry:b,invalidLuckyLoser:v,invalidVoluntaryConsolation:I},result:{error:cT},stack:h});let S=Ge({entryStageSequence:r,participantId:g,entryPosition:s,entryStatus:i,entryStage:n,extensions:u});return d&&Ct({element:S,extension:d}),c&&Ct({extension:{name:"roundEntry",value:c},element:S}),o.entries||(o.entries=[]),o.entries.push(S),ai({drawDefinition:o}),{...X}}function Xoe(t){let e="addDrawEntries",{suppressDuplicateEntries:i=!0,entryStatus:r=ua,stage:n=Ae,autoEntryPositions:a=!0,ignoreStageSpace:o,participantIds:s,drawDefinition:l,stageSequence:c,roundTarget:u,extension:d,event:p}=t;if(!n)return{error:gN};if(!l)return{error:xe};if(!Array.isArray(s))return{error:na};if(!Xz({stage:n,drawDefinition:l}))return{error:lp};if(d&&!Hs({extension:d}))return Q({result:{error:le},info:"Invalid extension",context:{extension:d},stack:e});let m=Zz({drawDefinition:l,stageSequence:c,entryStatus:r,stage:n});if(!o&&!m.success)return{error:m.error};let h=m.positionsAvailable??0;if(!o&&n!==Rr&&h<s.length)return{error:DN};let f=[],g=l.drawId,v=p==null?void 0:p.eventId,I=s.reduce((y,b)=>{let S=r===Iu&&im({participantId:b,drawDefinition:l,entryStatus:r}),w=n===Rr&&im({entryStage:n,drawDefinition:l,participantId:b}),U=im({participantId:b,drawDefinition:l});return r!==Iu&&n!==Rr&&U&&(f.push(b),i&&lt({payload:{error:yI,participantId:b,eventId:v,drawId:g},topic:yA})),S||w?y.concat(b):y},[]);return f.length&&i?Q({context:{eventId:v,drawId:g,duplicateEntries:f},result:{error:yI},stack:e}):(s.filter(y=>y&&!I.includes(y)).forEach(y=>{let b={entryStageSequence:c,entryStage:n,participantId:y,entryStatus:r};d&&Ct({element:b,extension:d}),u&&Ct({extension:{name:ol,value:u},element:b}),l.entries||(l.entries=[]),l.entries.push(b)}),a&&(l.entries=ls({entries:l.entries})),ai({drawDefinition:l}),I!=null&&I.length||f!=null&&f.length?{info:"some participantIds could not be added",participantIdsNotAdded:I,duplicateEntries:f,...X}:{...X})}function YA({suppressDuplicateEntries:t=!0,autoEntryPositions:e=!0,entryStageSequence:i,ignoreStageSpace:r,drawDefinition:n,participantIds:a,entryStatus:o,roundTarget:s,entryStage:l,extension:c,drawId:u,event:d}){if(!(a!=null&&a.length))return{error:Hc};if(!d)return{error:sa};if(!u)return{error:Ds};let p=(d.entries||[]).map(vt);if(a.filter(f=>!p.includes(f)).length)return{error:oG};if(n){let f=Xoe({stageSequence:i,suppressDuplicateEntries:t,autoEntryPositions:e,stage:l,ignoreStageSpace:r,drawDefinition:n,participantIds:a,entryStatus:o,roundTarget:s,extension:c});if(f.error)return f}let{flightProfile:m}=qi({event:d}),h=m==null?void 0:m.flights.find(f=>f.drawId===u);return h!=null&&h.drawEntries&&(a.forEach(f=>{let g=o===Iu&&hE({participantId:f,entryStatus:o,flight:h}),v=l===Rr&&hE({participantId:f,entryStage:l,flight:h});!(o!==Iu&&l!==Rr&&hE({flight:h,participantId:f}))&&!g&&!v&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:l})}),e&&(h.drawEntries=ls({entries:h.drawEntries}))),{...X}}function hE({participantId:t,entryStatus:e,entryStage:i,flight:r}){var a;let n=(a=r.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&n}function lb({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var d,p,m,h;let a="removeEventEntries";if(!(n!=null&&n.eventId))return{error:ni};if(!Array.isArray(e)||e.some(f=>!Ki(f)))return Q({result:{error:ps},stack:a});let o=(n.drawDefinitions??[]).flatMap(f=>fp({drawDefinition:f}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=n.entries)==null?void 0:d.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(vt).filter(f=>!o.includes(f)),l=(r&&((p=n.entries)==null?void 0:p.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(vt).filter(f=>!o.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||s.includes(f))&&(!r||l.includes(f))):s.length&&l.length?e=Vi(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(f=>e.includes(f)))return Q({result:{error:Ug},stack:a});if(!(e!=null&&e.length))return{...X,participantIdsRemoved:[]};let c=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||c.push(f.participantId),g}),t&&(n.entries=ls({entries:n.entries}));let{flightProfile:u}=qi({event:n});return(m=u==null?void 0:u.flights)==null||m.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(h=n.drawDefinitions)==null||h.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...X,participantIdsRemoved:c}}var eW={[Pr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Bg=eW;function wl(t){var M,C;let{suppressDuplicateEntries:e=!0,entryStatus:i=ua,autoEntryPositions:r=!0,enforceGender:n=!0,entryStageSequence:a,policyDefinitions:o,entryStage:s=Ae,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:m,drawId:h,event:f}=t,g="addEventEntries";if(!Array.isArray(t.participantIds))return Q({result:{error:na},stack:g});let v=mt(t.participantIds??[]);if(!f)return{error:ni};if(!(v!=null&&v.length))return Q({result:{error:Hc},stack:g});if(!(f!=null&&f.eventId))return{error:sa};let I=Nt({tournamentRecord:l,event:f}).appliedPolicies??{},y=(o==null?void 0:o[Pr])??(I==null?void 0:I[Pr])??Bg[Pr],b=(n??((M=y==null?void 0:y.participants)==null?void 0:M.enforceGender))!==!1,S=[],w=[];if(p&&(!Array.isArray(p)||!p.every(O=>Hs({extension:O})))||m&&!Hs({extension:m}))return Q({context:Ge({extension:m,extensions:p}),result:{error:le},info:"Invalid extension(s)",stack:g});let U=!!l,T=[],P,R=((C=l==null?void 0:l.participants)==null?void 0:C.filter(O=>{var F,$,_;if(!v.includes(O.participantId))return!1;let k=$i(vi)(f.eventType)&&O.participantType===It&&!vd(i),x=f.eventType===ri&&O.participantType===ot;return k&&(!f.gender||!b||[Gn,Is].includes(f.gender)||f.gender===((F=O.person)==null?void 0:F.sex))||x&&!vd(i)||f.eventType===ri&&O.participantType===It&&vd(i)?!0:k&&f.gender&&b&&![Gn,Is].includes(f.gender)&&f.gender!==(($=O.person)==null?void 0:$.sex)?(T.push({participantId:O.participantId,sex:(_=O.person)==null?void 0:_.sex}),!1):f.eventType===Kt&&(O.participantType===Kt||vd(i)&&O.participantType===It)}).map(O=>O.participantId))??[],D=v.filter(O=>!U||R.includes(O));f.entries||(f.entries=[]);let E=f.entries.map(O=>{var k;return O.participantId||((k=O.participant)==null?void 0:k.participantId)});if(D.forEach(O=>{var k;if(!E.includes(O)){let x=Ge({participantId:O,entryStatus:i,entryStage:s,extensions:p});m&&Ct({element:x,extension:m}),d&&Ct({extension:{name:ol,value:d},element:x}),a&&(x.entryStageSequence=a),S.push(x.participantId),(k=f.entries)==null||k.push(x)}}),h&&!vd(s)){let O=YA({participantIds:D,suppressDuplicateEntries:e,autoEntryPositions:r,entryStageSequence:a,ignoreStageSpace:c,drawDefinition:u,entryStatus:i,roundTarget:d,entryStage:s,extension:m,drawId:h,event:f});O.error&&(P=O.error)}if(f.eventType&&[Uc,to].includes(f.eventType)){let O=(f.entries||[]).map($=>$.participantId),k=(f.entries||[]).filter($=>vd($.entryStatus)).map($=>$.participantId),x=((l==null?void 0:l.participants)??[]).filter($=>O.includes($.participantId)&&$.participantType&&[ot,Kt].includes($.participantType)).map($=>$.individualParticipantIds).flat(1/0),F=k.filter($=>x.includes($));F.length&&(w.push(...F),lb({participantIds:F,autoEntryPositions:!1,event:f}))}if(D.length!==v.length)return Q({context:{mismatchedGender:T,gender:f.gender},result:{error:na},stack:g});r&&(f.entries=ls({entries:f.entries||[]}));let N=S.length,A=w.length;return Q({result:{...X,addedEntriesCount:N,removedEntriesCount:A},stack:g,info:P})}var tW="ADMINISTRATION",Zoe="CAPTAIN",Qoe="COACH",Gr="COMPETITOR",iW="MEDIA",rW="MEDICAL",KA="OFFICIAL",nW="OTHER",aW="SECURITY",JA={ADMINISTRATION:tW,CAPTAIN:Zoe,COACH:Qoe,COMPETITOR:Gr,MEDIA:iW,MEDICAL:rW,OFFICIAL:KA,OTHER:nW,SECURITY:aW};function XA({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return Q({result:{error:fe},stack:a});if(!i||!e)return Q({result:{error:ze},stack:a});let o=(r.participants??[]).find(u=>u.participantId===i);if(!o)return Q({result:{error:Li},stack:a});if(![Kt,Oa].includes(o.participantType))return Q({result:{participantType:o.participantType,error:ms},stack:a});let s=oW({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:c}=s;if(c)return Q({result:s,stack:a});if(t)for(let u of r.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));wl({participantIds:p,entryStatus:Ho,tournamentRecord:r,event:u})}}return l&&lt({topic:qr,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...X,...s}}function oW({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var p,m;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:n}=Gi({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=(m=(p=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:p.events)==null?void 0:m.map(({eventId:h})=>h),u=(e.individualParticipantIds??[]).filter(h=>{var I;let f=t==null?void 0:t.includes(h),g=f&&((I=a==null?void 0:a.find(y=>y.participantId===h))==null?void 0:I.matchUps.filter(({eventId:y})=>c.includes(y)).map(({matchUpId:y})=>n==null?void 0:n[y]).filter(({winningSide:y,score:b})=>y||gr({score:b}))),v=f&&!(g!=null&&g.length);if(f&&!v&&l.push(h),v){o.push(h);for(let y of i.events??[])for(let b of y.drawDefinitions??[]){let{extension:S}=dt({element:b,name:hu}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),Ct({element:b,extension:S}),Vy({drawDefinition:b}));let U=vn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let P=T.sides??[];for(let R of P){let D=R.lineUp??[];D.find(E=>E.participantId===h)&&(R.lineUp=D.filter(E=>E.participantId!==h),St({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else s.push(h);return!v});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!r&&{...d,cannotRemove:l,error:uT}||d}function JT({participantRole:t=Gr,individualParticipantIds:e=[],groupingTypes:i=[Ja,Oa],tournamentRecord:r}){if(!r)return{error:fe};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Gi({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=oW({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});c&&s++}),s?X:{error:TG}}function ch(t){var m,h,f;if(!(t!=null&&t.tournamentRecord))return{error:fe};if(!((m=t==null?void 0:t.participantIds)!=null&&m.length))return{error:Hc};let{addIndividualParticipantsToEvents:e,tournamentRecord:i,participantIds:r}=t,n=((h=i.participants)==null?void 0:h.length)||0;if(!n)return{...X};let a=(f=i.events||[])==null?void 0:f.filter(({eventType:g})=>g===or).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:I})=>I)}).flat(1/0),o=Gi({participantFilters:{participantIds:r},tournamentRecord:i,withDraws:!0}).participants??[],s=()=>{let g=(kr({matchUpFilters:{drawIds:a,matchUpTypes:[ri]},tournamentRecord:i}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:I})=>I)).flat().filter(Boolean);return Vi(g,r)},l=(a==null?void 0:a.length)&&s(),c=o.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(I=>(!(a!=null&&a.length)||!(a!=null&&a.includes(I.drawId)))&&I.positionAssignments).length});if(l!=null&&l.length||c.length)return{error:Ug};let u={},d={};for(let g of i.events||[]){let v=lb({participantIds:r,event:g});if(v.error)return v;u[g.eventId]=v.participantIdsRemoved}i.participants=i.participants.filter(g=>{let v=r.includes(g.participantId)||g.participantType===ot&&g.individualParticipantIds.some(I=>r.includes(I));if(!v&&g.participantType===or&&g.individualParticipantIds.some(I=>r.includes(I))&&(g.individualParticipantIds=g.individualParticipantIds.filter(I=>!r.includes(I))),v&&e&&[ot,Kt].includes(g.participantType))for(let I of g.individualParticipantIds||[])r.includes(I)||(d[g.participantId]||(d[g.participantId]=[]),d[g.participantId].push(I));return!v});let p=n-i.participants.length;if(JT({individualParticipantIds:r,tournamentRecord:i}),e)for(let g of i.events||[]){let v=u[g.eventId].map(I=>d[I]||[]).flat();wl({participantIds:v,entryStatus:Ho,tournamentRecord:i,event:g})}return p&&lt({payload:{participantIds:r,tournamentId:i.tournamentId},topic:bA}),p?{...X,participantsRemovedCount:p}:{error:uT}}function sW({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var l;let o=n.entries??[];if(r){let{flightProfile:c}=qi({event:n}),u=(l=c==null?void 0:c.flights)==null?void 0:l.find(d=>d.drawId===r);u?o=u.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&zo.includes(c.entryStatus)));return{entries:o,stageEntries:s}}function lW({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:fe};if(!r)return Q({result:{error:lr},stack:s});if(!o)return{error:ni};if(!o.eventType||![Uc,to].includes(o.eventType))return Q({result:{error:Ml},stack:s});let l=e.participants??[],c=l.find(I=>I.participantId===r);if(!c)return Q({result:{error:Li},stack:s});if(!c.participantType||![ot,Ja].includes(c.participantType)||c.participantType===Ja&&o.eventType!==to||c.participantType===ot&&o.eventType!==Uc)return{error:ms};let u=(o.entries??[]).find(I=>I.participantId===r);if(!u)return{error:EG};let{stageEntries:d}=sW({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),p=d.map(vt),m=l.filter(({participantId:I})=>p.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),h=(v=c.individualParticipantIds)==null?void 0:v.filter(I=>xs(I,m).length===1),f=lb({participantIds:[r],event:o});if(f.error||h!=null&&h.length&&(f=wl({participantIds:h,entryStatus:Ho,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),f.error))return f;let g;return t&&ch({participantIds:[r],tournamentRecord:e}).success&&(g=!0),{...X,participantRemoved:g}}function ZA({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return lW({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function uW(t){if(!t.tournamentRecord)return{error:fe};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=lW({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...X}:{error:n}}function FI(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",c=ab(t);if(c.error)return Q({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:m}=t,h=Nt({tournamentRecord:e,drawDefinition:r,event:p}).appliedPolicies??{};if([To,yu].includes(a)&&u){let{tournamentRecord:g}=t,{participant:v}=Kc({tournamentRecord:g,participantId:u}),{participantType:I,individualParticipantIds:y}=v??{};if(n&&I===ot){let b=ZA({tournamentRecord:g,drawDefinition:r,participantId:u,event:p});if(b.error)return Q({result:b,stack:l});y&&qS({participantIds:y,tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else qS({participantIds:[u],tournamentRecord:g,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let g=xa({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(g.error)return Q({result:g,stack:l})}let{structure:f}=Qe({drawDefinition:r,structureId:m});return NA({structure:f,drawPositions:[d]}),FT({appliedPolicies:h,drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),c}function cW(t){return Object.assign(t,{entryStatus:yu}),FI(t)}function LC(t){return Ki(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function Hr(t){return Ki(t)?LC(t.replace(/_/g," ")):""}var Ic=({finishingPosition:t=th,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let I={structureId:p??Vt(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:c};a&&(I.structureOrder=a),l&&(I.structureType=l),o&&(typeof o=="string"?I.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(I.seedingProfile=o.positioning)),u&&(I.matchUpType=u),m&&(I.roundOffset=m),f&&(I.stageOrder=f),h&&(I.roundLimit=h),v&&(I.stage=v),e&&(I.qualifyingRoundNumber=e);let y=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?I.structures=g:(I.matchUps=d,I.positionAssignments=mt(y).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),I},Wa=Ic;function QA({structureName:t=Hr(Rr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:xe};let a=Wa({stage:Rr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),ai({drawDefinition:i,structureIds:[a.structureId]}),{...X}}function eO({drawPositions:t}){if(!(t!=null&&t.length))return{error:Py};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=mt(i.map(XT)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function XT(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ar).join("|")}function dW({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),c=o.shift();a=[s,c,...a].filter(Boolean),o=[...o,l].filter(Boolean);let u=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return XT(m)}))}function ese({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:ze}}var tse={getRoundRobinGroupMatchUps:eO,determineRoundNumber:ese,drawPositionsHash:XT,groupRounds:dW};function ub(t){var U;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:r=1,structureOptions:n,appliedPolicies:a,seedingProfile:o,stage:s=Ae,matchUpType:l,roundTarget:c,structureId:u,groupNames:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g=t.structureName??((U=i==null?void 0:i["0"])==null?void 0:U.name)??Hr(Ae),{groupCount:v,groupSize:I}=ise({structureOptions:n,appliedPolicies:a,drawSize:p}),y=Ag,b,S=Re(1,v+1).map(T=>{let P=rse({groupSize:I,structureOrder:T,matchUpType:l,drawSize:p,idPrefix:m,isMock:h});b=Array.isArray(P)?Math.max(...P.map(({roundNumber:D})=>D??0)):0;let R=(d==null?void 0:d[T-1])??`${e} ${T}`;return Ic({structureId:f==null?void 0:f.pop(),structureType:CT,finishingPosition:y,structureOrder:T,structureName:R,matchUps:P})}),w=Ic({structureId:u??(f==null?void 0:f.pop()),structureType:En,finishingPosition:y,seedingProfile:o,structureName:g,stageSequence:r,structures:S,stage:s});return c&&Ct({extension:{name:ol,value:c},element:w}),{structures:[w],maxRoundNumber:b,groupCount:v,links:[],groupSize:I,...X}}function ise({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=cb({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&(a!=null&&a.includes(r))||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function cb(t){let{groupSizeLimit:e=10,drawSize:i=0}=t??{},r=Re(3,e+1).filter(n=>{let a=Math.ceil(i/n),o=a*n-i,s=Math.ceil(i/a),l=Math.ceil(o/a);return(!o||o<n)&&s===n&&s>=3&&l<2});return{...X,validGroupSizes:r}}function rse({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Re(1+s,i+1+s),c=eO({drawPositions:l}).uniqueMatchUpGroupings??[],u=dW({groupSize:i,drawPositionOffset:s});return c.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return u.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=XT(m),f=d(h),g=[1,r],v=nse({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),I={matchUpStatus:f?ji:xt,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(I.isMock=!0),I}}function nse({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Vt()}function tO(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!rt(i))return{seedBlocks:void 0,...Q({result:{error:le},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=Dg(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Re(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Re(f,f+m);f+=m,h.push(g)}return{...X,seedBlocks:h}}let a=Re(1,n+1),o=[],s=n/2;for(;s>1;){let m=Ar(a,s),h=m.length;m.forEach((f,g)=>{let v,I=g<h/2,y=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=I?S:b:v=y?b:S:v=I?b:S,bn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let c=Re(0,20).map(m=>Math.pow(2,m));c.unshift(1);let u=c.indexOf(n),d=0,p=[];return Re(0,u).forEach(m=>{p.push(o.slice(d,d+c[m])),d+=c[m]}),{...X,seedBlocks:p}}function iO({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!rt(e))return{seedGroups:void 0,...Q({result:{error:le},context:{drawSize:e},stack:i})};if(t){if(!rt(t))return{seedGroups:void 0,...Q({context:{roundRobinGroupsCount:t},result:{error:le},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Re(0,n).map(()=>{let a=Re(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=tO({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function rO({roundRobinGroupsCount:t,participantsCount:e}){var n;if(t){let{validGroupSizes:a}=cb({drawSize:e});if(!((n=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&n.includes(t)))return Q({context:{roundRobinGroupsCount:t},result:{error:le}})}let{seedGroups:i}=iO({drawSize:e,roundRobinGroupsCount:t}),r=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...X,seedingThresholds:r}}function kf(t){if(!t)return 1/0;if(rt(t))return Je(t);let e=t.split("-")[0];return rt(e)?Je(e):1/0}function ase({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ar),e.reverse(),e}function ose({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function sse({positioning:t,size:e}){let i=ase({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[cA,kd].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},c=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},u=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Re(1,e+1);for(let p of i)if(p===1){let m=Ar(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(c).filter(Boolean);f.length&&r.push(f)}else{let m=Ar(d,p).map(u).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function dh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var C;let s=[];if(!o)return{error:Gc};let{matchUps:l,roundMatchUps:c}=_t({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:u}=ro({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:d}=Ur({structure:o}),p=d==null?void 0:d.length,m=(u==null?void 0:u.length)??0,h=[],f=Object.keys(c).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=c[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!h.includes(F));return h=h.concat(...k),x}).filter(O=>O.length).reverse(),g=f.pop()??[],v=g&&Math.min(...g)-1||0;r=r??((C=i==null?void 0:i.seeding)==null?void 0:C.seedingProfile);let I=(g==null?void 0:g.length)||0,y=f.filter(O=>O.filter(k=>k<=m).length),{stage:b,structureType:S,roundLimit:w}=o,U=S===En,T=!U&&(f==null?void 0:f.length),P=!U&&b===We&&w,R=y.flat(1/0),D=T?R==null?void 0:R.length:0,E=a?p:m,N=GA({drawDefinition:n,structure:o,matchUps:l}),A=N?0:!T&&E||E&&R.length<E&&E-R.length||0;if(P){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=g.length/O;if(!T){let x=db(r),F=Ar(g,k),$=1,_=Re(0,F[0].length).map(()=>{let L=Re($,$+F.length);return $+=F.length,L});({validSeedBlocks:s}=pW({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else U?{validSeedBlocks:s}=lse({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):T?s=y.map(O=>({seedNumbers:O,drawPositions:O})):N&&Ar(g,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>s.push(O));if(!U&&!N&&!P){let{blocks:O}=use({drawPositionOffset:v,seedNumberOffset:D,seedCountGoal:A,seedingProfile:r,baseDrawSize:I});O.forEach(k=>s.push(k))}let M=s.flatMap(O=>O.drawPositions).reduce((O,k)=>(g==null?void 0:g.includes(k))&&O,!0);return!N&&!T&&!U&&!M?{error:iG,validSeedBlocks:[],isContainer:U,isFeedIn:T}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:U,isFeedIn:T}}function lse({seedingProfile:t,structure:e,nonRandom:i}){var u;let r=e.structures||[],n=r.length,a=(u=Qt({structure:e}))==null?void 0:u.positionAssignments,o=db(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=iO({roundRobinGroupsCount:n,drawSize:s}),c=r.map(d=>{var p;return(p=Qt({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return pW({drawPositionBlocks:c,positioning:o,seedGroups:l,nonRandom:i})}function pW({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=sse({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let c=ose({blockPattern:a,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>c.includes(g+1)&&f);e!==kd?m=r?m:fn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[u]}))})}),{validSeedBlocks:n}}function use(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:c}=tO({cluster:db(n)===cA,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>a)break;let p=d.map(h=>h+e),m=u(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function KS({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var l,c,u,d,p,m;let{structure:o}=Qe({drawDefinition:e,structureId:n});t||(t=Nt({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=dh({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((m=s.find(h=>h.seedNumbers.includes(a)))==null?void 0:m.drawPositions)||[]).includes(r):[].concat(...s.map(h=>h.drawPositions)).includes(r)}function mW(t){var E,N,A;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:r,seedBlockInfo:n,structureId:a,randomize:o}=t,{structure:s}=Qe({drawDefinition:i,structureId:a}),{seedAssignments:l}=ro({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:c}=Ur({structure:s}),u=(E=c==null?void 0:c.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:E.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:d}=Nt({drawDefinition:i}),p=((n==null?void 0:n.validSeedBlocks)||s&&((N=dh({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:r,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(C=>!(u!=null&&u.includes(C))).length)[0],m=l==null?void 0:l.map(M=>M.participantId).filter(Boolean),h=c==null?void 0:c.map(M=>M.participantId).filter(Boolean),f=m==null?void 0:m.filter(M=>h==null?void 0:h.includes(M)),g=m==null?void 0:m.filter(M=>!(h!=null&&h.includes(M))),v=l==null?void 0:l.filter(M=>g==null?void 0:g.includes(M.participantId)),I=l==null?void 0:l.filter(M=>!M.participantId),y=(v!=null&&v.length&&v.length>0?v.length:(I==null?void 0:I.length)??0)&&(p==null?void 0:p.drawPositions.filter(M=>!(u!=null&&u.includes(M))))||[],b=o?fn(y):y,S=[],w=b.map(()=>{var C;let M=(C=D(v,S))==null?void 0:C.participantId;return M&&S.push(M),M}).filter(Boolean),U=l==null?void 0:l.filter(M=>f==null?void 0:f.includes(M.participantId)).map(M=>M.seedNumber),T=((p==null?void 0:p.seedNumbers)||[]).filter(M=>!(U!=null&&U.includes(M))),P=l==null?void 0:l.filter(M=>T.includes(M.seedNumber)).map(M=>M.participantId),R=(A=d==null?void 0:d.seeding)==null?void 0:A.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:R===void 0||R?w:P,unplacedSeedNumbers:T,unfilledPositions:b,unplacedSeedAssignments:v};function D(M,C){let O=M.filter(F=>!C.includes(F.participantId)),k=Math.min(...O.map(F=>kf(F.seedValue))),x=O.filter(F=>kf(F.seedValue)===k);return fn(x).pop()}}function db(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Vg({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:c,event:u}){var S,w,U;let d="assignSeed",{structure:p}=Qe({drawDefinition:i,structureId:o}),{positionAssignments:m}=Ur({structure:p}),h=ro({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,f=h.map(T=>T.seedNumber),g=im({drawDefinition:i,participantId:n});if(n&&!g)return Q({result:{error:ps},context:{participantId:n},stack:d});let v=u?(w=(S=qi({event:u}).flightProfile)==null?void 0:S.flights)==null?void 0:w.length:0,I=v&&v>1,y=(U=m==null?void 0:m.find(T=>T.participantId===n))==null?void 0:U.drawPosition;if(y&&!KS({drawPosition:y,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return Q({result:{error:uN},context:{assignedDrawPosition:y},info:"invalid seed position",stack:d});f.includes(s)||h.push({seedNumber:s,seedValue:l});let b;return h.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!I&&(T.seedValue=l??s),b=!0)}),b?(az({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...X}):Q({result:{error:tG},stack:d})}function nO({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var p,m,h,f;let s=(m=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:m.sideNumber,l=s&&((h=a.sides)==null?void 0:h.find(g=>g.sideNumber===s)),{extension:c}=dt({element:n,name:hu}),u=(c==null?void 0:c.value)||{},d=ke(u[i],!1,!0);if(l)(f=a==null?void 0:a.sides)==null||f.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var I;return{...((I=a.sides)==null?void 0:I.find(y=>y.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}St({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function hW(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=$d({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===u),p=d==null?void 0:d.matchUpStatus,m=[tr,mr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function cse({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(ar).filter(Boolean),positionAdded:i,positionAssigned:r}}function fW({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:$d({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function gW({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=fW({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(u=>u.matchUpId===s),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(u=>{let d=Ki(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function iS({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function xf({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:c}){var E,N,A,M;let u="assignMatchUpDrawPosition";s||(s=Jr({drawDefinition:n})),t||(t=ur({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let d=t.find(C=>C.matchUpId===l),p=d==null?void 0:d.structureId,m=(E=n==null?void 0:n.structures)==null?void 0:E.find(C=>C.structureId===p);if(!m)return{error:Ti};let h=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(C=>C.matchUpId===l),f=(h==null?void 0:h.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:I}=cse({drawPosition:o,drawPositions:f}),{positionAssignments:y}=Qt({drawDefinition:n,structure:m}),b=(A=y==null?void 0:y.filter(C=>I.includes(C.drawPosition)))==null?void 0:A.find(({bye:C})=>C),S=(h==null?void 0:h.matchUpStatus)&&[Lt,Rt].includes(h.matchUpStatus)&&I.filter(Boolean).length<2;if(a=b&&xt||a||S&&h.matchUpStatus||(h==null?void 0:h.matchUpStatus)&&[tr,mr].includes(h.matchUpStatus)&&h.matchUpStatus||ji,h&&g){t=ur({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let C=S&&iS({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;h!=null&&h.matchUpStatusCodes&&gW({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:h}),Object.assign(h,{drawPositions:I,winningSide:C,matchUpStatus:a}),St({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:u,drawDefinition:n,matchUp:h})}let w=Un({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:U,loserMatchUp:T,loserTargetDrawPosition:P},targetLinks:{loserTargetLink:R}}=w,D=$d({structureId:m.structureId,matchUpsMap:s});if(v&&b){if(U)if([xt,tr,mr].includes(a)){let C=xf({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(C.error)return C}else{let{structureId:C}=U;C!==m.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(U&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=hW({targetMatchUp:h,drawPosition:o,matchUpsMap:s,structure:m});if(C){let O=xf({matchUpId:U.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((h==null?void 0:h.matchUpType)===ci){let C=t==null?void 0:t.find(({matchUpId:x})=>x===h.matchUpId),O=((C==null?void 0:C.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(M=y==null?void 0:y.find(x=>x.drawPosition===o))==null?void 0:M.participantId;k&&O!==void 0&&nO({inContextTargetMatchUp:C,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:h})}if((R==null?void 0:R.linkCondition)===xl&&I.filter(Boolean).length===2&&!b&&D.filter(({drawPositions:C,roundNumber:O})=>O===1&&bn(C,I)).every(({matchUpStatus:C})=>[_i,nn].includes(C))&&T){let{structureId:C}=T,O=xa({drawPosition:P,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:s,event:c});if(O.error)return O}return v?{...X}:Q({result:{error:If},context:{drawPosition:o},stack:u})}function vW({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var u,d,p,m;let a=((p=(d=(u=Og({drawDefinition:e}))==null?void 0:u.containedStructures)==null?void 0:d[n.structureId])==null?void 0:p.map(({structureId:h})=>h))||[];a.push(n==null?void 0:n.structureId);let o=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],s=(t==null?void 0:t.filter(h=>a.includes(h.structureId)&&Vi(h.drawPositions??[],o).length))??[],l=s.map(({matchUpId:h})=>h),c=((m=r==null?void 0:r.drawMatchUps)==null?void 0:m.filter(h=>l.includes(h.matchUpId)))??[];return{drawPositions:o,matchUps:c,targetMatchUps:s}}function aO({lineUp:t}){if(!Array.isArray(t))return;let e={};return mt(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=zS({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Uu(t){return`${t} must be an array`}function ZT({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Uu("lineUp")),{valid:!1,errors:i,error:le};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Uu("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=mt(t.map(vt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?le:void 0}}function ph({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:xe};if(typeof e!="string")return{error:lr};let n=ZT({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=dt({element:t,name:hu}),o=(a==null?void 0:a.value)||{};return o[e]=aO({lineUp:r}),Ct({element:t,extension:{name:hu,value:o}}),Vy({drawDefinition:t}),{...X}}function oO({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:xe};let{drawPositions:l,matchUps:c,targetMatchUps:u}=vW({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of u)d.matchUpType===zs&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let f=c.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&ph({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}St({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...X}}function Ws({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var T,P,R;let m="assignDrawPosition";if(!s&&!i)return Q({result:{error:lr},stack:m});u=u??Jr({drawDefinition:a}),e||({matchUps:e}=ur({inContext:!0,drawDefinition:a,matchUpsMap:u}));let h=Qe({drawDefinition:a,structureId:d});if(h.error)return Q({result:h,stack:m});let{structure:f}=h;if(!f)return{error:Ti};if(Wn({structure:f}))return Q({result:{error:zn},stack:m});let{seedAssignments:g}=ro({provisionalPositioning:t,drawDefinition:a,structure:f}),v=(T=g==null?void 0:g.find(D=>D.participantId===s))==null?void 0:T.seedNumber,{appliedPolicies:I}=Nt({tournamentRecord:n,drawDefinition:a,structure:f,event:p});if(v&&!KS({seedNumber:v,appliedPolicies:I,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return Q({result:{error:uN},context:{drawPosition:c},stack:m});let y=Ur({structure:f}).positionAssignments||[],b=y==null?void 0:y.find(D=>D.drawPosition===c);if(!b)return Q({result:{error:Ig},context:{drawPosition:c},stack:m});if(y!=null&&y.map(vt).includes(s))return Q({result:{error:Ug},context:{drawPosition:c},stack:m});let{containsParticipant:S,containsBye:w}=U(b);if(w){let D=ab({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(D.error)return Q({result:D,stack:m})}if(S&&b.participantId!==s){let{activeDrawPositions:D}=nb({drawDefinition:a,structureId:d});if(D.includes(c))return Q({result:{error:nT},stack:m});oO({assignments:[b],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:f})}if(b.participantId=s,i&&(b.qualifier=!0),((f==null?void 0:f.stageSequence)||0)>1||f.stage&&[Wr,xi].includes(f.stage)){let D=f.stage===We?We:Ae,E=(((R=(P=a.structures)==null?void 0:P.find(N=>(N==null?void 0:N.stage)===D&&(N==null?void 0:N.stageSequence)===1))==null?void 0:R.seedAssignments)??[]).find(N=>N.participantId===s);if(E!=null&&E.participantId){let{participantId:N,seedNumber:A,seedValue:M}=E;Vg({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:A,seedValue:M,structureId:d,event:p})}}if(f.structureType!==En)dse({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:f,event:p});else{Yz({positionAssignments:y,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:f});let{drawPositions:D,matchUps:E,targetMatchUps:N}=vW({assignments:[b],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:f});if(D&&(E==null?void 0:E.length)===1&&E[0].matchUpType===ci){let A=((N==null?void 0:N[0].sides)??[]).reduce((M,C,O)=>D!=null&&D.includes(C.drawPosition)?O:M,void 0);nO({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:E[0],drawPositionSideIndex:A,tournamentRecord:n,drawDefinition:a})}}return Ec({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:f,event:p}),{positionAssignments:y,...X};function U(D){let E=D.bye,N=D.qualifier,A=D.participantId;return{containsBye:E,containsQualifier:N,containsParticipant:A,filled:E||N||A}}}function dse({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=_t({provisionalPositioning:t,matchUpFilters:c,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=wn({matchUps:u}),{initialRoundNumber:p}=Rm({drawPosition:a,matchUps:u}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=xf({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return Q({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...X}}function sO(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:xe};let d=Nt({tournamentRecord:n,drawDefinition:a,event:c}).appliedPolicies??{},{inContextDrawMatchUps:p,matchUpsMap:m}=t;m||(m=Jr({drawDefinition:a}),Object.assign(t,{matchUpsMap:m})),p||({matchUps:p}=ur({inContext:!0,drawDefinition:a,matchUpsMap:m}),Object.assign(t,{inContextDrawMatchUps:p}));let{positionAssignments:h}=Qt({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,S=Ws({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:c});return S.success?y({appliedPolicies:d,removedParticipantId:b}):Q({result:S,stack:u})}let g=ab({inContextDrawMatchUps:p,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:m,event:c});if(g.error)return Q({result:g,stack:u});let v=g.participantId,I=Ws({inContextDrawMatchUps:p,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:m,event:c});if(!I.success)return Q({result:I,stack:u});return y({appliedPolicies:d,removedParticipantId:v});function y({appliedPolicies:b,removedParticipantId:S}){let{structure:w}=Qe({drawDefinition:a,structureId:l});NA({drawPositions:[s],structure:w});let U={[e]:o,name:r,drawPosition:s,structureId:l};return FT({appliedPolicies:b,drawDefinition:a,positionAction:U}),Q({context:{removedParticipantId:S},result:{...X},stack:u})}}function pse({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function IW(t){return pse(t)}function mse({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function yW(t){return mse(t)}function bW({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],St({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function wW(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=it(t,i);if(r.error)return r;let n=Qe(t);if(n.error)return n;let a=n.structure;if(!Wn({structure:a}))return Q({result:{error:sp,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=wn({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Fu}}function UW(t){var u;let e=wW(t,[{targetRoundNumber:!0,roundNumber:!0,[so]:xne}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(n!=null&&n.includes(o))||!(n!=null&&n.includes(a)))return Q({result:{error:le},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Re(o+1,a+1):Re(a,o),c={};return l.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(s?1:-1)})),(u=r==null?void 0:r[o])==null||u.forEach(({matchUpId:d})=>c[d]=a),bW({params:t,modMap:c,structure:i}),{...X}}function SW({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var s;if(!r)return{error:xe};if(!Array.isArray(t))return{error:le};let a="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=Qe({drawDefinition:r,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:Ti};let m=(s=Qt({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),h=u==null?void 0:u.map(({drawPosition:v})=>v);if(Vi(m,h).length!==(m==null?void 0:m.length))return Q({result:{error:le},info:"drawPositions do not match",stack:a});let f=Jr({drawDefinition:r}),{matchUps:g}=ur({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of u||[]){let{drawPosition:I,participantId:y,bye:b,qualifier:S}=v;if(b){let w=xa({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:f,structureId:c,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)u.forEach(w=>{w.drawPosition===I&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(y){let w=Ws({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:y,drawPosition:I,matchUpsMap:f,structureId:c,event:n});if(w!=null&&w.error)return w}}Ec({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let o=t.map(({structureId:l})=>l);return ai({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:o}),{...X}}function TW(t){let e=wW(t,[{roundNumbers:!0,[so]:Mn,[ea]:o=>o.length===2&&o.every(Mi)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return Q({result:{error:le,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),bW({params:t,modMap:a,structure:i}),{...X}}function hse({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return sO({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function DW(t){return hse(t)}function PW({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:xe};if(!n)return{error:Aa};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:ps};let{structure:l}=Qe({drawDefinition:i,structureId:n});if(!l)return{error:Ti};if(!(!t||Mi(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Mi(p)&&Je(p)>0)))return{error:le};let{seedAssignments:c}=ro({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return az({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...X}}function RW({drawDefinition:t,structureId:e}){if(!t)return{error:xe};let{structure:i}=Qe({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function QT({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:ni};let s={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Oo({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function lO({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:fe};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=QT({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:c,stage:o});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Cc(t){if(!(t!=null&&t.drawDefinition))return!1;let e=YT(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===ci),n=n==null?void 0:n.filter(({matchUpType:o})=>o===ci),a=a==null?void 0:a.filter(({matchUpType:o})=>o===ci)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function uO(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:xe};let{playoffStructures:r}=RW({drawDefinition:e,structureId:i});if(!(r!=null&&r.length))return!1;let n=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&zo.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(r||[]).reduce((l,c)=>{var u;return!!((u=Qt({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!r.length)||a===n}function _C({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=_C({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=_C({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function fse({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:bN};if(!Array.isArray(r))return{error:Cy};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=EW({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function EW({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:bN};if(!r)return{error:Km};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");n.push(..._C({significantCharacters:c,value:r,accessors:u}))}else if(o){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var h;let m=i.find(f=>f.participantId===p);if((h=m==null?void 0:m.individualParticipantIds)!=null&&h.includes(r.participantId)){let f=m==null?void 0:m.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(r.participantId)&&n.push(u)})}),{values:mt(n)}}function UB({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=EW({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function CW({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function gse(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=CW(t);return i.map(a=>{let o=e.filter(c=>a.includes(c)),s=n(o),l=o.filter(c=>!s.includes(c)).filter(c=>{var d;let u=SB(c);return!((d=r[u])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=SB(s);return!a.includes(l)}}}function vse(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=CW(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var c;return(c=r[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function SB(t){return Number(t%2?t+1:t-1)}function Ise({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function yse({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?vse({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):gse({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function MW({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function bse({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var c;let a=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),o=Object.keys(a).reduce((u,d)=>a[d].length>u?a[d].length:u,0),s=Object.keys(a).filter(u=>a[u].length===o),l=Zn(i?s:Object.keys(a));return n=t&&((c=a[n])!=null&&c.length)?n:l,{participantId:n&&a[n]?Zn(a[n]):Zn(e),groupKey:n}}function wse({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function Use({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,P)=>P.length>T?P.length:T,0)<=2,c=MW({positionAssignments:t,participantIds:e}),u=wse({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=bse({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=Ise({participantId:d,allGroups:o}),h=yse({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:u}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,I=(v==null?void 0:v.length)&&v[0],y=(g==null?void 0:g.length)&&g[0],b=a&&I?I:y,S=a?y:I,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=ia(w);U=ia(T)}else{let T=ia(f[0]);U=ia(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function JS({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=eO({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{bn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;bn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function Sse({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(o!=null&&o.includes(c))).filter(c=>{let u=i.find(f=>f.includes(c)).find(f=>f!==c),d=t.find(f=>f.drawPosition===u),p=JS({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===c),d],h=JS({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function TB(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(y=>y==null?void 0:y.length).filter(Boolean)),p=d>2,m=ke(e,!1,!0).filter(y=>!y.qualifier),h=e.filter(y=>!y.participantId&&(!y.bye||(n==null?void 0:n.includes(y.drawPosition)))).map(y=>y.drawPosition);Re(0,r).forEach(()=>{let{newGroupKey:y,selectedParticipantId:b,targetDrawPosition:S}=Use({...t,candidatePositionAssignments:m,allGroups:l,groupKey:u});u=y,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=UB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Ar(f,d),v=JS({groupedParticipants:g,isRoundRobin:p}),I=0;for(;I<20&&v.length;){let y=Sse({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(y.length){let b=Tse({candidatePositionAssignments:m,swapOptions:y});b.error&&console.log({result:b}),f=UB({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Ar(f,d),v=JS({groupedParticipants:g,isRoundRobin:p}),I++}else I=20}return m.forEach(y=>{if(y.bye&&y.participantId){let b=hC;c.push(b)}if(y.qualifier&&y.participantId){let b=hC;c.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:c}}function Tse({candidatePositionAssignments:t,swapOptions:e}){let i=ia(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ia(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===r),o=t.find(c=>c.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...X}}function Dse({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var $;if(!u)return{error:pG};let{candidatesCount:m=1,policyAttributes:h,targetDivisions:f}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:I}=Qe({drawDefinition:a,structureId:c}),{matchUps:y}=_t({provisionalPositioning:t,matchUpsMap:l,structure:I,event:p});if(f&&hs(f)&&!g){let _=one(f)||0,L=y.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);g=L<_?1:L-_+1}let{positionAssignments:b}=Ur({structure:I}),S=AA({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=b==null?void 0:b.filter(_=>!_.participantId),U=b==null?void 0:b.map(_=>_.drawPosition),T=(I==null?void 0:I.structureType)===En,P=T?{structure:I,matchUps:y,allDrawPositions:U,roundsToSeparate:g}:{matchUps:y,allDrawPositions:U,roundsToSeparate:g},{drawPositionGroups:R,drawPositionChunks:D}=T?Pse(P):Rse(P),E={groupParticipants:s.filter(_=>_.participantType===Oa).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===Kt).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===ot).map(_=>_.participantId)},N=fse({targetParticipantIds:e,policyAttributes:h,idCollections:E,participants:s});if(N.error)return Q({result:N,stack:v});let A=Object.assign({},...e.map(_=>{let L=Object.keys(N).filter(B=>(N[B]??[]).includes(_));return{[_]:L}})),M=MW({participantIds:e,positionAssignments:b});if(M.length>((w==null?void 0:w.length)||0))return{error:PN};let C,O=M.length,k=Re(0,m).map(()=>TB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:D,drawPositionGroups:R,policyAttributes:h,idCollections:E,allGroups:N,drawSize:d}));if(C=k.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!C||C.conflicts){let _=Re(0,m).map(()=>TB({initialPositionAssignments:b,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:r,participantIdGroups:A,drawPositionChunks:D,drawPositionGroups:R,policyAttributes:h,idCollections:E,allGroups:N,drawSize:d}));C=k.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!C)return{error:pT};let x=((($=Qt({structure:I}))==null?void 0:$.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),F=C.positionAssignments.filter(_=>!x.includes(_.participantId));for(let _ of F)if(_.bye){let L=xa({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,..._});if(L.error)return Q({result:L,stack:v})}else if(_.participantId){let L=Ws({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,..._});if(L.error)return Q({result:L,stack:v,context:{assignment:_}})}return{...X}}function Pse(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function Rse({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),n=r.flat().sort(ar),a=Math.max(...n),o=t.filter(u=>u>a),s=n.length,l=Re(s===2?1:2,s).filter(u=>u===_N(u)),c=l.slice(0,e||l.length).reverse().map(u=>Ar(n,u));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:c}}function Ese({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var P,R;let m="positionUnseededParticipants";u||({structure:u}=Qe({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:h}=Ur({structure:u}),{seedAssignments:f}=ro({provisionalPositioning:t,drawDefinition:a,structure:u}),g=f==null?void 0:f.map(D=>D.participantId).filter(Boolean),{stage:v,stageSequence:I}=u,y=v===We?(R=(P=dt({element:u,name:ol}))==null?void 0:P.extension)==null?void 0:R.value:void 0,b=ah({provisionalPositioning:t,drawDefinition:a,stageSequence:I,entryStatuses:hp,structureId:c,roundTarget:y,stage:v}),S=b.filter(D=>!(g!=null&&g.includes(D.participantId))).map(D=>D.participantId),w=h==null?void 0:h.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!r&&S.length>((w==null?void 0:w.length)||0))return Q({result:{error:PN},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:m});let{appliedPolicies:U}=Nt({tournamentRecord:n,drawDefinition:a,event:p}),T=U==null?void 0:U[_S];if(u.stage===xi){let D=b.reduce((E,N)=>(E[N.groupingValue]||(E[N.groupingValue]=[]),E[N.groupingValue].push(N.participantId),E),{});Object.keys(D).length&&(T||(T={policyName:"Playoff Avoidance"}),T.policyAttributes||(T.policyAttributes=[]),T.policyAttributes.push({groupings:D}))}return T&&s?Dse({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:T,drawSize:d,entries:b}):Cse({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function Cse({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?fn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=Ws({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:c,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return Q({result:f,stack:"randomUnseededDistribution"})}}return{...X}}function Mse(t){let e=t.structure??Qe(t).structure,i="positionQualifiers",r=[];if(e.stage===Wr)return Q({result:{error:lp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=Nse(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(c=>o[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(n[s]>(l||0))return Q({result:{error:NG},context:{unfilledDrawPositions:l},stack:i});Re(0,n[s]).forEach(()=>{let c=ia(l);r.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...X,qualifierDrawPositions:r}}function Nse({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=Qe({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Ur({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=$g({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>Je(f)),{matchUps:c}=_t({structure:e}),{roundProfile:u}=wn({matchUps:c}),d=Object.assign({},...l.filter(f=>u==null?void 0:u[f]).map(f=>{var g,v;return{[f]:((v=(g=u==null?void 0:u[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var I,y;return v.qualifier&&((y=(I=d[f])==null?void 0:I.drawPositions)==null?void 0:y.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function DB({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=Qe({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),r||(r=Nt({drawDefinition:a}).appliedPolicies),!n){let v=p&&dh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return c=c??(n==null?void 0:n.length)??0,Re(0,c).forEach(()=>{if(g<(c||0)){let v=Ase({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...X,seedPositions:h}}function Ase({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=mW({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:c}),{appliedPolicies:p}=Nt({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(u==null?void 0:u.length)>2;let h=[];for(let f of u){let g=d.pop();if(!g)return{error:yg};h.push(g);let v=Ws({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...X,seedPositions:h}}function Ose({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Ur({structure:i}),{seedAssignments:n}=ro({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function kse({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=$C(Ar(a.drawPositions,2)),s,l=t[r.length];for(;s=rS(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?fn(a):a).flat(1/0);return QG(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function rS(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return rS(e?n:t[Math.round(Math.random())],e)}return i<r?rS(t[1],e):rS(t[0],e)}function $C(t){let e=Math.floor(t.length/2);return t.length>2?[$C(t.slice(0,e)),$C(t.slice(e))]:t}function xse({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var b;a||(a=dh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;(b=i==null?void 0:i.seeding)!=null&&b.containerByesIgnoreSeeding&&(d=[]);let p=Ose({provisionalPositioning:t,drawDefinition:r,structure:s})??[],m=mt([].concat(...e.map(S=>S.drawPositions))),h=p.filter(S=>m.includes(S.drawPosition)),f=(S,w)=>kf(S.seedValue)-kf(w.seedValue),g=d.reduce((S,w)=>{let U=h.filter(T=>{var P;return(P=w.drawPositions)==null?void 0:P.includes(T.drawPosition)}).sort(f);return S.concat(...U)},[]).map(S=>S.drawPosition),v=kse({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),I=PB({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),y=PB({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:I,blockSeedOrderByePositions:y,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function PB({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function Fse({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var M,C;let l=(M=r==null?void 0:r.seeding)==null?void 0:M.seedingProfile,c=o.stage===We,{positionAssignments:u}=Ur({structure:o}),d=u==null?void 0:u.filter(O=>O.participantId).map(O=>O.drawPosition),p={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:h}=_t({provisionalPositioning:t,matchUpFilters:p,structure:o}),f=(h==null?void 0:h[1])||[],g=o.structureType===En?m:f,v=mt([].concat(...g.map(O=>O.drawPositions))),I=Math.min(...v)-1,y=d==null?void 0:d.filter(O=>v.includes(O)),b=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(H=>[].concat(...H.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=fn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},S=O=>{let{greaterHalf:k,lesserHalf:x}=b(O),{greaterHalf:F,lesserHalf:$}=b(k),_=fn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},w=O=>!e.includes(O),U=O=>!(y!=null&&y.includes(O)),T=O=>{let k=Ar(O.sort(ar),Math.ceil(O.length/4)).map($=>$.filter(U)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=S(k);F.push(L),k=_}return F},{validSeedBlocks:P}=dh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),R=P==null?void 0:P.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+I)}),D;if(s){let O=v.length,{seedBlocks:k}=tO({cluster:db(l)===cA,participantsCount:O});D=k.map(x=>x.map(F=>F+I)).map(T).filter(x=>x.length)}else c?D=R==null?void 0:R.map(O=>O.filter(U)):D=R==null?void 0:R.map(T).filter(O=>O.length);let E=g.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),N=O=>E.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),A=D.map(O=>O.map(N)).flat(1/0).filter(U).filter(w).filter(Boolean);if(c&&!o.structures){let O=a%4,k=A.slice(0,O),x=(C=h[o.roundLimit])==null?void 0:C.length,F=Ar(A.slice(O),x).map(fn).flat();A=k.concat(F)}return{unseededByePositions:A}}function Lse({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var R;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=_t({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:r,event:n}),l=(s==null?void 0:s[1])||[],c=(r==null?void 0:r.structureType)===En,u=c?o:l,d=c?((R=r==null?void 0:r.structures)==null?void 0:R.length)||0:o.length,{structureId:p,stage:m,stageSequence:h}=r,f=ah({entryStatuses:zo,provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),{qualifiersCount:g}=$g({provisionalPositioning:t,drawDefinition:e,stageSequence:h,structureId:p,stage:m}),v=f.length+g,{positionAssignments:I,unassignedPositions:y}=Ur({structure:r}),b=y==null?void 0:y.map(D=>D.drawPosition),S=I==null?void 0:I.filter(D=>D.bye).length,w=I==null?void 0:I.filter(D=>D.bye).map(D=>D.drawPosition),U=u.map(D=>D.drawPositions).filter(D=>D==null?void 0:D.reduce((E,N)=>!(w!=null&&w.includes(N))&&E,!0)).flat(1/0).filter(D=>b==null?void 0:b.includes(D)),T=I==null?void 0:I.length,P=T?T-v:0;return P>d&&r.stageSequence===1&&r.stage!==Wr&&(P=d),{placedByes:S,byesCount:P,relevantMatchUps:u,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:U}}function RB({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var E;l||({structure:l}=Qe({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===We),{byesCount:m,placedByes:h,relevantMatchUps:f}=Lse({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),g=m-(h||0);if(g<=0)return{...X};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:I,isLuckyStructure:y,isFeedIn:b}=xse({provisionalPositioning:t,relevantMatchUps:f,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:g,structure:l}),S=(l==null?void 0:l.structureType)&&[En,CT].includes(l.structureType)&&((E=i==null?void 0:i.seeding)==null?void 0:E.containerByesIgnoreSeeding),w=p&&(I!=null&&I.length)?I:v,{unseededByePositions:U}=Fse({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:y,appliedPolicies:i,drawDefinition:r,seedLimit:c,structure:l,isFeedIn:b}),T=N=>N%2,P=(N,A)=>(N||[]).every(M=>T(M)?A!==M+1:A!==M-1),R=[].concat(...w);if(!u)for(;U.length;){let N=U.find(A=>P(R,A));N?(R.push(N),U=U.filter(A=>A!==N)):(R.push(...U),U=[])}S&&(R=fn(R),Ra({ignoreSeededByes:S})&&console.log({byePositions:R}));let D=R.slice(0,g);for(let N of D){let A=xa({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...X,unseededByePositions:U,byeDrawPositions:D}}function pb(t){var M,C,O,k;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:r,multipleStructures:n,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:m,event:h}=t,f=[];i||(sH(),e=ke(e,!1,!0));let g=x=>(i||KU(),Q({result:x,stack:"automatedPositioning"})),v=x=>(i||KU(),x),I=Qe({drawDefinition:e,structureId:c});if(I.error)return g(I);let y=I.structure;if(!y)return{error:Ti};let b=t.appliedPolicies||((M=Nt({drawDefinition:e,structure:y,event:h}))==null?void 0:M.appliedPolicies),{qualifiersCount:S}=$g({stageSequence:y.stageSequence,provisionalPositioning:r,stage:y.stage,drawDefinition:e,structureId:c}),w=hp;if(!((C=ah({stageSequence:y.stageSequence,provisionalPositioning:r,stage:y.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:c}))!=null&&C.length)&&!S)return v({...X});let U=t.matchUpsMap??Jr({drawDefinition:e}),T=t.inContextDrawMatchUps??((O=ur({inContext:!0,drawDefinition:e,matchUpsMap:U}))==null?void 0:O.matchUps),P=[],R=dh({provisionalPositioning:r,appliedPolicies:b,drawDefinition:e,seedingProfile:l,structure:y});if(R.error)return R;let{validSeedBlocks:D}=R;f.push({validSeedBlocks:D});let E=t.participants||(o?(k=Gi({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:k.participants:[]);if(db(y.seedingProfile||l)===kd){let x=a?RB({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:R,matchUpsMap:U,structure:y,seedLimit:u,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);P=x.unseededByePositions,f.push({action:"positionByes",unseededByePositions:P});let F=y.seedingProfile?{positioning:y.seedingProfile}:l;if(x=DB({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:D,drawDefinition:e,seedBlockInfo:R,participants:E,matchUpsMap:U,structure:y,event:h}),x.error)return g(x);f.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(p!==cp){let F=y.seedingProfile?{positioning:y.seedingProfile}:l,$=DB({seedingProfile:F,provisionalPositioning:r,inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:D,drawDefinition:e,seedBlockInfo:R,participants:E,matchUpsMap:U,structure:y,event:h});if($.error)return g($);f.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=a?RB({provisionalPositioning:r,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:R,matchUpsMap:U,structure:y,seedLimit:u,seedsOnly:d,event:h}):void 0;if(x!=null&&x.error)return g(x);P=x==null?void 0:x.unseededByePositions,f.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:P})}let N={};if(!d){let x=Mse({inContextDrawMatchUps:T,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:D,drawDefinition:e,seedBlockInfo:R,participants:E,matchUpsMap:U,structure:y});if(x.error||(x.conflicts&&(N.qualifierConflicts=x.conflicts),f.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=Ese({provisionalPositioning:r,inContextDrawMatchUps:T,unseededByePositions:P,multipleStructures:n,tournamentRecord:o,drawDefinition:e,seedBlockInfo:R,participants:E,matchUpsMap:U,structureId:c,structure:y,drawSize:m,event:h}),x.error))return g(x);x.conflicts&&(N.unseededConflicts=x.conflicts),f.push({action:"positionUnseededParticipants"})}let{positionAssignments:A}=Qt({drawDefinition:e,structure:y});return ai({drawDefinition:e,structureIds:[c]}),i||KU(),{positionAssignments:A,conflicts:N,...X,positioningReport:f}}function mb(t){var m;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l,event:c}=t;if(!c)return{error:sa};if(!n)return{error:Pa};if(!Cc({drawDefinition:n,structureId:o})&&!i)return{error:lN};let u=(m=RW({drawDefinition:n,structureId:o}).playoffStructures)==null?void 0:m.sort((h,f)=>jS(h)-jS(f)),d=[],p=[];if(u)for(let h of u){let{structureId:f}=h,g=pb({structureId:f,provisionalPositioning:i,applyPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,placeByes:s,seedsOnly:l});if(g.error)return g;g.positionAssignments&&d.push({positionAssignments:g.positionAssignments,structureId:f}),g.positioningReport&&p.push(g.positioningReport)}return{...X,structurePositionAssignments:d,positioningReports:p}}function NW({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>rt(i)))&&Q({result:{error:le},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>bf(i.structureOrder)-bf(r.structureOrder)),{...X}):{error:xe}}function eD({drawDefinition:t}){var g,v,I,y,b,S,w;let e=t.structures??[],i=t.links??[],r=new Map,n=U=>{let T=r.get(U)||r.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&r.get(U);if(T&&!(T!=null&&T.stage)){let P=e.find(R=>R.structureId===U);T.stage=P==null?void 0:P.stage}return T},a={},o={},s=i.map(U=>{let T=U.source.structureId,P=U.target.structureId,R=n(T),D=n(P);return[xd,wo,MT,kd].includes(U.target.feedProfile)?(R==null||R.targets.push(P),D==null||D.sources.push(T)):U.target.feedProfile===yo&&(D==null||D.drawSources.push(T),R==null||R.drawTargets.push(P)),o[P]=o[P]||U.target.feedProfile===yo,a[P]=mt([...a[P]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of r.keys()){let T=r.get(U);if(T){let P=T.targets??[];for(;P.length;){let R=P.pop(),D=R&&r[R];(g=D==null?void 0:D.targets)!=null&&g.length?P.push(...D.targets):D&&(T.rootStage=D.stage)}if(T.rootStage||(T.rootStage=T.stage),!((v=T.targets)!=null&&v.length)){let R=T.sources??[];for(;R.length;){let D=R.pop(),E=D&&r[D];if((I=E==null?void 0:E.sources)!=null&&I.length){for(let N of E.sources)(y=T.progeny)!=null&&y.includes(N)||((b=T.progeny)==null||b.push(N));R.push(...E.sources)}}}}}let l=0;for(let U of r.keys()){let T=r.get(U);if(T&&T.rootStage===We){let P=[(S=T.drawTargets)==null?void 0:S[0]],R=0;for(;P.length;){R+=1;let D=P.pop(),E=D?r.get(D):void 0;(w=E==null?void 0:E.drawTargets)!=null&&w.length&&P.push(E.drawTargets[0])}T.distanceFromMain=R,R>l&&(l=R)}}let c=s.length;Re(0,Math.ceil(c/2)).forEach(()=>{s=Re(0,c).map(U=>{let T=s[U],P=s.reduce((R,D)=>bn(T,D)?R.concat(...D):R,[])||[];return mt(T.concat(...P))})});let u=s[0],d=(U,T)=>Vi(U,T).length===U.length,p=s.slice(1).reduce((U,T)=>U&&d(T,u),!0),m=[u].filter(Boolean),h=[u].filter(Boolean);e.forEach(U=>{let{structureId:T,stage:P}=U;m.find(R=>R.includes(T))||(m.push([T]),P!==Rr&&h.push([T]))});let f=p&&h.length===1;return!(i!=null&&i.length)&&e.length===1&&n(e[0].structureId),{structureProfiles:Object.fromEntries(r),allStructuresLinked:f,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:m}}function AW({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=eD({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...X}}function Jl(t){let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:r,timeItem:n}=t;if(!n)return{error:MN};let a=cz(t);if(a.error)return a;if(!(Ut(n)&&Ki(n.itemType)&&Object.keys(n).includes("itemValue")))return{error:CN};if(!a.timeItems)a.timeItems=[];else if(_se({element:a,duplicateValues:e,timeItem:n}))return{...X};if(n.itemSubTypes&&!n.itemSubTypes.length&&delete n.itemSubTypes,i){let o=new Date().toISOString();Object.assign(n,{createdAt:o})}return r&&(a.timeItems=a.timeItems.filter(({itemType:o})=>n.itemType!==o)),r&&!n.itemValue||a.timeItems.push(n),{...X}}function _se({element:t,duplicateValues:e,timeItem:i}){var s;let{itemType:r,itemSubTypes:n,itemValue:a}=i,o=r&&((s=Go({itemSubTypes:n,itemType:r,element:t}))==null?void 0:s.timeItem);return o&&JSON.stringify(o==null?void 0:o.itemValue)===JSON.stringify(a)&&!e}function cO({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:fe};if(!n)return{error:lr};let o=Kc({tournamentRecord:i,participantId:n});return o.error?o:Jl({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function mh(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;return i?Jl({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a}):{error:fe}}function hh(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?Jl({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:sa}}function dO({tournamentRecord:t,drawDefinition:e,structure:i,link:r}){if(!t)return{error:fe};if(!e)return{error:xe};let n=$se({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:r});if(n.error)return n;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return mh({tournamentRecord:t,timeItem:a}),n}function $se({drawDefinition:t,tournamentId:e,structure:i,eventId:r,link:n}){var l;if(!t)return{error:xe};if(!i)return{error:Gc};if(!n)return{error:mN};let a=n.target.structureId,o=Qe({drawDefinition:t,structureId:a});if(o.error)return Q({stack:"attachQualifyingStructure",context:{targetStructureId:a},result:o});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(n),AW({drawDefinition:t});let s=((l=_t({structure:i}))==null?void 0:l.matchUps)||[];return Rc({drawDefinition:t,tournamentId:e,matchUps:s,eventId:r}),ai({drawDefinition:t,structureIds:[i.structureId]}),{...X}}function OW({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:le};if(!t)return{error:xe};let i=Object.assign({},...e.map(r=>{if(!Ut(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:ze};for(let r of t.structures||[]){let n=i[r.structureId];if(n&&(r.structureName=n),r.structures)for(let a of r.structures){let o=i[a.structureId];o&&(a.structureName=o)}}return{...X}}function pO({drawDefinition:t,timeItem:e}){if(!t)return{error:Pa};if(!e)return{error:MN};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:CN};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),Vy({drawDefinition:t}),{...X}}function kW(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:r,event:n}=t,a=it(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(I=>I.structureId===r);if(!s)return{error:Ti};let l=o.find(({stage:I,stageSequence:y})=>I===Ae&&y===1),c=r===(l==null?void 0:l.structureId),u=o.filter(({stage:I})=>I===We).map(ca("structureId"));if(c&&!u.length)return{error:zj};let d=u.includes(r),p=Bse({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:m,relatedStructureIdsMap:h}=jse({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:r}),{removedMatchUpIds:f,removedStructureIds:g}=Gse({relatedStructureIdsMap:h,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:m,structureId:r});if(Vse({removedMatchUpIds:f,drawDefinition:i}),c){let I=(v=l.matchUps??[])==null?void 0:v.map(ca("matchUpId"));f.push(...I),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&AW({drawDefinition:i}),$u({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:f,action:"removeStructure",eventId:n==null?void 0:n.eventId,drawDefinition:i}),ai({drawDefinition:i,eventId:n==null?void 0:n.eventId}),{...X,removedMatchUpIds:f,removedStructureIds:g}}function Bse({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var l,c,u,d,p,m;let s=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(I=>I.target.structureId===g)},f=(l=h(r))==null?void 0:l.source.structureId;for(;f;)s.push(f),f=(c=h(f))==null?void 0:c.source.structureId}if((u=ur({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&u.some(({score:h})=>gr({score:h}))){let h=(d=Nt({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((m=(p=h==null?void 0:h[gs])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:m.structures)))return{error:gT}}return{...X}}function Vse({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=ur({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function jse({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(ca("structureId")),s=u=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return o.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function Gse({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...Wse({idBeingRemoved:c,drawDefinition:n}));let u=zse({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:n,structureId:o});s.push(...u.removedStructureIds);let d=Hse({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:c,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function Hse({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function zse({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var o;let a=[];return r.links=((o=r.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function Wse({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=Qe({structureId:t,drawDefinition:e}),r=_t({structure:i}).matchUps;return oA(r)}function XS({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:xe};if(!_A({drawDefinition:e,stage:r}))return{error:lp};let n=jae({drawDefinition:e,stage:r}),{qualifiersCount:a}=$g({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:pN};let{entryProfile:s}=LA({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return ai({drawDefinition:e}),{...X,entryProfile:s}}function xW({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?_A({drawDefinition:e,stage:i})?i!==Ae?{error:pN,info:"qualifiersCount can only be set for main stage"}:(LA({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),ai({drawDefinition:e}),{...X}):{error:lp}:{error:xe}}function qse({drawDefinition:t,drawSize:e}){if(!t)return{error:xe};let i=XS({stage:Rr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(ai({drawDefinition:t}),{...X})}function FW(t){return qse(t)}var Yse="qualifierDrawPositionAssignment",Kse="withdrawParticipantAtDrawPosition",Jse="alternateDrawPositionAssignment",Xse="luckyLoserDrawPositionAssignment",EB="removeDrawPositionAssignment",LW="swapDrawPositionAssignments",Zse="modifyPairAssignment",Qse="adHocPositionSwap",ele="modifyParticipantOtherName",CB="assignDrawPosition",tle="removeSeededParticipant",ile="assignDrawPositionBye",rle="modifySeedAssignment",_W="addPenalty",mO="MODIFY_PAIR",tD="QUALIFIER",hO="ALTERNATE",fO="WITHDRAW",Em="ASSIGN",BC="REMOVE",gO="LUCKY",nS="REMOVE_SEED",iD="SWAP",ZS="NICKNAME",eI="SEED_VALUE",Ff="PENALTY",QS="BYE",nle={MODIFY_PAIR_ASSIGNMENT:mO,QUALIFYING_PARTICIPANT:tD,ALTERNATE_PARTICIPANT:hO,WITHDRAW_PARTICIPANT:fO,ASSIGN_PARTICIPANT:Em,LUCKY_PARTICIPANT:gO,REMOVE_ASSIGNMENT:BC,SWAP_PARTICIPANTS:iD,ADD_NICKNAME:ZS,REMOVE_SEED:nS,ADD_PENALTY:Ff,ASSIGN_BYE:QS,SEED_VALUE:eI};function $W({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:xe};if(!r)return{error:Aa};if((i==null?void 0:i.length)!==2)return{error:le,drawPositions:i};let a=Jr({drawDefinition:e}),{matchUps:o}=ur({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=Qe({drawDefinition:e,structureId:r});if(!s)return{error:Ti};let l=Nt({tournamentRecord:t,drawDefinition:e,event:n}).appliedPolicies??{},c;if(s.structureType===En?c=sle({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):c=ale({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),c.error)return c;if(NA({structure:s,drawPositions:i}),FT({appliedPolicies:l,drawDefinition:e,positionAction:{name:LW,drawPositions:i,structureId:r}}),Ec({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===to){let u=_t({matchUpFilters:{matchUpTypes:[zs]},inContext:!0,structure:s}).matchUps.filter(p=>{var m;return(m=p.drawPositions)==null?void 0:m.some(h=>i.includes(h))}),d=_t({matchUpFilters:{matchUpTypes:[zs]},structure:s}).matchUps;u.forEach(p=>{(p.sides||[]).forEach(m=>{var f;let h=m==null?void 0:m.drawPosition;if(i.includes(h)){let g=m.participantId,v=d.find(({matchUpId:y})=>y===p.matchUpId),I=(f=p==null?void 0:p.sides)==null?void 0:f.reduce((y,b,S)=>b.drawPosition===h?S:y,void 0);nO({inContextTargetMatchUp:p,drawPositionSideIndex:I,teamParticipantId:g,tournamentRecord:t,drawDefinition:e,matchUp:v,event:n})}})})}return ai({drawDefinition:e,structureIds:[r]}),{...X}}function ale({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(c=>r==null?void 0:r.includes(c.drawPosition));if(!s)return{error:le,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...X};if(s.filter(({qualifier:c})=>c).length===2)return{...X};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?BW({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):ole({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function BW({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,m=FI({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=FI({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||(xa({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=Ws({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:o}),m.error)?m:{...X}}function ole({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,c)=>{let{drawPosition:u}=l,d={...r[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),oO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...X}}function sle({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var c;let s=(c=a.structures)==null?void 0:c.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&u.push(...p),u},[]);if(s.filter(({bye:u})=>u).length===2)return{...X};if(s.filter(({qualifier:u})=>u).length===2)return{...X};oO({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:s,structure:a,event:o});let l=s.some(({qualifier:u})=>u);if(s.some(({bye:u})=>u)&&!l)BW({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o});else{let u=ke(s,!1,!0);s.forEach((d,p)=>{let m=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=m})}return{...X}}function VW({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var o;let n="removeSeededParticipant";if(!t)return{error:fe};if(!e)return{error:xe};let a=(e.structures??[]).find(s=>s.structureId===r);return a?!a.stage||![Ae,We].includes(a.stage)||a.stage===Ae&&a.stageSequence!==1?Q({result:{error:sp},stack:n}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...X}:Q({info:"participant not seeded",result:{error:Nr},context:{participantId:i}}):Q({result:{error:Ti},stack:n})}function hb({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=vu}){return!r||!n?{error:Aa}:{link:Ge({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:yo,roundNumber:t,structureId:n}})}}function vO({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Vt()}function e0({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=vO({roundPosition:u,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:u,children:[m,h],matchUpId:f};c.push(g);let v={drawPositions:g.children.map(I=>I==null?void 0:I.drawPosition).filter(Boolean),matchUpStatus:ji,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),u++,l+=2}return{roundNodes:c,matchUps:r}}function qs({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!hs(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let u=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!hs(s)&&!u)return{matchUps:[],roundsCount:0};let d=Re(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=e0({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:c}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=e0({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:c}),h++;let f=h-1;return m=ib({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function IO(t){var k,x,F,$,_,L;let e="generateQualifyingStructure";if(!t.drawDefinition)return Q({result:{error:xe},stack:e});if(t.drawSize&&!rt(t.drawSize)||t.participantsCount&&!rt(t.participantsCount)||t.qualifyingPositions&&!rt(t.qualifyingPositions))return Q({result:{error:le},stack:e});let i=t.drawSize??LN(t.participantsCount),{qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:c,structureName:u,structureId:d,roundTarget:p,drawType:m,idPrefix:h,isMock:f,uuids:g}=t;if(!t.drawSize)return Q({result:{error:Ry},context:{drawSize:i},stack:e});if(n&&n>=t.drawSize)return Q({result:{error:le},context:{drawSize:i,qualifyingPositions:n},stack:e});let v,I,y,b,S=0,w,U=1,{structureProfiles:T}=eD({drawDefinition:l}),P=T[a];if(!P)return Q({result:{error:Ti},context:{targetStructureId:a},stack:e});let R=l.matchUpType,D=p?`${p}-`:"",E=P.stage===We,N=((x=(k=s==null?void 0:s[Df])==null?void 0:k.namingConventions)==null?void 0:x.pre)??(($=(F=Ioe[Df])==null?void 0:F.namingConventions)==null?void 0:$.pre),A=E&&N?`${N}-`:"",M=u??(D?`${A}${Hr(We)} ${D}`:`${A}${Hr(We)}`);if(m===Ao){let{maxRoundNumber:B,structures:V,groupCount:G}=ub({structureName:u??M,structureId:d??(g==null?void 0:g.pop()),stage:We,structureOptions:o,appliedPolicies:s,stageSequence:U,matchUpType:R,roundTarget:p,idPrefix:h,drawSize:i,isMock:f,uuids:g});S=G,v=B,y=V[0],w=[1]}else({drawSize:i,matchUps:b,roundLimit:v,roundsCount:I}=qs({qualifyingRoundNumber:r,qualifyingPositions:n,matchUpType:R,idPrefix:h,drawSize:i,isMock:f,uuids:g})),v||(v=I),y=Wa({structureName:u??M,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:We,matchUpFormat:c,stageSequence:U,matchUpType:R,roundLimit:v,matchUps:b}),p&&Ct({extension:{name:ol,value:p},element:y}),S=(_=b==null?void 0:b.filter(B=>B.roundNumber===v))==null?void 0:_.length;let C=m===Ao?gu:vu,O=y&&v&&((L=hb({sourceStructureId:y.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:C}))==null?void 0:L.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:S,...X,structure:y,link:O}}function jW(t){let e=t.tournamentRecord;if(!e)return{error:fe};let i=lle(t);if(i.error)return i;let{qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t,d={itemType:"addQualifyingStructures",itemValue:Ge({drawId:o.drawId,qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,structureName:s,matchUpType:l,drawSize:c,drawType:u})};return mh({tournamentRecord:e,timeItem:d}),i}function lle(t){if(!t.drawDefinition)return{error:xe};if(!t.targetStructureId)return{error:Aa};let e=IO(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:le}:dO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function GW(t){var d;let e=it(t,[{[ya]:!0,[yT]:!0,[al]:!0},{[Ene]:!0,[ea]:p=>Number.isInteger(p)&&p>0},{[ea]:p=>Array.isArray(p)&&p.length===2&&p.every(Ki),[fs]:na,participantIds:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r,tournamentRecord:n,event:a}=t,{structure:o}=Qe({drawDefinition:i,structureId:r});if(!o)return{error:Ti};if(!Wn({structure:o}))return{error:sp};let s=p=>{var m;return(m=p.sides)==null?void 0:m.map(h=>h.participantId).some(h=>t.participantIds.includes(h))},l=p=>p.roundNumber===t.roundNumber,c=p=>!gr(p),u=((o==null?void 0:o.matchUps)??[]).filter(l).filter(c).filter(s);if(u.length!==2)return{error:na};for(let p of u){let m=(d=p==null?void 0:p.sides)==null?void 0:d.find(h=>t.participantIds.includes(h==null?void 0:h.participantId));if(m){let h=t.participantIds.find(f=>f!==(m==null?void 0:m.participantId));m.participantId=h,St({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:p})}}return ai({drawDefinition:i,structureIds:[r]}),{...X}}function ule({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Re(0,u).map(f=>d?d+f:void 0),m=[];for(let f=0;f<u;f++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},I=l[f];I.roundNumber=i-1;let y=vO({roundPosition:I.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:I.roundPosition,drawPositions:[g],matchUpStatus:ji,roundNumber:i,matchUpId:y};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[I,v]};m.push(S)}let h=e?e-u:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function Mc(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=cle({drawSize:a}),v=g.length,I=0;if(i!=null&&i.length)I=i.reduce((M,C)=>M+C,0);else if(e){let M=e-a;i=g.filter(C=>C<=M?(M-=C,!0):!1),I=i.reduce((C,O)=>C+O,0),r=i.length}else n>=v?r=0:c&&(r=v-c,n=0),i=g.filter((M,C)=>c&&!r||r&&C>=n+r||C<n?0:M),I=i.reduce((M,C)=>M+C,0),r=i.length;let y=[...g,...i].sort((M,C)=>C-M),b=y.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>y[M]).reduce((M,C)=>M+C,0);I=I-S;let w=0,U=[],T,P=1,R=Re(0,a).map((M,C)=>({drawPosition:C+1+I})),D=I+1;for(let M of g){if({roundNodes:T,matchUps:U}=e0({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:m,nodes:R,uuids:h}),P++,i.includes(M)){let C=la(i)[M],O=Re(0,C),k=b+1-P,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(P));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:D}=ule({drawPosition:!x&&D||void 0,nodes:T,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),P++,w+=1})}R=T}b!==P-1&&console.log("ERROR");let E=a-I;U=ib({finishingPositionOffset:u?E:s,positionsFed:I,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=P-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let C=_N(M);return C>M?C/2:C}}function cle({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Re(0,e).reverse().map(i=>Math.pow(2,i))}function mf(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Ae,drawSize:g,idPrefix:v,isMock:I,uuids:y}=t;if(!(!o||!c||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,P=e+g,R=`${T}-${P}`,D=o==null?void 0:o[l],E=r&&`${r} `||"",N=(o==null?void 0:o[R])??(n==null?void 0:n[R]),A=t.structureName||(N==null?void 0:N.name)||(D==null?void 0:D.name)&&(i?`${E}${D==null?void 0:D.name}`:D.name)||`${E}${R}`,M=(N==null?void 0:N.abbreviation)??(D==null?void 0:D.abbreviation),C=t.structureId??(D==null?void 0:D.structureId)??(y==null?void 0:y.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:I,uuids:y},{matchUps:k}=m?Mc(O):qs(O),x=Wa({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:C,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=u?Math.min(u-d,F):!a||T<a?F:0;return g>2&&Re(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...X};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:H,links:W}=mf({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:y,stage:f});if(x.structureId&&j){let Y={linkType:kl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:wo,structureId:j}};W&&x&&W.push(Y),W!=null&&W.length&&w.push(...W)}return G!=null&&G.length&&S.push(...G),H!=null&&H.length&&b.push(...H),{structureId:j,childLinks:W,structures:S}}}function yO({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=Qe({drawDefinition:t,structureId:i});if(r.error)return Q({result:r});let{matchUps:n}=_t({structure:r.structure,matchUpsMap:e});return{...wn({matchUps:n}),matchUps:n,matchUpsMap:e}}function MB({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=yO({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>(HW(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{dle({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function dle({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Re(i,(r||i)+1).includes(t)}function HW(t){var e,i;return[mt(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),mt(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function ple(t){return HW(t).map(e=>Re(e[0],e[1]&&e[1]+1||e[0]+1))}function jg({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:le,context:{structureIds:e}};if(!t)return{error:xe};e=e??(t.structures??[]).filter(a=>a.stage!==We).map(({structureId:a})=>a);let r=e.map(a=>{var s;let{roundProfile:o}=yO({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(ple).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(ar).flat();return{positionsNotPlayedOff:mt(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function zW({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:xe};if(!r)return{error:Aa};if(!e)return{error:ze,info:"missing playoffPositions"};let n=jg({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=MB({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,I)=>v.includes(I.roundNumber)?v:v.concat(I.roundNumber),[]).map(v=>Je(v)).filter(v=>!t.includes(v)),c=MB({finishingPositions:a,drawDefinition:i,structureId:r}),u=c?Object.values(c):[],d=c?u.reduce((v,I)=>v.includes(I.roundNumber)?v:v.concat(I.roundNumber),[]).map(v=>Je(v)):[],p=l.filter(v=>!d.includes(v)).sort(ar),{roundProfile:m}=yO({drawDefinition:i,structureId:r}),h=p.map(v=>{let I=m==null?void 0:m[v].finishingPositionRange.loser,[y,b]=I??[0,0];return Re(y,(b||y)+1)}).flat().sort(ar),{playoffRoundsRanges:f}=mle({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function mle({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Re(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function fb({drawDefinition:t,structureId:e}){if(!t)return{error:xe};let{matchUps:i,matchUpsMap:r}=vn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=jg({drawDefinition:t,matchUpsMap:r}),{structures:o}=Oo({drawDefinition:t}),s=o.filter(c=>!e&&c.stage!==Rr||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=hle({playoffPositions:n,drawDefinition:t,structure:c,matchUps:i}),{error:p,...m}=d;if(p)return d;l[u]={structureId:u,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function hle({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var m,h,f,g,v,I,y,b,S;let n=i==null?void 0:i.structureId,{links:a}=Lg({drawDefinition:e,structureId:n});if(i.structureType===En||i.structures){let w=(h=(m=Qt({structure:i}))==null?void 0:m.positionAssignments)==null?void 0:h.length,U=i.structures.length,T=(w??0)/U,P=((f=a.source)==null?void 0:f.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],R=Re(1,T+1).filter(x=>!P.includes(x)),D=((v=(g=r.find(x=>x.containerStructureId===n&&x.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],E=a==null?void 0:a.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=jg({structureIds:E,drawDefinition:e}),M=[...N,...A],C=Re(D[0],D[1]+1).filter(x=>!M.includes(x)),O=Ar(C,C.length/R.length),k=R.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:C,playoffFinishingPositionRanges:k,finishingPositionsAvailable:R,finishingPositionsPlayedOff:P,positionsPlayedOff:N,groupCount:U,groupSize:T}}let o=((I=a==null?void 0:a.source)==null?void 0:I.filter(w=>w.linkCondition!==xl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],s=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition===xl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],l=zW({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:n}),c=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,u=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let U=a==null?void 0:a.source.find(E=>E.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,P=U==null?void 0:U.target.structureId,R=r.filter(({roundNumber:E,structureId:N})=>N===P&&E===T),D=R.filter(({sides:E})=>E.find(N=>N.participantFed&&!N.participantId)).length;if(c&&D===R.length){c.push(w);let E=(S=(b=d==null?void 0:d[w])==null?void 0:b.finishingPositionRange)==null?void 0:S.loser;if(E){let N=Math.min(...E),A=N+D,M=Re(N,A),C={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};u.push(C)}}}return c&&c.sort(ar),u.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function fle({playoffGroups:t,drawDefinition:e,structureId:i}){var n,a;if(!e)return{error:xe};if(typeof i!="string"||!Array.isArray(t))return{error:le};let r=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(n=fb({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>r.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function WW(t){var I,y;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:r=1,staggeredEntry:n,structureName:a,stage:o=Ae,matchUpType:s,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,m={finishingPositionOffset:e,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:h}=n?Mc(m):qs(m),f=Wa({structureName:a||((I=i==null?void 0:i["0"])==null?void 0:I.name)||Hr(Ae),structureId:l||(p==null?void 0:p.pop()),stageSequence:r,matchUpType:s,matchUps:h,stage:o}),g=[f],v=[];if(u>2){let b=u/2,{matchUps:S}=qs({finishingPositionOffset:e+b,idPrefix:c&&`${c}-c`,drawSize:b,matchUpType:s,isMock:d}),w=Hr(Wr),U=((y=i==null?void 0:i["0-1"])==null?void 0:y.name)??t.consolationStructureName??(a?`${a} ${w}`:w),T=Wa({structureName:U,matchUps:S,structureId:p==null?void 0:p.pop(),stage:Wr,stageSequence:1,matchUpType:s});g.push(T);let P={linkType:kl,source:{roundNumber:1,structureId:f.structureId},target:{roundNumber:1,feedProfile:wo,structureId:T.structureId}};v.push(P)}return{...X,structures:g,links:v}}function qW({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Re(1+e,r+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?wo:xd,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:kl,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},m=s[c-1];return m&&(p.target.groupedOrder=m),Ra()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=xl,p.target.feedProfile=wo),o.includes(d)?p:void 0}).filter(Boolean)}function YW(t){var S,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:r=1,playoffAttributes:n,structureNameMap:a,staggeredEntry:o,stage:s=Ae,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:m}=t,h={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:m},{matchUps:f,roundsCount:g}=o?Mc(h):qs(h),v=t.structureName??((S=n==null?void 0:n["0"])==null?void 0:S.name)??Hr(Ae),I=Ic({structureId:c||(m==null?void 0:m.pop()),structureName:v,stageSequence:r,matchUpType:l,matchUps:f,stage:s}),y=[I],b=[];if(u>2){let U=[0,2].slice(0,u/16).map((T,P)=>{let R=P+1,{consolationStructure:D}=gle({idPrefix:d&&`${d}-c${P}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:e,playoffAttributes:n,structureNameMap:a,stageSequence:R,roundOffset:T,matchUpType:l,drawSize:u,isMock:p,index:P,uuids:m});y.push(D);let E=qW({consolationStructure:D,roundsCount:2,mainStructure:I,roundOffset:T});return{consolationStructure:D,links:E}}).map(T=>T.links).flat();if(b.push(...U),u>=4&&u<=16||u>32){let{matchUps:T}=qs({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),P=((w=n==null?void 0:n["3-4"])==null?void 0:w.name)??Hr(xi),R=(a==null?void 0:a[P])||P,D=e?`${e} ${R}`:R,E=Ic({structureId:m==null?void 0:m.pop(),matchUps:T,stageSequence:2,stage:xi,structureName:D,matchUpType:l}),N={linkType:kl,source:{roundNumber:g-1,structureId:I.structureId},target:{structureId:E.structureId,feedProfile:wo,roundNumber:1}};y.push(E),b.push(N)}}return{structures:y,links:b,...X}}function gle({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var I,y;let p=l/(2*Math.pow(2,n)),{matchUps:m,roundsCount:h}=Mc({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:c,uuids:d}),f=u===0&&((I=i==null?void 0:i["0-1"])==null?void 0:I.name)||u===1&&((y=i==null?void 0:i["0-3"])==null?void 0:y.name)||`${Hr(Wr)} ${u+1}`,g=(r==null?void 0:r[f])||f,v=t?`${t} ${g}`:g;return{consolationStructure:Ic({matchUps:m,stage:Wr,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:h}}function jp(t){var R,D,E,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:r,feedsFromFinal:n,staggeredEntry:a,structureName:o,stage:s=Ae,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:m,isMock:h,uuids:f,fmlc:g}=t,v=t.feedPolicy||((R=t.policyDefinitions)==null?void 0:R[Pf])||((D=t.appliedPolicies)==null?void 0:D[Pf]),I={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:m,idPrefix:p,isMock:h,uuids:f},{matchUps:y}=a?Mc(I):qs(I),b=Wa({structureName:o||((E=r==null?void 0:r["0"])==null?void 0:E.name)||Hr(Ae),structureId:l||(f==null?void 0:f.pop()),stageSequence:i,matchUpType:c,matchUps:y,stage:s}),S=[b],w=[],U=m/2,{matchUps:T,roundsCount:P}=Mc({finishingPositionOffset:U,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:n,baseDrawSize:U,matchUpType:c,feedRounds:d,skipRounds:u,isMock:h,uuids:f,fmlc:g});if(m>2){let A=((N=r==null?void 0:r["0-1"])==null?void 0:N.name)??Hr(Wr),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,C=Wa({matchUps:T,structureId:f==null?void 0:f.pop(),stage:Wr,stageSequence:1,structureName:M,matchUpType:c});S.push(C);let O=qW({consolationStructure:C,mainStructure:b,roundsCount:P,feedPolicy:v,fmlc:g});w.push(...O)}return{...X,structures:S,links:w}}function KW({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:m}){var S,w,U,T,P,R;c=c||(n==null?void 0:n[Pf]);let h="processPlayoffGroups",f=0,g=[],v=[],I=[],{error:y,positionRangeMap:b}=fle({structureId:r,drawDefinition:o,playoffGroups:s});if(y)return Q({result:{error:y},stack:h});if(!(!b||s!=null&&s.every(D=>{let{finishingPositions:E=[]}=D;if(!E.length)return!1;let N=[...E].sort(ar).map((A,M)=>(E[M+1]||A)-A).every(A=>A<2);return(!t||N)&&E.every(A=>b[A])})))return Q({context:{validFinishingPositions:Object.values(b)},result:{error:le},stack:h});for(let D of s){let E=D.finishingPositions,N=b&&E.map($=>{var _;return(_=b[$])==null?void 0:_.finishingPositions}).flat(),A=u*E.length,M=Dg(A),C=M===2&&Fs||D.drawType||Fs;N&&(f=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=D.structureName||O&&((w=(S=D.playoffAttributes)==null?void 0:S[O])==null?void 0:w.name)||((T=(U=D.playoffAttributes)==null?void 0:U["0"])==null?void 0:T.name),x={addNameBaseToAttributeName:D.addNameBaseToAttributeName,playoffStructureNameBase:D.playoffStructureNameBase,finishingPositionNaming:D.finishingPositionNaming,finishingPositionLimit:D.finishingPositionLimit,structureId:D.structureId??(m==null?void 0:m.pop()),playoffAttributes:D.playoffAttributes,structureNameMap:D.structureNameMap,sequenceLimit:D.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:f,stage:xi,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=NU({playoffStructureId:L.structureId,finishingPositions:E,sourceStructureId:r});I.push(B),I.push(..._),v.push(...$),g.push({structureId:L.structureId,finishingPositions:E}),f+=A};if(C===Fs){let{matchUps:$}=qs({finishingPositionLimit:f+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=Wa({structureId:D.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:xi,structureName:k,stageSequence:a,matchUps:$});v.push(_);let L=NU({playoffStructureId:_.structureId,finishingPositions:E,sourceStructureId:r});I.push(L),f+=A,g.push({structureId:_.structureId,finishingPositions:E})}else if([Ef,Cf,xi].includes(C)){let $={playoffAttributes:D.playoffAttributes??i,playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(m==null?void 0:m.pop()),structureName:D.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:f,stage:xi,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};C===Ef?Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??hA,roundOffsetLimit:3}):C===Cf&&Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??fA,roundOffsetLimit:2});let _=mf($);if(_.error)return _;if((P=_.links)!=null&&P.length&&I.push(..._.links),(R=_.structures)!=null&&R.length&&v.push(..._.structures),v.sort(ih),_.structureId){let L=NU({playoffStructureId:_.structureId,finishingPositions:E,sourceStructureId:r});I.push(L),g.push({structureId:_.structureId,finishingPositions:E})}f+=A}else if([Mf,By,NI,MI,CI,AI].includes(C)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(m==null?void 0:m.pop()),playoffAttributes:D.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:f,uuids:$,stage:xi,structureName:k,matchUpType:l,feedPolicy:c,drawSize:M,isMock:p},L={[Mf]:{fmlc:!0,feedRounds:1},[AI]:{feedRounds:1},[NI]:{feedsFromFinal:3},[MI]:{feedsFromFinal:2},[CI]:{feedsFromFinal:1}};Object.assign(_,L[C]||{});let{structures:B,links:V}=jp(_),[G]=B,j=NU({playoffStructureId:G.structureId,finishingPositions:E,sourceStructureId:r});I.push(j),I.push(...V),v.push(...B),g.push({structureId:G.structureId,finishingPositions:E}),f+=A}else if([Ao].includes(C)){let{structures:$,links:_}=ub({...x,structureOptions:D.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([$y].includes(C)){let{structures:$,links:_}=WW(x);F({playoffStructures:$,playoffLinks:_})}else if([wae].includes(C)){let{structures:$,links:_}=YW(x);F({playoffStructures:$,playoffLinks:_})}else if([io].includes(C)){let $=Wa({structureId:D.structureId??(m==null?void 0:m.pop()),structureName:D.structureName,finishingPosition:XU,stage:xi,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:b,structures:v,links:I}}function NU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:gu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:yo,roundNumber:1}}}function gb({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>vb({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function vb({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Vt();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Re(0,u).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:ji,collectionPosition:m,collectionId:l,processCodes:c,matchUpType:s,isMock:n}})}function vle(t){var T,P,R;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return Q({result:{error:ze},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:r,tournamentRecord:n,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:c}=t,{structures:u=[],links:d=[],finishingPositionTargets:p,positionRangeMap:m,error:h}=KW({requireSequential:r,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(h)return{error:h};let f=p==null?void 0:p.map(({finishingPositions:D})=>D).flat().map(D=>m[D].finishingPositions).flat();a.structures.push(...u),a.links.push(...d);let{matchUps:g,matchUpsMap:v}=ur({inContext:!0,drawDefinition:a}),I=u.map(({structureId:D})=>D),y=g==null?void 0:g.filter(({structureId:D})=>I.includes(D)).map(br),b=(T=v==null?void 0:v.drawMatchUps)==null?void 0:T.filter(({matchUpId:D})=>y==null?void 0:y.includes(D));if(b!=null&&b.length){let D=(P=un({drawDefinition:a,event:c}))==null?void 0:P.tieFormat;D&&b.forEach(E=>{let{tieMatchUps:N}=gb({isMock:t.isMock,tieFormat:D,matchUp:E});Object.assign(E,{tieMatchUps:N,matchUpType:zs})})}let{positionAssignments:S}=Qt({structureId:i,drawDefinition:a}),w={};S==null||S.forEach(D=>{var N,A,M;let E=(M=(A=(N=dt({element:D,name:Dc}))==null?void 0:N.extension)==null?void 0:A.value)==null?void 0:M.groupOrder;E&&(w[E]||(w[E]=[]),w[E].push(D.participantId))});let U=mb({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:n,drawDefinition:a});return U.error&&((R=U.error)==null?void 0:R.code)!==lN.code?Q({result:U,stack:e}):{structures:u,links:d,positionsPlayedOff:f,drawDefinition:a,...X}}function nf({value:t,sourceRange:e,targetRange:i}){let r=Math.min(...e),n=Math.max(...e),a=Math.min(...i),o=Math.max(...i);return(t-r)*(o-a)/(n-r)+a}var bo="ELO",JW="NTRP",Ile="TRN",XW="UTR",bO="WTN",yle={ELO:bo,NTRP:JW,TRN:Ile,UTR:XW,WTN:bO},ble={[bo]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[JW]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[XW]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[bO]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Dr=ble;function wle({sourceRatingType:t,sourceRating:e}){let i=Dr[t].range,r=i[0]>i[1],n=Dr[bo].range;return nf({value:r?i[0]-e:e,sourceRange:i,targetRange:n})}function Ule({targetRatingType:t,sourceRating:e}){let i=Dr[t].decimalsCount||0,r=Dr[t].range,n=r[0]>r[1],a=Math.max(...r),o=Dr[bo].range,s=nf({targetRange:r,sourceRange:o,value:e}),l=parseFloat(s.toFixed(i));return n?a-l:l}function NB(t){var d;let e=it(t,[{ratings:!0,[so]:Sa}]);if(e.error)return e;let i=t.matchUpType&&[vi,ri].includes(t.matchUpType)?t.matchUpType:vi,r=Object.keys(Dr),n=t.targetRatingType&&r.includes(t.targetRatingType)?t.targetRatingType:bo,a=t.ratings[i]?t.ratings[i].reduce((p,m)=>p.includes(m.scaleName)?p:p.concat(m.scaleName),[]):[];if(!a)return{error:Nr};let o=((d=t.ratings[i])==null?void 0:d.find(p=>p.scaleName===n))??t.ratings[i][0];if(a[0]===n)return o;let s=o.scaleName,l=Dr[o.scaleName].accessor,c=l?o.scaleValue[l]:o.scaleValue,u=wle({sourceRatingType:s,sourceRating:c});return{convertedRating:Ule({targetRatingType:n,sourceRating:u}),sourceRating:c}}function Sle({participantResults:t,sides:e,score:i}){var s,l;let r=e.find(({sideNumber:c})=>c===1),n=e.find(({sideNumber:c})=>c===2),a=(s=r==null?void 0:r.participant)==null?void 0:s.ratings,o=(l=n==null?void 0:n.participant)==null?void 0:l.ratings;if(a!=null&&a[vi]&&(o!=null&&o[vi])){let c=bo,{convertedRating:u}=NB({ratings:a,targetRatingType:c}),{convertedRating:d}=NB({ratings:o,targetRatingType:c}),{side1pressure:p,side2pressure:m}=Tle({side1ConvertedRating:u,side2ConvertedRating:d,score:i});p&&t[r==null?void 0:r.participantId].pressureScores.push(p),m&&t[n==null?void 0:n.participantId].pressureScores.push(m);let h=Math.max(...Dr[bo].range),f=AS((d-u)/h),g=AS((u-d)/h);t[r==null?void 0:r.participantId].ratingVariation.push(f),t[n==null?void 0:n.participantId].ratingVariation.push(g)}}function Tle({side1ConvertedRating:t,side2ConvertedRating:e,score:i}){var I,y;let r=t>e?t:e,n=t>e?e:t,a=Math.abs(t-e),o=Dr[bo].range,s=Math.max(...o),l=(s-r)*0,c=(r+l)/s*a,u=(I=i==null?void 0:i.sets)==null?void 0:I.reduce((b,S)=>b+((S==null?void 0:S.side1Score)??0),0),d=(y=i==null?void 0:i.sets)==null?void 0:y.reduce((b,S)=>b+(S.side2Score??0),0),p=t>e?2:1,m=(u||0)*(n+(p===1?c:0)),h=(d||0)*(n+(p===2?c:0)),f=m+h,g=f?AS(m/f):0,v=f?AS(h/f):0;return{side1pressure:g,side2pressure:v}}var du="SET3-S:6/TB7",Dle="SET3-S:6/TB7-F:TB10";function wO({winningSide:t,matchUpFormat:e=du,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=Ln(e),c=UO((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Rt&&(r!=null&&r.setsCreditForDefaults)||i===Lt&&(r!=null&&r.setsCreditForWalkovers)))a[s]=c;else for(let u of o||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof s=="number"&&i===nn&&(+a[1-s]===c&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=c)),a}function ZW({matchUpFormat:t=du,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var p,m;let{sets:a}=n||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=Ln(t),l=(s==null?void 0:s.bestOf)??1,c=UO(l),u=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===Rt&&(r!=null&&r.gamesCreditForDefaults)||i===Lt&&(r!=null&&r.gamesCreditForWalkovers))){let h=((m=s==null?void 0:s.setFormat)==null?void 0:m.setTo)||0,f=c*h;d[o].push(f)}else a.forEach((h,f)=>{var S;let g=(h.setNumber||f+1)>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(S=s==null?void 0:s[g])==null?void 0:S.based,I=s==null?void 0:s[g].tiebreakSet,{side1Score:y,side2Score:b}=h;AB(v)&&(d[0].push(Je(y||0)),d[1].push(Je(b||0))),I&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&d[h.winningSide-1].push(1)});if(i===nn&&typeof o=="number"){let h=a.length>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",f=s==null?void 0:s[h];if(AB(f.based)){let g=(f==null?void 0:f.setTo)||0,v=y=>{if(!(!s||y===""))return+y===u-1||+y===u?Je(u||0)+1:+y<u?g:u},I=wO({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(d.map(y=>y[o]<=y[1-o]).reduce((y,b)=>y+(b?1:0),0)>I[1-o]){let y=d[o].length,b=v(d[1-o][y-1]);b&&(d[o][y-1]=b)}c>d[o].length&&(r!=null&&r.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((h,f)=>h+f,0),d[1].reduce((h,f)=>h+f,0)]}function QW({matchUpFormat:t,score:e}){var s;let i=t?Ln(t):void 0,r=(i==null?void 0:i.bestOf)??1,n=UO(r),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,c)=>{var p;let u=(l.setNumber||c+1)>n&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[u])==null?void 0:p.based;if(eq(d)){let{side1Score:m,side2Score:h}=l;m&&(o[0]+=Je(m||0)),h&&(o[1]+=Je(h||0))}else l.side1TiebreakScore&&(o[0]+=Je(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=Je(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function UO(t){return t&&Math.ceil(t/2)||1}function eq(t){return t==="P"}function AB(t){return!eq(t)}function Ple({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var c;let a=e&&Ln(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(c=a.setFormat)==null?void 0:c.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(s||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=f+g,I=Math.round(f/v*1e3)/1e3;(I===1/0||isNaN(I))&&(I=f);let y=t[u].matchUpsWon,b=t[u].matchUpsLost,S=y+b,w=Math.round(y/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=y);let U=t[u].gamesWon||0,T=t[u].gamesLost||0,P=(r||0)*(s||0)*(l||0),R=Math.max(P,U+T),D=Math.round(U/R*1e3)/1e3;(D===1/0||isNaN(D))&&(D=0);let E=t[u].pointsWon+t[u].pointsLost,N=Math.round(t[u].pointsWon/E*1e3)/1e3;(N===1/0||isNaN(N))&&(N=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=h,t[u].tieMatchUpsWon=f,t[u].tieMatchUpsPct=I,t[u].matchUpsPct=w,t[u].gamesWon=U,t[u].gamesLost=T,t[u].gamesPct=D,t[u].pointsPct=N,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function Ib({participantIds:t,pressureRating:e,matchUpFormat:i,tallyPolicy:r,perPlayer:n,matchUps:a}){var u,d,p,m,h,f,g;let o={},s=(r==null?void 0:r.excludeMatchUpStatuses)||[],l=a==null?void 0:a.filter(v=>(v.tieMatchUps||!s.includes(v.matchUpStatus))&&(!(t!=null&&t.length)||Vi(t,[af(v,0),af(v,1)]).length===2)),c=(u=l==null?void 0:l.flatMap(({score:v,tieMatchUps:I})=>{var y;return I?I.filter(({matchUpStatus:b})=>!s.includes(b)).flatMap(({score:b})=>{var S;return((S=b==null?void 0:b.sets)==null?void 0:S.length)??0}):((y=v==null?void 0:v.sets)==null?void 0:y.length)??0}))==null?void 0:u.reduce((v,I)=>v+I,0);for(let v of l??[]){let{matchUpStatus:I,tieMatchUps:y,tieFormat:b,score:S,winningSide:w,sides:U}=v,T=b&&v._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:N})=>N),P=w&&Rle(v),R=w&&Ele(v);if(!P&&!R)if(I&&fr.includes(I)){let N=af(v,0),A=af(v,1);N&&(lc(o,N),o[N].matchUpsCancelled+=1),A&&(lc(o,A),o[A].matchUpsCancelled+=1)}else if(y!=null&&y.length){n=0;for(let N of y){if(N.winningSide){let A=(d=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:d.participantId,M=(p=U==null?void 0:U.find(({sideNumber:C})=>C===N.winningSide))==null?void 0:p.participantId;A&&M&&(lc(o,A),lc(o,M),o[A].tieMatchUpsWon+=1,o[M].tieMatchUpsLost+=1,$i(vi)(N.matchUpType)?(o[A].tieSinglesWon+=1,o[M].tieSinglesLost+=1):$i(ri)(N.matchUpType)&&(o[A].tieDoublesWon+=1,o[M].tieDoublesLost+=1))}OB({score:N.score,manualGamesOverride:T,participantResults:o,sides:U})}}else OB({manualGamesOverride:T,participantResults:o,score:S,sides:U});else if(lc(o,P),lc(o,R),y==null?void 0:y.length){n=0;for(let N of y){let{matchUpType:A}=N,M=$i(ri)(A),C=$i(vi)(A);N.winningSide&&(N.winningSide===w?(P&&(o[P].tieMatchUpsWon+=1,C&&(o[P].tieSinglesWon+=1),M&&(o[P].tieDoublesWon+=1)),R&&(o[R].tieMatchUpsLost+=1,C&&(o[R].tieSinglesLost+=1),M&&(o[R].tieDoublesLost+=1))):N.winningSide!==w&&(R&&(o[R].tieMatchUpsWon+=1,C&&(o[R].tieSinglesWon+=1),M&&(o[R].tieDoublesWon+=1)),P&&(o[P].tieMatchUpsLost+=1,C&&(o[P].tieSinglesLost+=1),M&&(o[P].tieDoublesLost+=1)))),kB({matchUpFormat:N.matchUpFormat,matchUpStatus:N.matchUpStatus,matchUpType:N.matchUpType,score:N.score,sides:N.sides,winningParticipantId:P,losingParticipantId:R,manualGamesOverride:T,participantResults:o,isTieMatchUp:!0,pressureRating:e,tallyPolicy:r,winningSide:w})}tq({winningParticipantId:P,losingParticipantId:R,participantResults:o,matchUpStatus:I})}else kB({matchUpFormat:v.matchUpFormat??i,matchUpType:v.matchUpType,isTieMatchUp:void 0,winningParticipantId:P,manualGamesOverride:T,losingParticipantId:R,participantResults:o,pressureRating:e,matchUpStatus:I,tallyPolicy:r,winningSide:w,score:S,sides:U});let D=(m=S==null?void 0:S.sets)==null?void 0:m.reduce((N,A)=>N+((A==null?void 0:A.side1Score)??0),0),E=(h=S==null?void 0:S.sets)==null?void 0:h.reduce((N,A)=>N+(A.side2Score??0),0);if(T){let N=(f=U==null?void 0:U.find(({sideNumber:M})=>M===1))==null?void 0:f.participantId,A=(g=U==null?void 0:U.find(({sideNumber:M})=>M===2))==null?void 0:g.participantId;lc(o,N),lc(o,A),N&&(o[N].gamesWon+=D,o[N].gamesLost+=E),A&&(o[A].gamesWon+=E,o[A].gamesLost+=D)}}return Ple({participantResults:o,matchUpFormat:i,tallyPolicy:r,perPlayer:n,totalSets:c}),{participantResults:o}}function Rle(t){let e=t.winningSide-1;return af(t,e)}function Ele(t){let e=1-(t.winningSide-1);return af(t,e)}function af(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function lc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,pressureScores:[],ratingVariation:[],retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function OB({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(o[c-1]+=1),a[0].push(Je(u||0)),a[1].push(Je(d||0))}let s=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];r.forEach((l,c)=>{let{participantId:u}=l;u&&(lc(e,u),e[u].setsWon+=o[c],e[u].setsLost+=o[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function kB({winningParticipantId:t,manualGamesOverride:e,losingParticipantId:i,participantResults:r,pressureRating:n,matchUpFormat:a,matchUpStatus:o,isTieMatchUp:s,matchUpType:l,tallyPolicy:c,winningSide:u,score:d,sides:p}){let m=u&&u-1,h=1-m;n&&l===vi&&Sle({participantResults:r,sides:p,score:d}),s||tq({winningParticipantId:t,losingParticipantId:i,participantResults:r,matchUpStatus:o});let f=wO({matchUpStatus:o,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),g=ZW({matchUpStatus:o,matchUpFormat:a,tallyPolicy:c,winningSide:u,score:d}),{pointsTally:v}=QW({score:d,matchUpFormat:a});t&&(r[t].setsWon+=f[m],r[t].setsLost+=f[h],e||(r[t].gamesWon+=g[m],r[t].gamesLost+=g[h]),r[t].pointsWon+=v[m],r[t].pointsLost+=v[h]),i&&(r[i].setsWon+=f[h],r[i].setsLost+=f[m],e||(r[i].gamesWon+=g[h],r[i].gamesLost+=g[m]),r[i].pointsWon+=v[h],r[i].pointsLost+=v[m])}function tq({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===Lt&&(i[e].walkovers+=1),r===Rt&&(i[e].defaults+=1),r===nn&&(i[e].retirements+=1),[Rt,nn,Lt].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function Cle({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;n.push(u);let d=`Excluded: ${c}`;n.push(d)}else{let c=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(c).forEach(g=>{let v=f.groups[g].map(y=>r[y]).join(", "),I=`${g} ${f.attribute}: ${v}`;n.push(I)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${u} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function iq({participantResults:t,participantIds:e,attribute:i}){return rq({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function rq(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var Mle=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],fE={matchUpsPct:20,tieMatchUpsPct:16,pointsPct:4,gamesPct:8,setsPct:12};function xB(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!Nle(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=iq({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(g=>parseFloat(g)).sort((g,v)=>v-g).map(g=>s[g]).map(g=>{let v=nq({participantIds:g,...t});return a.push(...v.report??[]),v.order}).map((g,v)=>g.map(I=>I.resolved?I:{...I,subGroup:[v].concat(...I.subGroup??[])})).flat(),c,u=0,d=1,p;l.forEach((g,v)=>{var y;v&&(g.resolved||p&&!g.resolved)&&(d+=1),p=g.resolved;let I=parseInt(((y=g.subGroup)==null?void 0:y.join(""))||0);g.resolved?(g.position=v+1,d=g.position):(c&&I>c&&(d+=u,u=0),g.position=d,u+=1),c=I});let m=l.map(({position:g})=>g),h=la(m);return l.forEach(g=>{let{participantId:v,position:I}=g||{},y=i[v];g.GEMscore=f(y);let b=h[I];(g==null?void 0:g.position)!==void 0&&(b>1&&(g.ties=b,r&&(g.subOrder=r[v])),g.rankOrder=I,g.groupOrder=I+(g.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function f(g){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(fE).filter(v=>n.GEMscore.includes(v)):Object.keys(fE)).map(v=>(g[v]||0)*Math.pow(10,fE[v].toFixed(3))).reduce((v,I)=>v+I,0)}}function Nle({participantResults:t,participantsCount:e}){let i=rq({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function Ale({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=Ib({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),c=iq({participantResults:l,participantIds:e,attribute:n}),u=[{attribute:n,reversed:s,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>c[p]).map(p=>{let m=nq({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return u.push(...m.report??[]),m.order}).map((p,m)=>p.map(h=>h.resolved?h:{...h,subGroup:[m].concat(...h.subGroup??[])})).flat()),{order:d,report:u}}function nq({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let u=Ole({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:u,headToHeadWinner:d,report:s}}}let c=((n==null?void 0:n.tallyDirectives)||Mle).filter(u=>{let d=!(Mi(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||o.push(u),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=Ale({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:u,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function Ole({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Gg({policyDefinitions:t,generateReport:e,pressureRating:i,matchUpFormat:r,matchUps:n=[],subOrderMap:a,perPlayer:o}){if(!(n!=null&&n.length)||!uo(n))return{error:Fu};let s=mt(n.map(({structureId:b})=>b));if(s.length!==1)return Q({result:{error:le,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:s}});let l=n.filter(b=>b&&b.matchUpStatus!==xt),c=l.length&&mt(l.map(({drawPositions:b})=>b).flat()).length,u=l.filter(b=>Ed({matchUp:b})).length===l.length;u||(o=0);let d=n.every(({matchUpType:b,tieMatchUps:S})=>b===ci&&(S==null?void 0:S.every(w=>Ed({matchUp:w})))),p=t==null?void 0:t[tA],m=n.filter(b=>Ed({matchUp:b})||b.matchUpType===ci),{participantResults:h}=Ib({matchUps:m,pressureRating:i,matchUpFormat:r,tallyPolicy:p,perPlayer:o}),f,g,{groupOrder:v,report:I}=xB({matchUps:m,participantResults:h,participantsCount:c,matchUpFormat:r,tallyPolicy:p,subOrderMap:a});if(i&&kle({participantResults:h}),u&&v)f=I,g=v,v.forEach(b=>{let{participantId:S,groupOrder:w,rankOrder:U,subOrder:T,ties:P,GEMscore:R}=b,D=h[S];Object.assign(D,{groupOrder:w,rankOrder:U,GEMscore:R,subOrder:T,ties:P})});else{let{groupOrder:b,report:S}=xB({requireCompletion:!1,participantResults:h,participantsCount:c,matchUpFormat:r,tallyPolicy:p,subOrderMap:a,matchUps:n});f=S,g=b,b&&b.forEach(w=>{let{participantId:U,groupOrder:T,GEMscore:P}=w,R=h[U];Object.assign(R,{provisionalOrder:T,GEMscore:P})})}let y={completedTieMatchUps:d,readableReport:"",participantResults:h,bracketComplete:u,order:[],report:f};if((u||d)&&(y.order=g),e||Ra({tally:!0})){let b=Cle({matchUps:n,report:f,order:g});Ra({tally:!0})&&console.log(b),y.readableReport=b}return y}function kle({participantResults:t}){let e=n=>n.reduce((a,o)=>a+parseFloat(o),0),i=n=>parseFloat((e(n)/n.length).toFixed(2)),r=Object.keys(t).map(n=>{let a=t[n],{pressureScores:o}=a,s=o!=null&&o.length?i(o):0;return{participantId:n,averagePressure:s}}).sort((n,a)=>(a.averagePressure||0)-(n.averagePressure||0)).map((n,a)=>({...n,order:a+1}));for(let n of r)t[n.participantId].pressureOrder=n.order}function aq({positionAssignments:t}){let e=(t||[]).filter(ca(Nl)).map(n=>{let{extension:a}=dt({element:n,name:Rf}),o=Je(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=la(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function SO({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!uo(n))return{error:le};if(!t)return{error:le};let{policyDefinitions:o}=Bu({policyTypes:[tA],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=aq({positionAssignments:t}),l=n.length?Gg({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:c[h],name:Dc};Ct({element:m,extension:f}),c[h].ties||gn({element:m,name:Rf})}else gn({element:m,name:Dc}),gn({element:m,name:Rf})}),ai({drawDefinition:i}),{...X,participantResults:c,bracketComplete:u,report:d}}function oq({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function hi(t){let e=it(t,[{[ya]:!0,[al]:!0}]);if(e.error)return e;let{tournamentParticipants:i,afterRecoveryTimes:r,contextProfile:n,drawDefinition:a,matchUpsMap:o,matchUpId:s,inContext:l,context:c,event:u}=t,{structures:d=[]}=Oo({drawDefinition:a}),p=t.contextContent||n&&Vu({contextProfile:n,drawDefinition:a});for(let m of d){let{matchUps:h}=_t({tournamentParticipants:i,afterRecoveryTimes:r,contextContent:p,drawDefinition:a,contextProfile:n,matchUpsMap:o,inContext:l,structure:m,context:c,event:u}),{matchUp:f}=oq({matchUps:h,matchUpId:s});if(f)return{matchUp:f,structure:m}}return{error:tn}}function rD(t){var e;return!Ut(t)||!t.notes?{error:ze}:Ut(t.element)?!Ki(t.notes)&&!((e=t.notes)!=null&&e.testing)?{error:le}:(Object.assign(t.element,{notes:t.notes}),{...X}):{error:le}}function TO(t){return Ut(t)?Ut(t.element)?(t.element.notes&&delete t.element.notes,{...X}):{error:le}:{error:ze}}var nD={matchUpStatus:ji,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Ls(t){var T,P,R,D,E,N,A,M;let e="modifyMatchUpScore",i=t.matchUpFormat,r=t.matchUp,n,{matchUpStatusCodes:a,removeWinningSide:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,removeScore:u,winningSide:d,matchUpId:p,event:m,notes:h,score:f}=t,g=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(T=Nt({policyTypes:[gs],tournamentRecord:s,drawDefinition:l,structure:n,event:m}))==null?void 0:T.appliedPolicies,v=r.matchUpType===ci;if(v&&l){if(p&&r.matchUpId!==p){let C=hi({drawDefinition:l,matchUpId:p,event:m});if(!C.matchUp)return{error:tn};({matchUp:r,structure:n}=C)}}else r.matchUpId!==p&&console.log("!!!!!");c&&[Lt,tr].includes(c)||u?Object.assign(r,{...nD}):f&&(r.score=f);let I=c&&(r==null?void 0:r.matchUpStatus)===Rt&&c!==Rt;c&&(r.matchUpStatus=c),i&&(r.matchUpFormat=i),a&&(r.matchUpStatusCodes=a),d&&(r.winningSide=d),o&&(r.winningSide=void 0),!n&&l&&({structure:n}=hi({drawDefinition:l,matchUpId:p,event:m})),c&&!r.winningSide&&gr(r)&&!fr.includes(c)&&![eh,Yc].includes(c)&&(r.matchUpStatus=jo);let y;if((I&&((P=r==null?void 0:r.processCodes)!=null&&P.length)||c===Rt)&&(y=(D=(R=g==null?void 0:g[gs])==null?void 0:R.processCodes)==null?void 0:D.incompleteAssignmentsOnDefault),!r.collectionId){let C=(n==null?void 0:n.structureType)===En,O=Wn({structure:n});if(GA({drawDefinition:l,structure:n})||O||C){let k=$=>{i=v?"SET1-S:T100":i??r.matchUpFormat??($==null?void 0:$.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(m==null?void 0:m.matchUpFormat);let _=v?{matchUpTypes:[ci]}:void 0,{matchUps:L}=_t({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:_,drawDefinition:l,structure:$,event:m});return O&&($.positionAssignments=mt(L.flatMap(B=>(B.sides??[]).map(V=>V.participantId)).filter(Boolean)).map(B=>({participantId:B}))),SO({positionAssignments:$.positionAssignments,tournamentRecord:s,drawDefinition:l,matchUpFormat:i,matchUps:L,event:m})},x=C&&n.structures.find($=>$==null?void 0:$.matchUps.find(_=>_.matchUpId===p)),F=k(x||n);if(F.error)return Q({result:F,stack:e})}}if(h){let C=rD({element:r,notes:h});if(C.error)return Q({result:C,stack:e})}let b=s==null?void 0:s.tournamentId,S=Vo().topics.includes(kT),w=(S||y)&&Jr({drawDefinition:l}),U=w&&((E=ur({matchUpFilters:{matchUpIds:[p]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:l,matchUpsMap:w}).matchUps)==null?void 0:E[0]);if(S&&U&&Rae({tournamentId:b,inContextMatchUp:U}),Array.isArray(y)&&U&&!((N=U.sides)!=null&&N.every(({participantId:C})=>C)))if(c===Rt)r.processCodes=mt([...r.processCodes??[],...y]);else for(let C of y||[]){let O=C&&((A=r==null?void 0:r.processCodes)==null?void 0:A.lastIndexOf(C));(M=r==null?void 0:r.processCodes)==null||M.splice(O,1)}return St({eventId:m==null?void 0:m.eventId,context:e,drawDefinition:l,tournamentId:b,matchUp:r}),{...X}}function DO(t){var m,h,f,g;let{matchUpStatusCodes:e,matchUpStatus:i,structure:r,matchUp:n,dualMatchUp:a,inContextMatchUp:o}=t,s=rb({matchUpStatus:i})||[_u,Ea].includes(i)&&a,l=((m=n==null?void 0:n.sides)==null?void 0:m.map(v=>v.participantId).filter(Boolean).length)||((h=o==null?void 0:o.sides)==null?void 0:h.map(v=>v.participantId).filter(Boolean).length),c="attemptToModifyScore";if(!(Wn({structure:r})&&l===1||i===Rt&&l||xle({structure:r,matchUp:n,inContextMatchUp:o})||((g=(f=t.appliedPolicies)==null?void 0:f[gs])==null?void 0:g.requireParticipantsForScoring)===!1))return Q({result:{error:fN},stack:c});let u=[Lt].includes(i),d=s?i:t.winningSide&&_i||vs,p=Ls({...t,matchUpStatusCodes:s&&e||[],matchUpStatus:d,context:c,removeScore:u});return Q({result:p,stack:c})}function xle({structure:t,matchUp:e,inContextMatchUp:i}){var s;let{drawPositions:r}=e,{positionAssignments:n}=Ur({structure:t}),a=n==null?void 0:n.filter(l=>(r==null?void 0:r.includes(l.drawPosition))&&l.participantId),o=(s=i==null?void 0:i.sides)==null?void 0:s.every(l=>l.participantId);return(a==null?void 0:a.length)===2||o}function sq({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>rt(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Je(r));return{groupValueGroups:e,groupValueNumbers:i}}function Fle({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(I=>I.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(I=>fr.includes(I.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(I=>{I.winningSide&&(v[I.winningSide-1]+=1)}),rt(p)?a.forEach(I=>{I.winningSide&&(o[I.winningSide-1]+=p)}):rt(f)?a.forEach(I=>{var y,b;(b=(y=I.score)==null?void 0:y.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):rt(h)?a.forEach(I=>{var y,b;(b=(y=I.score)==null?void 0:y.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:P=0}=S;(I.matchUpStatus===_i||I.winningSide||S.winningSide)&&(T||P?(o[0]+=T,o[1]+=P):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(I=>{if(I.winningSide){let y=I.collectionPosition,b=Lle({collectionDefinition:t,collectionPosition:y});rt(b)&&(o[I.winningSide-1]+=b)}}),rt(d)){let I;if(m!=null&&m.aggregateValue)l&&(rt(p||f||h)&&o[0]!==o[1]?I=o[0]>o[1]?1:2:v[0]!==v[1]&&(I=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)I=o.reduce((y,b,S)=>b>=m.valueGoal?S+1:y,0);else{let y=Math.floor(t.matchUpCount/2)+1;I=v.reduce((b,S,w)=>S>=y?w+1:b,0)}I&&(g?i[u].values[I-1]+=d:s[I-1]+=d)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):s.forEach((I,y)=>r[y]+=I||0)}function Lle({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function lq({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==mt(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...X}}var _le="MIXED events can not contain mixed singles or { gender: ANY } collections",$le="events with { gender: ANY } can not contain MIXED singles collections";function aD(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[ti,yi].includes(i)&&i!==n?Q({result:{valid:!1,error:Wv},context:{gender:n},stack:e}):i===Gn&&(n===Is||n===Gn&&r!==ri)?Q({result:{error:Wv,valid:!1},info:_le,stack:e}):i===Is&&n===Gn&&r!==ri?Q({result:{error:Wv,valid:!1},info:$le,stack:e}):{valid:!0}}function oD(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return Ble(t,e)}function LI(t){return!isNaN(Number(t))&&Number(t)}function uq(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function Ble(t,e){var u;let i=LI(t.bestOf)||void 0,r=LI(t.exactly)||void 0,n=i||r;if((u=t.setFormat)!=null&&u.timed&&t.simplified&&n===1)return uq(t.setFormat);let a=n&&`${tS}${n}`||"",o=FB(t.setFormat,e),s=o&&`S:${o}`||"",l=FB(t.finalSetFormat,e),c=n&&n>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,c].filter(d=>d).join("-")}function FB(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return uq(t);if(t.tiebreakSet)return LB(t.tiebreakSet);let i=LI(t.setTo);if(i){let r=t.NoAD&&HA||"",n=LB(t.tiebreakFormat),a=n&&`/${n}`||"",o=LI(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function LB(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&LI(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?HA:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function da({matchUpFormat:t}){if(!Ki(t)||t==="")return!1;let e=Ln(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],c=o==null?void 0:o[3];return oD(e,!!(i&&n&&r===a||o&&l&&s===c))===t}var Vle=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),jle=t=>t.filter(Boolean).every(Mi);function Cm(t){let e=t.category;if(typeof e!="object")return{error:bI};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!Vle([i,r,n,s],"string")||!jle([a,o]))return{error:bI};let c=t.consideredDate??ut(new Date().toLocaleDateString("sv"));if(!aa(c))return{error:yn};let[u]=c.split("-").slice(0,3).map(x=>parseInt(x)),d=Gv(c,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${za(p)}-${za(m)}`,f=Gv(c,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),I=`${za(g)}-${za(v)}`,y=o&&Gv(c,-1*365*o),b=a&&Gv(c,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,P=i==null?void 0:i.includes("-"),R=P&&(i==null?void 0:i.match(T)),D=i==null?void 0:i.match(U),E=(x,F)=>`${x}-${F}`,N=x=>{let F=u-x,$=E(F,I);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=u-x-1,$=E(F,I);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),y=void 0),a=x)},M=x=>{let F=u-x,$=E(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),y=void 0),o=x+1)},C=x=>{let F=u-x-1,$=E(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),y=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&C(L),r=r??y,n=n??b};if(R){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=u-e.ageMin;r=E($,h)}if(e.ageMax){let $=u-e.ageMax-1;n=E($,I)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else P?i==null||i.split("-").forEach(O):D?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=Ge({consideredDate:c,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function _I({category:t}){if(!Ut(t))return{error:le};let e=Cm({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!Mi(i)?Q({result:{error:le},context:{ratingMax:i}}):r&&!Mi(r)?Q({result:{error:le},context:{ratingMin:r}}):{...e}}function yb({childCategory:t,withDetails:e,category:i}){let r=_I({category:i}),n=_I({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=Ge({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!c&&!s&&!l&&!u&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function bb({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),Q({result:{errors:l,error:Lu},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:I,category:y,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!WT([vi,ri],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([f,d,v,I].map(rt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&m){let S=lq({collectionValueProfiles:c,matchUpCount:m});S.errors&&l.push(...S.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!da({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=aD({referenceGender:a,matchUpType:g,gender:b});if(S.error)return Q({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&y){let S=yb({category:n,childCategory:y});if(!S.valid)return Q({result:{error:bI},context:S,stack:s})}return l.length?Q({result:{errors:l,error:HG},stack:s}):{valid:!0}}function qn(t){var g,v,I,y;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),r=t==null?void 0:t.checkCollectionIds,n=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[],l=Gle({...t,stack:o});if(l!=null&&l.error)return l;let c,u=n.collectionDefinitions.every(b=>{let{setValue:S,scoreValue:w,collectionValue:U}=b;(S||w)&&!U&&(c=!0);let{valid:T,errors:P}=bb({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:r,checkCategory:e,checkGender:i,event:a});return T?!0:(Array.isArray(P)&&s.push(...P),!1)}),d=typeof((g=n.winCriteria)==null?void 0:g.valueGoal)=="number"&&((v=n.winCriteria)==null?void 0:v.valueGoal)>0&&!c||((I=n.winCriteria)==null?void 0:I.aggregateValue);if(!(d||(y=n.winCriteria)!=null&&y.aggregateValue))return c?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),Q({context:{tieFormat:n,errors:s,aggregateValueImperative:c},result:{error:uu},stack:o});let p=n.collectionDefinitions.map(({collectionId:b})=>b),m=!r||p.length===mt(p).length,h=u&&d&&m;return h?{valid:h,errors:s}:Q({result:{error:uu},context:{tieFormat:n,errors:s},stack:o})}function Gle(t){let{tieFormat:e,stack:i}=t;return!t||!e||!Ut(e)?Q({result:{error:uu},context:{tieFormat:e,message:"tieformat must be an object"},stack:i}):Ut(e.winCriteria)?Array.isArray(e.collectionDefinitions)?{...X}:Q({result:{error:uu},context:{tieFormat:e,message:"collectionDefinitions must be an array"},stack:i}):Q({result:{error:uu},context:{tieFormat:e,message:"tieformat.winCritiera must be an object"},stack:i})}function wb(t){var b,S,w,U,T;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:r,matchUpsMap:n,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((P,R)=>P+R)))return{error:le};if(!o)return{error:Hn};let l=((b=un({matchUp:o,drawDefinition:r,structure:a,event:s}))==null?void 0:b.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:wg};let c=qn({tieFormat:l});if(c.error)return c;let u=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:m,groupValueNumbers:h}=sq(l);for(let P of u)Fle({collectionDefinition:P,groupValueNumbers:h,groupValueGroups:m,sideTieValues:p,tieMatchUps:d});for(let P of h){let R=m[P],{allGroupMatchUpsCompleted:D,matchUpCount:E,winCriteria:N,groupValue:A,sideWins:M,values:C}=R,O;if(N!=null&&N.aggregateValue)D&&C[0]!==C[1]&&(O=C[0]>C[1]?1:2);else if(N!=null&&N.valueGoal)O=C.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(E/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(p[O-1]+=A||0)}let f=p.map((P,R)=>(P||0)+e[R]),g={side1Score:f[0],side2Score:f[1],winningSide:void 0},v=f.join(i),I=f.slice().reverse().join(i),y;if(l!=null&&l.winCriteria){let{valueGoal:P,aggregateValue:R,tallyDirectives:D}=l.winCriteria;if(P?y=(S=f.map((E,N)=>({sideNumber:N+1,points:E})).find(({points:E})=>E>=P))==null?void 0:S.sideNumber:R&&d.every(E=>E.matchUpStatus&&fr.includes(E.matchUpStatus)||E.winningSide)&&f[0]!==f[1]&&(y=f[0]>f[1]?1:2),!y&&D){let E=o.matchUpId,N=o.hasContext?o:((w=n==null?void 0:n.drawMatchUps)==null?void 0:w[E])||r&&((U=hi({inContext:!0,drawDefinition:r,matchUpId:E}))==null?void 0:U.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Gg({matchUps:[N]});if(A&&(M!=null&&M.length)){let C=M[0].participantId;y=(T=N.sides.find(({participantId:O})=>O===C))==null?void 0:T.sideNumber}}}}return y&&(g.winningSide=y),{scoreStringSide1:v,scoreStringSide2:I,winningSide:y,set:g}}function Ub({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=hi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=dt({element:e,name:hu}),l=ke((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(u=>{var g;let d=u.participantId,p=d&&l[d]||void 0,{lineUp:m,...h}=((g=r.sides)==null?void 0:g.find(({sideNumber:v})=>v===u.sideNumber))??{},f=m!=null&&m.length?m:p;return{...c(u),...h,lineUp:f}}),St({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Br(t){if(t)return ke(t,!1,!0)}function PO(t){let e=it(t,[{[rn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function cq({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=PO({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function Gu(t){var E,N,A,M;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:r,removeScore:n,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(E=t.tournamentRecord)==null?void 0:E.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&cq({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:fe};let d=hi({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:tn};let{matchUp:p,structure:m}=d;if(!p.tieMatchUps)return{error:zn};Ub({tournamentId:u==null?void 0:u.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:h}=dt({name:Tm,element:p});if(h!=null&&h.value)if(n)gn({element:p,name:Tm});else return{...X,score:p.score};let f=(A=un({drawDefinition:i,structure:m,matchUp:p,event:s}))==null?void 0:A.tieFormat;p.tieFormat=Br(f);let g=wb({drawDefinition:i,matchUpsMap:a,structure:m,matchUp:p,event:s}),{winningSide:v,set:I,scoreStringSide1:y,scoreStringSide2:b}=g,S=(I==null?void 0:I.side1Score)||(I==null?void 0:I.side2Score);if(e&&!p.score&&!S)return{...X};let w={scoreStringSide1:y,scoreStringSide2:b,sets:I?[I]:[]},U=v&&[1,2].includes(v),T=U&&_i||zA({matchUpStatus:r??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&jo||ji,P=!!(p.winningSide&&!U),R=p.tieMatchUps.find(({score:C,winningSide:O,matchUpStatus:k})=>{var x;return((x=C==null?void 0:C.sets)==null?void 0:x.length)&&(C.sets[0].side1Score||C.sets[0].side2Score)||k&&fr.includes(k)||O}),D;if(p.tieFormat&&!U&&!R){let C=(M=un({drawDefinition:i,structure:m,event:s}))==null?void 0:M.tieFormat;C&&JSON.stringify(f)===JSON.stringify(C)&&(p.tieFormatId=void 0,p.tieFormat=void 0,D=!0)}return Ls({appliedPolicies:t.appliedPolicies,matchUpStatus:T,score:w,removeWinningSide:P,tournamentRecord:u,drawDefinition:i,removeScore:n,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...X,score:w,removeWinningSide:P,tieFormatRemoved:D,winningSide:v}}function Hle({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var h,f,g,v,I;let m="directWinner";if(o){let y=c.drawPositions||[],b=y[t],S=o.source.structureId,w=Qe({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Ur({structureId:S,drawDefinition:l}),P=(h=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:h.participantId,R=o.target.structureId,{positionAssignments:D}=Ur({structureId:R,drawDefinition:l}),E=(f=D==null?void 0:D.find(M=>M.participantId===P))==null?void 0:f.drawPosition,N=D==null?void 0:D.filter(M=>{let C=y.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return C&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(P&&o.target.roundNumber===1&&A)Ws({drawPosition:b,participantId:P,structureId:R,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(P&&(N!=null&&N.length)){let M=N.pop();M&&Ws({participantId:P,structureId:R,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(E){let M=xf({drawPosition:E,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return Q({result:M,stack:m})}else if((U==null?void 0:U.stage)!==We){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==R){let M=U.seedAssignments.find(({participantId:O})=>O===P),C=M==null?void 0:M.participantId;M&&C&&Vg({eventId:c==null?void 0:c.eventId,structureId:R,...M,tournamentRecord:a,drawDefinition:l,participantId:C})}}else{let y=xf({matchUpId:c.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(y.error)return y}if(u&&i){let y=(g=u.sides)==null?void 0:g.find(b=>b.sideNumber===i);if(y!=null&&y.lineUp){let b=u.roundPosition,S=c.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:R})=>R===c.matchUpId),T=[1,2].map(R=>{var D;return{...((D=U.sides)==null?void 0:D.find(E=>E.sideNumber===R))||{},sideNumber:R}});U.sides=T;let P=U.sides.find(R=>R.sideNumber===w);if(P){let R=(I=y.lineUp)==null?void 0:I.filter(D=>D==null?void 0:D.participantId);P.lineUp=aO({lineUp:R}),St({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:U,context:m,drawDefinition:l})}}}return{...X}}function zle(t){var F,$,_;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:r,sourceMatchUpStatus:n,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}=t,m="directLoser",h=s.linkCondition,f=c.drawPositions||[],g=h===xl&&c.roundNumber===2&&Math.min(...f.filter(Boolean)),v=g||f[e],I=g||f[1-e],y=s.source.structureId,{structure:b}=Qe({structureId:y,drawDefinition:l}),{matchUps:S}=_t({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:b,event:p}),w=S.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(a)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===a),V=L.matchUpStatus===Lt||L.matchUpStatus===Rt&&!gr(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),U=h===xl&&w.length===0,{positionAssignments:T}=Ur({structureId:y,drawDefinition:l}),P=(F=T==null?void 0:T.find(L=>L.drawPosition===a))==null?void 0:F.participantId,R=s.target.structureId,{positionAssignments:D}=Ur({structureId:R,drawDefinition:l}),E=D==null?void 0:D.filter(({drawPosition:L})=>f.includes(L));if(E!=null&&E.some(L=>L.participantId===P))return{...X};let N=E==null?void 0:E.filter(L=>{let B=f.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),A=N==null?void 0:N.includes(v),M=s.target.roundNumber>1&&(N==null?void 0:N.length),C=s.target.roundNumber===1&&A;if(g){let L=O();if(L.error)return Q({result:L,stack:m})}else if(C){let L=x();if(L.error)return Q({result:L,stack:m})}else if(P&&M){N.sort(ar);let L=N[0],B=Ws({participantId:P,structureId:R,drawPosition:L,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(B.error)return Q({result:B,stack:m})}else return Q({result:{error:Ig},context:{loserDrawPosition:a,loserTargetLink:s},stack:m});if(b!=null&&b.seedAssignments&&b.structureId!==R){let L=b.seedAssignments.find(({participantId:V})=>V===P),B=L==null?void 0:L.participantId;L&&B&&Vg({eventId:c==null?void 0:c.eventId,structureId:R,...L,tournamentRecord:o,drawDefinition:l,participantId:B})}if(u&&r){let L=($=u.sides)==null?void 0:$.find(B=>B.sideNumber===3-r);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=c,{roundPosition:G}=u,j=B===1?2-G%2:1,H=(_=d==null?void 0:d.drawMatchUps)==null?void 0:_.find(({matchUpId:q})=>q===c.matchUpId),W=[1,2].map(q=>{var re;return{...((re=H.sides)==null?void 0:re.find(K=>K.sideNumber===q))||{},sideNumber:q}});H.sides=W;let Y=H.sides.find(q=>q.sideNumber===j);Y&&(Y.lineUp=aO({lineUp:L.lineUp}),St({tournamentId:o==null?void 0:o.tournamentId,matchUp:H,context:m,drawDefinition:l,eventId:V}))}}return{...X};function O(){let L="loserLinkFedFMLC";return Q(U?{result:x(),stack:L}:{result:k(),stack:L})}function k(){let L=xa({drawPosition:I,structureId:R,tournamentRecord:o,drawDefinition:l,event:p});return Q({result:L,stack:"assignLoserPositionBye"})}function x(){let L=P?Ws({drawPosition:v,participantId:P,structureId:R,inContextDrawMatchUps:i,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:lr};return Q({result:L,stack:"assignLoserDrawPosition"})}}function dq(t){var w;let e="directParticipants",i=DO(t);if(i.error)return Q({result:i,stack:e});let r=rb({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:m,matchUpId:h,structure:f,matchUp:g,event:v}=t,I=!!g.collectionId,y=Wn({structure:f}),b=g.drawPositions,S;if(I){let{matchUpTieId:U,matchUpsMap:T}=t,P=Gu({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:s,drawDefinition:l,matchUpsMap:T,event:v});if(S=P&&{tieMatchUpResult:P},b=(w=o.find(({matchUpId:R})=>R===U))==null?void 0:w.drawPositions,!n)return Q({result:{...X,...S},stack:e})}if(y)return Q({result:{...X,...S},stack:e});if(b){let U=a?a-1:p-1,T=1-U,P=b[U],R=b[T],{targetLinks:{loserTargetLink:D,winnerTargetLink:E,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:C,loserMatchUp:O,byeMatchUp:k}}=m;if(C){let x=Hle({sourceMatchUpStatus:r&&c||_i,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:P,tournamentRecord:s,winnerTargetLink:E,drawDefinition:l,winnerMatchUp:C,dualMatchUp:u,matchUpsMap:d,event:v});if(x.error)return Q({result:x,stack:e})}if(O){let x=zle({sourceMatchUpStatus:r&&c||_i,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:R,tournamentRecord:s,loserTargetLink:D,drawDefinition:l,loserMatchUp:O,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:v});if(x.error)return Q({result:x,stack:e})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=xa({drawPosition:F,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(_.error)return Q({result:_,stack:e})}}else return Q({result:{error:Py},stack:e});return Q({result:{...X,...S},stack:e})}function RO(t){var j,H,W,Y;let e="genPlayoffStructure";if(!t.drawDefinition)return Q({result:{error:xe},stack:e});let i=fb(t);if(i.error)return Q({result:i,stack:e});let{structureId:r,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:m,roundNumbers:h,idPrefix:f,isMock:g,event:v,uuids:I}=t,y=ke(t.drawDefinition,!1,!0),{structure:b}=Qe({structureId:r,drawDefinition:y});if(!b)return Q({result:{error:Ti},stack:e});if(b.structureType===En||b.structures)return vle({sourceStructureId:b.structureId,...t,...i,drawDefinition:y});let{playoffRoundsRanges:S,playoffRounds:w}=i,{playoffPositionsReturned:U,error:T,playoffSourceRounds:P,playoffRoundsRanges:R}=zW(t);if(T)return Q({result:{error:T},stack:e});let D=(m==null?void 0:m.length)&&Object.assign({},...m),E=h||typeof m=="object"&&m.map(q=>Object.keys(q)).flat(),N=Array.isArray(E)&&E.map(q=>!isNaN(q)&&Je(q)).filter(Boolean);if(N){if(!Array.isArray(N))return Q({result:{error:le},context:{validRoundNumbers:N},stack:e});N.forEach(q=>{if(!(w!=null&&w.includes(q)))return Q({result:{error:le},context:{roundNumber:q},stack:e})})}c&&c.forEach(q=>{if(!(U!=null&&U.includes(q)))return Q({result:{error:le},context:{playoffPosition:q},stack:e})});let A=N||P,M=N?S:R,C=[],O=[];for(let q of A??[]){let re=M==null?void 0:M.find(ae=>ae.roundNumber===q);if(!re)return Q({result:{error:le},context:{roundNumber:q},stack:e});let K=re.finishingPositions.length,z=Math.min(...re.finishingPositions)-1,te=2,J=q&&(D==null?void 0:D[q])&&te+D[q]-1,ie=mf({exitProfile:`0-${q}`,addNameBaseToAttributeName:n,playoffStructureNameBase:a,finishingPositionOffset:z,playoffAttributes:l,exitProfileLimit:p,stage:xi,roundOffset:0,drawDefinition:y,sequenceLimit:J,stageSequence:te,drawSize:K,idPrefix:f,isMock:g,uuids:I,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:u});if(ie.error)return Q({result:ie,stack:e});let{structures:ne,links:ue}=ie;if(ne!=null&&ne.length&&C.push(...ne),ue!=null&&ue.length&&O.push(...ue),ie.structureId&&q){let ae={linkType:kl,source:{structureId:r,roundNumber:q},target:{structureId:ie.structureId,feedProfile:wo,roundNumber:1}};O.push(ae)}}if(!C.length)return Q({result:{error:le},info:"No structures generated",stack:e});y.structures.push(...C),y.links.push(...O);let{matchUps:k,matchUpsMap:x}=ur({inContext:!0,drawDefinition:y}),F=C.map(({structureId:q})=>q),$=k==null?void 0:k.filter(({structureId:q})=>F.includes(q)).map(br),_=(j=x==null?void 0:x.drawMatchUps)==null?void 0:j.filter(({matchUpId:q})=>$==null?void 0:$.includes(q));if(_!=null&&_.length){let q=(H=un({drawDefinition:y,event:v}))==null?void 0:H.tieFormat;q&&_.forEach(re=>{let{tieMatchUps:K}=gb({matchUp:re,tieFormat:q,isMock:g});Object.assign(re,{tieMatchUps:K,matchUpType:ci})})}(W=k==null?void 0:k.filter(q=>Ed({matchUp:q})&&q.structureId===r))==null||W.forEach(q=>{let{matchUpId:re,score:K,winningSide:z}=q,te=Un({inContextDrawMatchUps:k,drawDefinition:y,matchUpId:re}),J=dq({inContextDrawMatchUps:k,tournamentRecord:d,drawDefinition:y,matchUpsMap:x,winningSide:z,targetData:te,matchUpId:re,structure:b,matchUp:q,score:K,event:v});J.error&&console.log(J.error)}),(Y=k==null?void 0:k.filter(q=>q.matchUpStatus===xt&&q.structureId===r))==null||Y.forEach(q=>{let{matchUpId:re}=q,K=Un({inContextDrawMatchUps:k,drawDefinition:y,matchUpId:re}),{targetLinks:{loserTargetLink:z},targetMatchUps:{loserMatchUpDrawPositionIndex:te,loserMatchUp:J}}=K;if(z&&J){let ie=z.target.structureId,ne=J.drawPositions[te],ue=xa({drawPosition:ne,structureId:ie,tournamentRecord:d,drawDefinition:y,event:v});ue.error&&console.log(ue.error)}});let L=[],B=Vd({inContextDrawMatchUps:k,drawDefinition:y,matchUpsMap:x}).goesToMap,{structure:V}=Qe({drawDefinition:t.drawDefinition,structureId:r}),{matchUps:G}=_t({structure:V});return G.forEach(q=>{var z,te;let re=B==null?void 0:B.loserMatchUpIds[q.matchUpId];if(re&&q.loserMatchUpId!==re){q.loserMatchUpId=re;let J={tournamentId:d==null?void 0:d.tournamentId,eventId:(z=t.event)==null?void 0:z.eventId,context:e,matchUp:q};L.push(J)}let K=B==null?void 0:B.winnerMatchUpIds[q.matchUpId];if(K&&q.winnerMatchUpId!==K){q.winnerMatchUpId=K;let J={tournamentId:d==null?void 0:d.tournamentId,eventId:(te=t.event)==null?void 0:te.eventId,context:e,matchUp:q};L.push(J)}}),{structures:C,matchUpModifications:L,links:O,drawDefinition:y,...X}}function pq(t){return sD({...t,itemType:"attachConsolationStructures"})}function EO(t){return sD({...t,itemType:"attachPlayoffStructures"})}function sD({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var g,v,I;let s="attachStructures";if(!r)return{error:xe};if(!Array.isArray(n)||!Array.isArray(a))return Q({result:{error:le},stack:s});let l=y=>{var b;return[y.source.structureId,y.source.roundNumber||((b=y.source.finishingPositions)==null?void 0:b.join("|")),y.target.roundNumber].join("|")},c=(g=r.links)==null?void 0:g.map(l);if(a.some(y=>{let b=l(y);return c==null?void 0:c.includes(b)}))return Q({result:{error:xN},info:"playoff structure exists",stack:s});a.length&&((v=r.links)==null||v.push(...a));let u=n.map(({structureId:y})=>y),d=(I=r.structures)==null?void 0:I.map(({structureId:y})=>y);r.structures=(r.structures??[]).map(y=>u.includes(y.structureId)?n.find(({structureId:b})=>b===y.structureId):y);let p=n==null?void 0:n.filter(({structureId:y})=>!(d!=null&&d.includes(y)));p.length&&r.structures.push(...p),Vd({drawDefinition:r});let m=n.map(y=>{var b;return((b=_t({structure:y}))==null?void 0:b.matchUps)||[]}).flat();Rc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:m});let h=n.map(({structureId:y})=>y);if(ai({drawDefinition:r,structureIds:h}),e==null?void 0:e.length){let y={};e.forEach(S=>{var U;let w=(U=S.matchUp)==null?void 0:U.matchUpId;w&&(y[w]=S)});let b=S=>{S.matchUps.forEach(w=>{if(y[w.matchUpId]){let{tieMatchUps:U,...T}=y[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let P={};U.forEach(R=>y[R.matchUpId]=R),w.tieMatchUps.forEach(R=>Object.assign(R,P[R.matchUpId]))}y[w.matchUpId].matchUp=w,St(y[w.matchUpId])}})};r.structures.forEach(S=>{if(d!=null&&d.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let f=p.map(ca("structureId"));if(i){let y={itemValue:{structureIds:h,drawId:r.drawId},itemType:t};Jl({element:i,timeItem:y})}return{...X,addedStructureIds:f}}function lD(t){var o,s;let{structures:e,links:i,matchUpModifications:r,error:n}=RO(t);if(n)return{error:n};let a=t.drawDefinition;return EO({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:r,drawDefinition:a,structures:e,links:i})}function jd(t){let e=it(t,[{_anyOf:{[rn]:!1,[Fn]:!1,[ya]:!1,[up]:!1},[GN]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=_B(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&ai({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:fe};for(let a of n){let o=t.tournamentRecords[a],s=_B(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:fe};return i.length?{...X,applied:i}:{error:wN}}function _B(t,e){let i=Nt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:oT};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Ut(o))return{error:le};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Ki(s))return{error:le};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{...Ct({element:e,extension:{name:RI,value:i}}),applied:r}:{applied:r,error:wN}}function CO({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var s;if(!r||typeof r!="string")return Q({result:{error:le},context:{drawName:r}});i||(i=qi({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===n);if(o){o.drawName=r;let l={name:No,value:{...i,flights:i.flights}};qc({event:a,extension:l})}return e&&(e.drawName=r,ai({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:xe}:{...X,flight:o}}function mq({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var l;if(!Ut(i))return{error:le};let a=qi({event:n}).flightProfile,o=i.drawName&&CO({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:r,event:n});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(c=>c.drawId===r));if(!s&&!e)return{error:xe};if(s){let c={name:No,value:{...a,flights:a.flights}};qc({event:n,extension:c})}return e&&(i.policyDefinitions&&jd({policyDefinitions:i.policyDefinitions,drawDefinition:e}),ai({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...X}}function hq({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:xe};let r=Jr({drawDefinition:i}),n=l=>{var c;return(c=r==null?void 0:r.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![We,Ae].includes(u))&&(l.positionAssignments=c.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=_t({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],I=n(f);if(I){if(delete I.extensions,delete I.notes,I.matchUpStatus!==xt&&Object.assign(I,nD),g&&g>1&&((o=I.drawPositions)==null?void 0:o.length)&&!m){let y=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=I.drawPositions.map(S=>y.includes(S)?void 0:S);I.drawPositions=b}e?delete I.timeItems:(s=I.timeItems)!=null&&s.length&&(I.timeItems=I.timeItems.filter(y=>y.itemType&&![bu,Ld,kg,bz,xg,Fg].includes(y.itemType))),St({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:I})}}}let a=(i.structures||[]).map(({structureId:l})=>l);return ai({drawDefinition:i,structureIds:a}),{...X}}function Sb({tournamentRecord:t}){var r;if(!t)return{error:fe};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((r=t.events)==null?void 0:r.map(n=>{let a=n.eventId;return i[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:c}=eD({drawDefinition:n}),u=i[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=Pm[S],{inContextStructureMatchUps:P}=nb({drawDefinition:n,structure:b,event:u}),R=P==null?void 0:P.filter(({winningSide:L})=>L),D=R.filter(Boolean).length||0;s+=D,l+=P.length-s;let E=Math.max(R.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=Qt({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:C,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=wn({matchUps:P}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:C,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=Lg({structureId:p.structureId,drawDefinition:n}),f=Je(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),I=n.drawId;o&&!s&&e.positionsNoOutcomes.push(I),g&&e.inactive.push(I),f&&e.matchPlay.push(I),v&&e.canBePruned.push(I);let y={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:I};e.drawAnalysis[I]=y}),{...X,drawsAnalysis:e}}function fq({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var o;if(!e)return{error:fe};if(!i)return{error:xe};let n=[],{drawsAnalysis:a}=Sb({tournamentRecord:e});if(a.canBePruned.includes(r)){let s=a.matchPlay.includes(r),l=a.drawAnalysis[r],{structures:[c]}=Oo({stageSequence:1,drawDefinition:i,stage:Ae}),u=l.structuresData.find(({structureId:h})=>c.structureId===h),d=(c.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);n=d.filter(({roundNumber:h})=>!u.inactiveRounds.includes(h));let p=n.map(br),m=d.map(br).filter(h=>!p.includes(h));if(s){let h=n.filter(({roundNumber:y})=>!u.inactiveRounds.includes(y)).filter(({winningSide:y})=>y),f=h.map(br),g=p.filter(y=>!f.includes(y));m.push(...g);let v=h.flatMap(y=>y.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...v.map((y,b)=>({[y]:b+1})));if(h.forEach(y=>{t?y.drawPositions=y.drawPositions.map(b=>I[b]):delete y.drawPositions}),t){let y=(o=c==null?void 0:c.positionAssignments)==null?void 0:o.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=I[b.drawPosition],b));c.positionAssignments=y}else c.positionAssignments=[];c.matchUps=h,n=h}$u({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),ai({drawDefinition:i})}return{...X,matchUps:n}}function gq({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:xe};if(!r)return{error:yg};if(!n)return{error:Aa};if(s){let l=xa({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:hT};{let l=Ws({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...X}}function vq(t){var l,c,u,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,r=t.structureId??((c=(l=i==null?void 0:i.structures)==null?void 0:l.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>e.includes(f))}))==null?void 0:c.structureId)??((d=(u=i==null?void 0:i.structures)==null?void 0:u[0])==null?void 0:d.structureId);if(!r)return{error:Ti};let n=(p=i.structures)==null?void 0:p.find(m=>m.structureId===r);if(!n)return{error:Ti};let a=n==null?void 0:n.matchUps,o=a==null?void 0:a.find(m=>!!m.roundPosition);if(n.structures||o||n.finishingPosition===th)return{error:sp};let s=a.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(br);return e=e.filter(m=>!s.includes(m)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:r,structure:n}}function Iq(t){let e=it(t,[{[ya]:!0},{[TI]:{[Ay]:!1,roundNumbers:!1},[fs]:le,[so]:Mn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=vq(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:I,winningSide:y})=>{if(y&&!n)return!1;if(y||gr({score:I})){if(!y&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(br),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(br)).filter(Boolean).flat();if(f.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:y})=>!f.includes(y)),$u({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=mt(c.matchUps.map(ca("roundNumber"))),I=fne(v);if(I.length){I.reverse();for(let y of I)c.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>y&&(b.roundNumber-=1,St({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){c.positionAssignments=mt(c.matchUps.flatMap(w=>(w.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(w=>({participantId:w}));let y=(c==null?void 0:c.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:b}=_t({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),S=SO({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:y,matchUps:b,event:s});S.error&&console.log(S)}ai({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:gT}:{...X,deletedMatchUpsCount:[...f,...g].length}}function yq({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:fe};if(!i)return{error:xe};if(!n)return Q({result:{error:ze},info:"roundNumber required"});let o=Qe({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:sp}:Wn({structure:s})?Wle({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...X})}function Wle({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],c=!1;if(o.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ar).includes(r)){let u=o.filter(d=>{let p=d.roundNumber===r&&(!fr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(br))),!p});l.length&&($u({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===r)||(u.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,St({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),n.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...X}}function uD(t){var p,m,h,f,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:r,matchUps:n,event:a}=t;if(typeof r!="object")return{error:xe};let o=t==null?void 0:t.structureId;if(!o&&((p=r.structures)==null?void 0:p.length)===1&&(o=(h=(m=r.structures)==null?void 0:m[0])==null?void 0:h.structureId),typeof o!="string")return{error:Aa};if(!uo(n))return{error:le,info:Uu("matchUps")};let s=(f=r.structures)==null?void 0:f.find(I=>I.structureId===o);if(!s)return{error:Ti};let l=(s==null?void 0:s.matchUps).find(I=>!!I.roundPosition);if(s.structures||l||s.finishingPosition===th)return{error:sp};let c=((v=(g=kr({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(br))??[],u=n.map(br);if(bn(c,u))return{error:KG,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...n);let d=n.map(({tieMatchUps:I})=>I).filter(Boolean).flat();return e||(Rc({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...n],eventId:a==null?void 0:a.eventId,drawDefinition:r}),ai({drawDefinition:r,structureIds:[o]})),{...X}}function bq({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var m;if(!e)return{error:xe};if(!r)return{error:Aa};if(!i)return{error:yg};let{structure:o}=Qe({drawDefinition:e,structureId:r});if(!o)return{error:Ti};let s=o;o.structures&&o.structureType===En&&(s=(m=o.structures)==null?void 0:m.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,c=l==null?void 0:l.find(h=>h.drawPosition===i);c&&Ct({element:c,extension:{name:Rf,value:n}});let u=((a==null?void 0:a.eventType)===ci||e.matchUpType===ci||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[ci]},{matchUps:d}=_t({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return SO({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),ai({drawDefinition:e,structureIds:[r]}),{...X}}var wq={};gt(wq,{addGoesTo:()=>Vd,allPlayoffPositionsFilled:()=>uO,checkValidEntries:()=>pD,findDrawDefinition:()=>OO,getAssignedParticipantIds:()=>fp,getAvailableMatchUpsCount:()=>cD,getAvailablePlayoffProfiles:()=>fb,getDrawDefinitionTimeItem:()=>OA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>Oo,getDrawTypeCoercion:()=>Tb,getEligibleVoluntaryConsolationParticipants:()=>MO,getMatchUpsMap:()=>Jr,getParticipantIdFinishingPositions:()=>AO,getPositionAssignments:()=>$I,getPositionsPlayedOff:()=>jg,getSeedingThresholds:()=>rO,getSeedsCount:()=>Db,getStructureSeedAssignments:()=>ro,getTeamLineUp:()=>Bd,getValidGroupSizes:()=>cb,isAdHoc:()=>Wn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>FO,positionActions:()=>xO});function MO({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:m}){var O,k,x,F,$;if(!s)return{error:xe};let h=[Ae,xi];i&&h.push(We);let f=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&m?((O=Kl({contextFilters:{stages:h},matchUpFilters:f,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:O.matchUps)??[]:((k=vn({contextFilters:{stages:h},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:k.matchUps)??[],I=ah({stage:Rr,drawDefinition:s}).map(({participantId:_})=>_),y={},b={},S={},w={};n||(n=Bu({policyTypes:[TC],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let U=n==null?void 0:n[TC];t=t.length&&t||(U==null?void 0:U.excludedMatchUpStatuses)||[],e=e??(U==null?void 0:U.includeEventParticipants),d=d??(U==null?void 0:U.allEntries),r=r??(U==null?void 0:U.finishingRoundLimit),a=a??(U==null?void 0:U.roundNumberLimit),l=l??(U==null?void 0:U.matchUpsLimit),c===void 0&&(c=(U==null?void 0:U.requirePlay)!==void 0?U.requirePlay:!0),u===void 0&&(u=(U==null?void 0:U.requireLoss)!==void 0?U.requireLoss:!0),p=p??(U==null?void 0:U.winsLimit);for(let _ of v){if(c&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==tr||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(x=_.sides)==null?void 0:x.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(F=_.sides)==null?void 0:F.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if(($=_.sides)==null||$.forEach(V=>{var j;let G=(j=V==null?void 0:V.participant)==null?void 0:j.participantId;G&&(S[G]=V.participant,_.matchUpStatus===tr&&!c&&(b[G]=V.participant,y[G]||(y[G]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(y[G]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;b[V]=L.participant,y[V]||(y[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(y[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;w[V]||(w[V]=0),w[V]+=1,y[V]||(y[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(y[V]+=1)}}let T=(o==null?void 0:o.participants)&&!c&&!u&&d,P=T?((e&&m?m.entries:s.entries)??[]).filter(_=>![yu,Ho].includes(_.entryStatus)).map(({participantId:_})=>_):[],R=Object.keys(b),D=T?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>P.includes(_)):u&&Object.values(b)||Object.values(S),E=_=>!u||R.includes(_),N=_=>!c||(y[_]||0)>=0,A=_=>!p||(w[_]||0)<=p,M=_=>!l||y[_]<=l,C=_=>!I.includes(_);return{eligibleParticipants:D.filter(_=>E(_.participantId)&&N(_.participantId)&&A(_.participantId)&&M(_.participantId)&&C(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:R,...X}}function cD(t){var h,f,g,v,I,y,b,S;let e=it(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:r}=t,n=t.structureId??(((h=i.structures)==null?void 0:h.length)===1&&((g=(f=i.structures)==null?void 0:f[0])==null?void 0:g.structureId));if(typeof n!="string")return{error:Aa};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===n);if(!a)return{error:Ti};let o,s=(I=a.matchUps??[])==null?void 0:I.reduce((w,U)=>(U.roundPosition&&(o=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(a.structures||o||a.finishingPosition===th)return{error:sp};let l=((y=i==null?void 0:i.entries)==null?void 0:y.filter(w=>{let U=w.entryStatus;return zo.includes(U)}))??[],c=Math.floor((l==null?void 0:l.length)/2)||1,u=r??s??1,d=((S=(b=a.matchUps)==null?void 0:b.filter(w=>w.roundNumber===u))==null?void 0:S.length)??0,p=c-d,m=p>0?p:0;return{...X,availableMatchUpsCount:m,lastRoundNumber:s,roundMatchUpsCount:c}}function NO({drawDefinition:t}){var i;let e=dt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function qle({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:xe};let r=ur({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=ke(r.matchUps,!1,!0),a=mt(n.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function AO({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:xe};let{participantIds:r,participantIdMatchUps:n}=qle({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[_i,xt].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function Qc({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:fe};if(!r)return{error:Ds};if(!e&&t){if(typeof i!="string"&&(i=cq({tournamentRecords:t,drawId:r}),!i))return{error:vf};if(e=t[i],!e)return{error:fe}}let n=e&&An({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...X}:Q({result:{error:Pa},stack:"findDrawDefinition"})}function OO(t){let{drawDefinition:e,error:i}=Qc(t);return i?{error:i}:{drawDefinition:ke(e)}}function VC({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=Lg({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=Qe({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}function Yle({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[Ho,mp].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=r.individualParticipantIds,c=e?t.filter(({participantId:d})=>o.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:Ge({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:Zse,availableIndividualParticipantIds:o,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:mO},!1,!1,!0)}}return{}}function Gd(t){var m,h;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:r,relevantLink:n}=t;if((n==null?void 0:n.linkCondition)===xl&&((m=i==null?void 0:i.matchUp)==null?void 0:m.matchUpStatus)===xt)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=[Rt,Lt].includes(a==null?void 0:a.matchUpStatus),c=((h=o==null?void 0:o.drawPositions)==null?void 0:h.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!l||o!=null&&o.winningSide&&c===2&&(!o.feedRound||![Lt,Rt].includes(o==null?void 0:o.matchUpStatus)))return!0;let u=a&&Un({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),d=o&&Un({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),p=u&&Gd({relevantLink:s==null?void 0:s.loserTargetLink,targetData:u,inContextDrawMatchUps:e,drawDefinition:r});return!!(d&&Gd({targetData:d,inContextDrawMatchUps:e,drawDefinition:r})||p)}var Kle={[Sm]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[We,Ae],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[ZS,Ff,tD,eI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},aS="positionAction",jC="matchUpAction";function Uq({actionType:t=aS,appliedPolicies:e,drawDefinition:i,structure:r}){var d,p;let n=t===aS&&Sm||t===jC&&Pr,a=t===aS&&Kle||t===jC&&eW,o=n&&((e==null?void 0:e[n])||(a==null?void 0:a[n])),s=((p=(d=i.links)==null?void 0:d.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:p.map(({target:m})=>m.feedProfile))??[],{enabledStructures:l,disabledStructures:c}=o||{},u=c==null?void 0:c.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(I=>s.includes(I)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:o}}function $B({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Sq({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:r,stageSequence:n,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:m}=c||{},h=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(r),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(n),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(I=>o.includes(I));return f&&g&&v&&c&&h})}}function $n({action:t,policyActions:e}){var r;let i=!(e!=null&&e.enabledActions)||((r=e==null?void 0:e.disabledActions)==null?void 0:r.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var Tq="replaceTieMatchUpParticipantId",Dq="assignTieMatchUpParticipantId",GC="removeTieMatchUpParticipantId",BB="assignMatchUpSideParticipant",Jle="removeMatchUpSideParticipant",Pq="substituteParticipant",HC="REMOVE_SUBSTITUTION",Rq="REPLACE_PARTICIPANT",kO="REMOVE_PARTICIPANT",zC="setMatchUpStatus",WC="SUBSTITUTION",Eq="SCHEDULE",Xle="PENALTY",qC="REFEREE",Cq="STATUS",YC="START",Mq="SCORE",KC="END",Zle={REPLACE_TEAM_POSITION_METHOD:Tq,ASSIGN_TEAM_POSITION_METHOD:Dq,REMOVE_TEAM_POSITION_METHOD:GC,REPLACE_PARTICIPANT:Rq,SUBSTITUTION_METHOD:Pq,REMOVE_SUBSTITUTION:HC,REMOVE_PARTICIPANT:kO,SCHEDULE_METHOD:zC,SUBSTITUTION:WC,SCHEDULE:Eq,PENALTY:Xle,REFEREE:qC,STATUS:Cq,SCORE:Mq,START:YC,END:KC};function Qle({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var A,M,C,O,k,x,F,$,_,L,B,V,G,j,H;let m=[],h=(A=n.sides)==null?void 0:A.find(W=>W.participant),f=n.gender===Gn&&n.sideNumber&&((M=n.sides)==null?void 0:M.filter(W=>W.particiapntId).length)===1&&((O=(C=h==null?void 0:h.participant)==null?void 0:C.person)==null?void 0:O.sex),g=n.matchUpType,v=(o??((k=r==null?void 0:r.participants)==null?void 0:k.enforceGender))!==!1?n.gender:void 0,I=(F=(x=n.sides)==null?void 0:x.flatMap(W=>{var Y;return((Y=W.participant)==null?void 0:Y.individualParticipants)||W.participant}).filter(Boolean))==null?void 0:F.map(vt),y=($=n.sides)==null?void 0:$.filter(W=>!l||W.sideNumber===l).flatMap(W=>{var Y;return((Y=W.participant)==null?void 0:Y.individualParticipants)||W.participant}).filter(Boolean),b=y==null?void 0:y.map(vt),S=(L=(_=e==null?void 0:e.find(W=>W.matchUpId===n.matchUpTieId))==null?void 0:_.sides)==null?void 0:L.map(W=>{var Y,q;return(q=(Y=W==null?void 0:W.participant)==null?void 0:Y.individualParticipants)==null?void 0:q.filter(({participantId:re,person:K})=>!(b!=null&&b.includes(re))&&(!v||v===Is||K.sex===v||v===Gn&&!f||f&&K.sex!==f))}),w=l?S==null?void 0:S[l-1]:S==null?void 0:S.map((W,Y)=>({participants:W,sideNumber:Y+1})),U=l?(B=S==null?void 0:S[l-1])==null?void 0:B.map(vt):S==null?void 0:S.map((W,Y)=>({participants:W==null?void 0:W.map(vt),sideNumber:Y+1})),T=l&&($i(Qp)(g)&&!(b!=null&&b.length)||$i(Fd)(g)&&((b==null?void 0:b.length)??0)<2)||!l&&($i(Qp)(g)&&((b==null?void 0:b.length)??0)<2||$i(Fd)(g)&&((b==null?void 0:b.length)??0)<4),P=U==null?void 0:U.filter(W=>!(I!=null&&I.includes(W))),R=w==null?void 0:w.filter(({participantId:W})=>P.includes(W));if(T&&(P!=null&&P.length)&&m.push({availableParticipantIds:P,method:Dq,availableParticipants:R,type:Em,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),b!=null&&b.length&&(!gr(u)||(V=p==null?void 0:p.substitutions)!=null&&V.length)&&m.push({method:GC,type:kO,existingParticipantIds:b,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),R!=null&&R.length&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&m.push({availableParticipantIds:P,method:Tq,availableParticipants:R,type:Rq,existingParticipantIds:b,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),$n({policyActions:a,action:HC})&&((G=p==null?void 0:p.substitutions)==null?void 0:G.length)){let W=((j=p.participant)==null?void 0:j.participantType)===It&&[p.participantId]||((H=p.participant)==null?void 0:H.participantType)===ot&&p.participant.individualParticipantIds||[],Y=p.substitutions.map(q=>q.participantId).filter(q=>W.includes(q));(!s||Y.includes(s))&&m.push({method:GC,type:HC,substitutedParticipantIds:Y,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let D=t==null?void 0:t[Pr],E=D==null?void 0:D.substituteWithoutScore,N=D==null?void 0:D.substituteAfterCompleted;if($n({policyActions:a,action:WC})&&i.length===2&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&(E||gr(u))&&(N||u.matchUpStatus&&!fr.includes(u.matchUpStatus))&&(y!=null&&y.length)&&w.length){let W=y.map(vt);m.push({info:"list of team players available for substitution",method:Pq,availableParticipantIds:U,existingParticipantIds:W,availableParticipants:w,existingParticipants:y,type:WC,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return m}function eue({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var U,T,P,R,D;if(i.includes(s))return{};let m=(U=l.find(E=>E.type===Em))==null?void 0:U.availableParticipantIds,h=(T=a==null?void 0:a[Sm])==null?void 0:T.otherFlightEntries,f=(P=a==null?void 0:a[Sm])==null?void 0:P.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:E})=>!f||(u.stage===We?E===We:E!==We)).sort((E,N)=>(E.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:E})=>E).filter(Boolean),{allPositionedParticipantIds:v}=QH({drawDefinition:o}),I=r.map(E=>E.participantId).filter(Boolean),y=g.filter(E=>u.stage&&[We,Ae,xi].includes(u.stage)?!(v!=null&&v.includes(E)):!I.includes(E)),b=((p==null?void 0:p.entries)??[]).filter(E=>E.entryStatus===To&&Nq({restrictQualifyingAlternates:f,structure:u,entry:E})&&(u.stage&&[We,Ae,xi].includes(u.stage)?!(v!=null&&v.includes(E.participantId)):!I.includes(E.participantId))).sort((E,N)=>(E.entryPosition??1/0)-(N.entryPosition??1/0)).map(E=>E.participantId),S=mt(y.concat(b));if(h){let E=(D=(R=p?qi({event:p}).flightProfile:void 0)==null?void 0:R.flights)==null?void 0:D.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![yu,Ho,mp].includes(A.entryStatus)&&!g.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);E!=null&&E.length&&S.push(...E)}m!=null&&m.length&&(S=S.filter(E=>!m.includes(E)));let w=n?t==null?void 0:t.filter(E=>S.includes(E.participantId)):void 0;return w==null||w.forEach(E=>{let N=(o.entries??[]).find(A=>A.participantId===E.participantId);E.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((E,N)=>(E.entryPosition||1/0)-(N.entryPosition||1/0)),S.length?{validAlternatesAction:Ge({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:Jse,availableAlternatesParticipantIds:S,type:hO,availableAlternates:w})}:{}}function Nq({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===We&&!t||i.entryStage===Ae&&r===Wr)return!0}function tue({eventEntries:t,structure:e}){let i=n=>n.entryStatus===To&&Nq({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(vt)}function iue({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var T,P,R,D,E,N,A;let p=[],m=(l==null?void 0:l.matchUps)??[],h=(P=(T=c.sides)==null?void 0:T.find(M=>M.sideNumber===o))==null?void 0:P.participantId,f=m.filter(({roundNumber:M})=>M===c.roundNumber),g=((R=n==null?void 0:n.entries)==null?void 0:R.filter(({entryStatus:M})=>M&&hp.includes(M)).map(vt))??[],v=f.map(M=>(M.sides??[]).flatMap(vt)).flat().filter(Boolean),I=g.filter(M=>!i.includes(M)&&(!t||!v.includes(M))),y=e==null?void 0:e.filter(M=>I==null?void 0:I.includes(M.participantId)).map(M=>ke(M,void 0,!0));y==null||y.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),I.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:BB,type:Em,availableParticipantIds:I,participantsAvailable:y});let b=(d==null?void 0:d.entries)??[],S=tue({eventEntries:b,structure:l}),w=mt(g.concat(S));if(r){let M=(E=(D=d?qi({event:d}):void 0)==null?void 0:D.flights)==null?void 0:E.filter(C=>C.drawId!==u).flatMap(C=>C.drawEntries.filter(O=>O.participantId&&![yu,Ho,mp].includes(O.entryStatus)).map(({participantId:O})=>O)).filter(Boolean);M!=null&&M.length&&w.push(...M)}w=w.filter(M=>!i.includes(M)&&!I.includes(M)&&(!t||!v.includes(M)));let U=e==null?void 0:e.filter(M=>w.includes(M.participantId)).map(M=>ke(M,void 0,!0));if(U==null||U.forEach(M=>{let C=(n.entries??[]).find(O=>O.participantId===M.participantId);M.entryPosition=C==null?void 0:C.entryPosition}),U==null||U.sort((M,C)=>(M.entryPosition||1/0)-(C.entryPosition||1/0)),w.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:w,participantsAvailable:U,method:BB,type:To}),!gr(c)&&o&&h){p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:Jle,type:kO});let M=L=>L.sides.map(vt),C=({matchUpId:L})=>L!==c.matchUpId,O=L=>!gr(L),k=(A=(N=c.sides)==null?void 0:N.find(L=>L.sideNumber!==o))==null?void 0:A.participantId,x=m.filter(({roundNumber:L})=>L!==c.roundNumber).filter(C).map(M),F=[k,...x.filter(L=>L.includes(h)).flat()].filter(Boolean),$=L=>!F.flat().includes(L),_=f.filter(O).filter(C).map(M).flat().filter($);if(_.length){let L=e==null?void 0:e.filter(B=>_.includes(B.participantId)).map(B=>ke(B,void 0,!0));p.push({payload:{participantIds:[h],roundNumber:c.roundNumber,structureId:a,sideNumber:o,matchUpId:s,drawId:u},swappableParticipantIds:_,method:Qse,type:iD,swappableParticipants:L})}}return p}function dD(t){var W,Y,q,re,K,z,te,J,ie;if(!t)return{error:le};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:r=!0,policyDefinitions:n,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&Ki(t.tournamentId)&&((W=t.tournamentRecords)==null?void 0:W[t.tournamentId]));if(!c)return{error:fe};if(!l||!Ki(l))return{error:pn};if(s&&![1,2].includes(s))return Q({result:{error:le},context:{sideNumber:s}});if(!e){let ne=(kr({tournamentRecord:c}).matchUps??[]).find(ae=>ae.matchUpId===l);i=((c==null?void 0:c.events)??[]).find(ae=>ae.eventId===(ne==null?void 0:ne.eventId));let ue=((i==null?void 0:i.drawDefinitions)??[]).find(ae=>ae.drawId===(ne==null?void 0:ne.drawId));ue&&(e=ue)}if(!e)return{error:xe};let u=Gi({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:m}=hi({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:tn};let h=Nt({tournamentRecord:c,drawDefinition:e,structure:m,event:i}).appliedPolicies??{};Object.assign(h,n??{});let f=(Y=h==null?void 0:h[Sm])==null?void 0:Y.otherFlightEntries,g=(h==null?void 0:h[Pr])??Bg[Pr],{enabledStructures:v}=Uq({actionType:jC,appliedPolicies:h,drawDefinition:e,structure:m}),{policyActions:I}=Sq({enabledStructures:v,drawDefinition:e,structure:m}),y=t.matchUpsMap??Jr({drawDefinition:e}),b=t.inContextDrawMatchUps??ur({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:y,event:i}).matchUps,S=b==null?void 0:b.find(ne=>ne.matchUpId===l),w=s&&((q=S==null?void 0:S.sides)==null?void 0:q.find(ne=>ne.sideNumber===s)),U=((re=S==null?void 0:S.sides)==null?void 0:re.map(ne=>{var ue;return ne.participantId||((ue=ne.participant)==null?void 0:ue.participantid)}).filter(Boolean))??[],{assignedPositions:T,allPositionsAssigned:P}=Ur({structure:m}),{structureId:R}=m??{},D=[];if(!R)return{validActions:D};let E=Wn({structure:m}),N=p.collectionId;if(E&&!N){let ne=iue({restrictAdHocRoundParticipants:r,tournamentParticipants:u,matchUpParticipantIds:U,otherFlightEntries:f,drawDefinition:e,structureId:R,sideNumber:s,matchUpId:l,structure:m,matchUp:p,drawId:d,event:i});D.push(...ne)}let A=Cc({drawDefinition:e,structure:m}),M=T==null?void 0:T.filter(ne=>ne.participantId).map(ne=>ne.drawPosition),C=T==null?void 0:T.filter(ne=>ne.bye).map(ne=>ne.drawPosition),O=p.matchUpStatus===xt||!N&&((K=p.drawPositions)==null?void 0:K.reduce((ne,ue)=>(C==null?void 0:C.includes(ue))||ne,!1));if(O)return{validActions:D,isByeMatchUp:O};$n({policyActions:I,action:qC})&&D.push({type:qC,payload:{matchUpId:l}});let k=!rb({matchUpStatus:p.matchUpStatus}),x=(z=h==null?void 0:h.scoring)==null?void 0:z.structures,F=(m==null?void 0:m.stage)&&(x==null?void 0:x.stage)&&(x==null?void 0:x.stage[m.stage]),$=(m==null?void 0:m.stageSequence)&&(F==null?void 0:F.stageSequence)&&F.stageSequence[m.stageSequence],_=!((te=h==null?void 0:h.scoring)!=null&&te.requireAllPositionsAssigned||F!=null&&F.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned)||P,L=p.sides&&p.sides.filter(ne=>ne==null?void 0:ne.participantId).length===2,B=p.matchUpStatus&&[tr,mr].includes(p.matchUpStatus),V=Un({inContextDrawMatchUps:b,drawDefinition:e,matchUpId:l}),G=Gd({inContextDrawMatchUps:b,drawDefinition:e,targetData:V}),j=(((J=S==null?void 0:S.drawPositions)==null?void 0:J.length)===2&&S.drawPositions.every(ne=>M==null?void 0:M.includes(ne))&&((ie=S==null?void 0:S.sides)==null?void 0:ie.length)===2&&S.sides.every(({participantId:ne})=>ne)||L)&&!(B&&G),H={method:_W,type:Ff,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(k&&D.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:zC,type:Eq}),$n({policyActions:I,action:Ff})&&(w!=null&&w.participant||!s&&(U!=null&&U.length))&&D.push(H),k&&j&&D.push({type:Cq}),_&&j){let{matchUpId:ne,matchUpFormat:ue}=p,ae={drawId:d,matchUpId:ne,matchUpFormat:ue,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};D.push({info:"set outcome and winningSide",method:zC,type:Mq,payload:ae}),$n({policyActions:I,action:YC})&&D.push({type:YC}),$n({policyActions:I,action:KC})&&D.push({type:KC})}if(N&&S){let ne=Qle({specifiedPolicyDefinitions:n,inContextDrawMatchUps:b,matchUpParticipantIds:U,matchUpActionsPolicy:g,inContextMatchUp:S,policyActions:I,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});D.push(...ne)}return{structureIsComplete:A,validActions:D,isDoubleExit:B,...X}}function rue({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var v,I,y,b,S,w,U;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:p,targetStructureIds:m}=((v=o.links)==null?void 0:v.reduce((T,P)=>{var E,N;let R=(E=P.source)==null?void 0:E.structureId,D=(N=P.target)==null?void 0:N.structureId;return T.sourceStructureIds.includes(R)||T.sourceStructureIds.push(R),T.targetStructureIds.includes(D)||T.targetStructureIds.push(D),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},h=[],f=((I=o.links)==null?void 0:I.filter(T=>{var P;return((P=T.target)==null?void 0:P.structureId)===c.structureId}))??[];for(let T of f){let P=(y=T==null?void 0:T.source)==null?void 0:y.structureId,{structure:R}=Qe({structureId:P,drawDefinition:o}),D=(R==null?void 0:R.finishingPosition)===th&&((p==null?void 0:p.length)!==1||(m==null?void 0:m.length)!==1),E={};if(D){let{matchUps:M}=_t({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:C}=Rm({drawPosition:s,matchUps:M}),O=(w=(S=(b=o.links)==null?void 0:b.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(c==null?void 0:c.structureId)&&k.target.roundNumber===C}))==null?void 0:S.source)==null?void 0:w.roundNumber;E.roundNumbers=[O]}let{completedMatchUps:N}=YT({structureId:P,inContext:!0,matchUpFilters:E,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(U=N==null?void 0:N.filter(({matchUpType:M,winningSide:C})=>C&&((d==null?void 0:d.eventType)!==or||M===or)).map(({winningSide:M,sides:C})=>M&&(C==null?void 0:C[1-(M-1)])).map(vt).filter(M=>M&&!A.includes(M)))==null||U.forEach(M=>{h.includes(M)||h.push(M)})}let g=t==null?void 0:t.filter(T=>h==null?void 0:h.includes(T.participantId));return g==null||g.forEach(T=>{let P=(o.entries??[]).find(R=>R.participantId===T.participantId);T.entryPosition=P==null?void 0:P.entryPosition}),h!=null&&h.length?{validLuckyLosersAction:{type:gO,method:Xse,availableLuckyLosers:g,availableLuckyLoserParticipantIds:h,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function nue({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:m,event:h}){var S,w,U;let{drawId:f}=c,g=[],v,I,y=[],b=(w=(S=l==null?void 0:l[es])==null?void 0:S.validSeedPositions)==null?void 0:w.ignore;if(b||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:I,unfilledPositions:y}=mW({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:m,event:h})),y!=null&&y.length||(y=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||g.push({payload:{drawId:f,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:ile,type:QS}),a&&b){let T=o.map(N=>N.participantId).filter(Boolean),P={structureIds:t},{completedMatchUps:R}=_g({inContext:!0,matchUpFilters:P,drawDefinition:c}),D=mt((U=(R??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==or||N===or))==null?void 0:U.map(({sides:N})=>N==null?void 0:N.map(vt)).flat().filter(N=>N&&!T.includes(N))),E=s?n==null?void 0:n.filter(N=>D==null?void 0:D.includes(N.participantId)).map(N=>ke(N,void 0,!0)):void 0;return E==null||E.forEach(N=>{let A=(c.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),E!=null&&E.length&&g.push(Ge({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:CB,type:Em,availableParticipantIds:D,participantsAvailable:E})),{validAssignmentActions:g}}if(y.includes(p)||d){let T;if(I!=null&&I.length){let R=I.filter(D=>v==null?void 0:v.includes(D.participantId));R.sort(aue),T=R.map(D=>D.participantId)}else T=e;let P=s?n==null?void 0:n.filter(R=>T.includes(R.participantId)).map(R=>ke(R,void 0,!0)):void 0;P!=null&&P.length&&g.push(Ge({payload:{drawId:f,structureId:m,drawPosition:p},willDisableLinks:i,method:CB,type:Em,availableParticipantIds:T,participantsAvailable:P}))}return{validAssignmentActions:g}}function aue(t,e){return t.bye||kf(t.seedValue)<kf(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function oue({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var S,w,U;let c=[],u=[],d=[],p=[],m=i.map(T=>T.participantId).filter(Boolean),h=n==null?void 0:n[Sm],f=!(h!=null&&h.disableRoundRestrictions)&&t[o],g=h==null?void 0:h.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:I}=VC({targetRoundNumber:f,linkType:vu,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:y,relevantLinks:b}=VC({targetRoundNumber:f,linkType:gu,drawDefinition:a,structureId:s})||{};y!=null&&y.length&&p.push(...y);for(let T of I){let P=(S=a.structures)==null?void 0:S.find(D=>D.structureId===T.source.structureId);if((P==null?void 0:P.stage)!==We)continue;let R=Cc({structureId:T.source.structureId,drawDefinition:a});if(!g||R){let D=P.qualifyingRoundNumber,{matchUps:E}=_t({matchUpFilters:{roundNumbers:[D],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:P});for(let N of E){let A=N.sides.find(C=>(C==null?void 0:C.sideNumber)===N.winningSide),M=N.matchUpStatus===xt&&((w=N.sides)==null?void 0:w.find(({participantId:C})=>C));if(A||M){let{participantId:C,participant:O}=A||M||{};C&&!m.includes(C)&&(O&&r&&c.push(O),u.push(C))}}}}for(let T of b){let P=(U=a.structures)==null?void 0:U.find(D=>D.structureId===T.source.structureId);if((P==null?void 0:P.stage)!==We)continue;let R=Cc({structureId:T.source.structureId,drawDefinition:a});if(!g||R){let{positionAssignments:D}=Qt({structure:P}),E=(D==null?void 0:D.map(N=>{var C;let A=N.participantId,M=(C=dt({element:N,name:Dc}).extension)==null?void 0:C.value;return M?{participantId:A,groupOrder:M==null?void 0:M.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!m.includes(A)).map(({participantId:N})=>N))??[];if(E&&u.push(...E),r){let N=e.filter(({participantId:A})=>E.includes(A));c.push(...N)}}}return u.length&&d.push(Ge({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:Yse,type:tD,qualifyingParticipantIds:u,qualifyingParticipants:r?c:void 0})),{validAssignmentActions:d,sourceStructureIds:p}}function sue({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(u))return{};let f=R=>!t||R.participantId||R.qualifier||R.bye,g=r==null?void 0:r.filter(R=>R!==u&&!(c&&s.includes(R))),v=(a==null?void 0:a.filter(R=>f(R)&&(g==null?void 0:g.includes(R.drawPosition))))??[],I=v.map(({drawPosition:R})=>R),{matchUps:y}=_t({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=y.filter(({drawPositions:R})=>bn(R,I)),S=Object.assign({},...b.map(R=>{var D;return(D=R.sides)==null?void 0:D.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:N})=>({[E]:N}))}).flat()),w=v.map(R=>R.participantId).filter(Boolean),U=(i??[]).filter(R=>w.includes(R.participantId)),T=Object.assign({},...U.map(R=>({[R.participantId]:R}))),P=v.map(R=>{let D=T==null?void 0:T[R.participantId],E=S[R.drawPosition];return Ge({...R,participant:o?ke(D,!1,!0):void 0,sourceDrawPositionRange:E})});return P.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[u]},willDisableLinks:e,method:LW,type:iD,availableAssignments:P}}:{}}function xO(t){var j;let e=it(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:r=!0,provisionalPositioning:n,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,c=t.tournamentParticipants??(a&&Gi({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=Qe({structureId:t.structureId,drawDefinition:o});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:Ti};let p=d.structureId;if(u=nb({drawDefinition:o,structureId:p}),s===void 0&&!u.isAdHoc)return{error:yg};if(u.isAdHoc)return dD(t);if(u.error)return u;let{drawPositionInitialRounds:m,inactiveDrawPositions:h,activeDrawPositions:f,byeDrawPositions:g}=u,v=Nt({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:I,enabledStructures:y,actionsDisabled:b}=Uq({actionType:aS,appliedPolicies:v,drawDefinition:o,structure:d}),S=(I==null?void 0:I.activePositionOverrides)||[],{sourceStructureIds:w}=VC({finishingPosition:Ag,targetRoundNumber:1,linkType:gu,drawDefinition:o,structureId:p})||{},U;w!=null&&w.length&&(U=w.reduce((H,W)=>Cc({structureId:W,drawDefinition:o})&&H,!0));let T=w.length,P=w.length&&!U,{policyActions:R}=Sq({enabledStructures:y,drawDefinition:o,structure:d}),D=![We,Ae].includes(d.stage)||d.stageSequence!==1,{drawId:E}=o,N=[],{assignedPositions:A,positionAssignments:M}=Ur({structure:d}),C=A==null?void 0:A.find(H=>H.drawPosition===s);if(!((j=M==null?void 0:M.map(H=>H.drawPosition))!=null&&j.includes(s)))return{error:Ig};let{stage:O,stageSequence:k}=d,x=[O];O===Wr&&x.push(Ae),O===Ae&&x.push(Wr);let F=ah({entryStatuses:hp,provisionalPositioning:n,drawDefinition:o,stageSequence:k,structureId:p,stages:x}),$=fp({drawDefinition:o,stages:x}).assignedParticipantIds??[],_=F.filter(H=>!$.includes(H.participantId)).map(H=>H.participantId),L=g.includes(s),B=f.includes(s);if(b)return{hasPositionAssigned:!!C,info:"Actions Disabled for structure",isActiveDrawPosition:B,isDrawPosition:!0,validActions:[],isByePosition:L};if($n({policyActions:R,action:Em})&&!B&&M&&!P&&(!C||L)){let{validAssignmentActions:H}=nue({positionSourceStructureIds:w,unassignedParticipantIds:_,possiblyDisablingAction:D,isWinRatioFedStructure:T,tournamentParticipants:c,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,isByePosition:L,drawPosition:s,structureId:p,event:l});H==null||H.forEach(W=>N.push(W))}if($n({policyActions:R,action:tD})){let{validAssignmentActions:H}=oue({drawPositionInitialRounds:m,tournamentParticipants:c,positionAssignments:M,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:E});H==null||H.forEach(W=>N.push(W))}let{participantId:V}=C||{},G=V&&c.find(H=>H.participantId===V);if(C){$n({policyActions:R,action:BC})&&!B&&(N.push({type:BC,method:EB,payload:{drawId:E,structureId:p,drawPosition:s},willDisableLinks:D}),L||N.push({type:fO,method:Kse,payload:{drawId:E,structureId:p,drawPosition:s},willDisableLinks:D}),$n({policyActions:R,action:QS})&&!L&&N.push({type:QS,method:EB,payload:{drawId:E,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:D}));let H=d.stage===We||d.stage===Ae&&d.stageSequence===1;if(!L&&$B({activePositionOverrides:S,activeDrawPositions:f,action:eI})&&$n({policyActions:R,action:eI})&&KS({drawDefinition:o,structureId:p,drawPosition:s})&&H){let{seedAssignments:W}=ro({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y,seedValue:q}=(W==null?void 0:W.find(re=>re.participantId===V))??{};N.push({type:eI,method:rle,participant:G,seedNumber:Y,payload:{drawId:E,structureId:p,participantId:V,seedValue:q}})}if(!L&&$B({activePositionOverrides:S,activeDrawPositions:f,action:nS})&&$n({policyActions:R,action:nS})&&KS({drawDefinition:o,structureId:p,drawPosition:s})&&H){let{seedAssignments:W}=ro({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Y}=(W==null?void 0:W.find(q=>q.participantId===V))??{};N.push({method:tle,type:nS,participant:G,seedNumber:Y,payload:{participantId:V,structureId:p,drawId:E}})}if(!L&&V){if($n({policyActions:R,action:Ff})){let W={type:Ff,method:_W,participant:G,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:E}};N.push(W)}if($n({policyActions:R,action:ZS})){let W={type:ZS,method:ele,participant:G,payload:{participantId:V,otherName:void 0}};N.push(W)}}if($n({policyActions:R,action:iD})){let{validSwapAction:W}=sue({possiblyDisablingAction:D,tournamentParticipants:c,inactiveDrawPositions:h,activeDrawPositions:f,positionAssignments:M,returnParticipants:r,byeDrawPositions:g,drawDefinition:o,isByePosition:L,drawPosition:s,structureId:p,structure:d,drawId:E});W&&N.push(W)}}if($n({policyActions:R,action:hO})&&!P){let{validAlternatesAction:H}=eue({possiblyDisablingAction:D,tournamentParticipants:c,positionAssignments:M,activeDrawPositions:f,returnParticipants:r,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:E,event:l});H&&N.push(H)}if($n({policyActions:R,action:gO})&&!P&&M){let{validLuckyLosersAction:H}=rue({sourceStructuresComplete:U,possiblyDisablingAction:D,isWinRatioFedStructure:T,tournamentParticipants:c,activeDrawPositions:f,positionAssignments:M,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:E});H&&N.push(H)}if((G==null?void 0:G.participantType)===ot&&$n({policyActions:R,action:mO})){let{validModifyAssignedPairAction:H}=Yle({tournamentParticipants:c,returnParticipants:r,drawPosition:s,participant:G,drawId:E,event:l});H&&N.push(H)}return{hasPositionAssigned:!!C,isActiveDrawPosition:B,isDrawPosition:!0,isByePosition:L,validActions:N,...X}}function Tb({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let r=(a=t==null?void 0:t[$S])==null?void 0:a.drawTypeCoercion,n=(o=e==null?void 0:e[$S])==null?void 0:o.drawTypeCoercion;return(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??!0}function $I({tournamentRecord:t,drawDefinition:e,stage:i=Ae,structureId:r,structure:n}){var s;if(!t)return{error:fe};if(!n&&!e)return{error:xe};if(!n&&!r&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:Aa};let{error:a,positionAssignments:o}=Qt({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:o??[],structureId:n==null?void 0:n.structureId,error:a}}function FO({structureId:t,drawDefinition:e}){if(!e)return{error:xe};if(!Ki(t))return{error:le};let i=Lg({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Vi([xd,wo,MT,kd],r).length;return{...X,valid:n}}function Aq({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:le};let i=Dg(t);return i?{drawSize:i}:Q({result:{error:le},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Db(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=Bu({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return Q({result:h,stack:l});i=h.policyDefinitions}let u=rt(c);if(c&&!u)return Q({result:{error:le},context:{participantsCount:c},stack:l});if(n&&!u)return Q({result:{error:DG},stack:l});if(isNaN(r))if(c)({drawSize:r}=Aq({participantsCount:c}));else return Q({result:{error:Ry},stack:l});let d=n&&c||r;if(d&&d>r)return{error:DN};let p=i==null?void 0:i[es];if(!p)return{error:mG};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>c&&c>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:Zj}}function pD({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var v;if((!o||!n)&&i&&({participants:o,participantMap:n}=Gi({tournamentRecord:i})),!o)return{error:Cy};if(!Array.isArray(o))return{error:le};if(!s)return{error:ni};let l=(e==null?void 0:e[Pr])??(r==null?void 0:r[Pr])??Bg[Pr],c=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:u,gender:d}=s,p=u===Uc,m=u===to&&Kt||p&&ot||It,h=Object.assign({},...(t??s.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),f=Object.keys(h),g=o.filter(I=>f.includes(I.participantId)).filter(I=>{let y=lue({participant:I,participantType:m,eventType:u,entryStatusMap:h}),b=uue({genderEnforced:c,participantMap:n,eventGender:d,participant:I,isDoubles:p,mismatch:y});return y||!b});if(g.length){let I=g.map(y=>y.participantId);return{error:sG,invalidParticipantIds:I}}return{...X,valid:!0}}function lue({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[Uc,to].includes(i)&&t.participantType===It&&(vd(n)||n===yu);return t.participantType!==e&&!a}function uue(t){var d,p,m;let{participant:e,participantMap:i,eventGender:r,mismatch:n,isDoubles:a,genderEnforced:o}=t,s=!n&&a&&mt(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(h=>{var f,g,v;return(v=(g=(f=i==null?void 0:i[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!r||!(s!=null&&s.length)||Is===r||[ti,yi].includes(r)&&s[0]===r||Gn===r&&(s.length==1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),c=(m=e==null?void 0:e.person)==null?void 0:m.sex,u=!(e!=null&&e.person)||!r||[Is,Gn].includes(r)||[ti,yi].includes(r)&&c===r;return!o||l&&u}function Oq({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var f;let a="generateQualifyingSTructures",o=[],s=[],l=[],c=(g,v)=>g.stageSequence-v.stageSequence,u=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,m,h=1;for(let g of t.sort(u)){let v=g.structureProfiles||[];h=g.roundTarget||h;let I=1,y=0,b,S,w;for(let U of(v||[]).sort(c)){let T=LN(U.drawSize||U.participantsCount),{qualifyingRoundNumber:P,structureOptions:R,matchUpFormat:D,structureName:E,structureId:N,drawType:A}=U,M=U.matchUpType,C=U.qualifyingPositions||cue({drawSize:T,qualifyingRoundNumber:P}),O,k,x;if(!rt(T))return Q({result:{error:Ry},stack:a});let F=t.length>1?`${h}-`:"",$=v.length>1||F?I:"",_=E||(F||$?`${Hr(We)} ${F}${$}`:Hr(We));if(A===Ao){let{structures:L,groupCount:B,maxRoundNumber:V}=ub({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:We,structureOptions:R,appliedPolicies:e,stageSequence:I,matchUpType:M,roundTarget:h,drawSize:T,idPrefix:i,isMock:r,uuids:n});y=B,O=V,k=L[0],m=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=qs({qualifyingRoundNumber:P,qualifyingPositions:C,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=Wa({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:We,matchUpFormat:D,stageSequence:I,matchUpType:M,roundLimit:O,matchUps:x}),h&&Ct({extension:{name:ol,value:h},element:k}),y=((f=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:f.length)||0;if(I>1){let{link:L}=hb({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===gu?[1]:void 0,linkType:w});l.push(L),d+=(T||0)-y}else d+=T||0;w=A===Ao?gu:vu,S=k.structureId,b=O,s.push(k),I+=1}p+=y,o.push({qualifiersCount:y,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:m,roundTarget:h,linkType:w}),h+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...X,links:l}}function cue({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function kq(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Je(t.drawSize),n=e&&(typeof e=="boolean"||e<=2)&&r===2&&Fs||t.drawType||Fs,a=ZH.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Fs;else if(r<4&&i)return{...Q({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:aT},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function due(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:Hr(Ae),...t,stage:Ae},{structures:a,groupCount:o,groupSize:s}=ub(n);if(o<1)return{error:GG};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:Hr(xi)}],[c]=a,{structures:u,links:d}=KW({sourceStructureId:c.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return u&&a.push(...u),{...X,structures:a,links:d}}function pue({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),n=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=r.map((c,u)=>{let d=r.indexOf(c)%2?wo:xd,p=1+u;return{linkType:kl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:vu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:wo,roundNumber:n,structureId:t.structureId}},l=[{linkType:vu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:wo,roundNumber:1,structureId:i.structureId}},{linkType:kl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:wo,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function mue({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=Mc({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=Ic({structureName:t||Hr(Ae),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Ae,matchUpType:e,matchUps:s});o.push(l);let c=r/2,{matchUps:u}=Mc({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=Ic({structureName:Hr(XH),matchUps:u,structureId:a==null?void 0:a.pop(),stage:Wr,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=qs({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=Ic({structureName:Hr(JH),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:xi,matchUpType:e});o.push(m);let h=pue({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...X}}function hue(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!rt(o)||o<2)return{matchUps:[],roundsCount:0};if(hs(o))return qs(t);let c=fue(o),u=c.shift(),d=Re(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=e0({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,I=Re(1,v+1);r&&v===r&&(h=m-1);let y=I.map(b=>{let S=vO({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...y),m++}let f=m-1;return p=ib({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function fue(t){let e=Je(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function xq(t){var m,h;let{playoffAttributes:e,stageSequence:i=1,stage:r=Ae,matchUpType:n,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),c=t.appliedPolicies??Nt(t),u=((m=t.policyDefinitions)==null?void 0:m[Pf])||(c==null?void 0:c[Pf]);t.skipRounds=t.skipRounds||a<=4&&(u!=null&&u.feedFromMainFinal?0:1)||0;let d=t.structureName??((h=e==null?void 0:e["0"])==null?void 0:h.name)??Hr(Ae),p=()=>{let{matchUps:f}=qs(t);return{structures:[Wa({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...X}};return{generators:{[io]:()=>({structures:[Wa({finishingPosition:Ag,stageSequence:i,structureName:d,matchUps:[],matchUpType:n,structureId:l,stage:r})],links:[],...X}),[cp]:()=>{let{matchUps:f}=hue(t);return{structures:[Wa({stageSequence:i,structureName:d,matchUpType:n,structureId:l,matchUps:f,stage:r})],links:[],...X}},[Fs]:()=>p(),[_y]:()=>mue(t),[Ef]:()=>mf({...t,roundOffsetLimit:3,playoffAttributes:e??hA}),[Cf]:()=>mf({...t,roundOffsetLimit:2,playoffAttributes:e??fA}),[xi]:()=>mf(t),[Ng]:()=>{let{matchUps:f}=Mc({drawSize:a,uuids:o,matchUpType:n});return{structures:[Wa({stageSequence:i,structureName:d,matchUpType:n,structureId:l,stage:Ae,matchUps:f})],links:[],...X}},[$y]:()=>WW(t),[Mf]:()=>jp({...t,feedRounds:1,fmlc:!0}),[KH]:()=>jp({...t,feedRounds:1}),[dA]:()=>jp({...t,feedsFromFinal:1}),[pA]:()=>jp({...t,feedsFromFinal:2}),[mA]:()=>jp({...t,feedsFromFinal:3}),[By]:()=>jp(t),[NT]:()=>YW(t),[Ao]:()=>ub(t),[Fl]:()=>due(t)}}}function LO(t){var _,L,B,V,G;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:r,staggeredEntry:n,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},c=Je(t.drawSize),u=t.drawTypeCoercion??Tb({appliedPolicies:r,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=kq({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:u,drawSize:c});if(p.error)return p;let m=p.drawType,h=[],f=[],g=(t==null?void 0:t.matchUpType)??vi,v=(_=a==null?void 0:a.structures)==null?void 0:_.filter(({stage:j})=>j===We);v&&h.push(...v);let I=v==null?void 0:v.map(({structureId:j})=>j),y=(L=a==null?void 0:a.structures)==null?void 0:L.find(({stage:j,stageSequence:H})=>j===Ae&&H===1),b=(B=a==null?void 0:a.links)==null?void 0:B.filter(j=>j.target.structureId===(y==null?void 0:y.structureId)&&(I==null?void 0:I.includes(j.source.structureId))),S=(j,H)=>{var W;if(j.linkType===gu&&(H!=null&&H.structures)){let Y=j.source.finishingPositions||[];return H.structures.length*Y.length}else if(j.linkType===vu&&((W=H==null?void 0:H.matchUps)!=null&&W.length)){let Y=j.source.roundNumber;return H.matchUps.filter(({roundNumber:q})=>q===Y).length}},w=v==null?void 0:v.map(j=>{var K,z,te;let H=b==null?void 0:b.find(J=>J.target.structureId===j.structureId),W=((z=(K=Qt({structure:j}))==null?void 0:K.positionAssignments)==null?void 0:z.length)??0;if(!H)return W;let Y=H==null?void 0:H.source.structureId,q=(te=a.structures)==null?void 0:te.find(J=>J.structureId===Y),re=S(H,q)||0;return W-re}).filter(Boolean).reduce((j,H)=>j+H,0),U=b==null?void 0:b.map(j=>{let H=j.source.structureId,W=v==null?void 0:v.find(Y=>Y.structureId===H);return S(j,W)}).filter(Boolean).reduce((j,H)=>j+H,0),T=!!(y&&!((V=y==null?void 0:y.matchUps)!=null&&V.length));if(v!=null&&v.length&&!T)return{error:bC};let P=!(v!=null&&v.length)&&t.qualifyingProfiles,R=(P==null?void 0:P.length)&&Oq({idPrefix:t.idPrefix,qualifyingProfiles:P,appliedPolicies:r,isMock:s,uuids:l});if(R!=null&&R.error)return R;let{qualifyingDrawPositionsCount:D,qualifyingDetails:E,qualifiersCount:N}=R||{qualifyingDrawPositionsCount:w,qualifiersCount:U};D&&(R!=null&&R.structures&&h.push(...R.structures),R!=null&&R.links&&f.push(...R.links)),Object.assign(t,Ge({drawSize:c,matchUpType:g,tieFormat:o}));let A=m!==io&&(!c||c<2||!n&&![Ng,cp].includes(m)&&([Fl,Ao].includes(m)&&c<3||![Ao,Fl].includes(m)&&!hs(c)));if(A&&!D)return Q({context:{drawSize:c,invalidDrawSize:A},result:{error:aT},stack:d});let{generators:M,error:C}=xq(t);if(C)return{error:C};let O=M[m];if(!O)return{error:cN};let k=O==null?void 0:O();if(k.error)return k;let{structures:x,links:F}=k;if(x!=null&&x.length){let j=x.find(({stage:H,stageSequence:W})=>H===Ae&&W===1);if(y&&j){if(T){let H=j.structureId;if(j.structureId=y.structureId,F==null?void 0:F.length)for(let W of F)W.source.structureId===H&&(W.source.structureId=y.structureId),W.target.structureId===H&&(W.target.structureId=y.structureId)}else if(!i)return{error:bC}}h.push(...x)}h.sort(ih),F!=null&&F.length&&f.push(...F);let $=k.structures.find(({stage:j,stageSequence:H})=>j===Ae&&H===1);for(let j of E||[]){let{finalQualifyingRoundNumber:H,finalQualifyingStructureId:W,roundTarget:Y,finishingPositions:q,linkType:re}=j,K=$&&((G=hb({targetStructureId:$.structureId,sourceStructureId:W,sourceRoundNumber:H,finishingPositions:q,targetEntryRound:Y,linkType:re}))==null?void 0:G.link);if(K!=null&&K.error)return K;K&&f.push(K)}return b&&f.push(...b),{...X,qualifyingResult:{qualifyingDrawPositionsCount:D,qualifiersCount:N},structures:h,links:f}}function _O(t){var y,b;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:r}=t||{},n="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return Q({result:{error:xe},stack:n});let a=e?t.drawDefinition:ke(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let S=qn({tieFormat:o});if(S.error)return S}o=Br(o??((y=un({drawDefinition:a}))==null?void 0:y.tieFormat)),s=s??(a.matchUpType||vi),t.tieFormat=o,t.matchUpType=s;let l=YS({drawDefinition:a,stage:Ae});t.drawSize=t.drawSize??l,!l&&t.drawSize&&XS({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:Ae});let c=Jr({drawDefinition:a}).drawMatchUps.map(br),u=LO(t);if(u.error)return Q({result:u,stack:n});let{structures:d,links:p,qualifyingResult:m}=u;a.structures=d,a.links=p;let h=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!YS({stage:We,drawDefinition:a})){let S=XS({drawSize:m.qualifyingDrawPositionsCount,stage:We,drawDefinition:a});if(S.error)return S}if(h){let S=xW({qualifiersCount:h,drawDefinition:a,stage:Ae});if(S.error)return S}let f=t.drawSize??l;Object.assign(t,Ge({drawSize:f,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=ur({drawDefinition:a});o&&(g==null||g.forEach(S=>{if(!c.includes(S.matchUpId)){let{tieMatchUps:w}=gb({tieFormat:o,matchUp:S,isMock:r});Object.assign(S,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:I}=Vd({drawDefinition:a,matchUpsMap:v});return ai({tournamentId:(b=t.tournamentRecord)==null?void 0:b.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:I,drawDefinition:a,matchUpsMap:v,...X,structures:d,matchUps:g,links:p}}function Pb(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!Lq({scaleItem:n}))return{error:My};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){let s=_q({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=Vo();l.includes(qr)&&lt({topic:qr,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...X,info:ON,existingValue:n==null?void 0:n.scaleValue}||o&&{...X,newValue:n==null?void 0:n.scaleValue}||{error:Li}}function Fq(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:r,auditData:n,context:a}=t;if(!r)return{error:fe};if(!r.participants)return{error:Cy};let o=0,s={},l=[];for(let p of e){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(Lq({scaleItem:h}))Array.isArray(s[m])||(s[m]=[]),s[m].push(h);else return{error:My}}r.participants.forEach(p=>{let{participantId:m}=p||{};Array.isArray(s[m])&&s[m].forEach(h=>{_q({participant:p,scaleItem:h,removePriorValues:i}),l.push(p),o++})});let c=o?void 0:Tg,{topics:u}=Vo();if(u.includes(qr)&&o&&lt({topic:qr,payload:{tournamentId:r.tournamentId,participants:l}}),a){let{eventId:p,drawId:m,...h}=a,f=((d=h.scaleAttributes)==null?void 0:d.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:vA,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:I}=An({tournamentRecord:r,eventId:p,drawId:m});m&&pO({drawDefinition:v,timeItem:g}),p&&hh({event:I,timeItem:g})}else mh({tournamentRecord:r,timeItem:g})}}return n&&u.includes(Nf)&&lt({topic:Nf,payload:n}),Ge({...X,modificationsApplied:o,info:c})}function Lq({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function _q({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Km};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(c=>r.includes(c)&&i[c]).length!==n.length)return{error:My};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=bl({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Nd,c,u,d].join("."),m=Ge({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...X,valueChanged:l,newValue:i.scaleValue}}function $O(t){let{tournamentRecord:e,modifiedScaleValues:i,removePriorValues:r}=t,n=it(t,[{[Fn]:!0},{modifiedScaleValues:!0,[so]:Sa}]);if(n.error)return n;for(let a in i){let o=Pb({scaleItem:i[a],removePriorValues:r,tournamentRecord:e,participantId:a});if(o.error)return o}return{...X}}function Lf(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:lr};let{participant:a,tournamentId:o}=Kc({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...bl({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Li}}var gue=(t=0)=>250/Math.pow(t+5,.4),vue=()=>1;function Iue(t=3,e=2){let i=t/e;return isNaN(i)?ef.kDefault():i}var ef={nSpread:400,diffThreshold:.125,kCalc:gue,kMultiplier:Iue,kDefault:vue};function $q(t){let{winnerRating:e,loserRating:i}=t,{ratings:r=Dr,winnerCountables:n=1,loserCountables:a=0,ratingType:o=bo,maxCountables:s,countables:l}=t||{},c=r==null?void 0:r[o];if(!c)return{error:ze};let u=c.range||t.ratingRange;e=e||c.defaultInitialization,i=i||c.defaultInitialization;let d=u[0]>u[1],p=c.decimalsCount||0,m=d?u.slice().reverse():u,h=(C,O)=>parseFloat(O)>=Math.min(...C)&&parseFloat(O)<=Math.max(...C);(!h(u,e)||!h(u,i))&&(h(u,e)||(e=c.defaultInitialization),h(u,i)||(i=c.defaultInitialization));let f=nf({targetRange:Dr[bo].range,sourceRange:m,value:d?u[0]-e:e}),g=nf({targetRange:Dr[bo].range,sourceRange:m,value:d?u[0]-i:i}),v=(C,O)=>1/(1+Math.pow(10,(O-C)/ef.nSpread)),I=v(f,g),y=v(g,f),b=ef.kCalc(n),S=ef.kCalc(a),w=ef.kMultiplier(s,l),U=f+w*b*(1-I),T=g+w*S*(0-y),P=nf({sourceRange:Dr[bo].range,value:U,targetRange:m}),R=nf({sourceRange:Dr[bo].range,value:T,targetRange:m}),D=d?u[0]-P:P,E=parseFloat(D.toFixed(p)),N=d?u[0]-R:R,A=parseFloat(N.toFixed(p)),M=Math.max(...u)?Math.abs(e-i)/Math.max(...u):0;return(P>R&&M>ef.diffThreshold||E<0||A<0)&&(E=e,A=i),{newWinnerRating:E,newLoserRating:A}}var yue=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function Bq(t){var I,y;let e=it(t,[{[Fn]:!0},{matchUpIds:!0,[so]:Mn,[vl]:Wm},{ratingType:!1,[ea]:b=>Dr[b]}]);if(e.error)return e;let{updateParticipantRatings:i,removePriorValues:r=!0,tournamentRecord:n,ratingType:a=bo,refreshDynamic:o,considerGames:s,drawDefinition:l,matchUpIds:c,asDynamic:u}=t,d=Dr[a],{accessor:p}=d,m={},h=(t.matchUps||o&&vn({drawDefinition:l,tournamentRecord:n,inContext:!0,matchUpFilters:{matchUpStatuses:fr}}).matchUps||kr({matchUpFilters:{matchUpIds:c,matchUpStatuses:fr},tournamentRecord:n,inContext:!0}).matchUps)??[],f=`${a}.${JN}`,g=u?f:a;h.sort(lh);for(let b of h){let{endDate:S,matchUpFormat:w,score:U,sides:T,winningSide:P}=b,R=b.matchUpType,D={eventType:R,scaleName:a,scaleType:vc},E={scaleName:f,eventType:R,scaleType:vc},N=Object.assign({},...(T??[]).map(_=>{let{sideNumber:L,participant:B}=_;return L&&{[L]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),A=Object.assign({},...Object.values(N).flat().map(_=>{let L=m[_],B=!o||L?Lf({scaleAttributes:E,tournamentRecord:n,participantId:_}).scaleItem:void 0,V=Lf({tournamentRecord:n,scaleAttributes:D,participantId:_}).scaleItem,G=p?{[p]:void 0}:void 0;return _&&{[_]:B??V??{scaleName:g,eventType:R,scaleDate:S,scaleType:vc,scaleValue:G}}})),M=w?Ln(w):{},C=(M==null?void 0:M.bestOf)||1,O=(M==null?void 0:M.setsTo)||1,k=s?C&O:C,x=(U==null?void 0:U.sets)&&yue(U.sets)||P===1&&[1,0]||[0,1],F=P?N[P]:[],$=P?N[3-P]:[];for(let _ of F){let L=(I=A[_])==null?void 0:I.scaleValue,B=typeof L=="object"?L[p]:L;for(let V of $){let G=(y=A[V])==null?void 0:y.scaleValue,j=typeof G=="object"?G[p]:G,H=P?x[P]:[0,0],W=P?x[3-P]:[0,0],{newWinnerRating:Y,newLoserRating:q}=$q({winnerCountables:H,loserCountables:W,maxCountables:k,winnerRating:B,loserRating:j,ratingType:a}),re=p?{...L,[p]:Y}:Y,K=p?{...G,[p]:q}:q;A[_].scaleValue=re,A[V].scaleValue=K,A[_].scaleName=g,A[V].scaleName=g}}Object.assign(m,A),i&&$O({tournamentRecord:n,modifiedScaleValues:m,removePriorValues:r})}let v=h.map(({matchUpId:b})=>b);return{...X,modifiedScaleValues:m,outputScaleName:g,processedMatchUpIds:v}}function mD(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:r,newRound:n,isMock:a,event:o}=t;if(typeof i!="object")return{error:xe};let{participantIdPairings:s,matchUpsCount:l}=t,c=cD(t);if(c.error)return Q({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)n?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return Q({result:{error:le,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!rt(l)||e&&!Array.isArray(e)||!s&&!l)return{error:le,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:le,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(u||0))return{error:le,info:"roundNumber error"};let m=r??(n&&(u??0)+1||u||1);s=s??Re(0,l).map(()=>({participantIds:[void 0,void 0]}));let h=v=>{if(!t.idPrefix)return;let I=i.drawId,y=t.idPrefix??"ah";return`${I}-${y}-${m}-${v}`},f=s==null?void 0:s.map((v,I)=>{let y=(v==null?void 0:v.participantIds)??[void 0,void 0];y.push(void 0,void 0);let b=y.slice(0,2).map((w,U)=>Ge({sideNumber:U+1,participantId:w})),S=e[I]??h(I)??Vt();return{roundNumber:m,matchUpStatus:ji,matchUpId:S,sides:b}});if(f!=null&&f.length){let v=(g=un({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&f.forEach(I=>{let{tieMatchUps:y}=gb({tieFormat:v,matchUp:I,isMock:a});Object.assign(I,{tieMatchUps:y,matchUpType:ci})})}return{roundNumber:m,matchUpsCount:(f==null?void 0:f.length)??0,matchUps:f,...X}}function bue({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(I=>({[I.pairing]:I.value}))),o=Object.keys(i),s=[],l=VB({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),c=[gE(l)];s.push(l);let u=l.value,d=l,p=0,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(I=>{i[I].slice(0,h).forEach(y=>{m+=1;let b=rm(I,y.opponent);if(!g.includes(b)){let S=VB({stipulated:[[I,y.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!c.includes(gE(S))){c.push(gE(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<u||U===u&&Math.round(Math.random()))&&(u=U),g.push(b),p+=1}}}),s=s.filter(y=>Math.abs(y.value-u)<5)}),s.sort((I,y)=>I.maxDiff-y.maxDiff);let v=ia(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function gE(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function VB({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=rm(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),Ar(t,a).map(d=>fn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=rm(m,h),g=r[f];return g>d?g:d},0),u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=rm(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function rm(t,e){return[t,e].sort(KT).join("|")}function Vq({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=rm(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function wue({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(vt);if(r.length===2){let[n,a]=r,o=rm(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function Uue({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=rm(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var Sue=0;function Tue({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var o;let a=((o=Dr[r])==null?void 0:o.defaultInitialization)??Sue;return n.split("|").map(s=>{var l;if(i===eo){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||a):a*2}else return e[s]||a})}function Due(t){let{tournamentParticipants:e,adHocRatings:i={},possiblePairings:r,uniquePairings:n,maxIterations:a,minimizeDelta:o,deltaObjects:s,valueObjects:l,eventType:c,scaleName:u,salted:d}=t;n.forEach(y=>{let b=Tue({tournamentParticipants:e,adHocRatings:i,scaleName:u,eventType:c,pairing:y}),S=typeof d=="number"&&d||.5,w=d&&(Math.round(Math.random())?S:S*-1)||0,U=Math.abs(b[0]-b[1])+w,T=Math.abs(b[0]-b[1]);s[y]=T,l[y]||(l[y]=0),l[y]+=U?Math.pow(U,2):0});let p=n.map(y=>({pairing:y,value:l[y]})).sort((y,b)=>y.value-b.value),{pairingValues:m}=Uue({possiblePairings:r,valueObjects:l}),{candidate:h,candidatesCount:f,deltaCandidate:g,iterations:v}=bue({valueSortedPairings:p,maxIterations:a,pairingValues:m,deltaObjects:s,valueObjects:l}),{participantIdPairings:I}=o?g:h;return{participantIdPairings:I,candidatesCount:f,deltaCandidate:g,iterations:v,candidate:h}}var Pue=100,Rue=100,Eue=4e3;function BO(t){var G,j;let{encounterValue:e=Pue,sameTeamValue:i=Rue,maxIterations:r=Eue,updateParticipantRatings:n,generateMatchUps:a=!0,ignoreLastRoundNumber:o,iterationMatchUps:s,tournamentRecord:l,dynamicRatings:c,refreshDynamic:u,participantIds:d,drawDefinition:p,roundNumber:m,structureId:h,matchUpIds:f,eventType:g,scaleName:v,idPrefix:I,isMock:y,salted:b,event:S}=t;if(!p)return{error:xe};if(!t.structure&&!h)return{error:Ti};let w=t.structure||Qe({drawDefinition:p,structureId:h}).structure;if(!Ut(w))return{error:Gc};if(!(d!=null&&d.length))return{error:Hc};let U=[...s??[],...(w==null?void 0:w.matchUps)??[]],{encounters:T}=wue({matchUps:U}),P=(l==null?void 0:l.participants)??[],R={};if(c){let H=mt(w!=null&&w.matchUps?w.matchUps.map(({roundNumber:Y})=>Y):[]),W=Math.max(...H,0);if(W){let Y=(G=w==null?void 0:w.matchUps)==null?void 0:G.filter(({roundNumber:re})=>re===W).map(({matchUpId:re})=>re),q=Bq({ratingType:v??((j=S==null?void 0:S.category)==null?void 0:j.ratingType),updateParticipantRatings:n,tournamentRecord:l,asDynamic:!0,refreshDynamic:u,drawDefinition:p,matchUpIds:Y});if(q.error)return q;q.modifiedScaleValues&&(R=q.modifiedScaleValues)}}let{valueObjects:D}=Cue({tournamentParticipants:P,encounterValue:e,sameTeamValue:i,encounters:T}),{uniquePairings:E,possiblePairings:N,deltaObjects:A}=Vq({participantIds:d}),M=Object.values(R).length?R:t.adHocRatings,C={tournamentParticipants:P,possiblePairings:N,participantIds:d,uniquePairings:E,drawDefinition:p,maxIterations:r,adHocRatings:M,deltaObjects:A,valueObjects:D,eventType:g,scaleName:v,structure:w,salted:b},{candidatesCount:O,participantIdPairings:k,deltaCandidate:x,iterations:F,candidate:$}=Due(C);if(!O)return{error:pT};let _,L;if(a){let H=mD({structureId:w==null?void 0:w.structureId,ignoreLastRoundNumber:o,participantIdPairings:k,newRound:!0,drawDefinition:p,roundNumber:m,matchUpIds:f,idPrefix:I,isMock:y,event:S});if(H.error)return H;_=H.roundNumber,L=H.matchUps}let{maxDelta:B,maxDiff:V}=$;return{roundNumber:_,participantIdPairings:k,modifiedScaleValues:R,candidatesCount:O,deltaCandidate:x,...X,iterations:F,matchUps:L,maxDelta:B,maxDiff:V}}function Cue({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Kt);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=Vq({participantIds:s});for(let c of l)n[c]||(n[c]=0),n[c]+=r}return{valueObjects:n}}function jq(t){var D,E,N,A;let{drawType:e=Fs,attachConsolation:i=!0,applyPositioning:r=!0,tournamentRecord:n,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:c}=t,u=t==null?void 0:t.drawDefinition;if(!u)return{error:xe};let d=Rr,p=ah({stageSequence:1,drawDefinition:u,stage:d}),m=[Ao,_y,Fl].includes(e)?p.length:Dg(p.length);if(!a&&e===Ng&&p.length<2||e===Ao&&p.length<3)return{error:aT};let{tieFormat:h,matchUpType:f}=t;if(h){let M=qn({tieFormat:h});if(M.error)return M}h=Br(h??((D=un({drawDefinition:u}))==null?void 0:D.tieFormat)),f=f??u.matchUpType??vi;let{structures:g}=Oo({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:lG};if((N=(E=g==null?void 0:g[0])==null?void 0:E.matchUps)!=null&&N.length)return{error:xN};let v=(A=g==null?void 0:g[0])==null?void 0:A.structureId;Object.assign(t,Ge({structureName:t.structureName??Hr(Rr),structureId:v,matchUpType:f,tieFormat:h,drawSize:m,stage:d}));let I=xq(t);if(I.error)return I;let y=I.generators[e];if(!y)return{error:cN};let b=y==null?void 0:y();if(b.error)return b;let{structures:S,links:w}=b,U=S.map(M=>_t({structure:M}).matchUps).flat();h&&U.forEach(M=>{let{tieMatchUps:C}=gb({matchUp:M,tieFormat:h,isMock:l});Object.assign(M,{tieMatchUps:C,matchUpType:f})}),(!r||!i)&&(u=ke(u,!1,!0)),u.links||(u.links=[]),w.length&&u.links.push(...w);let T=S.map(({structureId:M})=>M);u.structures||(u.structures=[]);let P=u.structures.map(({structureId:M})=>M);u.structures=u.structures.map(M=>T.includes(M.structureId)?S.find(({structureId:C})=>C===M.structureId):M);let R=S.filter(({structureId:M})=>!P.includes(M));return R.length&&u.structures.push(...R),o&&pb({seedingProfile:t.seedingProfile,applyPositioning:r,tournamentRecord:n,drawDefinition:u,structureId:v,placeByes:s,drawSize:m,event:c}),i&&ai({drawDefinition:u}),{links:w,structures:S,...X}}var VO={};gt(VO,{addGame:()=>Jq,addPoint:()=>Kq,addSet:()=>Zq,addShot:()=>Xq,analyzeScore:()=>qO,analyzeSet:()=>VI,calculateHistoryScore:()=>Wq,checkScoreHasValue:()=>gr,checkSetIsComplete:()=>gD,clearHistory:()=>Yq,generate:()=>Gq,generateScoreString:()=>Ul,generateTieMatchUpScore:()=>wb,getSetComplement:()=>KO,getTiebreakComplement:()=>bD,helpers:()=>i3,isValidMatchUpFormat:()=>da,keyValueScore:()=>E3,mutate:()=>zq,parseMatchUpFormat:()=>Ln,parseScoreString:()=>n0,query:()=>O3,redo:()=>Qq,reverseScore:()=>Hq,setServingSide:()=>qq,stringifyMatchUpFormat:()=>oD,tidyScore:()=>A3,umo:()=>t3,undo:()=>e3,validateScore:()=>YO,validateTieFormat:()=>qn});var Gq={};gt(Gq,{generateScoreString:()=>Ul,generateTieMatchUpScore:()=>wb,reverseScore:()=>Hq});function Ul(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:ze,info:"missing sets"};let c=a&&Ln(a),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},m=r||!(!e||!s||s===1),h=i?Mue({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(Nue).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let I=u&&v.setNumber===u&&d?d:p,y=O=>Mi(O==null?void 0:O.side1Score)||Mi(O==null?void 0:O.side2Score),b=O=>Mi(O==null?void 0:O.side1TiebreakScore)||Mi(O==null?void 0:O.side2TiebreakScore),S=(I==null?void 0:I.tiebreakSet)||!y(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:P}=v,R=T||(Mi(T)||o?0:""),D=P||(Mi(P)||o?0:"");if(S)return`[${(m?[D,R]:[R,D]).join("-")}]`;let E=Math.min(R,D),N=E?`(${E})`:"",A=w||(Mi(w)||o?0:""),M=U||(Mi(U)||o?0:""),C=m?`${[M,A].join("-")}${N}`:`${[A,M].join("-")}${N}`;return["-"," "].includes(C)&&(C=""),C}}function Mue({matchUpStatus:t}){let e={[nn]:"RET",[Lt]:"WO",[mr]:"DF/DF",[tr]:"WO/WO",[Yc]:"SUS",[Ea]:"ABN",[Rt]:"DEF",[Mg]:"DR"};return t&&e[t]||""}function Nue(t,e){return t.setNumber-e.setNumber}function Hq(t){if(!(t!=null&&t.score))return{error:ze};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=a;return Ge({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:u,side2Score:c,setNumber:d})}),r=Ul({sets:i}),n=Ul({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...X}}var zq={};gt(zq,{addGame:()=>Jq,addPoint:()=>Kq,addSet:()=>Zq,addShot:()=>Xq,calculateHistoryScore:()=>Wq,clearHistory:()=>Yq,redo:()=>Qq,setServingSide:()=>qq,umo:()=>t3,undo:()=>e3});function gp({matchUp:t}){let{extension:e}=dt({name:RT,element:t});if(!e)return{error:Nr};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...X}}function Wq(t){var R,D;if(!t)return{error:ze};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Hn};let r=((R=gp({matchUp:e}))==null?void 0:R.history)||[];if(!Array.isArray(r))return{error:le,info:"history is not an array"};let{matchUpFormat:n}=e;if(!n)return{error:IN};if(!da({matchUpFormat:n}))return{error:vN};let a=Ln(n),{bestOf:o,finalSetFormat:s,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,m=[0,0],h=1,f=0,g,v=0,I=E=>[1,2].includes(E),y=()=>(f+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:f,games:[]}),b=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=S(),U=b(),T=y(),P=0;for(let E of r){P+=1,g=u.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:A,setTo:M,NoAD:C,tiebbreakFormat:O}=N,k=T.side1Score===A&&T.side1Score===T.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{p=void 0,m=[0,0],h=3-h,T.side1TiebreakScore=0,T.side2TiebreakScore=0,T.side1PointScore="",T.side2PointScore="",v=0},B=j=>{T.winningSide=j;let{s:H,...W}=T;u.sets.push(W),w=S(),U=b(),T=y(),L()},V=j=>{U.winningSide=j;let{g:H,...W}=U;T.games.push(W),w=S(),U=b(),L();let Y=`side${j}Score`;T[Y]+=1},G=j=>{w.winningSide=j;let{p:H,...W}=w;U.points.push(W),w=S(),v=0;let Y=()=>m.reduce((re,K)=>re+K)%4/4>.5?h:3-h,q=j-1;if(k||x){m[q]+=1,p=Y(),T[`side${j}TiebreakScore`]=m[q],T[`side${3-j}TiebreakScore`]=m[1-q];let re=_?1:2;if(m[q]>=$&&m[q]>=m[1-q]+re)return V(j),{gameCompleted:!0}}else if(m[1-q]===4&&m[q]===3?m[1-q]-=1:m[q]+=1,T.side1PointScore=c[m[0]],T.side2PointScore=c[m[1]],m[q]===5||m[q]===4&&m[1-q]<3||C&&m[q]===4)return V(j),{gameCompleted:!0}};if(I(E.srv)&&(h=E.srv),["p","s","g","o"].includes(E.u)&&d.push(E.u),E.shotOutcome&&(w.shots.push(E),E.shotType==="SERVE"&&["OUT","NET"].includes(E.shotOutcome)&&(v+=1),v===2)){let j=3-h;G(j)}if(I(E.p)||rt(E.pointNumber)){let j=E.winningSide||E.p;if((D=G(j))!=null&&D.gameCompleted)continue}if(I(E.g)||rt(E.gameNumber)){let j=E.winningSide||E.g;U.winningSide=j;let H=`side${j}Score`,W=`side${3-j}Score`;if(d.length&&(d.includes("p"),d=[]),V(j),T[H]===M&&T[H]-T[W]>=(C?1:2)&&(B(j),g))break}if(I(E.s)||rt(E.setNumber)){let j=E.winningSide||E.s;if(B(j),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return P!==r.length&&console.log({error:"Match completed with excess history"}),(T.side1Score||T.side2Score||T.games.length||T.side1TiebreakScore||T.side2TiebreakScore)&&u.sets.push(T),u.scoreStringSide1=Ul({...u,matchUpFormat:n}),u.scoreStringSide2=Ul({...u,matchUpFormat:n,reversed:!0}),h=p||h,i&&(e.score=u),{...X,servingSide:h,score:u}}function vp({undoHistory:t,history:e,matchUp:i}){return Ct({element:i,extension:{value:{history:e,undoHistory:t},name:RT}})}function qq({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:UN};let{history:i=[]}=gp({matchUp:t});return i.push({srv:e}),vp({matchUp:t,history:i})}function Yq({matchUp:t}){return vp({matchUp:t})}function Kq({matchUp:t,point:e}){if(!e||!t)return{error:ze};if(typeof e!="object")return{error:le,context:{point:e}};let{history:i=[]}=gp({matchUp:t});return i.push(e),vp({matchUp:t,history:i})}function Jq({matchUp:t,game:e}){if(typeof e!="object")return{error:le,context:{game:e}};let{history:i=[]}=gp({matchUp:t});return i.push(e),vp({matchUp:t,history:i})}function Xq({matchUp:t,shot:e}){if(typeof e!="object")return{error:ze};let{history:i=[]}=gp({matchUp:t});return i.push(e),vp({matchUp:t,history:i})}function Zq({matchUp:t,set:e}){if(typeof e!="object")return{error:ze};let{history:i=[]}=gp({matchUp:t});return i.push(e),vp({matchUp:t,history:i})}function Qq({matchUp:t}){let{history:e=[],undoHistory:i=[]}=gp({matchUp:t});return i.length&&e.push(i.pop()),vp({matchUp:t,history:e,undoHistory:i})}function e3({matchUp:t}){let{history:e=[],undoHistory:i=[]}=gp({matchUp:t});return i.push(e.pop()),vp({matchUp:t,history:e,undoHistory:i})}var t3={},i3={};gt(i3,{keyValueScore:()=>E3,parseMatchUpFormat:()=>Ln,stringifyMatchUpFormat:()=>oD,tidyScore:()=>A3});var nm=" ",JC="DEF",Aue="COMPLETED",r3="WO",Oue="WO/WO",n3="ABN",a3="SUS",o3="RET",s3="INT",l3=[o3,JC,r3,Oue,n3,a3,s3],XC="DEFAULTED",u3="WALKOVER",c3="ABANDONED",d3="SUSPENDED",p3="RETIRED",m3="INTERRUPTED",kue=[p3,XC,u3],xue="Enter Score",Mm="()",Hd="[]",jO=["up","left","shift+tab"],GO=["enter","down","tab","right"],t0="backspace",h3="r",f3="s",g3="a",v3="d",I3="w",y3="i",hD=[h3,v3,I3,g3,f3,y3],fD="space",vE=["[","("],i0=[...jO,...GO,fD,"]"],b3="-",Fue="/",am=b3,Sl=b3,w3=[Fue],Lue=0,_ue=["=","+","num_1","num_2","shift+=","shift+-"],HO=["0","1","2","3","4","5","6","7","8","9"].concat(hD),U3=HO.map(t=>`shift+${t}`),S3=[am,t0].concat(i0,w3),T3=[HO,U3,S3].join(","),$ue=[T3,jO,GO,_ue].join(","),Bue={OUTCOMEKEYS:hD,SIDE1KEYS:HO,SIDE2KEYS:U3,MODIFIERS:S3,PROMPT:xue,MOVEUP:jO,MOVEDOWN:GO,HOTKEYS:$ue};function Wh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=D3({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==nm?nm:"";return t+r+i}else return i+nm+t}function D3({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of l3){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+nm:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function ZC({analysis:t,scoreString:e,sets:i,lowSide:r}){var f,g,v;let n,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=D3({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(I=>I!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:m}=hf({brackets:Hd,scoreString:e}),h=jue(e);if(h>=0){n=e.slice(0,h);let{isTiebreakEntry:I}=hf({brackets:Mm,scoreString:n}),{lastOpenBracketIndex:y,isTiebreakEntry:b}=hf({brackets:Hd,scoreString:n}),S=n&&n[n.length-1].trim(),w=n&&!isNaN(S),U=t.isIncompleteSetScore;if(m&&b){let T=n.slice(y+1).split(Sl),P=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,R=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,D=[P,R];if(R){let E=r===1?1:0;D[E]=((D==null?void 0:D[1-E])||0)+(p?1:2),(D[E]||0)<d&&(D[E]=d),n=e.slice(0,y+1),n+=D.join(Sl)}else P!==void 0?(n=e.slice(0,y+1),n+=P):(n=e.slice(0,y),U=!0);l.side1TiebreakScore=D[0]||0,l.side2TiebreakScore=D[1]||0}if(n.length||(n=void 0),U){let T=(f=l.side1Score)==null?void 0:f.toString();if(T){let P=T==null?void 0:T.slice(0,T.length-1);l.side1Score=!isNaN(P)&&parseInt(P)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(g=l.side2Score)==null?void 0:g.toString(),P=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let R=T==null?void 0:T.slice(0,T.length-1);l.side2Score=!isNaN(R)&&parseInt(R)||void 0}else{let R=P==null?void 0:P.slice(0,P.length-1);l.side1Score=!isNaN(R)&&parseInt(R)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else I?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(m&&!b?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),m||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:n,sets:a}}return{scoreString:e,sets:i}}function hf({brackets:t=Mm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...xs(i,n)),o=Math.max(...xs(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function Vue({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=Hd.split(""),a=t.split(""),o=Math.max(...xs(r,a)),s=Math.max(...xs(n,a)),l=Math.max(...xs(Sl,a));return i&&o>s&&l>o}function jue(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function P3(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function jB({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var l;let n=Ln(t),{bestOf:a}=n,o=Math.ceil(a/2),s=((l=r==null?void 0:r.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return kue.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function gD({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,set:a}){var I;if(!a)return{error:ze,info:"missing set"};e=e||i&&Ln(i);let o=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:s,side2Score:l}=a,{setTo:c,tiebreakAt:u}=o,d=vD({set:a}),p=Math.abs(s-l),m=s>=c||l>=c,h=r||s>=c&&l>=c||u&&u<c&&(s===u||l===u),f=t||h&&(d===1&&a.side1TiebreakScore>a.side2TiebreakScore||d===2&&a.side2TiebreakScore>a.side1TiebreakScore),g=!h&&o.NoAD||h||r&&((I=o.tiebreakFormat)!=null&&I.NoAD)?1:2,v=p>=g;return!!((m&&(v||h)||r)&&(!h||f))}function vD({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function zO({analysis:t,set:e}){let i=vD({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return gD({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function Gue({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=Je(r);let{validSide2Score:o,requiresTiebreak:s}=Hue({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=zO({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let c=Mm.split("")[0];e+=c}else t.isDecidingSet||(e+=nm)}return{sets:i,scoreString:e,updated:n}}function Hue({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,c;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?c=s===a&&i===n||s===n&&i===a:c=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function R3({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===h3?r?(o=!0,r=Wh({scoreString:r,lowSide:t,outcome:o3}),n=t===2?1:2,a=p3):(o=!0,r=Wh({scoreString:r,lowSide:t,outcome:JC}),n=t===2?1:2,a=XC):e===v3?(o=!0,r=Wh({scoreString:r,lowSide:t,outcome:JC}),n=t===2?1:2,a=XC):e===I3?(o=!0,i=[],r=r3,n=t===2?1:2,a=u3):e===f3&&r?(o=!0,r=Wh({scoreString:r,lowSide:t,outcome:a3}),a=d3,n=void 0):e===g3?(o=!0,r=Wh({scoreString:r,lowSide:t,outcome:n3}),a=c3,n=void 0):e===y3&&r&&(o=!0,r=Wh({scoreString:r,lowSide:t,outcome:s3}),a=m3,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function zue(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==t0&&(e=[{setNumber:1}]);let d=e.length-1;if(hD.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:c}=R3({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===t0){if({scoreString:r,sets:e,outcomeRemoved:u}=ZC({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),u){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,c=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===fD){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",c=!0)}else if(l===am&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=Je((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Je(m),p=e[d].side1Score.toString(),c=!0}else{let m=Je((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Je(m),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:c}}function Wue({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=Hd.split("");if(t.isMatchTiebreakEntry||(r+=u),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=hf({brackets:Hd,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(Sl);if((((d=m[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>Je(v)),f=i===1?1:0;h[f]=h[1-f]+(c?1:2),h[f]<l&&(h[f]=l);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(Sl),o=!0}else{let h=[m[0]||0,m[1]||0].map(g=>Je(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,o=!0}}else{let p=P3({lowValue:Je(a||0),tiebreakTo:l,NoAD:c}),m=[Je(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(Sl),o=!0}return{info:s,scoreString:r,sets:n,updated:o}}function que({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),c=[r,l];e===2&&c.reverse();let u=Mm.split("")[0],d=c.join(am)+(s?u:nm);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},m=zO({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function Yue({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var x,F,$;let a=(((x=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:x.length)||0)+(i?0:1),o=Ln(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},c=l==null?void 0:l.timed,u=s&&n[(o==null?void 0:o.bestOf)-1],d=u==null?void 0:u.winningSide,{isTiebreakEntry:p}=hf({brackets:Mm,scoreString:e}),{isTiebreakEntry:m}=hf({brackets:Hd,scoreString:e}),h=p||m,f=!!l.tiebreakSet,g=(F=e==null?void 0:e[e.length-1])==null?void 0:F.trim(),v=e&&!isNaN(g),I=!h&&g===am,y=p&&vE.includes(g),b=m&&vE.includes(g),S=m&&g===Sl,w=e==null?void 0:e.split(""),[U]=Hd.split(""),T=w&&Math.max(...xs(U,w)),P=w&&Math.max(...xs(Sl,w)),R=w&&P>T,D=($=n[n.length-1])==null?void 0:$.winningSide,E=(n==null?void 0:n.length)&&!D,N=l3.find(_=>(e==null?void 0:e.indexOf(_))>=0),A=!isNaN(r),M=r===fD,C=i0.includes(r),O=e==null?void 0:e.split("").find(_=>vE.includes(_)),k=C&&m&&!b&&(S||!Vue({scoreString:e}));return{isTiebreakSetValue:f&&A,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:R,isGameScoreEntry:E,isSpace:M,isCloser:C,isTiebreakCloser:C&&O&&h&&v,isDecidingSet:s,isTiebreakSet:f,isTimedSet:c,isNumericEnding:v,isNumericValue:A,hasOpener:O,hasOutcome:N,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:D,isInvalidSetTiebreakValue:M&&h&&y,isInvalidMatchTiebreakValue:k,isTiebreakEntry:h,isSetTiebreakEntry:p,isMatchTiebreakEntry:m,isIncompleteSetScore:I,isIncompleteSetTiebreak:y,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:S}}function E3(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!T3.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=jB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=Yue({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(w3.includes(i)&&(i=am),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Je(i)===0&&(h.isTiebreakCloser=!0),i0.includes(i)&&h.hasOpener&&(i=""),i0.includes(i)&&(i=fD),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:u,matchUpStatus:o,winningSide:a}=zue({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(hD.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:u}=R3({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===t0)u=!0,{scoreString:r,sets:n}=ZC({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===am&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(u=!0,{scoreString:r,sets:n}=ZC({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===Sl&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(u=!0,r+=Sl);else if([am,Sl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:u}=Gue({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Mm:Hd,g=f.split("").reverse()[0],v=f.split("")[0],I=n[n.length-1],{tiebreakFormat:y}=h.setFormat,{tiebreakTo:b,NoAD:S}=y||{},w=vD({set:I});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),P=P3({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(I.side1TiebreakScore=P,I.side2TiebreakScore=T):(I.side1TiebreakScore=T,I.side2TiebreakScore=P)}r=(r||"")+g,h.isDecidingSet||(r+=nm);let U=zO({analysis:h,set:I});I.winningSide=U||void 0,u=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:u}=Wue({analysis:h,auto:c,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Mm.split(""),g=Math.max(...xs(f,r.split(""))),v=r.slice(g+1),I=v&&Je(v)===Lue,y=Je(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!I&&v.length<2?w&&y>S-1?d="invalid low value for NoAD tiebreak":(u=!0,r=(r||"")+i):d=I?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){u=!0;let{scoreString:f,set:g}=que({analysis:h,lowSide:e,scoreString:r,value:Je(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(u){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=jB({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[ji,vs].includes(o))?(o=Aue,n=n.filter(g=>{let{side1Score:v,side2Score:I,side1TiebreakScore:y,side2TiebreakScore:b}=g;return v||I||y||b})):r&&!a&&![d3,c3,m3].includes(o)&&(o=void 0),{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var ID="\\d+-\\d+",BI="\\d+-\\d+\\(\\d+\\)",WO="\\[\\d+-\\d+\\]",Kue="\\d+-\\d+\\(\\d+-\\d+\\)",Jue=new RegExp(`(${ID}),`,"g"),Xue=new RegExp(`(${BI}),`,"g"),Zue=[ID,BI,WO,Kue],Que=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],ece=Que.map(t=>{let e=t.split("").map(i=>Zue[i]).join(" ");return new RegExp(`^${e}$`)});function GB(t){return!t||ece.some(e=>e.test(t))}function tce(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let c=r.includes(l)&&l,u=n.includes(c);if(u&&c)return a[c]+=1,o=c,l;if(!u&&c&&o&&c!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(c))a[o]||(o="");else return a[c]||(o=""),p}return l}).join("");return t!==s?s:t}function oS(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function ice(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function _f(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function r0(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function HB(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function rce(t){return t.startsWith("(")&&t.endsWith(")")}function nce({score:t,applied:e}){t=tce(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(P=>t=t.replace(P,P.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=la(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let I=/(\d+-\d+\(\d+)0,/;if(I.test(t)){let[w]=t.match(I).slice(1);t=t.replace(I,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(rce)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let y=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!y&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function yD(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=xs("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function ace({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[Jue,Xue].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(yD).join(" "),{score:t,applied:e}}function oce({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(oS),a=0,o="";for(let p of n){let m=xs(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),I=Math.abs(v.reduce((y,b)=>+y-+b));if(I===1){let y=[h.join(" "),[f,p].join("")].join(" ");o+=y,a=m+1}else if(I===0){let y=Math.max(...v);if([4,5,6,7,8,9].includes(y)){let b=[6,4].includes(y)?y+1:y-1,S=[y,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>ice(p)&&"bracket"||_f(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,c=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((I,y)=>+I-+y)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=xs("tiebreak",c);if(u.length){let p="";r.forEach((m,h)=>{u.includes(h)?p+=`(${m}) `:u.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!_f(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return c=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(WO).test(p)&&"super"||new RegExp(BI).test(p)&&"tiebreak"||new RegExp(ID).test(p)&&"standard"||"unknown";return c.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function sce({score:t,applied:e}){for(let T of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(P.test(t)){let R=t.match(P).slice(1).map(E=>parseInt(E)),D=Math.abs(R[0]-R[1]);D<=10&&D>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,P,R,D,E,N]=t.match(i).slice(1);t=t.replace(i,`${T}${P}-${R} ${D}-${E}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=yD(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,P,R]=t.match(s).slice(1),[D,E]=P.split("");t=`${T}-${D} ${E}-${R}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[T,P]=t.match(c).slice(1),R=T.trim(),D=P.trim();if(l.test(R)&&l.test(D)){let E=R.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${E} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[T,P]=t.match(u).slice(1),R=T.trim(),D=P.trim();if(l.test(R)&&l.test(D)){let E=R.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${E} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,P,R]=t.match(m).slice(1),D=P.split(""),E=`${T}-${D[0]} ${D[1]}-${R}`;t=t.replace(m,E),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(P=>{let R=P.match(T).slice(2)[0];t=t.replace(P,`7-6(${R}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let P=" "+T.slice(1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],P=T.split("/").map(R=>`(${R})`).join(" ")+" ";t=t.replace(T,P),e.push("slashCommaSetPattern")}let I=/\(6-\)/g;I.test(t)&&(t=t.replace(I,"(6-0)"),e.push("missingZeroPattern2"));let y=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(y.test(t)){let T=t.match(y),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),R=t;T.forEach(D=>{let[E,N]=D.match(P).slice(1),A=`${E}-${N}`;R=R.replace(D,A)}),t=R,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,P,R]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${P}${R}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[P,R,D,E]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=R.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}${R}(${D})${E}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[R,D,E]=T.match(P).slice(1),[N,A]=R.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${R}(${D})${E}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let P=/(^|\s)(\d \d)\(/,[R,D]=T.match(P).slice(1);t=t.replace(T,`${R}${D.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function lce({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(_f(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let c=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(Mi(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=r0(c.split(""),u)}}t=t.replace(l,`(${c})`)}i=t==null?void 0:t.split(" ");let n=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==a;if(n.test(l)&&u){let[d,p,m]=Array.from(l.match(n)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[c,u]=Array.from(l.match(n)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(n.test(l)){let[c,u]=Array.from(l.match(n)).slice(1);return _f(c)?`${c}(${u})`:c}return l}).join(" "),i=t==null?void 0:t.split(" "),n=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(n.test(l)){let[c]=l.match(n).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function uce({score:t,attributes:e,identifier:i}){var u,d,p;if(typeof t!="string")return{score:t,identifier:i};let r=new RegExp(/\([\d,/ ]+\)/g),n=t.match(r);for(let m of n||[]){let h=(d=(u=m.match(/^\((.*)\)$/))==null?void 0:u.slice(1))==null?void 0:d[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let I=f.slice(f.length-2).split("").map(y=>parseInt(y));if(Math.abs(I[0]-I[1])===1)continue}let g=HB(h),v=yD(g);t=t.replace(m,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(m=>{let h=HB(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(m=>t.endsWith(m))&&s.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(y=>(y.startsWith(",")&&(y=y.slice(1)),y.trim())),f=h.every(y=>y.includes(",")||oS(y)),g=h.every(y=>y.includes("/")||oS(y)),v=h.every(y=>y.includes("-")||oS(y)),I=f&&","||v&&"-"||g&&"/";if(I){let y;h.forEach(b=>{if(b.startsWith("("))if(y==="set"&&(m+=" "),b.includes(I))m+=b.slice(1).split(I).map(S=>S.trim()).join("-"),y="set";else{let S=b.slice(1);m+=`(${S}) `,y="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(I).map(U=>parseInt(U.trim())),w=Math.min(...S);y==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,y="tiebreak"}}),t=m.trim()}}let l=la(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&_f(t)&&Mi(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function C3({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=Mi(s)&&parseInt(s),c=r[0]!==void 0&&r[1]!==void 0;if(Mi(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(c&&e.length===1&&Mi(e[0])){let u=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=u,i.push(a()),r=[void 0,void 0]}c&&o()}}return{sets:i}}function QC(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=r0(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=r0(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function M3(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>Mi(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(C3({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c} ${u}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c}(${u}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c} ${u}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c} ${u}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=QC(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Ar(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,I]=g.split("").map(S=>parseInt(S)),y=Math.abs(v-I),b=v>I?1:2;return y>1&&b||b*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=la(c),p=c.map(g=>Math.abs(g)),m=la(p),h=c[0]<0,f=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,I,y,b,S]=s,w=c.reduce((U,T,P)=>T<0?P:U,void 0);if(w===0){let U=Math.min(I,y);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${I}-${y}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${I}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,I,y,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${I}) ${y}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${I}-${y}(${b}) [${S}${w}-${U}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function N3(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let c=l.match(n).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function cce({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((u,d)=>{if(new RegExp(BI).test(u)){let m=u.slice(3),h=u.slice(0,3),f=h.split("-");if(!_f(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),I=[g,g-1];return v&&I.reverse(),I.join("-")+m}}else if(u.length===2&&Mi(u))return u.split("").join("-");u=yD(u);let p=new RegExp(`^${WO}$`).test(u)&&"super"||new RegExp(`^${BI}$`).test(u)&&"tiebreak"||new RegExp(`^${ID}$`).test(u)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=u.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),I=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let y=g.toString().split(""),b=y.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??y[0];b&&(u=I?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=u.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=N3(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function dce({score:t}){let{setsTied:e,winningSide:i}=N3(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Mi(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(c=>parseInt(c));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(c=>+c>=10)){let c=o.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(o=c)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function pce({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function mce({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function hce({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=r0(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=M3({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function fce({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&QC(t)?{score:QC(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function gce({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function vce({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let n=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(n)?n:[n].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function Ice({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function yce({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function bce({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function wce({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function Uce({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Mi(i))&&e.length===4&&(t=e)}return{score:t}}function Sce({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var Tce={handleTiebreakSlashSeparation:wce,handleSetSlashSeparation:yce,punctuationAdjustments:nce,handleGameSeparation:bce,joinFloatingTiebreak:oce,handleBracketSpacing:ace,handleSpaceSeparator:Uce,separateScoreBlocks:hce,matchKnownPatterns:sce,removeDanglingBits:Ice,removeErroneous:fce,handleWalkover:gce,properTiebreak:lce,handleNumeric:M3,handleRetired:vce,containedSets:uce,sensibleSets:cce,stringScore:pce,superSquare:dce,setBuilder:C3,excisions:Sce,replaceOh:mce},IE={},Dce=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],Pce=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function A3(t){if(!t.score)return{error:le};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],c,u=[],d,p,m=e,h=g=>{g.forEach(v=>{p=Tce[v]({profile:s,identifier:r,matchUpStatus:c,attributes:d,applied:u,score:m});let I=p.score!==m;I&&l.push({method:v,score:p.score}),a&&(o||I||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),m=p.score})};h(Dce);let f=GB(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(Pce),f=GB(m),f||(m="")),u.forEach(g=>{IE[g]||(IE[g]=0),IE[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var O3={};gt(O3,{analyzeScore:()=>qO,analyzeSet:()=>VI,checkScoreHasValue:()=>gr,checkSetIsComplete:()=>gD,getSetComplement:()=>KO,getTiebreakComplement:()=>bD,isValidMatchUpFormat:()=>da,parseScoreString:()=>n0,validateScore:()=>YO,validateTieFormat:()=>qn});function qO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){var S,w;let a=(n==null?void 0:n.sets)??[],o=((a==null?void 0:a.filter(U=>U==null?void 0:U.winningSide))||[]).reduce((U,T)=>{let{winningSide:P}=T;if(!P)return U;let R=P-1;return U[R]++,U},[0,0]),s=r?r-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&o[s],u=l!==void 0&&o[l],d=e?Ln(e):void 0,p=Math.max(...o),m=la(o)[p],h=((S=d==null?void 0:d.setFormat)==null?void 0:S.timed)||((w=d==null?void 0:d.finalSetFormat)==null?void 0:w.timed),f=d==null?void 0:d.bestOf,g=f&&Math.ceil(f/2)||1,v=i??t,I=v&&[Rt,nn,Lt].includes(v),y=!d||!a.length||a.every((U,T)=>{let P=T+1,R=P===f,D=P===a.length,{side1Score:E,side2Score:N,side1TiebreakScore:A,side2TiebreakScore:M,winningSide:C}=U,O=Math.max(E??0,N??0),k=A??M,{finalSetFormat:x,setFormat:F}=d,$=R&&x||F;if(k){let{tiebreakTo:_,NoAD:L}=($==null?void 0:$.tiebreakFormat)||{},B=Math.max(A??0,M??0);if(L&&B>_||B<_&&C&&(D&&!I||!D))return!1}return $.setTo?!(!$.noTiebreak&&O>$.setTo+1):!0}),b=(!e||p===g)&&m===1&&o.indexOf(p)+1||void 0;return{valid:!!(y&&(r&&c>u&&r===b||r&&I||!r&&!b&&(![_i,Rt,nn,Lt].includes(v)||h&&v===_i)))}}function YO({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:le};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:le,info:l};if(s!==void 0&&typeof s!="string")return{error:le,info:l};if(a!==void 0&&!Array.isArray(a))return{error:le,info:Uu("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==mt(c).length)return{error:le,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:I,setNumber:y}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>![void 0,null].includes(S))).every(b=>b.every(S=>rt(S))))return{error:le,info:"non-numeric values"};if(![y,I].filter(b=>![void 0,null].includes(b)).every(b=>rt(b)))return{error:le,info:"non-numeric values"};if(I&&![1,2].includes(I))return{error:le,info:"winningSide must be 1 or 2"}}let{valid:u}=qO({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!u)return{error:yG,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var KO=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=Je(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},bD=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=Rce({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function Rce(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function n0({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=(r==null?void 0:r.startsWith("["))&&r.split("[")[1].split("]")[0].split("-").map(f=>parseInt(f)),o=r.includes("(")&&r.split("(")[0]||r.includes("[")&&r.split("[")[0]||r,s=!a&&o.split("-").map(f=>parseInt(f)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=r.includes("(")?r.split("(")[1].split(")")[0]:void 0,u=(c&&bD({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[m,h]=a||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:m,side2TiebreakScore:h,winningSide:l,setNumber:n}}}function Ece({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:r}){if(!r)return;let n=vD({set:r});return gD({matchUpScoringFormat:t,set:r,isDecidingSet:e,isTiebreakSet:i})&&n||void 0}function VI(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:sT};let{setNumber:r}=e||{},{bestOf:n}=i||{},a=!!(r&&n&&r===n),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),c=!s&&!l,u=!!(r&&n&&r<=n),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],m=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],h=d.filter(C=>C!==void 0).length,f=p.filter(C=>C!==void 0).length,g=m.filter(C=>C!==void 0).length,v=d==null?void 0:d.filter(C=>!isNaN(C)).length,I=m==null?void 0:m.filter(C=>!isNaN(C)).length,{tiebreakAt:y}=o||{},b=y&&d.filter(C=>C>=y).length===2,S=b&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(I&&!v),U=!!(e!=null&&e.winningSide),{error:T,result:P}=Cce({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:m}),{error:R,result:D}=Mce({setObject:e,setFormat:o,sideTiebreakScores:m}),E=c&&!w&&P||s&&w&&D,N=u&&!(s&&!w)&&!(c&&w)&&(!U||E),A=Ece({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),M={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:b,isCompletedSet:U,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:E,leadingSide:S,setFormat:o,sideGameScores:d,sideGameScoresCount:h,sidePointScores:p,sidePointScoresCount:f,sideTiebreakScores:m,sideTiebreakScoresCount:g,winningSide:A};return(e==null?void 0:e.winningSide)!==void 0&&(w?(M.isValidTiebreakSetOutcome=D,D||(M.tiebreakSetError=R)):(M.isValidStandardSetOutcome=P,P||(M.standardSetError=T))),M}function Cce({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:sT};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:le};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:gC};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(o&&(i!=null&&i.find(U=>U>=o))))return{result:!1,error:gC};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:lT};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,I=r==null?void 0:r[d],y=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&(r!=null&&r.find(N=>N>=T))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=s<o?o:o+1;if(m>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!I||!y||I<y)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let R=U?1:2,D=I-y,E=y>=T-1;if(D&&E&&D<R)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=c?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Mce({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:sT};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:lT};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var k3={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},x3={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},F3={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},L3={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},_3={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},$3={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},B3={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},V3={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},j3={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},G3={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},H3={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},z3={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},W3={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},q3={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Y3={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},K3={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},J3={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},a0="COLLEGE_DEFAULT",e1="COLLEGE_JUCO",t1="COLLEGE_D3",X3="DOMINANT_DUO",Z3="DOMINANT_DUO_MIXED",Q3="LAVER_CUP",e6="TEAM_DOUBLES_3_AGGREGATION",t6="TIME_TENNIS_DUAL",i6="TIME_TENNIS_PRO_CIRCUIT",r6="USTA_BREWER_CUP",n6="USTA_OZAKI_CUP",a6="USTA_COLLEGE",o6="USTA_GOLD_TEAM_CHALLENGE",s6="USTA_LEVEL_1",l6="USTA_INTERSECTIONAL",u6="USTA_SECTION_BATTLE",c6="USTA_SOUTHERN_LEVEL_5",d6="USTA_TOC",p6="USTA_WTT_ITT",m6="USTA_ZONAL",Nce={COLLEGE_D3:t1,COLLEGE_DEFAULT:a0,COLLEGE_JUCO:e1,DOMINANT_DUO:X3,DOMINANT_DUO_MIXED:Z3,LAVER_CUP:Q3,TEAM_DOUBLES_3_AGGREGATION:e6,TIME_TENNIS_DUAL:t6,TIME_TENNIS_PRO_CIRCUIT:i6,USTA_BREWER_CUP:r6,USTA_OZAKI_CUP:n6,USTA_COLLEGE:a6,USTA_GOLD_TEAM_CHALLENGE:o6,USTA_INTERSECTIONAL:l6,USTA_LEVEL_1:s6,USTA_SECTION_BATTLE:u6,USTA_SOUTHERN_LEVEL_5:c6,USTA_TOC:d6,USTA_WTT_ITT:p6,USTA_ZONAL:m6},h6="STANDARD",zB={[h6]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[t1]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7@7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:du,matchUpCount:6,matchUpValue:1},tieFormatName:t1,valueGoal:5},[a0]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:6/TB7",collectionValue:1,matchUpCount:3},singles:{matchUpFormat:du,matchUpCount:6,matchUpValue:1},tieFormatName:a0,valueGoal:4},[e1]:{hydrate:!0,doubles:{matchUpFormat:"SET1-S:8/TB7",matchUpCount:3,matchUpValue:1},singles:{matchUpFormat:du,matchUpCount:6,matchUpValue:1},tieFormatName:e1,valueGoal:5},[Q3]:K3,[X3]:H3,[Z3]:B3,[e6]:x3,[t6]:V3,[i6]:$3,[r6]:j3,[n6]:G3,[a6]:z3,[o6]:k3,[l6]:_3,[s6]:W3,[u6]:L3,[c6]:F3,[p6]:q3,[d6]:J3,[m6]:Y3},Ace=t=>{let e=t!=null&&t.namedFormat&&Object.keys(zB).includes(t.namedFormat)?t.namedFormat:h6,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=ke(zB[e],!1,!0),s=l=>{var u,d;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Vt();let c=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${c}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Dle,collectionName:"Doubles",matchUpType:ri,...o.doubles},{collectionId:s(1),matchUpFormat:du,collectionName:"Singles",matchUpType:vi,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},zd=Ace;function Oce(t){var d,p,m;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:r,tieFormatName:n,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===or&&o===or){let h=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:f})=>f===Ae))==null?void 0:p.tieFormat;c=c||h||n&&((m=l==null?void 0:l.tieFormat)==null?void 0:m.tieFormatName)===n&&l.tieFormat||n&&zd({namedFormat:n,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||zd({event:l,isMock:s,hydrateCollections:i}),u=void 0}else u||(c=void 0,l!=null&&l.matchUpFormat||(u=du));if(c){let h=qn({gender:l==null?void 0:l.gender,enforceGender:r,tieFormat:c});if(h.error)return h}return{tieFormat:c,matchUpFormat:u}}function kce(t){var y,b,S,w,U;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,appliedPolicies:r,drawEntries:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,c=t.qualifyingProfiles,u=c!=null&&c.length?Oq({uuids:t.uuids,qualifyingProfiles:c,appliedPolicies:r,idPrefix:o,isMock:s}):void 0;if(u!=null&&u.error)return u;e.structures=(y=e.structures)==null?void 0:y.filter(({structureId:T})=>T!==i),e.links=(b=e.links)==null?void 0:b.filter(({source:T})=>T.structureId!==i);let{qualifiersCount:d,qualifyingDrawPositionsCount:p,qualifyingDetails:m}=u??{};p&&(u!=null&&u.structures&&((S=e.structures)==null||S.push(...u.structures)),u!=null&&u.links&&((w=e.links)==null||w.push(...u.links)));let h=(U=e.structures)==null?void 0:U.find(({stage:T,stageSequence:P})=>T===Ae&&P===1),{qualifiersCount:f}=$g({stageSequence:1,drawDefinition:e,structureId:a,stage:Ae}),g=Math.max(d??0,f??0),v=xW({qualifiersCount:g,drawDefinition:e,stage:Ae});if(v.error||(v=XS({drawSize:p,stage:We,drawDefinition:e}),v.error))return v;xce({drawDefinition:e,drawEntries:n,event:l});let I=Fce({mainStructure:h,qualifyingDetails:m,drawDefinition:e});return I.error?I:{drawDefinition:e,structureId:a}}function xce({drawDefinition:t,drawEntries:e,event:i}){for(let r of(e??[]).filter(({entryStage:n})=>n===We)){let n={...r,entryStage:r.entryStage??Ae,drawDefinition:t,event:i};Qz(n)}}function Fce({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:c}=n,u=t&&((r=hb({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:r.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function f6(t){var r,n;let{participantIds:e}=t,i=((n=(r=t.drawDefinition)==null?void 0:r.entries)==null?void 0:n.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||zo.includes(o)}).map(vt))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return Q({result:{error:ps},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:le,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:le,info:"roundsCount must be less than 32"}:{participantIds:e}}function JO(t){var d;let e=[],{roundsCount:i=1,drawDefinition:r,matchUpsCount:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,c,u=f6(t);if(u.error)return u;for(let p of Re(1,i+1)){let m=mD({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:r,matchUpsCount:n,structureId:a,roundNumber:c,idPrefix:o,isMock:s,event:l});if(m.error)return Q({result:m,info:{iteration:p}});(d=m.matchUps)!=null&&d.length&&e.push(...m.matchUps),c=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:e}}function Lce(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:r,eventType:n,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=Dr[r])==null?void 0:l.accessor),s=e.participants??[];for(let c of i??[]){let u=s==null?void 0:s.find(p=>p.participantId===c),d=WB({scaleName:`${r}.${JN}`,participant:u,eventType:n});!d&&r&&(d=WB({scaleAccessor:o,participant:u,scaleName:r,eventType:n})),d&&!a[c]&&(a[c]=d)}return a}function WB({scaleType:t=vc,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var o,s;let a=(s=(o=i&&bl({scaleAttributes:{eventType:n??wm,scaleType:t,scaleName:r},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Ut(a)?a[e]:a}function XO(t){var u,d;let e=$ce(t);if(e!=null&&e.error)return e;let i=f6(t);if(i.error)return i;let r=_ce(t);if(r.error)return r;let n=Lce(t),a=((u=t.tournamentRecord)==null?void 0:u.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],c;for(let p of Re(1,(t.roundsCount??1)+1)){let m=BO({...t,participantIds:i.participantIds,structure:r.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:n,roundNumber:c,eventType:o,isMock:a});if(m.error)return m;let{matchUps:h,...f}=m;f.modifiedScaleValues&&(n=f.modifiedScaleValues),l.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),c=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&s.push(...h)}return{...X,matchUps:s,roundResults:l}}function _ce(t){var n,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(n=e==null?void 0:e.structures)==null?void 0:n.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let c=l.stage&&Pm[l.stage];return Wn({structure:l})&&c>(Pm[s==null?void 0:s.stage]||1)?l:s},void 0),r=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return r?Wn({structure:r})?{structure:r}:{error:Xp}:{error:Ti}}function $ce(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:le,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==io?{error:Xp}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:le,info:"Missing Entries"}:{error:void 0}}function Bce(t){var u,d;let{tournamentRecord:e,drawDefinition:i,structureId:r,idPrefix:n,isMock:a,event:o}=t,s=(u=o==null?void 0:o.entries)==null?void 0:u.filter(({entryStage:p,entryStatus:m})=>(!p||p===Ae)&&m&&zo.includes(m)),l=s==null?void 0:s.map(vt),c=s?Math.floor(s.length/2):0;if(t.automated)return Vce({...t,participantIds:l});{let p=JO({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:n,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&uD({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:r,event:o})}return{...X}}function Vce(t){var l,c;let{restrictEntryStatus:e,generateMatchUps:i,structureId:r,matchUpIds:n,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=XO({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:r,matchUpIds:n});return s.error?s:((c=s==null?void 0:s.matchUps)!=null&&c.length&&uD({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:r}),{...X})}function jce({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:c}){var I,y;r=r??n;let u=Qe({drawDefinition:o,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:Ti};let{positionAssignments:p}=Ur({structure:d}),m=(p==null?void 0:p.length)||0;if(c>m)return{error:Xj};let h=(I=d.structures)==null?void 0:I.length,f=rt(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(y=iO({roundRobinGroupsCount:h,drawSize:m}))==null?void 0:y.seedGroups,{seedsCount:v}=Db({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:m});return v&&(a!=null&&a[es])&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=Re(1,c+1).map(b=>{let S=g==null?void 0:g.find(T=>T.includes(b)),w=S&&Math.min(...S),U=f&&b>=f?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),ai({drawDefinition:o,structureIds:[l]}),{...X,seedLimit:c}}function fh({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:fe};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!n||!u.entryStageSequence||u.entryStageSequence===n)&&zo.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=Lf({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function g6(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=Oo({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return Q({result:{error:Ti},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=Jce({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&zce({...t,seedsCount:s,structure:a,structureId:o});let u=t.automated!==!1&&t.drawType!==io&&!(t.qualifyingOnly&&t.stage!==We),d=((r==null?void 0:r.length)||0)>1,p=u?Hce({...t,multipleStructures:d,seedLimit:c,structureId:o}):{};return p!=null&&p.error?Q({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function Gce({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var o,s;let a=(s=(o=dt({name:ol,element:n}))==null?void 0:o.extension)==null?void 0:s.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!a||a===r)&&hp.includes(n.entryStatus)})}function Hce(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=pb({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function zce(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(vt);e?Wce({...t,enteredParticipantIds:a}):(n||i)&&qce({...t,enteredParticipantIds:a})}function Wce(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?dh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:c}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;Vg({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:u})})}function qce(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=Yce({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&Kce({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,I)=>{let y=I+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[y])||S||y;Vg({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:c,participantId:b,structureId:u,seedNumber:y,seedValue:w,event:d})})}function Yce(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},c=o==null?void 0:o.eventType,u={scaleName:i||s||l||o.eventId,scaleType:Il,eventType:c};return fh({scaleAttributes:u,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function Kce(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return fh({scaleAttributes:{scaleName:o||s,scaleType:Sc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function Jce(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=Gce(t);e>i.length&&(e=i.length);let{seedLimit:r}=jce({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function Xce(t){var b;let e=_O({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{suppressDuplicateEntries:r=!0,ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:m}=t,h=[],f=[],g=Zce({suppressDuplicateEntries:r,ignoreStageSpace:n,drawDefinition:i,drawEntries:c,drawType:p,entries:m});if(g.error)return g;let v=p===cp?0:Je(t.seedsCount??0),I=g6({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:i,seedingProfile:s,participants:l,stage:Ae,seedsCount:v,placeByes:u,drawSize:d,entries:m});if(I.error&&!I.conflicts)return I;(b=I.positioningReport)!=null&&b.length&&h.push({[Ae]:I.positioningReport});let y=I.structureId;return I.conflicts&&(f=I.conflicts),p===io&&t.roundsCount&&Bce({...t,drawDefinition:i,structureId:y}),{drawDefinition:i,positioningReports:h,conflicts:f,structureId:y}}function Zce(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Ae)continue;let s={...o,ignoreStageSpace:e??n===io,entryStage:o.entryStage??Ae,event:t.event,drawDefinition:i,drawType:n},l=Qz(s);if(r&&l.error)return l}return{error:void 0}}var Qce=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),ede=Qce;function tde(t){let{drawId:e=Vt(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=ede();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function ZO(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=it(t,[{[ya]:!0,[zN]:!0}]);if(l.error)return l;if(!da({matchUpFormat:n}))return{error:Ey};let c="setMatchUpFormat";if(o){let u=hi({drawDefinition:r,matchUpId:o,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===or)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:zn};d&&(d.matchUpFormat=n,St({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===or)return{error:Ml};for(let u of e){let d=Qe({drawDefinition:r,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===or)return{error:Ml};let u=Qe({drawDefinition:r,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),ai({drawDefinition:r,structureIds:e}),{...X}}function ide({tieFormat:t}){let e=qn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Vt());return{tieFormat:t}}function rde({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=ide({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=ZO({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var v6={};gt(v6,{attachPolicies:()=>jd,findPolicy:()=>pp,getAppliedPolicies:()=>Nt,getPolicyDefinitions:()=>Bu,mutate:()=>I6,query:()=>b6,removePolicy:()=>y6});var I6={};gt(I6,{attachPolicies:()=>jd,removePolicy:()=>y6});function y6(t){let e=it(t,[{[Cne]:!0,_anyOf:{[rn]:!1,[Fn]:!1,[ya]:!1,[up]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return qB(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:fe};for(let a of n){let o=t.tournamentRecords[a],s=qB(t,o);if(s.error)return s;i=!0}}else return{error:fe};return i?{...X}:{error:Zp}}function qB(t,e){let i=Nt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Ct({element:e,extension:{name:RI,value:i}}):gn({element:e,name:RI}),{...X}):{error:Zp}}var b6={};gt(b6,{findPolicy:()=>pp,getAppliedPolicies:()=>Nt,getPolicyDefinitions:()=>Bu});var nde={[es]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Fl]:{positioning:kd},[Ao]:{positioning:kd}},positioning:Iae},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},i1=nde;function ade({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return Q({info:"policyDefinitions must be an object",result:{error:le},stack:r});let n={[_S]:t==null?void 0:t[_S]};return e?ode({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&jd({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[es])&&!(e!=null&&e[es])&&(jd({policyDefinitions:i1,drawDefinition:i}),t&&Object.assign(t,i1)),{error:void 0}}function ode({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(jd({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function sde(t){var v,I,y,b,S;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:r,policyDefinitions:n,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:c}=t,u=t.drawId?(v=c==null?void 0:c.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;u&&s!==u.drawType&&(u.drawType=s);let d=u??tde({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=rde({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:c});if(p.error)return Q({result:p,stack:l});let m=ade({appliedPolicies:r,policyDefinitions:n,drawDefinition:d,stack:l});if(m.error)return m;let h=(y=(I=u==null?void 0:u.structures)==null?void 0:I.find(w=>w.stage===Ae&&w.stageSequence===1))==null?void 0:y.structureId,f=u?(b=u.structures)==null?void 0:b.filter(w=>w.stage===We):[],g=(f==null?void 0:f.length)===1&&!((S=f[0].matchUps)!=null&&S.length)&&f[0].structureId;return{drawDefinition:d,structureId:h,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:g}}function lde(t){var u,d;let e="generateOrGetExisting",i=[],r=[],n=sde(t);if(n.error)return Q({result:n,stack:e});let a=n.existingDrawDefinition,o=n.drawDefinition??{},s=n.structureId,l=t.drawEntries??t.eventEntries??[],c=n.existingQualifyingPlaceholderStructureId&&kce({...t,...n})||Xce({...t,...n,entries:l});return c.error?Q({result:c,stack:e}):((u=c.positioningReports)!=null&&u.length&&i.push(...c.positioningReports??[]),(d=c.conflicts)!=null&&d.length&&r.push(...c.conflicts??[]),o=c.drawDefinition,s=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:r,entries:l})}function ude(t){var f,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:r,positioningReports:n,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:c,structureId:u,entries:d,stack:p}=t,m=e&&!(i!=null&&i.length)&&!r,h=[];if(i){let I=(w,U)=>w.stageSequence-U.stageSequence,y=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;i.sort(y);for(let w of i){if(!Array.isArray(w.structureProfiles))return Q({info:Uu("structureProfiles"),result:{error:ze},stack:p});S=w.roundTarget||S;let U=((f=w.structureProfiles)==null?void 0:f.sort(I))||[],T=1;for(let P of U){let{qualifyingRoundNumber:R,qualifyingPositions:D,seededParticipants:E,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:C,drawSize:O}=P,k=g6({...t,seedingProfile:P.seedingProfile??l,stageSequence:T,qualifyingRoundNumber:R,preparedStructureIds:b,qualifyingPositions:D,seededParticipants:E,stage:We,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:M,participants:c,roundTarget:S,seedsCount:A,placeByes:C,drawSize:O,entries:d});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(g=k.conflicts)!=null&&g.length&&h.push(...k.conflicts),(v=k.positioningReport)!=null&&v.length&&n.push({[We]:k.positioningReport})}S+=1}}else if(u&&m){let I=Wa({structureName:Hr(We),stage:We}),{link:y}=hb({sourceStructureId:I.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:gu});s.structures||(s.structures=[]),s.structures.push(I),s.links||(s.links=[]),s.links.push(y)}return{qualifyingConflicts:h,error:void 0}}var w6={};gt(w6,{addGoesTo:()=>Vd,allCompetitionMatchUps:()=>ys,allDrawMatchUps:()=>vn,allEventMatchUps:()=>Kl,allPlayoffPositionsFilled:()=>uO,allTournamentMatchUps:()=>kr,analyzeDraws:()=>Sb,analyzeMatchUp:()=>GI,analyzeTournament:()=>sk,bulkUpdatePublishedEventIds:()=>ck,calculateWinCriteria:()=>vh,categoryCanContain:()=>yb,checkMatchUpIsComplete:()=>Ed,checkValidEntries:()=>pD,compareTieFormats:()=>Su,competitionScheduleMatchUps:()=>Nb,credits:()=>cde,drawMatchUps:()=>Tk,eventMatchUps:()=>ND,filterMatchUps:()=>ru,filterParticipants:()=>sb,findDrawDefinition:()=>OO,findExtension:()=>dt,getAllDrawMatchUps:()=>ur,getAllEventData:()=>dk,getAllStructureMatchUps:()=>_t,getAllowedDrawTypes:()=>wD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>Nt,getAssignedParticipantIds:()=>fp,getAvailableMatchUpsCount:()=>cD,getAvailablePlayoffProfiles:()=>fb,getCategoryAgeDetails:()=>Cm,getCheckedInParticipantIds:()=>oh,getCompetitionDateRange:()=>SD,getCompetitionMatchUps:()=>jI,getCompetitionParticipants:()=>QO,getCompetitionPenalties:()=>ak,getCompetitionVenues:()=>Rb,getCourtInfo:()=>VT,getCourts:()=>Dk,getDrawData:()=>TD,getDrawDefinitionTimeItem:()=>OA,getDrawParticipantRepresentativeIds:()=>NO,getDrawStructures:()=>Oo,getDrawTypeCoercion:()=>Tb,getEligibleVoluntaryConsolationParticipants:()=>MO,getEntriesAndSeedsCount:()=>CD,getEvent:()=>Ek,getEventData:()=>DD,getEventMatchUpFormatTiming:()=>fk,getEventProperties:()=>Pk,getEventPublishStatus:()=>co,getEventStructures:()=>QT,getEventTimeItem:()=>Gy,getEvents:()=>Rk,getFlightProfile:()=>qi,getHomeParticipantId:()=>jT,getLinkedTournamentIds:()=>Ly,getMatchUpCompetitiveProfile:()=>Zy,getMatchUpContextIds:()=>bk,getMatchUpDailyLimits:()=>OD,getMatchUpDailyLimitsUpdate:()=>gk,getMatchUpDependencies:()=>Wo,getMatchUpFormat:()=>wk,getMatchUpFormatTiming:()=>Qy,getMatchUpFormatTimingUpdate:()=>hk,getMatchUpScheduleDetails:()=>GT,getMatchUpType:()=>zT,getMatchUpsMap:()=>Jr,getMatchUpsStats:()=>Uk,getMaxEntryPosition:()=>mk,getModifiedMatchUpFormatTiming:()=>MD,getPairedParticipant:()=>ko,getParticipantEventDetails:()=>ek,getParticipantIdFinishingPositions:()=>AO,getParticipantMembership:()=>tk,getParticipantResults:()=>Ib,getParticipantScaleItem:()=>Lf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>kA,getParticipants:()=>Gi,getPersonRequests:()=>Ip,getPolicyDefinitions:()=>Bu,getPositionAssignments:()=>$I,getPositionsPlayedOff:()=>jg,getPredictiveAccuracy:()=>yk,getProfileRounds:()=>ED,getPublishState:()=>uh,getRoundMatchUps:()=>wn,getRounds:()=>Sk,getScaleValues:()=>Rg,getScaledEntries:()=>fh,getScheduledRoundsDetails:()=>Eb,getSchedulingProfile:()=>zu,getSchedulingProfileIssues:()=>pk,getSeedingThresholds:()=>rO,getSeedsCount:()=>Db,getStructureSeedAssignments:()=>ro,getTeamLineUp:()=>Bd,getTieFormat:()=>uk,getTimeItem:()=>Go,getTournamentIds:()=>xy,getTournamentInfo:()=>gh,getTournamentPenalties:()=>UD,getTournamentPersons:()=>ok,getTournamentPublishStatus:()=>ob,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>_T,getValidGroupSizes:()=>cb,getVenueData:()=>Of,getVenuesAndCourts:()=>Hu,isAdHoc:()=>Wn,isCompletedStructure:()=>Cc,isValidForQualifying:()=>FO,isValidMatchUpFormat:()=>da,matchUpActions:()=>dD,participantScaleItem:()=>bl,participantScheduledMatchUps:()=>vk,positionActions:()=>xO,publicFindVenue:()=>jA,tallyParticipantResults:()=>Gg,tieFormatGenderValidityCheck:()=>aD,tournamentMatchUps:()=>AD,validMatchUp:()=>HT,validMatchUps:()=>uo,validateCollectionDefinition:()=>bb,validateLineUp:()=>ZT});function cde(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var U6={};gt(U6,{filterParticipants:()=>sb,getCompetitionParticipants:()=>QO,getPairedParticipant:()=>ko,getParticipantEventDetails:()=>ek,getParticipantMembership:()=>tk,getParticipantScaleItem:()=>Lf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>kA,getParticipants:()=>Gi,getScaleValues:()=>Rg,participantScaleItem:()=>bl,validateLineUp:()=>ZT});function QO(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Di};let i=[],r={},n={},a={},o=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Gi({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...X,matchUps:o}}function ek({tournamentRecord:t,participantId:e}){if(!t)return{error:fe};if(!e)return{error:lr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[Kt,ot].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return bn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function tk({tournamentRecord:t,participantId:e}){if(!t)return{error:fe};if(!e)return{error:lr};let{participants:i}=Gi({participantFilters:{participantTypes:[Kt,ot,Oa]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function ik({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:fe};if(typeof t!="object")return{error:Lu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=kr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=Wo({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!u&&(u=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...X}}function rk({tournamentRecord:t,participantId:e}){if(!t)return{error:fe};if(!e)return{error:lr};let{participant:i}=Kc({tournamentRecord:t,participantId:e});if(!i)return{error:Li};let{timeItem:r}=Go({itemType:jy,element:i});return r&&r.itemValue===OI&&OI}var S6={};gt(S6,{analyzeDraws:()=>Sb,analyzeTournament:()=>sk,getAllowedDrawTypes:()=>wD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>Nt,getCompetitionDateRange:()=>SD,getCompetitionPenalties:()=>ak,getPolicyDefinitions:()=>Bu,getTournamentInfo:()=>gh,getTournamentPenalties:()=>UD,getTournamentPersons:()=>ok,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>_T});function nk({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:fe};let{appliedPolicies:r}=Nt({tournamentRecord:t});return(((n=r==null?void 0:r[gs])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function wD({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:fe};let{appliedPolicies:r}=Nt({tournamentRecord:t});return(((n=r==null?void 0:r[$S])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function UD({tournamentRecord:t}){if(!t)return{error:fe};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function ak({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Di};let e=[];for(let i of Object.values(t)){let{penalties:r}=UD({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function T6({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var dde={[ky]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},pde=dde;function gh(t){var s,l,c;let{tournamentRecord:e}=t??{};if(!e)return{error:fe};let i=(({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:m,tournamentName:h,promotionalName:f,onlineResources:g,localTimeZone:v,startDate:I,endDate:y,hostCountryCode:b,venues:S,notes:w,updatedAt:U})=>({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:m,tournamentName:h,promotionalName:f,onlineResources:g,localTimeZone:v,startDate:I,endDate:y,hostCountryCode:b,venues:S,notes:w,updatedAt:U}))(e),r=Gi({participantFilters:{participantRoles:[tW,KA,iW,rW,aW]},policyDefinitions:pde,tournamentRecord:e}).participants;r&&(i.tournamentContacts=r);let n=(s=uh({tournamentRecord:e}))==null?void 0:s.publishState,a=((c=(l=n==null?void 0:n.tournament)==null?void 0:l.status)==null?void 0:c.publishedEventIds)||[],o=[];for(let u of e.events??[])if(!(t!=null&&t.usePublishState)||a.includes(u.eventId)){let d=T6({event:u}).eventInfo;d&&o.push(d)}return i.publishState=n==null?void 0:n.tournament,i.eventInfo=o,{tournamentInfo:ke(i,!1,!0),...X}}function SD({tournamentRecords:t}){if(!Ut(t))return{error:Di};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=gh({tournamentRecord:o}),c=s&&new Date(ut(s));(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let u=l&&new Date(ut(l));return(!n.endDate||u&&u>n.endDate)&&(n.endDate=u),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&ut(e.startDate.toISOString()),r=e.endDate&&ut(e.endDate.toISOString());return!i||!r?{error:fG}:{startDate:i,endDate:r}}function ok({tournamentRecord:t,participantFilters:e}){if(!t)return{error:fe};let i=t.participants||[];e&&(i=sb({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function mde(t){var a,o,s,l,c,u,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===Kt))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],r=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],n=((d=(u=((c=r==null?void 0:r.structures)==null?void 0:c.length)===1&&r.structures[0])==null?void 0:u.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&n)}function sk({tournamentRecord:t}){if(!t)return{error:fe};let{drawsAnalysis:e}=Sb({tournamentRecord:t}),i={isDual:mde(t),drawsAnalysis:e};return{...X,analysis:i}}var D6={};gt(D6,{compareTieFormats:()=>Su,getTieFormat:()=>uk,tieFormatGenderValidityCheck:()=>aD,validateCollectionDefinition:()=>bb});function o0(t){var n;if(!t)return{};let e=[],i=t.tieFormatName,r=(n=t.collectionDefinitions)==null?void 0:n.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=a;e.includes(s)||e.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,o===Fd?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:r}}function Su({considerations:t={},descendant:e,ancestor:i}){var S,w;let r={},n={},{matchUpFormats:a,tieFormatDesc:o}=o0(e),{matchUpFormats:s,tieFormatDesc:l}=o0(i),c=mt((a??[]).filter(U=>!(s??[]).includes(U)).concat((s??[]).filter(U=>!(a??[]).includes(U)))),u=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));r.collectionIds=pB(Object.keys(p),Object.keys(m)),n.collectionIds=pB(Object.keys(m),Object.keys(p)),r.collectionsValue=YB(p),n.collectionsValue=YB(m),r.groupsCount=((S=i==null?void 0:i.collectionGroups)==null?void 0:S.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),n.groupsCount=r.groupsCount?-1*r.groupsCount:0;let h=r.collectionsValue.totalValue-n.collectionsValue.totalValue,f=r.collectionsValue.totalMatchUps-n.collectionsValue.totalMatchUps,g=n.collectionsValue.assignmentValues.length!==r.collectionsValue.assignmentValues.length,v=n.collectionsValue.assignmentValues.some((U,T)=>{let P=r.collectionsValue.assignmentValues[T];return!P||U.valueKey!==P.valueKey||U.value!==P.value?!0:Array.isArray(U.value)?U.value.every((R,D)=>P.value[D]===R):!1}),I=u||d||l!==o||g||v||h!==0,y=[...n.collectionsValue.invalidValues,...r.collectionsValue.invalidValues],b=y.length&&y;return{matchUpFormatDifferences:c,matchUpCountDifference:f,descendantDifferences:r,ancestorDifferences:n,orderDifference:d,valueDifference:h,nameDifference:u,descendantDesc:o,ancestorDesc:l,...X,different:I,invalid:b}}function YB(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(KT).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g])&&(!Array.isArray(m[g])||m[g].length>0));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=c,s!=null&&s.length?n+s.reduce((g,v)=>g+v.value,0):c?rt(u)?n+u*c:rt(d)?n+d*c:rt(p)?n+p*c:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function lk(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=P6(t);return{matchUp:ke(e,!0,!0),error:i}}function P6({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var h;if(!i)return{error:fe};if(typeof s!="string")return{error:pn};if(!a||!d){let f=(kr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:tn};({eventId:c,drawId:u}=f),{event:d,drawDefinition:a}=An({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:Pa};n&&!r&&(r=Vu({tournamentRecord:i,contextProfile:n}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:m=[]}=nh({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(vn({context:l?p:void 0,participants:m,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:tn};let g=(h=a==null?void 0:a.structures)==null?void 0:h.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=hi({context:l?p:void 0,tournamentParticipants:m,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function uk({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var m,h,f,g,v;if(!t)return{error:fe};if(!o&&!s&&!i&&!r)return Q({result:{error:ze},stack:"getTieFormat"});a&&!s&&(s=(m=t.events)==null?void 0:m.find(I=>I.eventId===a));let l=lk({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),n=n??(l==null?void 0:l.structure),!n&&i&&!r){if(!e)return{error:Ds};let I=Qe({drawDefinition:e,structureId:i});if(I.error)return I;n=I.structure}let c=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((h=un({structure:n,drawDefinition:e,event:s}))==null?void 0:h.tieFormat),u=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((f=un({drawDefinition:e,event:s}))==null?void 0:f.tieFormat),d=(g=un({event:s}))==null?void 0:g.tieFormat,p=(v=un({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:v.tieFormat;return{...X,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:Br(c),eventDefaultTieFormat:Br(d),drawDefaultTieFormat:Br(u),tieFormat:Br(p),structure:n}}var R6={};gt(R6,{bulkUpdatePublishedEventIds:()=>ck,getAllEventData:()=>dk,getCourtInfo:()=>VT,getDrawData:()=>TD,getEventData:()=>DD,getEventPublishStatus:()=>co,getPublishState:()=>uh,getTournamentPublishStatus:()=>ob,getVenueData:()=>Of});function ck({tournamentRecord:t,outcomes:e}){var n;if(!t)return{error:fe};if(!(e!=null&&e.length))return{error:ze,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(i);return{publishedEventIds:((n=t.events)==null?void 0:n.filter(a=>r.includes(a.eventId))).filter(a=>{let o=co({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:c}=a;return i[c].filter(u=>{let d=s?Object.keys(o.drawDetails).filter(p=>qA({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function E6({dates:t=[],extension:e}){var r;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Ut(e.value)?(r=e.value)==null?void 0:r.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(n=>!t.length||t.includes(n)).length:!1}function C6({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var o;let n={...ke(r,t,!0),venueId:i.venueId},{extension:a}=dt({name:ss,element:r});if(e&&a){let s=Ut(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:n.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);n.dateAvailability=l}return{inContextCourt:n}}function Hu(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=dt({name:ss,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(c.push(ke(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=dt({name:ss,element:m});if(E6({extension:f,dates:n}))continue}let{inContextCourt:h}=C6({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:c,...X}}function hde({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Di};let n=ke(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=dt({name:ss,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(r!=null&&r.length))return c;let{extension:u}=dt({name:ss,element:c});return E6({extension:u,dates:r})}).filter(Boolean).map(c=>{let{inContextCourt:u}=C6({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Rb({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Di}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=hde({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function dk({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:fe};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=gh({tournamentRecord:t}),{venues:a}=Hu({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,c=T6({event:s}).eventInfo,u=Hy({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:y,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:y}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:I}=_g({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:I}}}),p=co({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function M6({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}var N6="PUBLIC",fde="ADMIN",gde={PUBLIC_DISPLAY:N6,ADMIN_DISPLAY:fde};function TD(t){var D,E,N;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:r,tournamentRecord:n,inContext:a=!0,usePublishState:o,status:s=ka,pressureRating:l,refreshResults:c,drawDefinition:u,noDeepCopy:d,sortConfig:p,context:m,event:h}=t;if(!u)return{error:xe};let f=(({matchUpFormat:A,updatedAt:M,drawType:C,drawName:O,drawId:k})=>({matchUpFormat:A,updatedAt:M,drawName:O,drawType:C,drawId:k}))(u);f.display=(D=dt({element:u,name:BS}).extension)==null?void 0:D.value;let g,v,{allStructuresLinked:I,sourceStructureIds:y,hasDrawFeedProfile:b,structureGroups:S}=eD({drawDefinition:u});if(!I)return{error:nG};let w=(t==null?void 0:t.publishStatus)??co({event:h,status:s}),U=t.eventPublished??!!((N=(E=uh({event:h}).publishState)==null?void 0:E.status)!=null&&N.published),T=!1,P=!1,R=S.map(A=>{let M={},C=A.map(O=>{let{structure:k}=Qe({drawDefinition:u,structureId:O}),{seedAssignments:x}=ro({drawDefinition:u,structure:k});return(k==null?void 0:k.stage)===Ae&&k.stageSequence===1&&(g=x),(k==null?void 0:k.stage)===We&&k.stageSequence===1&&(v=x),k}).sort((O,k)=>ih(O,k,p)).map(O=>{var H,W;if(!O)return;let k=O==null?void 0:O.structureId,x=[];O.stage&&[Ae,Wr,xi].includes(O.stage)&&(x=g),(O==null?void 0:O.stage)===We&&(x=v);let{matchUps:F,roundMatchUps:$,roundProfile:_}=_t({seedAssignments:(H=O==null?void 0:O.seedAssignments)!=null&&H.length?void 0:x,context:{drawId:f.drawId,...m},tournamentParticipants:e,policyDefinitions:r,tournamentRecord:n,usePublishState:o,publishStatus:w,drawDefinition:u,inContext:a,structure:O,event:h}),{positionAssignments:L}=Qt({structure:O}),B=L==null?void 0:L.filter(ca(Nl)).map(Y=>{var z,te;let q=(te=(z=dt({element:Y,name:Dc}))==null?void 0:z.extension)==null?void 0:te.value,{drawPosition:re,participantId:K}=Y;return P=!0,{participantResult:q,participantId:K,drawPosition:re}});if(F.length&&(!(B!=null&&B.length)&&t.allParticipantResults||c&&!O.structures)){let{subOrderMap:Y}=aq({positionAssignments:L}),q=Gg({matchUpFormat:O.matchUpFormat,policyDefinitions:r,pressureRating:l,subOrderMap:Y,matchUps:F});B=L==null?void 0:L.filter(ca(Nl)).map(re=>{var te;let{drawPosition:K,participantId:z}=re;return P=!0,{participantResult:z&&((te=q==null?void 0:q.participantResults)==null?void 0:te[z]),participantId:z,drawPosition:K}})}let V=O?(({stageSequence:Y,structureName:q,structureType:re,matchUpFormat:K,stage:z})=>({stageSequence:Y,structureName:q,structureType:re,matchUpFormat:K,stage:z}))(O):{},G=(W=dt({element:O,name:BS}).extension)==null?void 0:W.value;V.display=(G==null?void 0:G[N6])??G,V.sourceStructureIds=y[k],V.hasDrawFeedProfile=b[k],V.positionAssignments=L,V.structureActive=F.reduce((Y,q)=>{var K;let re=[tr,mr,jo,_i,_u,Rt,nn,Lt].includes(q.matchUpStatus);return Y||re||!!q.winningSide||!!((K=q.score)!=null&&K.scoreStringSide1)},!1);let j=F.reduce((Y,q)=>Y&&[xt,_i,nn,Lt,Rt,Ea].includes(q.matchUpStatus),!!F.length);return V.structureCompleted=j,M[k]=j,V.structureActive&&(T=!0),{...V,participantResults:B,seedAssignments:x,roundMatchUps:$,roundProfile:_,structureId:k}});return C.forEach(O=>{var k;i||delete O.positionAssignments,O.sourceStructuresComplete=(k=O.sourceStructureIds)==null?void 0:k.every(x=>M[x])}),C}).flat();return f.drawActive=T,f.participantPlacements=P,f.drawGenerated=R==null?void 0:R.reduce((A,M)=>A||!!(M!=null&&M.roundMatchUps),!1),f.drawCompleted=R==null?void 0:R.reduce((A,M)=>A&&M.structureCompleted,!0),f.drawPublished=o?U&&M6({publishStatus:w,drawId:f.drawId}):void 0,{structures:!o||f.drawPublished?d?R:ke(R,!1,!0):void 0,drawInfo:d?f:ke(f,!1,!0),...X}}function DD(t){var E,N,A;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:r,usePublishState:n,status:a=ka,sortConfig:o}=t,s=it(t,[{tournamentRecord:!0},{[KN]:{event:!1,eventId:!1}}]);if(s.error)return s;let l=ke(t.tournamentRecord,!1,!0),c=t.event?void 0:An({tournamentRecord:l,eventId:t.eventId}).event,u=t.event?ke(t.event,!1,!0):c&&ke(c,!1,!0)||void 0;if(!u)return{error:sa};let{eventId:d}=u,{tournamentId:p,endDate:m}=l,h=co({event:u,status:a}),f=uh({event:u}).publishState??{},g=!!((E=f==null?void 0:f.status)!=null&&E.published),{participants:v}=Gi({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:r,...i,tournamentRecord:l}),I=({stage:M,drawId:C})=>{var k,x,F;if(!n)return!0;let O=(x=(k=h==null?void 0:h.drawDetails)==null?void 0:k[C])==null?void 0:x.stageDetails;return!O||!Object.keys(O).length?!0:(F=O[M])==null?void 0:F.published},y=({structureId:M,drawId:C})=>{var k,x,F;if(!n)return!0;let O=(x=(k=h==null?void 0:h.drawDetails)==null?void 0:k[C])==null?void 0:x.structureDetails;return!O||!Object.keys(O).length?!0:(F=O[M])==null?void 0:F.published},b=({drawId:M})=>n?M6({publishStatus:h,drawId:M}):!0,S=({drawId:M,structure:C})=>{var k,x,F,$;if(!n)return C;let O=($=(F=(x=(k=h==null?void 0:h.drawDetails)==null?void 0:k[M])==null?void 0:x.structureDetails)==null?void 0:F[C.structureId])==null?void 0:$.roundLimit;if(rt(O)){let _=Re(1,O+1),L={},B={};for(let V of _)C.roundMatchUps[V]&&(L[V]=C.roundMatchUps[V],B[V]=C.roundProfile[V]);C.roundMatchUps=L,C.roundProfile=B}return C},w=u.drawDefinitions||[],U=!n||g?w.filter(b).map(M=>(({drawInfo:C,structures:O})=>({...C,structures:O}))(TD({allParticipantResults:t.allParticipantResults,context:{eventId:d,tournamentId:p,endDate:m},pressureRating:t.pressureRating,refreshResults:t.refreshResults,includePositionAssignments:e,tournamentParticipants:v,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:l,usePublishState:n,drawDefinition:M,publishStatus:h,sortConfig:o,event:u}))).map(({structures:M,...C})=>{let O=M==null?void 0:M.filter(({stage:k,structureId:x})=>y({structureId:x,drawId:C.drawId})&&I({stage:k,drawId:C.drawId})).map(k=>S({drawId:C.drawId,structure:k}));return{...C,structures:O}}).filter(M=>{var C;return(C=M.structures)==null?void 0:C.length}):void 0,{tournamentInfo:T}=gh({tournamentRecord:l}),P=(l.venues||[]).map(M=>(({venueData:C})=>({...C}))(Of({tournamentRecord:l,venueId:M.venueId}))),R=(({eventId:M,eventName:C,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G})=>({eventId:M,eventName:C,eventType:O,eventLevel:k,surfaceCategory:x,matchUpFormat:F,category:$,gender:_,startDate:L,endDate:B,ballType:V,discipline:G}))(u);R.display=(N=dt({element:u,name:BS}).extension)==null?void 0:N.value;let D={tournamentInfo:T,venuesData:P,eventInfo:R,drawsData:U};return D.eventInfo.publishState=f,D.eventInfo.published=(A=f==null?void 0:f.status)==null?void 0:A.published,{...X,eventData:D,participants:v}}var A6={};gt(A6,{getPersonRequests:()=>Ip,getProfileRounds:()=>ED,getScheduledRoundsDetails:()=>Eb,getSchedulingProfile:()=>zu,getSchedulingProfileIssues:()=>pk});function PD({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!da({matchUpFormat:r}))return{error:Ey};let c=Object.keys(i).filter(d=>!o||d===o),u;return c.forEach(d=>{var h;if(u)return;let p=i[d],m=l?(h=An({tournamentRecord:p,eventId:l}))==null?void 0:h.event:void 0;return u=Qy({tournamentRecord:p,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:m}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function Eb({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:r=30,matchUps:n,rounds:a}){if(typeof i!="object")return{error:Di};if(!Array.isArray(a))return{error:ze,info:Uu("rounds")};let o={},s=[];a.sort((p,m)=>(p.sortOrder??0)-(m.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>Og({tournamentRecord:p}).containedStructures)),n||({matchUps:n}=ys({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var S;let m=p.periodLength||r,h=[];e!=null&&e[p.structureId]?h.push(...e[p.structureId]):h.push(p.structureId);let f=n?ru({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:h,matchUps:n}).sort(lh):[],{segmentNumber:g,segmentsCount:v}=p.roundSegment||{};if(rt(g)&&hs(f==null?void 0:f.length)&&hs(v)&&g>0&&g<=v&&v<(f==null?void 0:f.length)&&!((S=p.matchUpIds)!=null&&S.length)){let w=f.length/v,U=w*(g-1);f=f.slice(U,U+w)}let I=i[p.tournamentId],y=An({drawId:p.drawId,tournamentRecord:I}).event,b=[];for(let w of f){let U=w.matchUpFormat;U&&(o[U]||(o[U]=[],o[U].push(w)),b.push(U))}for(let w of b){let{eventType:U,category:T}=y??{},{categoryName:P,ageCategoryCode:R}=T??{},{typeChangeRecoveryMinutes:D,recoveryMinutes:E,averageMinutes:N,error:A}=PD({categoryName:P??R,categoryType:T==null?void 0:T.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:U});if(A)return{error:A,round:p};let M=f.filter(O=>(t||!fr.includes(O.matchUpStatus))&&O.matchUpStatus!==xt).map(br);M.forEach(O=>{d[O]={typeChangeRecoveryMinutes:D,recoveryMinutes:E,averageMinutes:N},c[O]=E,u[O]=N}),s.push(...M),l=Math.max(N||0,l);let C=`${N}|${m}`;return{roundPeriodLength:m,recoveryMinutes:E,averageMinutes:N,matchUpIds:M,hash:C}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...X}}function O6({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=ut(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function RD({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:le};let{venueIds:i,tournamentsMap:r}=Ide({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:c}=s;return aa(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var T,P,R,D;if(!m)return a="empty round",!1;let{roundSegment:h,tournamentId:f,structureId:g,roundNumber:v,eventId:I,drawId:y}=m,b=(D=(R=(P=(T=r==null?void 0:r[f])==null?void 0:T[I])==null?void 0:P[y])==null?void 0:R[g])==null?void 0:D.includes(v);b||(a="Invalid rounds");let{segmentNumber:S,segmentsCount:w}=h||{},U=!h||rt(S)&&hs(w)&&S<=w;return U||(a="Invalid segment"),b&&U}):(n=Jm,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=le),{valid:!!o,error:n,info:a}}function vde(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!r||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(n.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;o.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[c][d][m]={};let{structures:h}=Oo({drawDefinition:p});(h||[]).forEach(f=>{var b;let g=f.structureId,{matchUps:v}=_t({structure:f}),{roundMatchUps:I}=wn({matchUps:v}),y=I&&Object.keys(I).map(S=>parseInt(S));i[c][d][m][g]=y,a.push(g),(b=f.structures)!=null&&b.length&&f.structures.forEach(S=>{a.push(S.structureId),i[c][d][m][S.structureId]=y})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function Ide(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=vde({tournamentRecord:c});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function zu({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Di};let{extension:i}=dt({element:e,name:Dm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Rb({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=PO({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=O6({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let u=Hg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return u.error?u:{schedulingProfile:r,modifications:l,issues:c}}}return{schedulingProfile:r,modifications:0}}function Hg({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=RD({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Ct({tournamentRecords:t,discover:!0,extension:{name:Dm,value:i}}):gn({element:e,name:Dm,tournamentRecords:t,discover:!0})}function Cb(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=zu({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:r}=Rb({tournamentRecords:i}),{eventIds:n,drawIds:a}=PO({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=O6({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Hg({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...X,modifications:s,issues:l}}function pk(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Dy};if(!Array.isArray(e))return{error:le};if(!e.every(aa))return{error:yn};let n=[],a=0,o={},{schedulingProfile:s}=zu({tournamentRecords:i});if(!s)return{issues:n,...X};let{matchUps:l}=ys({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Eb({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:I}=Wo({tournamentRecords:i,matchUps:l}),y=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var T;let w=g.slice(S+1),U=Vi(w,((T=I==null?void 0:I[b])==null?void 0:T.matchUpIds)||[]);U.length&&f.push({matchUpId:b,shouldBeAfter:U})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=y(S),T=mt(w.map(y));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(P=>{o[d][U].includes(P)||o[d][U].push(P)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...n.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=u;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:o,...X}}function Ip(t){let{tournamentRecords:e,requestType:i}=t,r=it(t,[{[rn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=dt({element:a,name:Cg}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};n[c]||(n[c]=[]);for(let d of u)i&&d.requestType!==i||n[c].push(d)}}return{personRequests:n,...X}}function r1(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,c=r?e:o,u=[n,s,l,c,a].join("|");return Ge({structureId:c,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:u})}function KB({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:c}=o||{},u=la(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let m=u[p],h=PD({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function yde(t){return(t||[]).reduce((e,i)=>{var a,o;let r=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),n=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||r<e.minFinishingSum?{minFinishingSum:r,winnerFinishingPositionRange:n}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function JB(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,r=t.filter(({winningSide:c,matchUpStatus:u})=>c||fr.includes(u)).length||0,n=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==xt).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function ED({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Dy};t={[i.tournamentId]:i}}if(e){let a=RD({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=zu({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Nr};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=r1(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(n[c.id]=c.roundSegment.segmentsCount),Ge({id:r?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:n}}var k6={};gt(k6,{getEntriesAndSeedsCount:()=>CD,getMaxEntryPosition:()=>mk});function CD({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:ni};let{entries:o,stageEntries:s}=sW({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:c}=Aq({participantsCount:l}),u=Db({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return Q({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:o,seedsCount:d,stageEntries:s}}function mk(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Je(n||0)),0)}var x6={};gt(x6,{allCompetitionMatchUps:()=>ys,allDrawMatchUps:()=>vn,allEventMatchUps:()=>Kl,allTournamentMatchUps:()=>kr,analyzeMatchUp:()=>GI,calculateWinCriteria:()=>vh,checkMatchUpIsComplete:()=>Ed,competitionScheduleMatchUps:()=>Nb,drawMatchUps:()=>Tk,eventMatchUps:()=>ND,filterMatchUps:()=>ru,getAllDrawMatchUps:()=>ur,getAllStructureMatchUps:()=>_t,getCheckedInParticipantIds:()=>oh,getCompetitionMatchUps:()=>jI,getEventMatchUpFormatTiming:()=>fk,getHomeParticipantId:()=>jT,getMatchUpCompetitiveProfile:()=>Zy,getMatchUpContextIds:()=>bk,getMatchUpDailyLimits:()=>OD,getMatchUpDailyLimitsUpdate:()=>gk,getMatchUpDependencies:()=>Wo,getMatchUpFormat:()=>wk,getMatchUpFormatTiming:()=>Qy,getMatchUpFormatTimingUpdate:()=>hk,getMatchUpScheduleDetails:()=>GT,getMatchUpType:()=>zT,getMatchUpsStats:()=>Uk,getModifiedMatchUpFormatTiming:()=>MD,getParticipantResults:()=>Ib,getPredictiveAccuracy:()=>yk,getRoundMatchUps:()=>wn,getRounds:()=>Sk,isValidMatchUpFormat:()=>da,matchUpActions:()=>dD,participantScheduledMatchUps:()=>vk,tallyParticipantResults:()=>Gg,tournamentMatchUps:()=>AD,validMatchUp:()=>HT,validMatchUps:()=>uo});function F6({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Di};let i=[],r;for(let n of Object.values(t)){let{extension:a}=dt({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:c}=dt({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function hk({tournamentRecords:t}){return F6({extensionName:fu,tournamentRecords:t})}var yE="ADULT",bE="JUNIOR",AU="WHEELCHAIR",bde={[Wc]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ri]:30,default:60}}]},defaultDailyLimits:{[vi]:2,[ri]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[du],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[AU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[yE,AU],minutes:{default:60,[ri]:30}},{categoryTypes:[bE],minutes:{default:60,[ri]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yE,AU],minutes:{default:30}},{categoryTypes:[bE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[yE,bE],minutes:{default:30}},{categoryTypes:[AU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},wde=bde;function fk({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:ni};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&da({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=pp({policyType:gs,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=dt({name:fu,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=wde[Wc],n=mt([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:ni};let u=n.map(({matchUpFormat:d,description:p})=>{let m=Qy({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return Ge({eventMatchUpFormatTiming:u,info:a})}function MD(t){let e=it(t,[{[Fn]:!0},{[ea]:f=>da({matchUpFormat:f}),[fs]:Ey,[zN]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=dt({name:fu,element:n}),o=a==null?void 0:a.value,{extension:s}=dt({element:i,name:fu}),l=s==null?void 0:s.value,c=(o==null?void 0:o.matchUpAverageTimes)&&Xv({...o,matchUpFormat:r}),u=(l==null?void 0:l.matchUpAverageTimes)&&Xv({...l,matchUpFormat:r}),d=[c,u].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&Zv({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&Zv({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function gk({tournamentRecords:t}){return F6({extensionName:Fy,tournamentRecords:t})}var Mb=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function vk({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!uo(e))return{error:Fu};if(!Array.isArray(t))return{error:le};let i=e.filter(Boolean).filter(({schedule:r})=>Mb({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=ut(a==null?void 0:a.scheduledDate),s=mi(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return PH(mi((o=n.schedule)==null?void 0:o.scheduledTime),mi((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...X,scheduledMatchUps:i}}function Ude({tournamentRecords:t}){var r;let e=[],i={};for(let n of Object.values(t))for(let a of n.events??[]){let o=co({event:a}),s=o==null?void 0:o.drawDetails;Ut(s)?(Object.assign(i,s),e.push(...Object.keys(s).filter(l=>qA({drawId:l,drawDetails:s})))):(r=o==null?void 0:o.drawIds)!=null&&r.length&&e.push(...o.drawIds)}return{drawIds:e,detailsMap:i}}function s0({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let m=r({eventId:l,drawId:c,structureId:u,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&ut(l.scheduledDate)||l.scheduledTime&&ut(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&mi(p.scheduledTime)||"noScheduledTime";c[m]||(c[m]=[]),c[m].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function Ik({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:le};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>o?c:o},1),n=e?Math.max(e,r):r,a=Re(0,n).map(o=>({matchUps:Re(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:o+1,venueId:u,courtId:c}}})}));return i.forEach((o,s)=>{var l;for(let c of o.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}function ND(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:I,event:y}=t;if(!y)return{error:ni};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:P}=y??{},R={...I,...Ge({surfaceCategory:y.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:y.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:P})},D;!e&&u&&({participants:e,participantMap:r,groupInfo:D}=nh({participantsProfile:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:v})),h&&!i&&(i=Vu({policyDefinitions:l,tournamentRecord:u,contextProfile:h,event:y}));let E=co({event:y});return{...(y.drawDefinitions??[]).reduce((N,A)=>{var C;let M=_g({context:R,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:E,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:y});return(C=Object.keys(M))==null||C.forEach(O=>{Array.isArray(M[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(M[O]))}),N},{}),...X,groupInfo:D}}function AD(t){if(!(t!=null&&t.tournamentRecord))return{error:fe};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:m,context:h}=t,f=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:I,groupInfo:y}=nh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=Vu({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=Nt({tournamentRecord:s}),S=(u==null?void 0:u.eventIds)??[];return{...g.filter(w=>!S.includes(w.eventId)).map(w=>{var T,P,R;let U={eventDrawsCount:((P=(T=qi({event:w}).flightProfile)==null?void 0:T.flights)==null?void 0:P.length)||((R=w.drawDefinitions)==null?void 0:R.length)||0,...h};return ND({context:U,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:I,participants:v,tournamentId:f,nextMatchUps:m,inContext:l,event:w})}).reduce((w,U)=>{var T;return(T=U&&Object.keys(U).filter(P=>!["success","matchUpsMap"].includes(P)))==null||T.forEach(P=>{Array.isArray(U[P])&&(w[P]||(w[P]=[]),w[P]=w[P].concat(U[P]),w.matchUpsCount+=U[P].length)}),w},{matchUpsCount:0}),groupInfo:y}}function jI({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:r,usePublishState:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Di};let c=Object.keys(i).map(d=>{let p=i[d];return AD({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:r,tournamentRecord:p,usePublishState:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(m=>{Array.isArray(p[m])&&(d[m]||(d[m]=[]),d[m]=d[m].concat(p[m])),m==="groupInfo"&&Object.assign(u,p[m])}),d),{}),groupInfo:u}}function Nb(t){var E,N,A,M,C,O,k;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Di};let{courts:e,venues:i}=Hu(t),r=zu(t).schedulingProfile,{sortDateMatchUps:n=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=ka,sortCourtsData:m}=t,h=s??Xm()??Object.keys(l)[0],f=d?ob({tournamentRecord:l[h],status:p}):void 0,g=o?jI({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[_i]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&!((E=f==null?void 0:f.orderOfPlay)!=null&&E.published))return{completedMatchUps:g,dateMatchUps:[],courtsData:[],venues:i};let v,I;d&&({drawIds:v,detailsMap:I}=Ude({tournamentRecords:l})),v!=null&&v.length&&(t.contextFilters||(t.contextFilters={}),(N=t.contextFilters)!=null&&N.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(x=>v.includes(x)):t.contextFilters.drawIds=v),(A=f==null?void 0:f.eventIds)!=null&&A.length&&(t.matchUpFilters||(t.matchUpFilters={}),(M=t.matchUpFilters)!=null&&M.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(x=>f.eventIds.includes(x)):t.matchUpFilters.eventIds=f.eventIds),(C=f==null?void 0:f.scheduledDates)!=null&&C.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(x=>f.scheduledDates.includes(x)):t.matchUpFilters.scheduledDates=f.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(k=(O=t.matchUpFilters)==null?void 0:O.excludeMatchUpStatuses)!=null&&k.length?t.matchUpFilters.excludeMatchUpStatuses.includes(_i)||t.matchUpFilters.excludeMatchUpStatuses.push(_i):t.matchUpFilters.excludeMatchUpStatuses=[_i]);let{completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:S,groupInfo:w}=jI({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),U=[...b??[],...S??[]];I&&Object.keys(I).length&&(U=U.filter(x=>{let{drawId:F,structureId:$,stage:_}=x;if(!I[F])return!1;if(I[F].stageDetails){let L=Object.keys(I[F].stageDetails),B=L.filter(G=>!I[F].stageDetails[G].published),V=L.filter(G=>I[F].stageDetails[G].published);return B.length&&B.includes(_)?!1:V.length&&V.includes(_)?!0:B.length&&!B.includes(_)&&!V.length}if(I[F].structureDetails){let L=Object.keys(I[F].structureDetails),B=L.filter(G=>!I[F].structureDetails[G].published),V=L.filter(G=>I[F].structureDetails[G].published);return B.length&&B.includes($)?!1:V.length&&V.includes($)?!0:B.length&&!B.includes($)&&!V.length}return!0}));let T=n?s0({matchUps:U,schedulingProfile:r}):U,P=e==null?void 0:e.map(x=>{let F=D(x);return{surfaceCategory:(x==null?void 0:x.surfaceCategory)??"",matchUps:F,...x}}),R={completedMatchUps:o?g:y,dateMatchUps:T,courtsData:P,groupInfo:w,venues:i};if(c){let{rows:x,courtPrefix:F}=Ik({minRowsCount:u,courtsData:P});R.courtPrefix=F,R.rows=x}return{...R,...X};function D({courtId:x}){let F=(a?T.concat(y??[]):T).filter($=>{var _,L,B;return((_=$.schedule)==null?void 0:_.courtId)===x||((B=(L=$.schedule)==null?void 0:L.allocatedCourts)==null?void 0:B.map(({courtId:V})=>V).includes(x))});return m?s0({matchUps:F,schedulingProfile:r}):F}}function OD({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Di};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=Sde({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function Sde(t){var s;let e=it(t,[{[Fn]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:r}=pp({policyType:Wc,tournamentRecord:i}),{extension:n}=dt({element:i,name:Fy}),a=(s=n==null?void 0:n.value)==null?void 0:s.dailyLimits,o=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function yk(t){var A,M,C,O;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:r,drawDefinition:n,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:m}=t;if(!r&&!e)return{error:fe};if(l&&![vi,ri].includes(l))return{error:le,info:{matchUpType:l}};if(e&&!uo(e))return{error:le,context:{matchUps:e}};let h=Dr[c],f=(h==null?void 0:h.ascending)??t.ascending??!1,g=(h==null?void 0:h.accessor)??t.valueAccessor,v=Array.isArray(h==null?void 0:h.range)?Math.abs(h.range[0]-h.range[1]):0,I=rt(d)&&v?(d??0/100)*v:t.zoneMargin??v,y={withScaleValues:!0,withCompetitiveness:!0},b={matchUpTypes:l?[l]:[vi,ri]},S=r==null?void 0:r.participants;(A=e==null?void 0:e[0])!=null&&A.hasContext?p?e=e.filter(k=>k.drawId===p):u&&(e=e.filter(k=>k.eventId===u)):e===void 0&&(e=p&&!n&&[]||!p&&u&&!m&&[]||p&&((M=vn({inContext:!0,drawDefinition:n,contextFilters:b,contextProfile:y,participants:S}))==null?void 0:M.matchUps)||!p&&u&&((C=Kl({inContext:!0,contextFilters:b,contextProfile:y,participants:S,event:m}))==null?void 0:C.matchUps)||((O=kr({tournamentRecord:r,contextFilters:b,contextProfile:y}))==null?void 0:O.matchUps)||[]),l&&(e=e.filter(k=>k.matchUpType===l));let w=e.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![nn,Rt,Lt,Mg,Ea].includes($??"")&&gr({score:x})&&(F==null?void 0:F.length)===2&&k),U=Dde({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:f,scaleName:c}),T=!s||$i(vi)(l)?I:(I||0)*2,P=I?w.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=L6({singlesForDoubles:i,valueAccessor:g,matchUpType:x,scaleName:c,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=T):[],R=Tde({zoneData:P}),D=R&&[].concat(Object.values(R)).flat().length,E=D&&Object.assign({},...Object.keys(R).map(k=>({[k]:Math.round(1e4*R[k].length/D)/100}))),N=w.length-((P==null?void 0:P.length)||0);return{...X,relevantMatchUps:w,zoneDistribution:E,zoneData:P,accuracy:U,nonZone:N}}function Tde({zoneData:t}){let e={[xA]:[],[kI]:[],[xI]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function L6({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=o[0]&&c<=o[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let m of u){let{scaleValue:h,value:f}=XB({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&c.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=XB({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&c.push(h),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function XB({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var c,u,d,p,m;let a=t?vi:i,o=(u=(c=r==null?void 0:r.rankings)==null?void 0:c[a])==null?void 0:u.find(h=>h.scaleName===n),s=(m=((p=(d=r==null?void 0:r.ratings)==null?void 0:d[a])==null?void 0:p.find(h=>h.scaleName===n))||o)==null?void 0:m.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function Dde({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:m}=c;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:ze};let h=m-1,f=L6({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),I=v&&Math.abs(g)<v;if(I){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:I,sideValues:f,valuesGap:g});continue}let y=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;y>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function vh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=sq({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(rt(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&rt(l))i+=l;else if(Array.isArray(o)&&(o!=null&&o.length))for(let h of o)i+=h.matchUpValue;else typeof u=="number"&&rt(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...X}:{valueGoal:Math.floor(i/2)+1,...X}}function bk({matchUps:t,matchUpId:e}){if(!uo(t))return{error:le};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function zg(t,e){if(!Ut(t))return{error:le};if(!Array.isArray(e))return{error:le};let i={};for(let{param:r,error:n,attr:a}of e){let o=Pde({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function Pde({params:t,param:e,attr:i,error:r}){if(e===YN&&Ut(t.drawDefinition)&&Ki(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===Yl){let n=P6({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:Nr,info:{param:e}}}function wk(t){var p,m;let{structureId:e,matchUpId:i,event:r}=t,n=t.drawDefinition,a=it(t,[{[Fn]:!0},{[KN]:{[yT]:!1,[al]:!1,[UH]:!1,[up]:!1}}]);if(a[vl])return a;let o=(p=zg(t,[{[Pg]:Yl,[vl]:ze}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!n&&(o!=null&&o.drawDefinition)&&(n=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!n)return{error:Ds};let h=Qe({drawDefinition:n,structureId:e});if(h.error)return h;s=h.structure}let l=s==null?void 0:s.matchUpFormat,c=n==null?void 0:n.matchUpFormat,u=r==null?void 0:r.matchUpFormat,d=((m=o==null?void 0:o.matchUp)==null?void 0:m.matchUpFormat)||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function Uk({profileBands:t,tournamentRecord:e,matchUps:i}){if(!uo(i))return{error:Fu};let r=!t&&pp({policyType:iu,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||FA[iu].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(gz),s=(p,m)=>{let h=fz(m,n);return p[h]+=1,p},l=vz(o).reduce((p,m)=>s(p,m),{[xA]:0,[kI]:0,[xI]:0,[pz]:0}),c=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),u=Object.keys(l).map(p=>{let m=parseFloat((l[p]/c).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===gB).length;return u.push({[gB]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...X}}var{stageOrder:ZB}=Tae;function Rde(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(ZB[t==null?void 0:t.stage]||0)-(ZB[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function Sk({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var w;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:le,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Dy};n={[o.tournamentId]:o}}let m=typeof n!="object"||!Object.keys(n).length;if((d||c||!r||!a&&(t||i||a||s))&&m)return{error:Di};let h=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:P})=>P)}))),f=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:P,endDate:R})=>U.map(D=>({...D,validVenueIds:h[T],startDate:D.startDate??P,endDate:D.endDate??R}))).flat(),{segmentedRounds:g,profileRounds:v}=n&&(t||i||a||s)&&ED({tournamentRecords:n,schedulingProfile:a})||{},I=t&&Object.assign({},...v.map(U=>({[U.id]:U}))),y=r||n&&((w=ys({tournamentRecords:n,matchUpFilters:l}))==null?void 0:w.matchUps)||[],b=[],S=y&&Object.values(y.reduce((U,T)=>{var j;let P=r1(T).id,R=g==null?void 0:g[P],D=[...((j=U[P])==null?void 0:j.matchUps)??[],T],{containerStructureId:E,stageSequence:N,structureName:A,tournamentId:M,isRoundRobin:C,matchUpType:O,roundNumber:k,roundOffset:x,structureId:F,eventName:$,roundName:_,drawName:L,eventId:B,drawId:V}=T,G=C?E:F;return{...U,[P]:{id:u?P:void 0,structureId:G,stageSequence:N,segmentsCount:R,structureName:A,tournamentId:M,matchUpType:O,roundNumber:k,roundOffset:x,eventName:$,roundName:_,drawName:L,matchUps:D,eventId:B,drawId:V}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:P}=yde(U.matchUps),R=U.segmentsCount;if(R){let k=U.matchUps.length/R;return Ar(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=JB(x),j=KB({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return Ge({...U,...p,roundSegment:{segmentsCount:R,segmentNumber:F+1},winnerFinishingPositionRange:P,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:D,incompleteCount:E,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:C}=JB(U.matchUps),O=KB({matchUps:U.matchUps,tournamentRecords:n,events:f,round:U});return Ge({...U,...p,winnerFinishingPositionRange:P,unscheduledCount:D,incompleteCount:E,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:C})}).flat().filter(U=>{if(t){let F=ut(t),$=u?U.id:r1(U).id;if(F&&I[$]&&ut(I[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:P}=U,R=!i||!T,D=!e||!P,E=d||c?f==null?void 0:f.find(({eventId:F})=>F===U.eventId):void 0,N=(E==null?void 0:E.startDate)??(o==null?void 0:o.startDate),A=(E==null?void 0:E.endDate)??(o==null?void 0:o.endDate),M=!c||!N||new Date(c)>=new Date(N),C=!c||!A||new Date(c)<=new Date(A),O=M&&C,k=!d||(E==null?void 0:E.validVenueIds.includes(d)),x=R&&D&&k&&O;return x||b.push(U),x}).sort(Rde)||[];return{...X,rounds:S,excludedRounds:b}}function GI(t){var B;let{matchUp:e,sideNumber:i,setNumber:r,isTiebreakValue:n,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:Hn};o=o||(e==null?void 0:e.matchUpFormat);let s=Ln(o),l=!!(e!=null&&e.winningSide),c=(B=e.score)==null?void 0:B.sets,u=c==null?void 0:c.length,d=r&&r-1,p=!!(c!=null&&c.find((V,G)=>V.setNumber===r&&G===d)),m=(c==null?void 0:c.filter(V=>V==null?void 0:V.winningSide))||[],h=(m==null?void 0:m.length)||0,f=r&&(c==null?void 0:c.slice(r))||[],g=!!(u&&r&&(f!=null&&f.reduce((V,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&V,!0))),v=r<=u&&c.find(V=>V.setNumber===r),I=v&&VI({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:y,sideGameScores:b,sideTiebreakScores:S}=I||{},w=!!(v&&!y&&g||r&&r===u+1&&!l),U=[1,2].includes(i),T=U?i-1:0,P=v&&U&&(!n&&!a&&b[T]!==void 0&&b[T]||n&&S[T]!==void 0&&S[T]),R=!!P,D=m==null?void 0:m.map(V=>VI({setObject:V,matchUpScoringFormat:s}).isValidSetOutcome).reduce((V,G)=>V&&G,!0),E=m.reduce((V,G)=>{let{winningSide:j}=G,H=j-1;return V[H]++,V},[0,0]),N=e==null?void 0:e.winningSide,A=N&&N-1,M=1-A,C=E[A],O=E[M],k=Math.max(...E),x=la(E)[k],{bestOf:F}=s??{},$=F&&Math.ceil(F/2)||1,_=k===$&&x===1&&E.indexOf(k)+1||void 0,L=C>O&&N===_;return{completedSetsHaveValidOutcomes:D,validMatchUpWinningSide:L,calculatedWinningSide:_,matchUpScoringFormat:s,validMatchUpOutcome:_&&D&&L,isLastSetWithValues:g,completedSetsCount:h,isCompletedMatchUp:l,isValidSideNumber:U,hasExistingValue:R,existingValue:P,isExistingSet:p,isActiveSet:w,...I}}function Tk({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:I,context:y,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:P,gender:R}=b??{},D={...y,...Ge({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:P,eventId:S,gender:R})},E;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:E}=nh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:I})),b&&h&&!u&&(u=Vu({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{..._g({context:D,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:I,event:b}),groupInfo:E}}var _6={};gt(_6,{getCompetitionVenues:()=>Rb,getCourts:()=>Dk,getVenuesAndCourts:()=>Hu,publicFindVenue:()=>jA});function Dk({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=ke(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:fe}}var $6={};gt($6,{categoryCanContain:()=>yb,getCategoryAgeDetails:()=>Cm,getEvent:()=>Ek,getEventProperties:()=>Pk,getEventStructures:()=>QT,getEventTimeItem:()=>Gy,getEvents:()=>Rk,getFlightProfile:()=>qi,getScaledEntries:()=>fh});function Pk({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:fe};if(!e)return{error:ni};let i=e.entries||[],r=t.participants||[],n=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(m=>m.participantId),s=r.filter(m=>o.includes(m.participantId)),l,c,u;return{entryScaleAttributes:s.map(m=>{var S,w,U,T,P,R;let{participantId:h,participantName:f,name:g}=m,v={scaleType:BA,eventType:a,scaleName:n},I=(w=(S=bl({participant:m,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:w.scaleValue;v={scaleType:Ez,eventType:a,scaleName:n};let y=(T=(U=bl({participant:m,scaleAttributes:v}))==null?void 0:U.scaleItem)==null?void 0:T.scaleValue;v={scaleType:Rz,eventType:a,scaleName:n};let b=(R=(P=bl({participant:m,scaleAttributes:v}))==null?void 0:P.scaleItem)==null?void 0:R.scaleValue;return l=!!(l||I),c=!!(c||y),u=!!(u||b),{participantId:h,participantName:f||g,seed:I,ranking:y,rating:b}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function Rk({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var u,d,p,m;if(!t)return{error:fe};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var v;let f=(v=h.drawDefinitions)==null?void 0:v.map(EI);if(a!=null&&a.length&&!Vi(a,f).length)return;let g=ke(h);return r&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),c={};if(e){let h=Gi({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,I)=>v+parseFloat(I),0);for(let g of l){let v=i??g.eventType,I=g.eventId;c[I]||(c[I]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let y=(g.entries??[]).filter(({entryStatus:R})=>zo.includes(R)).map(vt),b=R=>{var D,E,N,A,M,C;if((D=R==null?void 0:R.ratings)!=null&&D[v])for(let O of((E=R==null?void 0:R.ratings)==null?void 0:E[v])??[]){let k=O.scaleName;c[I].ratings[k]||(c[I].ratings[k]=[]);let x=(N=Dr[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&c[I].ratings[k].push(F)}}if((M=R==null?void 0:R.rankings)!=null&&M[v])for(let O of((C=R==null?void 0:R.rankings)==null?void 0:C[v])??[]){let k=O.scaleName;c[I].ranking[k]||(c[I].ranking[k]=[]),O.scaleValue&&c[I].ranking[k].push(O.scaleValue)}};for(let R of y){let D=(u=h==null?void 0:h[R])==null?void 0:u.participant;if((D==null?void 0:D.participantType)!==It)for(let E of(D==null?void 0:D.individualParticipantIds)??[]){let N=(d=h==null?void 0:h[E])==null?void 0:d.participant;b(N)}else b(D)}let S=c[I].ratings;for(let R of Object.keys(S)){let D=S[R];if(!D.length)continue;let E=(p=dB(D))==null?void 0:p.toFixed(2);c[I].ratingsStats[R]={avg:parseFloat((f(D)/D.length).toFixed(2)),median:E?parseFloat(E):void 0,max:Math.max(...D),min:Math.min(...D)}}let w=(R,D)=>{var N,A;let E=M=>{var C,O,k,x,F,$,_,L,B,V;if((C=c[I].draws)!=null&&C[R]&&((O=M==null?void 0:M.ratings)!=null&&O[v]))for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=c[I].draws[R])!=null&&x.ratings[j]||(c[I].draws[R].ratings[j]=[]);let H=(F=Dr[j])==null?void 0:F.accessor;if(H){let W=parseFloat(($=G.scaleValue)==null?void 0:$[H]);W&&c[I].draws[R].ratings[j].push(W)}}if((_=c[I].draws)!=null&&_[R]&&((L=M==null?void 0:M.rankings)!=null&&L[v]))for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=c[I].draws[R])!=null&&V.ranking[j]||(c[I].draws[R].ranking[j]=[]);let H=G.scaleValue;H&&c[I].draws[R].ranking[j].push(H)}};for(let M of D.filter(Boolean)){let C=(N=h==null?void 0:h[M])==null?void 0:N.participant;if((C==null?void 0:C.participantType)!==It)for(let O of(C==null?void 0:C.individualParticipantIds)??[]){let k=(A=h==null?void 0:h[O])==null?void 0:A.participant;E(k)}else E(C)}},U=[],T=R=>(a==null?void 0:a.length)&&a.includes(R)||U.includes(R);for(let R of g.drawDefinitions??[]){let D=R.drawId;if(T(D))continue;let E=fp({drawDefinition:R}).assignedParticipantIds??[];c[I].draws[D]||(c[I].draws[D]={ratingsStats:{},ratings:{},ranking:{}}),U.push(D),w(D,E)}let P=qi({event:g}).flightProfile;for(let R of(P==null?void 0:P.flights)??[]){let D=R.drawId;if(T(D))continue;let E=R.drawEntries.map(vt);w(D,E)}for(let R of U){let D=c[I].draws[R].ratings;for(let E of Object.keys(D)){let N=D[E];if(!N.length)continue;let A=(m=dB(N))==null?void 0:m.toFixed(2);c[I].draws[R].ratingsStats[E]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return Ge({eventScaleValues:c,events:l,...X})}function Ek({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var o;if(!t)return{error:fe};if(!r)return{error:ni};let n=ke(r);i&&Object.assign(n,i);let a=e&&((o=n.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return Ge({drawDefinition:a,event:n})}function Ede(t){var m,h;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:r}=Nde(t),n=Ade({...t,policyDefinitions:r,appliedPolicies:i}),a=Mde(t),o=Ode({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return Q({result:o,stack:e});let s=kde({...t,consideredEntries:a}),l=Cde({...t,appliedPolicies:i,policyDefinitions:r,drawSize:s});if(l.error)return Q({result:l,stack:e});let c=l.drawType;if(isNaN(s)&&c!==io)return Q({result:{error:Ry},stack:e});let u=(r==null?void 0:r[es])??(i==null?void 0:i[es]),d=t.seedingProfile??((h=(m=u==null?void 0:u.seedingProfile)==null?void 0:m.drawTypes)==null?void 0:h[c??""])??(u==null?void 0:u.seedingProfile);t.seedingProfile&&(r[es]||(r[es]={...i1[es]}),r[es].seedingProfile=d);let p=xde({...t,drawType:c});return p!=null&&p.error?Q({result:p,stack:e}):{drawSize:s,drawType:c,enforceGender:n,seedingProfile:d,appliedPolicies:i,policyDefinitions:r}}function Cde(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??Tb({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=kq({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function B6(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...zo,Jy].includes(e.entryStatus))}function Mde({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||B6(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Ae)}function Nde(t){let{tournamentRecord:e,event:i}=t,r=Nt({tournamentRecord:e,event:i}).appliedPolicies??{},n=ke(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function Ade({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[Pr])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[Pr])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function Ode(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&pD({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function kde(t){return!t.drawSize&&t.consideredEntries.length&&![io,_y,Ng,Ao,Fl].includes(t.drawType??"")&&Dg(t.consideredEntries.length)||t.drawSize&&Je(t.drawSize)||!1}function xde(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:r,drawType:n}=t,a=!r&&e&&wD({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(n)?{error:dN}:{...X}}function Ab(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Gi({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=B6(r==null?void 0:r.entries)??[],l=Ede({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return Q({result:l,stack:n});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=Oce({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return Q({result:v,stack:n});let{matchUpFormat:I,tieFormat:y}=v;if(t.drawId&&typeof t.drawId!="string")return Q({result:{error:le},stack:n});let b=lde({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:I,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:y,drawSize:d,drawType:p,event:r});if(b.error)return Q({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:P,entries:R}=b;if(!U)return Q({result:{error:le},stack:n});let D=ude({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:c,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:R,params:t,stack:n});if(D.error)return D;let{qualifyingConflicts:E}=D;return U.drawName=t.drawName??(p&&Hr(p)),d&&typeof e=="object"&&d>=4&&QA({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:E,positioningReports:w,drawDefinition:U,structureId:T,...X,conflicts:P}}function V6({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:ze,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Il,scaleName:n,scaleDate:o}],participantId:s}))}}function Fde({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=CD({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:le};let f=fh({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=V6({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var j6={};gt(j6,{addDrawEntries:()=>YA,addEventEntries:()=>wl,addEventEntryPairs:()=>q6,destroyPairEntries:()=>uW,destroyPairEntry:()=>ZA,getEntriesAndSeedsCount:()=>CD,getMaxEntryPosition:()=>mk,modifyEntriesStatus:()=>qS,modifyEventEntries:()=>Y6,mutate:()=>G6,promoteAlternate:()=>z6,promoteAlternates:()=>Mk,query:()=>k6,removeDrawEntries:()=>W6,removeEventEntries:()=>lb,setEntryPosition:()=>Ck,setEntryPositions:()=>H6});var G6={};gt(G6,{addDrawEntries:()=>YA,addEventEntries:()=>wl,addEventEntryPairs:()=>q6,destroyPairEntries:()=>uW,destroyPairEntry:()=>ZA,modifyEntriesStatus:()=>qS,modifyEventEntries:()=>Y6,promoteAlternate:()=>z6,promoteAlternates:()=>Mk,removeDrawEntries:()=>W6,removeEventEntries:()=>lb,setEntryPosition:()=>Ck,setEntryPositions:()=>H6});function Ck({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:fe};if(!i)return Q({result:{error:lr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:le,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===r&&c.participantId!==i&&(c.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=ls({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=ls({entries:e.entries}))),{...X}}function H6({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:fe};if(!Array.isArray(e))return{error:le};for(let n of e){let{participantId:a,entryPosition:o}=n,s=Ck({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=ls({entries:r.entries})),i!=null&&i.entries&&(i.entries=ls({entries:i.entries})),{...X}}function z6(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:le,participantId:e}:Mk({...t,participantIds:[e].filter(Boolean)})}function Mk({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Ae,eventId:a,event:o}){if(!t)return{error:fe};if(!Array.isArray(i))return{error:le,participantIds:i};if(!o)return{error:ni};let s="promoteAlternates";if(o){let l=QB({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=QB({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?Q({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...X},stack:s}):l}return{...X}}function QB({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===To),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:EG};let l=s.filter(({entryStatus:d})=>d!==To);if(l.length)return{error:IC,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==r);if(c.length)return{error:_re,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:$re,invalidStageSequence:u};for(let d of s){d.entryStatus=ua;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===To&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===ua&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Je(h||0)),0);d.entryPosition=m||0}return{...X}}function W6({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var u;if(!a)return{error:ni};if(!r)return{error:Ds};if(!(e!=null&&e.length))return{error:Hc};let o=fp({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(bn(o,e))return{error:Ug};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=qi({event:a}),c=(u=l==null?void 0:l.flights)==null?void 0:u.find(d=>d.drawId===r);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(s),t&&(c.drawEntries=ls({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=ls({entries:i.entries}))),{...X}}function Ys(t){var f,g,v,I,y;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:r,disableNotice:n,pairOverride:a,participant:o}=t,s=t.tournamentId?(f=t.tournamentRecords)==null?void 0:f[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:fe};if(!o)return Q({result:{error:Km},stack:e});o.participantId||(o.participantId=Vt()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:c}=o;if(s.participants.reduce((b,S)=>S.participantId===l||b,!1))return{error:SG};let{participantType:u,participantRole:d}=o;if(!u||!Object.keys(Jv).includes(u))return{error:ms,participantType:u};if(!d)return{error:UG};let p=s.participants||[],m=p.filter(b=>b.participantType===It).map(b=>b.participantId);if(u!==It&&o.person)return{error:le,person:o.person};if(c&&!Array.isArray(c))return{error:le,individualParticipantIds:c};if(u===ot){if(o.person)return{error:le,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return Q({info:"PAIR must be 2 individualParticipantIds",result:{error:na},stack:e});{let w=p.filter(U=>U.participantType===It).map(U=>U.participantId);if(!Array.isArray(o.individualParticipantIds))return Q({result:{error:na},stack:e});if(!o.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return Q({result:{error:na},stack:e})}}else return Q({result:{error:Hc},stack:e});let b=p.filter(w=>w.participantType===ot).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=o.participantType===ot&&b.find(w=>Vi(w.individualParticipantIds,o.individualParticipantIds).length===2);if(S&&!i)return{...X,existingParticipant:!0,participant:r&&ke(S.participant)};if(!o.participantName){let w=p.filter(T=>{var P;return(P=o.individualParticipantIds)==null?void 0:P.includes(T.participantId)}),U=w.map(T=>{var P;return(P=T.person)==null?void 0:P.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),o.participantName=U}}else if(u===It){if(!((v=o.person)!=null&&v.standardFamilyName)||!((I=o.person)!=null&&I.standardGivenName))return{error:RG};if(!o.participantName){let b=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=b}}else if(u&&[Kt,Oa].includes(u)){if(c||(o.individualParticipantIds=[]),(y=o.individualParticipantIds)==null?void 0:y.length)for(let b of o.individualParticipantIds){if(typeof b!="string")return Q({result:{participantId:b,error:le},stack:e});if(!m.includes(b))return Q({result:{participantId:b,error:Li},stack:e})}}else return{error:ms};s.participants.push(o),n||lt({payload:{tournamentId:s.tournamentId,participants:[o]},topic:Pc});let h={participant:r&&ke(o),...X};return Ge(h)}function xo({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:fe};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Vt())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===It),l=a.filter(d=>d.participantType!==It),c=s.concat(...l),u=[];if(c.length){for(let p of c){let m=Ys({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&u.push(m.participant)}u.length&&lt({topic:Pc,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&ke(u),addedCount:u.length,...X};return o.length&&Object.assign(d,{notAdded:o,info:cT}),Ge(d)}else return{info:"No new participants to add",addedCount:0,...X}}function q6(t){let e=it(t,[{[Fn]:!0,[up]:!0}]);if(e.error)return e;let{allowDuplicateParticipantIdPairs:i,entryStatus:r=To,participantIdPairs:n=[],entryStage:a=Ae,tournamentRecord:o,drawDefinition:s,event:l,uuids:c}=t;if(l.eventType!==ri)return{error:Ml};let u=[],d=new Map;for(let b of o.participants??[]){let{participantType:S,participantId:w,person:U,individualParticipantIds:T}=b;S===It&&(U!=null&&U.sex)?d.set(w,U.sex):S===ot&&T&&u.push(T)}let p=n.filter(b=>{if(b.length!==2)return!0;if(!l.gender||l.gender===Is)return!1;if(!d.has(b[0])||!d.has(b[1]))return!0;let S=b.map(U=>d.get(U)),w=l.gender===ti&&(S[0]!==ti||S[1]!==ti)||l.gender===yi&&(S[0]!==yi||S[1]!==yi);return l.gender===Gn&&(S.sort(KT),(S[0]!==yi||S[1]!==ti)&&(w=!0)),w});if(p.length)return{error:na,invalidParticipantIdPairs:p};let m=n.map(b=>({participantId:(c==null?void 0:c.pop())??Vt(),participantRole:Gr,individualParticipantIds:b,participantType:ot})),h=i?m:m.filter(b=>!u.find(S=>Vi(S,b.individualParticipantIds).length===2)),f,g=[];if(h){let b=xo({allowDuplicateParticipantIdPairs:i,participants:h,returnParticipants:!0,tournamentRecord:o});if(b.error)return b;g=b.participants||[],f=b.info}let v=n.map(b=>{let S=g.find(U=>Vi(U.individualParticipantIds,b).length===2);if(S)return S;let{participant:w}=ko({tournamentRecord:o,participantIds:b});return w}).map(b=>b.participantId),I=wl({participantIds:v,tournamentRecord:o,drawDefinition:s,entryStatus:r,entryStage:a,event:l});h.length&&lt({payload:{participants:h},topic:Pc});let y=h.map(vt);return{...I,info:f,newParticipantIds:y}}function Y6({entryStatus:t=ua,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Ae,tournamentRecord:n,event:a}){if(!n)return{error:fe};if(!a)return{error:ni};let o=n.participants??[],s=o.filter(f=>f.participantType===It).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:na,invalidParticipantIds:l};let c=i.filter(f=>f.length!==2);if(c.length)return{error:na,invalidParticipantIdPairs:c};let u=o.filter(f=>f.participantType===ot).map(f=>f.individualParticipantIds),d=i.filter(f=>!u.find(g=>Vi(g,f).length===2)).map(f=>({participantType:ot,participantRole:Gr,individualParticipantIds:f})),p=xo({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=ko({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:Ho,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...X}}var K6={};gt(K6,{addDrawDefinition:()=>Ob,addEvent:()=>kb,addFlight:()=>LD,assignSeedPositions:()=>n4,attachFlightProfile:()=>Lk,categoryCanContain:()=>yb,deleteDrawDefinitions:()=>kD,deleteEvents:()=>o4,deleteFlightAndFlightDraw:()=>i4,deleteFlightProfileAndFlightDraws:()=>Q6,getCategoryAgeDetails:()=>Cm,getEvent:()=>Ek,getEventProperties:()=>Pk,getEventStructures:()=>QT,getEventTimeItem:()=>Gy,getEvents:()=>Rk,getFlightProfile:()=>qi,getScaledEntries:()=>fh,modifyEvent:()=>s4,modifyEventMatchUpFormatTiming:()=>e4,modifyPairAssignment:()=>r4,mutate:()=>J6,query:()=>$6,refreshEventDrawOrder:()=>Fk,removeEventMatchUpFormatTiming:()=>xD,removeScaleValues:()=>_k,removeSeeding:()=>a4,setEventDates:()=>kk,setEventDisplay:()=>FD,setEventEndDate:()=>Ok,setEventStartDate:()=>Ak,updateDrawIdsOrder:()=>xk,validateCategory:()=>_I});var J6={};gt(J6,{addDrawDefinition:()=>Ob,addEvent:()=>kb,addFlight:()=>LD,assignSeedPositions:()=>n4,attachFlightProfile:()=>Lk,deleteDrawDefinitions:()=>kD,deleteEvents:()=>o4,deleteFlightAndFlightDraw:()=>i4,deleteFlightProfileAndFlightDraws:()=>Q6,modifyEvent:()=>s4,modifyEventMatchUpFormatTiming:()=>e4,modifyPairAssignment:()=>r4,refreshEventDrawOrder:()=>Fk,removeEventMatchUpFormatTiming:()=>xD,removeScaleValues:()=>_k,removeSeeding:()=>a4,setEventDates:()=>kk,setEventDisplay:()=>FD,setEventEndDate:()=>Ok,setEventStartDate:()=>Ak,updateDrawIdsOrder:()=>xk,validateCategory:()=>_I});function Wg({removePriorValues:t=!0,status:e=ka,statusObject:i,event:r}){if(!Ut(i))return{error:le};let n=co({event:r,status:e}),a=`${Jc}.${Xc}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return hh({timeItem:o,removePriorValues:t,event:r})}function qg(t){var S,w,U,T,P,R,D;let e=it(t,[{[Fn]:!0,[up]:!0},{eventDataParams:!1,[so]:Sa}]);if(e.error)return e;let{includePositionAssignments:i,removePriorValues:r,tournamentRecord:n,status:a=ka,event:o,drawIdsToRemove:s,drawIdsToAdd:l}=t,{appliedPolicies:c}=Nt({tournamentRecord:n,event:o}),u={...c,...t.policyDefinitions},d=((S=o==null?void 0:o.drawDefinitions)==null?void 0:S.map(({drawId:E})=>E))??[],p=t.drawDetails?Object.keys(t.drawDetails):[],m=p.length?[]:t.drawIds,h=(l??[]).concat(...s??[],...m??[],...p),f=h.filter(E=>!d.includes(E));if(f.length)return Q({result:{error:Pa},context:{invalidDrawIds:f}});let g=co({event:o,status:a}),v=Object.keys((g==null?void 0:g.drawDetails)||{}).filter(E=>d.includes(E)).reduce((E,N)=>(E[N]=g.drawDetails[N],E),{});for(let E of d)if((!h.length||h.includes(E))&&(s!=null&&s.includes(E)||m!=null&&m.length&&!m.includes(E)?v[E]={...v[E],publishingDetail:{published:!1}}:(l!=null&&l.includes(E)||m!=null&&m.includes(E)||!(m!=null&&m.length))&&(v[E]={...v[E],publishingDetail:{published:!0}})),(w=t.drawDetails)==null?void 0:w[E]){let N=t.drawDetails[E],A=N.structureDetails??v[E].structureDetails,M=N.stageDetails??v[E].stageDetails??{},{structureIdsToRemove:C=[],structureIdsToAdd:O=[],publishingDetail:k={},stagesToRemove:x=[],stagesToAdd:F=[]}=N;if((O||F)&&(k.published=!0),v[E]={publishingDetail:k,structureDetails:A,stageDetails:M},O.length||C.length){let _=(((T=(U=o==null?void 0:o.drawDefinitions)==null?void 0:U.find(B=>B.drawId===E))==null?void 0:T.structures)??[]).map(({structureId:B})=>B),L=(O??[]).concat(C??[]).filter(B=>!_.includes(B));if(L.length)return Q({result:{error:Ti},context:{invalidStructureIds:L}});A=A??{};for(let B of _)C.includes(B)?A[B]={published:!1}:A[B]={published:!0};v[E].structureDetails=A}let $=(((R=(P=o==null?void 0:o.drawDefinitions)==null?void 0:P.find(_=>_.drawId===E))==null?void 0:R.structures)??[]).map(({stage:_})=>_);if(F.length){for(let _ of F)M[_]={published:!0};for(let _ of $)M[_]||(M[_]={published:!1})}if(F.length||x.length){for(let _ of x)M[_]={published:!1};for(let _ of $)M[_]||(M[_]={published:!0})}(F.length||x.length)&&(v[E].stageDetails=M)}Wg({statusObject:{drawDetails:v},removePriorValues:r,status:a,event:o});let{topics:I}=Vo(),y=I.includes(EC),b=y||t.returnEventData?(D=DD({includePositionAssignments:i,...t.eventDataParams,usePublishState:!0,tournamentRecord:n,policyDefinitions:u,event:o}))==null?void 0:D.eventData:void 0;return y&&lt({payload:{eventData:b,tournamentId:n.tournamentId},topic:EC}),{...X,eventData:b}}var X6="deleteDrawDefinitions",Z6="autoSchedulingAudit",n1="deleteEvents",Lde={AUTO_SCHEDULING_AUDIT:Z6,DELETE_EVENTS:n1,DELETE_DRAW_DEFINITIONS:X6};function kD(t){var T,P,R;if(!t.tournamentRecord)return{error:fe};let e="deleteDrawDefinitions",i=t.drawIds??[],r=t.event,{autoPublish:n=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:c}=Nt({tournamentRecord:a,event:r}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!r){let D=An({tournamentRecord:a,eventId:s,drawId:d});if(D.error)return D;r=D.event}let p=[],m=[],h=[];if(!(r!=null&&r.drawDefinitions))return Q({info:"event has no drawDefinition",result:{...X},stack:e});let f=r.drawDefinitions.map(({drawId:D})=>D);if(i.length||(i=f),i=i.filter(D=>f.includes(D)),!i.length)return Q({info:"nothing to do; no matching drawIds in event.",result:{...X},stack:e});let g=ke(qi({event:r}).flightProfile,!1,!0),v=({participantId:D,drawPosition:E,qualifier:N,bye:A})=>({bye:A,qualifier:N,drawPosition:E,participantId:D}),I=l??((P=(T=c==null?void 0:c[gs])==null?void 0:T.allowDeletionWithScoresPresent)==null?void 0:P.drawDefinitions),y=co({event:r})??{},b=y.drawIds??(y.drawDetails&&Object.keys(y.drawDetails))??[],S,w=[],U=r.drawDefinitions.filter(D=>{var E,N,A,M,C,O,k,x;if(i.includes(D.drawId)){let F=((E=vn({event:r,drawDefinition:D}))==null?void 0:E.matchUps)??[];if(F.some(({score:Y})=>gr({score:Y}))&&!I)return w.push(D.drawId),!0;let{drawId:$,drawType:_,drawName:L}=D,B=(N=g==null?void 0:g.flights)==null?void 0:N.find(Y=>Y.drawId===D.drawId);B&&(B.drawEntries=(A=B.drawEntries)==null?void 0:A.filter(Y=>zo.includes(Y.entryStatus))),b.includes($)&&(b=b.filter(Y=>Y!==$),S=!0);let V=(C=(M=Oo({stageSequence:1,drawDefinition:D,stage:Ae}))==null?void 0:M.structures)==null?void 0:C[0],G=(k=(O=V?$I({structureId:V.structureId,tournamentRecord:a,drawDefinition:D}):void 0)==null?void 0:O.positionAssignments)==null?void 0:k.map(v),j=(x=Oo({stage:We,drawDefinition:D}))==null?void 0:x.structures,H=j!=null&&j.length?j.map(Y=>{var re;let q=Y.stageSequence;return{positionAssignments:(re=$I({structureId:Y.structureId,tournamentRecord:a,drawDefinition:D}))==null?void 0:re.positionAssignments.map(v),stageSequence:q}}):void 0,W={action:X6,payload:{drawDefinitions:[D],eventId:s??(r==null?void 0:r.eventId),auditData:o}};h.push(W),p.push(Ge({tournamentId:a.tournamentId,eventId:s??(r==null?void 0:r.eventId),qualifyingPositionAssignments:H,positionAssignments:G,auditData:o,drawType:_,drawName:L,drawId:$})),F==null||F.forEach(({matchUpId:Y})=>m.push(Y))}return!i.includes(D.drawId)});if(w.length&&!l)return Q({context:{drawIdsWithScoresPresent:w},result:{error:gT},stack:e});if(r.drawDefinitions=U,g&&qc({event:r,extension:{name:No,value:g}}),Cb({tournamentRecord:a}),S){let D={};for(let N of b)D[N]=((R=y.drawDetails)==null?void 0:R[N])??{published:!0};let E=Wg({statusObject:{drawDetails:D},event:r});if(E.error)return{error:E.error}}if(h.length&&lt({topic:Nf,payload:h}),m.length&&$u({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:m}),i.forEach(D=>Eae({drawId:D})),_de({appliedPolicies:c,event:r,deletedDrawsDetail:p,auditData:o}),n&&S){let D=qg({...t.eventDataParams,drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:r});if(D.error)return{...X,info:D.error}}return{...X}}function _de({appliedPolicies:t,event:e,deletedDrawsDetail:i,auditData:r}){var s;if(((s=t==null?void 0:t.audit)==null?void 0:s[qv])===!1)return;let{extension:n}=dt({name:qv,element:e}),a={...r,deletedDrawsDetail:i},o={value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(a):[a],name:qv};Ct({element:e,extension:o})}function Q6({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var o;if(!e)return{error:fe};if(!r)return{error:ni};let{flightProfile:a}=qi({event:r});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:c})=>c).filter(Boolean),l=kD({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:TT({event:r,name:No})}return{...X}}function Nk(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Di};let s=Object.keys(o).filter(c=>!n||n===c);if(n&&!s.includes(n))return{error:le};let l;for(let c of s){let u=o[c],{event:d}=An({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=$de({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...X}:{error:sa}}function $de({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:fe};if(r&&!Array.isArray(r))return{error:le};if(e&&!Array.isArray(e))return{error:le};let a=fu;if(n){let{extension:o}=dt({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=e2({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Ct({element:n,extension:{name:a,value:l}})}else{let{extension:o}=dt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=e2({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Ct({extension:{name:a,value:l},element:t})}return{...X}}function e2(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function e4(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:fe};if(!da({matchUpFormat:n}))return{error:le};if(!s)return{error:ni};let{averageTimes:l=[],recoveryTimes:c=[]}=MD({tournamentRecord:e,matchUpFormat:n,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=y=>{var b,S;if((b=y.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=y.categoryNames)!=null&&S.includes(d)&&(y.categoryNames=y.categoryNames.filter(w=>w!==d),p={minutes:y.minutes,categoryNames:[d]},!y.categoryNames.length)))return y},f=r&&!isNaN(Je(r)),g=i&&!isNaN(Je(i)),v=l.map(h).filter(y=>{var b;return(b=y==null?void 0:y.categoryNames)==null?void 0:b.length}),I=c.map(h).filter(y=>{var b;return(b=y==null?void 0:y.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||vi]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||vi]:i}),I.push(m)),!f&&!g?{error:le}:Nk({averageTimes:f&&v,recoveryTimes:g&&I,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function xD(t){if(t.event)return t2({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=it(t,[{[rn]:!0,[wH]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=An({tournamentRecord:n,eventId:r});if(a)return t2({event:a})}}return{error:sa}}function t2({event:t}){return TT({event:t,name:fu})}function Ak({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:fe};if(!e)return{error:ni};if(!Al.test(i))return{error:yn};let r=t4(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(ut(i)).getTime();if(!n||!a||o<n||o>a)return{error:yn};let s=e.endDate&&new Date(ut(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...X}}function Ok({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:fe};if(!e)return{error:ni};if(!Al.test(i))return{error:yn};let r=t4(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(ut(i)).getTime();if(!n||!a||o<n||o>a)return{error:yn};let s=e.startDate&&new Date(ut(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...X}}function kk({tournamentRecord:t,event:e,startDate:i,endDate:r}){if(!t)return{error:fe};if(!e)return{error:ni};if(!i&&!r)return{error:ze,info:"missing date"};if(i&&!Al.test(i))return{error:yn};if(r&&!Al.test(r))return{error:yn};if(i&&r){let n=new Date(ut(i)).getTime(),a=new Date(ut(r)).getTime();if(n>a)return{error:le}}if(i){let n=Ak({tournamentRecord:t,event:e,startDate:i});if(n.error)return n}if(r){let n=Ok({tournamentRecord:t,event:e,endDate:r});if(n.error)return n}return{...X}}function t4(t){let{startDate:e,endDate:i}=t;return!Al.test(e)||!Al.test(i)?Q({result:{error:IG},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(ut(e)).getTime(),tournamentEndDate:new Date(ut(i)).getTime()}}function xk({event:t,orderedDrawIdsMap:e}){var n,a;if(typeof t!="object")return{error:ni};if(!e)return{error:ze,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:le,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:le,info:"drawOrder must be numeric"};if(mt(i).length!==i.length)return{error:le,info:"drawOrder values must be unique"};if((n=t.drawDefinitions)!=null&&n.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Vi(o,s).length!==o.length)return{error:le,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:r}=qi({event:t});return(a=r==null?void 0:r.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...X}}function Fk({tournamentRecord:t,event:e}){var n;if(!t)return{error:fe};if(!e)return{error:ni};let{flightProfile:i}=qi({event:e}),r=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((n=e.drawDefinitions)==null?void 0:n.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?xk({event:e,orderedDrawIdsMap:r}):{...X}}function i4({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var s,l;if(!e)return{error:fe};if(!r)return{error:Ds};if(!n)return{error:ni};let{flightProfile:o}=qi({event:n});if(o&&((s=o.flights)!=null&&s.find(c=>c.drawId===r))){let c=o.flights.filter(d=>d.drawId!==r),u={name:No,value:{...o,flights:c}};qc({event:n,extension:u})}if((l=n.drawDefinitions)!=null&&l.find(c=>c.drawId===r)){let c=kD({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(c.error)return c}return Fk({tournamentRecord:e,event:n})}function r4({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:r,participantId:n,event:a,uuids:o}){var h,f;if(!a)return{error:ni};if((a==null?void 0:a.eventType)!==eo)return{error:Ml};if(o&&!Array.isArray(o))return{error:le};if(!i)return{error:fe};if(![t,e,n].every(g=>typeof g=="string"))return{error:lr};if(!(((h=a==null?void 0:a.entries)==null?void 0:h.filter(({entryStatus:g})=>[Ho,mp].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:ps};let s=(i.participants||[]).find(g=>g.participantId===n);if((s==null?void 0:s.participantType)!==ot)return{error:Ym,participant:s};let l=s.individualParticipantIds,c=[t,...l.filter(g=>g!==e)],{participant:u}=ko({participantIds:c,tournamentRecord:i}),d;if(u)d=u.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:Gr,individualParticipantIds:c,participantType:ot},v=Ys({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;d=v.participant.participantId}let{flightProfile:p}=qi({event:a});if(r){let g=(f=p==null?void 0:p.flights)==null?void 0:f.find(({drawId:v})=>v===r.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===n?{...v,participantId:d}:v)),r.entries=r.entries.map(v=>v.participantId===n?{...v,participantId:d}:v);for(let v of r.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(I=>I.participantId===n?{...I,participantId:d}:I);else if(v.structures)for(let I of v.structures)I.positionAssignments=I.positionAssignments.map(y=>y.participantId===n?{...y,participantId:d}:y)}a.entries=a.entries.map(g=>g.participantId===n&&{...g,participantId:d}||g.participantId===t&&{...g,participantId:e}||g);let m=i.events.some(({entries:g,eventId:v,drawDefinitions:I})=>a.eventId===v?I.some(({drawId:y,entries:b})=>y===(r==null?void 0:r.drawId)?!1:b==null?void 0:b.find(S=>S.participantId===n)):g==null?void 0:g.find(y=>y.participantId===n));if(!m){let g=ch({addIndividualParticipantsToEvents:!1,participantIds:[n],tournamentRecord:i});if(g.error)return g}return{...X,participantOtherEntries:m,newPairParticipantId:d}}function Ob(t){var E,N,A,M,C,O,k,x,F,$,_,L;let{flight:e,suppressNotifications:i,modifyEventEntries:r,existingDrawCount:n,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:c}=t;if(!l)return{error:xe};if(!c)return{error:ni};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:m}=c,h=0;if(n!==void 0&&n!==c.drawDefinitions.length)return{error:le,info:"drawDefintions count mismatch"};let{flightProfile:f}=qi({event:c}),g=e&&((E=f==null?void 0:f.flights)==null?void 0:E.find(B=>B.flightNumber===e.flightNumber)),v=(M=(A=(N=f==null?void 0:f.links)==null?void 0:N.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===u}))==null?void 0:A.source)==null?void 0:M.drawId;if(v&&!c.drawDefinitions.find(B=>B.drawId===v))return Q({result:{error:xe},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return Q({result:{error:Xp},info:{relevantFlight:g}});let I=p==null?void 0:p.every(({participantId:B,entryStatus:V})=>{let G=g==null?void 0:g.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),y=!o||m&&(p==null?void 0:p.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=m.find(H=>H.participantId===B&&(!H.entryStage||H.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(g&&!I)return Q({result:{error:Xp},context:{drawEntriesPresentInFlight:I,matchingEventEntries:y,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(r&&(p==null||p.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&zo.includes(B==null?void 0:B.entryStatus)){let V=m==null?void 0:m.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,h+=1)}})),m&&!y)return Q({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:y,eventEntries:m},error:Xp}});let b=((O=(C=f==null?void 0:f.flights)==null?void 0:C.map(({flightNumber:B})=>!isNaN(B)&&Je(B)))==null?void 0:O.filter(Boolean))||[],S=((k=c.drawDefinitions.map(({drawOrder:B})=>B&&Je(B)))==null?void 0:k.filter(Boolean))||[],w=Math.max(0,...S,...b)+1,U=(x=f==null?void 0:f.flights)==null?void 0:x.find(B=>B.drawId===u),T;if(U){U.drawName=l.drawName,T={name:No,value:{...f,flights:f.flights}};let B=U.flightNumber;B&&!S.includes(B)?w=B:U.flightNumber=w}else{let B=(f==null?void 0:f.flights)||[];B.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:u}),T={name:No,value:{...f||{},flights:B}}}qc({event:c,extension:T}),Object.assign(l,{drawOrder:w});let P=c.drawDefinitions.find(B=>B.drawId===u),R=s==null?void 0:s.tournamentId,D=c.eventId;if(P){if(!a)return{error:Kj};let B=(($=(F=vn({drawDefinition:P}))==null?void 0:F.matchUps)==null?void 0:$.map(br))??[],V=(_=vn({drawDefinition:l}))==null?void 0:_.matchUps;if(!i){B!=null&&B.length&&$u({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:R,eventId:D}),V!=null&&V.length&&Rc({matchUps:V,tournamentId:R,eventId:D}),c.drawDefinitions=c.drawDefinitions.map(j=>j.drawId===u?l:j);let G=(L=l.structures)==null?void 0:L.map(({structureId:j})=>j);ai({drawDefinition:l,tournamentId:R,structureIds:G,eventId:D})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:B}=vn({drawDefinition:l,event:c});B&&Rc({tournamentId:s==null?void 0:s.tournamentId,matchUps:B}),Vy({drawDefinition:l,tournamentId:R,eventId:D})}return{...X,modifiedEventEntryStatusCount:h}}function n4(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:fN};if(!r)return{error:fe};if(!l)return{error:Ds};let d=ro({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:I}=v;m&&I<=m&&(!i||h[I])&&(h[I]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==iH(g).length)return{error:Jj};for(let v of f){let I=Vg({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:c});if(I!=null&&I.error)return I;I!=null&&I.success&&u++}return u?{...X,modifications:u}:{error:Tg}}function Lk({deleteExisting:t,event:e,flightProfile:i}){var a;let r="attachFlightProfile";if(!i)return Q({result:{error:ze},stack:r});if(!e)return Q({result:{error:ni},stack:r});let{flightProfile:n}=qi({event:e});return n&&!t?Q({result:{error:kN},stack:r}):(a=e.drawDefinitions)!=null&&a.length?Q({result:{error:Wj},stack:r}):(qc({event:e,extension:{name:No,value:i}}),{flightProfile:ke(i,!1,!0),...X})}function Bde({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:fe};if(!i)return{error:Hc};if(!e)return{error:ze,info:"scaleAttributes required"};let{scaleType:r,eventType:n,scaleName:a}=e,o=[Pz,r,n,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==o))}),{...X}}function _k({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var c;if(!a)return{error:ni};if(r&&!Array.isArray(r))return Q({result:{error:le},info:Uu("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(n){let{flightProfile:u}=qi({event:a}),d=(c=u==null?void 0:u.flights)==null?void 0:c.find(p=>p.drawId===n);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!r||r.includes(u.entryStatus))).map(vt);return Bde({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function FD({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=ka,event:n}){if(!e)return Q({result:{error:fe}});if(!n)return Q({result:{error:ni}});if(!Ut(i))return Q({result:{error:ze}});if(Ut(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>Sre(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[o].scheduleDetails=l}}let a=Wg({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...X}}function a4({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var l,c;if(!t)return{error:fe};if(!a)return{error:ni};r=r||((l=a.category)==null?void 0:l.categoryName)||((c=a.category)==null?void 0:c.ageCategoryCode);let s={eventType:a.eventType,scaleType:Il,scaleName:r};return _k({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function o4({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:fe};if(!e.events)return{error:sa};if(!Array.isArray(i))return{error:ze,info:Uu("drawIds")};let r=[],n=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let u={action:n1,payload:{events:[s]}};r.push(u),n.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===eo?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Ho&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?o.push(...l):a.push(...l),!c}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return Cb({tournamentRecord:e}),r.length&&(lt({topic:Nf,payload:r}),mh({tournamentRecord:e,timeItem:{itemType:n1,itemValue:n}})),{...X}}function s4(t){let e=it(t,[{tournamentRecord:!0,eventId:!0,event:!0},{eventUpdates:!0,_ofType:Sa}]);if(e.error)return e;let{eventUpdates:i,event:r}=t,n="modifyEvent",a=Gde(t),o=Hde({enteredParticipants:a}),{enteredParticipantGenders:s,enteredParticipantTypes:l}=o,c=zde({enteredParticipantGenders:s,eventUpdates:i,stack:n});if(c.error)return c;let u=Wde({enteredParticipantTypes:l,eventUpdates:i,stack:n});if(u.error)return u;let d=Vde({...t,...o,enteredParticipants:a,stack:n});if(d.error)return d;let p=jde({...t,stack:n});return p.error?p:(i.eventType&&(r.eventType=i.eventType),i.eventName&&(r.eventName=i.eventName),i.gender&&(r.gender=i.gender),{...X})}function Vde(t){var r,n,a,o,s,l;let e=(r=t.eventUpdates)==null?void 0:r.category;if(!e)return{...X};let i=_I({category:e});if(i.error)return i;if(t.event.eventType===or){let c=((a=(n=t.event)==null?void 0:n.drawDefinitions)==null?void 0:a.map(p=>Ns(p)))??[],u=Ns(t.event),d=(((o=Kl(t))==null?void 0:o.matchUps)??[]).map(p=>Ns(p))??[];if(![u,...c,...d].filter(Boolean).every(p=>p.collectionDefinitions.every(m=>!m.category||yb({category:t.eventUpdates.category,childCategory:m.category}))))return Q({result:{error:bI},stack:t.stack})}if((s=t.enteredParticipants)!=null&&s.length){let c=t.eventUpdates.startDate||t.event.startDate||t.tournamentRecord.startDate,u=t.eventUpdates.endDate||t.event.endDate||t.tournamentRecord.endDate,d=t.enteredParticipants.map(h=>h.participantType===It?h:h.individualParticpants??[]).flat(),p=Cm({category:e,consideredDate:c}),m=Cm({category:e,consideredDate:u});if(p!=null&&p.ageMinDate||p!=null&&p.ageMaxDate||m!=null&&m.ageMinDate||m!=null&&m.ageMaxDate)for(let h of d){let f=(l=h.person)==null?void 0:l.birthDate;if(!f)return Q({result:{error:hG},stack:t.stack});let g=new Date(f).getTime();if(p.ageMinDate||p.ageMaxDate){let v=new Date(p.ageMinDate).getTime(),I=new Date(p.ageMaxDate).getTime();if(g<v||g>I)return Q({result:{error:vC},stack:t.stack})}if(m.ageMin||m.ageMax){let v=new Date(m.ageMinDate).getTime(),I=new Date(m.ageMaxDate).getTime();if(g<v||g>I)return Q({result:{error:vC},stack:t.stack})}}}return{...X}}function jde(t){let{tournamentRecord:e,eventUpdates:i,event:r,stack:n}=t;if(i.startDate||i.endDate){let a=kk({startDate:i.startDate,endDate:i.endDate,tournamentRecord:e,event:r});if(a.error)return Q({result:a,stack:n})}return{...X}}function Gde(t){var n;let{tournamentRecord:e,event:i}=t,r=((n=i==null?void 0:i.entries)==null?void 0:n.filter(({entryStatus:a})=>{let o=a;return[...zo,To].includes(o)}).map(({participantId:a})=>a))??[];return r?Gi({participantFilters:{participantIds:r},withIndividualParticipants:!0,tournamentRecord:e}).participants??[]:[]}function Hde({enteredParticipants:t}){let e=[],i=t.reduce((n,a)=>{var s,l;let o=(s=a.person)!=null&&s.sex?[a.person.sex]:((l=a.individualParticpants)==null?void 0:l.map(c=>{var u;return(u=c.person)==null?void 0:u.sex}))||[];return e.push(...o),n.includes(a.participantType)?n:n.concat(a.participantType)},[]),r=mt(e);return{enteredParticipantTypes:i,enteredParticipantGenders:r}}function zde({enteredParticipantGenders:t,eventUpdates:e,stack:i}){let r=!t.length||[Gn,Is].includes(e.gender??"")||t.length===1&&t[0]===e.gender;return e.gender&&!r?Q({context:{gender:e.gender,validGender:r},result:{error:Wv},stack:i}):{...X}}function Wde({enteredParticipantTypes:t,eventUpdates:e,stack:i}){let r=(t.includes(or)&&[or]||t.includes(It)&&[Gs]||t.includes(ot)&&[eo]||[eo,Gs,or]).includes(e.eventType??"");return e.eventType&&!r?Q({context:{participantType:e.eventType,validEventType:r},result:{error:Ml},stack:i}):{...X}}function LD({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var m,h,f;let o="addFlight";if(!n)return Q({result:{error:ni},stack:o});if(!i)return Q({result:{error:ze},stack:o});if(e!=null&&e.length){let g=(n.entries??[]).map(vt),v=e.map(vt);if(Vi(v,g).length!==v.length)return Q({result:{error:le},stack:o})}let s=(m=qi({event:n}))==null?void 0:m.flightProfile,l=((f=(h=s==null?void 0:s.flights)==null?void 0:h.map(({flightNumber:g})=>!isNaN(g)&&Je(g)))==null?void 0:f.filter(Boolean))||[],c=Math.max(0,...l)+1,u={drawId:r||Vt(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===u.drawId))return Q({result:{error:qG},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(u),p={name:No,value:{...s||{},flights:d}};return qc({event:n,extension:p})}var qde={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},Yde={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},Kde={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},Jde={COLLEGE_D3:qde,COLLEGE_DEFAULT:Yde,COLLEGE_JUCO:Kde,DOMINANT_DUO:H3,DOMINANT_DUO_MIXED:B3,LAVER_CUP:K3,TEAM_DOUBLES_3_AGGREGATION:x3,TIME_TENNIS_DUAL:V3,TIME_TENNIS_PRO_CIRCUIT:$3,USTA_BREWER_CUP:j3,USTA_OZAKI_CUP:G3,USTA_COLLEGE:z3,USTA_GOLD_TEAM_CHALLENGE:k3,USTA_INTERSECTIONAL:_3,USTA_LEVEL_1:W3,USTA_SECTION_BATTLE:L3,USTA_SOUTHERN_LEVEL_5:F3,USTA_TOC:J3,USTA_WTT_ITT:q3,USTA_ZONAL:Y3};function kb({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var s,l,c,u;if(!e)return{error:fe};if(e.events||(e.events=[]),!r)return{error:ni};let{startDate:n,endDate:a}=e;if(!i&&((s=r.entries)!=null&&s.length||(l=r.drawDefinitions)!=null&&l.length)){let d=Ge({drawDefinitions:!!((c=r.drawDefinitions)!=null&&c.length),entries:!!((u=r.entries)!=null&&u.length)});return{info:"entries/drawDefinitions cannot exist",error:le,context:d}}let o={eventType:wm,drawDefinitions:[],entries:[],startDate:n,endDate:a,...r};if(r.eventType===to){if(r.tieFormat){let d=qn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!Jde[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:le};let d=zd({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});o.tieFormat=d}}if(o.eventId||(o.eventId=Vt()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:aG};{let d=o;if(e.events.push(d),!t){let{topics:p}=Vo();if(p.includes(OT)){let m=Kl({event:r}).matchUps??[];Rc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:m})}for(let m of r.drawDefinitions||[])Vy({drawDefinition:m})}return{...X,event:o}}}var l4={};gt(l4,{drawMatic:()=>XO,garman:()=>m4,generateAdHocMatchUps:()=>mD,generateAdHocRounds:()=>JO,generateAndPopulatePlayoffStructures:()=>RO,generateCourts:()=>$k,generateDrawDefinition:()=>Ab,generateDrawMaticRound:()=>BO,generateDrawStructuresAndLinks:()=>LO,generateDrawTypeAndModifyDrawDefinition:()=>_O,generateFlightProfile:()=>Qde,generateLineUps:()=>p4,generateQualifyingStructure:()=>IO,generateSeedingScaleItems:()=>V6,generateVoluntaryConsolation:()=>jq,roundRobinGroups:()=>tse});var Xde="splitLevelBased",u4="splitWaterfall",c4="splitShuttle",Zde={SPLIT_LEVEL_BASED:Xde,SPLIT_WATERFALL:u4,SPLIT_SHUTTLE:c4};function Qde(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:ni};let h=p.entries??[],{flightProfile:f}=qi({event:p});if(f&&i&&!o)return{error:kN};let g=t.scaledEntries??fh({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(vt),I=fn(h.filter(({participantId:R})=>!v.includes(R)).filter(R=>(!m||!R.entryStage||R.entryStage===m)&&(!R.entryStatus||hp.includes(R.entryStatus)))),y=g.concat(...I),b=y.length,S=Math.ceil(b/c),w=Ar(y,S);u===u4?w=wC(y,c):u===c4&&(w=wC(y,c,!0));function U(R){return(R||[]).map(({participantId:D,scaleValue:E})=>{let N=h.find(A=>A.participantId===D);return N!=null&&N.scaleValue&&E&&(N.scaleValue=E),N}).sort((D,E)=>D.scaleValue-E.scaleValue).map((D,E)=>(D.scaleValue&&(D.seedNumber=E+1),D))}let T=Re(0,c).map(R=>{let D=R+1;return{flightNumber:D,drawId:(d==null?void 0:d.pop())??Vt(),drawEntries:U(w[R]),drawName:(l==null?void 0:l.length)&&l[R]||`${e} ${D}`}}),P={scaleAttributes:n,splitMethod:u,flights:T};if(i){let R=Lk({flightProfile:P,deleteExisting:o,event:p});return{splitEntries:Ra()&&w||void 0,...R}}else return{flightProfile:P,...X}}var epe="ASC",d4="ASC",tpe="DESC",a1="DESC",ipe={ASC:epe,ASCENDING:d4,DESC:tpe,DESCENDING:a1};function p4(t){var D,E,N,A,M;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:r,drawDefinition:n,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==to)return{error:Ml};if(!r)return{error:fe};if(!e&&!n)return{error:Pa};if(e=e??((D=un({drawDefinition:n,event:l}))==null?void 0:D.tieFormat),qn({tieFormat:e}).error)return{error:uu};if(typeof a!="object"&&!i)return{error:le,context:{scaleAccessor:a}};let c={},u=((n==null?void 0:n.entries)??(l==null?void 0:l.entries)??[]).filter(C=>(C==null?void 0:C.entryStatus)===ua).map(vt),{participants:d=[]}=Gi({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:r}),p=d.filter(({participantId:C})=>u.includes(C)),m=C=>C===Sc?"rankings":"ratings",h=((E=l==null?void 0:l.category)==null?void 0:E.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:f=h,scaleType:g=Sc,sortOrder:v,accessor:I}=a||{},y=m(g),b=(C,O)=>{var x,F,$;let k=(x=C[y])==null?void 0:x[O];if(!k&&i&&(k=(F=C[y])==null?void 0:F[Qp]),Array.isArray(k)){let _=($=k.find(L=>L.scaleName===f))==null?void 0:$.scaleValue;if(Mi(_))return _;if(I&&typeof _=="object")return _[I]}return 0},S=(C,O,k)=>{let x=v===a1?O:C,F=v===a1?C:O;return b(x,k)-b(F,k)},w=(C,O)=>S(C,O,Qp),U=(C,O)=>S(C,O,Fd),T=[],P=(e==null?void 0:e.collectionDefinitions)??[];for(let C of p){let O=((A=C.individualParticipants)==null?void 0:A.sort(w))??[],k=o?O:((M=C.individualParticipants)==null?void 0:M.sort(U))??[],x={};for(let $ of P){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=$i(Qp)(V);Re(0,B).forEach(H=>{let W=j?O:k??[],Y=H+1,q=[];Re(0,j?1:2).forEach(re=>{var z;let K=(z=W==null?void 0:W.find(te=>{var ie;let J=G&&([ti,yi].includes(G)&&G||G===Gn&&[ti,yi][re]);return(!J||J===((ie=te.person)==null?void 0:ie.sex))&&!_.includes(te.participantId)}))==null?void 0:z.participantId;K&&(q.push(K),_.push(K),x[K]||(x[K]=[]),x[K].push({collectionPosition:Y,collectionId:L}))}),j||T.push(q)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));c[C.participantId]=F}let R=[];for(let C of T){let{participant:O}=ko({tournamentParticipants:d,participantIds:C});if(!O){let k={individualParticipantIds:C,participantRole:Gr,participantType:ot};R.push(k)}}if(s){for(;R.length;)Ys({participant:R.pop(),tournamentRecord:r});Ct({element:n,extension:{name:hu,value:c}})}return{...X,lineUps:c,participantsToAdd:R}}function $k(t){if(!t)return{error:ze};let e=it(t,[{dates:!1,[ea]:o=>Array.isArray(o)&&o.every(aa)},{uuids:!1,[ea]:o=>Array.isArray(o)&&o.every(Ki)},{startTime:!1,endTime:!1,[ea]:ZN},{idPrefix:!1,namePrefix:!1,[ea]:Ki},{count:!0,[ea]:Mi}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Tf(i,r)||[],a=Re(1,t.count+1).map(o=>{var s,l;return Ge({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Vt(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...X,courts:a}}var m4={};gt(m4,{default:()=>ape,garman:()=>g4});function xb({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Ol(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Yg(t){let e=it(t,[{courtDate:!0,_ofType:Sa}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=Qi(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>FS(s.startTime).localeCompare(FS(l.startTime))).forEach(s=>{let l={startTime:mi(a.toISOString()),endTime:s.startTime};Qi(s.startTime)>a&&n.push(l),Qi(s.endTime)>a&&(a=Qi(s.endTime))});let o={startTime:mi(a.toISOString()),endTime:r.endTime};return Qi(r.endTime)>a&&n.push(o),{timeSlots:n}}function rpe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var l;let{timeSlots:s}=Yg({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=Qi(o.startTime),l=Qi(o.endTime);return s>i||l<r?!1:Oy(i,l)>=t}return{enoughTime:n}}function h4(t){let e=it(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Mn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=Qi(n),l=QN(s,i),{enoughTime:c}=rpe({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=xb({date:a,court:u});return!!(d&&c(d))}))||[]).length,...X}}function _D(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:r=30,scheduleDate:n,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:le,courts:a};if(!Array.isArray(o))return{error:NS};if(!aa(n))return{error:yn};i&&(Array.isArray(i)?i.includes(n)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),c=a.map((m,h)=>{let{courtId:f,courtName:g}=m,v=s[f]||[],I=xb({date:n,court:m})||{},{bookings:y=[],startTime:b,endTime:S,date:w}=I,U=[e[h]&&{startTime:b,endTime:e[h]},...ke(y,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});l.sort((m,h)=>Dt(m.startTime)-Dt(h.startTime));let u=()=>c.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Yg({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),d=[];for(let m of l){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:I}=m,y=Dt(h),b=Dt(f),S=u().reduce((w,{courtId:U,courtName:T,timeSlots:P})=>{let R;return P.find(({startTime:D,endTime:E})=>{R=Dt(D)-y;let N=y>=Dt(D);return b<=Dt(E)&&w.startDifference!==0&&((R===0||R+r>=0)&&(w.startDifference===void 0||R<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:R}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:I,startTime:h,endTime:f};d.push(w),(p=c.find(({courtId:U})=>U===S.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:c.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:d}}function $D({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function f4(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Re(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function $f({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=xb({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&Dt(l)<Dt(a)||i&&Dt(l)>Dt(a))?l:a},void 0)}function npe({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||$f({courts:r,scheduleDate:n,startTime:!0}),i=i||$f({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=Qi(e),s=Qi(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let c=xb({court:l,date:n}),{timeSlots:u}=Yg({courtDate:c});u==null||u.forEach(d=>{let p=Qi(d.startTime),m=Qi(d.endTime);if(p>s||p<o||m<o)return!1;if(Oy(p,m)>=t){let h=mi(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function Bk(t){let e=it(t,[{courts:!0,_ofType:Mn}]);if(e.error)return e;let{date:i=XN(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||$D({averageMatchUpMinutes:c}),i=ut(i),r=mi(r),n=mi(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=f4({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:I}=_D({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:y}=npe({averageMinutes:c,courts:I,startTime:r,endTime:n,date:i});s&&y&&(r=y||r);let b=Dt(r),S=Dt(n)-b,w=Math.floor(S/a),U=Re(0,w+1).map(T=>{let P=b+T*a,R=Jne(P),D=h4({courts:I??[],averageMatchUpMinutes:c,periodStart:R,date:i});if(D.error)return{error:D.error};let{availableToScheduleCount:E=0}=D,N=E>h?E-h:0;v+=T?E:0;let A=T?v/T:E,M=a*A/c,C=T?M*(T-1)+A:A,O=E?h&&C-m||N:0;m=C,h=E,f+=O;let k=Je(f)-g;return g+=k,{periodStart:R,add:k,availableToScheduleCount:E,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,P)=>{let R=Re(0,P.add).map(()=>({scheduleTime:P.periodStart}));return T.concat(...R)},[]).flat(),timingProfile:U,totalMatchUps:g}}var g4={getCourtsAvailableAtPeriodStart:h4,generateTimeSlots:Yg,getScheduleTimes:Bk,courtGenerator:f4},ape=g4,v4={};gt(v4,{isValid:()=>da,isValidMatchUpFormat:()=>da,parse:()=>Ln,stringify:()=>oD});var I4={};gt(I4,{allCompetitionMatchUps:()=>ys,allDrawMatchUps:()=>vn,allEventMatchUps:()=>Kl,allTournamentMatchUps:()=>kr,analyzeMatchUp:()=>GI,applyLineUps:()=>B4,assignMatchUpSideParticipant:()=>b4,assignTieMatchUpParticipantId:()=>l0,bulkMatchUpStatusUpdate:()=>F4,calculateWinCriteria:()=>vh,checkInParticipant:()=>jk,checkMatchUpIsComplete:()=>Ed,checkOutParticipant:()=>Vk,competitionScheduleMatchUps:()=>Nb,disableTieAutoCalc:()=>O4,drawMatchUps:()=>Tk,enableTieAutoCalc:()=>M4,eventMatchUps:()=>ND,filterMatchUps:()=>ru,findMatchUp:()=>lk,getAllDrawMatchUps:()=>ur,getAllStructureMatchUps:()=>_t,getCheckedInParticipantIds:()=>oh,getCompetitionMatchUps:()=>jI,getEventMatchUpFormatTiming:()=>fk,getHomeParticipantId:()=>jT,getMatchUpCompetitiveProfile:()=>Zy,getMatchUpContextIds:()=>bk,getMatchUpDailyLimits:()=>OD,getMatchUpDailyLimitsUpdate:()=>gk,getMatchUpDependencies:()=>Wo,getMatchUpFormat:()=>wk,getMatchUpFormatTiming:()=>Qy,getMatchUpFormatTimingUpdate:()=>hk,getMatchUpScheduleDetails:()=>GT,getMatchUpType:()=>zT,getMatchUpsStats:()=>Uk,getModifiedMatchUpFormatTiming:()=>MD,getParticipantResults:()=>Ib,getPredictiveAccuracy:()=>yk,getRoundMatchUps:()=>wn,getRounds:()=>Sk,isValidMatchUpFormat:()=>da,matchUpActions:()=>dD,mutate:()=>y4,participantScheduledMatchUps:()=>vk,query:()=>x6,removeDelegatedOutcome:()=>N4,removeMatchUpSideParticipant:()=>zk,removeTieMatchUpParticipantId:()=>U4,replaceTieMatchUpParticipantId:()=>Hk,resetAdHocMatchUps:()=>_4,resetMatchUpLineUps:()=>Zk,resetScorecard:()=>ex,resetTieFormat:()=>Qk,setDelegatedOutcome:()=>L4,setMatchUpFormat:()=>k4,setMatchUpStatus:()=>Lb,setOrderOfFinish:()=>$4,substituteParticipant:()=>A4,tallyParticipantResults:()=>Gg,toggleParticipantCheckInState:()=>BD,tournamentMatchUps:()=>AD,updateTieMatchUpScore:()=>Gu,validMatchUp:()=>HT,validMatchUps:()=>uo});var y4={};gt(y4,{applyLineUps:()=>B4,assignMatchUpSideParticipant:()=>b4,assignTieMatchUpParticipantId:()=>l0,bulkMatchUpStatusUpdate:()=>F4,checkInParticipant:()=>jk,checkOutParticipant:()=>Vk,disableTieAutoCalc:()=>O4,enableTieAutoCalc:()=>M4,findMatchUp:()=>lk,removeDelegatedOutcome:()=>N4,removeMatchUpSideParticipant:()=>zk,removeTieMatchUpParticipantId:()=>U4,replaceTieMatchUpParticipantId:()=>Hk,resetAdHocMatchUps:()=>_4,resetMatchUpLineUps:()=>Zk,resetScorecard:()=>ex,resetTieFormat:()=>Qk,setDelegatedOutcome:()=>L4,setMatchUpFormat:()=>k4,setMatchUpStatus:()=>Lb,setOrderOfFinish:()=>$4,substituteParticipant:()=>A4,toggleParticipantCheckInState:()=>BD,updateTieMatchUpScore:()=>Gu});function b4({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var c,u;if(i&&typeof i!="string")return{error:ps};if(!e)return{error:xe};if(!n)return{error:pn};let o=r===void 0;if(o&&(r=1),![1,2].includes(r))return Q({result:{error:le,context:{sideNumber:r}}});let{matchUp:s,structure:l}=hi({drawDefinition:e,matchUpId:n,event:a});if(!s)return{error:tn};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==io)&&!((c=l==null?void 0:l.matchUps)!=null&&c.find(({roundPosition:d})=>!!d))))return{error:dN};if(!i&&((u=s==null?void 0:s.score)!=null&&u.scoreStringSide1||fr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[tr,mr].includes(s.matchUpStatus)))return{error:uT,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var m;let p=((m=s.sides)==null?void 0:m.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);St({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...X,sidesSwapped:o}}function pa({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=hi({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:tn};let c=Jl({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||St({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),c}function Vk(t){var I;let e=[{[Fn]:!0},{[ya]:!0},{[Nl]:!0},{[al]:!0}],i=it(t,e);if(i.error)return i;let r=zg(t,[{[Pg]:Yl,attr:{[bT]:!0}}]);if(r.error)return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(I=r==null?void 0:r.matchUp)==null?void 0:I.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&lA.includes(c)||c&&fr.includes(c)||gr({score:u}))return{error:Qj};let d=oh({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:m}=d??{};if(!(m!=null&&m.includes(o)))return{error:ps};if(!(p!=null&&p.includes(o)))return{error:PG};let h=Iz({matchUp:l});if(h!=null&&h.error)return h;let{sideParticipantIds:f,nestedIndividualParticipantIds:g}=h??{},v=f==null?void 0:f.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(y=>{pa({drawDefinition:a,matchUpId:s,timeItem:{itemType:HS,itemValue:y}})}),pa({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:HS}}),{...X,checkedOut:!0}}function jk(t){var p;let e=[{[Fn]:!0},{[ya]:!0},{[Nl]:!0},{[al]:!0}],i=it(t,e);if(i[vl])return i;let r=zg(t,[{[Pg]:Yl,attr:{[bT]:!0}}]);if(r[vl])return r;let{tournamentRecord:n,drawDefinition:a,participantId:o,matchUpId:s}=t,l=oh({matchUp:(p=r==null?void 0:r.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!(u!=null&&u.includes(o)))return{[vl]:ps};let d={...X,checkedIn:!0};return c!=null&&c.includes(o)||pa({tournamentRecord:n,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:GS}}),d}function BD(t){var c,u;let e=it(t,[{[Nl]:!0,[ya]:!0,[al]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,r=t.tournamentRecord??(i&&((c=t.tournamentRecords)==null?void 0:c[i]));if(!r)return{error:fe};let n=(u=zg(t,[{[Pg]:Yl,attr:{[bT]:!0},[vl]:tn}]).matchUp)==null?void 0:u.matchUp;if(!n)return{error:tn};let{checkedInParticipantIds:a=[]}=oh({matchUp:n}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?Vk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n}):jk({tournamentRecord:r,drawDefinition:l,participantId:o,matchUpId:s,matchUp:n})}function Gk({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var w,U;if(!t)return{error:fe};if(!e)return{error:Ds};if(!r)return{error:sa};let n=Jr({drawDefinition:e}),{matchUp:a}=hi({matchUpId:i,drawDefinition:e,matchUpsMap:n});if(!a)return{error:tn};let{matchUp:o,structure:s}=hi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:n,event:r});if(!o)return{error:tn};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=o;if(p&&!WT([vi,ri],p))return{error:zn};let{positionAssignments:m}=Qt({structure:s}),h=m==null?void 0:m.filter(T=>c==null?void 0:c.includes(T.drawPosition)),{matchUp:f}=hi({matchUpId:d,drawDefinition:e,matchUpsMap:n}),g=((w=f==null?void 0:f.sides)==null?void 0:w.map(vt))??[],v=(h==null?void 0:h.map(vt))??[],I=[...g,...v],{participants:y}=Gi({tournamentRecord:t,participantFilters:{participantTypes:[Kt],participantIds:I}}),{matchUp:b}=hi({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:n}),S=(U=un({matchUp:f,drawDefinition:e,structure:s,event:r}))==null?void 0:U.tieFormat;return{inContextDualMatchUp:b,inContextTieMatchUp:o,relevantAssignments:h,collectionPosition:l,teamParticipants:y,collectionId:u,matchUpType:p,dualMatchUp:f,tieMatchUp:a,tieFormat:S,structure:s,...X}}function Hk(t){var k,x,F,$,_,L,B,V,G,j,H,W,Y,q,re,K;let e=Gk(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:r,tournamentRecord:n,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!r||!a)return Q({result:{error:lr},stack:i});if(r===a)return{...X};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:m,tieMatchUp:h,tieFormat:f}=e,g=u==null?void 0:u.matchUpType,v=(k=u==null?void 0:u.sides)==null?void 0:k.find(z=>{var te,J,ie;return((te=z.participant)==null?void 0:te.participantId)===r||((ie=(J=z.participant)==null?void 0:J.individualParticipantIds)==null?void 0:ie.includes(r))});if(!v)return{error:Li};let I=((x=Gi({tournamentRecord:n,participantFilters:{participantIds:[r,a]}}))==null?void 0:x.participants)??[];if(I.length!==2)return Q({result:{error:lr},stack:i});if(I[0].participantType!==I[1].participantType)return Q({result:{error:ms},stack:i});let{appliedPolicies:y}=Nt({tournamentRecord:n,drawDefinition:o,event:l}),b=((F=t.policyDefinitions)==null?void 0:F[Pr])??(y==null?void 0:y[Pr])??Bg[Pr],S=I.find(({participantId:z})=>z===a);if((t.enforceGender??(($=b==null?void 0:b.participants)==null?void 0:$.enforceGender))!==!1&&[ti,yi].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((_=S==null?void 0:S.person)==null?void 0:_.sex))return{error:Ym,info:"Gender mismatch"};let w=(L=b==null?void 0:b.processCodes)==null?void 0:L.substitution;Ub({tournamentId:n.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:o,dualMatchUp:m});let U=(B=m==null?void 0:m.sides)==null?void 0:B.find(({sideNumber:z})=>z===v.sideNumber);if(!U)return Q({result:{sideNumber:v.sideNumber,existingParticipantId:r,error:Nr},stack:i});if((G=(V=u==null?void 0:u.sides)==null?void 0:V.flatMap(z=>{var te,J;return((te=z.participant)==null?void 0:te.individualParticipantIds)||((J=z.participant)==null?void 0:J.participantId)||[]}))!=null&&G.includes(a))return Q({result:{error:cT},stack:i});let T=(H=(j=c==null?void 0:c.sides)==null?void 0:j.find(({sideNumber:z})=>z===v.sideNumber))==null?void 0:H.participantId,P=U.lineUp,R=P==null?void 0:P.find(({participantId:z})=>a===z),D=P==null?void 0:P.reduce((z,te)=>te.substitutionOrder>z?te.substitutionOrder:z,0),E=(P==null?void 0:P.map(z=>{var J;let te=ke(z,!1,!0);if(![r,a].includes(te.participantId))return te;if(!s&&[r,a].includes(te.participantId)&&(te.collectionAssignments=(J=te.collectionAssignments)==null?void 0:J.filter(ie=>!(ie.collectionPosition===d&&ie.collectionId===p))),s&&r===te.participantId&&(te.collectionAssignments=te.collectionAssignments.map(ie=>ie.collectionPosition===d&&ie.collectionId===p&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:D}:ie)),te.participantId===a){te.collectionAssignments||(te.collectionAssignments=[]);let ie={collectionId:p,collectionPosition:d};s&&(ie.previousParticipantId=r,ie.substitutionOrder=(D??0)+1),te.collectionAssignments.push(ie)}return te}))??[];if(!R){let z={collectionId:p,collectionPosition:d};s&&(z.substitutionOrder=(D??0)+1,z.previousParticipantId=r);let te={collectionAssignments:[z],participantId:a};E.push(te)}let N=g===ri,{assignedParticipantIds:A}=zS({lineUp:P,collectionPosition:d,collectionId:p}),{assignedParticipantIds:M}=zS({lineUp:E,collectionPosition:d,collectionId:p});if(U.lineUp=E,T&&f){let z=ph({participantId:T,lineUp:E,drawDefinition:o,tieFormat:f});if(z.error)return Q({result:z,stack:i})}else console.log("team participantId not found");let C,O;if(N){let{tournamentRecord:z}=t,te=ko({participantIds:M,tournamentRecord:z});if(!te.participant){let ie=Ys({returnParticipant:!0,pairOverride:!0,tournamentRecord:z,participant:{participantRole:Gr,individualParticipantIds:M,participantType:ot}});if(ie.error)return Q({result:ie,stack:i});C=(W=ie.participant)==null?void 0:W.participantId}te=ko({participantIds:A,tournamentRecord:z});let J=(Y=te.participant)==null?void 0:Y.participantId;J&&ch({participantIds:[J],tournamentRecord:z}).success&&(O=J)}if(s||((q=v.substitutions)==null?void 0:q.length)===1){if(s)w&&h&&(h.processCodes=mt([...(h==null?void 0:h.processCodes)??[],...w]));else for(let z of w||[]){let te=(re=h==null?void 0:h.processCodes)==null?void 0:re.lastIndexOf(z);te!==void 0&&((K=h==null?void 0:h.processCodes)==null||K.splice(te,1))}h&&St({tournamentId:n==null?void 0:n.tournamentId,matchUp:h,context:i,drawDefinition:o})}return m&&St({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,context:i,drawDefinition:o}),{...X,modifiedLineUp:E,participantRemoved:O,participantAdded:C}}function w4({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var c;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:le};let o=(i==null?void 0:i.lineUp)||((c=Bd({participantId:e,drawDefinition:r}))==null?void 0:c.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(u=>{var p;if(!n.includes(u.participantId))return u;let d=(p=u.collectionAssignments)==null?void 0:p.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&s.push(m.previousParticipantId),l.push({participantId:u.participantId,...m})),!h});return{participantId:u.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function ope({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let r=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===or&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),n=s=>!t.includes(s.participantId);for(let s of r){s.entries=(s.entries||[]).filter(n);let{flightProfile:l}=qi({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(n)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(c=>{c.entries=(c.entries||[]).filter(n)})}return{...X}}function VD({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return Q({result:{error:fe},stack:n});if(!e||!t)return Q({result:{error:ze},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return Q({result:{error:Li},stack:n});if(o!=null&&o.participantType&&![Kt,Oa].includes(o.participantType))return Q({context:{participantType:o.participantType},result:{error:ms},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==It});if(s.length)return Q({result:{error:na,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&JT({individualParticipantIds:c,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));let{topics:u}=Vo();if(u.includes(qr)){let d=a.find(({participantId:p})=>p===e);lt({topic:qr,payload:{participants:[d]}})}return ope({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:ke(o,!1,!0),added:c.length,...X}}function jD(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:fe};if(!o)return{error:Km};if(!o.participantId)return Ys({tournamentRecord:n,participant:o});let{participant:s}=Kc({participantId:o.participantId,tournamentRecord:n});if(!s)return Ys({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:bG};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),u&&Ki(u)&&(v.participantOtherName=u),d&&Ki(d)&&(v.participantName=d),Array.isArray(c)){let{participants:I}=Gi({participantFilters:{participantTypes:[It]},tournamentRecord:n}),y=I==null?void 0:I.map(vt);if(y){let b=c.filter(S=>Ki(S)&&y.includes(S));([Oa,ci].includes(m||s.participantType)||m===ot&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===Jv.PAIR&&e&&(v.participantName=spe({individualParticipants:I,newValues:v}))}}return Object.keys(JA).includes(p)&&(v.participantRole=p),Object.keys(Jv).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===Jv.INDIVIDUAL&&g&&lpe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,Ge(v)),i&&VD({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),lt({topic:qr,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:ke(s),...X}}function spe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function lpe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,birthdate:c,tennisId:u,sex:d}=r;d&&Object.keys(qT).includes(d)&&(n.sex=d);let p;if(Ki(l)&&(n.personId=l),s&&Ki(s)&&(upe(s)||s==="")&&(n.nationalityCode=s),a&&typeof Ki(a)&&a.length>1&&(n.standardFamilyName=a,p=!0),o&&typeof Ki(o)&&o.length>1&&(n.standardGivenName=o,p=!0),p&&t){let m=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=m}c&&aa(c)&&(n.birthdate=c),u&&Ki(u)&&(n.tennisId=u),Object.assign(e.person,n)}function upe(t){return em.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function l0(t){var F,$,_,L,B,V,G,j,H,W,Y,q,re,K,z,te,J,ie,ne,ue;let e=Gk(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",r=t.teamParticipantId,{tournamentRecord:n,drawDefinition:a,participantId:o,event:s}=t;if(!o)return Q({result:{error:lr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return Q({result:{error:UN},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:m,matchUpType:h,dualMatchUp:f,tieFormat:g}=e;if(($=(F=c==null?void 0:c.sides)==null?void 0:F.flatMap(ae=>{var ce,pe;return((ce=ae.participant)==null?void 0:ce.individualParticipantIds)||((pe=ae.participant)==null?void 0:pe.participantId)||[]}))!=null&&$.includes(o))return Q({result:{...X},stack:i});r=r??(t.sideNumber?(L=(_=l==null?void 0:l.sides)==null?void 0:_.find(ae=>ae.sideNumber===t.sideNumber))==null?void 0:L.participantId:void 0);let v=(V=(B=Gi({participantFilters:{participantIds:[o]},tournamentRecord:n}))==null?void 0:B.participants)==null?void 0:V[0];if(!v)return Q({result:{error:Li},stack:i});let{appliedPolicies:I}=Nt({tournamentRecord:n,drawDefinition:a,event:s}),y=((G=t.policyDefinitions)==null?void 0:G[Pr])??(I==null?void 0:I[Pr])??Bg[Pr];if((t.enforceGender??((j=y==null?void 0:y.participants)==null?void 0:j.enforceGender))!==!1&&[ti,yi].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((H=v.person)==null?void 0:H.sex))return{error:Ym,info:"Gender mismatch"};let{individualParticipantIds:b,participantType:S}=v;if($i(vi)(h)&&S!==It)return{error:ms};let w=S===It?[o]:b,U=r&&(p==null?void 0:p.find(({participantId:ae})=>ae===r))||(p==null?void 0:p.find(({individualParticipantIds:ae})=>bn(w,ae)));if(!U)return{error:AN};if(r||(r=U.participantId),!r)return{error:Li};let T=(W=u==null?void 0:u.find(ae=>ae.participantId===(U==null?void 0:U.participantId)))==null?void 0:W.drawPosition,P=(q=(Y=f==null?void 0:f.sides)==null?void 0:Y.find(ae=>ae.participantId===r))==null?void 0:q.sideNumber,R=(K=(re=c==null?void 0:c.sides)==null?void 0:re.find(ae=>T&&ae.drawPosition===T))==null?void 0:K.sideNumber,D=P??R??t.sideNumber;if(!g)return{error:wg};if(!((z=g.collectionDefinitions)!=null&&z.find(ae=>ae.collectionId===m)))return{error:dG};Ub({tournamentId:n.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:f});let E=(te=f==null?void 0:f.sides)==null?void 0:te.find(ae=>ae.sideNumber===D),N=(J=c==null?void 0:c.sides)==null?void 0:J.find(ae=>ae.sideNumber===D),A=(ue=(ne=(E==null?void 0:E.lineUp)??((ie=Bd({participantId:r,drawDefinition:a}))==null?void 0:ie.lineUp))==null?void 0:ne.filter(ae=>{var ce;return(ce=ae.collectionAssignments)==null?void 0:ce.find(pe=>pe.collectionPosition===d&&pe.collectionId===m&&!pe.previousParticipantId)}))==null?void 0:ue.map(ae=>ae==null?void 0:ae.participantId),M=(A==null?void 0:A.length)>1&&A||(S===ot?v.individualParticipantIds:[o]),C=w4({collectionPosition:d,teamParticipantId:r,dualMatchUpSide:E,drawDefinition:a,participantIds:M,collectionId:m});if(C.error)return Q({result:C,stack:i});let{modifiedLineUp:O}=C,k;if(h===ri){if(S!==ot){let ae=wE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ae!=null&&ae.error)return Q({result:ae,stack:i});if(ae=x({side:N}),ae.error)return ae;k=ae.deletedParticipantId,E&&(E.lineUp=O),f&&St({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a})}else if(S===ot)for(let ae of M)wE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:ae,collectionId:m,tieFormat:g})}else{let ae=wE({collectionPosition:d,teamParticipantId:r,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:m,tieFormat:g});if(ae!=null&&ae.error)return ae}if(E&&(E.lineUp=O),f&&St({tournamentId:n==null?void 0:n.tournamentId,matchUp:f,context:i,drawDefinition:a}),k){let{error:ae}=ch({participantIds:[k],tournamentRecord:n});ae&&console.log("cleanup")}return{...X,modifiedLineUp:O};function x({side:ae}){let ce;if(ae.participant){let pe=ae.participant.individualParticipantIds||[];if(pe.filter(Boolean).length===1){let{participant:Se}=ko({participantIds:pe,tournamentRecord:n});pe.push(o);let{participant:Be}=ko({participantIds:pe,tournamentRecord:n});if(!Be&&Se){Se.individualParticipantIds=pe;let Pe=jD({pairOverride:!0,tournamentRecord:n,participant:Se});if(Pe.error)return Pe}else ce=Se==null?void 0:Se.participantId}}else{let pe=Ys({participant:{individualParticipantIds:[o],participantRole:Gr,participantType:ot},pairOverride:!0,tournamentRecord:n});if(pe.error)return pe}return{...X,deletedParticipantId:ce}}}function wE({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var u,d;let s=(u=Bd({participantId:e,drawDefinition:i}))==null?void 0:u.lineUp,l=(d=r||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===n),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let p={collectionAssignments:[c],participantId:n};r.push(p)}return ph({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function U4(t){var D,E,N,A,M,C,O,k,x,F,$,_,L,B,V,G,j,H,W,Y,q,re,K;let{tournamentRecord:e,drawDefinition:i,participantId:r,event:n}=t,a="removeTieMatchUpParticiapantId";if(!r)return Q({result:{error:lr},stack:a});let o=Gk(t);if(o.error)return o;let{appliedPolicies:s}=Nt({tournamentRecord:e,drawDefinition:i,event:n}),l=(N=(E=((D=t.policyDefinitions)==null?void 0:D[Pr])??(s==null?void 0:s[Pr])??Bg[Pr])==null?void 0:E.processCodes)==null?void 0:N.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:m,collectionId:h,matchUpType:f,dualMatchUp:g,tieMatchUp:v,tieFormat:I}=o;if(!g)return Q({result:{error:Hn},stack:a});let y=(A=u==null?void 0:u.sides)==null?void 0:A.find(z=>{var te,J,ie;return((te=z.participant)==null?void 0:te.participantId)===r||((ie=(J=z.participant)==null?void 0:J.individualParticipantIds)==null?void 0:ie.includes(r))});if(!y)return Q({result:{error:Li},stack:a});let b=((M=t.policyDefinitions)==null?void 0:M[gs])??(s==null?void 0:s[gs]);if(!((C=y.substitutions)!=null&&C.length)&&(gr({score:u==null?void 0:u.score})||u!=null&&u.winningSide)&&(b==null?void 0:b.requireParticipantsForScoring)!==!1)return Q({result:{error:YG},stack:a});let S=(k=(O=c==null?void 0:c.sides)==null?void 0:O.find(({sideNumber:z})=>z===y.sideNumber))==null?void 0:k.participantId;if(!S)return Q({result:{error:Li},stack:a});let w=(F=(x=Gi({participantFilters:{participantIds:[r]},tournamentRecord:e}))==null?void 0:x.participants)==null?void 0:F[0];if(!w)return Q({result:{error:Li},stack:a});if(f===vi&&w.participantType===ot)return Q({result:{error:Ym},stack:a});let U=w.participantType===It?[r]:w.individualParticipantIds;Ub({tournamentId:e.tournamentId,eventId:n.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let T=($=g.sides)==null?void 0:$.find(({sideNumber:z})=>z===y.sideNumber);if(!T&&(((_=g.sides)==null?void 0:_.filter(({lineUp:z})=>!z).length)||0)<2){let z=m==null?void 0:m.map(({participantId:te})=>{var J;return{drawPosition:(J=d==null?void 0:d.find(ie=>ie.participantId===te))==null?void 0:J.drawPosition,teamParticipantId:te}});T=(L=g.sides)==null?void 0:L.find(te=>{var J;return((J=z==null?void 0:z.find(({drawPosition:ie})=>ie===te.drawPosition))==null?void 0:J.teamParticipantId)===S})}if(!T)return Q({result:{error:Li,context:{participantId:r}}});let{modifiedLineUp:P,previousParticipantIds:R}=w4({collectionPosition:p,teamParticipantId:S,dualMatchUpSide:T,participantIds:U,drawDefinition:i,collectionId:h});if(T.lineUp=P,S&&I&&ph({participantId:S,lineUp:P,drawDefinition:i,tieFormat:I}),f===ri&&w.participantType===It){let z=(B=u==null?void 0:u.sides)==null?void 0:B.find(ie=>ie.sideNumber===(T==null?void 0:T.sideNumber)),{participantId:te}=z??{},J=te&&((G=(V=Gi({participantFilters:{participantIds:[te]},tournamentRecord:e,withDraws:!0}))==null?void 0:V.participants)==null?void 0:G[0]);if(J){let ie=((j=J==null?void 0:J.individualParticipantIds)==null?void 0:j.filter(ne=>ne!==r))??[];if(R&&ie.push(...R),ie.length>2)return Q({result:{error:na},stack:a});if((H=J.draws)!=null&&H.length){if(ie.length===1){let{participant:ne}=ko({participantIds:ie,tournamentRecord:e});if(!ne){let ue=Ys({participant:{participantRole:Gr,individualParticipantIds:ie,participantType:ot},pairOverride:!0,tournamentRecord:e});if(ue.error)return Q({result:ue,stack:a})}}}else if(ie.length){J.individualParticipantIds=ie;let ne=jD({participant:J,pairOverride:!0,tournamentRecord:e});if(ne.error)return Q({result:ne,stack:a})}else{let ne=ch({participantIds:[te],tournamentRecord:e});ne.error&&console.log("cleanup",{result:ne})}}else return Q({result:{error:Li},stack:a})}if(((W=y.substitutions)==null?void 0:W.length)===1&&!((re=(q=(Y=u==null?void 0:u.sides)==null?void 0:Y.find(z=>z.sideNumber!==y.sideNumber))==null?void 0:q.substitutions)!=null&&re.length)&&((K=v==null?void 0:v.processCodes)!=null&&K.length)){for(let z of l||[]){let te=v.processCodes.lastIndexOf(z);v.processCodes.splice(te,1)}St({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return St({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...X,modifiedLineUp:P}}function zk(t){var l,c;let e=it(t,[{[Fn]:!0,[ya]:!0,[al]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:r,matchUpId:n,event:a}=t;if(r&&![1,2].includes(r))return{error:le,sideNumber:r};let{matchUp:o,structure:s}=hi({drawDefinition:i,matchUpId:n,event:a});return o?Wn({structure:s})?((l=o.sides)==null||l.forEach(u=>{(!r||u.sideNumber===r)&&delete u.participantId}),St({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...X}):{error:dN}:{error:tn}}function cpe({matchUpStatuses:t=[xt,Lt,Rt],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var u;let n=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(u=n==null?void 0:n.drawPositions)==null?void 0:u.find(d=>d!==i),o=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=bn(o||[],t),c=bn(s||[],t);return{sourceMatchUp:n,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:c,loserMatchUpStatuses:s}}function dpe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=Qe({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===En)return{...X};c=c??Jr({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Rm({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=Qt({drawDefinition:a,structureId:o});for(let g of h??[])ppe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...X}}function ppe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var m,h,f;let d="removeSubsequentDrawPosition";if(s){let g=(h=(m=t.find(({matchUpId:I})=>c.matchUpId===I).sides)==null?void 0:m.find(I=>I.drawPosition===r))==null?void 0:h.sideNumber,v=(f=c.sides)==null?void 0:f.find(I=>I.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=p&&xt||[Rt,Lt].includes(c.matchUpStatus)&&c.matchUpStatus||ji,[Lt,Rt].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&gW({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),St({tournamentId:n==null?void 0:n.tournamentId,eventId:u==null?void 0:u.eventId,context:`${d}-${r}`,drawDefinition:o,matchUp:c}),{...X}}function Kg(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,m=Wn({structure:u}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:Py};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:I},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,byeMatchUp:S}}=l,w=Ls({...t,matchUpStatus:a||ji,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=Gu({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...X}}if(m)return{...X};let{matchUps:T}=_t({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:u}),{positionAssignments:P}=Ur({structure:u}),R=f-1,D=1-R,E=h[R],N=h[D],{winnerParticipantId:A,loserParticipantId:M}=(P==null?void 0:P.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===E&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&S4({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:E,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),y){let{winnerHadMatchUpStatus:O}=cpe({drawPositionMatchUps:C,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===xl;if(O&&k){let F=Math.min(...y.drawPositions);o1({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=mpe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:y,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);o1({sourceMatchUpId:c,targetLink:I,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...X,...U&&{tieMatchUpResult:U}}}function S4({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var f,g;let{structureId:p,roundNumber:m}=l,h="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:I}=Qe({drawDefinition:s,structureId:v});if(!I)return{error:Ti};let{positionAssignments:y}=Ur({structure:I});I.seedAssignments=(I.seedAssignments??[]).filter(P=>P.participantId!==r);let b=(f=y==null?void 0:y.find(P=>P.participantId===r))==null?void 0:f.drawPosition,{matchUps:S}=_t({drawDefinition:s,structure:I,event:d}),w=S.map(P=>P.drawPositions).flat(1/0).filter(Boolean),U=la(w);if((b?U[b]:void 0)===1)y==null||y.forEach(P=>{P.participantId===r&&delete P.participantId});else{let P=S.filter(({drawPositions:R})=>R.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:P,winnerTargetLink:a})}let T=(g=c==null?void 0:c.drawMatchUps)==null?void 0:g.find(({matchUpId:P})=>P===l.matchUpId);T&&St({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:h,drawDefinition:s})}return m&&dpe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:m,structureId:p}),{...X}}function mpe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:c}){var f,g,v;let u="removeDirectedLoser",d=r.target.structureId,{structure:p}=Qe({drawDefinition:a,structureId:d});if(!p)return{error:Ti};let{positionAssignments:m}=Ur({structure:p}),h=(f=m==null?void 0:m.find(I=>I.participantId===e))==null?void 0:f.drawPosition;if(m==null||m.forEach(I=>{I.participantId===e&&delete I.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(I=>I.participantId!==e),l){let I=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===h?U:S,void 0),y=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:S})=>S===o.matchUpId),b=(v=y==null?void 0:y.sides)==null?void 0:v[I];b&&(delete b.lineUp,St({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:y,context:u,drawDefinition:a}))}return{...X}}function o1({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId;return ab({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,drawPosition:r,structureId:s,event:o}),{...X}}function hpe(t){var l,c;let{matchUpFormat:e,score:i}=t,r=(l=i==null?void 0:i.sets)==null?void 0:l.length,n=e&&Ln(e),{setFormat:a,finalSetFormat:o,bestOf:s}=n??{};return((c=s&&r===s&&o||a)==null?void 0:c.timed)||!1}function fpe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var s;let n="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return Q({result:{error:bg},context:{matchUpStatus:xt},stack:n});let{positionAssignments:a}=Ur({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=r.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(r.matchUpStatus=xt,r.matchUpStatusCodes=[],St({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:r}),{...X}):Q({result:{error:cG},info:"matchUp does not include BYE",stack:n})}function tI(t){var f;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===En)return Q({result:{...X},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:m,loserTargetDrawPosition:h}=u;if(p&&p.matchUpStatus!==xt){let{loserTargetLink:g}=d;if((f=i==null?void 0:i.progression)!=null&&f.doubleExitPropagateBye){let v=T4({loserTargetDrawPosition:h,tournamentRecord:e,loserTargetLink:g,drawDefinition:r,loserMatchUp:p,matchUpsMap:n,event:s});if(v.error)return Q({result:v,stack:l})}else{let{feedRound:v,drawPositions:I,matchUpId:y}=p,b=v?2:2-I.indexOf(h),S=i2({...t,targetMatchUp:p,walkoverWinningSide:b,tournamentRecord:e,sourceMatchUp:c,matchUpId:y});if(S.error)return Q({result:S,stack:l})}}if(m){let g=i2({...t,matchUpId:m.matchUpId,targetMatchUp:m,tournamentRecord:e,sourceMatchUp:c});if(g.error)return Q({result:g,stack:l})}return Q({result:{...X},stack:l})}function i2(t){var V,G,j;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o}=t,s=r.structures.find(({structureId:H})=>H===a.structureId),l=t.matchUpStatus===mr?mr:tr,c=t.matchUpStatus===mr?Rt:Lt,u="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(H=>H.matchUpId===a.matchUpId);if(!d)return{error:Hn};let p=(n==null?void 0:n.drawPositions)||[],m=(V=d.drawPositions)==null?void 0:V.filter(Boolean),h=(n==null?void 0:n.structureId)===a.structureId;if(h&&bn(p,m)&&(m=m.filter(H=>!p.includes(H))),h&&m.length>1)return Q({result:{error:If},stack:u});let{pairedPreviousMatchUpIsDoubleExit:f,pairedPreviousMatchUp:g}=hW(t),v=Un({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:I,targetLinks:y}=v,{loserTargetDrawPosition:b,winnerMatchUp:S,loserMatchUp:w}=I;if(w){let{loserTargetLink:H}=y,W=T4({loserTargetDrawPosition:b,loserMatchUp:w,tournamentRecord:i,loserTargetLink:H,drawDefinition:r,matchUpsMap:o});if(W.error)return Q({result:W,stack:u})}let U=((G=d.drawPositions)==null?void 0:G.filter(Boolean))||[],T=U.length===1,P=t.walkoverWinningSide||T&&iS({drawPosition:U[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,R=[Lt,Rt].includes(d.matchUpStatus)&&!U.length,D=d.finishingRound===1,E=R&&!D?l:c,N=e.find(H=>H.matchUpId===g.matchUpId),A=[],M;n&&((n==null?void 0:n.structureId)===(N==null?void 0:N.structureId)?n.roundPosition<(g==null?void 0:g.roundPosition)?M=1:M=2:a.feedRound?n.structureId===a.structureId?M=2:M=1:P&&(M=3-P));let C=t.matchUpStatus,O=g==null?void 0:g.matchUpStatus;M===1?A=[{matchUpStatus:OU(C),previousMatchUpStatus:C,sideNumber:1},{matchUpStatus:OU(O),previousMatchUpStatus:O,sideNumber:2}]:M===2&&(A=[{matchUpStatus:OU(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:OU(C),previousMatchUpStatus:C,sideNumber:2}]),A.length&&(A=A.map(H=>Ge(H)));let k=Ls({...t,winningSide:P,matchUp:d,matchUpStatusCodes:A,context:u,matchUpStatus:E});if(k.error)return Q({result:k,stack:u});if(R)return tI({...t,matchUpStatus:E,targetData:v});if(!S)return Q({result:{...X},stack:u});let x=m.length===2?m[P-1]:m[0],{positionAssignments:F}=Qt({structure:s}),$=F==null?void 0:F.find(H=>H.drawPosition===x),_=o.drawMatchUps.find(H=>H.matchUpId===S.matchUpId),L=(j=_==null?void 0:_.drawPositions)==null?void 0:j.filter(Boolean),B=L.length===1;if(x){if($!=null&&$.bye){let H=Un({matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(B){let W=L.filter(Boolean)[0],Y=iS({drawPosition:W,matchUpId:_.matchUpId,inContextDrawMatchUps:e}),q=Ls({appliedPolicies:t.appliedPolicies,matchUpId:_.matchUpId,matchUp:_,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:r,winningSide:Y});return q.error?Q({result:q,stack:u}):WA({drawPositionToAdvance:W,matchUpId:_.matchUpId,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}else if([Lt,Rt].includes(S.matchUpStatus)){let W=tI({...t,matchUpId:_.matchUpId,matchUpStatus:E,targetData:H});if(W.error)return Q({result:W,stack:u})}return Q({result:{...X},stack:u})}return xf({matchUpId:S.matchUpId,drawPosition:x,inContextDrawMatchUps:e,drawDefinition:r})}else if(f){if(!_)return{error:Hn};if(B){let Y=L[0],q=iS({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:Y});console.log("existing drawPosition is winningSide",{walkoverWinningSide:q})}let H=[Lt,Rt].includes(_.matchUpStatus)?c:l,W=Ls({matchUpId:_.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:_,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:r,matchUpStatus:H});if(W.error)return Q({result:W,stack:u});if(H===l){let Y=tI({...t,matchUpId:a.matchUpId,matchUpStatus:H,targetData:v});if(Y.error)return Y}}return Q({result:{...X},stack:u})}function T4(t){var c;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:r,drawDefinition:n,matchUpsMap:a,event:o}=t,s=(c=r==null?void 0:r.target)==null?void 0:c.structureId,{structure:l}=Qe({drawDefinition:n,structureId:s});return l?xa({drawPosition:e,tournamentRecord:i,drawDefinition:n,structureId:s,matchUpsMap:a,event:o}):{error:Gc}}function OU(t){return t===tr?Lt:t===mr?Rt:t}function gpe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===xt,c=a.winningSide,u=[tr,mr].includes(r),d=rb({matchUpStatus:r}),p=xC({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||c&&d&&!u,f=c&&u,g=()=>Ls({...t,removeScore:[_u,Lt].includes(r),matchUpStatus:r||ji});return m&&{error:fC}||h&&s1(t)||f&&vpe(t)||c&&Kg(t)||p&&g()||l&&fpe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:fC}||u&&Ipe(t)||o&&s1(t)||Q({result:{error:bg},stack:s})}function vpe(t){let e=Kg(t);return e.error?e:tI(t)}function Ipe(t){let e=s1({...t,removeScore:!0});return e.error?e:tI(t)}function s1(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let a=Kg(t);if(a.error)return Q({result:a,stack:e})}let i=!!t.matchUp.collectionId,r=Ls({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=Gu({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return Q({result:l,stack:e});Object.assign(r,{tieMatchUpResult:l})}return Q({result:r,stack:e})}function ype({drawDefinition:t,structure:e,matchUp:i}){var l,c,u,d;let{drawPositions:r}=i,{positionAssignments:n}=Qt({drawDefinition:t,structure:e}),a=(l=n==null?void 0:n.filter(({drawPosition:p})=>r==null?void 0:r.includes(p)))==null?void 0:l.map(p=>{var h;let{extension:m}=dt({element:p,name:Dc});return(h=m==null?void 0:m.value)==null?void 0:h.groupOrder}),{containerStructures:o}=Og({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(u=(c=Lg({drawDefinition:t,structureId:s}))==null?void 0:c.links)==null?void 0:u.source)==null?void 0:d.filter(p=>{var m;return bn(a,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function D4({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===Ag&&Cc({drawDefinition:t,structure:e})){let{structureIds:n}=ype({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function bpe(t){var s,l,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===yo){let u=r.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:m})=>m===u));if((d==null?void 0:d.matchUpStatus)===ji){let p=Un({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Gd({inContextDrawMatchUps:i,drawDefinition:n,targetData:p})){let{structure:m}=Qe({structureId:d.structureId,drawDefinition:n}),h=Qt({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===u){let g=r.sides.find(({sideNumber:v})=>v===a).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(I=>({[I.drawPosition]:I.participantId})));for(let I of m.structures)(l=I.positionAssignments)==null||l.forEach(y=>y.participantId=v[y.drawPosition])}Ec({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:n,structure:m}),e=!0}}}}return{...X,qualifierReplaced:e}}function wpe(t){var s,l,c,u,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===yo){let p=(l=r.sides.find(({sideNumber:f})=>f===a))==null?void 0:l.participantId,m=i.filter(f=>f.structureId===o.target.structureId&&f.roundNumber===o.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=Zn(m);if((h==null?void 0:h.matchUpStatus)===ji){let f=Un({matchUpId:h.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Gd({inContextDrawMatchUps:i,drawDefinition:n,targetData:f})){let g=(c=h.sides.find(y=>y.qualifier&&!y.participantId))==null?void 0:c.drawPosition,{structure:v}=Qe({structureId:h.structureId,drawDefinition:n});if(!v)return{error:Ti};let I=Qt({structure:v}).positionAssignments;for(let y of I||[])if(y.drawPosition===g&&!y.participantId){if(y.participantId=p,v.positionAssignments)v.positionAssignments=I;else if(v.structures){let b=Object.assign({},...(I||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(u=S.positionAssignments)==null||u.forEach(w=>w.participantId=b[w.drawPosition])}Ec({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:n,structure:v}),e=!0}}}}return{...X,qualifierPlaced:e}}function Upe(t){var m,h;let e="attemptToSetWinningSide",i,{appliedPolicies:r,disableAutoCalc:n,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:c}=t;if(o!=null&&o._disableAutoCalc&&n!==!1)return DO(t);if(c.winningSide&&c.winningSide!==s){let{connectedStructureIds:f}=D4({drawDefinition:a,structure:l,matchUp:c});f.length&&(console.log({connectedStructureIds:f}),i=!0);let g=Kg(t);if(g.error)return g}let u=dq(t);if(u.error)return Q({result:u,stack:e});let d,p;return t.qualifierChanging&&((m=r==null?void 0:r[PI])!=null&&m.autoReplaceQualifiers)&&(d=bpe(t).qualifierReplaced),t.qualifierAdvancing&&((h=r==null?void 0:r[PI])!=null&&h.autoPlaceQualifiers)&&(p=wpe(t).qualifierPlaced),Q({result:Ge({...X,...u,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var sS={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function P4(t){var m;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:n,targetData:a,matchUp:o}=t,{iteration:s=0}=t;s+=1;let l="removeDoubleExit";Xa({method:l,color:"brightyellow",iteration:s,keyColors:sS});let{targetLinks:{loserTargetLink:c},targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p}}=a;if(d&&d.matchUpStatus!==xt){let{stage:h,roundNumber:f,roundPosition:g}=d;Xa({winner:"winner",stage:h,roundNumber:f,roundPosition:g,keyColors:sS}),r2({...t,targetMatchUp:d,sourceMatchUp:o,iteration:s})}if(u&&u.matchUpStatus!==xt){let h=e.find(({matchUpId:b})=>b===u.matchUpId),{structure:f}=Qe({drawDefinition:r,structureId:h.structureId}),{stage:g,roundNumber:v,roundPosition:I,feedRound:y}=u;if(Xa({loser:"loser",stage:g,roundNumber:v,roundPosition:I,keyColors:sS,feedRound:y}),(m=i==null?void 0:i.progression)==null?void 0:m.doubleExitPropagateBye)o1({drawPosition:p,targetLink:c,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:n});else{let b=r2({...t,structure:f,targetMatchUp:u,iteration:s});if(b.error)return Q({result:b,stack:l})}}return Q({result:{...X},stack:l})}function r2(t){var b,S,w,U,T,P;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,sourceMatchUp:n,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,c="conditionallyRemoveDrawPosition";Xa({method:c});let u=Un({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r}),{targetMatchUps:{winnerMatchUp:d}}=u,p=o==null?void 0:o.drawMatchUps.find(R=>R.matchUpId===a.matchUpId),m=[],h,f,g;if(a.feedRound)g=(S=(b=d==null?void 0:d.drawPositions)==null?void 0:b.filter(Boolean))==null?void 0:S.find(R=>a.drawPositions.includes(R));else if(!n)g=(w=Vi((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(f=(U=fW({structureId:s.structureId,matchUp:n,matchUpsMap:o}))==null?void 0:U.pairedPreviousMatchUp,h=[tr,mr].includes(f==null?void 0:f.matchUpStatus),m=((T=f==null?void 0:f.drawPositions)==null?void 0:T.filter(Boolean))||[],[...fr,xt].includes(f==null?void 0:f.matchUpStatus)||(f==null?void 0:f.winningSide)){let R=n.drawPositions||[],D=(P=a.drawPositions)==null?void 0:P.filter(Boolean);bn(R,D)&&(D=D==null?void 0:D.filter(E=>!R.includes(E))),g=R.concat(m).find(E=>D==null?void 0:D.includes(E))}if(d&&g){let{stage:R,roundNumber:D,roundPosition:E}=d;Xa({method:"removeDirectedWinner",drawPositionToRemove:g,keyColors:sS,color:"brightgreen",stage:R,roundNumber:D,roundPosition:E}),S4({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:r,matchUpsMap:o})}let v=P4({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:r,matchUpsMap:o,structure:s,iteration:l});if(v.error)return Q({result:v,stack:c});let I=Spe({pairedPreviousDoubleExit:h,noContextTargetMatchUp:p}),y=!h;return v=Ls({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:c,matchUpStatus:I,removeScore:y,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?Q({result:v,stack:c}):{...X}}function Spe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===xt?xt:t?[mr,Rt].includes(e==null?void 0:e.matchUpStatus)?Rt:Lt:ji}function Tpe(t){var o,s,l,c,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:r,drawDefinition:n}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===yo){let d=(l=(s=r.sides)==null?void 0:s.find(({sideNumber:m})=>m===r.winningSide))==null?void 0:l.participantId,p=i.find(m=>{var h;return m.structureId===a.target.structureId&&m.roundNumber===a.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===ji){let m=Un({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:n});if(!Gd({inContextDrawMatchUps:i,drawDefinition:n,targetData:m})){let{structure:h}=Qe({structureId:p.structureId,drawDefinition:n}),f=Qt({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(I=>({[I.drawPosition]:I.participantId})));for(let I of(h==null?void 0:h.structures)||[])(c=I.positionAssignments)==null||c.forEach(y=>y.participantId=v[y.drawPosition])}Ec({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:n,structure:h}),e=!0}}}}return{qualifierRemoved:e}}function Dpe(t){var f;let{matchUp:e,matchUpStatus:i,score:r,winningSide:n}=t,a="noDownStreamDependencies";if([tr,mr].includes(e==null?void 0:e.matchUpStatus)&&![tr,mr].includes(i)){let g=P4(t);if(g.error)return Q({result:g,stack:a})}let o=i===tr,s=gr({score:r})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!n),l=((f=t==null?void 0:t.inContextMatchUp)==null?void 0:f.collectionId)&&hpe(t.inContextMatchUp),c=t.removeScore||!l&&![vs,Ea].includes(i||vs),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!n&&!gr({score:r}),d=i&&i!==ji,p=g=>{var T,P;let v,{structure:I,drawDefinition:y,dualMatchUp:b,disableAutoCalc:S}=t;if(b!=null&&b._disableAutoCalc&&S!==!1)return DO(t);let{connectedStructureIds:w}=D4({drawDefinition:y,structure:I,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let U=Kg(t);if(U.error)return U;if(t.removingQualifier&&((P=(T=t.appliedPolicies)==null?void 0:T[PI])!=null&&P.autoRemoveQualifiers)){let R=Tpe(t);return{...X,connectedStructures:v,...R}}return{...X,connectedStructures:v}};if(u&&n&&t.isCollectionMatchUp)return n2(t);let m=[_u,Ea].includes(i)&&t.dualWinningSideChange,h=(n||m)&&Upe(t)||s&&p(c)||d&&gpe(t)||u&&p(c)||e&&n2({...t,removeScore:!0})||{...X};return Q({result:h,stack:a})}function n2(t){var r;let e="scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide){let n=Kg(t);if(n.error)return n}let i=Ls({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=Gu({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return Q({result:i,stack:e})}function Wk(t){var u,d,p;let e=it(t,[{[Fn]:!0,[ya]:!0,[al]:!0},{homeParticipantId:!0,[vl]:lr}]);if(e.error)return e;let i=zg(t,[{[Pg]:Yl,attr:{[bT]:!0}}]);if(i.error)return i;let r=(p=(d=(u=i==null?void 0:i.matchUp)==null?void 0:u.matchUp)==null?void 0:d.sides)==null?void 0:p.map(m=>m==null?void 0:m.participantId);if(t.homeParticipantId&&!(r!=null&&r.includes(t.homeParticipantId)))return{error:ps};let{disableNotice:n=!0,homeParticipantId:a,removePriorValues:o,tournamentRecord:s,drawDefinition:l,matchUpId:c}=t;return pa({duplicateValues:!1,removePriorValues:o,tournamentRecord:s,drawDefinition:l,disableNotice:n,matchUpId:c,timeItem:{itemType:yz,itemValue:a}})}function ed(t){var m;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return Q({result:{error:pn},stack:e});if(!Eg(s))return Q({result:{error:go},stack:e});if(!i){let h=hi({drawDefinition:a,matchUpId:l});if(h.error)return Q({result:h,stack:e});i=h.matchUp}let c=ut(s),u=_d({matchUp:i}).scheduledDate,d=c&&!u;if((m=VA({matchUp:i}).timeModifiers||[])!=null&&m.length){let h=R4({disableNotice:!0,removePriorValues:r,tournamentRecord:n,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(h!=null&&h.error)return Q({result:h,stack:e})}let p=Qm(s,!0,d);return pa({duplicateValues:!1,removePriorValues:r,tournamentRecord:n,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:Fg,itemValue:p}})}function R4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return Q({result:{error:pn},stack:s});if(n!==void 0&&!Array.isArray(n))return Q({info:Uu("timeModifiers"),result:{error:le},stack:s});if(!o){let d=hi({drawDefinition:i,matchUpId:a});if(d.error)return Q({result:d,stack:s});o=d.matchUp}let l=VA({matchUp:o}).timeModifiers||[],c=n.filter(d=>!l.includes(d));if(n.length&&!c.length)return{...X};if(c.some(d=>MC.includes(d))){l=l.filter(p=>!MC.includes(p));let d=ed({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return Q({result:d,stack:s})}let u=n!=null&&n.length?[...c,...l]:void 0;return pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:$A,itemValue:u}})}function GD({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:pn};let o=t&&Al.test(t);if(t&&!o)return{error:yn};let s={itemValue:ut(t),itemType:xg};return pa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function HD({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var u,d;if(!i&&!e)return{error:fe};if(!o)return{error:pn};let l=hi({drawDefinition:r,matchUpId:o});if(l.error)return l;if(((u=l==null?void 0:l.matchUp)==null?void 0:u.matchUpType)!==zs)return{error:zn};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:le,context:{courtIds:s}};let c;if(s){let p=e||i&&{[i.tournamentId]:i},m=Hu({tournamentRecords:p});if(m.error)return m;let h=(d=m.courts)==null?void 0:d.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:le,context:{courtIds:s}};c=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:bu,itemDate:a,itemValue:c}})}function Jg({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:fe};if(!a)return{error:pn};if(o){let s=ju({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:kg,itemValue:o}})}function Ih({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:fe};if(!o)return{error:pn};if(s){let c=sh({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;Jg({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:u})}return pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Ld,itemDate:a,itemValue:s}})}function Os(t,e){let i=DH.test(t)?t:mi(t),r=ut(t)||ut(e)||os(new Date);return new Date(`${r}T${i}`).getTime()}function zD(t){var M;let e="addMatchUpScheduleItems",i=it(t,[{drawDefinition:!0,matchUpId:!0},{schedule:!0,[so]:Sa}],e);if(i.error)return i;let{matchUpDependencies:r,inContextMatchUps:n}=t,{errorOnAnachronism:a=!1,checkChronology:o=!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,disableNotice:d,drawMatchUps:p,matchUpId:m,schedule:h,event:f}=t,g,v;if(p)g=p.find(C=>C.matchUpId===m);else{let C=hi({drawDefinition:u,event:f,matchUpId:m});if(C.error)return C;g=C.matchUp}let{endTime:I,courtId:y,courtIds:b,courtOrder:S,resumeTime:w,homeParticipantId:U,scheduledDate:T,scheduledTime:P,startTime:R,stopTime:D,timeModifiers:E,venueId:N}=h;o&&(!r||!n)&&({matchUpDependencies:r,matchUps:n}=Wo({drawDefinition:u}));let A=(M=r==null?void 0:r[m])==null?void 0:M.matchUpIds;if(h.scheduledDate&&o&&A){let C=n==null?void 0:n.filter(O=>{var k,x;return(((k=O.schedule)==null?void 0:k.scheduledDate)||ut((x=O.schedule)==null?void 0:x.scheduledTime))&&A.includes(O.matchUpId)}).map(({schedule:O})=>{let k=kS(O);return new Date(k).getTime()});if(C!=null&&C.length){let O=kS(h),k=new Date(O).getTime();if(Math.max(...C)>=k){if(a)return Q({result:{error:pC},stack:e});v=pC}}}if(T!==void 0){let C=GD({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,scheduledDate:T,matchUpId:m});if(C!=null&&C.error)return Q({result:C,stack:e,context:{scheduledDate:T}})}if(P!==void 0){let C=ed({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,scheduledTime:P,matchUpId:m,matchUp:g});if(C!=null&&C.error)return Q({result:C,stack:e,context:{scheduledTime:P}})}if(R!==void 0){let C=Yk({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:m,startTime:R,event:f});if(C!=null&&C.error)return Q({result:C,stack:e,context:{startTime:R}})}if(D!==void 0){let C=Jk({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:m,stopTime:D,event:f});if(C!=null&&C.error)return Q({result:C,stack:e,context:{stopTime:D}})}if(w!==void 0){let C=Xk({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,resumeTime:w,matchUpId:m,event:f});if(C!=null&&C.error)return Q({result:C,stack:e,context:{resumeTime:w}})}if(I!==void 0){let C=Kk({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:m,endTime:I,event:f});if(C!=null&&C.error)return Q({result:C,stack:e,context:{endTime:I}})}if(b!==void 0){let C=HD({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:m,courtIds:b});if(C!=null&&C.error)return Q({result:C,stack:e,context:{courtIds:b}})}if(y!==void 0&&T!==void 0){let C=Ih({courtDayDate:T,disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:m,courtId:y});if(C!=null&&C.error)return Q({result:C,stack:e,context:{courtId:y}})}if(N!==void 0){let C=Jg({disableNotice:!0,removePriorValues:s,tournamentRecords:l,tournamentRecord:c,drawDefinition:u,matchUpId:m,venueId:N});if(C!=null&&C.error)return Q({result:C,stack:e,context:{venueId:N}})}if(S!==void 0&&rt(S)){let C=qk({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,courtOrder:S,matchUpId:m});if(C!=null&&C.error)return Q({result:C,stack:e,context:{courtOrder:S}})}if(E!==void 0){let C=R4({disableNotice:!0,removePriorValues:s,tournamentRecord:c,drawDefinition:u,timeModifiers:E,matchUpId:m,matchUp:g});if(C!=null&&C.error)return Q({result:C,stack:e,context:{timeModifiers:E}})}return Ki(U)&&Wk({disableNotice:!0,homeParticipantId:U,removePriorValues:s,tournamentRecord:c,drawDefinition:u,matchUpId:m}),d||St({tournamentId:c==null?void 0:c.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:u,matchUp:g}),v?{...X,warnings:[v]}:{...X}}function qk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:pn};if(n&&!rt(n))return{error:le,info:"courtOrder must be numeric"};let o=n&&Je(n);return pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:$T,itemValue:o}})}function E4({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:pn};if(!n)return{error:lr};if(e){let l=Gi({tournamentRecord:e,participantFilters:{participantTypes:[It],participantRoles:[KA]}}).participants??[];if(!Tc({tournamentParticipants:l,participantId:n}))return{error:Li}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function Yk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:pn};if(!Eg(a))return{error:go};let{matchUp:s}=hi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=_d({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[cu,yl,wu].includes(u==null?void 0:u.itemType)).map(u=>Os(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Os(a,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==ts));let u=Qm(a,!0,!0);return pa({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:ts,itemValue:u}})}else return{error:_G}}function Kk({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:pn};if(!Eg(o))return{error:go};let{matchUp:l}=hi({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:c}=_d({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[ts,yl,cu].includes(d==null?void 0:d.itemType)).map(d=>Os(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Os(o,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==wu));let d=Qm(o,!0,!0);return pa({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:wu,itemValue:d}})}else return{error:FG}}function Jk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:pn};if(!Eg(a))return{error:go};let{matchUp:s}=hi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=_d({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((h,f)=>f.itemType===wu||h,void 0))return{error:EN};let u=c.filter(h=>[ts,yl,cu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Os(h.itemValue,l)-Os(f.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===cu,m=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Os(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Os(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Qm(a,!0,!0),itemType:cu};return pa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:LG}}function Xk({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:pn};if(!Eg(n))return{error:go};let{matchUp:s}=hi({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=_d({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((h,f)=>f.itemType===wu||h,void 0))return{error:EN};let u=c.filter(h=>[ts,yl,cu].includes(h==null?void 0:h.itemType)).sort((h,f)=>Os(h.itemValue,l)-Os(f.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===yl,m=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>Os(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(Os(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Qm(n,!0,!0),itemType:yl};return pa({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:Bre}}function Ppe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:c}){var p;let u=ke(n,void 0,!0);for(let m of(u==null?void 0:u.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=c,!gr({score:c})&&!e?Object.assign(m,{...nD}):e&&(m.matchUpStatus=e));a=a??((p=un({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=wb({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function Rpe(t){var S;let{tournamentRecord:e,inContextMatchUp:i,structure:r,drawDefinition:n}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=o,{drawPosition:u,participantId:d}=s,p="swapWinnerLoser",{matchUps:m}=_t(t),h=m.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(l))&&U>a);Ra({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:h}),h.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(P=>P===l?u:P))||[],St({tournamentId:e==null?void 0:e.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:p,drawDefinition:n,matchUp:w})});let{stage:f,stageSequence:g}=r,v=n.structures.filter(({stage:w,stageSequence:U})=>w===f&&U>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:I,winnerTargetLink:y}}=t.targetData,b=[I==null?void 0:I.target.structureId,(S=y==null?void 0:y.target)==null?void 0:S.structureId].filter(Boolean);return n.structures.filter(({stage:w,structureId:U})=>w!==f&&b.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{v.includes(T)||v.push(T),n.structures.filter(({stage:P,stageSequence:R})=>P===w&&R>U).forEach(({structureId:P})=>{v.includes(P)||v.push(P)})}),n.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:U}=Qt({structure:w}),T=U==null?void 0:U.find(({participantId:R})=>R===c),P=U==null?void 0:U.find(({participantId:R})=>R===d);T&&(T.participantId=d),P&&(P.participantId=c)}),Ls({...t,context:p})}function Fb(t){var $,_,L;let e="setMatchUpStatus";t.matchUpStatus&&[Lt,tr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:r,tournamentRecords:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:c,winningSide:u,matchUpId:d,event:p,score:m}=t;if(!l)return{error:xe};if(c&&[_u,vs,Ea,ji].includes(c)&&u)return{error:le,winningSide:u,matchUpStatus:c};if(![void 0,...VH].includes(c))return Q({result:{error:bg},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let h=Jr({drawDefinition:l}),{matchUps:f}=ur({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p}),g=h.drawMatchUps.find(B=>B.matchUpId===d),v=f==null?void 0:f.find(B=>B.matchUpId===d);if(!g||!f)return{error:tn};if((g.winningSide||u)&&c===xt)return{context:"Cannot have Bye with winningSide",error:qU,matchUpStatus:c};let I=v==null?void 0:v.structureId,{structure:y}=Qe({drawDefinition:l,structureId:I}),b=$i(ci)(g.matchUpType),S=($=v==null?void 0:v.drawPositions)==null?void 0:$.filter(Boolean),w;if(b){if(o)Ct({extension:{name:Tm,value:!0},element:g});else if(s){let B=g.winningSide;gn({name:Tm,element:g});let{winningSide:V,scoreStringSide1:G,scoreStringSide2:j,set:H}=wb({drawDefinition:l,matchUpsMap:h,structure:y,matchUp:g,event:p}),W={scoreStringSide1:G,scoreStringSide2:j,sets:H?[H]:[]};w=V!==B,Object.assign(t,{winningSide:V,dualWinningSideChange:w,projectedWinningSide:V,score:W})}Ub({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(b&&c&&[eh].includes(c))return{error:le,info:"Not supported for matchUpType: TEAM"};let U=v==null?void 0:v.matchUpTieId,T=Un({matchUpId:U||d,inContextDrawMatchUps:f,drawDefinition:l});if(m&&!b&&!r){let B=g.matchUpFormat??(y==null?void 0:y.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),V=YO({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:B,matchUpStatus:c,winningSide:u,score:m});if(V.error)return V}let P=((_=Nt({policyTypes:[PI,gs],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:_.appliedPolicies)??{};Ut(t.policyDefinitions)&&Object.assign(P,t.policyDefinitions);let R=Cpe({assignedDrawPositions:S,inContextMatchUp:v,appliedPolicies:P,drawDefinition:l,matchUpStatus:c,structure:y,matchUp:g});if(R!=null&&R.error)return R;let D=(v==null?void 0:v.stage)===We&&v.finishingRound===1,E=D&&u,N=D&&g.winningSide&&!u&&(!t.matchUpStatus||t.matchUpStatus&&xC({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!gr({outcome:t.outcome})),A=E&&u!==g.winningSide&&g.winningSide;if(Object.assign(t,{inContextDrawMatchUps:f,qualifierAdvancing:E,qualifierChanging:A,removingQualifier:N,inContextMatchUp:v,appliedPolicies:P,matchUpTieId:U,matchUpsMap:h,targetData:T,structure:y,matchUp:g}),U){let{matchUp:B}=hi({matchUpId:U,inContext:!0,drawDefinition:l,matchUpsMap:h,event:p});if(B){let V=(L=un({matchUp:B,drawDefinition:l,structure:y,event:p}))==null?void 0:L.tieFormat,{projectedWinningSide:G}=Ppe({drawDefinition:l,matchUpStatus:c,dualMatchUp:B,matchUpsMap:h,winningSide:u,tieFormat:V,structure:y,matchUp:g,event:p,score:m}),j=B.winningSide;w=G!==j,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:w,projectedWinningSide:G,matchUpTieId:U,dualMatchUp:B,tieFormat:V})}}let M=Gd(t),C=rb({matchUpStatus:c});if(!U){if(M&&!u&&(c&&xC({matchUpStatus:c})||c&&[tr,mr].includes(c)))return{error:qU,activeDownstream:M,winningSide:u};if(u&&u===g.winningSide&&c&&!C)return{context:"winningSide must include directing matchUpStatus",error:qU,directingMatchUpStatus:C,matchUpStatus:c}}let{schedule:O}=t;if(O){let B=zD({disableNotice:!0,tournamentRecords:n,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:O});if(B.error)return B}let k=!b&&!w&&u&&g.winningSide&&g.winningSide!==u;if(i&&k&&g.roundPosition)return Rpe(t);let x=u&&!U||t.projectedWinningSide;Xa({activeDownstream:M,matchUpWinner:x,method:e,winningSide:u});let F=!M&&Dpe(t)||x&&Epe(t)||C&&C4(t)||{error:WG};return Q({result:F,stack:e})}function Epe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?C4(t):Q({stack:"winningSideWithDownstreamDependencies",result:{error:TN},context:{winningSide:i,matchUp:e}})}function C4(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!gr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&ji||_i:t.matchUpStatus||_i,o=t.removeScore||[_u,Lt].includes(a)&&![vs,Ea].includes(a),s=Ls({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=Gu({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function Cpe({assignedDrawPositions:t,inContextMatchUp:e,appliedPolicies:i,drawDefinition:r,matchUpStatus:n,structure:a,matchUp:o}){var u,d;if(((u=i==null?void 0:i[gs])==null?void 0:u.requireParticipantsForScoring)===!1)return{...X};let s=(d=e==null?void 0:e.sides)==null?void 0:d.map(p=>p.participantId).filter(Boolean).length,l=o!=null&&o.sides?[]:Qt({structureId:a==null?void 0:a.structureId,drawDefinition:r}).positionAssignments,c=s&&s===2||o.collectionId&&Wn({structure:a})&&s&&s>=1||(t==null?void 0:t.length)===2&&(l==null?void 0:l.filter(p=>t.includes(p.drawPosition)).every(p=>p.participantId));return n&&BH.includes(n)&&!c?Q({info:"matchUpStatus requires assigned participants",context:{matchUpStatus:n,requiredParticipants:c},result:{error:bg}}):{...X}}function M4({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:xe};let{matchUp:n}=hi({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==zs?{error:zn}:Fb({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function N4({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:xe};if(!i)return{error:pn};let{matchUp:r}=hi({drawDefinition:t,event:e,matchUpId:i});return r?gn({name:DT,element:r}):{error:tn}}function Mpe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var m,h,f,g,v;let s="substituteParticipant";if(!r)return{error:xe};if(!a)return{error:pn};if(!e||!t)return Q({result:{error:lr},stack:s});let{matchUp:l}=hi({drawDefinition:r,matchUpId:a,event:o});if(!l)return{error:tn};if(!l.collectionId)return Q({result:{error:zn},stack:s});let c=Jr({drawDefinition:r}),{matchUps:u}=ur({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:c}),d=u==null?void 0:u.find(I=>I.matchUpId===a),p=(h=(m=u==null?void 0:u.find(I=>I.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:m.sides)==null?void 0:h.find(I=>I.participant.individualParticipants.some(({participantId:y})=>y===e));return!p||n&&p.sideNumber!==n?{error:ps}:(v=(g=(f=p.participant)==null?void 0:f.individualParticipants)==null?void 0:g.map(vt).filter(I=>I!==e))!=null&&v.includes(t)?Hk({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):Q({result:{error:ps},stack:s})}function A4(t){return Mpe(t)}function O4({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:xe};let{matchUp:r}=hi({drawDefinition:t,matchUpId:e,event:i});return Ct({extension:{name:Tm,value:!0},element:r})}function k4(t){let e="setMatchUpFormat",i=it(t,[{tournamentRecord:!0},{[ea]:S=>da({matchUpFormat:S}),[fs]:Ey,matchUpFormat:!0}]);if(i.error)return Q({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return Q({result:{error:le,scheduledDates:a},stack:e});if(c&&!WT([Gs,eo],c))return Q({result:{error:Ml},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],I=t.eventIds||d&&[d].filter(Boolean)||[],y=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return Q({result:{error:xe},stack:e});if(m&&u&&n){let S=ZO({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&_t({matchUpFilters:{matchUpStatuses:[ji]},structure:U}).matchUps)??[],P=(a&&_t({matchUpFilters:{matchUpStatuses:[ji]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let R=P?P.map(br):T.map(br);for(let D of T)R.includes(D.matchUpId)&&(D.matchUpFormat=a!=null&&a.length?s:void 0,St({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:D}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(I!=null&&I.length&&!I.includes(S.eventId)||c&&c!==S.eventType||c===or))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||y!=null&&y.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(y)&&!y.includes(w.drawId))continue;let U=b(w);ai({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...X,modificationsCount:g}:{...X,info:Tg}}function Zk({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var l,c;if(!i)return{error:xe};let a=(l=hi({drawDefinition:i,matchUpId:r}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:zn};let o=(c=hi({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:c.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((o==null?void 0:o.sides)||[]).forEach(u=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=u.participantId;d&&p&&ph({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}St({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:a})}),{...X,modificationsCount:s}}function x4(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=Ul({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=Ul({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=Ul({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),c=o===l?s:o;return r&&(o=r===1?l:c,s=r===2?l:c),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function Lb(t){var v,I;let e=it(t,[{[al]:!0,[ya]:!0}]);if(e.error)return e;let i=lo(t);if(!t.drawDefinition){let y=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=y);let b=An({eventId:t.eventId,drawId:t.drawId,tournamentRecord:y});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:r,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpId:c,schedule:u,event:d,notes:p}=t,m=t.matchUpFormat||((v=t.outcome)==null?void 0:v.matchUpFormat),{policy:h}=pp({policyType:gs,tournamentRecord:a,event:d}),f=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(h==null?void 0:h.allowChangePropagation)!==void 0&&h.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:lT};if(m){let y=ZO({tournamentRecord:a,drawDefinition:l,matchUpFormat:m,matchUpId:c,event:d});if(y.error)return y}if((I=g==null?void 0:g.score)!=null&&I.sets&&!g.score.scoreStringSide1){let{score:y}=x4(g);g.score=y,g.score.sets=g.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return Fb({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:f,disableScoreValidation:r,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:n,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:m,matchUpId:c,schedule:u,event:d,notes:p})}function F4(t){if(!(t!=null&&t.outcomes))return{error:ze};if(!Array.isArray(t.outcomes))return{error:ze,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:fe};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=Npe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...X}}function Npe(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:r,policyDefinitions:n}=t,a={};r.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=An({tournamentRecord:i,eventId:s});for(let c of a[s]){let{drawId:u}=c,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:m}=c,h=Lb({schedule:c==null?void 0:c.schedule,tournamentRecords:e,policyDefinitions:n,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:c,drawId:u,event:l});if(h.error)return h}}}return{...X}}function Ape({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:xe};if(!i)return{error:ze,info:"missing outcome"};if(!r&&!e)return{error:Hn};if(!r){let o=hi({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:le}:Ct({element:r,extension:{name:DT,value:i}})}function L4(t){return Ape(t)}function Qk(t){var f,g;let e="resetTieFormat",{drawDefinition:i,event:r,uuids:n}=t,a=it(t,[{[Fn]:!0,[al]:!0}],e);if(a.error)return a;let o=zg(t,[{[Pg]:Yl}]);if(o[vl])return o;let s=(f=t.tournamentRecord)==null?void 0:f.tournamentId,{matchUp:l,structure:c}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return Q({result:{error:zn},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...X};let u=(g=un({structure:c,drawDefinition:i,event:r}))==null?void 0:g.tieFormat;if(!u)return Q({result:{error:Nr},info:"No inherited tieFormat",stack:e});let d=[],p=[],m=[],h=[];for(let v of u.collectionDefinitions){let{matchUpCount:I,collectionId:y}=v;p.push(y);let b=(l.tieMatchUps||[]).filter(S=>S.collectionId===y);if(b.length>I)b.sort((S,w)=>(S.matchUpStatus===ji?1:0)-(w.matchUpStatus===ji?1:0)),m.push(...b.slice(0,I)),d.push(...b.slice(3).map(br));else if(m.push(...b),b.length<I){let S=I-b.length,w=vb({collectionDefinition:v,matchUpsLimit:S,matchUp:l,uuids:n});h.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return h.length&&(m.push(...h),Rc({eventId:r==null?void 0:r.eventId,matchUps:h,drawDefinition:i,tournamentId:s})),d.length&&$u({matchUpIds:d,eventId:r==null?void 0:r.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=m,l.tieFormatId=void 0,l.tieFormat=void 0,St({structureId:c==null?void 0:c.structureId,eventId:r==null?void 0:r.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...X,newMatchUps:h,deletedMatchUpIds:d}}function ex(t){var f,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}=t,a="resetScorecard";if(!i)return Q({result:{error:xe},stack:a});if(!r)return Q({result:{error:pn},stack:a});if(!Ki(r))return Q({result:{error:le,matchUpId:r},stack:a});let o=Jr({drawDefinition:i}),{matchUps:s}=ur({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(I=>I.matchUpId===r),c=s==null?void 0:s.find(I=>I.matchUpId===r);if(!l||!s)return{error:tn};if(l.matchUpType!==to)return{error:zn};let u=Un({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:r}),d=c==null?void 0:c.structureId,{structure:p}=Qe({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:c,matchUpsMap:o,targetData:u,structure:p,matchUp:l}),Gd(t))return{error:TN};if((f=l.tieMatchUps)!=null&&f.length)for(let I of l.tieMatchUps){let y=Fb({matchUpId:I.matchUpId,matchUpTieId:r,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:n});if(y.error)return Q({result:y,stack:a})}let m=(g=Nt({tournamentRecord:e,drawDefinition:i,event:n}))==null?void 0:g.appliedPolicies,h=Gu({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:m,drawDefinition:i,matchUpsMap:o,matchUpId:r});if(h.error)return Q({result:h,stack:a});if(t.tiebreakReset&&!h.tieFormatRemoved){let I=(v=un({drawDefinition:i,structure:p,event:n}))==null?void 0:v.tieFormat;if(l.tieFormat&&I){let{matchUpCountDifference:y,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=Su({descendant:l.tieFormat,ancestor:I});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&y===1&&w===1){let U=Qk({tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n});if(U.error)return U}}}return{...X}}function _4(t){let e=it(t,[{[ya]:!0,[up]:!0},{[TI]:{[Ay]:!1,roundNumbers:!1},[SH]:"At least one must be provided",[so]:Mn}]);if(e.error)return e;let i=vq(t);if(i.error)return i;let{matchUpIds:r}=i,n=$i(to)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let u=ex({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error||t.removeAssignments&&Zk({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return u}let c=Fb({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=zk({...t,matchUpId:l});if(u.error)return u}}return{...X}}function Ope({drawDefinition:t,finishingOrder:e}){var v;if(!t)return{error:xe};let i="setOrderOfFinish";if(!Array.isArray(e))return Q({info:Uu("finishingOrder"),result:{error:le},stack:i});let{completedMatchUps:r,matchUpsMap:n}=_g({inContext:!0,drawDefinition:t}),a=(r==null?void 0:r.map(br))??[],o=e.map(br),{matchUpTypes:s,roundNumbers:l,structureIds:c,matchUpTieIds:u}=(r??[]).filter(({matchUpId:I})=>o.includes(I)).reduce((I,y)=>{let{matchUpTieId:b,matchUpType:S,roundNumber:w,structureId:U}=y;return I.matchUpTypes.includes(S)||I.matchUpTypes.push(S),I.roundNumbers.includes(w)||I.roundNumbers.push(w),I.structureIds.includes(U)||I.structureIds.push(U),I.matchUpTieIds.includes(b)||I.matchUpTieIds.push(b),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||u.length>1||l.length>1||c.length>1)return Q({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:le},stack:i});let d,p,m={},h=[],f=[];if(!e.every(({orderOfFinish:I,matchUpId:y})=>(h.push(y),I&&f.push(I),m[y]=I,d=a.includes(y),p=I===void 0||rt(I)&&Math.floor(I)>0,d&&p)))return Q({result:{error:d?le:bg},info:!d&&"matchUps must be completed"||!p&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:i});let g=r==null?void 0:r.filter(I=>I.structureId===c[0]&&I.roundNumber===l[0]&&I.matchUpType===s[0]&&I.matchUpTieId===u[0]&&!h.includes(I.matchUpId));for(let I of g??[]){let{orderOfFinish:y}=I||{};if(y){if(!rt(y))return Q({context:{orderOfFinish:y,matchUp:I},result:{error:le},stack:i});f.push(y)}}if(iH(f).length!==f.length||Math.max(...f)>f.length)return Q({info:"Values not unique or greater than expected number of values",result:{error:le},stack:i});if(c.length){let I=YT({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:t,matchUpsMap:n});if(I.error)return Q({result:I,stack:i});(v=I.completedMatchUps)==null||v.forEach(y=>y.orderOfFinish=m[y.matchUpId])}return{...X}}function $4(t){return Ope(t)}function B4(t){var v,I,y,b;let{tournamentRecord:e,drawDefinition:i,matchUpId:r,lineUps:n,event:a}=t,o="applyLineUps",s=it(t,[{[Fn]:!0,[ya]:!0,[al]:!0},{lineUps:!0,[so]:Mn}],o);if(s.error)return s;let l=e.participants||[],c=hi({tournamentParticipants:l,inContext:!0,drawDefinition:i,matchUpId:r});if(c.error)return c;if(!c.matchUp)return{error:tn};let{matchUp:u,structure:d}=c,{drawPositions:p,matchUpType:m}=u;if(m!==ci)return{error:zn};if(!(p!=null&&p.length))return{error:Py};let h=(v=un({matchUp:u,drawDefinition:i,structure:d,event:a}))==null?void 0:v.tieFormat,f={};for(let S of n){if(!Array.isArray(S))return{error:le,lineUp:S};let w={},U=[];for(let E of S){if(typeof E!="object")return{error:le,lineUpAssignment:E};let{participantId:N,collectionAssignments:A=[]}=E;if(!Array.isArray(A))return{error:le,collectionAssignments:A};let M=l.find(O=>O.participantId===N);if(!M)return{error:Li};if(M.participantType!==It)return{error:ms};let C=(y=(I=u.sides)==null?void 0:I.find(O=>{var k,x;return(x=(k=O.participant)==null?void 0:k.individualParticipantIds)==null?void 0:x.includes(N)}))==null?void 0:y.sideNumber;C&&U.push(C);for(let O of A){if(typeof O!="object")return{error:le,collectionAssignment:O};let{collectionId:k,collectionPosition:x}=O,F=(b=h==null?void 0:h.collectionDefinitions)==null?void 0:b.find(L=>L.collectionId===k);if(!F)return{error:le,collectionId:k};let $=`${k}-${x}`;w[$]||(w[$]=[]);let _=w[$].length;if($i(vi)(F.matchUpType)&&_||F.matchUpType===ri&&_>1)return{info:"Excessive collectionPosition assignments",error:le};w[$].push(N)}}let T=Object.values(w);for(let E of T)if(E.length===2){let{participant:N}=ko({tournamentParticipants:l,participantIds:E});if(!N){let A=Ys({participant:{participantType:ot,participantRole:Gr,individualParticipantIds:E},pairOverride:!0,tournamentRecord:e});if(A.error)return A}}let P=la(U),R=(P[1]||0)>(P[2]||0)&&1||(P[2]||0)>(P[1]||0)&&2||void 0,D=Object.keys(f).map(E=>parseInt(E));R&&!D.includes(R)&&(f[R]=S)}if(!Object.keys(f).length)return{error:ON};if(c=hi({drawDefinition:i,matchUpId:r}),c.error)return c;if(!c.matchUp)return{error:tn};let{matchUp:g}=c;g.sides||(g.sides=[]);for(let S of[1,2]){let w=g.sides.find(T=>T.sideNumber===S),U=f[S];if(U)w?w.lineUp=U:g.sides.push({lineUp:U,sideNumber:S});else continue}return St({tournamentId:e==null?void 0:e.tournamentId,context:o,drawDefinition:i,matchUp:g}),{...X}}var tx={};gt(tx,{anonymizeTournamentRecord:()=>l5,generate:()=>V4,generateEventWithDraw:()=>JD,generateOutcome:()=>ux,generateOutcomeFromScoreString:()=>ix,generateParticipants:()=>Xg,generateTournamentRecord:()=>o5,modifyTournamentRecord:()=>u5,mutate:()=>s5});var V4={};gt(V4,{generateEventWithDraw:()=>JD,generateOutcome:()=>ux,generateOutcomeFromScoreString:()=>ix,generateParticipants:()=>Xg,generateTournamentRecord:()=>o5});function ix(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...nD,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:le,winningSide:r};let a=n&&n0({scoreString:n}),o={},s=Ul({sets:a,matchUpFormat:e}),l=Ul({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=n0({scoreString:o.scoreStringSide1}),Ge({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function rx({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var a;let n=(((a=e==null?void 0:e[r.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(n!=null&&n.length),remainingDependencies:n}}function Bf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var c,u,d,p;let{individualParticipantIds:n}=LT(r);i=i??((c=r.schedule)==null?void 0:c.timeAfterRecovery);let a=m=>{t[m]||(t[m]=[]),t[m]=mt(t[m].concat(...n))},o=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},s=((u=r.winnerTo)==null?void 0:u.matchUpId)||r.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=r.loserTo)==null?void 0:d.matchUpId)||r.loserMatchUpId;l&&(i&&o(l),a(l)),(p=r.sidesTo)!=null&&p.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&o(m),a(m))})}function _b({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function kpe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function HI({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var h,f;let c=mi((h=l==null?void 0:l.schedule)==null?void 0:h.endTime),u=c?Vn(c,Je(o)):Vn(s,Je(r)+Je(o)),d=i&&(c?Vn(mi(c),i):Vn(s,Je(r)+Je(i))),p=((f=a==null?void 0:a[l.matchUpId])==null?void 0:f.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{_b({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||u;m.includes(g)?kpe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),Bf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:u,matchUp:l})}function j4({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var u,d,p,m,h;let a,o=(d=(u=n.minutesMap)==null?void 0:u[r])==null?void 0:d.recoveryMinutes,s=(((m=(p=n.minutesMap)==null?void 0:p[r])==null?void 0:m.averageMinutes)||0)+(o||0),l=Vn(i,s),c=((h=e==null?void 0:e[r])==null?void 0:h.dependentMatchUpIds)||[];if(c.length){let f=c.reduce((g,v)=>{let I=t[v];if(!I)return g;let y={scheduleTime:I,matchUpId:v};return I&&!g.matchUpId||Dt(I)<Dt(g.scheduleTime)?y:g},{});f.scheduleTime&&Dt(l)>Dt(f.scheduleTime)&&(a=f)}return{scheduledDependent:a}}function xpe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===ri&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var $b="DO_NOT_SCHEDULE",Fpe={DO_NOT_SCHEDULE:$b};function nx({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=xpe(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===$b&&Ol(a,m.date)),c=[],u=o==null?void 0:o.matchUpId,d=Qi(mi(n),ut(a)),p=mi(QN(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(c.push({matchUpId:u,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(u)||e[h].matchUpIds.push(u)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:c}}function l1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=LT(i),o=(t[i.matchUpId]||[]).filter(s=>!bn(s,a)).flat();[...a,...o].forEach(s=>{if(_b({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Do]?l[Do]+=r:r>0&&(l[Do]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function Lpe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var f,g;let p=[];i||(n=d==null?void 0:d.filter(v=>{let I=v.schedule||{},y=v.matchUpStatus===xt;return y&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!y&&Mb({schedule:I})&&(!c||v.schedule.scheduledDate===c)}),i=n.map(br));let m=Array.isArray(l)?l.includes(c):l,h=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of h){l1({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let I=(f=v.schedule)==null?void 0:f.scheduledTime;if(I){o[v.matchUpId]=I;let y=(g=u==null?void 0:u[v.matchUpId])==null?void 0:g.recoveryMinutes;HI({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:y,scheduleTime:I,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:n,clearDate:m}}function _pe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:r,matchUpScheduleTimes:n,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(n),c=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),m=[xt,Rt,_i,Ea,nn,Lt,tr,mr].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!m}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:m,tournamentId:h}=p;return d.matchUpMap[h]||(d.matchUpMap[h]={}),d.matchUpMap[h][m]?d.matchUpMap[h][m].push(p):d.matchUpMap[h][m]=[p],Bf({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function WD({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:Di};if(!uo(s)&&!Array.isArray(i))return{error:Fu};a=a??$D({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=Hy({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return Mb({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let u=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==xt);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:c,matchUpFormat:m},{averageMinutes:I,recoveryMinutes:y}=BT({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=mi(p.scheduledTime),U=Vn(w,I);return{recoveryMinutes:y,averageMinutes:I,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function $pe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Di};s=s??$D({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=Hu({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!u||u.includes(S.venueId)))??[];c=c??$f({courts:f,scheduleDate:l,startTime:!0}),p=p??$f({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=WD({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),I={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:f},{scheduleTimes:y}=Bk(I),b=(u==null?void 0:u.length)===1&&u[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(ca("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:y,venueId:b}}function Bpe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(n=n.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=c.matchUpIds),s=i?e:c.averageMinutes,o=c.recoveryMinutes,a=c.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function G4({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:m,venues:h}){var y;let f={},g=[],v=[],I=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:P,minutesMap:R}=Eb({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:c,matchUps:p,rounds:S});I.push(...P??[]);let{groupedRounds:D}=Bpe({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),E,N,A=[];d&&({scheduleTimes:A,dateScheduledMatchUpIds:E,dateScheduledMatchUps:N}=$pe({averageMatchUpMinutes:(y=D[0])==null?void 0:y.averageMinutes,scheduleDate:ut(u),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let M=Lpe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:R,matchUps:p});({dateScheduledMatchUpIds:E,dateScheduledMatchUps:N}=M);let{byeScheduledMatchUpDetails:C,clearDate:O}=M;C!=null&&C.length&&v.push(...C);let{matchUpsToSchedule:k,matchUpMap:x}=_pe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);f[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:N,matchUpsToSchedule:k,scheduleTimes:A,groupedRounds:D,venueCourts:F,minutesMap:R,matchUpMap:x},s||g.push(...E)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:f,allDateMatchUpIds:I}}function Vpe(t,e){let i=Dt(t.scheduleTime),r=Dt(t.timeAfterRecovery),n=Dt(e.scheduleTime),a=Dt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,c=r>n&&r<a,u=a>i&&a<r;return Ge({hasOverlap:o||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function ax({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var p,m,h,f,g;let o=(((p=i==null?void 0:i[n.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((h=(m=a==null?void 0:a.minutesMap)==null?void 0:m[n.matchUpId])==null?void 0:h.averageMinutes)||0,l=((g=(f=a==null?void 0:a.minutesMap)==null?void 0:f[n.matchUpId])==null?void 0:g.recoveryMinutes)||0,c=o.every(v=>{var S;_b({individualParticipantProfiles:t,participantId:v});let I=t[v];if(!I.timeAfterRecovery)return!0;let y=mi((S=n==null?void 0:n.schedule)==null?void 0:S.endTime),b=y?Vn(y,Je(l)):Vn(r,Je(s)+Je(l));return![...Object.keys(I.potentialBookings).filter(w=>w!==n.drawId).map(w=>I.potentialBookings[w]).flat(),...I.bookings].find(w=>Vpe({scheduleTime:r,timeAfterRecovery:b},w).hasOverlap)}),u=e[n.matchUpId],d=(u?Oy(Qi(u),Qi(r),!1):0)>=0;return{enoughTime:c&&d}}function ox({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=LT(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&e[a]||[]).flat(),l=mt(n.concat(...s));return l.forEach(c=>{_b({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[o,Do].find(d=>{var h;let p=((h=u.counters)==null?void 0:h[d])||0,m=i[d]||0;return p&&m&&p>=m})}),relevantParticipantIds:l}}function zI({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var g,v,I;if(!s)return{error:fe};if(!l&&(!c||!Array.isArray(c)))return{error:Wm};if(!l&&(!u||typeof u!="object"))return{error:BG};let d,p=[],m=0;if(r&&!n){let y=Wo({tournamentRecords:o,tournamentRecord:s});n=y.matchUpDependencies,d=y.matchUps}d||(d=((g=kr({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let h=d.reduce((y,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==xt)&&(t||!fr.includes(U))&&(y[w]?y[w].push(S):y[w]=[S]),y},{}),f=l==null?void 0:l.map(y=>y.matchUpId);for(let y of Object.keys(h)){let{drawDefinition:b}=Qc({tournamentRecord:s,drawId:y});if(!b)continue;let S=h[y].filter(U=>(c==null?void 0:c.includes(U))??(f==null?void 0:f.includes(U))),w=vn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((v=l==null?void 0:l.find(R=>R.matchUpId===U))==null?void 0:v.schedule)||u,P=zD({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((I=P==null?void 0:P.warnings)!=null&&I.length&&p.push(...P.warnings),P!=null&&P.success&&(m+=1),P.error)return P}}return p.length?{...X,scheduled:m,warnings:p}:{...X,scheduled:m}}function Bb(t){var h;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:r,matchUpContextIds:n,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!n)return zI(t);let u=it(t,[{[rn]:!0},{[TI]:{matchUpContextIds:!1,matchUpDetails:!1},[fs]:le,[so]:Mn}]);if(u.error)return u;if((!l||n)&&!c)return{error:ze,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:m}=Wo({tournamentRecords:o});for(let f of Object.values(o)){let{tournamentId:g}=f,v=n==null?void 0:n.filter(y=>y.tournamentId===g).map(br),I=l==null?void 0:l.filter(y=>(y==null?void 0:y.tournamentId)===g);if(v!=null&&v.length||I!=null&&I.length){let y=zI({matchUpDetails:I,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:m,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:f,checkChronology:s,matchUpIds:v,schedule:c});if((h=y.warnings)!=null&&h.length&&d.push(...y.warnings),y.scheduled&&(p+=y.scheduled),y.error)return y}}return d.length?{...X,scheduled:p,warnings:d}:{...X,scheduled:p}}function H4({autoSchedulingAudit:t,tournamentRecords:e}){var o;lt({topic:Nf,payload:t});let i=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),n={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:r},a={itemType:Z6,itemValue:n};for(let s of Object.values(e))mh({tournamentRecord:s,timeItem:a})}function jpe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var E,N,A,M,C,O,k;let g={},v={},I={},y={},b={},S={},w={},U={},T={},P={};for(let x of n){let F=ut(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(K,z)=>{K.forEach(te=>{let J=L[te].counters;J[z]?J[z]+=1:J[z]=1,J[Do]?J[Do]+=1:J[Do]=1})};I[F]={},y[F]={},g[F]={},v[F]={},w[F]=[],U[F]=[],T[F]=[],P[F]=[];let V={};m.forEach(K=>{var z;(z=K.schedule)!=null&&z.scheduledDate&&Ol(F,ut(K.schedule.scheduledDate))&&Bf({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:K})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:H}=G4({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:S,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),W=10,Y=0,q,re=10;for(;!q;){for(let{venueId:K}of $){let z=0,te=j[K];for(;te.courtsCount&&((E=te.scheduleTimes)!=null&&E.length)&&((N=te.matchUpsToSchedule)!=null&&N.length)&&z<=te.courtsCount;){let{scheduleTime:J,attempts:ie=0}=te.scheduleTimes.shift(),ne=te.matchUpsToSchedule.find(ue=>{var be,_e;let{matchUpId:ae,matchUpType:ce}=ue,{participantIdsAtLimit:pe,relevantParticipantIds:Se}=ox({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:ue});if(pe.length)return U[F].includes(ae)||U[F].push(ae),!1;let{scheduledDependent:Be}=j4({matchUpScheduleTimes:S,matchUpDependencies:o,scheduleTime:J,matchUpId:ae,details:te});if(Be)return!1;let{dependenciesScheduled:Pe,remainingDependencies:at}=rx({matchUpScheduleTimes:S,matchUpDependencies:o,allDateMatchUpIds:H,matchUp:ue});if(!Pe)return y[F][ae]||(y[F][ae]=[]),y[F][ae].push({scheduleTime:J,remainingDependencies:at}),!1;let{enoughTime:de}=ax({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:J,details:te,matchUp:ue});if(!de)return I[F][ae]||(I[F][ae]=[]),I[F][ae].push({scheduleTime:J}),!1;let Ie=te.greatestAverageMinutes,{conflicts:me}=nx({potentials:e,averageMatchUpMinutes:Ie,requestConflicts:P,personRequests:d,scheduleTime:J,scheduleDate:F,matchUp:ue});if(me!=null&&me.length)return b[F]||(b[F]=[]),b[F].push(...me),!1;B(Se,ce);let Me=(_e=(be=te.minutesMap)==null?void 0:be[ae])==null?void 0:_e.recoveryMinutes;return HI({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:Ie,matchUpDependencies:o,recoveryMinutes:Me,scheduleTime:J,matchUp:ue}),S[ae]=J,!0});te.matchUpsToSchedule=te.matchUpsToSchedule.filter(({matchUpId:ue})=>ue!==(ne==null?void 0:ne.matchUpId)),ne?z+=1:(v[F][K]||(v[F][K]=[]),v[F][K].push({scheduleTime:J,attempts:ie+1}))}(A=te.matchUpsToSchedule)!=null&&A.length&&(v[F][K]=(M=v[F][K])==null?void 0:M.filter(J=>{let ie=J.attempts<W;return ie&&te.scheduleTimes.push(J),!ie})),(!((C=te.scheduleTimes)!=null&&C.length)||!((O=te.matchUpsToSchedule)!=null&&O.length))&&(te.complete=!0)}Y+=1,q=$.every(({venueId:K})=>j[K].complete)||Y===re}for(let{venueId:K}of $){let z=j[K].matchUpMap;Object.keys(z).forEach(te=>{let J=c[te];J&&Object.keys(z[te]).forEach(ie=>{let{drawDefinition:ne}=Qc({tournamentRecord:J,drawId:ie});ne&&z[te][ie].forEach(({matchUpId:ue})=>{let ae=S[ue];if(ae){let ce=ae.split(":").map(za).join(":"),pe=`${ut(F)}T${ce}`;f?w[F].push(ue):(ed({drawDefinition:ne,scheduledTime:pe,matchUpId:ue}).success&&w[F].push(ue),K&&Jg({tournamentRecord:J,drawDefinition:ne,matchUpId:ue,venueId:K}))}})})}),T[F]=j[K].matchUpsToSchedule.map(br),g[F][K]=j[K].scheduleTimes.sort((te,J)=>Dt(te.scheduleTime)-Dt(J.scheduleTime))}!f&&(G!=null&&G.length)&&Bb({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of x.venues)for(let z of K.rounds){let te=(((k=z.matchUps)==null?void 0:k.map(({matchUpId:ie})=>ie))||[]).filter(ie=>w[F].includes(ie));z.canScheduledMatchUpIds=te;let J=Math.round(te.length/z.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=0),z.possibleToSchedulePct=J,z.matchUpsCount===te.length&&(z.possibleToSchedule=!0)}}let R=n.map(({scheduleDate:x})=>x),D={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:w,schedulingProfile:u,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:R};return H4({tournamentRecords:c,autoSchedulingAudit:D}),{...X,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:g,dateSchedulingProfiles:n,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:I,dependencyDeferredMatchUpIds:y,matchUpScheduleTimes:S,overLimitMatchUpIds:U,scheduledMatchUpIds:w,noTimeMatchUpIds:T,requestConflicts:P,scheduledDates:R}}function a2({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:ze,stack:"getEarliestCourtTime"};let a=$f({scheduleDate:n,courts:[r],startTime:!0}),o=$f({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=xb({court:r,date:n}),{timeSlots:l}=Yg({courtDate:s}),c=Qi(e),u=Qi(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=Qi(p.startTime),h=Qi(p.endTime);if(m>u||h<c)return d;let f=c>m?c:m;if(Oy(f,h)>=t){let g=mi(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function Gpe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var D,E;let g={},v={},I={},y={},b={},S={},w={},U={},T={};for(let N of n??[]){let A=ut(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],C={},O={},k=(K,z)=>{K.forEach(te=>{let J=O[te].counters;J[z]?J[z]+=1:J[z]=1,J[Do]?J[Do]+=1:J[Do]=1})};g[A]={},v[A]={},S[A]=[],w[A]=[],U[A]=[],T[A]=[];let x={};m==null||m.forEach(K=>{var z;(z=K.schedule)!=null&&z.scheduledDate&&Ol(A,ut(K.schedule.scheduledDate))&&Bf({matchUpPotentialParticipantIds:C,matchUpNotBeforeTimes:x,matchUp:K})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=G4({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:b,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:K})=>$.includes(K)),{bookings:V}=WD({dateScheduledMatchUps:B,tournamentRecords:c,scheduleDate:A,periodLength:u}),{virtualCourts:G}=_D({scheduleDate:A,periodLength:u,bookings:V,courts:h}),j=G==null?void 0:G.reduce((K,z)=>{let{earliestCourtTime:te,courtEndTime:J}=a2({date:A,averageMinutes:0,court:z});return(!K.startTime||Qi(te)<Qi(K.startTime))&&(K.startTime=te),(!K.endTime||Qi(J)>Qi(K.endTime))&&(K.endTime=J),K},{}),H=j.startTime,W=({courtId:K,booking:z})=>{var te;return(te=G==null?void 0:G.find(J=>J.courtId===K))==null?void 0:te.dateAvailability[0].bookings.push(z)},Y=10,q=0,re;for(;!re;){for(let{venueId:K}of M){let z=_[K],te=z.matchUpsToSchedule.length,J=[],ie=[],ne,ue=0;for(;!ne;){for(let ae of z.matchUpsToSchedule){if(ie.length===z.courtsCount||J.length===z.courtsCount){ne=!0;break}let{matchUpId:ce,matchUpType:pe}=ae,{participantIdsAtLimit:Se,relevantParticipantIds:Be}=ox({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ae});if(Se.length){w[A].includes(ce)||w[A].push(ce);continue}let{dependenciesScheduled:Pe,remainingDependencies:at}=rx({matchUpScheduleTimes:b,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ae});if(!Pe){v[A][ce]||(v[A][ce]=[]),v[A][ce].push({remainingDependencies:at});continue}let de=[],Ie=G==null?void 0:G.reduce((me,Me)=>{var De,Le,ye,Te;if(ie.includes(Me.courtId))return me;let{earliestCourtTime:be}=a2({averageMinutes:z.greatestAverageMinutes,startTime:H,date:A,court:Me});if(me.scheduleTime&&Dt(be)>=Dt(me.scheduleTime))return me;let{scheduledDependent:_e}=j4({matchUpScheduleTimes:b,matchUpDependencies:o,scheduleTime:be,matchUpId:ce,details:z});if(_e)return me;let{enoughTime:Ne}=ax({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:be,details:z,matchUp:ae});if(!Ne)return g[A][ce]||(g[A][ce]=[]),g[A][ce].includes(be)||g[A][ce].push(be),me;let se=((Le=(De=z.minutesMap)==null?void 0:De[ce])==null?void 0:Le.averageMinutes)||z.greatestAverageMinutes,{conflicts:ge}=nx({potentials:e,averageMatchUpMinutes:se,requestConflicts:T,personRequests:p,scheduleTime:be,scheduleDate:A,matchUp:ae});if(ge!=null&&ge.length)return de.push(...ge),!1;k(Be,pe);let we=(Te=(ye=z.minutesMap)==null?void 0:ye[ce])==null?void 0:Te.recoveryMinutes;return HI({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:se,matchUpDependencies:o,recoveryMinutes:we,scheduleTime:be,matchUp:ae}),(!me.scheduleTime||Dt(be)<Dt(me.scheduleTime))&&(me.averageMatchUpMinutes=se,me.recoveryMinutes=we,me.scheduleTime=be,me.courtName=Me.courtName,me.courtId=Me.courtId),me},{});if(Ie.scheduleTime){let{averageMatchUpMinutes:me,recoveryMinutes:Me,scheduleTime:be,courtId:_e}=Ie;b[ce]=be,y[ce]=_e,J.push(ce),ie.push(_e);let Ne=be,se=Vn(Ne,me);W({courtId:_e,booking:{averageMatchUpMinutes:me,recoveryMinutes:Me,periodLength:u,matchUpId:ce,startTime:Ne,courtId:_e,endTime:se,venueId:K}}),z.matchUpsToSchedule=z.matchUpsToSchedule.filter(ge=>ge.matchUpId!==ce)}else de!=null&&de.length&&(I[A]||(I[A]=[]),I[A].push(...de))}(ie.length===z.courtsCount||J.length===z.courtsCount||!z.matchUpsToSchedule.length)&&(ne=!0),z.matchUpsToSchedule.length&&J<z.courtsCount&&(Qi(H)<Qi(j.endTime)?H=Vn(H,u):(ne=!0,z.complete=!0)),ue+=1,!ne&&ue>=te&&(ne=!0)}(D=z.matchUpsToSchedule)!=null&&D.length||(z.complete=!0)}q+=1,re=M.every(({venueId:K})=>_[K].complete)||q===Y}for(let{venueId:K}of M){let z=_[K].matchUpMap;Object.keys(z).forEach(te=>{let J=c[te];J&&Object.keys(z[te]).forEach(ie=>{let{drawDefinition:ne}=Qc({tournamentRecord:J,drawId:ie});ne&&z[te][ie].forEach(({matchUpId:ue})=>{let ae=b[ue],ce=y[ue];if(ae){let pe=ae.split(":").map(za).join(":"),Se=`${ut(A)}T${pe}`;f||(ed({drawDefinition:ne,scheduledTime:Se,matchUpId:ue}),Ih({courtDayDate:A,tournamentRecords:c,tournamentRecord:J,drawDefinition:ne,matchUpId:ue,courtId:ce})),S[A].push(ue)}})})}),U[A]=_[K].matchUpsToSchedule.map(br)}!f&&(F!=null&&F.length)&&Bb({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of N.venues)for(let z of K.rounds){let te=(E=(z.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:E.filter(ie=>S[A].includes(ie));z.canScheduledMatchUpIds=te;let J=Math.round(((te==null?void 0:te.length)||0)/z.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=void 0),z.possibleToSchedulePct=J,z.matchUpsCount===(te==null?void 0:te.length)&&(z.possibleToSchedule=!0)}}let P=(n??[]).map(({scheduleDate:N})=>N),R={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P};return H4({tournamentRecords:c,autoSchedulingAudit:R}),{...X,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:b,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:U,requestConflicts:T,scheduledDates:P}}function qD(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:i=fr,scheduledDates:r,venueIds:n}=t,a=lo(t),o=Ut(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Di};let s=0;for(let l of o){let c=a[l],u=Hpe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:r,venueIds:n});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...X,clearedScheduleCount:s}}function Hpe({scheduleAttributes:t=["scheduledDate","scheduledTime","courtOrder"],ignoreMatchUpStatuses:e=fr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:fe};if(!Array.isArray(e)||!Array.isArray(n))return{error:le};n.length&&t.push("venueId");let a=kr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&Mb({schedule:u,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(u.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let c in o){let{event:u,drawDefinition:d}=An({tournamentRecord:i,drawId:c}),p=vn({drawDefinition:d,matchUpFilters:{matchUpIds:o[c]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![bu,Ld,kg,$T,xg,Fg].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(St({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...X,clearedScheduleCount:l}}function YD(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:c}=t,u=it(t,[{[rn]:!0},{[ea]:P=>!P||Array.isArray(P)&&P.every(aa),[vH]:!1,[so]:Mn}]);if(u.error)return u;let d=zu({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...X};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(P=>Og({tournamentRecord:P}).containedStructures)),g=n.map(P=>{if(aa(P))return ut(P)}).filter(Boolean),v=h.map(P=>P.scheduleDate).map(P=>aa(P)&&ut(P)).filter(P=>P&&(!n.length||g.includes(P)));if(!v.length)return{error:gG};if(r&&!l){let P=Array.isArray(r)?r:[];qD({tournamentRecords:a,scheduledDates:P})}let I=Hu({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:y}=ys({matchUpFilters:{matchUpTypes:[vi,ri]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=Wo({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:y}),{matchUpDailyLimits:S}=OD({tournamentRecords:a}),{personRequests:w}=Ip({requestType:$b,tournamentRecords:a}),U=h.filter(P=>{let R=ut(P==null?void 0:P.scheduleDate);return v.includes(R)}).sort((P,R)=>new Date(P.scheduleDate).getTime()-new Date(R.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:y,dryRun:l,courts:I};return c?Gpe(T):jpe(T)}function KD(t){let e=t||{};return e.tournamentId||(e.tournamentId=Vt()),e.startDate&&!Ad(e.startDate)&&!OS.test(e.startDate)?{error:yn}:e.endDate&&!Ad(e.endDate)&&!OS.test(e.endDate)?{error:yn}:(e.extensions&&(e.extensions=e.extensions.filter(Hs)),{...e})}function sx({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var h,f;if(!i)return{error:fe};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===It&&v===Gr),c=0;for(let g of l){let v=a&&((h=tm({element:g,accessor:a}))==null?void 0:h.value)||r&&((f=g.person)==null?void 0:f[r])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(n==null?void 0:n[c])??v,participantId:(o==null?void 0:o.pop())??Vt(),individualParticipantIds:[],participantRole:Gr,participantType:Kt};let I={value:r??e,name:DC};Ct({element:s[v],extension:I}),c+=1}s[v].individualParticipantIds.push(g.participantId)}}let u=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==Kt||g.participantRole!==Gr)return;let{extension:v}=dt({name:DC,element:g}),I=v==null?void 0:v.value;if(u.includes(I))return g.participantId}).filter(Boolean),p=0,m=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:I}=v;d.includes(I)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),p++)}),t&&p?(lt({payload:{tournamentId:i.tournamentId,participants:m},topic:Pc}),{...X,participantsAdded:p}):m.length?{...X,newParticipants:m}:{error:Fre}}var zpe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],Wpe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function z4({count:t=1,participantsCount:e=32}={}){let i=fn(Wpe),r=i.slice(0,t);return{cities:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Zn(r))}}function W4({count:t=1,participantsCount:e=32}={}){let i=fn(zpe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Re(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Zn(r))}}function q4({count:t=1,participantsCount:e=32}={}){let i=Re(0,t).map(()=>Re(0,5).map(()=>ja(0,9)).join(""));return{postalCodes:Re(0,e).map(r=>r<t?i[r]:Zn(i))}}function u0({idPrefix:t,participantType:e,index:i,uuids:r}){return t?`${t}-${e===It?"I":"P"}-${i}`:(r==null?void 0:r.pop())||Vt()}function Y4(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var qpe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brewer","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","McLuhan","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Marhsall","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function UE(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![ti,yi].includes(i))return{personData:[],error:le};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=qpe,s=em.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),c=Math.ceil(r/a.length),u=Math.ceil(r/o.length),d=Re(0,l).flatMap(()=>{let f=ke(n,!1,!0);return Re(0,n.length).map(()=>ia(f))}),p=Re(0,c).flatMap(()=>{let f=ke(a,!1,!0);return Re(0,a.length).map(()=>ia(f))}),m=Re(0,u).flatMap(()=>{let f=ke(o,!1,!0);return Re(0,o.length).map(()=>ia(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||Zn([ti,yi]),I=v===ti?m.pop():p.pop(),y=Zn(s);h[`${I}${g}`]={nationalityCode:y,sex:v,firstName:I,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function K4(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:le};let c=(a==null?void 0:a[ti])||l===ti&&e||0,u=(a==null?void 0:a[yi])||l===yi&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&UE({count:c,sex:ti}).personData||[],m=u&&UE({count:u,sex:yi}).personData||[],h=[...p,...m,...d&&UE({count:d}).personData||[]],f=h.filter(T=>!l||c&&u||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![ti,yi].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!em.find(({iso:R,ioc:D})=>[R,D].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(T.length)f=T;else return{error:le}}let v=o?f:fn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:P,femaleFirstNames:R,femaleLastNames:D,nationalityCodes:E}=h.reduce((N,A)=>{let{firstName:M,lastName:C,nationalityCode:O}=A;return A.sex===ti?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(C)||N.maleLastNames.push(C)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(C)||N.femaleLastNames.push(C)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Re(0,e-v.length).forEach(()=>{let N=l||Zn([ti,yi]),A=Zn(E),M=Zn(N===ti?T:R),C=Zn(N===ti?P:D),O={firstName:M,lastName:C,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:I,ageMaxDate:y}=Cm({consideredDate:r,category:s}),b=Je((I==null?void 0:I.slice(0,4))||0)||Je((y==null?void 0:y.slice(0,4))||0)-3,S=Je((y==null?void 0:y.slice(0,4))||0)||Je((I==null?void 0:I.slice(0,4))||0)+3,w=(I||y)&&[b,S],U=v.slice(0,e).map((T,P)=>{let[R,D]=w||[],E=w&&ia(Re(R,D)),N=ia(Re(0,365)),A=E&&tae(E,N);return Object.assign(Ge({extensions:i||[{name:"regionCode",value:P+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var Ype=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Unreturnables","Upside Downers","Vertically Challenged","Visual Spectacle"];function u1({nameRoot:t="TEAM",count:e=1}={}){let i=fn(Ype).slice(0,e);return i.length<e&&Re(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function Xg(t){let{scaledParticipantsCount:e,rankingRange:i}=t,{ratingsParameters:r=Dr,valuesInstanceLimit:n,ratingsValues:a=[],consideredDate:o,categories:s,category:l,nationalityCodesCount:c,nationalityCodeType:u,nationalityCodes:d,participantsCount:p=32,participantType:m,personIds:h,idPrefix:f,uuids:g,personExtensions:v,addressProps:I,gendersCount:y,matchUpType:b,personData:S,sex:w,inContext:U,withISO2:T,withIOC:P,scaleAllParticipants:R}=t,D=m===ot||b===Fd,E=m===Kt||b===Kt;i&&(!Array.isArray(i)||!i.every(pe=>Mi(pe))||i.length!==2)&&(i=void 0),e=R?p:e;let N=1e3,A=e&&e>N?e:N;i=i||[1,A],i[1]+=1;let M=p*(D?2:E?8:1),C=K4({count:M,personExtensions:v,consideredDate:o,gendersCount:y,personData:S,category:l,sex:w});if(C.error)return C;let{nationalityCodes:O,persons:k}=C,x={},F={},$={},_={},L=pe=>{Object.assign(x,pe.doublesRankings),Object.assign(F,pe.singlesRankings),Object.assign(_,pe.doublesRatings),Object.assign($,pe.singlesRatings)};if(Ut(l)){let pe=o2({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:l});L(pe)}Array.isArray(s)&&s.forEach(pe=>{let Se=o2({scaledParticipantsCount:e,ratingsParameters:r,participantType:m,ratingsValues:a,rankingRange:i,category:pe});L(Se)});let B=em.filter(pe=>u==="IOC"&&pe.ioc||pe.iso);function V(pe){let Se=Math.ceil(M/pe);return n&&Se>n?Math.ceil(M/n):pe}let{postalCodesProfile:G,postalCodesCount:j,statesProfile:H,citiesProfile:W,citiesCount:Y,statesCount:q}=I||{},re=pe=>Object.keys(pe).map(Se=>Re(0,H[Se]).map(()=>Se)).flat(),K=W&&re(W)||(I==null?void 0:I.cities)||z4({count:Y||M,participantsCount:M}).cities,z=H&&re(H)||(I==null?void 0:I.states)||W4({count:q||M,participantsCount:M}).states,te=G&&re(G)||(I==null?void 0:I.postalCodes)||q4({count:j||M,participantsCount:M}).postalCodes,J={cities:K,states:z,postalCodes:te},ie=V(c),ne=ie?fn(B).slice(0,c):d?B.filter(pe=>d.includes(pe.iso)):B,ue=fn(Re(0,Math.ceil(M/(ie||1))).map(()=>ne).flat(1/0)),ae=u1({count:p}).names;return{participants:Re(0,p).map(pe=>{let Se=D?2:E?8:1,Be=Re(0,Se).map(me=>{let Me=pe*Se+me;return ce(Me)}),Pe=Be.map(me=>me.participantId),at=Be.map(me=>me.person.standardFamilyName).join("/"),de=D?ot:Kt,Ie={participantId:u0({participantType:de,idPrefix:f,index:pe,uuids:g}),participantRole:Gr,participantName:D?at:ae[pe],individualParticipantIds:Pe,participantType:de};return U&&(Ie.individualParticipants=Be),D||E?[Ie,...Be]:Be}).flat(),...X};function ce(pe){let Se=k[pe],{nationalityCode:Be,participantExtensions:Pe,participantTimeItems:at,extensions:de,firstName:Ie,birthDate:me,lastName:Me,personId:be,sex:_e}=Se||{},Ne=Ie||"GivenName",se=Me||"FamilyName",ge=`${Ne} ${se}`,we=ue[pe],De=(O==null?void 0:O.length)&&Be||we&&(u==="IOC"?we.ioc||we.iso:we.iso||we.ioc)||Be;ue!=null&&ue.length&&!De&&!Be&&console.log("%c Invalid Nationality Code",{participantIndex:pe,country:we});let Le=Y4({...J,participantIndex:pe,nationalityCode:De}),ye=Ge({participantId:u0({participantType:It,index:pe,idPrefix:f,uuids:g}),extensions:Pe,timeItems:at,participantRole:Gr,participantType:It,participantName:ge,person:{personId:be||(h==null?void 0:h.length)&&h[pe]||Vt(),birthDate:aa(me)?me:void 0,addresses:[Le],standardFamilyName:se,standardGivenName:Ne,nationalityCode:De,extensions:de,sex:_e}});if(P&&De){let Ze=em.find(({iso:je})=>je===De);Ze!=null&&Ze.ioc&&(ye.person.iocNationalityCode=Ze.ioc),Ze!=null&&Ze.label&&(ye.person.countryName=Ze.label)}if(T&&De){let Ze=em.find(({iso:je})=>je===De);Ze!=null&&Ze.iso2&&(ye.person.iso2NationalityCode=Ze.iso2),Ze!=null&&Ze.label&&(ye.person.countryName=Ze.label)}let Te=Ze=>{var At,Ei,dr,mn;let je=Ze.categoryName||Ze.ratingType||Ze.ageCategoryCode,ve=(At=F[je])==null?void 0:At[pe],qt=(Ei=x[je])==null?void 0:Ei[pe];kU({scaleValue:ve,eventType:wm,scaleType:Sc,participant:ye,category:Ze}),kU({scaleValue:qt,eventType:Uc,scaleType:Sc,participant:ye,category:Ze});let Xi=(dr=$[je])==null?void 0:dr[pe],Ke=(mn=_[je])==null?void 0:mn[pe];kU({scaleValue:Xi,eventType:wm,scaleType:vc,participant:ye,category:Ze}),kU({scaleValue:Ke,eventType:Uc,scaleType:vc,participant:ye,category:Ze})};return Array.isArray(s)?s.forEach(Ze=>Te(Ze)):l&&Te(l),ye}}function kU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[Nd,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function o2(t){let{category:e,scaledParticipantsCount:i,ratingsParameters:r,participantType:n,ratingsValues:a=[]}=t,o=e.rankingRange||t.rankingRange||[1,1e3],s={},l={},c={},u={},{categoryName:d,ageCategoryCode:p,ratingType:m}=e,h=e.categoryName||e.ratingType||e.ageCategoryCode;if((d||p)&&!m){let[f,g]=o||[];if(l[h]=fn(Re(f,g)).slice(0,i||ja(20,30)),[ot,Kt].includes(n)){let[v,I]=o||[];s[h]=fn(Re(v,I)).slice(0,i||ja(20,30))}}if(m&&r[m]){let{ratingMax:f,ratingMin:g,ratingAttributes:v}=e,I={...r[m],...v||{}},{attributes:y={},decimalsCount:b,accessors:S,range:w,step:U}=I,T=N=>{let A={},M=Object.keys(N||{});for(let C of M){let O=N[C];if(typeof O=="object"&&O.generator){let{range:k}=O,[x,F]=k.slice().sort();A[C]=ja(x,F)}else A[C]=O}return A},P=w[0]>w[1]?2:.7,[R,D]=w.slice().sort(),E=Re(0,2e3).map(()=>eH(R,D,P,U,b)).filter(N=>(!f||N<=f)&&(!g||N>=g)).slice(0,i||ja(20,30)).map(N=>S?Object.assign({},...S.map(A=>({[A]:N})),T(y)):N);c[h]=[...a,...E],[ot,Kt].includes(n)&&(u[h]=[...a,...E])}return{singlesRankings:l,doublesRankings:s,singlesRatings:c,doublesRatings:u}}function lx(t){var m,h;let{alternatesCount:e=0,tieFormatName:i,drawSize:r}=t,n=0,a=0,o=0,s=0,l={},c={[ti]:0,[yi]:0,[Gn]:0,[Pd]:0,[Is]:0};(h=(m=Ut(t.tieFormat)?t.tieFormat:zd({namedFormat:i}))==null?void 0:m.collectionDefinitions)==null||h.filter(Boolean).forEach(f=>{let{category:g,collectionId:v,matchUpType:I,matchUpCount:y,gender:b}=f;if([ti,yi].includes(b)){let S=y*(I===ri?2:1);c[b]<S&&(c[b]=S)}else b===Gn&&(c[ti]<y&&(c[ti]=y),c[yi]<y&&(c[yi]=y));if(g){let S=JSON.stringify(g);l[S]=g}if(v||(f.collectionId=Vt()),$i(ri)(I)){let S=y;s+=y,n=Math.max(n,S)}if($i(vi)(I)){let S=y;o+=y,a=Math.max(a,S)}});let u=Object.keys(l).length?Math.max(o,s*2):Math.max(a,n*2),d=n*(r+e),p=a*(r+e);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function Kpe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=It}=t||{},a=r||0,o={[yi]:0,[Gn]:0,[Pd]:0,[ti]:0,[Is]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:I,tieFormat:y,category:b,gender:S,stage:w})=>{let U=I===eo,T=I===or,P=!!(f||w===We||b||S);if(T){u=Math.max(u,v+h),y=typeof y=="object"?y:zd({namedFormat:g});let{teamSize:R,maxDoublesDraw:D,maxSinglesDraw:E,genders:N}=lx({alternatesCount:h,tieFormatName:g,tieFormat:y,drawSize:v});c=Math.max(c,R),l=Math.max(l,E),P||(s=Math.max(s,D)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(P){let R=(v+h)*2;d+=R,S&&(o[S]+=R)}else v+h&&v+h>s&&(s=v+h);else if(P){let R=v+h;S&&(o[S]+=R),d+=R}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:I,category:y,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:I,category:y,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(u*c,s*2,l);return s&&(n=ot),(r||a)<m&&(r=m),r&&s&&[ot,or].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:u,largestTeamSize:c,participantType:n,gendersCount:o}}function J4({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=Kpe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=Xg({consideredDate:n,...t,participantsCount:o,participantType:s,gendersCount:u,uuids:a}).participants,m=0,h=xo({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let I=sx({tournamentRecord:e,...d});if(I.error)return I}let f=p.filter(({participantType:I})=>I===It).map(vt),g=t!=null&&t.idPrefix?`${Kt}-${t.idPrefix}`:void 0,v=Re(0,l).map(I=>{let y=f.slice(I*c,(I+1)*c),b=u0({index:I,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${I+1}`,participantRole:Gr,individualParticipantIds:y,participantType:Kt,participantId:b}});return h=xo({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...X})}function X4({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Ae,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(c||p)-l;return u||i||e||d===We?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function Z4({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Ae]||0,a=e[We]||0;return{stageParticipants:{QUALIFYING:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var Jpe={[Lt]:2,[tr]:1,[mr]:1,[nn]:1,[Rt]:4};function ux(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=Jpe,matchUpFormat:n=du,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!da({matchUpFormat:n}))return{error:vN};if(typeof r!="object")return{error:le};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:le};let s=Object.keys(r).filter(T=>Object.keys(zH).includes(T)&&T!==_i);if(Object.keys(s).reduce((T,P)=>T+r[P],0)>100)return{error:le,matchUpStatusProfile:r};let l=s.reduce((T,P)=>(T.pointer=T.pointer+r[P],T.valueMap.push([T.pointer,P]),T),{pointer:0,valueMap:[]}),c=ja(1,100),u=(l.valueMap.find(T=>c<=T[0])??[100,_i])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Lt,Rt].includes(u)){i=i||ja(1,2);let T={score:d,winningSide:i,matchUpStatus:u};if(!(u===Rt&&ja(1,100)>100-e))return{outcome:T}}else if([tr,mr].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=Ln(n),{bestOf:m,setFormat:h,finalSetFormat:f}=p??{},g=[],v=ja(0,1),I=i?[i-1]:[...Re(0,o).map(()=>v),1-v],y=[nn,Rt,vs,Yc].includes(u)&&(ia(Re(1,m))||1),b;for(let T of Re(1,(m??0)+1)){let P=T===m,{set:R,incomplete:D,winningSideNumber:E}=Xpe({incomplete:y===T,matchUpStatus:u,pointsPerMinute:a,setFormat:P&&f||h,setNumber:T,weightedRange:I});if(g.push(R),D){b=E;break}if(GI({matchUp:{score:{sets:g},matchUpFormat:n}}).calculatedWinningSide)break}let S=GI({matchUp:{score:{sets:g},matchUpFormat:n}}),w=b?i||b:S.calculatedWinningSide,{score:U}=x4({score:{sets:g},winningSide:w,matchUpStatus:u});return{outcome:{score:U,winningSide:w,matchUpStatus:u}}}function Xpe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=n,m=ja(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),I=g+ia([1,-1])*v,y=sne(I,2),b=[y,I-y];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,P]=b;return Object.assign(o,{side1Score:T,side2Score:P}),fr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[ja(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=ja(0,c),o.side2Score=ja(0,c),fr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Re(1,s+1).map(U=>Re(0,s+2-U).map(()=>U)).flat(),v=g[ja(0,g.length-1)],I=s&&KO({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),y=!I,b=t.length===1&&t[m]+1;if(!y){b?(I[0]>I[1]?1:2)!==b&&I.reverse():h&&I.reverse();let[U,T]=I;Object.assign(o,{side1Score:U,side2Score:T})}let S=VI({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||y){let{NoAD:U,tiebreakTo:T}=l||u||{},P=Re(1,T+1).map(E=>Re(0,T+2-E).map(()=>E)).flat(),R=P[ja(0,P.length-1)],D=bD({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:R});if(D)if(y){let E=D[0]>D[1]?1:2;b?E!==b&&D.reverse():h&&D.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=D,w=D[0]>D[1]&&1||D[1]>D[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=D:[o.side2TiebreakScore,o.side1TiebreakScore]=D}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function c0(t){var f,g,v;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:r,tournamentRecord:n,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:xe};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),c=o.structures.slice().sort(ih),u=0,{matchUps:d,matchUpsMap:p}=ur({contextFilters:{stages:[Ae,We]},matchUpFilters:{matchUpTypes:[ci],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let I=((f=s==null?void 0:s.category)==null?void 0:f.ageCategoryCode)||((g=s==null?void 0:s.category)==null?void 0:g.categoryName);if(I){let y=p4({singlesOnly:!0,tournamentRecord:n,drawDefinition:o,scaleAccessor:{scaleName:I,sortOrder:d4,scaleType:Sc},event:s});if(y.error)return y;let{lineUps:b,participantsToAdd:S}=y;xo({tournamentRecord:n,participants:S}),Ct({element:o,extension:{name:hu,value:b}})}else{let y=(v=d[0])==null?void 0:v.structureId,{positionAssignments:b}=Qt({drawDefinition:o,structureId:y});if(b!=null&&b.length){let{participants:S}=Gi({participantFilters:{participantTypes:[ci]},tournamentRecord:n}),w=U=>{let T=U.tieMatchUps.filter($i(vi)),P=U.tieMatchUps.filter($i(ri));T.forEach((R,D)=>{let E=R.matchUpId;R.sides.forEach(N=>{var C;let{drawPosition:A}=N,M=S==null?void 0:S.find(O=>{var x;let{participantId:k}=O;return((x=b.find(F=>F.participantId===k))==null?void 0:x.drawPosition)===A});if(M){let O=(C=M.individualParticipantIds)==null?void 0:C[D];O&&l0({teamParticipantId:M.participantId,participantId:O,tournamentRecord:n,drawDefinition:o,tieMatchUpId:E,event:s})}})}),P.forEach((R,D)=>{let E=R.matchUpId;R.sides.forEach(N=>{var C,O;let{drawPosition:A}=N,M=S==null?void 0:S.find(k=>{var F;let{participantId:x}=k;return((F=b.find($=>$.participantId===x))==null?void 0:F.drawPosition)===A});M&&((O=(C=M.individualParticipantIds)==null?void 0:C.slice(D*2,D*2+2))==null||O.forEach(k=>{l0({teamParticipantId:M.participantId,participantId:k,tournamentRecord:n,drawDefinition:o,tieMatchUpId:E,event:s})}))})})};d.forEach(w)}}}let m=typeof i=="string"&&i,h=m&&_i;for(let I of c){if(u>=a)break;let{matchUps:y}=_t({matchUpFilters:{matchUpTypes:[ri,vi]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:I,event:s}),b=y.filter(({winningSide:S})=>!S).sort(lh).map(br);for(let S of b){if(!isNaN(a)&&u>=a)break;let{matchUps:w}=_t({matchUpFilters:{matchUpTypes:[ri,vi]},afterRecoveryTimes:!1,tournamentRecord:n,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:I,event:s}),U=w.find(P=>P.matchUpId===S),T=[tr,mr].includes(U.matchUpStatus);if(U!=null&&U.readyToScore&&!T){let P=Zpe({winningSide:!r&&1,matchUpStatusProfile:e,tournamentRecord:n,drawDefinition:o,targetMatchUp:U,matchUpFormat:l,matchUpStatus:h,scoreString:m,event:s});if(P!=null&&P.error)return P;u+=1}}}return{...X,completedCount:u}}function Q4(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===xt)return;let{matchUpId:d}=a||{},{outcome:p}=ix({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),Lb({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function Zpe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||a)return Q4(t);let{matchUpId:d}=s||{},{outcome:p}=ux({matchUpStatusProfile:e,matchUpFormat:o,winningSide:c});return Lb({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function e5({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,isMock:a,event:o}){var f,g,v,I;let s=qi({event:o}).flightProfile,{eventName:l,eventType:c,category:u}=o,{startDate:d}=r,p=[],m=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(u==null?void 0:u.ratingType),h=(f=o.drawDefinitions)==null?void 0:f.map(({drawId:y})=>y);if(Array.isArray(s==null?void 0:s.flights))for(let[y,b]of s.flights.entries()){let{drawId:S,stage:w,drawName:U,drawEntries:T}=b;p.push(b.drawId);let P=n[y],{seedsCount:R,generate:D=!0}=P||{};if(D){let E=T.filter(ca(Nl)).map(ca(Nl)),N=m||l;if(r&&R&&R<=E.length&&Re(1,R+1).forEach((k,x)=>{let F={scaleValue:k,scaleName:N,scaleType:Il,eventType:c,scaleDate:d},$=E[x];Pb({tournamentRecord:r,participantId:$,scaleItem:F})}),h==null?void 0:h.includes(S))break;let A=Ab({...P,matchUpType:c,seedingScaleName:N,tournamentRecord:r,drawEntries:T,drawName:U,drawId:S,isMock:a,event:o,stage:w});if(A.error)return{error:A.error,drawIds:[]};let{drawDefinition:M}=A;if(!M)return{error:Pa};let C=(g=n[y])==null?void 0:g.drawExtensions;if(Array.isArray(C)&&C.filter(Hs).forEach(k=>Ct({element:M,extension:k})),A=Ob({suppressNotifications:!0,tournamentRecord:r,drawDefinition:M,event:o}),A.error)return{error:A.error,drawIds:[]};if(P!=null&&P.withPlayoffs){let k=(v=M.structures)==null?void 0:v[0].structureId,x=lD({idPrefix:P.idPrefix,...P.withPlayoffs,tournamentRecord:r,drawDefinition:M,structureId:k,isMock:a,event:o});if(x!=null&&x.error)return x}let O=P==null?void 0:P.completionGoal;if((P==null?void 0:P.automated)!==!1&&(e||O)){let k=P==null?void 0:P.matchUpFormat,x=c0({completeAllMatchUps:!O&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:O,drawDefinition:M,matchUpFormat:k,event:o});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((P==null?void 0:P.drawType)===Fl){let $=(I=M.structures)==null?void 0:I.find(B=>B.stage===Ae);if(!$)return{error:Ti};let _=mb({structureId:$.structureId,tournamentRecord:r,drawDefinition:M,event:o});if(_.error)return{error:_.error,drawIds:[]};let L=O?O-(F??0):void 0;if(_=c0({completeAllMatchUps:!O&&e,completionGoal:O?L:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:M,matchUpFormat:k,event:o}),_.error)return{error:_.error,drawIds:[]}}}}}return{...X,drawIds:p}}function t5(t){var w,U;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:r,tournamentRecord:n,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:c,gender:u,eventType:d}=s,p=$i(Gs)(d)&&It||$i(eo)(d)&&ot||d,m=i[Ae]||0,h=i[We]||0,f=(w=a.drawProfiles)!=null&&w.length?m+h:((U=a.participantsProfile)==null?void 0:U.participantsCount)??0,g=[ti,yi].includes(u)?u:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:I}=Xg({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:n==null?void 0:n.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:f,ratingsParameters:r,category:c,idPrefix:v,sex:g}),y=xo({tournamentRecord:n,participants:I});if(y.error)return y;let b=I==null?void 0:I.filter(({participantType:T})=>T===p),S=I==null?void 0:I.map(vt);return{uniqueDrawParticipants:b,uniqueParticipantIds:S}}function Qpe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Fs,qualifyingPositions:o=0,stage:s=Ae,drawSize:l=0,drawName:c,drawId:u}=r,d=l-o,p=i.slice(0,d).map(vt);if(p.length){let f=wl({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:ua,entryStage:s,participantId:f})),h=LD({drawName:c||a,qualifyingPositions:o,drawEntries:m,drawId:u,event:n,stage:s});return h.error?h:{...X}}function i5({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let c of n){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Ae,drawSize:m=0}=c,h=m-u,f=d||o||a||p===We,g=f?t.slice(l,l+h):i[p||Ae]||[];f&&(l+=h);let v=Qpe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:c,event:s});if(v.error)return v}return{...X}}function r5(t){var W;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:m,uuids:h}=t,f=u.gender,g=u.eventName,{eventType:v=Gs,policyDefinitions:I,drawProfiles:y=[],eventExtensions:b,surfaceCategory:S,tieFormatName:w,processCodes:U,discipline:T,eventLevel:P,timeItems:R,ballType:D,category:E}=u,N=u.eventId||Vt(),A=u.tieFormat||(v===or?zd({namedFormat:w,event:{eventId:N,category:E,gender:f},hydrateCollections:o,isMock:m}):void 0),M=c.participants;for(let Y of y)!f&&Y.gender&&(f=Y==null?void 0:Y.gender);let{stageParticipantsCount:C,uniqueParticipantsCount:O,uniqueParticipantStages:k}=X4({drawProfiles:y,category:E,gender:f}),x=$i(Gs)(v)&&It||$i(eo)(v)&&ot||v,{uniqueDrawParticipants:F=[],uniqueParticipantIds:$=[]}=k?t5({event:{eventType:v,category:E,gender:f},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:h}):{},{eventAttributes:_}=u;typeof _!="object"&&(_={});let L=(E==null?void 0:E.categoryName)||(E==null?void 0:E.ageCategoryCode)||(E==null?void 0:E.ratingType);g=g||L||"Generated Event";let B={..._,surfaceCategory:S,processCodes:U,discipline:T,eventLevel:P,eventName:g,eventType:v,tieFormat:A,ballType:D,category:E,eventId:N,gender:f};if(b!=null&&b.length&&Array.isArray(b)){let Y=b.filter(Hs);Y!=null&&Y.length&&Object.assign(B,{extensions:Y})}if(Array.isArray(R)&&R.forEach(Y=>hh({event:j,timeItem:Y})),typeof I=="object")for(let Y of Object.keys(I))jd({policyDefinitions:{[Y]:I[Y]},event:B});B.category&&(B.category.categoryName=L);let V,G=kb({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:B});if(G.error)return G;let j=G==null?void 0:G.event,{stageParticipants:H}=Z4({allUniqueParticipantIds:e,stageParticipantsCount:C,eventParticipantType:x,targetParticipants:M});if(y!=null&&y.length){let Y=i5({uniqueDrawParticipants:F,autoEntryPositions:a,stageParticipants:H,tournamentRecord:c,drawProfiles:y,category:E,gender:f,event:j});if(Y.error)return Y;let q=e5({matchUpStatusProfile:i,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:c,drawProfiles:y,isMock:m,event:j});if(q.error)return q;V=q.drawIds}else if((W=u==null?void 0:u.participantsProfile)!=null&&W.participantsCount){let Y=F.map(vt);if(Y.length){let q=wl({participantIds:Y,autoEntryPositions:a,tournamentRecord:c,entryStage:Ae,event:j});if(q.error)return q}}return p&&qg({tournamentRecord:c,event:j}),{drawIds:V,eventId:N,uniqueParticipantIds:$}}function cx({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!aa(e))return{error:yn};let n="addSchedulingProfileRound",{extension:a}=dt({name:Dm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Ol(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=SD({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:yn};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(m=>!c.includes(m)).sort().map(m=>Ut(p[m])?u(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>u(p)===u(r)))return Q({result:{error:rG},stack:n});l.rounds.push(r);let d=Hg({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...X}}function eme({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:le};let i=Og({tournamentRecord:e}).containedStructures,r=kr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var b;let I=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),y=(b=v.finishingPositionRange)==null?void 0:b.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!y||!I||Vi(y,I).length===2||mt(y).length===mt(I).length&&Vi(y,I).length===mt(y).length)})[0];if(g){let{eventId:v,roundNumber:I,drawName:y,structureName:b,roundName:S}=g,w=g.structureId;I&&!h&&(w=Object.keys(i).find(P=>i[P].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:I,roundSegment:f,eventId:v,drawId:m},T=cx({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:y,...U})}}}}return{scheduledRounds:a}}function JD(t){var Be,Pe,at;let e=it(t,[{drawProfile:!0,_ofType:Sa}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:r={},matchUpStatusProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:m,drawIndex:h,uuids:f}=t,g=ke(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:I=du,drawType:y=Fs,tournamentAlternates:b=0,alternatesCount:S=0,qualifyingPositions:w,qualifyingProfiles:U,generate:T=!0,eventExtensions:P,drawExtensions:R,completionGoal:D,tieFormatName:E,seedsCount:N,timeItems:A,drawName:M,category:C,idPrefix:O,publish:k,gender:x,stage:F}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),_=g.eventId||Vt(),L=p.eventType||p.matchUpType||Gs,B=L===eo?ot:It,V=Ut(p.tieFormat)&&p.tieFormat||L===Kt&&zd({event:{eventId:_,category:C,gender:x},namedFormat:E,hydrateCollections:s,isMock:d})||void 0,G=(C==null?void 0:C.categoryName)||(C==null?void 0:C.ageCategoryCode)||(C==null?void 0:C.ratingType),j=p.eventName||G||`Generated ${L}`,H=(u==null?void 0:u.participants)||[],W=((U==null?void 0:U.map(de=>de.structureProfiles||[]).flat().reduce((de,Ie)=>{let me=!Ie.participantsCount||Ie.participantsCount>Ie.drawSize?Ie.drawSize:Ie.participantsCount||0;return de+me},0))||0)*(B===ot?2:1),Y=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,q={eventName:j,eventType:L,tieFormat:V,category:C,eventId:_,gender:x};Array.isArray(A)&&A.forEach(de=>hh({event:q,timeItem:de}));let{eventAttributes:re}=p;if(typeof re!="object"&&(re={}),Object.assign(q,re),(P==null?void 0:P.length)&&Array.isArray(P)){let de=P.filter(Hs);de!=null&&de.length&&Object.assign(q,{extensions:de})}let K=[];if(W||p.uniqueParticipants||!u||x||C){let de=(Y||0)+S+W,Ie=de,me={[ti]:0,[yi]:0},Me,be;L===Kt&&({teamSize:Me,genders:be}=lx({alternatesCount:S,tieFormatName:E,tieFormat:V,drawSize:$}),Object.keys(be).forEach(se=>{[ti,yi].includes(se)&&be[se]&&(me[se]=$*be[se])}),Ie=Me*(($||0)+W));let _e=r!=null&&r.idPrefix?`D-${h}-${r==null?void 0:r.idPrefix}`:void 0,Ne=Xg({...r,scaledParticipantsCount:p.scaledParticipantsCount||r.scaledParticipantsCount,participantsCount:Ie,consideredDate:u==null?void 0:u.startDate,sex:x||(r==null?void 0:r.sex),rankingRange:p.rankingRange,uuids:p.uuids||f,ratingsParameters:c,participantType:B,gendersCount:me,idPrefix:_e,category:C}).participants;if(q.category&&(q.category.categoryName=G),u){let se=xo({participants:Ne,tournamentRecord:u});if(se.error)return se}if(Ne.forEach(({participantId:se})=>K.push(se)),H=Ne,L===Kt){let se=be[ti]?Ne.filter(({participantType:ve,person:qt})=>ve===It&&(qt==null?void 0:qt.sex)===ti).map(vt):[],ge=be[yi]?Ne.filter(({participantType:ve,person:qt})=>ve===It&&(qt==null?void 0:qt.sex)===yi).map(vt):[],we=Ne.filter(({participantType:ve})=>ve===It).map(vt).filter(ve=>!se.includes(ve)&&!ge.includes(ve)),De=Me-(be[ti]+be[yi]),Le=0,ye=0,Te=0,Ze=Re(0,de).map(ve=>{let qt=ge.slice(Le,Le+be[yi]),Xi=se.slice(ye,ye+be[ti]),Ke=we.slice(Te,Te+De);return Le+=be[yi],ye+=be[ti],Te+=De,{individualParticipantIds:[...qt,...Xi,...Ke],participantOtherName:`TM${ve+1}`,participantName:`Team ${ve+1}`,participantRole:Gr,participantType:Kt,participantId:Vt()}}),je=xo({participants:Ze,tournamentRecord:u});if(!je.success)return je;H=Ze}}let z=de=>{let{participantType:Ie}=de;return $i(Gs)(L)&&Ie===It||$i(eo)(L)&&Ie===ot?!0:L===Kt&&Ie===Kt},te=de=>{var Ie,me;return!p.gender||((Ie=de.person)==null?void 0:Ie.sex)===p.gender?!0:(me=de.individualParticipantIds)==null?void 0:me.some(Me=>{let be=H.find(_e=>_e.participantId===Me);return be&&te(be)})},J=H.filter(z).filter(te).filter(({participantId:de})=>!i.includes(de)),ie=J.slice(0,Y).map(de=>de.participantId);if(d&&(ie!=null&&ie.length)){let de=wl({autoEntryPositions:o,entryStage:F,tournamentRecord:u,participantIds:ie,event:q});if(de.error)return de}let ne=W?J.slice(Y,Y+W).map(de=>de.participantId):0;if(d&&(ne!=null&&ne.length)){let de=0,Ie=1,me=(be,_e)=>be.stageSequence-_e.stageSequence,Me=(be,_e)=>be.roundTarget-_e.roundTarget;for(let be of U.sort(Me)){Ie=be.roundTarget||Ie;let _e=1,Ne;for(let se of be.structureProfiles.sort(me)){let ge=(se.drawSize||LN(se.participantsCount))-(Ne||0),we=ne.slice(de,de+ge),De=wl({entryStage:We,entryStageSequence:_e,autoEntryPositions:o,tournamentRecord:u,participantIds:we,roundTarget:Ie,event:q});if(De.error)return De;Ne=se.qualifyingPositions,de+=ge,_e+=1}Ie+=1}}let ue=v&&((Be=u==null?void 0:u.participants)==null?void 0:Be.filter(({participantId:de})=>!ie.includes(de)).filter(z).filter(te).slice(0,S||$-Y||b).map(de=>de.participantId));if(d&&(ue!=null&&ue.length)){let de=wl({participantIds:ue,autoEntryPositions:!1,entryStatus:To,tournamentRecord:u,event:q});if(de.error)return de.error}let ae=G||j;u&&N&&N<=ie.length&&Re(1,N+1).forEach((de,Ie)=>{let me={scaleName:ae,scaleDate:m,scaleType:BA,scaleValue:de,eventType:L},Me=ie[Ie];Pb({tournamentRecord:u,participantId:Me,scaleItem:me})});let ce=Ab({...ke(p,!1,!0),tournamentRecord:u,seedingScaleName:ae,matchUpFormat:I,eventId:_,isMock:d,event:q});if(ce.error)return ce;if(!ce.drawDefinition)return{error:Pa};let{drawDefinition:pe}=ce,Se=pe.drawId;if(Array.isArray(R)&&R.filter(Hs).forEach(de=>Ct({element:pe,extension:de})),T){if(Ob({drawDefinition:pe,event:q,suppressNotifications:!0}),p.withPlayoffs){let Ie=(Pe=pe.structures)==null?void 0:Pe[0].structureId,me=lD({...p.withPlayoffs,tournamentRecord:u,drawDefinition:pe,structureId:Ie,idPrefix:O,isMock:d,event:q});if(me!=null&&me.error)return me}let de=p.automated===!1;if(d&&!de){let Ie=me=>{var _e;let Me=c0({completeAllMatchUps:me.completeAllMatchUps,completionGoal:me.completionGoal,matchUpStatusProfile:n,randomWinningSide:l,tournamentRecord:u,drawDefinition:pe,matchUpFormat:I,event:q});if(Me.error)return Me;let be=Me.completedCount;if(y===Fl){let Ne=(_e=pe.structures)==null?void 0:_e.find(we=>we.stage===Ae);if(!Ne)return{error:Ti};mb({structureId:Ne.structureId,tournamentRecord:u,drawDefinition:pe,event:q});let se=D?D-(be??0):void 0,ge=c0({completionGoal:D?se:void 0,matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:pe,matchUpFormat:I,event:q});if(ge.error)return ge}};if(D&&Ie({completionGoal:D}),p.outcomes){let{matchUps:me}=vn({inContext:!0,drawDefinition:pe,event:q});for(let Me of p.outcomes){let{matchUpStatus:be=_i,matchUpStatusCodes:_e,stageSequence:Ne=1,matchUpIndex:se=0,structureOrder:ge,matchUpFormat:we,drawPositions:De,roundPosition:Le,stage:ye=Ae,roundNumber:Te,winningSide:Ze,scoreString:je}=Me,ve=(me==null?void 0:me.reduce((At,Ei)=>{let{structureId:dr,matchUpId:mn}=Ei;return At[dr]?At[dr].push(mn):At[dr]=[mn],At},{}))??[],qt=Object.assign({},...Object.keys(ve).map((At,Ei)=>({[At]:Ei+1}))),Xi=(at=me==null?void 0:me.filter(At=>(!ye||At.stage===ye)&&(!Ne||At.stageSequence===Ne)&&(!Te||At.roundNumber===Te)&&(!Le||At.roundPosition===Le)&&(!ge||qt[At.structureId]===ge)&&(!De||Vi(De,At.drawPositions).length===2)))==null?void 0:at[se],Ke=Q4({matchUpStatusCodes:_e,tournamentRecord:u,drawDefinition:pe,targetMatchUp:Xi,matchUpFormat:we,matchUpStatus:be,scoreString:je,winningSide:Ze});if(Ke!=null&&Ke.error)return Ke}}a&&Ie({completeAllMatchUps:a})}k&&qg({tournamentRecord:u,event:q})}else{let de=LD({drawEntries:pe.entries,drawName:M||y,qualifyingPositions:w,drawId:Se,event:q,stage:F});if(de.error)return de}return{...X,event:Ge(q),uniqueParticipantIds:K,targetParticipants:H,drawDefinition:pe,eventId:_,drawId:Se}}var n5=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),tme=n5;function d0(t){return parseInt(t)}function s2({startTime:t="",endTime:e=""}={}){if(!t||!e||!Dd.test(t)||!Dd.test(e))return!1;let[i,r]=t.split(":").map(d0),[n,a]=e.split(":").map(d0);return n<i?!1:!(i===n&&a<r)}function ime(t,e){let[i,r]=t.startTime.split(":").map(d0),[n,a]=e.startTime.split(":").map(d0);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function a5({dateAvailability:t}){if(!t)return{error:vG};if(!Array.isArray(t))return{error:YU};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:YU};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:YU};if(n&&!Al.test(n))return{error:yn,dateAvailability:{date:n},info:e};if(!Dd.test(a))return{error:go,dateAvailability:{startTime:a},info:i};if(!Dd.test(o))return{error:go,dateAvailability:{endTime:o},info:i};if(a===o)return{error:go,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!s2({startTime:a,endTime:o}))return{error:go,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:NS};for(let l of s){if(typeof l!="object")return{error:NS};let{startTime:c,endTime:u}=l;if(!Dd.test(c))return{error:go,booking:{startTime:c},info:i};if(!Dd.test(u))return{error:go,booking:{endTime:u},info:i};if(c===u)return{error:go,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!s2({startTime:c,endTime:u}))return{error:go,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function XD({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=ju({tournamentRecord:t,venueId:i});if(!a)return{error:Jm};a.courts||(a.courts=[]);let o={...n5(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Vt()),a.courts.some(s=>s.courtId===o.courtId))return{error:kG};{let s=((n==null?void 0:n.dateAvailability)||[]).map(u=>{var d;return{...u,date:ut(u.date),startTime:mi(u.startTime),endTime:mi(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:mi(p),endTime:mi(m),bookingType:h}))}}),l=Object.keys(o);for(let u of l)if(n!=null&&n[u])if(u==="dateAvailability"){let d=a5({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[u]=n[u];let c=o;return a.courts.push(c),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:dp,key:a.venueId}),{...X,court:ke(o),venueId:i}}}function dx(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:zc};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=ju({tournamentRecord:o,venueId:i});if(s){let l=rme({...t,tournamentRecord:o});for(let c of(l==null?void 0:l.courts)??[])n.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...X,courtIds:n}:{error:Jm}}function rme({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:zc};let m=ju({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!Mi(o)||!n)return{error:OG};o=o??n.length;let f=Re(0,o).map(g=>{let v=a==null?void 0:a[g],I=v?p.map(y=>({date:os(y),startTime:s,endTime:c,...v})):e;return v&&s&&c&&I.push({startTime:s,endTime:c}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:I}}).map((g,v)=>{let I=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return XD({disableNotice:!0,tournamentRecord:r,courtId:I,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?Q({info:"not all courts could be generated",result:{error:le}}):(h&&lt({payload:{venue:h,tournamentId:r.tournamentId},topic:dp,key:h.venueId}),{...X,courts:ke(f)})}function px({tournamentRecord:t,ignoreExistingVenues:e,venueProfiles:i,uuids:r}){let{startDate:n,endDate:a}=t,o=[];for(let[s,l]of i.entries()){let{venueAbbreviation:c,venueId:u=(r==null?void 0:r.pop())??Vt(),dateAvailability:d,startTime:p="07:00",endTime:m="19:00",courtTimings:h,courtsCount:f,courtNames:g,venueName:v,idPrefix:I,courtIds:y}=l,b={venueName:v||`Venue ${s+1}`,venueAbbreviation:c,venueId:u},S=eb({tournamentRecord:t,venue:b});if(S.error){if(e)continue;return S}o.push(u);let w=Tf(n,a),U=!Array.isArray(d)&&[{startTime:p,endTime:m}].concat(w.map(T=>({date:os(T),startTime:p,endTime:m})));if(f||g){let T=dx({dateAvailability:d||U,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:g,startTime:p,idPrefix:I,courtIds:y,endTime:m,venueId:u,dates:w});if(T.error)return T}}return o}function nme(t){var u,d,p;let{tournamentRecord:e,leagueProfiles:i,eventIds:r,venueIds:n,drawIds:a,allUniqueParticipantIds:o,uuids:s}=t,l=0;for(let m of i){let h=[],{tieFormatName:f=a0,teamProfiles:g=[],teamsCount:v=0,category:I,idPrefix:y,gender:b}=m,S=m.leagueName??m.eventName??`League ${l+1}`,w=m.leagueId??m.eventId??(s==null?void 0:s.pop())??Vt();r.push(w);let U=Ut(m.tieFormat)&&m.tieFormat||zd({event:{eventId:w,category:I,gender:b},namedFormat:f,isMock:t.isMock})||void 0;if(!U)return{error:wg};let T=Math.max(v,g.length),P=Re(0,T),{genders:R,teamSize:D}=lx({tieFormat:U,drawSize:T}),E={[yi]:0,[Gn]:0,[Pd]:0,[ti]:0,[Is]:0};Object.keys(R).forEach(A=>E[A]+=R[A]);for(let A of P){let M=((u=g==null?void 0:g[A])==null?void 0:u.teamName)??`Team ${A+1}`,C=((d=g==null?void 0:g[A])==null?void 0:d.teamId)||(s==null?void 0:s.pop())||Vt(),O=m.startDate??t.startDate,k=Xg({...m==null?void 0:m.participantsProfile,participantsCount:D,consideredDate:O,gendersCount:E,category:I,gender:b,uuids:s}).participants,x=k.map(V=>V.participantId),F=Kt,$=C??u0({participantType:F,idPrefix:y,index:A,uuids:s});h.push({participantId:$,entryStatus:ua,entryStage:Ae});let _=((p=g==null?void 0:g[A])==null?void 0:p.venueIds)??[],L={participantId:$,participantRole:Gr,participantName:M,individualParticipantIds:x,participantType:F,homeVenueIds:_};_.forEach(V=>!n.includes(V)&&n.push(V)),o.push(...x),o.push($);let B=xo({participants:[L,...k],tournamentRecord:e});if(B.error)return B}let N={eventName:S,entries:h,eventType:Kt,tieFormat:U,category:I,eventId:w,gender:b};if(e.events||(e.events=[]),e.events.push(N),h.length){let A=Mi(m.roundsCount)?m.roundsCount:m.roundsCount===Uae?(T-1)*2:T-1,M=Ab({automated:m.automated,tournamentRecord:e,drawType:io,roundsCount:A,drawSize:T,event:N});if(M.error)return M;let{drawDefinition:C}=M;if(C){let O=C==null?void 0:C.drawId;Ob({drawDefinition:C,event:N,suppressNotifications:!0}),a.push(O)}}l++}let c=n.map(m=>({venueId:m}));px({tournamentRecord:e,ignoreExistingVenues:!0,venueProfiles:c,uuids:s})}var ame=["Generated Tournament","CourtHive Challenge","Replication Crisis","Open Competition","Factory Follies","Mock Tournament","Atomic Culture","Racket Rally","Stats Fail"];function o5(t){var I,y,b;let{startDate:e,endDate:i}=t??{},{tournamentName:r=ia(ame),ratingsParameters:n=Dr,tournamentExtensions:a,policyDefinitions:o,schedulingProfile:s,venueProfiles:l,uuids:c}=t??{},u=(t==null?void 0:t.isMock)===!1?void 0:!0;if(e&&!aa(e)||i&&!aa(i))return{error:yn};if(t.leagueProfiles&&!Array.isArray(t.leagueProfiles)||t.eventProfiles&&!Array.isArray(t.eventProfiles)||t.drawProfiles&&!Array.isArray(t.drawProfiles))return{error:le};if(!e){let S=new Date;e=os(i??S),i=os(S.setDate(S.getDate()+7))}if(!i){let S=new Date(e);i=os(S.setDate(S.getDate()+7))}let d=KD({...t.tournamentAttributes??{},tournamentName:r,startDate:e,endDate:i,isMock:u}),p=l!=null&&l.length?px({tournamentRecord:d,venueProfiles:l,uuids:c}):[];if(a!=null&&a.length&&Array.isArray(a)){let S=a.filter(w=>Hs({extension:w}));S!=null&&S.length&&Object.assign(d,{extensions:S,isMock:u})}if(typeof o=="object")for(let S of Object.keys(o))jd({policyDefinitions:{[S]:o[S]},tournamentRecord:d});if(!((I=t==null?void 0:t.leagueProfiles)!=null&&I.length)||(y=t.eventProfiles)!=null&&y.length||(b=t.drawProfiles)!=null&&b.length||t.participantsProfile){let S=J4({tournamentRecord:d,...t});if(!S.success)return S}let m=[],h=[],f=[];if(t.leagueProfiles){let S=nme({allUniqueParticipantIds:m,tournamentRecord:d,...t,eventIds:h,venueIds:p,drawIds:f});if(S!=null&&S.error)return S}if(t.drawProfiles){let S=ome({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}if(t.eventProfiles){let S=sme({allUniqueParticipantIds:m,ratingsParameters:n,tournamentRecord:d,...t,eventIds:h,drawIds:f});if(S!=null&&S.error)return S}let{scheduledRounds:g=void 0,schedulerResult:v={}}=s?lme({...t,tournamentRecord:d}):{};return BN(),Ge({...X,tournamentRecord:d,scheduledRounds:g,schedulerResult:v,eventIds:h,venueIds:p,drawIds:f})}function ome(t){let{tournamentRecord:e,drawProfiles:i,allUniqueParticipantIds:r,eventIds:n,drawIds:a}=t,o=0;for(let s of i){let l=JD({allUniqueParticipantIds:r,tournamentRecord:e,drawProfile:s,drawIndex:o,...t});if(l.error)return l;let{drawId:c,eventId:u,event:d,uniqueParticipantIds:p}=l;if(l=kb({suppressNotifications:!1,internalUse:!0,tournamentRecord:e,event:d}),l.error)return l;c&&a.push(c),n.push(u),p!=null&&p.length&&r.push(...p),o+=1}}function sme(t){let{eventProfiles:e,allUniqueParticipantIds:i,eventIds:r,drawIds:n}=t,a=0;for(let o of e){let s=r5({...t,eventIndex:a,eventProfile:o});if(s.error)return s;let{eventId:l,drawIds:c,uniqueParticipantIds:u}=s;c&&n.push(...c),r.push(l),u!=null&&u.length&&i.push(...u),a+=1}}function lme(t){let{schedulingProfile:e,tournamentRecord:i,autoSchedule:r,periodLength:n,scheduleCompletedMatchUps:a}=t,o=eme({schedulingProfile:e,tournamentRecord:i});if(o.error)return o;let s=o.scheduledRounds;if(r){let{tournamentId:l}=i,c={[l]:i};return{schedulerResult:YD({scheduleCompletedMatchUps:a,tournamentRecords:c,periodLength:n}),scheduledRounds:s}}return{scheduledRounds:s}}var s5={};gt(s5,{anonymizeTournamentRecord:()=>l5,modifyTournamentRecord:()=>u5});function l5({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var k,x,F,$,_;if(!i)return{error:fe};let o=Array.isArray(t)?fB.concat(...t):fB,s=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>o.includes(V.name)):L==null?void 0:L.extensions},l={};i.extensions=s(i);let c=a||Vt();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${os(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){let B=Vt();l[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>l[B]));let u=0;for(let L of i.venues||[]){L.extensions=s(L),L.venueName=`Venue #${u}`,L.venueAbbreviation=`V${u}`;let B=Vt();l[L.venueId]=B,L.isMock=!0,u+=1}let d=1;for(let L of i.events||[]){L.extensions=s(L),L.isMock=!0;let B=Vt();l[L.eventId]=B,L.eventId=B;let V=((k=L.category)==null?void 0:k.categoryName)||((x=L.category)==null?void 0:x.ageCategoryCode)||((F=L.category)==null?void 0:F.ratingType)||L.gender;if(L.eventName=`Event ${d} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=l[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=s(j);let H=Vt();if(l[j.drawId]=H,j.drawId=H,j.isMock=!0,Array.isArray(j.entries))for(let Y of j.entries)Y.participantId=l[Y.participantId];let W=Y=>{Y.extensions=s(Y);let q=Vt();l[Y.structureId]=q,Y.structureId=q;for(let re of Y.positionAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of Y.seedAssignments||[])re.participantId&&(re.participantId=l[re.participantId]);for(let re of Y.matchUps||[]){re.isMock=!0;for(let K of re.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:z,collectionAssignments:te})=>({participantId:l[z],collectionAssignments:te})))}};for(let Y of j.structures||[])if(W(Y),Array.isArray(Y.structures))for(let q of Y.structures)W(q);for(let Y of j.links||[])Y.source.structureId=l[Y.source.structureId],Y.target.structureId=l[Y.target.structureId]}let{extension:G}=dt({name:No,element:L});Array.isArray(($=G==null?void 0:G.value)==null?void 0:$.flights)&&((_=G==null?void 0:G.value.flights)==null||_.forEach(j=>{if(j.drawId=l[j.drawId],Array.isArray(j.drawEntries))for(let H of j.drawEntries)H.participantId=l[H.participantId]})),d+=1}let p=i.startDate||os(new Date),m=(i.participants||[]).filter(({participantType:L})=>L===It),h=m.reduce((L,B)=>{var G;let V=(G=B.person)==null?void 0:G.sex;return[ti,yi].includes(V)?L[V]+=1:L[Pd]+=1,L},{[ti]:0,[yi]:0,[Pd]:0}),f=Object.assign({},...Object.keys(h).map(L=>{var B;return{[L]:((B=K4({category:{ageCategoryCode:"O18"},count:h[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:L}))==null?void 0:B.persons)||[]}})),g={[ti]:0,[yi]:0,[Pd]:0},v=m.length,I=m.reduce((L,B)=>{var W,Y;let V=((Y=(W=B.person)==null?void 0:W.addresses)==null?void 0:Y[0])||{},{city:G,state:j,postalCode:H}=V;return L.cities.includes(G)||L.cities.push(G),L.states.includes(j)||L.states.push(j),L.postalCodes.includes(H)||L.postalCodes.push(H),L},{cities:[],postalCodes:[],states:[]}),y=I.postalCodes.length,b=I.cities.length,S=I.states.length,{cities:w}=z4({count:b||v,participantsCount:v}),{states:U}=W4({count:S||v,participantsCount:v}),{postalCodes:T}=q4({count:y||v,participantsCount:v}),P={cities:w,states:U,postalCodes:T};m.forEach((L,B)=>{var Y,q;let V=L==null?void 0:L.person,G=(V==null?void 0:V.sex)||Pd,j=(Y=ut(V==null?void 0:V.birthDate))==null?void 0:Y.split("-")[0],H=g[G],W=f[G][H];if(g[G]+=1,j){let[,re,K]=((q=W==null?void 0:W.birthDate)==null?void 0:q.split("-"))||[],z=[j,re,K].join("-");W.birthDate=z}if(V!=null&&V.addresses){let re=Y4({...P,participantIndex:B,nationalityCode:W.nationalityCode});W.addresses=[re]}W.personId=(n==null?void 0:n[B])||Vt(),e?(W.standardFamilyName=W.lastName,W.standardGivenName=W.firstName,L.participantName=`${W.standardGivenName} ${W.standardFamilyName}`):(W.standardFamilyName=V==null?void 0:V.standardFamilyName,W.standardGivenName=V==null?void 0:V.standardGivenName),delete W.firstName,delete W.lastName,W.extensions=s(V),L.person=W,l[V==null?void 0:V.personId]=W.personId}),(i.participants||[]).filter(({participantType:L})=>L===ot).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=ume({individualParticipantIds:B,individualParticipants:m})});let R=(i.participants||[]).filter(({participantType:L})=>L===Kt),D=R.length,E=u1({count:D}).names;R.forEach((L,B)=>{L.participantName=E[B]});let N=(i.participants||[]).filter(({participantType:L})=>L===Oa),A=N.length,M=u1({count:A,nameRoot:"Group"}).names;N.forEach((L,B)=>{L.participantName=M[B]});let{extension:C}=dt({element:i,name:Dm});Array.isArray(C==null?void 0:C.value)&&(C==null||C.value.forEach(L=>{L.tournamentId=l[L.tournamentId],L.structureId=l[L.structureId],L.eventId=l[L.eventId],L.drawId=l[L.drawId]}));let{extension:O}=dt({element:i,name:Cg});return Array.isArray(O==null?void 0:O.value)&&(O==null||O.value.forEach(L=>{L.personId=l[L.personId]})),{...X}}function ume({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function u5(t){var P,R,D;let{ratingsParameters:e=Dr,participantsProfile:i={},matchUpStatusProfile:r,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:c,autoSchedule:u,eventProfiles:d,periodLength:p,venueProfiles:m,drawProfiles:h,isMock:f,uuids:g}=t;if(!c)return{error:fe};let v=[],I=[],y=[];d==null||d.forEach(E=>{var A;let N=(A=c.events)==null?void 0:A.find((M,C)=>E.eventIndex!==void 0&&C===E.eventIndex||E.eventName&&M.eventName===E.eventName||E.eventId&&M.eventId===E.eventId);N!=null&&N.gender&&(E.gender=N.gender)});let b=((P=c.participants)==null?void 0:P.length)||void 0;b&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${b}`);let S=J4({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:d,drawProfiles:h,uuids:g});if(!S.success)return S;if(d){let E=((R=c.events)==null?void 0:R.length)||0;for(let N of d){let{ratingsParameters:A}=N,M=(D=c.events)==null?void 0:D.find((C,O)=>N.eventIndex!==void 0&&O===N.eventIndex||N.eventName&&C.eventName===N.eventName||N.eventId&&C.eventId===N.eventId);if(M){let{gender:C,category:O,eventType:k}=M,{drawProfiles:x,publish:F}=N,$=$i(Gs)(k)&&It||$i(eo)(k)&&ot||k;if(x){let{stageParticipantsCount:_,uniqueParticipantsCount:L,uniqueParticipantStages:B}=X4({drawProfiles:x,category:O,gender:C}),{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=B?t5({event:{eventType:k,category:O,gender:C},uniqueParticipantsCount:L,participantsProfile:i,ratingsParameters:A,tournamentRecord:c,eventProfile:N,uuids:g}):{};v.push(...G);let{stageParticipants:j}=Z4({targetParticipants:c.participants||[],allUniqueParticipantIds:v,stageParticipantsCount:_,eventParticipantType:$}),H=i5({uniqueDrawParticipants:V,autoEntryPositions:a,stageParticipants:j,tournamentRecord:c,drawProfiles:x,category:O,gender:C,event:M});if(H.error||(H=e5({matchUpStatusProfile:r,completeAllMatchUps:n,randomWinningSide:s,tournamentRecord:c,drawProfiles:x,isMock:f,event:M}),H.error))return H;y.push(...H.drawIds)}F&&qg({tournamentRecord:c,event:M})}else{let C=r5({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:A,tournamentRecord:c,eventProfile:N,eventIndex:E,uuids:g});if(C.error)return C;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=C;k&&y.push(...k),I.push(O),x!=null&&x.length&&v.push(...x),E+=1}}}if(h){let E=(c.events||[]).map(N=>{var A;return((A=N.drawDefinitions)==null?void 0:A.map(()=>1))||[]}).flat().reduce((N,A)=>N+A,0);for(let N of h){let A=JD({startDate:c.startDate,allUniqueParticipantIds:v,matchUpStatusProfile:r,participantsProfile:i,completeAllMatchUps:n,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:c,drawProfile:N,drawIndex:E,uuids:g});if(A.error)return A;let{drawId:M,eventId:C,event:O,uniqueParticipantIds:k}=A;if(A=kb({tournamentRecord:c,event:O,internalUse:!0}),A.error)return A;M&&y.push(M),I.push(C),k!=null&&k.length&&v.push(...k),E+=1}}let w=m!=null&&m.length?px({tournamentRecord:c,venueProfiles:m}):[],U,T={};if(l!=null&&l.length){let E={[c.tournamentId]:c},N=Hg({tournamentRecords:E,schedulingProfile:l});if(N.error)return N;if(u){let{tournamentId:A}=c,M={[A]:c};T=YD({tournamentRecords:M,periodLength:p})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:U,schedulerResult:T,...X,eventIds:I,venueIds:w,drawIds:y}}var c5={};gt(c5,{addDynamicRatings:()=>$O,addIndividualParticipantIds:()=>VD,addParticipant:()=>Ys,addParticipants:()=>xo,addPenalty:()=>N5,addPersonRequests:()=>g5,addPersons:()=>A5,createGroupParticipant:()=>U5,createTeamsFromParticipantAttributes:()=>sx,deleteParticipants:()=>ch,filterParticipants:()=>sb,findParticipant:()=>w5,getCompetitionParticipants:()=>QO,getPairedParticipant:()=>ko,getParticipantEventDetails:()=>ek,getParticipantMembership:()=>tk,getParticipantScaleItem:()=>Lf,getParticipantSchedules:()=>ik,getParticipantSignInStatus:()=>rk,getParticipantTimeItem:()=>kA,getParticipants:()=>Gi,getScaleValues:()=>Rg,mergeParticipants:()=>M5,modifyIndividualParticipantIds:()=>v5,modifyParticipant:()=>jD,modifyParticipantName:()=>S5,modifyParticipantOtherName:()=>y5,modifyParticipantsSignInStatus:()=>I5,modifyPenalty:()=>E5,modifyPersonRequests:()=>h5,mutate:()=>d5,participantScaleItem:()=>bl,query:()=>U6,regenerateParticipantNames:()=>b5,removeIndividualParticipantIds:()=>XA,removeParticipantIdsFromAllTeams:()=>JT,removePenalty:()=>P5,removePersonRequests:()=>f5,removeRatings:()=>D5,scaledTeamAssignment:()=>T5,setParticipantScaleItem:()=>Pb,setParticipantScaleItems:()=>Fq,validateLineUp:()=>ZT});var d5={};gt(d5,{addDynamicRatings:()=>$O,addIndividualParticipantIds:()=>VD,addParticipant:()=>Ys,addParticipants:()=>xo,addPenalty:()=>N5,addPersonRequests:()=>g5,addPersons:()=>A5,createGroupParticipant:()=>U5,createTeamsFromParticipantAttributes:()=>sx,deleteParticipants:()=>ch,findParticipant:()=>w5,mergeParticipants:()=>M5,modifyIndividualParticipantIds:()=>v5,modifyParticipant:()=>jD,modifyParticipantName:()=>S5,modifyParticipantOtherName:()=>y5,modifyParticipantsSignInStatus:()=>I5,modifyPenalty:()=>E5,modifyPersonRequests:()=>h5,regenerateParticipantNames:()=>b5,removeIndividualParticipantIds:()=>XA,removeParticipantIdsFromAllTeams:()=>JT,removePenalty:()=>P5,removePersonRequests:()=>f5,removeRatings:()=>D5,scaledTeamAssignment:()=>T5,setParticipantScaleItem:()=>Pb,setParticipantScaleItems:()=>Fq});function p5(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function m5({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===$b&&(a=ut(a),o=mi(o),s=mi(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=p5(),t[e].push(n);return{mergeCount:r.length}}function mx(t){let{tournamentRecords:e,personRequests:i}=t,r=it(t,[{[rn]:!0}]);if(r.error)return r;if(!i)return{...X};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Tc({tournamentParticipants:o,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&Ct({element:a,extension:{value:s,name:Cg}})}return{...X}}function h5(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=it(t,[{[rn]:!0},{requests:!0,[so]:Mn,[fs]:le}]);if(n.error)return n;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:o}=Ip({tournamentRecords:e}),s=c=>{o&&(o[c]=o[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(r&&(o!=null&&o[r]))s(r);else if(o)for(let c of Object.keys(o))s(c);let l=i.filter(c=>!c.requestId);return l.length&&m5({personRequests:o,personId:r,requests:l}),mx({tournamentRecords:e,personRequests:o})}function f5(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=it(t,[{[rn]:!0}]);if(o.error)return o;let{personRequests:s}=Ip({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!r&&!n&&!a;if(!c){if(n&&(s!=null&&s[n]))l(n);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?gn({name:Cg,tournamentRecords:e,discover:!0}):mx({tournamentRecords:e,personRequests:s})}function g5(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=it(t,[{[rn]:!0,[Mne]:!0},{requests:!0,[so]:Mn,[fs]:le}]);if(n.error)return n;let{personRequests:a}=Ip({tournamentRecords:e}),{mergeCount:o}=m5({personRequests:a,personId:i,requests:r});return o&&a?mx({tournamentRecords:e,personRequests:a}):{error:le}}function v5({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return Q({result:{error:fe},stack:r});if(!e||!t)return Q({result:{error:ze},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return Q({result:{error:Li},stack:r});if(![Kt,Oa].includes(a.participantType))return Q({result:{error:ms},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==It});if(o.length)return Q({result:{error:na,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),c=s.filter(m=>!t.includes(m)),u=VD({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return Q({result:u,stack:r});let d=XA({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return Q({result:d,stack:r});let{topics:p}=Vo();if(p.includes(qr)){let m=n.find(({participantId:h})=>h===e);lt({topic:qr,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...u,...d}}function I5({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:fe};if(!Array.isArray(e))return{error:ze};if(![OI,sz].includes(i))return{error:le,signInState:i};let r=t.participants||[];if(!r.length)return{error:Cy};let n=r.map(vt),a=e.filter(c=>!n.includes(c));if(a.length)return{error:le,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let c of r){let{participantId:u}=c;if(e.includes(u)){let d=cO({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:jy,itemValue:i,createdAt:s}});if(d.error)return d;o.push(c)}}let{topics:l}=Vo();return o.length&&l.includes(qr)&&lt({topic:qr,payload:{tournamentId:t.tournamentId,participants:o}}),{...X}}function y5({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:fe};if(!e)return{error:lr};let{participant:r}=Kc({tournamentRecord:t,participantId:e});if(!r)return{error:Li};r.participantOtherName=i;let{topics:n}=Vo();return n.includes(qr)&&lt({topic:qr,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...X}}function l2({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,c=f=>f.toLowerCase().indexOf("f")<0,u=f=>f.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=LC((e==null?void 0:e.standardGivenName)??""),m=LC((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return c(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function cme({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Ja&&o){let{personFormat:s,doublesJoiner:l}=o;r===It&&(e.participantName=l2({person:a,personFormat:s})),r===ot&&(e.participantName=n==null?void 0:n.map(c=>{var d;let u=(d=t[c])==null?void 0:d.person;return l2({person:u,personFormat:s})}).filter(Boolean).join(l??"/"))}}function b5({tournamentRecord:t,formats:e}){if(!t)return{error:fe};if(!Ut(e))return{error:ze};let i=t.participants??[],r=Hj(i,"participantId");for(let n of i)cme({participant:n,participantMap:r,formats:e});return{...X}}function w5(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:ze,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(o)){l=c.tournamentId;let u=c.participants||[];if(s=Tc({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...X}}function U5({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=nW,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:fe};if(!a)return{error:ze,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:le};let o=(Gi({participantFilters:{participantTypes:[It]},tournamentRecord:r}).participants??[]).map(u=>u.participantId);for(let u of t)if(!o.includes(u))return{error:ms,participantId:u};let s=Ge({participantId:n||Vt(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:Oa,participantRole:i}),l=Ys({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:c}=Vo();return c.includes(Pc)&&lt({topic:Pc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...X,participant:ke(s)}}function S5({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:fe};if(!i)return{error:lr};if(!e)return{error:ze,info:"Missing participantName"};let{participant:r}=Kc({tournamentRecord:t,participantId:i});if(!r)return{error:Li};r.participantName=e;let{topics:n}=Vo();return n.includes(qr)&&lt({topic:qr,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...X}}function T5({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var v,I,y,b,S;if(!o)return{error:fe};if(!Array.isArray(a)&&!rt(c)&&!u||!rt(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:le};if(!s&&!n.length||!n&&!(e&&s))return{error:ze,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==to)return{error:Ml};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===ua).map(vt)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:ze};let p=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let m=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],h=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(m.includes(U)){if(T!==Ja)return{error:ms,participant:w};h.push(w)}}if(c&&h.length<c){let w=c-((h==null?void 0:h.length)||0),U=l??"Team",T=Re(0,w).map(E=>({participantName:`${U} ${E+1}`,participantType:Ja,participantRole:Gr})),{participants:P=[]}=xo({participants:T,returnParticipants:!0,tournamentRecord:o}),R=P.map(vt),D=((I=o.participants)==null?void 0:I.filter(({participantId:E})=>R.includes(E)))??[];h.push(...D)}if(!h.length)return{error:AN};if(t)for(let w of h)w.individualParticipantIds=[];else{let w=h.map(U=>U).flat();e!=null&&e.length?p=p.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:pT,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!p.includes(U))continue;if(T!==It)return{error:ms,participant:w};let P=(y=bl({scaleAttributes:s,participant:w}))==null?void 0:y.scaleItem,R=s!=null&&s.accessor?(b=P==null?void 0:P.scaleValue)==null?void 0:b[s==null?void 0:s.accessor]:P==null?void 0:P.scaleValue,D={participantId:U,scaleValue:R};n.push(D)}if(!n.length)return{error:Li}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:le,scaledParticipant:w};let f=0;for(;f<n.length;){for(let w of h){if(f+1>n.length)break;let U=n[f];w.individualParticipantIds.push(U.participantId),f++}h.reverse()}let g=h.map(vt);for(let w of o.events??[]){if(w.eventType!==to)continue;let U=(w.entries??[]).filter(T=>g.includes(T.participantId));for(let T of U){let P=T.participantId,R=(S=h.find(E=>E.participantId===P))==null?void 0:S.individualParticipantIds;w.entries=(w.entries??[]).filter(E=>!R.includes(E.participantId)),(w.drawDefinitions??[]).forEach(E=>{E.entries=(E.entries??[]).filter(N=>!R.includes(N.participantId))});let{flightProfile:D}=qi({event:w});((D==null?void 0:D.flights)||[]).forEach(E=>{E.drawEntries=(E.drawEntries||[]).filter(N=>!R.includes(N.participantId))})}}return{...X,scaledParticipants:n}}function D5(t){let e=it(t,[{[Fn]:!0,[qN]:!0},{ratingType:!1,[ea]:o=>Dr[o]}]);if(e.error)return e;let i=`${t.ratingType}.${JN}`,r=t.asDynamic?i:t.ratingType,n=[Nd,vc,t.eventType,r].join("."),a=t.tournamentRecord.participants??[];for(let o of a)o.timeItems&&(o.timeItems=o.timeItems.filter(s=>s.itemType!==n));return{...X}}function P5(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Di};for(let i of Object.values(e)){let r=dme({...t,tournamentRecord:i});if(r.error&&r.error!==yf)return r}return{...X}}function dme({tournamentRecord:t,penaltyId:e}){if(!t)return{error:fe};if(!e)return{error:RN};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&lt({topic:qr,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...X,penalty:a}:{error:yf}}var pme=({penaltyId:t=Vt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),R5=pme;function E5(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Di};for(let i of Object.values(e)){let r=mme({...t,tournamentRecord:i});if(r.error&&r.error!==yf||r.success)return r}return{error:yf}}function mme({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:fe};if(!e)return{error:le,modifications:e};if(!i)return{error:RN};let r=(t==null?void 0:t.participants)??[],n=Object.keys(R5()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:mT};let o,s=[];return r.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),o||(o=u)),u)),c&&s.push(l)}),o&&lt({topic:qr,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...X,penalty:o}:{error:yf}}function C5(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:mt(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=mt(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=C5(t[n],e[n],i):r[n]=e[n];return r},{})}function M5({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:fe};e.participants||(e.participants=[]);let r=t.filter(ca(Nl)).map(c=>({[c.participantId]:c})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(c=>{if(n[c.participantId]){let u=C5(c,n[c.participantId],i);return a.push(u),u}return c});let o=e.participants.map(ca(Nl))||[],s=t.filter(({participantId:c})=>!o.includes(c)),{topics:l}=Vo();return s.length&&(e.participants=e.participants.concat(...s),l.includes(Pc)&&lt({topic:Pc,payload:{participants:s}})),a.length&&l.includes(qr)&&lt({topic:qr,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...X}}function N5(t){var a;let{tournamentRecord:e,participantIds:i}=t,r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n;for(let o of Object.values(r)){let s=(a=Gi({tournamentRecord:o}).participants??[])==null?void 0:a.map(vt).filter(l=>i.includes(l));s.length&&(n=hme({...t,penaltyId:t.penaltyId??n,tournamentRecord:o,participantIds:s}).penaltyId)}return n?{...X,penaltyId:n}:{error:Li}}function hme({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:fe};if(!i)return{error:lr};if(!n)return{error:AG};let u=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!u.length)return{error:Li};let d=new Date().toISOString(),p=Object.assign(R5({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(m=>Ct({element:p,extension:m})),u.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),lt({topic:qr,payload:{tournamentId:e.tournamentId,participants:u}}),{...X,penaltyId:p.penaltyId}}function A5({participantRole:t=Gr,tournamentRecord:e,persons:i}){var h;if(!e)return{error:fe};if(!Array.isArray(i))return{error:le};if(!Object.keys(JA).includes(t))return{error:wG};let r=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),n=[],a=i.filter(f=>f&&(!f.personId||!r.includes(f.personId))).map(f=>(f.personId||(f.personId=Vt()),n.push(f.personId),f)),o=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),s=a.map(f=>Ge({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:It,participantRole:t,person:o(f,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=xo({participants:s,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=((h=Gi({participantFilters:{participantTypes:[It]},tournamentRecord:e}))==null?void 0:h.participants)??[];if(t===Gr&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let I=[f,v.personId].map(y=>Tc({tournamentParticipants:p,personId:y})).filter(Boolean);if(I.length===2){let y=I.map(vt);d.push(Ge({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Gr,individualParticipantIds:y,participantType:ot}))}})}),d.length){if(u=xo({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let m=c+l;return{...X,addedCount:m,newPersonIds:n}}var O5={};gt(O5,{bulkUpdatePublishedEventIds:()=>ck,getAllEventData:()=>dk,getCourtInfo:()=>VT,getDrawData:()=>TD,getEventData:()=>DD,getEventPublishStatus:()=>co,getPublishState:()=>uh,getTournamentPublishStatus:()=>ob,getVenueData:()=>Of,mutate:()=>k5,publishEvent:()=>qg,publishEventSeeding:()=>x5,publishOrderOfPlay:()=>B5,publishParticipants:()=>$5,query:()=>R6,setEventDisplay:()=>FD,unPublishEvent:()=>V5,unPublishEventSeeding:()=>F5,unPublishOrderOfPlay:()=>_5,unPublishParticipants:()=>L5});var k5={};gt(k5,{publishEvent:()=>qg,publishEventSeeding:()=>x5,publishOrderOfPlay:()=>B5,publishParticipants:()=>$5,setEventDisplay:()=>FD,unPublishEvent:()=>V5,unPublishEventSeeding:()=>F5,unPublishOrderOfPlay:()=>_5,unPublishParticipants:()=>L5});function x5({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=ka,drawIds:a=[],event:o}){var d,p,m,h;if(!r)return{error:fe};if(!o)return{error:ni};let s=co({event:o,status:n}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},c=(((m=s==null?void 0:s.seeding)==null?void 0:m.stageSeedingScaleNames)||e)&&{...(h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames,...e},u=Ge({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return Wg({statusObject:{seeding:u},removePriorValues:t,status:n,event:o}),lt({topic:iz,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...X}}function F5({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=ka,drawIds:n,stages:a,event:o}){var l,c;if(!i)return{error:fe};if(!o)return{error:ni};let s=co({event:o});if(s){let u=s.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&(u!=null&&u.seedingScaleNames)&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&(u!=null&&u.drawIds)&&(u.drawIds=u.drawIds.filter(d=>!n.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((l=u.seedingScaleNames)!=null&&l.length)&&!((c=u.drawIds)!=null&&c.length)||!a&&!e&&!(n!=null&&n.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),Wg({statusObject:{seeding:u},removePriorValues:t,status:r,event:o})}return lt({topic:CA,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...X}}function L5(t){let e=lo(t);if(!Object.keys(e).length)return{error:Di};for(let i of Object.values(e)){let r=fme({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function fme({removePriorValues:t=!0,tournamentRecord:e,status:i=ka}){if(!e)return{error:fe};let r=`${Jc}.${Xc}`,{timeItem:n}=Go({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].participants,Jl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:Dae}),{...X}}function _5(t){let e=lo(t);if(!Object.keys(e).length)return{error:Di};for(let i of Object.values(e)){let r=gme({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function gme({removePriorValues:t=!0,tournamentRecord:e,status:i=ka}){if(!e)return{error:fe};let r=`${Jc}.${Xc}`,{timeItem:n}=Go({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Jl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({topic:MA,payload:{tournamentId:e.tournamentId}}),{...X}}function $5(t){let e=lo(t);if(!Object.keys(e).length)return{error:Di};for(let i of Object.values(e)){let r=vme({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function vme({removePriorValues:t,tournamentRecord:e,status:i=ka}){if(!e)return{error:fe};let r=`${Jc}.${Xc}`,{timeItem:n}=Go({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i].participants={published:!0},Jl({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),lt({payload:{tournamentId:e.tournamentId},topic:nz}),{...X}}function B5(t){let e=lo(t);if(!Object.keys(e).length)return{error:Di};for(let i of Object.values(e)){let r=Ime({tournamentRecord:i,...t});if(r.error)return r}return{...X}}function Ime({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=ka,eventIds:n=[]}){if(!i)return{error:fe};let a=`${Jc}.${Xc}`,{timeItem:o}=Go({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},Jl({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),lt({topic:rz,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...X}}function V5({removePriorValues:t=!0,tournamentRecord:e,status:i=ka,event:r}){if(!e)return{error:fe};if(!r)return{error:ni};let n=`${Jc}.${Xc}`,{timeItem:a}=Gy({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,hh({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Wg({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),lt({topic:EA,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...X}}var j5={};gt(j5,{getEntryStatusReports:()=>bme,getParticipantStats:()=>yme,getStructureReports:()=>Ume,getVenuesReport:()=>Tme});function yme({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var U,T,P,R,D;if(!n)return{error:fe};if(s&&!Array.isArray(s))return{error:zn};if(s=s??kr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Fu};let l=[];e&&l.push(e),r&&l.push(r);let c=l.length?{participantIds:l}:{participantTypes:[Ja]},u=Gi({participantFilters:c,tournamentRecord:n}).participants??[];if(!u.every(({participantType:E})=>E===Ja))return{error:na};l.length||l.push(...u.map(vt));let d=new Map,p=new Map,m=new Map,h=new Map,f=(E,N="")=>p.get(E)||p.set(E,{participantName:N,participantId:E,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(E);for(let E of u){let{participantId:N,individualParticipantIds:A}=E;h.set(N,A??[]),f(N,E.participantName)}if(r&&!h.get(r))return Q({result:{error:Li},context:{teamParticipantId:r}});if(e&&!h.get(e))return Q({result:{error:Li},context:{opponentParticipantId:e}});let g=[],v=E=>{let N=[[],[]];for(let M of E){let C=M.participant;if(C!=null&&C.participantName){d.set(C.participantId,{participantName:C.participantName,ratings:C.ratings});let O=p.get(C.participantId);O&&(O.participantName=C.participantName)}}let A=({side:M,individualParticipantIds:C})=>{var O,k,x,F,$;return M.participantId&&(!(C!=null&&C.length)||C.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(C!=null&&C.length)||Vi(C,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(h.size){let M=(C,O)=>{for(let k of E){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[C];i&&$.push(...x),N[F-1]=$;let _=p.get(C);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||E.every(C=>C.participant&&(A({individualParticipantIds:h.get(r),side:C})||A({individualParticipantIds:h.get(e),side:C}))))&&M(r,h.get(r));else for(let[C,O]of h)M(C,O)}else if(i)for(let M of E){if(!M.participant)continue;let C=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=C)}return N};for(let E of s){if(!Ut(E))return{error:zn};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:C,score:O,sides:k}=E;if(!k||!O||M===zs||N===xt)continue;let x=v(k);if(!x.filter(Boolean).length)continue;let F=t&&C&&((U=Zy({matchUp:E}))==null?void 0:U.competitiveness);g.push(E);let $=wO({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),_=ZW({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),{pointsTally:L,tiebreaksTally:B}=QW({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let H of V){let W=(j=d.get(H))==null?void 0:j.participantName,Y=f(H,W);if(Y){let q=(J,ie)=>ie.forEach((ne,ue)=>Y[J][ue]+=ne),re=G?[...B].reverse():B,K=G?[...L].reverse():L,z=G?[..._].reverse():_,te=G?[...$].reverse():$;if(q("tiebreaks",re),q("points",K),q("games",z),q("sets",te),C){let J=C-1===G?0:1;Y.matchUps[J]+=1}if(F){let J=F.toLowerCase();Y.competitiveness[J]||(Y.competitiveness[J]=[0,0]),Y.competitiveness[J][G]+=1}if(N){let J=N.toLowerCase();Y.matchUpStatuses[J]||(Y.matchUpStatuses[J]=0),Y.matchUpStatuses[J]+=1}}}})}let I=["tiebreaks","matchUps","points","games","sets"],y=["competitive","routine","decisive"],b=new Map,S=(E,N)=>(E??0)+(N??0);for(let[E,N]of p.entries()){for(let A of I){let M=N[A].reduce(S);if(M){let C=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k,m.set(E,!0),b.has(O)||b.set(O,[]),(T=b.get(O))==null||T.push(k)}}for(let A of y){let M=(R=(P=N.competitiveness)==null?void 0:P[A])==null?void 0:R.reduce(S);if(M){let C=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k}}}if(!r){let E=(N,A)=>A-N;for(let N of p.values())for(let A of I){let M=`${A}Ratio`;if(typeof N[M]=="number"){let C=(D=b.get(M))==null?void 0:D.sort(E).indexOf(N[M]);if(typeof C=="number"&&C>=0){let O=`${A}Rank`;N[O]=C+1}}}}let w={relevantMatchUps:g,...X};return r?(w.teamStats=p.get(r),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=m.size,w.allParticipantStats=[...p.values()],w}function p0({participant:t,eventType:e}){var c,u,d,p,m,h;let i=(c=t==null?void 0:t.person)==null?void 0:c.personId,r=(d=(u=t==null?void 0:t.person)==null?void 0:u.personOtherIds)==null?void 0:d[0],n=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(h=(m=t==null?void 0:t.ratings)==null?void 0:m[e])==null?void 0:h.find(({scaleName:f})=>f===bO),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:r,confidence:l,wtnRating:s,personId:i,tennisId:n}}function bme({tournamentRecord:t}){if(!t)return{error:fe};let e=t.tournamentId,{participantMap:i}=Gi({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(kr({matchUpFilters:{matchUpTypes:[Qp,Fd]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Fd?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,c=({id:m,entry:h,eventId:f,eventType:g})=>{var R;let{qualifyingSeeding:v,mainSeeding:I,entryStatus:y,entryStage:b,drawId:S}=h;a[m]||(a[m]=[]);let{participant:w,events:U}=(i==null?void 0:i[m])??{},T=p0({participant:w,eventType:g}),P=(R=U==null?void 0:U[f])==null?void 0:R.ranking;y===fO&&n.push(m),a[m].push({participantType:w==null?void 0:w.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:S,entryStatus:y,entryStage:b,...T,ranking:P,mainSeeding:I,qualifyingSeeding:v})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:I}=m,y=g.flatMap(U=>{let{drawId:T,entries:P}=U;l+=1;let R=({stage:A,stageSequence:M})=>A===Ae&&M===1||A===We,D=(U.structures??[]).filter(R).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),E=({participantId:A})=>D.includes(A),N=A=>{var x,F,$,_,L,B,V,G;let{participantId:M,entryStatus:C,entryStage:O}=A;f(C);let k=(_=($=(F=(x=i==null?void 0:i[M])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[Ae];return{qualifyingSeeding:(G=(V=(B=(L=i==null?void 0:i[M])==null?void 0:L.draws)==null?void 0:B[T])==null?void 0:V.seedAssignments)==null?void 0:G[We],participantId:M,mainSeeding:k,entryStatus:C,entryStage:O,drawId:T}};return P==null?void 0:P.filter(E).map(N)}),b=U=>{var R;let T=U.participantId,P=(R=i==null?void 0:i[T].participant.individualParticipantIds)==null?void 0:R.filter(D=>r.includes(D));return T&&{[T]:{individualParticipantIds:P}}};v===Uc?(()=>{let U=Object.assign({},...y.map(b).filter(Boolean)),T=P=>{U[P.participantId].individualParticipantIds.forEach(R=>{c({id:R,eventType:v,eventId:I,entry:P})})};y.forEach(T)})():y.forEach(U=>{c({id:U==null?void 0:U.participantId,eventType:v,eventId:I,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[I]={tournamentId:e,eventId:I,entries:y,entryStatuses:h};let w=Object.assign({},...zo.flatMap(U=>{var T,P;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(P=h[U])==null?void 0:P.pct}]}));o[I]={tournamentId:e,eventId:I,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===It&&h===Gr),d=u.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function wme({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>p0({participant:h,eventType:t})).filter(({wtnRating:h})=>h),c=(s.length-l.length)/s.length*100,u=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:c,avgWTN:d}}function Ume({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var m;if(!i)return{error:vf};let r=[],n={},a={},o=[],s=Object.assign({},...(e??[]).map(({name:h,label:f,accessor:g})=>{var y,b,S;let v=(b=(y=dt({element:i,name:h}))==null?void 0:y.extension)==null?void 0:b.value,I=g?(S=tm({element:v,accessor:g}))==null?void 0:S.value:v;return{[f||h]:I}})),l=i==null?void 0:i.tournamentId,c=kr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],u=h=>{var f,g,v;return(v=(g=(f=Go({itemType:vA,itemSubTypes:[Il],element:{timeItems:h}}))==null?void 0:f.timeItem)==null?void 0:g.itemValue)==null?void 0:v.scaleBasis},d=({positionManipulations:h})=>{h==null||h.forEach(f=>{let{structureId:g,name:v}=f,I=f.drawPositions||[f.drawPosition];n[g]||(n[g]=[]),n[g].push(`${v}: ${I.join("/")}`)})},p=(m=i==null?void 0:i.events)==null?void 0:m.flatMap(({timeItems:h,drawDefinitions:f=[],extensions:g,eventType:v,eventName:I,eventId:y,category:b})=>{var D,E,N,A,M;let S=(N=(E=(D=g==null?void 0:g.find(C=>C.name===No))==null?void 0:D.value)==null?void 0:E.flights)==null?void 0:N.map(C=>({[C.drawId]:C.flightNumber})),w=S&&Object.assign({},...S),U=((M=(A=g==null?void 0:g.find(C=>C.name===qv))==null?void 0:A.value)==null?void 0:M.length)||0,T=Object.values(w),P=w&&Math.min(...T),R=u(h);return a[y]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:U,seedingBasis:R?JSON.stringify(R):void 0,tournamentId:l,eventId:y},f.filter(C=>!t||!S||w[C.drawId]===P).flatMap(C=>{let{matchUpFormat:O,tieFormat:k,timeItems:x,extensions:F,structures:$,drawName:_,drawType:L,drawId:B}=C,{matchUpFormatCounts:V,matchUpsCount:G,avgConfidence:j,pctNoRating:H,avgWTN:W}=wme({eventType:v,matchUps:c,drawId:B}),Y=u(x)||R,q=Sme({extensions:F}),re=(q==null?void 0:q.length)||0;return d({positionManipulations:q}),a[y].totalPositionManipulations+=re,a[y].generatedDrawsCount+=1,re>a[y].maxPositionManipulations&&(a[y].maxPositionManipulations=re),$==null?void 0:$.filter(K=>K.stageSequence===1&&[We,Ae,Wr,xi].includes(K.stage)).map(K=>{var ve,qt,Xi;let z=[Ae,xi].includes(K.stage)?c.find(Ke=>Ke.structureId===K.structureId&&Ke.finishingRound===1&&Ke.winningSide):void 0;K.stage===Ae&&r.push({eventName:I,drawName:_,structureId:K.structureId});let te=(qt=(ve=z==null?void 0:z.sides)==null?void 0:ve.find(Ke=>Ke.sideNumber===z.winningSide))==null?void 0:qt.participant,J=(te==null?void 0:te.participantType)===Ja&&te.participantId,ie=(te==null?void 0:te.participantType)===ot?te.individualParticipants:[],ne=p0({participant:(ie==null?void 0:ie[0])||te,eventType:v}),{personId:ue,personOtherId:ae,tennisId:ce,confidence:pe,wtnRating:Se}=ne||{},Be=p0({participant:ie==null?void 0:ie[1],eventType:v}),{personId:Pe,personOtherId:at,tennisId:de,confidence:Ie,wtnRating:me}=Be||{},{ageCategoryCode:Me,categoryName:be,subType:_e}=b??{},Ne=K.matchUpFormat||O,se=(V[Ne]||0)/G*100,{tieFormatName:ge,tieFormatDesc:we}=o0(k),{tieFormatName:De,tieFormatDesc:Le}=o0(K.tieFormat),ye=we===Le,Te=!ye&&De,Ze=K.tieFormat&&!ye&&Le,je=((Xi=q==null?void 0:q.filter(Ke=>Ke.structureId===K.structureId))==null?void 0:Xi.length)||0;return{...s,tournamentId:l,eventId:y,structureId:K.structureId,drawId:B,eventType:v,category:_e,categoryName:be,ageCategoryCode:Me,flightNumber:w[B],drawType:L,stage:K.stage,seedingBasis:Y?JSON.stringify(Y):void 0,winningPersonId:ue,winningPersonOtherId:ae,winningPersonTennisId:ce,winningPersonWTNrating:Se,winningPersonWTNconfidence:pe,winningPerson2Id:Pe,winningPerson2OtherId:at,winningPerson2TennisId:de,winningPerson2WTNrating:me,winningPerson2WTNconfidence:Ie,winningTeamId:J,positionManipulations:je,pctNoRating:H,matchUpFormat:Ne,pctInitialMatchUpFormat:se,matchUpsCount:G,drawTieFormatName:ge,drawTieFormatDesc:we,tieFormatName:Te,tieFormatDesc:Ze,avgConfidence:j,avgWTN:W}})})});return r.forEach(({eventName:h,drawName:f,structureId:g})=>{var v;(v=n[g])!=null&&v.length&&o.push({eventName:h,drawName:f,actions:n[g]})}),{eventStructureReports:Object.values(a),structureReports:p,flightReports:o}}function Sme({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===Yv))==null?void 0:e.value)==null?void 0:i.slice(1)}function Tme({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var u,d;if(!Array.isArray(n))return{error:le,dates:n};if(!Array.isArray(r))return{error:le,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Di};if(!n.every(aa))return{error:yn};let a=Hu({tournamentRecords:e,ignoreDisabled:t,dates:n});if(a.error)return a;let o=(u=a==null?void 0:a.venues)==null?void 0:u.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:c}=ys({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>Dme(s,p,c))}}function Dme(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var m;let l=0,c=0,u=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(m=f&&Yg({courtDate:f}).timeSlots)==null?void 0:m.reduce((v,I)=>{let{startTime:y,endTime:b}=I,S=Dt(b)-Dt(y);return v+S},0);g&&(u+=1),l+=g}let d=i.filter(({schedule:h})=>h.venueId===r&&Ol(s,h.scheduledDate));d.forEach(({schedule:h})=>{let f=mi(h.scheduledTime),g=Vn(f,h.averageMinutes),v=Dt(g)-Dt(f);c+=v});let p=l?(c/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:r,venueName:a,venueReport:o}}var hx={};gt(hx,{addMatchUpCourtOrder:()=>qk,addMatchUpEndTime:()=>Kk,addMatchUpOfficial:()=>E4,addMatchUpResumeTime:()=>Xk,addMatchUpScheduleItems:()=>zD,addMatchUpScheduledDate:()=>GD,addMatchUpScheduledTime:()=>ed,addMatchUpStartTime:()=>Yk,addMatchUpStopTime:()=>Jk,addSchedulingProfileRound:()=>cx,allocateTeamMatchUpCourts:()=>HD,assignMatchUpCourt:()=>Ih,assignMatchUpVenue:()=>Jg,bulkRescheduleMatchUps:()=>J5,bulkScheduleMatchUps:()=>Bb,bulkScheduleTournamentMatchUps:()=>zI,bulkUpdateCourtAssignments:()=>W5,calculateScheduleTimes:()=>fx,clearMatchUpSchedule:()=>Z5,clearScheduledMatchUps:()=>qD,courtGridRows:()=>Ik,findMatchUpFormatTiming:()=>PD,findVenue:()=>ju,generateBookings:()=>WD,generateVirtualCourts:()=>_D,getPersonRequests:()=>Ip,getProfileRounds:()=>ED,getScheduledRoundsDetails:()=>Eb,getSchedulingProfile:()=>zu,getSchedulingProfileIssues:()=>pk,matchUpScheduleChange:()=>X5,modifyMatchUpFormatTiming:()=>Nk,mutate:()=>G5,proAutoSchedule:()=>z5,proConflicts:()=>Y5,publicFindCourt:()=>Lz,query:()=>A6,removeEventMatchUpFormatTiming:()=>xD,removeMatchUpCourtAssignment:()=>H5,reorderUpcomingMatchUps:()=>K5,scheduleMatchUps:()=>q5,scheduleProfileRounds:()=>YD,setMatchUpDailyLimits:()=>Q5,setMatchUpHomeParticipantId:()=>Wk,setSchedulingProfile:()=>Hg,toggleParticipantCheckInState:()=>BD,validateSchedulingProfile:()=>RD});var G5={};gt(G5,{addMatchUpCourtOrder:()=>qk,addMatchUpEndTime:()=>Kk,addMatchUpOfficial:()=>E4,addMatchUpResumeTime:()=>Xk,addMatchUpScheduleItems:()=>zD,addMatchUpScheduledDate:()=>GD,addMatchUpScheduledTime:()=>ed,addMatchUpStartTime:()=>Yk,addMatchUpStopTime:()=>Jk,addSchedulingProfileRound:()=>cx,allocateTeamMatchUpCourts:()=>HD,assignMatchUpCourt:()=>Ih,assignMatchUpVenue:()=>Jg,bulkRescheduleMatchUps:()=>J5,bulkScheduleMatchUps:()=>Bb,bulkScheduleTournamentMatchUps:()=>zI,bulkUpdateCourtAssignments:()=>W5,calculateScheduleTimes:()=>fx,clearMatchUpSchedule:()=>Z5,clearScheduledMatchUps:()=>qD,courtGridRows:()=>Ik,findMatchUpFormatTiming:()=>PD,findVenue:()=>ju,generateBookings:()=>WD,generateVirtualCourts:()=>_D,matchUpScheduleChange:()=>X5,modifyMatchUpFormatTiming:()=>Nk,proAutoSchedule:()=>z5,proConflicts:()=>Y5,publicFindCourt:()=>Lz,removeEventMatchUpFormatTiming:()=>xD,removeMatchUpCourtAssignment:()=>H5,reorderUpcomingMatchUps:()=>K5,scheduleMatchUps:()=>q5,scheduleProfileRounds:()=>YD,setMatchUpDailyLimits:()=>Q5,setMatchUpHomeParticipantId:()=>Wk,setSchedulingProfile:()=>Hg,toggleParticipantCheckInState:()=>BD,validateSchedulingProfile:()=>RD});function fx({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:Di};o=o??$D({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Hu({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(R=>!c||c.includes(R.venueId));l||(l=m==null?void 0:m.reduce((R,D)=>{var N,A;let E=((A=(N=D.dateAvailability)==null?void 0:N.find(M=>!M.date||Ol(s,M.date)))==null?void 0:A.startTime)??D.startTime;return E&&(!R||Dt(E)<Dt(R))?E:R},void 0)),u||(u=m==null?void 0:m.reduce((R,D)=>{var N,A;let E=((A=(N=D.dateAvailability)==null?void 0:N.find(M=>!M.date||Ol(s,M.date)))==null?void 0:A.endTime)??D.endTime;return E&&(!R||Dt(E)>Dt(R))?E:R},void 0));let h=Object.values(a),f=Object.assign({},...h.map(R=>(R.events??[]).map(D=>{let{scheduleTiming:E}=Hy({tournamentRecord:R,event:D});return{[D.eventId]:{event:D,scheduleTiming:E}}})).flat()),g=Nb({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],I=(g==null?void 0:g.completedMatchUps)??[],y=[];y.push(...v),y.push(...I);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=y==null?void 0:y.map(({eventId:R,schedule:D,matchUpFormat:E})=>{let{event:N,scheduleTiming:A}=f[R],M=N==null?void 0:N.eventType,C={...A,defaultTiming:b,matchUpFormat:E},{averageMinutes:O,recoveryMinutes:k}=BT({eventType:M,timingDetails:C}),{courtId:x,venueId:F}=D,$=mi(D.scheduledTime),_=Vn($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:u,bookings:S,courts:m},{scheduleTimes:U}=Bk(w),T=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,P=y.map(br);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:P}}function H5(t){var m;let e=it(t,[{[rn]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:r,tournamentId:n,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,c=r[n];if(!c)return{error:fe};let{drawDefinition:u,event:d}=Qc({tournamentRecord:c,drawId:l});if(!u)return{error:xe};let p=hi({drawDefinition:u,event:d,matchUpId:o});if(p.error)return p;if(((m=p==null?void 0:p.matchUp)==null?void 0:m.matchUpType)===zs){let{itemValue:h}=Zc({timeItems:p.matchUp.timeItems??[],itemType:bu}),f=s&&h.filter(g=>g.courtId!==s);return pa({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:o,timeItem:{itemType:bu,itemValue:f}})}else return Ih({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:o})}function z5({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!uo(r))return{error:le};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:dT};let n=Nb({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(I=>{if(Ut(I)&&(I.matchUpId&&(f.push(I.matchUpId),o.push(I)),I.sides)){let y=s(I);g.push(...y)}});let v=Object.values(h).filter(I=>Ut(I)&&!I.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==xt&&(t||!fr.includes(m))).sort(lh);let c=Wo({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,I=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&f.some(T=>c[v].matchUpIds.includes(T)),b=v&&d.some(T=>c[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>I.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!y&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),u.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=u.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=Bb({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:u,notScheduled:r}}function W5(t){let{courtDayDate:e}=t,i=it(t,[{courtAssignments:!0,[so]:Mn,[fs]:ze},{[rn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[rn][a];if(!o)return n={error:fe},!1;let s=r[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=An({tournamentRecord:o,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,m=Ih({tournamentRecord:o,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:jG}}),!0):(n={error:xe},!1)})}),n||X}function q5(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:I,dryRun:y}=t,b=it(t,[{[rn]:!0,[Ay]:!0},{[ea]:aa,[fs]:yn,[Rne]:!0},{[ea]:V=>!V||!isNaN(V),[Ane]:!1,[fs]:le,[One]:!1,[kne]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??ys({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Wo({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&Ol(h,ut(V.schedule.scheduledDate))&&Bf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:P,dateScheduledMatchUpIds:R}=fx({tournamentRecords:e,remainingScheduleTimes:d,startTime:mi(v),endTime:mi(I),scheduleDate:ut(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),D={},E=[],N={},A={},M={};S.filter(({matchUpId:V})=>R==null?void 0:R.includes(V)).forEach(V=>{var j;l1({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let G=(j=V.schedule)==null?void 0:j.scheduledTime;if(G){N[V.matchUpId]=G;let H=a==null?void 0:a[V.matchUpId];HI({recoveryMinutes:H||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:G,matchUp:V})}});let C=U.filter(V=>{let G=R==null?void 0:R.includes(V.matchUpId),j=[xt,Rt,_i,Ea,nn,Lt].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=C.reduce((V,G)=>{let{drawId:j,tournamentId:H,matchUpType:W}=G,{participantIdsAtLimit:Y,relevantParticipantIds:q}=ox({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:c,matchUp:G});return Y!=null&&Y.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...Y),V):(q.forEach(re=>{_b({individualParticipantProfiles:s,participantId:re});let K=s[re].counters;K[W]?K[W]+=1:K[W]=1,K[Do]?K[Do]+=1:K[Do]=1}),V.matchUpMap[H]||(V.matchUpMap[H]={}),V.matchUpMap[H][j]?V.matchUpMap[H][j].push(G):V.matchUpMap[H][j]=[G],Bf({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(P==null?void 0:P.length)??0,{personRequests:_}=Ip({tournamentRecords:e,requestType:$b});for(;P!=null&&P.length&&C.length&&F<=$;){F++;let{scheduleTime:V}=P.shift(),G=C.find(j=>{let{matchUpId:H}=j,{dependenciesScheduled:W,remainingDependencies:Y}=rx({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!W)return M[H]||(M[H]=[]),M[H].push({scheduleTime:V,remainingDependencies:Y}),!1;let{enoughTime:q}=ax({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!q)return A[H]||(A[H]=[]),A[H].push({scheduleTime:V}),!1;let{conflicts:re}=nx({potentials:u,averageMatchUpMinutes:r,requestConflicts:D,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let K=a==null?void 0:a[j.matchUpId];return HI({recoveryMinutes:K||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});C=C.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||E.push(V)}C.forEach(V=>{l1({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:H}=Qc({tournamentRecord:G,drawId:j});H&&O[V][j].forEach(({matchUpId:W})=>{let Y=N[W];if(Y){let q=Y.split(":").map(za).join(":"),re=`${ut(h)}T${q}`;y?L.push(W):(ed({drawDefinition:H,matchUpId:W,scheduledTime:re}).success&&L.push(W),T&&Jg({tournamentRecords:e,tournamentRecord:G,drawDefinition:H,matchUpId:W,venueId:T}))}})})});let B=oA(C);return{...X,requestConflicts:Object.values(D),remainingScheduleTimes:P==null?void 0:P.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:E,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function Y5({tournamentRecords:t,matchUps:e}){if(!uo(e))return{error:Fu};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:dT};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>Je(m))),r=Re(1,i+1).map(m=>e.filter(h=>{var f;return Je((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(lh).forEach(({schedule:m})=>delete m[QU]);let s=mt(e.map(({drawId:m})=>m)),l=Wo({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:I,loserMatchUpId:y,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let P=(S==null?void 0:S.map(D=>{var E;return[(E=D.participant)==null?void 0:E.individualParticipantIds,D.participantId]}).flat().filter(Boolean))??[],R=(w==null?void 0:w.flat().map(({individualParticipantIds:D,participantId:E})=>[D,E]).flat().filter(Boolean))||[];return f.participantIds.push(...R,...P),I&&f.targetMatchUpIds.push(I),y&&f.targetMatchUpIds.push(y),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=c.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[QU]){o[m].schedule[QU]=h,o[m].schedule[Oz]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return c.forEach((m,h)=>{let f=h?c[h-1]:void 0,g=c.slice(h+1),v={},I=la(m.participantIds),y=Object.keys(I).filter(w=>I[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>y.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][md]||(v[w][md]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][hd]||(v[T][hd]=U.filter(P=>P!==T))})}),m.matchUpIds.forEach(w=>{var P,R,D,E;let U=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>U.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,AC,sc,[w])),p(w,AC,sc,A))}if((P=v[w])!=null&&P[md]&&p(w,md,NC,v[w][md]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,md,sc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,md,sc,[w]))}let T=(R=f==null?void 0:f.matchUpIds)==null?void 0:R.filter(N=>u(w,N)>1);if(T!=null&&T.length&&(p(w,OC,sc,T),T.forEach(N=>p(N,OC,sc,[w]))),(D=v[w])!=null&&D[hd]&&p(w,hd,NC,v[w][hd]),(E=f==null?void 0:f.targetMatchUpIds)==null?void 0:E.includes(w)){let N=o[w].schedule.courtId,A=U.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,hd,sc,[w])),p(w,hd,sc,A))}})}),{courtIssues:a,rowIssues:d}}function K5(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return Q({result:{error:Di},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return Q({result:{error:ze},stack:e});let a=r==null?void 0:r.length;if(!a)return{...X};let o=0;return r.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,m=c+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:u,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?X:Q({result:{error:VG},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:m}=Qc({tournamentRecord:p,drawId:d});return m?ed({drawDefinition:m,scheduledTime:c,matchUpId:u}):{error:Pa}}}function J5(t){var l,c;let{scheduleChange:e,matchUpIds:i,dryRun:r}=t;if(!i||!Array.isArray(i))return{error:Wm};if(typeof e!="object")return{error:le};let n=lo(t),a=[],o=[];for(let u of Object.values(n)){let d=Pme({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:r});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=oA(d.notRescheduled),m=[];(l=d.rescheduled)==null||l.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),a.push(h)}),m.length&&(o=((c=d==null?void 0:d.notRescheduled)==null?void 0:c.filter(({matchUpId:h})=>!m.includes(h)))||[])}let s=!!(a.length&&!o.length);return{...X,rescheduled:a,notRescheduled:o,allRescheduled:s}}function Pme({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var b;if(!t)return{error:fe};if(!i||!Array.isArray(i))return{error:Wm};if(typeof e!="object")return{error:le};let n=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...X};if(o&&isNaN(o))return{error:le};if(s&&isNaN(s))return{error:le};let{matchUps:l}=kr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:S})=>!fr.includes(S),u=l==null?void 0:l.filter(S=>Mb({schedule:S.schedule})).filter(S=>c({matchUpStatus:S.matchUpStatus}));if(!(u!=null&&u.length))return{...X};let{tournamentInfo:d}=gh({tournamentRecord:t}),{startDate:p,endDate:m}=d,h=u==null?void 0:u.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),f=1440;for(let S of Object.keys(h)){let w=Qc({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=h[S].filter(P=>i.includes(P));for(let P of T)if(P&&U){let R=(b=u.find(C=>C.matchUpId===P))==null?void 0:b.schedule,{scheduledTime:D,scheduledDate:E}=R,N,A,M;if(!N&&s&&E){let C=ut(E);M=Gv(C,s),N=new Date(M)<new Date(p)||new Date(M)>new Date(m)}if(o&&D){let C=ut(D),O=Dt(mi(D))+o;if(N=O<0||O>f,!N){let k=Vn(D,o),x=C&&M||E===C&&C;A=x?`${x}T${k}`:k}}if(N)a.push(P);else{if(!r){if(A){let C=ed({scheduledTime:A,drawDefinition:U,matchUpId:P});if(C.error)return C}if(M){let C=GD({scheduledDate:M,drawDefinition:U,matchUpId:P});if(C.error)return C}}(A||M)&&n.push(P)}}}let g=kr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:S})=>n.includes(S)),I=g.filter(({matchUpId:S})=>a.includes(S)),y=v.length&&!I.length;return{...X,rescheduled:v,notRescheduled:I,allRescheduled:y}}function X5(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Di};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!c&&!p)return Q({result:{error:ze},stack:e});let{matchUps:h}=ys({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===c),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&c&&!p){let b=I({tournamentId:u,matchUpId:c,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return Q({result:b,stack:e})}else if(a&&o&&c&&p){let b=I({tournamentId:u,matchUpId:c,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return Q({result:b,stack:e,info:"source"});let S=I({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return Q({result:S,stack:e,info:"target"})}else return{error:ze};return v?X:Q({result:{error:Tg},stack:e});function I(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,P=S[w],{drawDefinition:R}=Qc({tournamentRecord:P,drawId:T});return U.matchUpType===ci?y({...b,tournamentRecord:P,drawDefinition:R}):Ih({...b,tournamentRecord:P,drawDefinition:R})}function y({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:P,matchUpId:R,matchUp:D,courtId:E}){let N=[E].concat(D.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return HD({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:P,matchUpId:R,courtIds:N})}}function Z5({scheduleAttributes:t=[bu,Ld,kg,xg,Fg,ts,wu,yl,cu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var s,l;let n="clearMatchUpSchedule",a=i?(s=vn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=kr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:tn};let o=(a.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return a.timeItems=o,St({tournamentId:e.tournamentId,context:n,drawDefinition:i,matchUp:a}),{...X}}function Q5(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Di};if(typeof r!="object")return{error:Lu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:le};for(let o of a){let s=n[o],l=Ct({extension:{name:Fy,value:{dailyLimits:r}},element:s});if(l.error)return l}return{...X}}var eY={};gt(eY,{addCollectionDefinition:()=>Ix,addCollectionGroup:()=>oY,aggregateTieFormats:()=>lY,compareTieFormats:()=>Su,getTieFormat:()=>uk,modifyCollectionDefinition:()=>gx,modifyTieFormat:()=>sY,mutate:()=>tY,orderCollectionDefinitions:()=>nY,query:()=>D6,removeCollectionDefinition:()=>vx,removeCollectionGroup:()=>rY,tieFormatGenderValidityCheck:()=>aD,validateCollectionDefinition:()=>bb});var tY={};gt(tY,{addCollectionDefinition:()=>Ix,addCollectionGroup:()=>oY,aggregateTieFormats:()=>lY,modifyCollectionDefinition:()=>gx,modifyTieFormat:()=>sY,orderCollectionDefinitions:()=>nY,removeCollectionDefinition:()=>vx,removeCollectionGroup:()=>rY});function Wd({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var c;let s="getTieFormat",l;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:xe};if(a&&o)l=Ns(o);else if(i){if(t&&(!n||!r)){let u=hi({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((c=u.matchUp)==null?void 0:c.matchUpType)!==zs)return Q({result:{error:zn},stack:s});r||(r=u.structure),n||(n=u.matchUp)}l=Qv({item:n,drawDefinition:t,structure:r,event:o})||Qv({item:r,drawDefinition:t,structure:r,event:o})||Ns(t)||Ns(o)}else if(t&&e){if(!r){let u=Qe({drawDefinition:t,structureId:e});if(u.error)return u;r=u==null?void 0:u.structure}l=Qv({item:r,drawDefinition:t,structure:r,event:o})||Ns(t)||Ns(o)}else l=Ns(t)||Ns(o);return l?{...X,structure:r,tieFormat:l,matchUp:n}:Q({result:{error:wg},stack:s})}function m0({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![fr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==jo&&!gr(t))}function SE({from:t,to:e}){let i=Object.keys(t),r=Vi(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function Rme({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var w,U,T,P;let c="updateTieFormat",u=e==null?void 0:e.tournamentId,d=0,p=0,m=0,h=0,f=n==null?void 0:n.collectionDefinitions.reduce((R,D)=>(R[D.collectionId]=(R[D.collectionId]||0)+D.matchUpCount,R),{}),g=({tieFormat:R})=>{let D=R==null?void 0:R.collectionDefinitions.reduce((E,N)=>(E[N.collectionId]=(E[N.collectionId]||0)+N.matchUpCount,E),{});return SE({from:D,to:f}).equivalent},v=(w=Wd({drawDefinition:i}))==null?void 0:w.tieFormat,I=(U=Wd({event:s}))==null?void 0:U.tieFormat;if(s&&a){for(let R of s.drawDefinitions??[])y({drawDefinition:R});s.tieFormat=Br(n),h+=1}else if(o){if(!o.tieMatchUps)return Q({result:{error:zn},stack:c});let R=la((T=o.tieMatchUps)==null?void 0:T.map(({collectionId:M})=>M)),D=SE({to:f,from:R}),{changes:E,changesArePossible:N,cannotChangeReaon:A}=u2({matchUp:o,check:D});if(D.equivalent)if(m0({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Br(n),h+=1;else return Q({result:{error:SN},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(N)S({tieFormat:n,matchUp:o,changes:E,uuids:l});else return Q({context:{collectionMap:f,matchUpMap:R},result:{error:uu},info:A||"specified changes not possible",stack:c});p+=1,St({eventId:s==null?void 0:s.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:o})}else if(r){let R=(P=b({inheritedTieFormat:v??I,structure:r}))==null?void 0:P.modifiedMatchUpsCount;R&&(p+=R,d+=1,h+=1);let D=!r.tieFormat||Su({ancestor:r.tieFormat,descendant:n}).different;D&&(r.tieFormat=Br(n),d+=1,h+=1),(R||D)&&i&&ai({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)y({drawDefinition:i}),i.tieFormat=Br(n),h+=1;else return{error:xe};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:m,modifiedCount:h,...X,tieFormat:n};function y({drawDefinition:R}){var N;let D=R.structures||[],E=[];for(let A of D){if(A.tieFormat)continue;let M=(N=b({inheritedTieFormat:I,structure:A}))==null?void 0:N.modifiedMatchUpsCount;if(M){d+=1,p+=M;let C=A.structureId;E.push(C)}}return ai({structureIds:E,eventId:s==null?void 0:s.eventId,drawDefinition:R}),E.length}function b({inheritedTieFormat:R,structure:D}){var A,M;let E=0,N=((A=_t({matchUpFilters:{matchUpTypes:[ci]},structure:D}))==null?void 0:A.matchUps)||[];for(let C of N){let O=m0({matchUp:C,updateInProgressMatchUps:t}),k=!1,x=la((M=C.tieMatchUps)==null?void 0:M.map(({collectionId:$})=>$)),F=SE({from:x,to:f});if(F.equivalent)C.tieFormat&&g(C)&&O&&(C.tieFormat=Br(n),k=!0);else{let{changes:$,changesArePossible:_}=u2({matchUp:C,check:F});if(_&&!C.tieFormat)S({changes:$,matchUp:C,tieFormat:n,uuids:l});else if(R)(!C.tieFormat||Su({ancestor:R,descendant:C.tieFormat}).different)&&(C.tieFormat=R,k=!0);else return Q({result:{error:wg},stack:c})}k&&(E+=1,St({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:E}}function S({uuids:R,matchUp:D,tieFormat:E,changes:N}){D.tieFormat=Br(E);let A=[],M=[];return N.forEach(C=>{if(C.countChange>0){let O=Math.max(0,...D.tieMatchUps.filter(F=>F.collectionId===C.collectionId).map(ca("collectionPosition"))),k=E.collectionDefinitions.find(F=>F.collectionId===C.collectionId),x=vb({matchUpsLimit:C.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:D,uuids:R});M.push(...ke(x,!1,!0)),m+=M.length,D.tieMatchUps.push(...x)}else{let O=C.toBePlayedTieMatchUpIds.slice(0,Math.abs(C.countChange));console.log("remove",O.length),A.push(...O),D.tieMatchUps=D.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&Rc({matchUps:M,drawDefinition:i,tournamentId:u,eventId:a}),A.length&&$u({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function u2({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===ji).map(ca("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function ZD({appliedPolicies:t,drawDefinition:e,auditData:i}){var a;if(!((a=t==null?void 0:t.audit)!=null&&a[Kv]))return;let{extension:r}=dt({name:Kv,element:e}),n={value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(i):[i],name:Kv};Ct({element:e,extension:n})}function gx({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:I,scoreValue:y,setValue:b}){let S="modifyCollectionDefinition";if(o&&!da({matchUpFormat:o}))return Q({result:{error:le},context:{matchUpFormat:o},stack:S});if(r&&typeof r!="string")return Q({result:{error:le},context:{collectionName:r},stack:S});if(h&&!Object.values(qT).includes(h))return Q({result:{error:le},context:{gender:h},stack:S});if(p&&typeof p!="object")return Q({result:{error:le},context:{category:p},stack:S});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:I,scoreValue:y,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!r&&!o&&!s&&!c)return Q({result:{error:ze},stack:S});if(Object.values(w).filter(Boolean).length>1)return Q({info:"Only one value assignment allowed per collectionDefinition",result:{error:le},stack:S});let U=Wd({drawDefinition:a,structureId:u,matchUpId:d,eventId:m,event:f});if(U.error)return Q({result:U,stack:S});let{matchUp:T,structure:P,tieFormat:R}=U,D=Br(R),E=R==null?void 0:R.collectionDefinitions.find(L=>L.collectionId===l),N=D==null?void 0:D.collectionDefinitions.find(L=>L.collectionId===l);if(!E)return Q({info:"source collectionDefinition",result:{error:Nr},context:{collectionId:l},stack:S});let A=v??I??y??b;if(g!=null&&g.length){let L=lq({matchUpCount:s??(E==null?void 0:E.matchUpCount)??0,collectionValueProfiles:g});if(L.errors)return Q({result:{error:le},info:L.errors,stack:S})}else if(A&&!rt(A))return Q({result:{error:le},info:"value is not an integer",context:{value:A},stack:S});let M=(L,B)=>Vi(Object.keys(L),Object.keys(B)).length===Object.keys(L).length&&Vi(Object.values(L),Object.values(B)).length===Object.values(L).length,C=g&&(!E.collectionValueProfiles||!M(E.collectionValueProfiles,g)),O=rt(v)&&E.collectionValue!==v||rt(I)&&E.matchUpValue!==I||rt(y)&&E.scoreValue!==y||rt(b)&&E.setValue!==b||C,k=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),k.push({collectionId:l,...Ge(w)})),(rt(y)||rt(b))&&N.collectionGroupNumber){let L=N.collectionGroupNumber;D.collectionDefinitions=D.collectionDefinitions.map(B=>{let{collectionGroupNumber:V,...G}=B;return V===L?G:B}),D.collectionGroups=D.collectionGroups.filter(({groupNumber:B})=>B!==L),k.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:x,valueGoal:F}=vh(D),$=Ge({aggregateValue:x,valueGoal:F});if(($.aggregateValue!==(R==null?void 0:R.winCriteria.aggregateValue)||$.valueGoal!==(R==null?void 0:R.winCriteria.valueGoal))&&(D.winCriteria=$,k.push({collectionId:l,winCriteria:$})),rt(i)&&E.collectionOrder!==i&&(N.collectionOrder=i,k.push({collectionId:l,collectionOrder:i})),r&&E.collectionName!==r&&(N.collectionName=r,k.push({collectionId:l,collectionName:r})),o&&E.matchUpFormat!==o&&(N.matchUpFormat=o,k.push({collectionId:l,matchUpFormat:o})),rt(s)&&E.matchUpCount!==s&&(N.matchUpCount=s,k.push({collectionId:l,matchUpCount:s})),c&&E.matchUpType!==c)return Q({result:{error:hT},context:{matchUpType:c},stack:S});p&&E.category!==p&&(N.category=p,k.push({collectionId:l,category:p})),h&&E.gender!==h&&(N.gender=h,k.push({collectionId:l,gender:h}));let _=Ge(D);if(U=qn({tieFormat:_}),U.error)return Q({result:U,stack:S});if(!k.length)return Q({result:{...X,modifications:k}});if((R==null?void 0:R.tieFormatName)!==n?(_.tieFormatName=n,k.push({tieFormatName:n})):k.length&&(delete _.tieFormatName,k.push("tieFormatName removed: modifications without new tieFormatName")),U=Rme({tieFormat:_,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:P,eventId:m,matchUp:T,event:f}),!U.error){let{appliedPolicies:L}=Nt({tournamentRecord:e}),B=Ge({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:S,structureId:u,matchUpId:d,eventId:m});ZD({appliedPolicies:L,drawDefinition:a,auditData:B})}return Q({result:{...U,modifications:k},stack:S})}function Eme({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var s,l;let o=[];return n&&a?o=[a]:i&&r?o=((s=_t({matchUpFilters:{matchUpTypes:[ci]},structure:r}))==null?void 0:s.matchUps)??[]:e&&(o=((l=vn({matchUpFilters:{matchUpTypes:[ci]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(c=>!c.winningSide&&c.matchUpStatus!==_i&&(t||c.matchUpStatus!==jo&&!gr(c)))}}function Cme({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=Br(n));let l;if(t){let c=Nt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=Gu({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}s&&!l&&St({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...X}}function iY({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=vh(l);l.winCriteria=Ge({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=Eme({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:c,matchUp:u});Cme({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=Ge(l),v=qn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:xe};return ai({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...X}}function rY({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:c}){if(!e)return{error:ze};if(isNaN(e))return{error:le};let u="removeCollectionGroup",d=s?void 0:Wd({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:c});if(d!=null&&d.error)return Q({result:d,stack:u});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let m=d==null?void 0:d.tieFormat,h=m==null?void 0:m.winCriteria.valueGoal,f=m==null?void 0:m.winCriteria.aggregateValue,g=Br(m);if(d=qn({tieFormat:g}),d.error)return Q({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(I=>{let{collectionGroupNumber:y,...b}=I;return y!==e?I:(v.push(I.collectionId),b)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:I})=>I!==e),d=iY({updateInProgressMatchUps:t,originalValueGoal:h,wasAggregateValue:f,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:c}),!d.error){let{appliedPolicies:I}=Nt({tournamentRecord:i}),y=Ge({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:o,eventId:l});ZD({appliedPolicies:I,drawDefinition:r,auditData:y})}return Q({result:{...d,modifiedCollectionIds:v},stack:u})}function Vf({tieFormat:t,orderMap:e}){var r;let i=Br(t);return i.collectionDefinitions.forEach(n=>{let a=e[n.collectionId];a&&(n.collectionOrder=a)}),(r=i.collectionDefinitions)==null||r.sort((n,a)=>bf(n.collectionOrder)-bf(a.collectionOrder)),i}function nY({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>rt(l)))return Q({result:{error:le},context:{orderMap:n}});if(a&&(s!=null&&s.tieFormat))c2({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&hi({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:Hn};o!=null&&o.tieFormat&&(o.tieFormat=Vf({tieFormat:o.tieFormat,orderMap:n}),St({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=Qe({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=Vf({tieFormat:c.tieFormat,orderMap:n}),aY({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),ai({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)c1({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)c2({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:Nr}}else if(e!=null&&e.tieFormat)c1({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:Nr};return{...X}}function c2({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=Vf({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])c1({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function c1({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=Vf({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=Vf({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),aY({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));ai({drawDefinition:e,structureIds:s})}function aY({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var o;let a=(o=_t({matchUpFilters:{matchUpTypes:[ci]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=Vf({tieFormat:s.tieFormat,orderMap:r}),St({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function vx({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:c,event:u}){var D,E,N,A,M;let d="removeCollectionDefinition",p=c?void 0:Wd({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:u});if(p!=null&&p.error)return Q({result:p,stack:d});let m=p==null?void 0:p.structure;c=c??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=Br(h);if(p=qn({tieFormat:f}),p.error)return Q({result:p,stack:d});let g=(D=f==null?void 0:f.collectionDefinitions)==null?void 0:D.find(C=>C.collectionId===a);if(!g)return Q({result:{error:Nr,collectionId:a}});f.collectionDefinitions=f.collectionDefinitions.filter(C=>C.collectionId!==a),g.collectionGroupNumber&&(f.collectionDefinitions=f.collectionDefinitions.map(C=>{let{collectionGroupNumber:O,...k}=C;return k}),f.collectionGroups=f.collectionGroups.filter(({groupNumber:C})=>C!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:I}=vh(f);f.winCriteria=Ge({aggregateValue:v,valueGoal:I});let y=h==null?void 0:h.winCriteria.valueGoal,b=h==null?void 0:h.winCriteria.aggregateValue;(y&&y!==I||v&&!b)&&(n?f.tieFormatName=n:delete f.tieFormatName);let S=[];s&&c?S=[c]:o&&m?S=((E=_t({matchUpFilters:{matchUpTypes:[ci]},structure:m}))==null?void 0:E.matchUps)??[]:r?S=((N=vn({matchUpFilters:{matchUpTypes:[ci]},drawDefinition:r}))==null?void 0:N.matchUps)??[]:u&&(S=((A=Kl({matchUpFilters:{matchUpTypes:[ci]},drawDefinition:r}))==null?void 0:A.matchUps)??[]);let w=(S||[]).filter(C=>{var x,F,$;let O=(F=(x=C.tieMatchUps)==null?void 0:x.filter(_=>_.collectionId===a))==null?void 0:F.some(gr),k=e&&C.tieFormat?($=Su({descendant:C.tieFormat,ancestor:f}))==null?void 0:$.different:!1;return t&&!O||!C.winningSide&&C.matchUpStatus!==_i&&(t||C.matchUpStatus!==jo&&!gr(C)&&!k)});if(!w.length)return{error:Tg};let{appliedPolicies:U}=Nt({tournamentRecord:i});if(s&&c&&t){let C=(M=c.tieMatchUps)==null?void 0:M.filter(O=>O.collectionId===a);for(let O of C??[]){let k=Fb({matchUpId:O.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:u});if(k.error||(k=hi({drawDefinition:r,matchUpId:s}),k.error))return k;c=k==null?void 0:k.matchUp}}let T=[];for(let C of w){for(let O of(C==null?void 0:C.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(C.tieMatchUps=(C.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&T.push(O.matchUpId),!k}),C.tieFormat&&(C.tieFormat=Br(f)),t){let O=Gu({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:U,drawDefinition:r,event:u});if(O.error)return O}St({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:r,context:d,matchUp:C})}T.length&&$u({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:T,eventId:u==null?void 0:u.eventId,drawDefinition:r});let P=Ge(f);if(p=qn({tieFormat:P}),p.error)return Q({result:p,stack:d});if(l&&u)u.tieFormat=P;else if(s&&c)c.tieFormat=P;else if(m)m.tieFormat=P;else if(r)r.tieFormat=P;else if(!c||!r)return{error:xe};ai({drawDefinition:r,eventId:u==null?void 0:u.eventId});let R=Ge({drawId:r==null?void 0:r.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});return ZD({appliedPolicies:U,drawDefinition:r,auditData:R}),{tieFormat:P,deletedMatchUpIds:T,targetMatchUps:w,...X}}function oY({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(n))return Q({result:{error:ze},stack:d});let p=l?void 0:Wd({drawDefinition:r,structureId:o,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return Q({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=Br(h);if(p=qn({tieFormat:g}),p.error)return Q({result:p,stack:d});for(let I of g.collectionDefinitions){let{collectionId:y,collectionGroupNumber:b}=I;if(b&&n.includes(y))return Q({info:"collectionIds cannot be part of other collectionGroups",result:{error:le},stack:d})}let v=(g.collectionGroups||[]).reduce((I,y)=>y.groupNumber>I?y.groupNumber:I,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(I=>n.includes(I.collectionId)?{...I,collectionGroupNumber:v}:I),g.collectionGroups=[...g.collecitonGroups||[],i],iY({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function Ix({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var F,$;let g="addCollectionDefinition",v=Nt({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},I=(n==null?void 0:n[Pr])??(v==null?void 0:v[Pr]);a=a??((F=I==null?void 0:I.participants)==null?void 0:F.enforceCategory);let y=(c??(($=I==null?void 0:I.participants)==null?void 0:$.enforceGender))!==!1,b=!!((i??(f==null?void 0:f.category))&&a!==!1),S=!!((o??(f==null?void 0:f.gender))&&y),w=bb({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:b,checkGender:S,event:f});if(w.error)return Q({result:w,stack:g});let U=p!=null&&p.tieFormat?void 0:Wd({drawDefinition:s,structureId:u,matchUpId:d,eventId:m,event:f});if(U!=null&&U.error)return Q({result:{error:U.error},stack:g});let T=U==null?void 0:U.structure;p=p??(U==null?void 0:U.matchUp);let P=(p==null?void 0:p.tieFormat)??(U==null?void 0:U.tieFormat),R=Br(P);if(U=qn({tieFormat:R}),U==null?void 0:U.error)return Q({result:{error:U.error},stack:g});if(!e.collectionId)e.collectionId=Vt();else if(R.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return Q({context:{collectionId:e.collectionId},result:{error:zG}});R.collectionDefinitions.push(e),R.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:D,valueGoal:E}=vh(R);R.winCriteria=Ge({aggregateValue:D,valueGoal:E});let N=P==null?void 0:P.winCriteria.valueGoal,A=P==null?void 0:P.winCriteria.aggregateValue;(N&&N!==E||D&&!A)&&(l?R.tieFormatName=l:delete R.tieFormatName);let M=[],C=[],O=[],k=Ge(R);if(U=qn({tieFormat:k}),U==null?void 0:U.error)return Q({result:{error:U.error},stack:g});if(m&&f){f.tieFormat=k;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});C.push(...B.newMatchUps),O.push(...B.targetMatchUps),M.push(L.structureId)}xU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(u&&T){T.tieFormat=k;let _=TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:T,uuids:h});C.push(..._.newMatchUps),O=_.targetMatchUps,xU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(d&&p){if(!m0({matchUp:p,updateInProgressMatchUps:t}))return Q({result:{error:SN},stack:g});p.tieFormat=k;let _=vb({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),C.push(..._),xU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:M,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else if(s){s.tieFormat=k;for(let _ of s.structures??[]){let L=TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});M.push(_.structureId),C.push(...L.newMatchUps),O.push(...L.targetMatchUps)}xU({modifiedMatchUps:O,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:C,stack:g})}else return{error:xe};let x=Ge({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:m});return ZD({appliedPolicies:v,drawDefinition:s,auditData:x}),{tieFormat:k,targetMatchUps:O,addedMatchUps:C,...X}}function TE({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var o;let n=[],a=((o=_t({matchUpFilters:{matchUpTypes:[ci]},structure:i}))==null?void 0:o.matchUps).filter(s=>m0({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=vb({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),n.push(...l)}return{newMatchUps:n,targetMatchUps:a}}function xU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Rc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{St({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),ai({structureIds:t,drawDefinition:r,eventId:a})}function sY({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,considerations:n,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,uuids:c,event:u}){let d="modifyTieFormat";if(!qn({tieFormat:i}).valid)return Q({result:{error:uu},info:"falied validation",stack:d});let p=Wd({drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:u});if(p.error)return Q({result:p,stack:d});let{matchUp:m,tieFormat:h}=p,f=Br(h),g=Su({descendant:i,ancestor:f,considerations:n});if(g.invalid)return Q({context:{invalid:g.invalid},result:{error:uu},stack:d});if(!(g!=null&&g.different))return Q({result:{...X},info:"Nothing to do",stack:d});let v=f.collectionDefinitions.map(({collectionId:P})=>P),I=i.collectionDefinitions.map(({collectionId:P})=>P),y=v.filter(P=>!I.includes(P)),b=i.collectionDefinitions.filter(({collectionId:P})=>!v.includes(P)),S=b.map(ca("collectionId")),w=[],U,T=i.tieFormatName;for(let P of i.collectionDefinitions){if(S.includes(P.collectionId))continue;let R=gx({updateInProgressMatchUps:t,...P,tournamentRecord:r,tieFormatName:T,drawDefinition:a,structureId:o,matchUpId:s,eventId:l,event:u});if(R.modifications&&w.push(...R.modifications),R.error)return Q({result:R,stack:d});R.tieFormat&&(U=R.tieFormat)}for(let P of b){let R=Ix({updateInProgressMatchUps:t,collectionDefinition:P,tournamentRecord:r,drawDefinition:a,tieFormatName:T,structureId:o,matchUpId:s,matchUp:m,eventId:l,uuids:c,event:u});if(R.error)return Q({result:R,stack:d});R.tieFormat&&(U=R.tieFormat)}for(let P of y){let R=vx({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:a,tieFormatName:T,collectionId:P,structureId:o,matchUpId:s,eventId:l,matchUp:m,event:u});if(R.error)return Q({result:R,stack:d});R.tieFormat&&(U=R.tieFormat)}return(h==null?void 0:h.tieFormatName)!==T?(U.tieFormatName=T,w.push({tieFormatName:T})):(w.length||S.length||y.length)&&(delete U.tieFormatName,w.push("tieFormatName removed: modifications without new tieFormatName")),U.collectionDefinitions=U.collectionDefinitions.sort((P,R)=>bf(P.collectionOrder)-bf(R.collectionOrder)).map((P,R)=>({...P,collectionOrder:R+1})),{processedTieFormat:Br(U),modifications:w,...X}}function lY({tournamentRecord:t}){if(!t)return{error:fe};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let d;for(let p of r)Su({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=ke(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Vt()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(u,d)=>{var m;let p=(m=l.matchUps)==null?void 0:m.find(h=>h.matchUpId===u);p&&(p.tieFormatId=d,delete p.tieFormat,St({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=u=>{let d=ke(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Vt()),r.push(d),e+=1,o(u.matchUpId,d.tieFormatId)},l=Kl({matchUpFilters:{matchUpTypes:[zs]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of r)u.tieFormat&&Su({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(u.matchUpId,d):s(u)}r.length&&(i.tieFormats=r)}return{...X,addedCount:e}}var uY={};gt(uY,{addDrawDefinitionExtension:()=>ST,addEventExtension:()=>qc,addEventTimeItem:()=>hh,addExtension:()=>Ct,addNotes:()=>rD,addOnlineResource:()=>fY,addParticipantExtension:()=>CH,addParticipantTimeItem:()=>cO,addTimeItem:()=>Jl,addTournamentExtension:()=>iA,addTournamentTimeItem:()=>mh,analyzeDraws:()=>Sb,analyzeTournament:()=>sk,createTournamentRecord:()=>KD,generate:()=>cY,getAllowedDrawTypes:()=>wD,getAllowedMatchUpFormats:()=>nk,getAppliedPolicies:()=>Nt,getCompetitionDateRange:()=>SD,getCompetitionPenalties:()=>ak,getPolicyDefinitions:()=>Bu,getTournamentInfo:()=>gh,getTournamentPenalties:()=>UD,getTournamentPersons:()=>ok,getTournamentStructures:()=>lO,getTournamentTimeItem:()=>_T,mutate:()=>dY,query:()=>S6,removeDrawDefinitionExtension:()=>MH,removeEventExtension:()=>TT,removeExtension:()=>gn,removeNotes:()=>TO,removeOnlineResource:()=>hY,removeParticipantExtension:()=>NH,removeTournamentExtension:()=>rA,setTournamentCategories:()=>IY,setTournamentDates:()=>QD,setTournamentEndDate:()=>bY,setTournamentName:()=>gY,setTournamentNotes:()=>vY,setTournamentStartDate:()=>yY,setTournamentStatus:()=>mY});var cY={};gt(cY,{createTournamentRecord:()=>KD});var dY={};gt(dY,{addDrawDefinitionExtension:()=>ST,addEventExtension:()=>qc,addEventTimeItem:()=>hh,addExtension:()=>Ct,addNotes:()=>rD,addOnlineResource:()=>fY,addParticipantExtension:()=>CH,addParticipantTimeItem:()=>cO,addTimeItem:()=>Jl,addTournamentExtension:()=>iA,addTournamentTimeItem:()=>mh,removeDrawDefinitionExtension:()=>MH,removeEventExtension:()=>TT,removeExtension:()=>gn,removeNotes:()=>TO,removeOnlineResource:()=>hY,removeParticipantExtension:()=>NH,removeTournamentExtension:()=>rA,setTournamentCategories:()=>IY,setTournamentDates:()=>QD,setTournamentEndDate:()=>bY,setTournamentName:()=>gY,setTournamentNotes:()=>vY,setTournamentStartDate:()=>yY,setTournamentStatus:()=>mY});var Mme="ABANDONED",Nme="ACTIVE",Ame="CANCELLED",Ome="COMPLETED",kme="IN_PROGRESS",pY={ABANDONED:Mme,ACTIVE:Nme,CANCELLED:Ame,COMPLETED:Ome,IN_PROGRESS:kme};function mY({tournamentRecord:t,status:e}){return t?e&&!Object.keys(pY).includes(e)?{error:le,info:"Unknown status"}:(t.tournamentStatus=e,{...X}):{error:fe}}function hY(t){var c,u,d;let e=it(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((c=i.parentOrganisation)==null?void 0:c.parentOrganisationId)!==n)return Q({result:{error:Nr}});qh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return Q(o?{result:{error:Nr}}:{result:{error:Li}});if(o){if(((u=p.person)==null?void 0:u.personId)!==o)return Q({result:{error:Ym}});qh({element:p.person,onlineResource:r})}else qh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return Q({result:{error:Sg}});qh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return Q({result:{error:Jm}});qh({element:p,onlineResource:r})}else qh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:rh});return{...X}}function qh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>!((r==null?void 0:r[wf])===e[wf]&&(r==null?void 0:r[Uf])===e[Uf]&&(r==null?void 0:r[Sf])===e[Sf]));t.onlineResources=i}function fY(t){var c,u,d;let e=it(t,[{tournamentRecord:!0,onlineResource:!0}]);if(e.error)return e;let{tournamentRecord:i,onlineResource:r,organisationId:n,participantId:a,personId:o,courtId:s,venueId:l}=t;if(n){if(((c=i.parentOrganisation)==null?void 0:c.parentOrganisationId)!==n)return Q({result:{error:Nr}});Yh({element:i.parentOrganisation,onlineResource:r})}else if(a||o){let p=(i.participants??[]).find(m=>{var h;return o&&((h=m.person)==null?void 0:h.personId)===o||m.participantId===a});if(!p)return Q(o?{result:{error:Nr}}:{result:{error:Li}});if(o){if(((u=p.person)==null?void 0:u.personId)!==o)return Q({result:{error:Ym}});Yh({element:p.person,onlineResource:r})}else Yh({element:p,onlineResource:r})}else if(s){let p=(d=(i.venues??[]).filter(m=>!l||m.venueId===l).flatMap(m=>(m.courts??[]).filter(h=>h.courtId===s)))==null?void 0:d[0];if(!p)return Q({result:{error:Sg}});Yh({element:p,onlineResource:r})}else if(l){let p=(i.venues??[]).find(m=>m.venueId===l);if(!p)return Q({result:{error:Jm}});Yh({element:p,onlineResource:r})}else Yh({element:i,onlineResource:r}),lt({payload:{parentOrganisation:i.parentOrganisation,onlineResources:i.onlineResources,tournamentId:i.tournamentId},topic:rh});return{...X}}function Yh({element:t,onlineResource:e}){let i=(t.onlineResources??[]).filter(r=>(r==null?void 0:r[wf])!==e[wf]&&(r==null?void 0:r[Uf])!==e[Uf]&&(r==null?void 0:r[Sf])!==e[Sf]);return i.push(e),t.onlineResources=i,{...X}}function gY({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){if(!t)return{error:fe};let n=t.tournamentId,a={tournamentId:n};return i&&i!==t.tournamentName&&(t.tournamentName=i,a.tournamentName=i),e&&e!==t.promotionalName&&(t.promotionalName=e,a.promotionalName=e),r&&r!==t.formalName&&(t.formalName=r,a.formalName=r),t.promotionalName===t.tournamentName&&(delete t.promotionalName,a.promotionalName=""),t.formalName===t.tournamentName&&(delete t.formalName,a.formalName=""),Object.keys(a).length>1&&lt({topic:rh,payload:{parentOrganisation:t.parentOrganisation,tournamentId:n,...a}}),{...X}}function vY({tournamentRecord:t,notes:e}){if(!t)return{error:fe};let i=e?rD({element:t,notes:e}):TO({element:t});return i.error?i:(lt({topic:rh,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,notes:e??""}}),{...X})}function IY({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,lt({topic:rh,payload:{parentOrganisation:t.parentOrganisation,tournamentId:t.tournamentId,categories:e}}),{...X}):{error:fe}}function xme({tournamentRecord:t}){var a,o;if(!t)return{error:fe};let{startDate:e,endDate:i}=t,r=Tf(e,i),n=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&n.push(...s.courts);for(let s of n){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,m)=>{let h=Dt(p.startTime),f=Dt(p.endTime);return m.startTime&&Dt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&Dt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=r.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:c}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...X}}function QD(t){var d;let{tournamentRecord:e,startDate:i,endDate:r}=t,n=it(t,[{tournamentRecord:!0},{[ea]:p=>Al.test(p),[KN]:{startDate:!1,endDate:!1},[fs]:yn}]);if(n.error)return n;if(r&&i&&new Date(r)<new Date(i))return{error:le};let a;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||r&&e.endDate&&new Date(r)<new Date(e.endDate))&&(a=!0);let o=Tf(e.startDate,e.endDate);i&&(e.startDate=i),r&&(e.endDate=r);let s=Tf(e.startDate,e.endDate),l=o.filter(p=>!s.includes(p)),c=s.filter(p=>!o.includes(p));for(let p of e.events??[])i&&p.startDate&&new Date(p.startDate)<new Date(i)&&(p.startDate=i),r&&p.startDate&&new Date(p.startDate)>new Date(r)&&(p.startDate=i??r),r&&p.endDate&&new Date(p.endDate)>new Date(r)&&(p.endDate=r),i&&p.endDate&&new Date(p.endDate)<new Date(i)&&(p.endDate=r??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),r&&e.startDate&&new Date(r)<new Date(e.startDate)&&(e.startDate=r);let u=a&&((d=Fme({tournamentRecord:e}))==null?void 0:d.unscheduledMatchUpIds);return xme({tournamentRecord:e}),lt({payload:{parentOrganisation:e.parentOrganisation,tournamentId:e.tournamentId,startDate:i,endDate:r},topic:rh}),{...X,unscheduledMatchUpIds:u,datesAdded:c,datesRemoved:l}}function yY({tournamentRecord:t,startDate:e}){return QD({tournamentRecord:t,startDate:e})}function bY({tournamentRecord:t,endDate:e}){return QD({tournamentRecord:t,endDate:e})}function Fme({tournamentRecord:t}){let e=kr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||r&&c>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!qD({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:qj}:{unscheduledMatchUpIds:a}}var wY={};gt(wY,{addCourt:()=>XD,addCourts:()=>dx,addVenue:()=>eb,deleteCourt:()=>MY,deleteVenue:()=>Ux,deleteVenues:()=>DY,disableCourts:()=>PY,disableVenues:()=>RY,enableCourts:()=>EY,enableVenues:()=>CY,generate:()=>UY,generateCourts:()=>$k,getCompetitionVenues:()=>Rb,getCourts:()=>Dk,getVenuesAndCourts:()=>Hu,modifyCourt:()=>Sx,modifyCourtAvailability:()=>bx,modifyVenue:()=>NY,mutate:()=>SY,publicFindVenue:()=>jA,query:()=>_6});var UY={};gt(UY,{generateCourts:()=>$k});var SY={};gt(SY,{addCourt:()=>XD,addCourts:()=>dx,addVenue:()=>eb,deleteCourt:()=>MY,deleteVenue:()=>Ux,deleteVenues:()=>DY,disableCourts:()=>PY,disableVenues:()=>RY,enableCourts:()=>EY,enableVenues:()=>CY,modifyCourt:()=>Sx,modifyCourtAvailability:()=>bx,modifyVenue:()=>NY});function yx(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:fe};if(!(t!=null&&t.courtId))return{error:qm};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=zu({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=kr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var h,f,g;let m=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===u||(m==null?void 0:m.includes(u))});return s0({matchUps:d,schedulingProfile:o})}}function Lme({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:fe};if(!r)return{error:zc};let{schedulingProfile:n}=zu({tournamentRecord:e}),{matchUps:a}=kr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let c=s.filter(u=>{var p,m,h;let d=(m=(p=u.schedule)==null?void 0:p.allocatedCourts)==null?void 0:m.map(({venueId:f})=>f);return((h=u.schedule)==null?void 0:h.venueId)===l||(d==null?void 0:d.includes(l))});return s0({matchUps:c,schedulingProfile:n})}}function bx({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var m,h,f;if(!t)return{error:fe};if(!n)return{error:qm};let o=a5({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=_me(e);e=s;let c=sh({tournamentRecord:t,courtId:n});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=yx({tournamentRecord:t,venueMatchUps:r,courtId:n});if(p!=null&&p.length){let g=(m=Nt({tournamentRecord:t}))==null?void 0:m.appliedPolicies,v=a??((f=(h=g==null?void 0:g[Wc])==null?void 0:h.allowDeletionWithScoresPresent)==null?void 0:f.courts),I=[];I.length&&(v||console.log("throw error: scheduled court matchUps",I.length))}return u&&(u.dateAvailability=e,!i&&d&&lt({payload:{venue:d,tournamentId:t.tournamentId},topic:dp,key:d.venueId})),{...X,totalMergeCount:l}}function _me(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:c}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:c}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(ime);let{mergedAvailability:a,mergeCount:o}=$me(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function $me(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(n-=1,!e)e=c,r=d,i=u;else if(Oy(Qi(i),Qi(c),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=c,r=d,i=u}else d&&(r?r.push(d):r=d),i=u,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function wx({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:JG,info:e}}function TY({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:pn};if(!e&&!r)return{error:Ds};let a;if(!e){if(!t)return{error:fe};({drawDefinition:e}=An({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=hi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:fe};let o=kr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=oq({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Ld,bu].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Ld,bu].includes(o)),St({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...X}):{error:tn}}function Ux(t){var l,c,u;if(typeof(t==null?void 0:t.venueId)!="string")return{error:zc};let{tournamentRecord:e,venueId:i,force:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(n).length)return{error:fe};let a=ys({tournamentRecords:n,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=Nt({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=r??((u=(c=o==null?void 0:o[Wc])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:u.venues);if(!a.length||s)for(let d of Object.values(n)){for(let m of a){let h=TY({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==i?!0:(p=!0,!1)),p&&lt({payload:{venueId:i,tournamentId:d.tournamentId},topic:wA,key:i})}else return wx({matchUpsCount:a.length});return Cb({tournamentRecords:n}),{...X}}function DY({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:fe};if(!Array.isArray(e))return{error:le};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=Ux({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...X}}function PY(t){let{courtIds:e,dates:i}=t,r=lo(t),n=[{[rn]:!0,[wT]:!0}],a=it(t,n);if(a.error)return a;for(let o of Object.values(r))Bme({tournamentRecord:o,courtIds:e,dates:i});return{...X}}function Bme({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Ct({extension:{value:r,name:ss},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...X}}function RY(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[rn]:!0,[UT]:!0}],a=it(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];Vme({tournamentRecord:l,venueIds:r})}return{...X}}function Vme({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=Ct({creationTime:!1,element:i,extension:{name:ss,value:!0}});if(r.error)return r}return{...X}}function EY(t){let e=lo(t),i=[{[rn]:!0}];!t.enableAll&&i.push({[wT]:!0});let r=it(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))jme({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...X}}function jme({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=dt({element:a,name:ss});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),Ct({extension:{name:ss,value:s},creationTime:!1,element:a})}}else gn({element:a,name:ss});return{...X}}function CY(t){let e=lo(t),i=[{[rn]:!0}];!t.enableAll&&i.push({[UT]:!0});let r=it(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&gn({element:s,name:ss});return{...X}}function MY(t){let{courtId:e,disableNotice:i,force:r}=t,n=lo(t),a=it(t,[{[rn]:!0,[bH]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=Gme({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==Sg)return s;s.success&&(o=!0)}return o?{...X}:s}function Gme({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var c,u,d;let n=sh({tournamentRecord:t,courtId:i});if(n.error)return n;let a=n.venue,{matchUps:o}=yx({tournamentRecord:t,courtId:i}),s=(c=Nt({tournamentRecord:t}))==null?void 0:c.appliedPolicies,l=r??((d=(u=s==null?void 0:s[Wc])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let m=TY({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||lt({payload:{venue:a,tournamentId:t.tournamentId},topic:dp,key:a.venueId}))}else return wx({matchUpsCount:o.length});return{...X}}function Sx(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=lo(t);if(!Object.keys(o).length)return{error:Di};let s,l;for(let c of Object.values(o)){let u=Hme({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u!=null&&u.error)return u;s=!0}return s?{...X}:l}function Hme({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:fe};if(!n)return{error:qm};if(!r||typeof r!="object")return{error:Lu};let o=sh({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,c=Object.keys(tme()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>c.includes(p)).length)return{error:mT};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=bx({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||lt({payload:{venue:s,tournamentId:t.tournamentId},topic:dp,key:s==null?void 0:s.venueId}),{...X,court:ke(l)}}var zme=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),Wme=zme;function NY(t){let{modifications:e,venueId:i,force:r}=t,n=lo(t);if(!Object.keys(n).length)return{error:Di};if(typeof i!="string")return{error:zc};let a,o;for(let s of Object.values(n)){let l=qme({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==Jm)return l}return Cb({tournamentRecords:n}),o?{...X}:{error:a}}function qme({tournamentRecord:t,modifications:e,venueId:i,force:r}){var g,v,I,y,b,S,w,U;if(!t)return{error:fe};if(!e||typeof e!="object")return{error:Lu};if(!i)return{error:zc};let n=(g=Nt({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=r??((I=(v=n==null?void 0:n[Wc])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:I.venues),{matchUps:o}=Lme({tournamentRecord:t,venueId:i}),s=ju({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,c=Object.keys(Wme()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>c.includes(T)).length)return{error:mT};let u=c.filter(T=>!["courts","onlineResources"].includes(T)),d=Object.keys(e).filter(T=>u.includes(T));l&&d.forEach(T=>Object.assign(l,{[T]:e[T]}));let p=((y=l==null?void 0:l.courts)==null?void 0:y.map(T=>T.courtId))??[],m=((b=e.courts)==null?void 0:b.map(T=>T.courtId))||[],h=m.length?p.filter(T=>!m.includes(T)):(e==null?void 0:e.courts)&&p,f=[];if(h!=null&&h.length){let T=(w=(S=l==null?void 0:l.courts)==null?void 0:S.filter(P=>h.includes(P.courtId)))==null?void 0:w.map(P=>{var D;let R=yx({courtId:P.courtId,tournamentRecord:t,venueMatchUps:o});for(let E of R.matchUps??[])f.push({matchUpId:E.matchUpId,drawId:E.drawId});return((D=R.matchUps)==null?void 0:D.length)??0}).reduce((P,R)=>P+R);if(l&&(!T||a))l.courts=(U=l.courts)==null?void 0:U.filter(P=>m.includes(P.courtId)),zI({schedule:{courtId:"",scheduledDate:""},matchUpDetails:f,removePriorValues:!0,tournamentRecord:t});else return wx({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:P}=T||{},R=Sx({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:P,force:r});if(R.error===Sg&&(R=XD({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),R.error)return R}return Cb({tournamentRecord:t}),l&&lt({payload:{venue:l,tournamentId:t.tournamentId},topic:dp,key:l==null?void 0:l.venueId}),{...X,venue:ke(l)}}var eP={};gt(eP,{JSON2CSV:()=>ehe,UUID:()=>Vt,UUIDS:()=>coe,allNumeric:()=>nH,attributeFilter:()=>Um,chunkArray:()=>Ar,chunkByNth:()=>wC,chunkSizeProfile:()=>rH,constantToString:()=>Hr,countValues:()=>cne,createMap:()=>Hj,dateTime:()=>EH,definedAttributes:()=>Ge,dehydrateMatchUps:()=>Jme,extractAttributes:()=>zz,flattenJSON:()=>Tx,generateDateRange:()=>Tf,generateHashCode:()=>Dre,generateRange:()=>Re,generateTimeCode:()=>p5,groupValues:()=>tH,hasAttributeValues:()=>Tre,instanceCount:()=>la,intersection:()=>Vi,isConvertableInteger:()=>rt,isNumeric:()=>Mi,isOdd:()=>QG,isPowerOf2:()=>hs,makeDeepCopy:()=>ke,matchUpScheduleSort:()=>Kme,matchUpSort:()=>lh,nearestPowerOf2:()=>_N,nextPowerOf2:()=>Dg,noNulls:()=>une,noNumeric:()=>aH,numericSort:()=>ar,occurrences:()=>pne,overlap:()=>bn,randomMember:()=>Zn,randomPop:()=>ia,shuffleArray:()=>fn,structureSort:()=>ih,subSort:()=>mne,undefinedToNull:()=>cC,unique:()=>mt,visualizeScheduledMatchUps:()=>Yme});function Yme({scheduledMatchUps:t,showGlobalLog:e}){Loe();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var s;Xa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===n),o=((s=wn({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{Xa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:c,schedule:u})=>{let d=mi(u.scheduledTime);Xa({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&Foe()}var{extractTime:d2,timeStringMinutes:p2}=EH;function Kme(t,e){let i=t.schedule??{},r=e.schedule??{};if(i.scheduledDate&&!r.scheduledDate)return 1;if(r.scheduledDate&&!i.scheduledDate)return-1;if(i.scheduledDate&&r.scheduledDate){if(i.scheduledDate===r.scheduledDate){if(i.scheduledTime&&!r.scheduledTime)return 1;if(r.scheduledTime&&!i.scheduledTime)return-1;if(i.scheduledTime&&r.scheduledTime){let n=p2(d2(i.scheduledTime)),a=p2(d2(r.scheduledTime));return n-a}}return new Date(i.scheduledDate).getTime()-new Date(r.scheduledDate).getTime()}return 0}function Jme({tournamentRecord:t}){if(!t)return{error:fe};if(typeof t!="object"||!t.tournamentId)return{error:le};let{matchUps:e}=kr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=Xme({tournamentRecord:t});Qme(e,i)}return{...X}}function Xme({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Zme=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function Qme(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))Zme.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function ehe(t,e){if(e&&typeof e!="object")return{error:le};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:le};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>Tx(A,g)),I=Object.values(i).flat();r&&l.push(...I);let y=v.reduce((A,M)=>Object.keys(M).every(C=>!A.includes(C)&&A.push(C)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=y.reduce((A,M)=>{let C=b[M];return C?A.includes(C)||A.push(C):A.push(M),A},[]).sort(S);Object.keys(u).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>u[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,P=[],R=A=>Object.values(w.reduce((M,C,O)=>{var _;let k=i[C],x=(k!=null&&k.length?A[k.find(L=>A[L])]:A[C])||(p==null?void 0:p[C])||"",F=((_=d[C])==null?void 0:_[x])||x,$=Qn(c[C])?c[C](F):F;return M[C]=T($),$&&(P[O]=(P[O]||0)+1),M},{})),D=v.map(R),E=o&&[...P].map((A,M)=>!A&&M).filter(Mi).reverse();if(E){let A=M=>M.filter((C,O)=>!E.includes(O));D=D.map(A),U=A(U)}let N=D.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((C,O)=>({[U[O]]:C})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function Tx(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,Tx(t[n],e,i.concat(n))),{})}var{FACTORY:m2}=OH;function the({tournamentRecord:t,value:e}){let{extension:i}=dt({element:t,name:m2}),r={name:m2,value:{...i==null?void 0:i.value,...e}};Ct({element:t,extension:r})}function AY({timeStamp:t}){let e=Zm(),i=BN();return i&&Object.values(e).forEach(r=>{the({tournamentRecord:r,value:{version:rT(),timeStamp:t}})}),i}function OY({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var d,p;let a=Ra();if(typeof a!="object")return;let o={method:e},s=(n==null?void 0:n.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!u&&(s||c)&&(o.params=r),!u&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=n),Object.keys(o).length>1&&hH(o,t)}function Dx({methodName:t,params:e,start:i}){let r={error:fT,methodName:t},n=i?Date.now()-i:0;return OY({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function ihe(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:fe};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=An({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=An({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:sa};e.tournamentId=s,e.event=o}let r=e.tournamentId??Xm();if(!r&&e)return e;let n=t[r];return r&&!n?{error:fe}:(n&&(e.tournamentRecord=n),e)}function Px(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=Xm();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||jN(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Zm(),c=i?ke(i,void 0,!0):void 0,u=i?ihe(l,i):void 0;if(u!=null&&u.error)return u;let d=rhe({params:u,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return OY({result:d,methodName:r,elapsed:p,params:c,engineType:n}),d}function rhe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(Ra())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return IT({engineName:"engine",methodName:r,params:i,err:a})}}function tP(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=Vo();for(let o of[...a].sort(nhe)){let s=dH({topic:o});s!=null&&s.length&&UC({topic:o,notices:s})}e&&n&&a.includes(RC)&&UC({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:RC})}var h2={[CA]:5,[EA]:5,[MA]:5,[RA]:5,[PA]:5,[TA]:5,[ez]:5,[tz]:5,[DA]:1,[kT]:1,[qr]:5,[dp]:5,[SA]:4,[bA]:4,[wA]:4,[UA]:4,[OT]:3,[gA]:2};function nhe(t,e){return(h2[e]||0)-(h2[t]||0)}function ahe({convertExtensions:t,removeExtensions:e}){let i=Zm();return{tournamentId:Xm(),tournamentRecords:ke(i,t,!1,e)}}function ohe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??Xm();if(typeof r!="string")return{};let n=jN(r);return{tournamentRecord:ke(n,e,!1,i)}}function she(){var r;let t=Zm(),{extension:e}=dt({name:Od,tournamentRecords:t,discover:!0}),i=((r=e==null?void 0:e.value)==null?void 0:r.tournamentIds)||[];return Object.keys(t).forEach(n=>{i.includes(n)||delete t[n]}),vT(t)}function f2(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Lu}:t!=null&&t.tournamentId?pH(e?ke(t):t):{error:le}}function WI(t,e=!0){if(typeof t!="object")return{error:Lu};if(SI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:mC};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},SI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:mC};return vT(e?ke(t):t)}function lhe(t,e,i,r,n,a){let o=fH(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>Qn(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(Ra())return u();try{return u()}catch(d){IT({engineName:"engine",methodName:l,params:c,err:d})}}}),{...X,...t}}function Kh(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function kY(t,e){t.importMethods=(i,r,n,a)=>lhe(t,e,i,r,n,a),t.getTournament=i=>ohe(i),t.getState=i=>ahe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>rT(),t.reset=()=>(vT({}),Kh(t)),t.devContext=i=>(wI(i),Kh(t)),t.getDevContext=i=>Ra(i),t.newTournamentRecord=(i={})=>{let r=KD(i),n=r.tournamentId;return r.error?r:(f2(r),SI(n),{...X,tournamentId:n})},t.setState=(i,r,n)=>{UI(r,n);let a=WI(i,r);return Kh(t,a)},t.setTournamentId=i=>SI(i),t.getTournamentId=()=>Xm(),t.setTournamentRecord=(i,r,n)=>{UI(r,n);let a=f2(i,r);return Kh(t,a)},t.removeTournamentRecord=i=>{let r=mH(i);return Kh(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=she();return Kh(t,i)}}function uhe(t,e,i){if(!Array.isArray(e))return{error:le,message:"directives must be an array"};let r=cH(),n=Date.now(),a=i&&ke(Zm(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:le,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:le,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return Dx({methodName:u,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=Px(t,r[u],p,u,"sync");if(m!=null&&m.error)return a&&WI(a),{...m,rolledBack:!!a};o.push({...m,methodName:u})}let s=Date.now(),l=AY({timeStamp:s});return tP({directives:e,mutationStatus:l,timeStamp:s}),Ny(),{success:o.every(c=>c.success),results:o}}function g2(t,e){if(!Ut(e))return{error:le,message:"args must be an object"};let i=Object.values(e).filter(Qn).length;if(i>1)return{message:"there must be only one arg with typeof function",error:le};let r=i?Object.keys(e).find(m=>Qn(e[m])):Ki(e.method)&&e.method;if(!r)return{error:fT};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&ke(Zm(),!1,!0),l=n||t[r]||FN()[r];if(!l)return Dx({methodName:r,params:o});let c=Px(t,l,o,r,"sync")??{};c!=null&&c.error&&s&&WI(s);let u=Date.now(),d=AY({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&tP({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&Ny(),c}var che=(()=>{let t={executionQueue:(e,i)=>uhe(t,e,i),execute:e=>g2(t,e)};return kY(t,g2),t})(),Rx=che;function v2(t,e){if(!Ut(e))return{error:le,message:"args must be an object"};let i=Object.values(e).filter(Qn).length;if(i>1)return{message:"there must be only one arg with typeof function",error:le};let r=i?Object.keys(e).find(l=>Qn(e[l])):Ki(e.method)&&e.method;if(!r)return{error:fT};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||FN()[r];return s?Px(t,s,o,r,"ask"):Dx({methodName:r,params:o})}(()=>{let t={execute:e=>v2(t,e)};return kY(t,v2),t})();var om={},fc;function I2(t,e=!0){if(!t)return{error:ze};if(typeof t!="object")return{error:Lu};if(t.matchUpId)fc=t.matchUpId,om[fc]=e?ke(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(om[i.matchUpId]=e?ke(i):i,fc||(fc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(om[i.matchUpId]=e?ke(i):i,fc||(fc=i.matchUpId));return e?ke(t):t}function dhe(){return om[fc]}function phe(){return Object.values(om)}function mhe(){fc=void 0,om={}}function hhe(t){return ke(om[fc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>hhe(n),version:()=>rT(),reset:()=>(mhe(),{...X}),drawId:void 0,error:void 0,success:!1,devContext:n=>(wI(n),t),setState:(n,a,o)=>{UI(a,o);let s=I2(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([VO]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(Ra())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){IT({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||dhe(),l=(n==null?void 0:n.matchUps)||phe(),c=(n==null?void 0:n.rollbackOnError)&&ke(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=a[o](n);if(u!=null&&u.error)return c&&I2(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&tP(),(d||!(u!=null&&u.success)||n!=null&&n.doNotNotify)&&Ny(),u}})();var DE=!1;(()=>{let t={version:()=>rT(),setDeepCopy:(r,n)=>(UI(r,n),t),devContext:r=>(wI(r),DE=!0,t)};return i([tx]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||tP(),Ny(),DE&&(wI(!1),DE=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{if(Ra()){let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&WI(s.tournamentRecord),s}else try{let s=e(n[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&WI(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();Rx.importMethods(Vj,!0,1);var fhe=Rx;function xY(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function ghe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,I,y,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((I=h.stages)!=null&&I.length)||h.stages.includes(p))&&(!((y=h.levels)!=null&&y.length)||h.levels.includes(c))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||c<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===u)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function y2({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var h,f;let o=(g,v)=>{if(g){if(Array.isArray(v)){let I=v.find(y=>y.flight===g||y.f===g);return I.value||I.v}if(typeof v=="object"){let I=v.flights||v.f;if(Array.isArray(I))return I[g-1]}}},s=(g,v)=>{let I=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(rt(g)?g:0),y=xY(a,g==null?void 0:g.level);return{value:o(v,y)||rt(y)&&y||I}},l=0,c,u,d,p,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(y=>{var b;return y.drawSize===r||((b=y.drawSizes)==null?void 0:b.includes(r))}),v=i.find(y=>y.drawSize&&y.threshold&&r>y.drawSize),I=i.find(y=>{var b;return!y.drawSize&&!((b=y.drawSizes)!=null&&b.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],I=I==null?void 0:I[m]),u=s(g,e).value,d=s(v,e).value,p=s(I,e).value,l=u||d||p,c=u&&g.requireWin||d&&v.requireWin||(I==null?void 0:I.requireWin)}else if(typeof i=="object"){let g=(h=i==null?void 0:i.drawSizes)==null?void 0:h[r],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),u=s(g,e).value,p=s(v,e).value,l=u||p,c=u?g.requireWin:v==null?void 0:v.requireWin}else rt(i)&&m===void 0&&(l=i);return e&&((f=n==null?void 0:n.pct)!=null&&f[e])&&(l=Math.round(l*n.pct[e])),{awardPoints:l,requireWin:c}}function vhe({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var v;if(!i)return{error:fe};let{policyDefinitions:n}=Bu({policyTypes:[JU],tournamentRecord:i}),a=(e==null?void 0:e[JU])??(n==null?void 0:n[JU]);if(!a)return{error:oT};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=Gi({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),m=c==null?void 0:c.filter(I=>{var y;return(y=I.draws)==null?void 0:y.length}),h={},f={},g={};for(let I of m??[]){let{participantType:y,participantId:b,person:S,draws:w}=I;for(let U of w){let{drawId:T,structureParticipation:P,eventId:R}=U,D=u[R],E=d[T],N=E==null?void 0:E.drawType,{category:A,eventType:M}=D||{},C=U.startDate||D.startDate||i.startDate,O=U.endDate||D.endDate||i.endDate;if(M===to&&b!==Ja)continue;let k;if(o){let x=l,F=0,$=0,_=0,L;for(let B of P){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:H,rankingStage:W,winCount:Y}=B;F+=Y||0;let q=E==null?void 0:E.drawSize,{awardProfile:re}=ghe({awardProfiles:o,participation:B,eventType:M,startDate:C,category:A,drawSize:q,drawType:N,endDate:O,level:r});if(re){if(!q)continue;let K=Array.isArray(V)&&Math.max(...V),z=mt(V||[]).join("-"),te=K&&W!==We&&(V==null?void 0:V.includes(q));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(s=re.requireWinFirstRound);let{finishingPositionPoints:J={},finishingPositionRanges:ie,finishingRound:ne,pointsPerWin:ue,flights:ae}=re,ce=Array.isArray(re.perWinPoints)?(v=re.perWinPoints)==null?void 0:v.find(Pe=>{var at;return(at=Pe.participationOrders)==null?void 0:at.includes(G)}):re.perWinPoints,pe=J.participationOrders,Se=0,Be;if((!pe||pe.includes(G))&&ie&&K){let Pe=ie[K];Pe&&({awardPoints:Se,requireWin:Be}=y2({flightNumber:H,valueObj:Pe,drawSize:q,flights:ae,level:r}))}if(!Se&&ne&&G===1&&K){let Pe=ne[K];Pe&&({awardPoints:Se,requireWin:Be}=y2({participantWon:j,flightNumber:H,valueObj:Pe,drawSize:q,flights:ae,level:r}))}if(te&&s!==void 0&&(x=s),Be!==void 0&&(x=Be),Se>$&&(!x||Y)&&($=Se,L=K),!Se&&ue&&Y&&(_+=Y*ue,L=z),!Se&&Y&&ce){let Pe=xY(r,ce==null?void 0:ce.level);Pe?_+=Y*Pe:ce.value&&(_+=Y*ce.value)}}if(k=$+_,y===Ja){let K=(I.matchUps||[]).filter(({structureId:z})=>z===B.structureId);for(let{matchUpId:z}of K){let te=p[z],J=te.sides.find(ie=>ie.participantId===b).sideNumber;if(te.winningSice===J)for(let ie of te.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(h[V]||(h[V]=[]),h[V].push(B)):y===ot?(g[b]||(g[b]=[]),g[b].push(B)):y===Ja&&(f[b]||(f[b]=[]),f[b].push(B))}}}}return{participantsWithOutcomes:m,personPoints:h,pairPoints:g,teamPoints:f,...X}}var Ihe={getTournamentPoints:vhe},yhe=Ihe,bhe={calculateNewRatings:$q,generateDynamicRatings:Bq},whe=bhe,Uhe={...yhe,...whe};Rx.importMethods(Uhe);var FY={};gt(FY,{activeMatchUpStatuses:()=>lA,auditConstants:()=>Lde,completedMatchUpStatuses:()=>fr,directingMatchUpStatuses:()=>jH,displayConstants:()=>gde,drawDefinitionConstants:()=>AT,entryStatusConstants:()=>_ae,errorConditionConstants:()=>Vre,eventConstants:()=>gH,extensionConstants:()=>OH,flightConstants:()=>Zde,genderConstants:()=>qT,keyValueConstants:()=>Bue,matchUpActionConstants:()=>Zle,matchUpStatusConstants:()=>zH,matchUpTypes:()=>Cae,nonDirectingMatchUpStatuses:()=>GH,particicipantsRequiredMatchUpStatuses:()=>BH,participantConstants:()=>lz,participantRoles:()=>JA,participantTypes:()=>Jv,penaltyConstants:()=>Bhe,policyConstants:()=>nae,positionActionConstants:()=>nle,ratingConstants:()=>yle,recoveryTimeRequiredMatchUpStatuses:()=>gae,requestConstants:()=>Fpe,resourceContants:()=>Une,resultConstants:()=>Rre,scaleConstants:()=>Gne,scheduleConstants:()=>aoe,sortingConstants:()=>ipe,surfaceConstants:()=>Whe,tieFormatConstants:()=>Nce,timeItemConstants:()=>ioe,topicConstants:()=>Pae,tournamentConstants:()=>pY,upcomingMatchUpStatuses:()=>HH,validMatchUpStatuses:()=>VH,venueConstants:()=>Khe});var She="Coaching",The="Ball Abuse",Dhe="Racket Abuse",Phe="Verbal Abuse",Rhe="INELIGIBILITY",Ehe="Physical Abuse",Che="Unsportmanlike Conduct",Mhe="Dress Code Violation",Nhe="Equipment Violation",Ahe="Leaving the court",Ohe="Failure to complete",khe="No Show",xhe="Other",Fhe="REFUSAL_TO_PLAY",Lhe="PROHIBITED_SUBSTANCE",_he="Puncuality",$he="Failure to sign in",Bhe={COACHING:She,BALL_ABUSE:The,RACKET_ABUSE:Dhe,VERBAL_ABUSE:Phe,PHYSICAL_ABUSE:Ehe,INELIGIBILITY:Rhe,UNSPORTSMANLIKE_CONDUCT:Che,PROHIBITED_SUBSTANCE:Lhe,DRESS_CODE_VIOLATION:Mhe,EQUIMENT_VIOLATION:Nhe,LEAVING_THE_COURT:Ahe,REFUSAL_TO_PLAY:Fhe,FAILURE_TO_COMPLETE:Ohe,NO_SHOW:khe,OTHER:xhe,PUNCTUALITY:_he,FAILUIRE_TO_SIGN_IN:$he},Vhe="CLAY",jhe="HARD",Ghe="GRASS",Hhe="CARPET",zhe="ARTIFICIAL",Whe={CLAY:Vhe,HARD:jhe,GRASS:Ghe,CARPET:Hhe,ARTIFICIAL:zhe},qhe="INDOOR",Yhe="OUTDOOR",Khe={INDOOR:qhe,OUTDOOR:Yhe};const{AFTER_REST:Jhe,FOLLOWED_BY:Xhe,NEXT_AVAILABLE:Zhe,NOT_BEFORE:Qhe,TO_BE_ANNOUNCED:efe}=FY.timeItemConstants,d1="overlay",Oi="center",b2="header",Nm="right",qd="left",w2="top",p1="",FU="flex",As="none",tfe="buttonBar",U2="roundsColumns",ife=8,S2="roundsStats",T2="roundsTable",rfe={[Jhe]:"After rest",[Xhe]:"Followed by",[efe]:"TBA",[Zhe]:"Next available",[Qhe]:"NB"};function nu(t){return typeof t=="function"}function m1(t){return typeof t=="object"&&!Array.isArray(t)}const PE="font-medium";function sm(t){var I;const{target:e,button:i,stateChange:r}=t;let n=0;const a=()=>(n+=1,`Item${n}`),o=document.createElement("div");i.class&&o.classList.add(i.class),o.classList.add("dropdown"),i.id&&(o.id=i.id),i.align===Nm?(o.classList.add("is-right"),o.style.marginLeft="1em"):o.style.marginRight="1em";const s=y=>y.classList.contains("is-active"),l=()=>{s(o)&&o.classList.remove("is-active")},c=y=>{s(y)?y.classList.remove("is-active"):y.classList.add("is-active")};o.onmouseleave=l,o.onclick=()=>c(o);const u=document.createElement("div");u.classList.add("dropdown-trigger");const d=document.createElement("button");d.className="button font-medium",i.intent&&d.classList.add(i.intent),d.setAttribute("aria-haspopup","true");const p=document.createElement("span");nu(i.onClick)&&(p.onclick=i.onClick),p.style.marginRight="1em",p.innerHTML=i.label,d.appendChild(p);const m=document.createElement("span");nu(i.onClick)&&(m.onclick=i.onClick),m.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,d.appendChild(m),u.appendChild(d),o.appendChild(u);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.style.zIndex="99998";const f=document.createElement("div");f.classList.add("dropdown-content");const g=()=>{const y=h.querySelectorAll(".dropdown-item");for(const b of Array.from(y))b.classList.remove("is-active")},v=y=>{const b=document.createElement("a");b.className=PE;const S=y.disabled?"0.4":"1";return b.style.textDecoration="none",b.style.opacity=S,y.color&&(b.style.color=y.color),b.classList.add("dropdown-item"),y.isActive&&b.classList.add("is-active"),y.value&&b.setAttribute("value",y.value),y.class&&b.classList.add(y.class),b.onclick=w=>{if(y.disabled)return;y.value&&(d.value=y.value,o.setAttribute("value",y.value)),w.stopPropagation(),nu(y.onClick)&&(nu(r)&&r(),y.onClick(w)),y.close&&l();const U=s(b);g(),U?p.innerHTML=i.label:(i.selection&&c(b),i.modifyLabel&&y.modifyLabel!==!1&&(p.innerHTML=`${i.append?i.label+": ":""}${(y==null?void 0:y.label)||a()}`))},b.innerHTML=(y==null?void 0:y.label)||a(),b};for(const y of i.options||[])if(y.heading){const b=document.createElement("div");b.style.fontWeight="bold",b.classList.add("dropdown-item"),b.classList.add(PE),b.innerHTML=y.heading,f.appendChild(b)}else if(y.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(PE),f.appendChild(b)}else y.hide||f.appendChild(v(y));return(I=i.options)!=null&&I.length&&(i.options[0].value&&o.setAttribute("value",i.options[0].value),h.appendChild(f)),o.appendChild(h),e&&e.appendChild(o),o}function nfe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}class Fa{constructor(e){this.table=e}reloadData(e,i,r){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,r)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,r){return this.table.deprecationAdvisor.check(e,i,r)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Er{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,r){var n=e?i.split(e):[i],a=n.length,o;for(let s=0;s<a&&(r=r[n[s]],o=r,!!r);s++);return o}static deepClone(e,i,r=[]){var n={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,c;s!=null&&typeof s=="object"&&(s.__proto__===n||s.__proto__===a)&&(l=r.findIndex(u=>u.subject===s),l>-1?i[o]=r[l].copy:(c=Object.assign(Array.isArray(s)?[]:{},s),r.unshift({subject:s,copy:c}),i[o]=this.deepClone(s,c,r)))}return i}}let afe=class LY extends Fa{constructor(e,i,r){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=r,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),r=i?e.touches[0].pageX:e.pageX,n=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Er.elOffset(this.container);r-=a.left,n-=a.top}return{x:r,y:n}}elementPositionCoords(e,i="right"){var r=Er.elOffset(e),n,a,o;switch(this.container!==document.body&&(n=Er.elOffset(this.container),r.left-=n.left,r.top-=n.top),i){case"right":a=r.left+e.offsetWidth,o=r.top-1;break;case"bottom":a=r.left,o=r.top+e.offsetHeight;break;case"left":a=r.left,o=r.top-1;break;case"top":a=r.left,o=r.top;break;case"center":a=r.left+e.offsetWidth/2,o=r.top+e.offsetHeight/2;break}return{x:a,y:o,offset:r}}show(e,i){var r,n,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,r=s.x,n=s.y):typeof e=="number"?(o={top:0,left:0},r=e,n=i):(s=this.containerEventCoords(e),r=s.x,n=s.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=r+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(r,n,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,r,n,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",r?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),i+this.element.offsetHeight>Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0))if(r)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-r.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+r.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new LY(this.table,e,this),this.childPopup}};class oi extends Fa{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...r)=>(this.table.initGuard(e),i(...r)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,r){return this.table.componentFunctionBinder.bind(e,i,r)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,r;if(this._handler&&(r=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),r>-1&&(i=r)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new afe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var ofe={rownum:function(t,e,i,r,n,a){return a.getPosition()}};const uf=class uf extends oi{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,r[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=r)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":uf.accessors[e]?i=uf.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var r="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),n=e.getComponent(),a=Er.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,c,u;o.modules.accessor&&(l=o.modules.accessor[r]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(u=o.getComponent(),c=typeof l.params=="function"?l.params(s,a,i,u,n):l.params,o.setFieldValue(a,l.accessor(s,a,i,c,u,n)))))}),a}};$e(uf,"moduleName","accessor"),$e(uf,"accessors",ofe);let h1=uf;var sfe={method:"GET"};function f1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(f1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(f1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}function lfe(t){var e=f1(t),i=[];return e.forEach(function(r){i.push(encodeURIComponent(r.key)+"="+encodeURIComponent(r.value))}),i.join("&")}function _Y(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+lfe(i)),t}function ufe(t,e,i){var r;return new Promise((n,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(r=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],r){for(var o in r.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=r.headers[o]);e.body=r.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{n(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function g1(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((n,a)=>{i=i.concat(g1(n,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var r in t)i=i.concat(g1(t[r],e?e+"["+r+"]":r));else i.push({key:e,value:t});return i}var cfe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var r=g1(i),n=new FormData;return r.forEach(function(a){n.append(a.key,a.value)}),n}}};const fl=class fl extends oi{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=fl.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||fl.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||fl.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,r,n){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),n=Object.assign(Object.assign({},a),n)),n}requestDataCheck(e,i,r,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,r,n,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(r),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},fl.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,r){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,r,i).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,i,n)),n)):Promise.reject()}};$e(fl,"moduleName","ajax"),$e(fl,"defaultConfig",sfe),$e(fl,"defaultURLGenerator",_Y),$e(fl,"defaultLoaderPromise",ufe),$e(fl,"contentTypeFormatters",cfe);let v1=fl;var dfe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)}},pfe={table:function(t){var e=[],i=!0,r=this.table.columnManager.columns,n=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=r.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?n.push(s):i=!1}),i||(i=!0,n=[],e[0].forEach(function(o){var s=r.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?n.push(s):i=!1}),i||(n=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,c){n[c]&&(s[n[c].field]=l)}),a.push(s)}),a):!1}},mfe={copyToClipboard:["ctrl + 67","meta + 67"]},hfe={copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}},ffe={keybindings:{bindings:mfe,actions:hfe}};const yd=class yd extends oi{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,r,n;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),r=this.table.modules.export.generateHTMLTable(n),i=r?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),r=this.table.options.clipboardCopyFormatter("html",r))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),r&&e.clipboardData.setData("text/html",r)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),r&&e.originalEvent.clipboardData.setData("text/html",r)),this.dispatchExternal("clipboardCopied",i,r),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(r=>{var n=[];r.columns.forEach(a=>{var o="";if(a)if(r.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}n.push(o)}),i.push(n.join("	"))}),i.join(`
`)}copy(e,i){var r,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),r=window.getSelection(),r.toString()&&i&&(this.customSelection=r.toString()),r.removeAllRanges(),r.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),r&&r.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=yd.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=yd.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,r,n;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),r=this.pasteParser.call(this,i),r?(e.preventDefault(),this.table.modExists("mutator")&&(r=this.mutateData(r)),n=this.pasteAction.call(this,r),this.dispatchExternal("clipboardPasted",i,r,n)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(r=>{i.push(this.table.modules.mutator.transformRow(r,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,r=this.confirm("clipboard-paste",[e]);return(r||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}};$e(yd,"moduleName","clipboard"),$e(yd,"moduleExtensions",ffe),$e(yd,"pasteActions",dfe),$e(yd,"pasteParsers",pfe);let I1=yd;class gfe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class $Y{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,r)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class Vb extends Fa{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell"),this.column.isRowHeader&&this.element.classList.add("tabulator-row-header")}_configureCell(){var e=this.element,i=this.column.getField(),r={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=r[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,r){var n=this.setValueProcessData(e,i,r);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,r){var n=!1;return(this.value!==e||r)&&(n=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new $Y(this)),this.component}}class BY{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._column.table.componentFunctionBinder.handle("column",i._column,r)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.getParentComponent()}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var r=this._column.table.columnManager.findColumn(e);r?this._column.table.columnManager.moveColumn(this._column,r,i):console.warn("Move Error - No matching column found:",r)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var VY={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};const zp=class zp extends Fa{constructor(e,i,r){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.isGroup=!1,this.isRowHeader=r,this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,a)=>{var o=new zp(n,this);this.attachColumn(o)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.isRowHeader&&e.classList.add("tabulator-row-header"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(zp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{zp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(r=>{this.element.classList.add(r)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var r=document.createElement("input");r.classList.add("tabulator-title-editor"),r.addEventListener("click",n=>{n.stopPropagation(),r.focus()}),r.addEventListener("mousedown",n=>{n.stopPropagation()}),r.addEventListener("change",()=>{e.title=r.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(r),e.field?this.langBind("columns|"+e.field,n=>{r.value=n||e.title||"&nbsp;"}):r.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(i,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var r=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof r){case"object":r instanceof Node?e.appendChild(r):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",r));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=r}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,r=this.fieldStructure,n=r.length,a;for(let o=0;o<n&&(i=i[r[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var r=e,n=this.fieldStructure,a=n.length;for(let o=0;o<a;o++)if(o==a-1)r[n[o]]=i;else{if(!r[n[o]])if(typeof i<"u")r[n[o]]={};else break;r=r[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var r=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=r+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=r-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(r){i.push(r.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(r){r.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this),this.subscribedExternal("columnWidth")&&this.dispatchExternal("columnWidth",this.getComponent())}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var r=this.cells.length;for(let n=0;n<r;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new Vb(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var a=n.getWidth();a>i&&(i=a)}),i)){var r=i+1;this.maxInitialWidth&&!e&&(r=Math.min(r,this.maxInitialWidth)),this.setWidthActual(r)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(r=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>r.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new BY(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}getParentComponent(){return this.parent instanceof zp?this.parent.getComponent():!1}};$e(zp,"defaultOptionList",VY);let lm=zp;class iP{constructor(e){return this._row=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._row.table.componentFunctionBinder.handle("row",i._row,r)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Ga extends Fa{constructor(e,i,r="row"){super(i.table),this.parent=i,this.data={},this.type=r,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,r=0;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(r=this.calcMinHeight(),i=this.calcMaxHeight(),e?this.height=Math.max(i,r):this.height=this.manualHeight?this.height:Math.max(i,r)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}calcMinHeight(){return this.table.options.resizableRows?this.element.clientHeight:0}calcMaxHeight(){var e=0;return this.cells.forEach(function(i){var r=i.getHeight();r>e&&(e=r)}),e}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight,this.subscribedExternal("rowHeight")&&this.dispatchExternal("rowHeight",this.getComponent()))}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Er.elVisible(this.element),r={},n;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(r=Object.assign(r,this.data),r=Object.assign(r,e)),n=this.chain("row-data-changing",[this,r,e],null,e);for(let s in n)this.data[s]=n[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(n);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(r){return r.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var r=this.table.rowManager.findRow(e);r?(this.table.rowManager.moveRowActual(this,r,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new iP(this)),this.component}}var vfe={avg:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:2;return t.length&&(r=t.reduce(function(a,o){return Number(a)+Number(o)}),r=r/t.length,r=n!==!1?r.toFixed(n):r),parseFloat(r).toString()},max:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},min:function(t,e,i){var r=null,n=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<r||r===null)&&(r=a)}),r!==null?n!==!1?r.toFixed(n):r:""},sum:function(t,e,i){var r=0,n=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),r+=isNaN(a)?0:Number(a)}),n!==!1?r.toFixed(n):r},concat:function(t,e,i){var r=0;return t.length&&(r=t.reduce(function(n,a){return String(n)+String(a)})),r},count:function(t,e,i){var r=0;return t.length&&t.forEach(function(n){n&&r++}),r},unique:function(t,e,i){var r=t.filter((n,a)=>(t||n===0)&&t.indexOf(n)===a);return r.length}};const bd=class bd extends oi{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new lm({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,r={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":bd.calculations[i.topCalc]?r.topCalc=bd.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":r.topCalc=i.topCalc;break}r.topCalc&&(e.modules.columnCalcs=r,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":bd.calculations[i.bottomCalc]?r.botCalc=bd.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":r.botCalc=i.bottomCalc;break}r.botCalc&&(e.modules.columnCalcs=r,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,r;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),r=this.generateRow("top",i),this.topRow=r;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(r.getElement()),r.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),r=this.generateRow("bottom",i),this.botRow=r;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(r.getElement()),r.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,r;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),r=this.generateRowData("bottom",i),e.calcs.bottom.updateData(r),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),r=this.generateRowData("top",i),e.calcs.top.updateData(r),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[],r=this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs,n=this.table.modules.dataTree;return e.forEach(a=>{var o;i.push(a.getData()),r&&((o=a.modules.dataTree)!=null&&o.open)&&this.rowsToData(n.getFilteredTreeChildren(a)).forEach(s=>{i.push(a)})}),i}generateRow(e,i){var r=this.generateRowData(e,i),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new Ga(r,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new gfe(n)),n.component),n.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new Vb(this.genColumn,n);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),n.cells=a},n}generateRowData(e,i){var r={},n=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return n.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](c,i):l.modules.columnCalcs[s],l.setFieldValue(r,l.modules.columnCalcs[a](c,i,o)))}),r}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(r=>{e[r.getKey()]=this.getGroupResults(r)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),r=e.getSubGroups(),n={},a={};return r.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:n},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}};$e(bd,"moduleName","columnCalcs"),$e(bd,"calculations",vfe);let y1=bd;class jY extends oi{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(r,n){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(r,n){return i.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(r=>{this.reinitializeRowChildren(r)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,r){this.redrawNeeded(r)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],r=Array.isArray(i),n=r||!r&&typeof i=="object"&&i!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(r){r.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],r=i.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,r),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),r.insertBefore(n.branchEl,r.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?r.style.paddingRight=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":r.style.paddingLeft=parseInt(window.getComputedStyle(r,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,i){var r=e.modules.dataTree,n=r.controlEl;i=i||e.getCells()[0].getElement(),r.children!==!1&&(r.open?(r.controlEl=this.collapseEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(r.controlEl=this.expandEl.cloneNode(!0),r.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),r.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),n&&n.parentNode===i?n.parentNode.replaceChild(r.controlEl,n):i.insertBefore(r.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((r,n)=>{var a,o;i.push(r),r instanceof Ga&&(r.create(),a=r.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(r,!1,!0),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i,r){var n=e.modules.dataTree,a=[],o=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?a=this.table.modules.filter.filter(n.children):a=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(a,r),a.forEach(s=>{o.push(s);var l=this.getChildren(s,!1,!0);l.forEach(c=>{o.push(c)})})),o}generateChildren(e){var i=[],r=e.getData()[this.field];return Array.isArray(r)||(r=[r]),r.forEach(n=>{var a=new Ga(n||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var r=e.modules.dataTree;r.children!==!1&&(r.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,r=[],n;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,n.forEach(a=>{a instanceof Ga&&r.push(a)})),r}rowDelete(e){var i=e.modules.dataTree.parent,r;i&&(r=this.findChildIndex(e,i),r!==!1&&i.data[this.field].splice(r,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,r,n){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(a=this.findChildIndex(n,e),a!==!1&&e.data[this.field].splice(r?a:a+1,0,i)),a===!1&&(r?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var r=!1;return typeof e=="object"?e instanceof Ga?r=e.data:e instanceof iP?r=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(r=i.modules.dataTree.children.find(n=>n instanceof Ga?n.element===e:!1),r&&(r=r.data)):e===null&&(r=!1):typeof e>"u"?r=!1:r=i.data[this.field].find(n=>n.data[this.table.options.index]==e),r&&(Array.isArray(i.data[this.field])&&(r=i.data[this.field].indexOf(r)),r==-1&&(r=!1)),r}getTreeChildren(e,i,r){var n=e.modules.dataTree,a=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof Ga&&(a.push(i?o.getComponent():o),r&&this.getTreeChildren(o,i,r).forEach(s=>{a.push(s)}))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}$e(jY,"moduleName","dataTree");function Ife(t,e={},i){var r=e.delimiter?e.delimiter:",",n=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,c)=>{l&&l.depth===1&&(a[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),n.push(s.join(r));break}}),a.length&&n.unshift(a.join(r)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),i(n,"text/csv")}function yfe(t,e,i){var r=[];t.forEach(n=>{var a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(a);break}}),r=JSON.stringify(r,null,"	"),i(r,"application/json")}function bfe(t,e={},i){var r=[],n=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":r.push(u(p));break;case"group":n.push(u(p,o));break;case"calc":n.push(u(p,s));break;case"row":n.push(u(p));break}});function u(p,m){var h=[];return p.columns.forEach(f=>{var g;if(f){switch(typeof f.value){case"object":f.value=f.value!==null?JSON.stringify(f.value):"";break;case"undefined":f.value="";break}g={content:f.value,colSpan:f.width,rowSpan:f.height},m&&(g.styles=m),h.push(g)}}),h}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),c&&(a.didDrawPage=function(p){d.text(c,40,30)}),a.head=r,a.body=n,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function wfe(t,e,i){var r=this,n=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new Fa(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},c;l.type="binary",a.SheetNames=[],a.Sheets={};function u(){var m=[],h=[],f={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,I)=>v+(I&&I.width?I.width:1),0):0,r:t.length}};return t.forEach((v,I)=>{var y=[];v.columns.forEach(function(b,S){b?(y.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&h.push({s:{r:I,c:S},e:{r:I+b.height-1,c:S+b.width-1}})):y.push("")}),m.push(y)}),XLSX.utils.sheet_add_aoa(f,m),f["!ref"]=XLSX.utils.encode_range(g),h.length&&(f["!merges"]=h),f}if(e.sheetOnly){i(u());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=u()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:r.active,intercept:function(m){a.Sheets[d]=m}}));else a.SheetNames.push(n),a.Sheets[n]=u();e.documentProcessing&&(a=e.documentProcessing(a));function p(m){for(var h=new ArrayBuffer(m.length),f=new Uint8Array(h),g=0;g!=m.length;++g)f[g]=m.charCodeAt(g)&255;return h}c=XLSX.write(a,l),i(p(c),"application/octet-stream")}function Ufe(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function Sfe(t,e,i){const r=[];t.forEach(n=>{const a={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),r.push(JSON.stringify(a));break}}),i(r.join(`
`),"application/x-ndjson")}var Tfe={csv:Ife,json:yfe,jsonLines:Sfe,pdf:bfe,xlsx:wfe,html:Ufe};const cf=class cf extends oi{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,r){return new Blob([i],{type:r})}),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){}downloadToTab(e,i,r,n){this.download(e,i,r,n,!0)}download(e,i,r,n,a){var o=!1;function s(c,u){a?a===!0?this.triggerDownload(c,u,e,i,!0):a(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?o=e:cf.downloaders[e]?o=cf.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(n);o.call(this.table,l,r||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),r=this.table.options.groupHeaderDownload;return r&&!Array.isArray(r)&&(r=[r]),i.forEach(n=>{var a;n.type==="group"&&(a=n.columns[0],r&&r[n.indent]&&(a.value=r[n.indent](a.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),i}triggerDownload(e,i,r,n,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(n=n||"Tabulator."+(typeof r=="function"?"txt":r),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,n):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,r){switch(i){case"intercept":this.download(r.type,"",r.options,r.active,r.intercept);break}}};$e(cf,"moduleName","download"),$e(cf,"downloaders",Tfe);let b1=cf;function rP(t,e){var i=e.mask,r=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==r&&l!==n&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,c=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case r:if(c.toUpperCase()==c.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case n:if(isNaN(c))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(c!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function Dfe(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):r()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break;case 35:case 36:l.stopPropagation();break}}),n.mask&&rP(o,n),o}function Pfe(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+n.elementAttributes["+"+d])):l.setAttribute(d,n.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),n.selectContents&&l.select())});function u(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):r()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&n.shiftEnterSubmit&&u();break;case 27:r();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),n.mask&&rP(l,n),l}function Rfe(t,e,i,r,n){var a=t.getValue(),o=n.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof n.max<"u"&&s.setAttribute("max",n.max),typeof n.min<"u"&&s.setAttribute("min",n.min),typeof n.step<"u"&&s.setAttribute("step",n.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let u in n.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),s.setAttribute(u,s.getAttribute(u)+n.elementAttributes["+"+u])):s.setAttribute(u,n.elementAttributes[u]);s.value=a;var l=function(u){c()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),n.selectContents&&s.select())});function c(){var u=s.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==a?i(u)&&(a=u):r()}return s.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:r();break;case 38:case 40:o=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),n.mask&&rP(s,n),s}function Efe(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let l in n.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+n.elementAttributes["+"+l])):o.setAttribute(l,n.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):r()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:r();break}}),o}function Cfe(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var m;return s.isDateTime(p)?m=p:a==="iso"?m=s.fromISO(String(p)):m=s.fromFormat(String(p),a),m.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.max&&c.setAttribute("max",a?u(n.max):n.max),n.min&&c.setAttribute("min",a?u(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+n.elementAttributes["+"+p])):c.setAttribute(p,n.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function d(){var p=c.value,m;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(m=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(l=c.value)}else r()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function Mfe(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(s?(s.isDateTime(c)?l=c:a==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),a),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,m;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(m=s.fromFormat(String(p),"hh:mm"),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(c=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function Nfe(t,e,i,r,n){var a=n.format,o=n.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let p in n.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+n.elementAttributes["+"+p])):u.setAttribute(p,n.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(s?(s.isDateTime(c)?l=c:a==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),a),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",n.selectContents&&u.select())});function d(){var p=u.value,m;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(m=s.fromISO(String(p)),a){case!0:p=m;break;case"iso":p=m.toISO();break;default:p=m.toFormat(a)}i(p)&&(c=u.value)}else r()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:r();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}let Afe=class{constructor(e,i,r,n,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),r(this._onRendered.bind(this))}_deprecatedOptionsCheck(){}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(r){r.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let r in e)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,i.getAttribute(r)+e["+"+r])):i.setAttribute(r,e[r]);return this.params.mask&&rP(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],r;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",r=Object.keys(e).filter(n=>i.includes(n)).length,r?r>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var r=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));r&&this._focusItem(r),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],r=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(n=>this.listIteration===r?this._parseList(n):Promise.reject(r))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var r=this.params.filterRemote?{term:i}:{};return e=_Y(e,{},r),fetch(e).then(n=>n.ok?n.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var i={},r=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?r.forEach(a=>{var o=n.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([r,n])=>({label:n,value:r}))),e.forEach(r=>{typeof r!="object"&&(r={label:r,value:r}),this._parseListItem(r,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,r){var n={};e.options?n=this._parseListGroup(e,r+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:r,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),i.push(n)}_parseListGroup(e,i){var r={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,r.options,i)}),r}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((r,n)=>e(r.label,n.label,r.value,n.value,r.original,n.original)),i.forEach(r=>{r.group&&this._sortGroup(e,r.options)})}_defaultSortFunction(e,i){var r,n,a,o,s=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(r=String(e).toLowerCase(),n=String(i).toLowerCase(),r===n)return 0;if(!(u.test(r)&&u.test(n)))return r>n?1:-1;for(r=r.match(c),n=n.match(c),l=r.length>n.length?n.length:r.length;s<l;)if(a=r[s],o=n[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return r.length>n.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(r=>{this._filterItem(e,i,r)})):this.filtered=!1,this.data}_filterItem(e,i,r){var n=!1;return r.group?(r.options.forEach(a=>{this._filterItem(e,i,a)&&(n=!0)}),r.visible=n):r.visible=e(i,r.label,r.value,r.original),r.visible}_defaultFilterFunc(e,i,r,n){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(r).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,r;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,r=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,r instanceof HTMLElement?i.appendChild(r):i.innerHTML=r,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):i.setAttribute(n,e.elementAttributes[n]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var r;this.typing=!1,this.params.multiselect?(r=this.currentItems.indexOf(e),r>-1?(this.currentItems.splice(r,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,r;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(r=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,r===null||typeof r>"u"||r===""?i=r:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}};function Ofe(t,e,i,r,n){var a=new Afe(this,t,e,i,r,n);return a.input}function kfe(t,e,i,r,n){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,c=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function m(v){u.forEach(function(I,y){y<v?(a.table.browser=="ie"?I.setAttribute("class","tabulator-star-active"):I.classList.replace("tabulator-star-inactive","tabulator-star-active"),I.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?I.setAttribute("class","tabulator-star-inactive"):I.classList.replace("tabulator-star-active","tabulator-star-inactive"),I.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function h(v){var I=document.createElement("span"),y=p.cloneNode(!0);u.push(y),I.addEventListener("mouseenter",function(b){b.stopPropagation(),b.stopImmediatePropagation(),m(v)}),I.addEventListener("mousemove",function(b){b.stopPropagation(),b.stopImmediatePropagation()}),I.addEventListener("click",function(b){b.stopPropagation(),b.stopImmediatePropagation(),i(v),o.blur()}),I.appendChild(y),d.appendChild(I)}function f(v){s=v,m(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let v in n.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+n.elementAttributes["+"+v])):d.setAttribute(v,n.elementAttributes[v]);for(var g=1;g<=l;g++)h(g);return s=Math.min(parseInt(s),l),m(s),d.addEventListener("mousemove",function(v){m(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){r()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:f(s+1);break;case 37:f(s-1);break;case 13:i(s);break;case 27:r();break}}),d}function xfe(t,e,i,r,n){var a=t.getElement(),o=typeof n.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,s=typeof n.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,l=(o-s)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,m;function h(){var f=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(f.getPropertyValue("padding-left"))-parseInt(f.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),d.setAttribute(f,d.getAttribute(f)+n.elementAttributes["+"+f])):d.setAttribute(f,n.elementAttributes[f]);return a.style.padding="4px 4px",c=Math.min(parseFloat(c),o),c=Math.max(parseFloat(c),s),c=Math.round((c-s)/l),d.style.width=c+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(u),u.addEventListener("mousedown",function(f){p=f.screenX,m=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(f){p&&(d.style.width=m+f.screenX-p+"px")}),a.addEventListener("mouseup",function(f){p&&(f.stopPropagation(),f.stopImmediatePropagation(),p=!1,m=!1,h())}),a.addEventListener("keydown",function(f){switch(f.keyCode){case 39:f.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:f.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:h();break;case 27:r();break}}),a.addEventListener("blur",function(){r()}),d}function Ffe(t,e,i,r,n){var a=t.getValue(),o=document.createElement("input"),s=n.tristate,l=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,c=!1,u=Object.keys(n).includes("trueValue"),d=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),o.setAttribute(m,o.getAttribute(m)+n.elementAttributes["+"+m])):o.setAttribute(m,n.elementAttributes[m]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(c=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=u?a===n.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(m){var h=o.checked;return u&&h?h=n.trueValue:d&&!h&&(h=n.falseValue),s?m?c?l:h:o.checked&&!c?(o.checked=!1,o.indeterminate=!0,c=!0,l):(c=!1,h):h}return o.addEventListener("change",function(m){i(p())}),o.addEventListener("blur",function(m){i(p(!0))}),o.addEventListener("keydown",function(m){m.keyCode==13&&i(p()),m.keyCode==27&&r()}),o}var Lfe={input:Dfe,textarea:Pfe,number:Rfe,range:Efe,date:Cfe,time:Mfe,datetime:Nfe,list:Ofe,star:kfe,progress:xfe,tickCross:Ffe};const hI=class hI extends oi{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.convertEmptyValues=!1,this.editors=hI.editors,this.registerTableOption("editTriggerEvent","focus"),this.registerTableOption("editorEmptyValue"),this.registerTableOption("editorEmptyValueFunc",this.emptyValueCheck.bind(this)),this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("editorEmptyValue"),this.registerColumnOption("editorEmptyValueFunc"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0)),Object.keys(this.table.options).includes("editorEmptyValue")&&(this.convertEmptyValues=!0)}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,r=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||r&&(i.getElement().firstChild.blur(),this.invalidEdit||(r===!0?r=this.table.addRow({}):typeof r=="function"?r=this.table.addRow(r(i.row.getComponent())):r=this.table.addRow(Object.assign({},r)),r.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateLeft(),r)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(r=this.findPrevEditableCell(n,n.cells.length),r))return r.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var r,n;if(e){if(i&&i.preventDefault(),r=this.navigateRight(),r)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(r=this.findNextEditableCell(n,-1),r))return r.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findPrevEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.findNextEditableCell(e.row,r),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var r,n;return e&&(i&&i.preventDefault(),r=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[r].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var r=!1;if(i<e.cells.length-1)for(var n=i+1;n<e.cells.length;n++){let a=e.cells[n];if(a.column.modules.edit&&Er.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}findPrevEditableCell(e,i){var r=!1;if(i>0)for(var n=i-1;n>=0;n--){let a=e.cells[n];if(a.column.modules.edit&&Er.elVisible(a.getElement())&&this.allowEdit(a)){r=a;break}}return r}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i=Object.keys(e.definition).includes("editorEmptyValue"),r={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{},convertEmptyValues:i,editorEmptyValue:e.definition.editorEmptyValue,editorEmptyValueFunc:e.definition.editorEmptyValueFunc};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?r.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":r.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?r.editor=this.editors[e.definition.formatter]:r.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}r.editor&&(e.modules.edit=r)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,r;if(this.invalidEdit=!1,i){for(this.currentCell=!1,r=i.getElement(),this.dispatch("edit-editor-clear",i,e),r.classList.remove("tabulator-editing");r.firstChild;)r.removeChild(r.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,r=e.getElement(!0);this.updateCellClass(e),r.setAttribute("tabindex",0),r.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&r.addEventListener("dblclick",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&r.addEventListener("click",function(n){r.classList.contains("tabulator-editing")||(r.focus({preventScroll:!0}),i.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&r.addEventListener("focus",function(n){i.recursionBlock||i.edit(e,n,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,r=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<i?this.table.rowManager.element.scrollTop-=i-n.offsetTop:n.offsetTop+n.offsetHeight>r&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-r);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,r){var n=this,a=!0,o=function(){},s=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(n.currentCell===e&&!l){var I=n.chain("edit-success",[e,v],!0,!0);return I===!0||n.table.options.validationMode==="highlight"?(l=!0,n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),v=n.transformEmptyValues(v,e),e.setValue(v,!0),I===!0):(l=!0,n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function m(){n.currentCell===e&&!l&&n.cancelEdit()}function h(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||r){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(n,u,h,p,m,d),this.currentCell&&c!==!1)if(c instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(c),o();for(var f=s.children,g=0;g<f.length;g++)f[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}emptyValueCheck(e){return e===""||e===null||typeof e>"u"}transformEmptyValues(e,i){var r=i.column.modules.edit,n=r.convertEmptyValues||this.convertEmptyValues,a;return n&&(a=r.editorEmptyValueFunc||this.options("editorEmptyValueFunc"),a&&a(e)&&(e=r.convertEmptyValues?r.editorEmptyValue:this.options("editorEmptyValue"))),e}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}};$e(hI,"moduleName","edit"),$e(hI,"editors",Lfe);let w1=hI;class D2{constructor(e,i,r,n){this.type=e,this.columns=i,this.component=r||!1,this.indent=n||0}}class RE{constructor(e,i,r,n,a){this.value=e,this.component=i||!1,this.width=r,this.height=n,this.depth=a}}var _fe={},$fe={visible:function(){return this.rowManager.getVisibleRows(!1,!0)},all:function(){return this.rowManager.rows},selected:function(){return this.modules.selectRow.selectedRows},active:function(){return this.options.pagination?this.rowManager.getDisplayRows(this.rowManager.displayRows.length-2):this.rowManager.getDisplayRows()}};const wd=class wd extends oi{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.colVisPropAttach="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,r,n){var a,o,s,l;return this.cloneTableStyle=i,this.config=e||{},this.colVisProp=n,this.colVisPropAttach=this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1),l=wd.columnLookups[r],l&&(s=l.call(this.table),s=s.filter(c=>this.columnVisCheck(c))),a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],s&&(s=s.map(c=>c.getComponent())),o=this.bodyToExportRows(this.rowLookup(r),s),a.concat(o)}generateTable(e,i,r,n){var a=this.generateExportList(e,i,r,n);return this.generateTableElement(a)}rowLookup(e){var i=[],r;return typeof e=="function"?e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)}):(r=wd.rowLookups[e]||wd.rowLookups.active,i=r.call(this.table)),Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(r=>{var n=this.processColumnGroup(r);n&&i.push(n)}),i}processColumnGroup(e){var i=e.columns,r=0,n=e.definition["title"+this.colVisPropAttach]||e.definition.title,a={title:n,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>r&&(r=s.depth))}),a.depth+=r,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return this.config.rowHeaders===!1&&e.isRowHeader?!1:(typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i===!1||i===!0?i:e.visible&&e.field)}headersToExportRows(e){var i=[],r=0,n=[];function a(o,s){var l=r-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let c=1;c<o.height;c++)typeof i[s+c]>"u"&&(i[s+c]=[]),i[s+c].push(!1);if(o.width>1)for(let c=1;c<o.width;c++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(c){a(c,s+1)})}return e.forEach(function(o){o.depth>r&&(r=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;s.push(new RE(c,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),n.push(new D2("header",s))}),n}bodyToExportRows(e,i=[]){var r=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&i.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,a)=>{var o=n.getData(this.colVisProp),s=[],l=0;switch(n.type){case"group":l=n.level,s.push(new RE(n.key,n.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{s.push(new RE(c._column.getFieldValue(o),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=n.modules.dataTree.index);break}r.push(new D2(n.type,s,n.getComponent(),l))}),r}generateTableElement(e){var i=document.createElement("table"),r=document.createElement("thead"),n=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+this.colVisPropAttach],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+this.colVisPropAttach],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),r,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":r.appendChild(this.generateHeaderElement(l,s,a));break;case"group":n.appendChild(this.generateGroupElement(l,s,a));break;case"calc":n.appendChild(this.generateCalcElement(l,s,a));break;case"row":u=this.generateRowElement(l,s,a),this.mapElementStyles(c%2&&a.evenRow?a.evenRow:a.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(u);break}}),r.innerHTML&&i.appendChild(r),i.appendChild(n),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.styleRowHeader=e.firstRow.getElementsByClassName("tabulator-row-header")[0],e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,r){var n=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-left","border-right","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&a.component._column.parent.isGroup?this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]):this.mapElementStyles(a.component.getElement(),o,["border-top"]),a.component._column.isGroup?this.mapElementStyles(a.component.getElement(),o,["border-bottom"]):this.mapElementStyles(this.table.columnManager.getElement(),o,["border-bottom"]),n.appendChild(o)}}),n}generateGroupElement(e,i,r){var n=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(r.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(r.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(a),n}generateCalcElement(e,i,r){var n=this.generateRowElement(e,i,r);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(r.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,i,r){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=a.value,p,m,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return h},column:l},f=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(f.forEach(function(g){s.classList.add(g)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,m=["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"],l.isRowHeader?(p=r.styleRowHeader,m.push("background-color")):p=r.styleCells&&r.styleCells[u]?r.styleCells[u]:r.firstCell,p&&(this.mapElementStyles(p,s,m),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),n.appendChild(s),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return n},i.rowFormatter(e.component)}return n}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,r,n){var a=this.generateExportList(r||this.table.options.htmlOutputConfig,i,e,n||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,r){if(this.cloneTableStyle&&e&&i){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);r.forEach(function(o){i.style[n[o]]||(i.style[n[o]]=a.getPropertyValue(o))})}}}};$e(wd,"moduleName","export"),$e(wd,"columnLookups",_fe),$e(wd,"rowLookups",$fe);let U1=wd;var Bfe={"=":function(t,e,i,r){return e==t},"<":function(t,e,i,r){return e<t},"<=":function(t,e,i,r){return e<=t},">":function(t,e,i,r){return e>t},">=":function(t,e,i,r){return e>=t},"!=":function(t,e,i,r){return e!=t},regex:function(t,e,i,r){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,r){var n=t.toLowerCase().split(typeof r.separator>"u"?" ":r.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(s=>{a.includes(s)&&o.push(!0)}),r.matchAll?o.length===n.length:!!o.length},starts:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,r){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,r){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};const mc=class mc extends oi{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,r,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,r,n){this.setFilter(e,i,r,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,r,n){this.addFilter(e,i,r,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var r=this.table.columnManager.findColumn(e);if(r)this.setHeaderFilterValue(r,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,r){this.removeFilter(e,i,r),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,r){return this.search("rows",e,i,r)}searchData(e,i,r){return this.search("data",e,i,r)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var r=this,n=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete r.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":mc.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,mc.filters[e.definition.headerFilterFunc](o,m,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},m=e.getFieldValue(d);return p=typeof p=="function"?p(o,m,d):p,e.definition.headerFilterFunc(o,m,d,p)},l=u;break}if(!u)switch(s){case"partial":u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:u=function(d){return e.getFieldValue(d)==o},l="="}r.headerFilters[n]={value:o,func:u,type:l}}e.modules.filter.value=o,c=JSON.stringify(r.headerFilters),r.prevHeaderFilterChangeCheck!==c&&(r.prevHeaderFilterChangeCheck=c,r.trackChanges(),r.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,r){var n=this,a=e.modules.filter.success,o=e.getField(),s,l,c,u,d,p,m,h;e.modules.filter.value=i;function f(){}function g(v){h=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(l=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(l=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=n.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},m=e.definition.headerFilterParams||{},m=typeof m=="function"?m.call(n.table,u):m,c=l.call(this.table.modules.edit,u,g,a,f,m),!c){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",c);return}n.langBind("headerFilters|columns|"+e.definition.field,function(v){c.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),c.addEventListener("click",function(v){v.stopPropagation(),c.focus()}),c.addEventListener("focus",v=>{var I=this.table.columnManager.contentsElement.scrollLeft,y=this.table.rowManager.element.scrollLeft;I!==y&&(this.table.rowManager.scrollHorizontal(I),this.table.columnManager.scrollHorizontal(I))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(c.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(v){a(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(c),e.contentElement.appendChild(s),r||n.headerFilterColumns.push(e),h&&h()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,r,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),this.addFilter(e)}addFilter(e,i,r,n){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:r,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var r=!1;return typeof e.field=="function"?r=function(n){return e.field(n,e.type||{})}:mc.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?r=function(n){return mc.filters[e.type](e.value,i.getFieldValue(n),n,e.params||{})}:r=function(n){return mc.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=r,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(r=>{r=this.findFilter(r),r&&i.push(r)}),i.length?i:!1}getFilters(e,i){var r=[];return e&&(r=this.getHeaderFilters()),i&&r.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),r=r.concat(this.filtersToArray(this.filterList,i)),r}filtersToArray(e,i){var r=[];return e.forEach(n=>{var a;Array.isArray(n)?r.push(this.filtersToArray(n,i)):(a={field:n.field,type:n.type,value:n.value},i&&typeof a.type=="function"&&(a.type="function"),r.push(a))}),r}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,r){Array.isArray(e)||(e=[{field:e,type:i,value:r}]),e.forEach(n=>{var a=-1;typeof n.field=="object"?a=this.filterList.findIndex(o=>n===o):a=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,r,n){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:r,value:n}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(c=>{this.filterRecurse(c,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var r=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&r.push(a)}):r=e.slice(0),this.subscribedExternal("dataFiltered")&&(r.forEach(a=>{n.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),r}filterRow(e,i){var r=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(r=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(n)||(r=!1);return r}filterRecurse(e,i){var r=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,i)&&(r=!0)}):r=e.func(i),r}};$e(mc,"moduleName","filter"),$e(mc,"filters",Bfe);let S1=mc;function Vfe(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function jfe(t,e,i){return t.getValue()}function Gfe(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Hfe(t,e,i){var r=parseFloat(t.getValue()),n="",a,o,s,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",m=e.symbol||"",h=!!e.symbolAfter,f=typeof e.precision<"u"?e.precision:2;if(isNaN(r))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(r<0&&(r=Math.abs(r),n=p),a=f!==!1?r.toFixed(f):r,a=String(a).split("."),o=a[0],s=a.length>1?u+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return c=o+s,n===!0?(c="("+c+")",h?c+m:m+c):h?n+c+m:n+m+c}function zfe(t,e,i){var r=t.getValue(),n=e.urlPrefix||"",a=e.download,o=r,s=document.createElement("a"),l;function c(u,d){var p=u.shift(),m=d[p];return u.length&&typeof m=="object"?c(u,m):m}if(e.labelField&&(l=t.getData(),o=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),r=Er.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":r=e.url;break;case"function":r=e.url(t);break}return s.setAttribute("href",n+r),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function Wfe(t,e,i){var r=document.createElement("img"),n=t.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+t.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),r.setAttribute("src",n),typeof e.height){case"number":r.style.height=e.height+"px";break;case"string":r.style.height=e.height;break}switch(typeof e.width){case"number":r.style.width=e.width+"px";break;case"string":r.style.width=e.width;break}return r.addEventListener("load",function(){t.getRow().normalizeHeight()}),r}function qfe(t,e,i){var r=t.getValue(),n=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&r===e.trueValue||!s&&(o&&r||r===!0||r==="true"||r==="True"||r===1||r==="1")?(n.setAttribute("aria-checked",!0),l||""):a&&(r==="null"||r===""||r===null||typeof r>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),c||"")}function Yfe(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof r<"u"){var l;return r.isDateTime(s)?l=s:n==="iso"?l=r.fromISO(String(s)):l=r.fromFormat(String(s),n),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function Kfe(t,e,i){var r=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:r.now(),u=t.getValue();if(typeof r<"u"){var d;return r.isDateTime(u)?d=u:n==="iso"?d=r.fromISO(String(u)):d=r.fromFormat(String(u),n),d.isValid?l?d.diff(c,s).toHuman()+(o?" "+o:""):parseInt(d.diff(c,s)[s])+(o?" "+o:""):a===!0?u:typeof a=="function"?a(u):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function Jfe(t,e,i){var r=t.getValue();return typeof e[r]>"u"?(console.warn("Missing display value for "+r),r):e[r]}function Xfe(t,e,i){var r=t.getValue(),n=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",r=r&&!isNaN(r)?parseInt(r):0,r=Math.max(0,Math.min(r,a));for(var u=1;u<=a;u++){var d=s.cloneNode(!0);d.innerHTML=u<=r?l:c,o.appendChild(d)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",r),o}function Zfe(t,e,i){var r=this.sanitizeHTML(t.getValue())||0,n=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(r)||typeof t.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),u=parseFloat(r)<=a?parseFloat(r):a,u=parseFloat(u)>=o?parseFloat(u):o,c=(a-o)/100,u=Math.round((u-o)/c),typeof s){case"string":l=s;break;case"function":l=s(r);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(u/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return n.style.backgroundColor=l,n}}function Qfe(t,e={},i){var r=this.sanitizeHTML(t.getValue())||0,n=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(r)<=a?parseFloat(r):a,c=parseFloat(c)>=o?parseFloat(c):o,l=(a-o)/100,c=Math.round((c-o)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(r);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(c/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),u=e.color[v];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(r);break;case"boolean":d=r;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(r);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(c/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",c);var m=document.createElement("div");m.style.display="inline-block",m.style.width=c+"%",m.style.backgroundColor=u,m.style.height="100%",m.setAttribute("data-max",a),m.setAttribute("data-min",o);var h=document.createElement("div");if(h.style.position="relative",h.style.width="100%",h.style.height="100%",d){var f=document.createElement("div");f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.textAlign=s,f.style.width="100%",f.style.color=p,f.innerHTML=d}return i(function(){if(!(t instanceof $Y)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(h),h.appendChild(m),d&&h.appendChild(f)}),""}function ege(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function tge(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function ige(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function rge(t,e,i){var r=document.createElement("span"),n=t.getRow(),a=t.getTable();return n.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),r.innerText=o}),r}function nge(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}var age={plaintext:Vfe,html:jfe,textarea:Gfe,money:Hfe,link:zfe,image:Wfe,tickCross:qfe,datetime:Yfe,datetimediff:Kfe,lookup:Jfe,star:Xfe,traffic:Zfe,progress:Qfe,color:ege,buttonTick:tge,buttonCross:ige,rownum:rge,handle:nge};const Ms=class Ms extends oi{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var r={params:e.definition["formatter"+i+"Params"]||{}},n=e.definition["formatter"+i];switch(typeof n){case"string":Ms.formatters[n]?r.formatter=Ms.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),r.formatter=Ms.formatters.plaintext);break;case"function":r.formatter=n;break;default:r.formatter=Ms.formatters.plaintext;break}return r}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,r){var n,a,o,s;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return r},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,n.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),r=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function n(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,r,n)}formatExportValue(e,i){var r=e.column.modules.format[i],n;if(r){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof r.params=="function"?r.params(e.getComponent()):r.params,r.formatter.call(this,e.getComponent(),n,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(r){return i[r]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":Ms.formatters[e]?e=Ms.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=Ms.formatters.plaintext);break;case"function":break;default:e=Ms.formatters.plaintext;break}return e}};$e(Ms,"moduleName","format"),$e(Ms,"formatters",age);let T1=Ms;class GY extends oi{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],r=0,n=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));i.forEach(r=>{r.deinitialize()}),e.forEach(r=>{r.type==="row"&&this.layoutRow(r)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)}),this.rightColumns.forEach(i=>{var r=e.getCell(i);r&&this.layoutElement(r.getElement(!0),i)})}layoutElement(e,i){var r;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?r=i.modules.frozen.position==="left"?"right":"left":r=i.modules.frozen.position,e.style[r]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}getFrozenColumns(){return this.leftColumns.concat(this.rightColumns)}_calcSpace(e,i){var r=0;for(let n=0;n<i;n++)e[n].visible&&(r+=e[n].getWidth());return r}}$e(GY,"moduleName","frozenColumns");class HY extends oi{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,r=typeof i;r==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):r==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(r=>{i.push(r)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(r){var n=i.indexOf(r);n>-1&&i.splice(n,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var r=e.getElement();r.parentNode&&r.parentNode.removeChild(r),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,r)=>{this.table.rowManager.styleRow(i,r)})}}$e(HY,"moduleName","frozenRows");class oge{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,r)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class of{constructor(e,i,r,n,a,o,s){this.groupManager=e,this.parent=i,this.key=n,this.level=r,this.field=a,this.hasSubGroups=r<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[r]<"u"?e.startOpen[r]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var r=i+"_"+e,n=new of(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[r]:!1);this.groups[r]=n,this.groupList.push(n)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var r=this.groupManager.groupIDLookups[i].func(e.getData()),n=i+"_"+r;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(r,i),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,r){var n=this.conformRowData({});e.updateData(n);var a=this.rows.indexOf(i);a>-1?r?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):r?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),r=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(r.parentNode&&r.parentNode.removeChild(r),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var r=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{r.push(n.getData(i||"data"))}),r}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(r=>{r.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var r=i.getHeadersAndRows();r.forEach(n=>{var a=n.getElement();e.parentNode.insertBefore(a,e.nextSibling),n.initialize(),e=a})}):this.rows.forEach(i=>{var r=i.getElement();e.parentNode.insertBefore(r,e.nextSibling),i.initialize(),e=r}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(r){var n=r.getRowGroup(e);n&&(i=n)}):this.rows.find(function(r){return r===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getRows(e,i){var r=[];return i&&this.groupList.length?this.groupList.forEach(n=>{r=r.concat(n.getRows(e,i))}):this.rows.forEach(function(n){r.push(e?n.getComponent():n)}),r}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(r){e.push(r.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Er.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new oge(this)),this.component}}class zY extends oi{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,r=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(r)&&e.length>r.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,c)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(c){return l.getFieldValue(c)}:s=function(c){return c[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),r&&(this.headerGenerator=Array.isArray(r)?r:[r])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var r=this.getGroups(!1)[0];i.push(r.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(r=>r.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,r){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!i||i&&n.indexOf(i)==-1?r?n[0]!==e&&(i=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):n[n.length-1]!==e&&(i=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!r)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,r){if(this.table.options.groupBy){!r&&i instanceof of&&(i=this.table.rowManager.prevDisplayRow(e)||i);var n=i instanceof of?i:i.modules.group,a=e instanceof of?e:e.modules.group;n===a?this.table.rowManager.moveRowInArray(n.rows,e,i,r):(a&&a.removeRow(e),n.insertRow(e,i,r))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(r){i.push(e?r.getComponent():r)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(r=>{r.groupList.length?i=i.concat(this.getChildGroups(r)):i.push(r)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(r=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var a=[];r.hasSubGroups?(a=this.pullGroupListData(r.groupList),n.level=r.level,n.rowCount=a.length-r.groupList.length,n.headerContent=r.generator(r.key,n.rowCount,r.rows,r),i.push(n),i=i.concat(a)):(n.level=r.level,n.headerContent=r.generator(r.key,r.rows.length,r.rows,r),n.rowCount=r.getRows().length,i.push(n),r.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(r=>{var n=r.getRowGroup(e);n&&(i=n)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(r=>{this.createGroup(r,0,i)}),e.forEach(r=>{this.assignRowToExistingGroup(r,i)})):e.forEach(r=>{this.assignRowToGroup(r,i)}),Object.values(i).forEach(r=>{r.wipe(!0)})}createGroup(e,i,r){var n=i+"_"+e,a;r=r||[],a=new of(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],r[n]),this.groups[n]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n="0_"+r;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,i){var r=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+r];return n&&this.createGroup(r,0,i),this.groups["0_"+r].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,r=i.getPath(),n=this.getExpectedPath(e),a;a=r.length==n.length&&r.every((o,s)=>o===n[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],r=e.getData();return this.groupIDLookups.forEach(n=>{i.push(n.func(r))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(r=>{i=i.concat(r.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,r;this.groups[i]&&(delete this.groups[i],r=this.groupList.indexOf(e),r>-1&&this.groupList.splice(r,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((r,n)=>{this.table.rowManager.styleRow(r,n),e.appendChild(r.getElement()),r.initialize(!0),r.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}$e(zY,"moduleName","groupRows");var sge={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},lge={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},uge={undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"]},cge={undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))}},dge={keybindings:{bindings:uge,actions:cge}};const Ud=class Ud extends oi{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,r){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:r})}rowAdded(e,i,r,n){this.action("rowAdd",e,{data:i,pos:r,index:n})}rowDeleted(e){var i,r;this.table.options.groupBy?(r=e.getComponent().getGroup()._getSelf().rows,i=r.indexOf(e),i&&(i=r[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,r){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:r}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(r){return r.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return Ud.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return Ud.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(r){if(r.component instanceof Ga)r.component===e&&(r.component=i);else if(r.component instanceof Vb&&r.component.row===e){var n=r.component.column.getField();n&&(r.component=i.getCell(n))}})}};$e(Ud,"moduleName","history"),$e(Ud,"moduleExtensions",dge),$e(Ud,"undoers",sge),$e(Ud,"redoers",lge);let D1=Ud;class WY extends oi{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,r=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,i),r.length?this._extractHeaders(r,n):this._generateBlankHeaders(r,n);for(var o=0;o<n.length;o++){var s=n[o],l=s.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=o);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}a.push(c)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,r){var n=e.attributes,a=Object.keys(r||i),o={};a.forEach(u=>{o[u.toLowerCase()]=u});for(var s in n){var l=n[s],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof o[c]<"u"&&(i[o[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(r=>r.title===e);return i||!1}_extractHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a=!1,o=this._findCol(n.textContent),s;o?a=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),s=n.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[r]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var r=0;r<e.length;r++){var n=e[r],a={title:"",field:"col"+r};this.fieldIndex[r]=a.field;var o=n.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}$e(WY,"moduleName","htmlTableImport");function pge(t){var e=[],i=0,r=0,n=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][r]||(e[i][r]=""),o=='"'&&n&&s=='"'){e[i][r]+=o,a++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){r++;continue}if(o=="\r"&&s==`
`&&!n){r=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!n){r=0,i++;continue}e[i][r]+=o}return e}function mge(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function hge(t){return t}function fge(t,e){var i=XLSX.read(t),r=i.Sheets[i.SheetNames[0]];return XLSX.utils.sheet_to_json(r,{})}var gge={csv:pge,json:mge,array:hge,xlsx:fge};const fI=class fI extends oi{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,r,n,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=fI.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i,r){var n=this.lookupImporter(e);if(n)return this.pickFile(i,r).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(a=>(console.error("Import Error:",a||"Unable to import file"),Promise.reject(a)))}pickFile(e,i){return new Promise((r,n)=>{var a=document.createElement("input");a.type="file",a.accept=e,a.addEventListener("change",o=>{var s=a.files[0],l=new FileReader;switch(i||this.table.options.importReader){case"buffer":l.readAsArrayBuffer(s);break;case"binary":l.readAsBinaryString(s);break;case"url":l.readAsDataURL(s);break;case"text":default:l.readAsText(s)}l.onload=c=>{r(l.result)},l.onerror=c=>{console.warn("File Load Error - Unable to read file"),n()}}),a.click()})}importData(e,i){var r=e.call(this.table,i);return r instanceof Promise?r:r?Promise.resolve(r):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),r=e.map(n=>{var a={};return i.forEach((o,s)=>{a[o]=n[s]}),a});return r}structureArrayToColumns(e){var i=[],r=this.table.getColumns();return r[0]&&e[0][0]&&r[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var a={};n.forEach((o,s)=>{var l=r[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.table.setData(e)}};$e(fI,"moduleName","import"),$e(fI,"importers",gge);let P1=fI;class qY extends oi{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let r in i)i[r]=null})}cellContentsSelectionFixer(e,i){var r;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(r=document.body.createTextRange(),r.moveToElementText(i.getElement()),r.select()):window.getSelection&&(r=document.createRange(),r.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(r))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,r=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===r&&this.subscribers[n]&&(i=!1);i&&(this.unsubscribe(r+"-touchstart",this.touchSubscribers[r+"-touchstart"]),this.unsubscribe(r+"-touchend",this.touchSubscribers[r+"-touchend"]),delete this.touchSubscribers[r+"-touchstart"],delete this.touchSubscribers[r+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let r in this.eventMap)i[r]&&(this.subscriptionChanged(r,!0),this.columnSubscribers[r]||(this.columnSubscribers[r]=[]),this.columnSubscribers[r].push(e))}handle(e,i,r){this.dispatchEvent(e,i,r)}handleTouch(e,i,r,n){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",r,n)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",r,n)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",r,n)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,r){var n=r.getComponent(),a;this.columnSubscribers[e]&&(r instanceof Vb?a=r.column.definition[e]:r instanceof lm&&(a=r.definition[e]),a&&a(i,n)),this.dispatchExternal(e,i,n)}}$e(qY,"moduleName","interaction");var vge={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35},Ige={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,r=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=r?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)}};const Sd=class Sd extends oi{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,Sd.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)Sd.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(r=>{var n=Array.isArray(r)?r:[r];n.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var r={action:Sd.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=i.toString().toLowerCase().split(" ").join("").split("+");n.forEach(a=>{switch(a){case"ctrl":r.ctrl=!0;break;case"shift":r.shift=!0;break;case"meta":r.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),r.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(r)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];n&&(e.pressedKeys.push(r),n.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var r=i.keyCode,n=e.watchKeys[r];if(n){var a=e.pressedKeys.indexOf(r);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var r=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(n=>{var a=this.pressedKeys.indexOf(n);a==-1&&(r=!1)}),r&&i.action.call(this,e),!0):!1}};$e(Sd,"moduleName","keybindings"),$e(Sd,"bindings",vge),$e(Sd,"actions",Ige);let R1=Sd;class YY extends oi{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadMenuEvent(r.column.definition[e],i,r)}loadMenuTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadMenuEvent(r.definition[e],i,r)}loadMenuEvent(e,i,r){r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent()):e,this.loadMenu(i,r,e)}loadMenu(e,i,r,n,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!r||!r.length)){if(n)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}r.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",m=>{m.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",m=>{m.stopPropagation(),this.loadMenu(m,i,c.menu,u,l)}):c.action&&u.addEventListener("click",m=>{c.action(m,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),s.appendChild(u)}),s.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(n||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",r,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",r,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}$e(YY,"moduleName","menu");class KY extends oi{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,r={},n;!e.modules.frozen&&!e.isGroup&&!e.isRowHeader&&(n=e.getElement(),r.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Er.elOffset(n).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(n.parentNode.insertBefore(i.placeholderElement,n),i.moveColumn(e,!1)))}).bind(i),n.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=r}bindTouchEvents(e){var i=e.getElement(),r=!1,n,a,o,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,c=0,r=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),r||(r=u.touches[0].pageX),d=u.touches[0].pageX-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-c>s&&(p=a,p!==e&&(r=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(n=p.nextColumn(),l=o,o=n?n.getWidth()/2:0,a=p.prevColumn(),c=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var r=i.getElement(),n=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Er.elOffset(r).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var r=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,a){var o=n.getElement(!0);o.parentNode&&r[a]&&o.parentNode.insertBefore(r[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),r=i.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-Er.elOffset(i).left+r,a;this.hoverElement.style.left=n-this.startX+"px",n-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,r-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),r+i.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,r+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}$e(KY,"moduleName","moveColumn");var yge={delete:function(t,e,i){t.delete()}},bge={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};const Wp=class Wp extends oi{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,r={};r.mouseup=(function(n){i.tableRowDrop(n,e)}).bind(i),r.mousemove=(function(n){var a;n.pageY-Er.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=r}initializeRow(e){var i=this,r={},n;r.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),r.mousemove=(function(a){var o=e.getElement();a.pageY-Er.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),n.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=r}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,r=e.getElement(!0);r.addEventListener("mousedown",function(n){n.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(n,e.row)},i.checkPeriod))}),r.addEventListener("mouseup",function(n){n.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,r)}}bindTouchEvents(e,i){var r=!1,n,a,o,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,c=0,r=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),r||(r=u.touches[0].pageY),d=u.touches[0].pageY-r,d>0?n&&d-l>o&&(p=n,p!==e&&(r=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-c>s&&(p=a,p!==e&&(r=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(n=p.nextRow(),l=o,o=n?n.getHeight()/2:0,a=p.prevRow(),c=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var r=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(r.parentNode.insertBefore(this.placeholderElement,r),r.parentNode.removeChild(r)),this.hoverElement=r.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var r=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-r+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),r=i.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+r;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,r){this.dispatchExternal("movableRowsElementDrop",e,i,r?r.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(r=>{typeof r=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(r))):this.connectionElements.push(r)}),this.connectionElements.forEach(r=>{var n=a=>{this.elementRowDrop(a,r,this.moving)};r.addEventListener("mouseup",n),r.tabulatorElementDropEvent=n,r.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(r=>{r.type==="row"&&r.modules.moveRow&&r.modules.moveRow.mouseup&&r.getElement().addEventListener("mouseup",r.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,r){var n=!1;if(r){switch(typeof this.table.options.movableRowsSender){case"string":n=Wp.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var r=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":r=Wp.receivers[this.table.options.movableRowsReceiver];break;case"function":r=this.table.options.movableRowsReceiver;break}r?n=r.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:n})}commsReceived(e,i,r){switch(i){case"connect":return this.connect(e,r.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,r.row,r.success)}}};$e(Wp,"moduleName","moveRow"),$e(Wp,"senders",yge),$e(Wp,"receivers",bge);let E1=Wp;var wge={};const df=class df extends oi{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,r){return this.transformRow(i,"data",r)}initializeColumn(e){var i=!1,r={};this.allowedTypes.forEach(n=>{var a="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,r[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=r)}lookupMutator(e){var i=!1;switch(typeof e){case"string":df.mutators[e]?i=df.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,r){var n="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,c;o.modules.mutate&&(s=o.modules.mutate[n]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof r<"u"?r:e),(i=="data"&&!r||typeof a<"u")&&(c=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,c):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var r=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(r)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,i),r.mutator(i,n,"edit",r.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(r=>{var n=e.row.getCell(r);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}};$e(df,"moduleName","mutator"),$e(df,"mutators",wge);let C1=df;function Uge(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),r?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,r)+" ",c.innerHTML=" "+r+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(c),a.appendChild(u)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(u)),a}function Sge(t,e,i,r,n){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(c),a.appendChild(u),a}var Tge={rows:Uge,pages:Sge};const gI=class gI extends oi{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var r=this.table.rowManager,n=r.getDisplayRows(),a;return i?n.length?a=n[0]:r.activeRows.length&&(a=r.activeRows[r.activeRows.length-1],i=!1):n.length&&(a=n[n.length-1],i=!(n.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,r,n){return this.initialLoad||(this.progressiveLoad&&!r||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var r,n,a;!i&&!this.table.dataLoader.loading&&(r=this.table.rowManager.getElement(),n=r.scrollHeight-r.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||r.clientHeight*2,n<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var r=document.createElement("option");r.value=i,i===!0?this.langBind("pagination|all",function(n){r.innerHTML=n}):r.innerHTML=i,this.pageSizeSelect.appendChild(r)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=gI.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,r;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),i.innerHTML=n}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(r=document.querySelector(this.table.options.paginationCounterElement),r?r.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),r=i.indexOf(e);if(r>-1){var n=this.size===!0?1:Math.ceil((r+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,r){var n;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,r=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,i,r,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),r=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=r;a<=n;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",r=>{i.setAttribute("aria-label",r+" "+e),i.setAttribute("title",r+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",r=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,r,n,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){r=[],this.setMaxRows(e.length),this.size===!0?(n=0,a=e.length):(n=this.size*(this.page-1),a=n+parseInt(this.size)),this._setPageButtons();for(let l=n;l<a;l++){let c=e[l];c&&(r.push(c),c.type==="row"&&(o||(o=c),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),r}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};$e(gI,"moduleName","page"),$e(gI,"pageCounters",Tge);let M1=gI;var Dge={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,r=t+"-"+e,n=i.indexOf(r+"="),a,o;return n>-1&&(i=i.slice(n),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(r+"=","")),o?JSON.parse(o):!1}},Pge={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var r=new Date;r.setDate(r.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+r.toUTCString()}};const fo=class fo extends oi{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,r;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:fo.readers[this.table.options.persistenceReaderFunc]?this.readFunc=fo.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):fo.readers[this.mode]?this.readFunc=fo.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:fo.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=fo.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):fo.writers[this.mode]?this.writeFunc=fo.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(r=this.retrieveData("page"),r&&(typeof r.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=r.paginationSize),typeof r.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=r.paginationInitialPage))),this.config.group&&(r=this.retrieveData("group"),r&&(typeof r.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=r.groupBy),typeof r.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=r.groupStartOpen),typeof r.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=r.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,r;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(r=this.load("headerFilter"),r&&(this.table.options.initialHeaderFilter=r))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,r;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),r=this.config.columns===!0?Object.keys(i):this.config.columns,r.forEach(n=>{var a=Object.getOwnPropertyDescriptor(i,n),o=i[n];a&&Object.defineProperty(i,n,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var r=this.retrieveData(e);return i&&(r=r?this.mergeDefinition(i,r):i),r}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,r){var n=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(r?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof a[c]<"u"&&(s[c]=a[c])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),n.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(n.length>o?n.splice(o,0,a):n.push(a))}),n}_findColumn(e,i){var r=i.columns?"group":i.field?"field":"object";return e.find(function(n){switch(r){case"group":return n.title===i.title&&n.columns.length===i.columns.length;case"field":return n.field===i.field;case"object":return n===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],r=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var a={},o=n.getDefinition(),s;n.isGroup?(a.title=o.title,a.columns=this.parseColumns(n.getColumns())):(a.field=n.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=n.getWidth();break;case"visible":a.visible=n.visible;break;default:typeof o[l]!="function"&&r.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}};$e(fo,"moduleName","persistence"),$e(fo,"moduleInitOrder",-10),$e(fo,"readers",Dge),$e(fo,"writers",Pge);let N1=fo;class JY extends oi{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,r){this.loadPopupEvent(i,null,e,r)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,r;r=document.createElement("span"),r.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?r.appendChild(i):r.innerHTML=i):r.innerHTML="&vellip;",r.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(r,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,r){r._cell&&(r=r._cell),r.column.definition[e]&&this.loadPopupEvent(r.column.definition[e],i,r)}loadPopupTableColumnEvent(e,i,r){r._column&&(r=r._column),r.definition[e]&&this.loadPopupEvent(r.definition[e],i,r)}loadPopupEvent(e,i,r,n){var a;function o(s){a=s}r._group?r=r._group:r._row&&(r=r._row),e=typeof e=="function"?e.call(this.table,i,r.getComponent(),o):e,this.loadPopup(i,r,e,a,n)}loadPopup(e,i,r,n,a){var o=!(e instanceof MouseEvent),s,l;r instanceof HTMLElement?s=r:(s=document.createElement("div"),s.innerHTML=r),s.classList.add("tabulator-popup"),s.addEventListener("click",c=>{c.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof n=="function"&&l.renderCallback(n),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}}$e(JY,"moduleName","popup");class XY extends oi{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,r){var n=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof r<"u"?r:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(n,a),this.manualBlock=!1}}$e(XY,"moduleName","print");class ZY extends oi{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,r;this.currentVersion++,r=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-push"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a;return!i.blocked&&r===i.currentVersion&&(i.block("data-unshift"),n.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-shift"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[0]),n&&n.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,a;return!i.blocked&&r===i.currentVersion&&(i.block("data-pop"),i.data.length&&(n=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),n&&n.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),a=n[0]<0?e.length+n[0]:n[0],o=n[1],s=n[2]?n.slice(2):!1,l,c;if(!i.blocked&&r===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var u=e.slice(a,typeof n[1]>"u"?n[1]:a+o);u.forEach((d,p)=>{var m=i.table.rowManager.getRowFromDataObject(d);m&&m.deleteActual(p!==u.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var r in i)this.watchKey(e,i,r);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,r=e.getData()[this.table.options.dataTreeChildField],n={};r&&(n.push=r.push,Object.defineProperty(r,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=n.push.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),n.unshift=r.unshift,Object.defineProperty(r,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=n.unshift.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),n.shift=r.shift,Object.defineProperty(r,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=n.shift.call(r);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),n.pop=r.pop,Object.defineProperty(r,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=n.pop.call(r);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),n.splice=r.splice,Object.defineProperty(r,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=n.splice.apply(r,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,r){var n=this,a=Object.getOwnPropertyDescriptor(i,r),o=i[r],s=this.currentVersion;Object.defineProperty(i,r,{set:l=>{if(o=l,!n.blocked&&s===n.currentVersion){n.block("key");var c={};c[r]=l,e.updateData(c),n.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var r in i)Object.defineProperty(i,r,{value:i[r]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}$e(ZY,"moduleName","reactiveData");class QY extends oi{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1),this.registerTableOption("resizableColumnGuide",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(r=>{r.modules.resize&&r.modules.resize.handleEl&&(i&&(r.modules.resize.handleEl.style[e.modules.frozen.position]=i,r.modules.resize.handleEl.style["z-index"]=11),r.element.after(r.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,r,n){var a=this,o=!1,s=r.definition.resizable,l={},c=r.getLastColumn();if(e==="header"&&(o=r.definition.formatter=="textarea"||r.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=r,a.initialNextColumn=a.nextColumn=c.nextColumn(),a._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var m=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),m!==c.getWidth()&&(a.dispatch("column-resized",c),a.dispatchExternal("columnResized",c.getComponent()))}),r.modules.frozen&&(u.style.position="sticky",u.style[r.modules.frozen.position]=this.frozenColumnOffset(r)),l.handleEl=u,n.parentNode&&r.visible&&n.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}resize(e,i){var r=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n=r-this.startX,a=r-this.latestX,o,s;if(this.latestX=r,this.table.rtl&&(n=-n,a=-a),o=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(this.startWidth+n),s=i.width==i.minWidth||i.width==i.maxWidth,a<0&&(this.nextColumn=this.initialNextColumn),this.table.options.resizableColumnFit&&this.nextColumn&&!(o&&s)){let l=this.nextColumn.getWidth();a>0&&l<=this.nextColumn.minWidth&&(this.nextColumn=this.nextColumn.nextColumn()),this.nextColumn&&this.nextColumn.setWidth(this.nextColumn.getWidth()-a)}this.table.columnManager.rerenderColumns(!0),!this.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}calcGuidePosition(e,i,r){var n=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,a=r.getBoundingClientRect().x-this.table.element.getBoundingClientRect().x,o=this.table.element.getBoundingClientRect().x,s=i.element.getBoundingClientRect().left-o,l=n-this.startX,c=Math.max(a+l,s+i.minWidth);return i.maxWidth&&(c=Math.min(c,s+i.maxWidth)),c}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,r){var n=this,a;this.dispatchExternal("columnResizing",i.getComponent()),n.table.options.resizableColumnGuide&&(a=document.createElement("span"),a.classList.add("tabulator-col-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.left=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableColumnGuide?a.style.left=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableColumnGuide&&(n.resize(l,i),a.remove()),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",s),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==i.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",i),n.dispatchExternal("columnResized",i.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.clientX>"u"?e.touches[0].clientX:e.clientX,n.latestX=n.startX,n.startWidth=i.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}$e(QY,"moduleName","resizeColumns");class e7 extends oi{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1),this.registerTableOption("resizableRowGuide",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,r=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),r.appendChild(n),r.appendChild(a)}resize(e,i){i.setHeight(this.startHeight+((typeof e.screenY>"u"?e.touches[0].screenY:e.screenY)-this.startY))}calcGuidePosition(e,i,r){var n=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,a=r.getBoundingClientRect().y-this.table.element.getBoundingClientRect().y,o=this.table.element.getBoundingClientRect().y,s=i.element.getBoundingClientRect().top-o,l=n-this.startY;return Math.max(a+l,s)}_mouseDown(e,i,r){var n=this,a;n.dispatchExternal("rowResizing",i.getComponent()),n.table.options.resizableRowGuide&&(a=document.createElement("span"),a.classList.add("tabulator-row-resize-guide"),n.table.element.appendChild(a),setTimeout(()=>{a.style.top=n.calcGuidePosition(e,i,r)+"px"})),n.table.element.classList.add("tabulator-block-select");function o(l){n.table.options.resizableRowGuide?a.style.top=n.calcGuidePosition(l,i,r)+"px":n.resize(l,i)}function s(l){n.table.options.resizableRowGuide&&(n.resize(l,i),a.remove()),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),r.removeEventListener("touchmove",o),r.removeEventListener("touchend",s),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=i.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",s),r.addEventListener("touchmove",o,{passive:!0}),r.addEventListener("touchend",s)}}$e(e7,"moduleName","resizeRows");class t7 extends oi{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=a)&&(this.tableHeight=n,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(r=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(r[0].contentRect.height),a=Math.floor(r[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=a)&&(this.containerHeight=n,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}$e(t7,"moduleName","resizeTable");function Rge(t,e,i){var r=document.createElement("div"),n=t.getRow()._row.modules.responsiveLayout;r.classList.add("tabulator-responsive-collapse-toggle"),r.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=n.element;n.open=o,s&&(n.open?(r.classList.add("open"),s.style.display=""):(r.classList.remove("open"),s.style.display="none"))}return r.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!n.open),t.getTable().rowManager.adjustTableSize()}),a(n.open),r}var Ege={format:{formatters:{responsiveCollapse:Rge}}};class A1 extends oi{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.collapseFormatter&&(this.collapseFormatter=this.collapseFormatter.bind(this.table)),this.table.columnManager.columnsByIndex.forEach((i,r)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=r,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,r)=>{var n=r.modules.responsive.order-i.modules.responsive.order;return n||r.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),r=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(r<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&r>0&&r>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,r;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);r=this.collapseFormatter(this.generateCollapsedRowData(e)),r&&i.appendChild(r),e.calcHeight(!0)}}generateCollapsedRowData(e){var i=e.getData(),r=[],n;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},r.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,n,a.modules.format.params,s)})}else r.push({field:a.field,title:a.definition.title,value:o})}),r}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(r=>{var n=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.modules.localize.bind("columns|"+r.field,function(c){l.innerHTML=c||r.title}),r.value instanceof Node?(s=document.createElement("div"),s.appendChild(r.value),o.appendChild(s)):o.innerHTML=r.value,n.appendChild(a),n.appendChild(o),i.appendChild(n)}),Object.keys(e).length?i:""}}$e(A1,"moduleName","responsiveLayout"),$e(A1,"moduleExtensions",Ege);function Cge(t,e,i){var r=document.createElement("input"),n=!1;if(r.type="checkbox",r.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(r.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof iP?(r.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&r.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),r.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,r)):r=""}else r.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(r);return r}var Mge={format:{formatters:{rowSelection:Cge}}};class O1 extends oi{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,r){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,r=i.checkRowSelectability(e),n=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",r),n.classList.toggle("tabulator-unselectable",!r),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),n.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),n.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),n.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var r=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),a=r<=n?r:n,o=r>=n?r:n,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],r,n;switch(typeof e){case"undefined":r=this.table.rowManager.rows;break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{n=this._selectRow(a,!0,!0),n&&i.push(n)}),this._rowSelectionChanged(!1,i)):r&&this._selectRow(r,!1,!0)}_selectRow(e,i,r){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!r&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(i,n),n}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var r=[],n,a;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&r.push(a)}),this._rowSelectionChanged(i,[],r)):n&&this._deselectRow(n,i,!0)}_deselectRow(e,i){var r=this,n=r.table.rowManager.findRow(e),a,o;if(n){if(a=r.selectedRows.findIndex(function(s){return s==n}),a>-1)return o=n.getElement(),o&&o.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),r.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),r._rowSelectionChanged(i,void 0,n),n}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],r=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),Array.isArray(r)||(r=[r]),r=r.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,r))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var r=this.table.modules.dataTree.getChildren(e,!0,!0);if(i)for(let n of r)this._selectRow(n,!0);else for(let n of r)this._deselectRow(n,!0)}}$e(O1,"moduleName","selectRow"),$e(O1,"moduleExtensions",Mge);class Nge{constructor(e){return this._range=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._range.table.componentFunctionBinder.handle("range",i._range,r)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class Age extends Fa{constructor(e,i,r,n){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(r,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,r){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(r)}setStartBound(e){var i,r;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,r=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,r))}setEndBound(e){var i=this._getTableRows().length,r,n,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(r=e.row.position-1,n=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(r,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(r,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,n):this.setEnd(r,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,r=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,a,o,s,l,c,u,d,p,m,h;this.table.options.renderHorizontal==="virtual"&&this.rangeManager.rowHeader&&(n+=1),e==null&&(e=0),i==null&&(i=1/0),r==null&&(r=0),n==null&&(n=1/0),this.overlaps(r,e,n,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,r),l=Math.min(this.right,n),c=this.rangeManager.getCell(a,s),u=this.rangeManager.getCell(o,l),d=c.getElement(),p=u.getElement(),m=c.row.getElement(),h=u.row.getElement(),this.element.classList.add("tabulator-range-active"),this.table.rtl?(this.element.style.right=m.offsetWidth-d.offsetLeft-d.offsetWidth+"px",this.element.style.width=d.offsetLeft+d.offsetWidth-p.offsetLeft+"px"):(this.element.style.left=m.offsetLeft+d.offsetLeft+"px",this.element.style.width=p.offsetLeft+p.offsetWidth-d.offsetLeft+"px"),this.element.style.top=m.offsetTop+"px",this.element.style.height=h.offsetTop+h.offsetHeight-m.offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,r,n){return!(this.left>r||e>this.right||this.top>n||i>this.bottom)}getData(){var e=[],i=this.getRows(),r=this.getColumns();return i.forEach(n=>{var a=n.getData(),o={};r.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var r=[],n=this.getRows(),a=this.getColumns();return e?r=n.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):n.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&r.push(i?s.getComponent():s)})}),r}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(r=>{r.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),r={start:null,end:null};return i.length?(r.start=i[0],r.end=i[i.length-1]):console.warn("No bounds defined on range"),r}getComponent(){return this.component||(this.component=new Nge(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}var Oge={rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},kge={rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)}},xge={range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,r=!1,n,a,o,s,l;return l=t.length,i&&(n=i.getBounds(),a=n.start,n.start===n.end&&(r=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),r?s=t.length:s=e.indexOf(n.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},Fge={range:function(t){var e=[],i=[],r=this.table.modules.selectRange.activeRange,n=!1,a,o,s,l,c;return r&&(a=r.getBounds(),o=a.start,a.start===a.end&&(n=!0),o&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(o.column),c>-1)))?(n?s=e[0].length:s=l.indexOf(a.end.column)-c+1,l=l.slice(c,c+s),e.forEach(u=>{var d={},p=u.length;l.forEach(function(m,h){d[m.field]=u[h%p]}),i.push(d)}),i):!1}},Lge={range:function(){var t=this.modules.selectRange.selectedColumns();return this.columnManager.rowHeader&&t.unshift(this.columnManager.rowHeader),t}},_ge={range:function(){return this.modules.selectRange.selectedRows()}},$ge={keybindings:{bindings:Oge,actions:kge},clipboard:{pasteActions:xge,pasteParsers:Fge},export:{columnLookups:Lge,rowLookups:_ge}};class lS extends oi{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()),this.options("columns").findIndex(e=>e.frozen)>0&&console.warn("Having frozen column in arbitrary position with selectRange option may result in unpredictable behavior."),this.options("columns").filter(e=>e.frozen)>1&&console.warn("Having multiple frozen columns with selectRange option may result in unpredictable behavior."))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){var e;this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior"))),this.table.modules.frozenColumns&&this.table.modules.frozenColumns.active&&(e=this.table.modules.frozenColumns.getFrozenColumns(),(e.length>1||e.length===1&&e[0]!==this.rowHeader)&&console.warn("Using frozen columns that are not the range header in combination with the selectRange option may result in unpredictable behavior"))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(r=>r.occupiesRow(e.row)):i=this.ranges.filter(r=>r.occupies(e)),i.map(r=>r.getComponent())}rowGetRanges(e){var i=this.ranges.filter(r=>r.occupiesRow(e));return i.map(r=>r.getComponent())}colGetRanges(e){var i=this.ranges.filter(r=>r.occupiesColumn(e));return i.map(r=>r.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(r=>r.occupiesColumn(e)),i&&this.ranges.forEach(r=>{var n=r.getColumns(!0);n.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),r=this.ranges.findIndex(n=>n.occupies(e));i.classList.toggle("tabulator-range-selected",r!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=r}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e)&&i.preventDefault()}keyNavigateRange(e,i,r,n){this.navigate(r,n,i)&&e.preventDefault()}navigate(e,i,r){var n=!1,a,o,s,l,c,u;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(r){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(r==="left"||r==="right")||this.selecting==="column"&&(r==="up"||r==="down")))return;switch(r){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(n=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),n)return c=this.getRowByRangePos(a.end.row),u=this.getColumnByRangePos(a.end.col),(r==="left"||r==="right")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):(r==="up"||r==="down")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):this.autoScroll(a,c.getElement(),u.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpCell(e,i,r,n){var a;i&&(e=e.reverse());for(let o of e){let s=o.getValue();if(r){if(a=o,s)break}else if(n){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var r=this.getRowByRangePos(e),n=r.cells.filter(u=>u.column.visible),a=!n[i].getValue(),o=n[i]?!n[i].getValue():!1,s=i,l=this.rowHeader?n.slice(1,i):n.slice(0,i),c=this.findJumpCell(l,!0,a,o);return c&&(s=c.column.getPosition()-1),s}findJumpCellRight(e,i){var r=this.getRowByRangePos(e),n=r.cells.filter(c=>c.column.visible),a=!n[i].getValue(),o=n[i+1]?!n[i+1].getValue():!1,s=i,l=this.findJumpCell(n.slice(i+1,n.length),!1,a,o);return l&&(s=l.column.getPosition()-1),s}findJumpCellUp(e,i){var r=this.getColumnByRangePos(i),n=r.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),a=!n[e].getValue(),o=n[e-1]?!n[e-1].getValue():!1,s=e,l=this.findJumpCell(n.slice(0,s),!0,a,o);return l&&(s=l.row.position-1),s}findJumpCellDown(e,i){var r=this.getColumnByRangePos(i),n=r.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),a=!n[e].getValue(),o=n[e+1]?!n[e+1].getValue():!1,s=e,l=this.findJumpCell(n.slice(s+1,n.length),!1,a,o);return l&&(s=l.row.position-1),s}newSelection(e,i){var r;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){r=this.resetRanges(),this.selecting="all";var n,a=this.getCell(-1,-1);this.rowHeader?n=this.getCell(0,1):n=this.getCell(0,0),r.setBounds(n,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,r){var n=this.table.rowManager.element,a,o,s,l,c;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof r>"u"&&(r=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:r.offsetLeft,right:r.offsetLeft+r.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:n.scrollLeft,right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,c=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(n.scrollLeft=o.left,a&&(n.scrollLeft-=a.offsetWidth)):o.right>s.right&&(n.scrollLeft=o.right-n.clientWidth)),c||(o.top<s.top?n.scrollTop=o.top:o.bottom>s.bottom&&(n.scrollTop=o.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(r=>{r.type==="row"&&(this.layoutRow(r),r.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(r=>{this.layoutColumn(r)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var i=e.getElement(),r=!1,n=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?r=n:this.selecting==="all"&&(r=!0),i.classList.toggle("tabulator-range-selected",r),i.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e,i,r;this.table.initialized&&(e=this.getActiveCell(),e&&(i=e.getElement(),r=e.row.getElement(),this.table.rtl?this.activeRangeCellElement.style.right=r.offsetWidth-i.offsetLeft-i.offsetWidth+"px":this.activeRangeCellElement.style.left=r.offsetLeft+i.offsetLeft+"px",this.activeRangeCellElement.style.top=r.offsetTop+"px",this.activeRangeCellElement.style.width=i.offsetWidth+"px",this.activeRangeCellElement.style.height=r.offsetHeight+"px",this.ranges.forEach(n=>n.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var r;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),r=this.table.rowManager.getRowFromPosition(e+1),r?r.getCells(!1,!0).filter(n=>n.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows().filter(e=>e.type==="row")}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var r;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),r=new Age(this.table,this,e,i),this.activeRange=r,this.ranges.push(r),this.rangeContainer.appendChild(r.element),r}resetRanges(){var e,i,r;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(r=this.table.rowManager.activeRows[0].cells.filter(n=>n.column.visible),i=r[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}}$e(lS,"moduleName","selectRange"),$e(lS,"moduleInitOrder",1),$e(lS,"moduleExtensions",$ge);function Bge(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,c=o.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(u*=-1),u}function Vge(t,e,i,r,n,a,o){var s=o.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(c=this.langLocale());break;case"string":c=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function Ex(t,e,i,r,n,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",c=o.alignEmptyValues,u=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&a==="desc"||c==="bottom"&&a==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function jge(t,e,i,r,n,a,o){return o.format||(o.format="dd/MM/yyyy"),Ex.call(this,t,e,i,r,n,a,o)}function Gge(t,e,i,r,n,a,o){return o.format||(o.format="HH:mm"),Ex.call(this,t,e,i,r,n,a,o)}function Hge(t,e,i,r,n,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function zge(t,e,i,r,n,a,o){var s=o.type||"length",l=o.alignEmptyValues,c=0;function u(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(m,h){return m+h});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(m,h){return m+h})/d.length;break}return p}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return u(e)-u(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(c*=-1),c}function Wge(t,e,i,r,n,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function qge(t,e,i,r,n,a,o){var s,l,c,u,d=0,p,m=/(\d+)|(\D+)/g,h=/\d/,f=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(h.test(s)&&h.test(l)))return s>l?1:-1;for(s=s.match(m),l=l.match(m),p=s.length>l.length?l.length:s.length;d<p;)if(c=s[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return s.length>l.length}return(f==="top"&&a==="desc"||f==="bottom"&&a==="asc")&&(g*=-1),g}var Yge={number:Bge,string:Vge,date:jge,time:Gge,datetime:Ex,boolean:Hge,array:zge,exists:Wge,alphanum:qge};const qp=class qp extends oi{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,r,n){var a=this.getSort();return a.forEach(o=>{delete o.column}),n.sort=a,n}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,r,n;switch(typeof e.definition.sorter){case"string":qp.sorters[e.definition.sorter]?i=qp.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(r=e.getElement(),r.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":r.classList.add("tabulator-col-sorter-element");break;default:r.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:r).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(c=>c.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(r){r.column&&i.push({column:r.column.getComponent(),field:r.column.getField(),dir:r.dir})}),i}setSort(e,i){var r=this,n=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=r.table.columnManager.findColumn(a.column),o?(a.column=o,n.push(a),r.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),r.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],r="string",n,a;if(i&&(i=i.getData(),n=e.getField(),n))switch(a=e.getFieldValue(i),typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(r="alphanum");break}return qp.sorters[r]}sort(e,i){var r=this,n=this.table.options.sortOrderReverse?r.sortList.slice().reverse():r.sortList,a=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",r.getSort()),i||r.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(s,l){var c;s.column&&(c=s.column.modules.sort,c&&(c.sorter||(c.sorter=r.findSorter(s.column)),s.params=typeof c.params=="function"?c.params(s.column.getComponent(),s.dir):c.params,a.push(s)),i||r.setColumnHeader(s.column,s.dir))}),a.length&&r._sortItems(e,a)):i||n.forEach(function(s,l){r.setColumnHeader(s.column,s.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(s=>{o.push(s.getComponent())}),this.dispatchExternal("dataSorted",r.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var r=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;r.firstChild;)r.removeChild(r.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof n=="object"?r.appendChild(n):r.innerHTML=n}}_sortItems(e,i){var r=i.length-1;e.sort((n,a)=>{for(var o,s=r;s>=0;s--){let l=i[s];if(o=this._sortRow(n,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,r,n,a){var o,s,l=n=="asc"?e:i,c=n=="asc"?i:e;return e=r.getFieldValue(l.getData()),i=r.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=c.getComponent(),r.modules.sort.sorter.call(this,e,i,o,s,r.getComponent(),n,a)}};$e(qp,"moduleName","sort"),$e(qp,"sorters",Yge);let k1=qp;class Kge{constructor(e,i){this.columnCount=e,this.rowCount=i,this.columnString=[],this.columns=[],this.rows=[]}genColumns(e){var i=Math.max(this.columnCount,Math.max(...e.map(r=>r.length)));this.columnString=[],this.columns=[];for(let r=1;r<=i;r++)this.incrementChar(this.columnString.length-1),this.columns.push(this.columnString.join(""));return this.columns}genRows(e){var i=Math.max(this.rowCount,e.length);this.rows=[];for(let r=1;r<=i;r++)this.rows.push(r);return this.rows}incrementChar(e){let i=this.columnString[e];i?i!=="Z"?this.columnString[e]=String.fromCharCode(this.columnString[e].charCodeAt(0)+1):(this.columnString[e]="A",e?this.incrementChar(e-1):this.columnString.push("A")):this.columnString.push("A")}setRowCount(e){this.rowCount=e}setColumnCount(e){this.columnCount=e}}class i7{constructor(e){return this._sheet=e,new Proxy(this,{get:function(i,r,n){return typeof i[r]<"u"?i[r]:i._sheet.table.componentFunctionBinder.handle("sheet",i._sheet,r)}})}getTitle(){return this._sheet.title}getKey(){return this._sheet.key}getDefinition(){return this._sheet.getDefinition()}getData(){return this._sheet.getData()}setData(e){return this._sheet.setData(e)}clear(){return this._sheet.clear()}remove(){return this._sheet.remove()}active(){return this._sheet.active()}setTitle(e){return this._sheet.setTitle(e)}setRows(e){return this._sheet.setRows(e)}setColumns(e){return this._sheet.setColumns(e)}}class P2 extends Fa{constructor(e,i){super(e.table),this.spreadsheetManager=e,this.definition=i,this.title=this.definition.title||"",this.key=this.definition.key||this.definition.title,this.rowCount=this.definition.rows,this.columnCount=this.definition.columns,this.data=this.definition.data||[],this.element=null,this.isActive=!1,this.grid=new Kge(this.columnCount,this.rowCount),this.defaultColumnDefinition={width:100,headerHozAlign:"center",headerSort:!1},this.columnDefinition=Object.assign(this.defaultColumnDefinition,this.options("spreadsheetColumnDefinition")),this.columnDefs=[],this.rowDefs=[],this.columnFields=[],this.columns=[],this.rows=[],this.scrollTop=null,this.scrollLeft=null,this.initialize(),this.dispatchExternal("sheetAdded",this.getComponent())}initialize(){this.initializeElement(),this.initializeColumns(),this.initializeRows()}reinitialize(){this.initializeColumns(),this.initializeRows()}initializeElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tab"),this.element.innerText=this.title,this.element.addEventListener("click",()=>{this.spreadsheetManager.loadSheet(this)})}initializeColumns(){this.grid.setColumnCount(this.columnCount),this.columnFields=this.grid.genColumns(this.data),this.columnDefs=[],this.columnFields.forEach(e=>{var i=Object.assign({},this.columnDefinition);i.field=e,i.title=e,this.columnDefs.push(i)})}initializeRows(){var e;this.grid.setRowCount(this.rowCount),e=this.grid.genRows(this.data),this.rowDefs=[],e.forEach((i,r)=>{var n={_id:i},a=this.data[r];a&&a.forEach((o,s)=>{var l=this.columnFields[s];l&&(n[l]=o)}),this.rowDefs.push(n)})}unload(){this.isActive=!1,this.scrollTop=this.table.rowManager.scrollTop,this.scrollLeft=this.table.rowManager.scrollLeft,this.data=this.getData(!0),this.element.classList.remove("tabulator-spreadsheet-tab-active")}load(){var e=!this.isActive;this.isActive=!0,this.table.blockRedraw(),this.table.setData([]),this.table.setColumns(this.columnDefs),this.table.setData(this.rowDefs),this.table.restoreRedraw(),e&&this.scrollTop!==null&&(this.table.rowManager.element.scrollLeft=this.scrollLeft,this.table.rowManager.element.scrollTop=this.scrollTop),this.element.classList.add("tabulator-spreadsheet-tab-active"),this.dispatchExternal("sheetLoaded",this.getComponent())}getComponent(){return new i7(this)}getDefinition(){return{title:this.title,key:this.key,rows:this.rowCount,columns:this.columnCount,data:this.getData()}}getData(e){var i=[],r,n,a;return this.rowDefs.forEach(o=>{var s=[];this.columnFields.forEach(l=>{s.push(o[l])}),i.push(s)}),!e&&!this.options("spreadsheetOutputFull")&&(r=i.map(o=>o.findLastIndex(s=>typeof s<"u")+1),n=Math.max(...r),a=r.findLastIndex(o=>o>0)+1,i=i.slice(0,a),i=i.map(o=>o.slice(0,n))),i}setData(e){this.data=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}clear(){this.setData([])}setTitle(e){this.title=e,this.element.innerText=e,this.dispatchExternal("sheetUpdated",this.getComponent())}setRows(e){this.rowCount=e,this.initializeRows(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}setColumns(e){this.columnCount=e,this.reinitialize(),this.dispatchExternal("sheetUpdated",this.getComponent()),this.isActive&&this.load()}remove(){this.spreadsheetManager.removeSheet(this)}destroy(){this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.dispatchExternal("sheetRemoved",this.getComponent())}active(){this.spreadsheetManager.loadSheet(this)}}class r7 extends oi{constructor(e){super(e),this.sheets=[],this.element=null,this.registerTableOption("spreadsheet",!1),this.registerTableOption("spreadsheetRows",50),this.registerTableOption("spreadsheetColumns",50),this.registerTableOption("spreadsheetColumnDefinition",{}),this.registerTableOption("spreadsheetOutputFull",!1),this.registerTableOption("spreadsheetData",!1),this.registerTableOption("spreadsheetSheets",!1),this.registerTableOption("spreadsheetSheetTabs",!1),this.registerTableOption("spreadsheetSheetTabsElement",!1),this.registerTableFunction("setSheets",this.setSheets.bind(this)),this.registerTableFunction("addSheet",this.addSheet.bind(this)),this.registerTableFunction("getSheets",this.getSheets.bind(this)),this.registerTableFunction("getSheetDefinitions",this.getSheetDefinitions.bind(this)),this.registerTableFunction("setSheetData",this.setSheetData.bind(this)),this.registerTableFunction("getSheet",this.getSheet.bind(this)),this.registerTableFunction("getSheetData",this.getSheetData.bind(this)),this.registerTableFunction("clearSheet",this.clearSheet.bind(this)),this.registerTableFunction("removeSheet",this.removeSheetFunc.bind(this)),this.registerTableFunction("activeSheet",this.activeSheetFunc.bind(this))}initialize(){this.options("spreadsheet")&&(this.subscribe("table-initialized",this.tableInitialized.bind(this)),this.subscribe("data-loaded",this.loadRemoteData.bind(this)),this.table.options.index="_id",this.options("spreadsheetData")&&this.options("spreadsheetSheets")&&(console.warn("You cannot use spreadsheetData and spreadsheetSheets at the same time, ignoring spreadsheetData"),this.table.options.spreadsheetData=!1),this.compatibilityCheck(),this.options("spreadsheetSheetTabs")&&this.initializeTabset())}compatibilityCheck(){this.options("data")&&console.warn("Do not use the data option when working with spreadsheets, use either spreadsheetData or spreadsheetSheets to pass data into the table"),this.options("pagination")&&console.warn("The spreadsheet module is not compatible with the pagination module"),this.options("groupBy")&&console.warn("The spreadsheet module is not compatible with the row grouping module"),this.options("responsiveCollapse")&&console.warn("The spreadsheet module is not compatible with the responsive collapse module")}initializeTabset(){this.element=document.createElement("div"),this.element.classList.add("tabulator-spreadsheet-tabs");var e=this.options("spreadsheetSheetTabsElement");e&&!(e instanceof HTMLElement)&&(e=document.querySelector(e),e||console.warn("Unable to find element matching spreadsheetSheetTabsElement selector:",this.options("spreadsheetSheetTabsElement"))),e?e.appendChild(this.element):this.footerAppend(this.element)}tableInitialized(){this.sheets.length?this.loadSheet(this.sheets[0]):this.options("spreadsheetSheets")?this.loadSheets(this.options("spreadsheetSheets")):this.options("spreadsheetData")&&this.loadData(this.options("spreadsheetData"))}loadRemoteData(e,i,r){return console.log("data",e,i,r),Array.isArray(e)?(this.table.dataLoader.clearAlert(),this.dispatchExternal("dataLoaded",e),!e.length||Array.isArray(e[0])?this.loadData(e):this.loadSheets(e)):console.error(`Spreadsheet Loading Error - Unable to process remote data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e),!1}loadData(e){var i={data:e};this.loadSheet(this.newSheet(i))}destroySheets(){this.sheets.forEach(e=>{e.destroy()}),this.sheets=[],this.activeSheet=null}loadSheets(e){Array.isArray(e)||(e=[]),this.destroySheets(),e.forEach(i=>{this.newSheet(i)}),this.loadSheet(this.sheets[0])}loadSheet(e){this.activeSheet!==e&&(this.activeSheet&&this.activeSheet.unload(),this.activeSheet=e,e.load())}newSheet(e={}){var i;return e.rows||(e.rows=this.options("spreadsheetRows")),e.columns||(e.columns=this.options("spreadsheetColumns")),i=new P2(this,e),this.sheets.push(i),this.element&&this.element.appendChild(i.element),i}removeSheet(e){var i=this.sheets.indexOf(e),r;this.sheets.length>1?i>-1&&(this.sheets.splice(i,1),e.destroy(),this.activeSheet===e&&(r=this.sheets[i-1]||this.sheets[0],r?this.loadSheet(r):this.activeSheet=null)):console.warn("Unable to remove sheet, at least one sheet must be active")}lookupSheet(e){return e?e instanceof P2?e:e instanceof i7?e._sheet:this.sheets.find(i=>i.key===e)||!1:this.activeSheet}setSheets(e){return this.loadSheets(e),this.getSheets()}addSheet(e){return this.newSheet(e).getComponent()}getSheetDefinitions(){return this.sheets.map(e=>e.getDefinition())}getSheets(){return this.sheets.map(e=>e.getComponent())}getSheet(e){var i=this.lookupSheet(e);return i?i.getComponent():!1}setSheetData(e,i){e&&!i&&(i=e,e=!1);var r=this.lookupSheet(e);return r?r.setData(i):!1}getSheetData(e){var i=this.lookupSheet(e);return i?i.getData():!1}clearSheet(e){var i=this.lookupSheet(e);return i?i.clear():!1}removeSheetFunc(e){var i=this.lookupSheet(e);i&&this.removeSheet(i)}activeSheetFunc(e){var i=this.lookupSheet(e);return i?this.loadSheet(i):!1}}$e(r7,"moduleName","spreadsheet");class n7 extends oi{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,r){var n=e==="tooltip"?r.column.definition.tooltip:r.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,r,n),this.table.options.tooltipDelay))}mouseoutCheck(e,i,r){this.popupInstance||this.clearPopup()}clearPopup(e,i,r){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,r){var n,a,o;function s(l){a=l}typeof r=="function"&&(r=r(e,i.getComponent(),s)),r instanceof HTMLElement?n=r:(n=document.createElement("div"),r===!0&&(i instanceof Vb?r=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{n.innerHTML=r=l||i.definition.title}):r=i.definition.title),n.innerHTML=r),(r||r===0||r===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(n),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}$e(n7,"moduleName","tooltip");var Jge={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(/^[a-z0-9]+$/i);return r.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=new RegExp(i);return r.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var r=!0,n=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==n&&e==a.getFieldValue(s)&&(r=!1)}),r},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};const vI=class vI extends oi{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,r){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,n)}),n}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(r=>{this.cellValidate(r)!==!0&&i.push(r.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(r=>{r=r.getComponent();var n=r.validate();n!==!0&&(i=i.concat(n))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,r=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{n=i._extractValidator(a),n&&r.push(n)}):(n=this._extractValidator(e.definition.validator),n&&r.push(n)),e.modules.validate=r.length?r:!1)}_extractValidator(e){var i,r,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(i=e.substring(0,n),r=e.substring(n+1)):i=e,this._buildValidator(i,r);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var r=typeof e=="function"?e:vI.validators[e];return r?{type:typeof e=="function"?"function":e,func:r,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,r){var n=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(n,i.getComponent(),r,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}};$e(vI,"moduleName","validate"),$e(vI,"validators",Jge);let x1=vI;var EE=Object.freeze({__proto__:null,AccessorModule:h1,AjaxModule:v1,ClipboardModule:I1,ColumnCalcsModule:y1,DataTreeModule:jY,DownloadModule:b1,EditModule:w1,ExportModule:U1,FilterModule:S1,FormatModule:T1,FrozenColumnsModule:GY,FrozenRowsModule:HY,GroupRowsModule:zY,HistoryModule:D1,HtmlTableImportModule:WY,ImportModule:P1,InteractionModule:qY,KeybindingsModule:R1,MenuModule:YY,MoveColumnsModule:KY,MoveRowsModule:E1,MutatorModule:C1,PageModule:M1,PersistenceModule:N1,PopupModule:JY,PrintModule:XY,ReactiveDataModule:ZY,ResizeColumnsModule:QY,ResizeRowsModule:e7,ResizeTableModule:t7,ResponsiveLayoutModule:A1,SelectRangeModule:lS,SelectRowModule:O1,SortModule:k1,SpreadsheetModule:r7,TooltipModule:n7,ValidateModule:x1}),Xge={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},rowHeader:!1,data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class a7{constructor(e,i,r={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},r)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var r=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(r,e);for(let a in i)r.hasOwnProperty(a)||(n&&console.warn("Invalid "+this.msgType+" option:",a),r[a]=i.key);for(let a in r)a in i?r[a]=i[a]:Array.isArray(r[a])?r[a]=Object.assign([],r[a]):typeof r[a]=="object"&&r[a]!==null?r[a]=Object.assign({},r[a]):typeof r[a]>"u"&&delete r[a];return r}}class nP extends Fa{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,r){var n=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(n>-1){if(typeof r>"u"&&(r=this.table.options.scrollToRowIfVisible),!r&&Er.elVisible(a)&&(o=Er.elOffset(a).top-Er.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class Zge extends nP{constructor(e){super(e)}renderRowCells(e,i){const r=document.createDocumentFragment();e.cells.forEach(n=>{r.appendChild(n.getElement())}),e.element.appendChild(r),i||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class Qge extends nP{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var r=i.getWidth();r>e&&(e=r)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var r={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=n,o.rightPos=n+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),n+s>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,n+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(r))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(r=>{i.appendChild(r.getElement())}),e.element.appendChild(i),e.cells.forEach(r=>{r.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,r;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){r=i.getElement(),i.generateCells(),this.tableElement.appendChild(r);for(let n=0;n<i.cells.length;n++){let a=i.cells[n];r.appendChild(a.getElement()),a.column.reinitializeWidth()}r.parentNode.removeChild(r),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((r,n)=>{r!==this.columns[n]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(r=>!e.includes(r));e.forEach(r=>{this.reinitializeRow(r,!0)}),i.forEach(r=>{r.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,r){for(let n=e;n<i;n++){let a=this.columns[n];a.modules.vdomHoz.leftPos+=r,a.modules.vdomHoz.rightPos+=r}}addColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol+1];r&&r.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);n.getElement().insertBefore(a.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(r),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=r.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol-1];if(r)if(r.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(r);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=r.getWidth();let n=this.fitDataColActualWidthCheck(r);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let r=this.columns[this.rightCol];r&&r.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=r.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let r=this.columns[this.leftCol];r&&r.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var a=n.getCell(r);try{n.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=r.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,r;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),r=i-e.modules.vdomHoz.width,r&&(e.modules.vdomHoz.rightPos+=r,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,r)),e.modules.vdomHoz.fitDataCheck=!1),r}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let r=e.getCell(i);e.getElement().appendChild(r.getElement()),r.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var r=e.getElement();r.firstChild;)r.removeChild(r.firstChild);this.initializeRow(e)}}}class eve extends Fa{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.rowHeader=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new a7(this.table,"column definition",VY),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:Qge,basic:Zge};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],r=this.table.options.autoColumnsDefinitions,n,a;if(e&&e.length){n=e[0];for(var o in n){let s={field:o,title:o},l=n[o];switch(typeof l){case"undefined":a="string";break;case"boolean":a="boolean";break;case"object":Array.isArray(l)?a="array":a="string";break;default:!isNaN(l)&&l!==""?a="number":l.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?a="alphanum":a="string";break}s.sorter=a,i.push(s)}if(r)switch(typeof r){case"function":this.table.options.columns=r.call(this.table,i);break;case"object":Array.isArray(r)?i.forEach(s=>{var l=r.find(c=>c.field===s.field);l&&Object.assign(s,l)}):i.forEach(s=>{r[s.field]&&Object.assign(s,r[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),this.table.options.rowHeader&&(this.rowHeader=new lm(this.table.options.rowHeader===!0?{}:this.table.options.rowHeader,this,!0),this.columns.push(this.rowHeader),this.headersElement.appendChild(this.rowHeader.getElement()),this.rowHeader.columnRendered()),e.forEach((r,n)=>{this._addColumn(r)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,r){var n=new lm(e,this),a=n.getElement(),o=r&&this.findColumnIndex(r);if(i&&this.rowHeader&&(!r||r===this.rowHeader)&&(i=!1,r=this.rowHeader,o=0),r&&o>-1){var s=r.getTopColumn(),l=this.columns.indexOf(s),c=s.getElement();i?(this.columns.splice(l,0,n),c.parentNode.insertBefore(a,c)):(this.columns.splice(l+1,0,n),c.parentNode.insertBefore(a,c.nextSibling))}else i?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var r=i.getHeight();r>e&&(e=r)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof lm)return e;if(e instanceof BY)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}),i.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(r=>{var n=this.table.options.nestedFieldSeparator?r.split(this.table.options.nestedFieldSeparator)[0]:r;n===e&&i.push(this.columnsByField[r])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,r)=>{e(i,r)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(r=>{(!e||e&&r.visible)&&i.push(r.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],r=e?this.columns:this.columnsByIndex;return r.forEach(n=>{i.push(n.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,r){i.element.parentNode.insertBefore(e.element,i.element),r&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,r),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,r){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,r):this._moveColumnInArray(this.columns,e,i,r),this._moveColumnInArray(this.columnsByIndex,e,i,r,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,r),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,r,n,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(r),s>-1?n&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,r,n],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(o,1)[0];c.cells.splice(s,0,u)}})))}scrollToColumn(e,i,r){var n=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof r>"u"&&(r=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!r&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;n=a+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(r=>{i.push(r.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(r){var n,a,o;r.visible&&(n=r.definition.width||0,a=parseInt(r.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,i+=o>a?o:a)}),i}addColumn(e,i,r){return new Promise((n,a)=>{var o=this._addColumn(e,i,r);this._reIndexColumns(),this.dispatch("column-add",e,i,r),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var i=e.getField(),r;i&&delete this.columnsByField[i],r=this.columnsByIndex.indexOf(e),r>-1&&this.columnsByIndex.splice(r,1),r=this.columns.indexOf(e),r>-1&&this.columns.splice(r,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Er.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class tve extends nP{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,r=document.createDocumentFragment(),n=this.rows();n.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),r.appendChild(a.getElement())}),e.appendChild(r),n.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),n.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Er.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Er.elOffset(i).top-Er.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class ive extends nP{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,r=!1,n=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(n===!1||Math.abs(l)<n)n=l,r=s;else break}o.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(r===!1?this.rows.length-1:r,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var r=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-r>a||n>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(r<0&&this._addTopRow(o,-r),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),r>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,r):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,r=this.elementVertical.clientHeight+i,n=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(n)if(r-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(n=!0,r-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,r){var n=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,c=0,u=0,d=0,p=this.rows(),m=p.length,h=0,f,g,v=[],I=0,y=0,b=this.table.rowManager.fixedHeight,S=this.elementVertical.clientHeight,w=this.table.options.rowHeight,U=!0;if(e=e||0,r=r||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);c=(m-e+1)*this.vDomRowHeight,c<S&&(e-=Math.ceil((S-c)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(m&&Er.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,b||this.table.options.maxHeight?(w&&(y=S/w+this.vDomWindowBuffer/w),y=Math.max(this.vDomWindowMinTotalRows,Math.ceil(y))):y=m;(y==m||s<=S+this.vDomWindowBuffer||I<this.vDomWindowMinTotalRows)&&this.vDomBottom<m-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<y&&this.vDomBottom<m-1;)h=this.vDomBottom+1,f=p[h],this.styleRow(f,h),f.initialize(!1,!0),!f.heightInitialized&&!this.table.options.rowHeight&&f.clearCellHeight(),g.appendChild(f.getElement()),v.push(f),this.vDomBottom++,d++;if(!v.length)break;n.appendChild(g),v.forEach(T=>{T.rendered(),T.heightInitialized||T.calcHeight(!0)}),v.forEach(T=>{T.heightInitialized||T.setCellHeight()}),v.forEach(T=>{l=T.getHeight(),I<o?u+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),I++}),U=this.table.rowManager.adjustTableSize(),S=this.elementVertical.clientHeight,U&&(b||this.table.options.maxHeight)&&(w=s/I,y=Math.max(this.vDomWindowMinTotalRows,Math.ceil(S/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+r:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==m-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+u)/I),this.vDomBottomPad=this.vDomRowHeight*(m-this.vDomBottom-1),this.vDomScrollHeight=u+s+this.vDomBottomPad-S),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+r-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-S:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-S),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-S),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let c=e[o],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,o),r.insertBefore(c.getElement(),r.firstChild),(!c.initialized||!c.heightInitialized)&&n.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let c of n)c.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),r.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var r=this.tableElement,n=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let c=e[o],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,o),r.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&n.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let c of n)c.clearCellHeight();this._quickNormalizeRowHeight(n),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),r.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var r=[],n=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,n+=l,r.push(s),a++):o=!1):o=!1}for(let s of r){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class rve extends Fa{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let r=document.createElement("div");r.classList.add("tabulator-placeholder-contents"),r.innerHTML=e,i.appendChild(r),this.placeholderContents=r}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,r=this.element.scrollTop,n=this.scrollTop>r;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=r&&(this.scrollTop=r,this.renderer.scrollRows(r,n),this.dispatch("scroll-vertical",r,n),this.dispatchExternal("scrollVertical",r,n))})}findRow(e){if(typeof e=="object"){if(e instanceof Ga)return e;if(e instanceof iP)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(r=>r.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(r=>r.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(r=>r.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.type==="row"&&i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,r){return this.renderer.scrollToRowPosition(e,i,r)}setData(e,i,r){return new Promise((n,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&r&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((r,n)=>{if(r&&typeof r=="object"){var a=new Ga(r,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",r)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var r=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),r>-1&&this.rows.splice(r,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,r,n){var a=this.addRowActual(e,i,r,n);return a}addRows(e,i,r,n){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof r>"u"&&i||typeof r<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,r,!0);a.push(u),this.dispatch("row-added",u,l,i,r)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,r,n){var a=e instanceof Ga?e:new Ga(e||{},this),o=this.findAddRowPos(i),s=-1,l,c;return r||(c=this.chain("row-adding-position",[a,o],null,{index:r,top:o}),r=c.index,o=c.top),typeof r<"u"&&(r=this.findRow(r)),r=this.chain("row-adding-index",[a,r,o],null,r),r&&(s=this.rows.indexOf(r)),r&&s>-1?(l=this.activeRows.indexOf(r),this.displayRowIterator(function(u){var d=u.indexOf(r);d>-1&&u.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(u){u.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(u){u.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),a}moveRow(e,i,r){this.dispatch("row-move",e,i,r),this.moveRowActual(e,i,r),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,r),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,r){this.moveRowInArray(this.rows,e,i,r),this.moveRowInArray(this.activeRows,e,i,r),this.displayRowIterator(n=>{this.moveRowInArray(n,e,i,r)}),this.dispatch("row-moving",e,i,r)}moveRowInArray(e,i,r,n){var a,o,s,l;if(i!==r&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(r),o>-1?n?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let c=s;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r!==!1&&r<this.displayRowsCount-1&&(n=this.getDisplayRows()[r+1]),n&&(!(n instanceof Ga)||n.type!="row")?this.nextDisplayRow(n,i):n}prevDisplayRow(e,i){var r=this.getDisplayRowIndex(e),n=!1;return r&&(n=this.getDisplayRows()[r-1]),i&&n&&(!(n instanceof Ga)||n.type!="row")?this.prevDisplayRow(n,i):n}findRowIndex(e,i){var r;return e=this.findRow(e),e&&(r=i.indexOf(e),r>-1)?r:!1}getData(e,i){var r=[],n=this.getRows(e);return n.forEach(function(a){a.type=="row"&&r.push(a.getData(i||"data"))}),r}getComponents(e){var i=[],r=this.getRows(e);return r.forEach(function(n){i.push(n.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((r,n)=>r.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,r){var n=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:r,stage:a,index:o});return}else Er.elVisible(this.element)?r?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,r)):(this.refreshPipelines(e,a,o,r),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,r),this.dispatch("data-refreshed")}}refreshPipelines(e,i,r,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=r;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":r=0,this.resetDisplayRows();case"displayPipeline":for(let a=r;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(r=>{r.type==="row"&&(r.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var r=Object.assign([],this.renderer.visibleRows(!i));return e&&(r=this.chain("rows-visible",[i],r,r)),r}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:ive,basic:tve};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var r=e.getElement();i%2?(r.classList.add("tabulator-row-even"),r.classList.remove("tabulator-row-odd")):(r.classList.add("tabulator-row-odd"),r.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,r=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+n+"px)";this.element.style.minHeight=i||"calc(100% - "+n+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(r=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),r}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class nve extends Fa{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class ave extends Fa{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,r){this.pseudoTrackers[e].target!==r&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=r,this.dispatch(e+"-mouseenter",i,r))}pseudoMouseLeave(e,i){var r=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};r=r.filter(a=>{var o=n[e];return a!==e&&(!o||o&&!o.includes(a))}),r.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let r of i)for(let n of e){let a=r+"-"+n;this.subscriptionChange(a,this.subscriptionChanged.bind(this,r,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,r){var n=this.listeners[i].components,a=n.indexOf(e),o=!1;r?a===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(n.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var r=i.composedPath&&i.composedPath()||i.path,n=this.findTargets(r);n=this.bindComponents(e,n),this.triggerEvents(e,i,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let r=Object.keys(this.componentMap);for(let n of e){let a=n.classList?[...n.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>r.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=n)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var r=Object.keys(i).reverse(),n=this.listeners[e],a={},o={};for(let s of r){let l,c=i[s],u=this.previousTargets[s];if(u&&u.target===c)l=u.component;else switch(s){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":n.components.includes("column")&&(l=this.table.columnManager.findColumn(c));break;case"cell":n.components.includes("cell")&&(a.row instanceof Ga?l=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:c,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,r){var n=this.listeners[e];for(let a in r)r[a]&&n.components.includes(a)&&this.dispatch(a+"-"+e,i,r[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class ove{constructor(e){this.table=e,this.bindings={}}bind(e,i,r){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,r):this.bindings[e][i]=r}handle(e,i,r){if(this.bindings[e]&&this.bindings[e][r]&&typeof this.bindings[e][r].bind=="function")return this.bindings[e][r].bind(null,i);r!=="then"&&typeof r=="string"&&!r.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+r+" function, have you checked that you have the correct Tabulator module installed?")}}class sve extends Fa{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,r,n,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,r,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,r,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,r,a],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",[c],null,c);s==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,i){var r={};for(let n in e)r[i.hasOwnProperty(n)?i[n]:n]=e[n];return r}objectInvert(e){var i={};for(let r in e)i[e[r]]=r;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class lve{constructor(e,i,r){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=r?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=r}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e])if(i)if(r=this.events[e].findIndex(n=>n===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),r;return this.events[i]&&this.events[i].forEach((n,a)=>{let o=n.apply(this.table,e);a||(r=o)}),r}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class uve{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,r=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:r}),this.events[e].sort((n,a)=>n.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var r;if(this.events[e]){if(i)if(r=this.events[e].findIndex(n=>n.callback===i),r>-1)this.events[e].splice(r,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,r,n){var a=r;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof n=="function"?n():n}_confirm(e,i){var r=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((n,a)=>{n.callback.apply(this,i)&&(r=!0)}),r}_notifySubscriptionChange(e,i){var r=this.subscriptionNotifiers[e];r&&r.forEach(n=>{n(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(r=>{r.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class cve extends Fa{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,r){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(n=n+", Please use the %c"+i+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),r&&(this.table.options[i]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}function dve(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function R2(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function pve(t,e){var i=0,r=this.table.rowManager.element.clientWidth,n=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(n=r-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?a.setWidth(n):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function mve(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,r=0,n=0,a=0,o=0,s=[],l=[],c=0,u=0,d=0;function p(h){var f;return typeof h=="string"?h.indexOf("%")>-1?f=i/100*parseInt(h):f=parseInt(h):f=h,f}function m(h,f,g,v){var I=[],y=0,b=0,S=0,w=a,U=0,T=0,P=[];function R(E){return g*(E.column.definition.widthGrow||1)}function D(E){return p(E.width)-g*(E.column.definition.widthShrink||0)}return h.forEach(function(E,N){var A=v?D(E):R(E);E.column.minWidth>=A?I.push(E):E.column.maxWidth&&E.column.maxWidth<A?(E.width=E.column.maxWidth,f-=E.column.maxWidth,w-=v?E.column.definition.widthShrink||1:E.column.definition.widthGrow||1,w&&(g=Math.floor(f/w))):(P.push(E),T+=v?E.column.definition.widthShrink||1:E.column.definition.widthGrow||1)}),I.length?(I.forEach(function(E){y+=v?E.width-E.column.minWidth:E.column.minWidth,E.width=E.column.minWidth}),b=f-y,S=T?Math.floor(b/T):b,U=m(P,b,S,v)):(U=T?f-Math.floor(f/T)*T:f,P.forEach(function(E){E.width=v?D(E):R(E)})),U}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(h){var f,g,v;h.visible&&(f=h.definition.width,g=parseInt(h.minWidth),f?(v=p(f),r+=v>g?v:g,h.definition.widthShrink&&(l.push({column:h,width:v>g?v:g}),c+=h.definition.widthShrink)):(s.push({column:h,width:0}),a+=h.definition.widthGrow||1))}),n=i-r,o=Math.floor(n/a),d=m(s,n,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(h){n-=h.width}),u=Math.abs(d)+n,u>0&&c&&(d=m(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(h){h.column.setWidth(h.width)}),l.forEach(function(h){h.column.setWidth(h.width)})}var hve={fitData:dve,fitDataFill:R2,fitDataTable:R2,fitDataStretch:pve,fitColumns:mve};const pf=class pf extends oi{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;pf.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),pf.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}};$e(pf,"moduleName","layout"),$e(pf,"modes",hve);let F1=pf;var fve={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};const II=class II extends oi{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Er.deepClone(II.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let r in i)e[r]&&typeof e[r]=="object"?this._setLangProp(e[r],i[r]):e[r]=i[r]}setLocale(e){e=e||"default";function i(r,n){for(var a in r)typeof r[a]=="object"?(n[a]||(n[a]={}),i(r[a],n[a])):n[a]=r[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let r=e.split("-")[0];this.langList[r]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,r),e=r):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Er.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var r=i?e+"|"+i:e,n=r.split("|"),a=this._getLangElement(n,this.locale);return a||""}_getLangElement(e,i){var r=this.lang;return e.forEach(function(n){var a;r&&(a=r[n],typeof a<"u"?r=a:r=!1)}),r}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}};$e(II,"moduleName","localize"),$e(II,"langs",fve);let L1=II;class o7 extends oi{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],r;return r=this.table.constructor.registry.lookupTable(e),r.forEach(n=>{this.table!==n&&i.push(n)}),i}send(e,i,r,n){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,r,n)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,r,n){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,r,n);console.warn("Inter-table Comms Error - no such module:",i)}}$e(o7,"moduleName","comms");var gve=Object.freeze({__proto__:null,CommsModule:o7,LayoutModule:F1,LocalizeModule:L1});const Qo=class Qo{static findTable(e){var i=Qo.registry.lookupTable(e,!0);return Array.isArray(i)&&!i.length?!1:i}};$e(Qo,"registry",{tables:[],register(e){Qo.registry.tables.push(e)},deregister(e){var i=Qo.registry.tables.indexOf(e);i>-1&&Qo.registry.tables.splice(i,1)},lookupTable(e,i){var r=[],n,a;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)a=Qo.registry.matchElement(n[o]),a&&r.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof Qo?(a=Qo.registry.matchElement(e),a&&r.push(a)):Array.isArray(e)?e.forEach(function(s){r=r.concat(Qo.registry.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return r},matchElement(e){return Qo.registry.tables.find(function(i){return e instanceof Qo?i===e:i.element===e})}});let _1=Qo;const nr=class nr extends _1{constructor(){super()}static initializeModuleBinder(e){nr.modulesRegistered||(nr.modulesRegistered=!0,nr._registerModules(gve,!0),e&&nr._registerModules(e))}static _extendModule(e,i,r){if(nr.moduleBindings[e]){var n=nr.moduleBindings[e][i];if(n)if(typeof r=="object")for(let a in r)n[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",e)}static _registerModules(e,i){var r=Object.values(e);i&&r.forEach(n=>{n.prototype.moduleCore=!0}),nr._registerModule(r)}static _registerModule(e){Array.isArray(e)||(e=[e]),e.forEach(i=>{nr._registerModuleBinding(i),nr._registerModuleExtensions(i)})}static _registerModuleBinding(e){e.moduleName?nr.moduleBindings[e.moduleName]=e:console.error("Unable to bind module, no moduleName defined",e.moduleName)}static _registerModuleExtensions(e){var i=e.moduleExtensions;if(e.moduleExtensions)for(let r in i){let n=i[r];if(nr.moduleBindings[r])for(let a in n)nr._extendModule(r,a,n[a]);else{nr.moduleExtensions[r]||(nr.moduleExtensions[r]={});for(let a in n)nr.moduleExtensions[r][a]||(nr.moduleExtensions[r][a]={}),Object.assign(nr.moduleExtensions[r][a],n[a])}}nr._extendModuleFromQueue(e)}static _extendModuleFromQueue(e){var i=nr.moduleExtensions[e.moduleName];if(i)for(let r in i)nr._extendModule(e.moduleName,r,i[r])}_bindModules(){var e=[],i=[],r=[];this.modules={};for(var n in nr.moduleBindings){let a=nr.moduleBindings[n],o=new a(this);this.modules[n]=o,a.prototype.moduleCore?this.modulesCore.push(o):a.moduleInitOrder?a.moduleInitOrder<0?e.push(o):i.push(o):r.push(o)}e.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),i.sort((a,o)=>a.moduleInitOrder>o.moduleInitOrder?1:-1),this.modulesRegular=e.concat(r.concat(i))}};$e(nr,"moduleBindings",{}),$e(nr,"moduleExtensions",{}),$e(nr,"modulesRegistered",!1),$e(nr,"defaultModules",!1);let $1=nr;class vve extends Fa{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}const hc=class hc extends $1{static extendModule(){hc.initializeModuleBinder(),hc._extendModule(...arguments)}static registerModule(){hc.initializeModuleBinder(),hc._registerModule(...arguments)}constructor(e,i,r){super(),hc.initializeModuleBinder(r),this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new ove(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new cve(this),this.optionsList=new a7(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),this.constructor.registry.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new eve(this),this.rowManager=new rve(this),this.footerManager=new nve(this),this.dataLoader=new sve(this),this.alertManager=new vve(this),this._bindModules(),this.options=this.optionsList.generate(hc.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new lve(this,this.options,this.options.debugEventsExternal),this.eventBus=new uve(this.options.debugEventsInternal),this.interactionMonitor=new ave(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this.initialized=!0,this._loadInitialData().finally(()=>{this.eventBus.dispatch("table-initialized"),this.externalEvents.dispatch("tableBuilt")})}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,r;if(e.tagName==="TABLE"){this.originalElement=this.element,r=document.createElement("div");var n=e.attributes;for(var a in n)typeof n[a]=="object"&&r.setAttribute(n[a].name,n[a].value);e.parentNode.replaceChild(r,e),this.element=e=r}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(r=>{r.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(r=>{r.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){return this.dataLoader.load(this.options.data).finally(()=>{this.columnManager.verticalAlignHeaders()})}destroy(){var e=this.element;for(this.destroyed=!0,this.constructor.registry.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var r,n;return this.options.debugInitialization&&!this.initialized&&(e||(r=new Error().stack.split(`
`),n=r[0]=="Error"?r[2]:r[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,r){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,r,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,r){return this.initGuard(),this.dataLoader.load(e,i,r,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((r,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||r()}).catch(s=>{n("Update Error - Unable to update row",a,s)})):n("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,i,r){return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,r).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),n(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],r=0;return this.initGuard(),new Promise((n,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);r++,s?s.updateData(o).then(()=>{r--,i.push(s.getComponent()),r||n(i)}):this.rowManager.addRows(o).then(l=>{r--,i.push(l[0].getComponent()),r||n(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let r of e){let n=this.rowManager.findRow(r,!0);if(n)i.push(n);else return console.error("Delete Error - No matching row found:",r),Promise.reject("Delete Error - No matching row found")}return i.sort((r,n)=>this.rowManager.rows.indexOf(r)>this.rowManager.rows.indexOf(n)?1:-1),i.forEach(r=>{r.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,r){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,r,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>r.getComponent()):this.rowManager.addRows(i).then(n=>n[0].getComponent())}updateRow(e,i){var r=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),r?r.updateData(i).then(()=>Promise.resolve(r.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,r){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,i,r):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,r){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(i,r):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,r){var n=this.columnManager.findColumn(r);return this.initGuard(),this.columnManager.addColumn(e,i,n).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var r=this.columnManager.findColumn(e);return this.initGuard(),r?r.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,r){var n=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),n?a?this.columnManager.moveColumn(n,a,r):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,r){return new Promise((n,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,r):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}};$e(hc,"defaultOptions",Xge);let B1=hc;var _v=B1;class Ive extends _v{static extendModule(){_v.initializeModuleBinder(EE),_v._extendModule(...arguments)}static registerModule(){_v.initializeModuleBinder(EE),_v._registerModule(...arguments)}constructor(e,i,r){super(e,i,EE)}}var jb=Ive;function aP({anchorId:t}){const e=jb.findTable(`#${t}`)[0];e&&e.destroy()}function yve(t,e){return t?eP.dateTime.convertTime(t,e):""}function s7(t){var E;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const r=t.getValue(),{potentialParticipants:n,eventName:a="",roundName:o="",schedule:s={},winningSide:l,matchUpId:c,sides:u}=r||{},{courtOrder:d="",scheduledTime:p="",courtId:m="",timeModifiers:h,venueId:f=""}=s;if(e.setAttribute("courtOrder",d),e.setAttribute("courtId",m),e.setAttribute("venueId",f),e.className="schedule-cell dragdrop",e.ondragover=N=>N.preventDefault(),c&&(e.draggable=!0,e.id=c,l&&e.classList.add("matchup-complete")),!c)return e;const g=`${a} ${o}`,v=N=>{var A,M;return((M=(A=N.person)==null?void 0:A.standardFamilyName)==null?void 0:M.toUpperCase())||N.participantName},I=n==null?void 0:n.map(N=>N==null?void 0:N.map(A=>`<span class='potential nowrap'>${v(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),y=N=>{var M,C;const A=(C=(M=u==null?void 0:u.find(O=>N===O.sideNumber))==null?void 0:M.participant)==null?void 0:C.participantName;if(A)return l===N?`<span style='font-weight: bold'>${A}</span>`:A},b=y(1)||(I==null?void 0:I.shift())||"Unkown",S=y(2)||(I==null?void 0:I.shift())||"Unknown";e.id=c;const w=document.createElement("div");w.className="header flexrow",w.innerHTML=((h==null?void 0:h[0])&&rfe[h[0]]+"&nbsp;"||"")+yve(p,!1),e.appendChild(w);const U=document.createElement("div");U.className="catround",U.innerHTML=g,e.appendChild(U);const T=document.createElement("div");T.className="scheduled_teams";const P=document.createElement("div");P.className="scheduled_team",P.style.fontSize="1em",P.innerHTML=b,T.appendChild(P);const R=document.createElement("div");R.className="divider",R.innerHTML="vs.",T.appendChild(R);const D=document.createElement("div");if(D.className="scheduled_team",D.style.fontSize="1em",D.innerHTML=S,T.appendChild(D),l){const N=document.createElement("div");N.innerHTML=((E=r.score)==null?void 0:E.scoreStringSide1)||"",T.appendChild(N)}return e.appendChild(T),e}function bve({count:t}){return t>0?eP.generateRange(0,t).map(()=>({headerHozAlign:Oi,formatter:s7,headerSort:!1,resizable:!1,minWidth:150})):[]}function wve(){function t(e){e.getElement().style.backgroundColor="white";const i=document.createElement("span"),r=e.getRow().getData();return i.innerHTML=r.rowNumber,i}return{formatter:t,headerSort:!1,resizable:!1,hozAlign:Oi,frozen:!0,width:55}}function Uve({courtsData:t,courtPrefix:e}){const i=ife-(t==null?void 0:t.length)||0,r=i<=0?1:i,n=bve({count:r}),a=wve(),o=(s,l)=>({field:`${e}${l}`,title:s.courtName,headerHozAlign:Oi,formatter:s7,headerSort:!1,resizable:!1,hozAlign:Oi,minWidth:150});return[a].concat(t==null?void 0:t.map(o),n)}var Sve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tve(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var l7={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(Sve,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,I={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],C=A%100;return"["+A+(M[(C-20)%10]||M[C]||M[0])+"]"}},y=function(A,M,C){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(C)+A},b={s:y,z:function(A){var M=-A.utcOffset(),C=Math.abs(M),O=Math.floor(C/60),k=C%60;return(M<=0?"+":"-")+y(O,2,"0")+":"+y(k,2,"0")},m:function A(M,C){if(M.date()<C.date())return-A(C,M);var O=12*(C.year()-M.year())+(C.month()-M.month()),k=M.clone().add(O,d),x=C-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(C-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:u,d:c,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=I;var U="$isDayjsObject",T=function(A){return A instanceof E||!(!A||!A[U])},P=function A(M,C,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),C&&(w[x]=C,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},R=function(A,M){if(T(A))return A.clone();var C=typeof M=="object"?M:{};return C.date=A,C.args=arguments,new E(C)},D=b;D.l=P,D.i=T,D.w=function(A,M){return R(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var E=function(){function A(C){this.$L=P(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(C){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(D.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(C),this.init()},M.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},M.$utils=function(){return D},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(C,O){var k=R(C);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(C,O){return R(C)<this.startOf(O)},M.isBefore=function(C,O){return this.endOf(O)<R(C)},M.$g=function(C,O,k){return D.u(C)?this[O]:this.set(k,C)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(C,O){var k=this,x=!!D.u(O)||O,F=D.p(C),$=function(W,Y){var q=D.w(k.$u?Date.UTC(k.$y,Y,W):new Date(k.$y,Y,W),k);return x?q:q.endOf(c)},_=function(W,Y){return D.w(k.toDate()[W].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(Y)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case u:var j=this.$locale().weekStart||0,H=(L<j?L+7:L)-j;return $(x?V-H:V+(6-H),B);case c:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(C){return this.startOf(C,!1)},M.$set=function(C,O){var k,x=D.p(C),F="set"+(this.$u?"UTC":""),$=(k={},k[c]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===c?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(C,O){return this.clone().$set(C,O)},M.get=function(C){return this[D.p(C)]()},M.add=function(C,O){var k,x=this;C=Number(C);var F=D.p(O),$=function(B){var V=R(x);return D.w(V.date(V.date()+Math.round(B*C)),x)};if(F===d)return this.set(d,this.$M+C);if(F===m)return this.set(m,this.$y+C);if(F===c)return $(1);if(F===u)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+C*_;return D.w(L,this)},M.subtract=function(C,O){return this.add(-1*C,O)},M.format=function(C){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=C||"YYYY-MM-DDTHH:mm:ssZ",F=D.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(Y,q,re,K){return Y&&(Y[q]||Y(O,x))||re[q].slice(0,K)},H=function(Y){return D.s($%12||12,Y,"0")},W=G||function(Y,q,re){var K=Y<12?"AM":"PM";return re?K.toLowerCase():K};return x.replace(v,function(Y,q){return q||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return D.s(O.$y,4,"0");case"M":return L+1;case"MM":return D.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return D.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return D.s($,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return W($,_,!0);case"A":return W($,_,!1);case"m":return String(_);case"mm":return D.s(_,2,"0");case"s":return String(O.$s);case"ss":return D.s(O.$s,2,"0");case"SSS":return D.s(O.$ms,3,"0");case"Z":return F}return null}(Y)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(C,O,k){var x,F=this,$=D.p(O),_=R(C),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return D.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case u:x=(B-L)/6048e5;break;case c:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:D.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(C,O){if(!C)return this.$L;var k=this.clone(),x=P(C,O,!0);return x&&(k.$L=x),k},M.clone=function(){return D.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=E.prototype;return R.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",c],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),R.extend=function(A,M){return A.$i||(A(M,E,R),A.$i=!0),R},R.locale=P,R.isDayjs=T,R.unix=function(A){return R(1e3*A)},R.en=w[S],R.Ls=w,R.p={},R})})(l7);var Dve=l7.exports;const Pve=Tve(Dve);function Rve(t){const{dateMatchUps:e=[],completedMatchUps:i=[],groupInfo:r}=(t==null?void 0:t.data)??{},n=e.concat(...i),a=n.reduce((y,b)=>{var w;const S=(w=b==null?void 0:b.schedule)==null?void 0:w.scheduledDate;return S&&!y.includes(S)&&y.push(S),y},[]),o=a[0];let s;const l=({scheduledDate:y})=>{var T;const b=(T=t==null?void 0:t.data)==null?void 0:T.courtsData.map(P=>{const{matchUps:R,...D}=P;return{...D,matchUps:R.filter(E=>{var N;return((N=E.schedule)==null?void 0:N.scheduledDate)===y})}}),S="C|",w=hx.courtGridRows({courtsData:b,courtPrefix:S,minRowsCount:10}).rows,U=Uve({courtsData:b,courtPrefix:S});return w==null||w.forEach((P,R)=>{P.rowId=`rowId-${R+1}`,P.rowNumber=R+1}),{rows:w,columns:U,courtsCount:(b==null?void 0:b.length)??0,courtsData:b,groupInfo:r}},c=({scheduledDate:y})=>{const{rows:b}=l({scheduledDate:y});s==null||s.replaceData(b),s.matchUps=n},u=y=>Pve(y).format("dddd MMM D"),d=a.map(y=>({onClick:()=>c({scheduledDate:y}),label:u(y),value:y,close:!0})),p={label:u(o),options:d,id:"dateSelector",modifyLabel:!0,selection:!0},m=document.getElementById("scheduleHeader");nfe(m);const h=sm({button:p});m.appendChild(h),aP({anchorId:"tournamentSchedule"});const f=document.getElementById("tournamentSchedule"),{rows:g=[],columns:v=[],courtsCount:I}=l({scheduledDate:o});return s=new jb(f,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:g,columns:v}),{table:s,courtsCount:I}}function Eve(){return"tmxToken"}function u7(t,e){return function(){return t.apply(e,arguments)}}const{toString:Cve}=Object.prototype,{getPrototypeOf:Cx}=Object,oP=(t=>e=>{const i=Cve.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),Wu=t=>(t=t.toLowerCase(),e=>oP(e)===t),sP=t=>e=>typeof e===t,{isArray:Zg}=Array,qI=sP("undefined");function Mve(t){return t!==null&&!qI(t)&&t.constructor!==null&&!qI(t.constructor)&&_s(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const c7=Wu("ArrayBuffer");function Nve(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&c7(t.buffer),e}const Ave=sP("string"),_s=sP("function"),d7=sP("number"),lP=t=>t!==null&&typeof t=="object",Ove=t=>t===!0||t===!1,uS=t=>{if(oP(t)!=="object")return!1;const e=Cx(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},kve=Wu("Date"),xve=Wu("File"),Fve=Wu("Blob"),Lve=Wu("FileList"),_ve=t=>lP(t)&&_s(t.pipe),$ve=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||_s(t.append)&&((e=oP(t))==="formdata"||e==="object"&&_s(t.toString)&&t.toString()==="[object FormData]"))},Bve=Wu("URLSearchParams"),Vve=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gb(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let r,n;if(typeof t!="object"&&(t=[t]),Zg(t))for(r=0,n=t.length;r<n;r++)e.call(null,t[r],r,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(r=0;r<o;r++)s=a[r],e.call(null,t[s],s,t)}}function p7(t,e){e=e.toLowerCase();const i=Object.keys(t);let r=i.length,n;for(;r-- >0;)if(n=i[r],e===n.toLowerCase())return n;return null}const m7=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,h7=t=>!qI(t)&&t!==m7;function V1(){const{caseless:t}=h7(this)&&this||{},e={},i=(r,n)=>{const a=t&&p7(e,n)||n;uS(e[a])&&uS(r)?e[a]=V1(e[a],r):uS(r)?e[a]=V1({},r):Zg(r)?e[a]=r.slice():e[a]=r};for(let r=0,n=arguments.length;r<n;r++)arguments[r]&&Gb(arguments[r],i);return e}const jve=(t,e,i,{allOwnKeys:r}={})=>(Gb(e,(n,a)=>{i&&_s(n)?t[a]=u7(n,i):t[a]=n},{allOwnKeys:r}),t),Gve=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Hve=(t,e,i,r)=>{t.prototype=Object.create(e.prototype,r),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},zve=(t,e,i,r)=>{let n,a,o;const s={};if(e=e||{},t==null)return e;do{for(n=Object.getOwnPropertyNames(t),a=n.length;a-- >0;)o=n[a],(!r||r(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&Cx(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},Wve=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const r=t.indexOf(e,i);return r!==-1&&r===i},qve=t=>{if(!t)return null;if(Zg(t))return t;let e=t.length;if(!d7(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},Yve=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&Cx(Uint8Array)),Kve=(t,e)=>{const r=(t&&t[Symbol.iterator]).call(t);let n;for(;(n=r.next())&&!n.done;){const a=n.value;e.call(t,a[0],a[1])}},Jve=(t,e)=>{let i;const r=[];for(;(i=t.exec(e))!==null;)r.push(i);return r},Xve=Wu("HTMLFormElement"),Zve=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,r,n){return r.toUpperCase()+n}),E2=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),Qve=Wu("RegExp"),f7=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),r={};Gb(i,(n,a)=>{let o;(o=e(n,a,t))!==!1&&(r[a]=o||n)}),Object.defineProperties(t,r)},eIe=t=>{f7(t,(e,i)=>{if(_s(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const r=t[i];if(_s(r)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},tIe=(t,e)=>{const i={},r=n=>{n.forEach(a=>{i[a]=!0})};return Zg(t)?r(t):r(String(t).split(e)),i},iIe=()=>{},rIe=(t,e)=>(t=+t,Number.isFinite(t)?t:e),CE="abcdefghijklmnopqrstuvwxyz",C2="0123456789",g7={DIGIT:C2,ALPHA:CE,ALPHA_DIGIT:CE+CE.toUpperCase()+C2},nIe=(t=16,e=g7.ALPHA_DIGIT)=>{let i="";const{length:r}=e;for(;t--;)i+=e[Math.random()*r|0];return i};function aIe(t){return!!(t&&_s(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const oIe=t=>{const e=new Array(10),i=(r,n)=>{if(lP(r)){if(e.indexOf(r)>=0)return;if(!("toJSON"in r)){e[n]=r;const a=Zg(r)?[]:{};return Gb(r,(o,s)=>{const l=i(o,n+1);!qI(l)&&(a[s]=l)}),e[n]=void 0,a}}return r};return i(t,0)},sIe=Wu("AsyncFunction"),lIe=t=>t&&(lP(t)||_s(t))&&_s(t.then)&&_s(t.catch),Ue={isArray:Zg,isArrayBuffer:c7,isBuffer:Mve,isFormData:$ve,isArrayBufferView:Nve,isString:Ave,isNumber:d7,isBoolean:Ove,isObject:lP,isPlainObject:uS,isUndefined:qI,isDate:kve,isFile:xve,isBlob:Fve,isRegExp:Qve,isFunction:_s,isStream:_ve,isURLSearchParams:Bve,isTypedArray:Yve,isFileList:Lve,forEach:Gb,merge:V1,extend:jve,trim:Vve,stripBOM:Gve,inherits:Hve,toFlatObject:zve,kindOf:oP,kindOfTest:Wu,endsWith:Wve,toArray:qve,forEachEntry:Kve,matchAll:Jve,isHTMLForm:Xve,hasOwnProperty:E2,hasOwnProp:E2,reduceDescriptors:f7,freezeMethods:eIe,toObjectSet:tIe,toCamelCase:Zve,noop:iIe,toFiniteNumber:rIe,findKey:p7,global:m7,isContextDefined:h7,ALPHABET:g7,generateString:nIe,isSpecCompliantForm:aIe,toJSONObject:oIe,isAsyncFn:sIe,isThenable:lIe};function Pi(t,e,i,r,n){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),r&&(this.request=r),n&&(this.response=n)}Ue.inherits(Pi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Ue.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const v7=Pi.prototype,I7={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{I7[t]={value:t}});Object.defineProperties(Pi,I7);Object.defineProperty(v7,"isAxiosError",{value:!0});Pi.from=(t,e,i,r,n,a)=>{const o=Object.create(v7);return Ue.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),Pi.call(o,t.message,e,i,r,n),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const uIe=null;function j1(t){return Ue.isPlainObject(t)||Ue.isArray(t)}function y7(t){return Ue.endsWith(t,"[]")?t.slice(0,-2):t}function M2(t,e,i){return t?t.concat(e).map(function(n,a){return n=y7(n),!i&&a?"["+n+"]":n}).join(i?".":""):e}function cIe(t){return Ue.isArray(t)&&!t.some(j1)}const dIe=Ue.toFlatObject(Ue,{},null,function(e){return/^is[A-Z]/.test(e)});function uP(t,e,i){if(!Ue.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Ue.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(f,g){return!Ue.isUndefined(g[f])});const r=i.metaTokens,n=i.visitor||u,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Ue.isSpecCompliantForm(e);if(!Ue.isFunction(n))throw new TypeError("visitor must be a function");function c(h){if(h===null)return"";if(Ue.isDate(h))return h.toISOString();if(!l&&Ue.isBlob(h))throw new Pi("Blob is not supported. Use a Buffer instead.");return Ue.isArrayBuffer(h)||Ue.isTypedArray(h)?l&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function u(h,f,g){let v=h;if(h&&!g&&typeof h=="object"){if(Ue.endsWith(f,"{}"))f=r?f:f.slice(0,-2),h=JSON.stringify(h);else if(Ue.isArray(h)&&cIe(h)||(Ue.isFileList(h)||Ue.endsWith(f,"[]"))&&(v=Ue.toArray(h)))return f=y7(f),v.forEach(function(y,b){!(Ue.isUndefined(y)||y===null)&&e.append(o===!0?M2([f],b,a):o===null?f:f+"[]",c(y))}),!1}return j1(h)?!0:(e.append(M2(g,f,a),c(h)),!1)}const d=[],p=Object.assign(dIe,{defaultVisitor:u,convertValue:c,isVisitable:j1});function m(h,f){if(!Ue.isUndefined(h)){if(d.indexOf(h)!==-1)throw Error("Circular reference detected in "+f.join("."));d.push(h),Ue.forEach(h,function(v,I){(!(Ue.isUndefined(v)||v===null)&&n.call(e,v,Ue.isString(I)?I.trim():I,f,p))===!0&&m(v,f?f.concat(I):[I])}),d.pop()}}if(!Ue.isObject(t))throw new TypeError("data must be an object");return m(t),e}function N2(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(r){return e[r]})}function Mx(t,e){this._pairs=[],t&&uP(t,this,e)}const b7=Mx.prototype;b7.append=function(e,i){this._pairs.push([e,i])};b7.toString=function(e){const i=e?function(r){return e.call(this,r,N2)}:N2;return this._pairs.map(function(n){return i(n[0])+"="+i(n[1])},"").join("&")};function pIe(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function w7(t,e,i){if(!e)return t;const r=i&&i.encode||pIe,n=i&&i.serialize;let a;if(n?a=n(e,i):a=Ue.isURLSearchParams(e)?e.toString():new Mx(e,i).toString(r),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class A2{constructor(){this.handlers=[]}use(e,i,r){return this.handlers.push({fulfilled:e,rejected:i,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Ue.forEach(this.handlers,function(r){r!==null&&e(r)})}}const U7={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},mIe=typeof URLSearchParams<"u"?URLSearchParams:Mx,hIe=typeof FormData<"u"?FormData:null,fIe=typeof Blob<"u"?Blob:null,gIe={isBrowser:!0,classes:{URLSearchParams:mIe,FormData:hIe,Blob:fIe},protocols:["http","https","file","blob","url","data"]},S7=typeof window<"u"&&typeof document<"u",vIe=(t=>S7&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),IIe=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",yIe=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:S7,hasStandardBrowserEnv:vIe,hasStandardBrowserWebWorkerEnv:IIe},Symbol.toStringTag,{value:"Module"})),au={...yIe,...gIe};function bIe(t,e){return uP(t,new au.classes.URLSearchParams,Object.assign({visitor:function(i,r,n,a){return au.isNode&&Ue.isBuffer(i)?(this.append(r,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function wIe(t){return Ue.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function UIe(t){const e={},i=Object.keys(t);let r;const n=i.length;let a;for(r=0;r<n;r++)a=i[r],e[a]=t[a];return e}function T7(t){function e(i,r,n,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&Ue.isArray(n)?n.length:o,l?(Ue.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r,!s):((!n[o]||!Ue.isObject(n[o]))&&(n[o]=[]),e(i,r,n[o],a)&&Ue.isArray(n[o])&&(n[o]=UIe(n[o])),!s)}if(Ue.isFormData(t)&&Ue.isFunction(t.entries)){const i={};return Ue.forEachEntry(t,(r,n)=>{e(wIe(r),n,i,0)}),i}return null}function SIe(t,e,i){if(Ue.isString(t))try{return(e||JSON.parse)(t),Ue.trim(t)}catch(r){if(r.name!=="SyntaxError")throw r}return(i||JSON.stringify)(t)}const Nx={transitional:U7,adapter:["xhr","http"],transformRequest:[function(e,i){const r=i.getContentType()||"",n=r.indexOf("application/json")>-1,a=Ue.isObject(e);if(a&&Ue.isHTMLForm(e)&&(e=new FormData(e)),Ue.isFormData(e))return n?JSON.stringify(T7(e)):e;if(Ue.isArrayBuffer(e)||Ue.isBuffer(e)||Ue.isStream(e)||Ue.isFile(e)||Ue.isBlob(e))return e;if(Ue.isArrayBufferView(e))return e.buffer;if(Ue.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(r.indexOf("application/x-www-form-urlencoded")>-1)return bIe(e,this.formSerializer).toString();if((s=Ue.isFileList(e))||r.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return uP(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||n?(i.setContentType("application/json",!1),SIe(e)):e}],transformResponse:[function(e){const i=this.transitional||Nx.transitional,r=i&&i.forcedJSONParsing,n=this.responseType==="json";if(e&&Ue.isString(e)&&(r&&!this.responseType||n)){const o=!(i&&i.silentJSONParsing)&&n;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?Pi.from(s,Pi.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:au.classes.FormData,Blob:au.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Ue.forEach(["delete","get","head","post","put","patch"],t=>{Nx.headers[t]={}});const Ax=Nx,TIe=Ue.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),DIe=t=>{const e={};let i,r,n;return t&&t.split(`
`).forEach(function(o){n=o.indexOf(":"),i=o.substring(0,n).trim().toLowerCase(),r=o.substring(n+1).trim(),!(!i||e[i]&&TIe[i])&&(i==="set-cookie"?e[i]?e[i].push(r):e[i]=[r]:e[i]=e[i]?e[i]+", "+r:r)}),e},O2=Symbol("internals");function $v(t){return t&&String(t).trim().toLowerCase()}function cS(t){return t===!1||t==null?t:Ue.isArray(t)?t.map(cS):String(t)}function PIe(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=i.exec(t);)e[r[1]]=r[2];return e}const RIe=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ME(t,e,i,r,n){if(Ue.isFunction(r))return r.call(this,e,i);if(n&&(e=i),!!Ue.isString(e)){if(Ue.isString(r))return e.indexOf(r)!==-1;if(Ue.isRegExp(r))return r.test(e)}}function EIe(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,r)=>i.toUpperCase()+r)}function CIe(t,e){const i=Ue.toCamelCase(" "+e);["get","set","has"].forEach(r=>{Object.defineProperty(t,r+i,{value:function(n,a,o){return this[r].call(this,e,n,a,o)},configurable:!0})})}class cP{constructor(e){e&&this.set(e)}set(e,i,r){const n=this;function a(s,l,c){const u=$v(l);if(!u)throw new Error("header name must be a non-empty string");const d=Ue.findKey(n,u);(!d||n[d]===void 0||c===!0||c===void 0&&n[d]!==!1)&&(n[d||l]=cS(s))}const o=(s,l)=>Ue.forEach(s,(c,u)=>a(c,u,l));return Ue.isPlainObject(e)||e instanceof this.constructor?o(e,i):Ue.isString(e)&&(e=e.trim())&&!RIe(e)?o(DIe(e),i):e!=null&&a(i,e,r),this}get(e,i){if(e=$v(e),e){const r=Ue.findKey(this,e);if(r){const n=this[r];if(!i)return n;if(i===!0)return PIe(n);if(Ue.isFunction(i))return i.call(this,n,r);if(Ue.isRegExp(i))return i.exec(n);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=$v(e),e){const r=Ue.findKey(this,e);return!!(r&&this[r]!==void 0&&(!i||ME(this,this[r],r,i)))}return!1}delete(e,i){const r=this;let n=!1;function a(o){if(o=$v(o),o){const s=Ue.findKey(r,o);s&&(!i||ME(r,r[s],s,i))&&(delete r[s],n=!0)}}return Ue.isArray(e)?e.forEach(a):a(e),n}clear(e){const i=Object.keys(this);let r=i.length,n=!1;for(;r--;){const a=i[r];(!e||ME(this,this[a],a,e,!0))&&(delete this[a],n=!0)}return n}normalize(e){const i=this,r={};return Ue.forEach(this,(n,a)=>{const o=Ue.findKey(r,a);if(o){i[o]=cS(n),delete i[a];return}const s=e?EIe(a):String(a).trim();s!==a&&delete i[a],i[s]=cS(n),r[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Ue.forEach(this,(r,n)=>{r!=null&&r!==!1&&(i[n]=e&&Ue.isArray(r)?r.join(", "):r)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const r=new this(e);return i.forEach(n=>r.set(n)),r}static accessor(e){const r=(this[O2]=this[O2]={accessors:{}}).accessors,n=this.prototype;function a(o){const s=$v(o);r[s]||(CIe(n,o),r[s]=!0)}return Ue.isArray(e)?e.forEach(a):a(e),this}}cP.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Ue.reduceDescriptors(cP.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(r){this[i]=r}}});Ue.freezeMethods(cP);const yc=cP;function NE(t,e){const i=this||Ax,r=e||i,n=yc.from(r.headers);let a=r.data;return Ue.forEach(t,function(s){a=s.call(i,a,n.normalize(),e?e.status:void 0)}),n.normalize(),a}function D7(t){return!!(t&&t.__CANCEL__)}function Hb(t,e,i){Pi.call(this,t??"canceled",Pi.ERR_CANCELED,e,i),this.name="CanceledError"}Ue.inherits(Hb,Pi,{__CANCEL__:!0});function MIe(t,e,i){const r=i.config.validateStatus;!i.status||!r||r(i.status)?t(i):e(new Pi("Request failed with status code "+i.status,[Pi.ERR_BAD_REQUEST,Pi.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const NIe=au.hasStandardBrowserEnv?{write(t,e,i,r,n,a){const o=[t+"="+encodeURIComponent(e)];Ue.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),Ue.isString(r)&&o.push("path="+r),Ue.isString(n)&&o.push("domain="+n),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function AIe(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function OIe(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function P7(t,e){return t&&!AIe(e)?OIe(t,e):e}const kIe=au.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let r;function n(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return r=n(window.location.href),function(o){const s=Ue.isString(o)?n(o):o;return s.protocol===r.protocol&&s.host===r.host}}():function(){return function(){return!0}}();function xIe(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function FIe(t,e){t=t||10;const i=new Array(t),r=new Array(t);let n=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=r[a];o||(o=c),i[n]=l,r[n]=c;let d=a,p=0;for(;d!==n;)p+=i[d++],d=d%t;if(n=(n+1)%t,n===a&&(a=(a+1)%t),c-o<e)return;const m=u&&c-u;return m?Math.round(p*1e3/m):void 0}}function k2(t,e){let i=0;const r=FIe(50,250);return n=>{const a=n.loaded,o=n.lengthComputable?n.total:void 0,s=a-i,l=r(s),c=a<=o;i=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:l||void 0,estimated:l&&o&&c?(o-a)/l:void 0,event:n};u[e?"download":"upload"]=!0,t(u)}}const LIe=typeof XMLHttpRequest<"u",_Ie=LIe&&function(t){return new Promise(function(i,r){let n=t.data;const a=yc.from(t.headers).normalize();let{responseType:o,withXSRFToken:s}=t,l;function c(){t.cancelToken&&t.cancelToken.unsubscribe(l),t.signal&&t.signal.removeEventListener("abort",l)}let u;if(Ue.isFormData(n)){if(au.hasStandardBrowserEnv||au.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((u=a.getContentType())!==!1){const[f,...g]=u?u.split(";").map(v=>v.trim()).filter(Boolean):[];a.setContentType([f||"multipart/form-data",...g].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const f=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";a.set("Authorization","Basic "+btoa(f+":"+g))}const p=P7(t.baseURL,t.url);d.open(t.method.toUpperCase(),w7(p,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function m(){if(!d)return;const f=yc.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),v={data:!o||o==="text"||o==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:f,config:t,request:d};MIe(function(y){i(y),c()},function(y){r(y),c()},v),d=null}if("onloadend"in d?d.onloadend=m:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(m)},d.onabort=function(){d&&(r(new Pi("Request aborted",Pi.ECONNABORTED,t,d)),d=null)},d.onerror=function(){r(new Pi("Network Error",Pi.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const v=t.transitional||U7;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),r(new Pi(g,v.clarifyTimeoutError?Pi.ETIMEDOUT:Pi.ECONNABORTED,t,d)),d=null},au.hasStandardBrowserEnv&&(s&&Ue.isFunction(s)&&(s=s(t)),s||s!==!1&&kIe(p))){const f=t.xsrfHeaderName&&t.xsrfCookieName&&NIe.read(t.xsrfCookieName);f&&a.set(t.xsrfHeaderName,f)}n===void 0&&a.setContentType(null),"setRequestHeader"in d&&Ue.forEach(a.toJSON(),function(g,v){d.setRequestHeader(v,g)}),Ue.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),o&&o!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",k2(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",k2(t.onUploadProgress)),(t.cancelToken||t.signal)&&(l=f=>{d&&(r(!f||f.type?new Hb(null,t,d):f),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(l),t.signal&&(t.signal.aborted?l():t.signal.addEventListener("abort",l)));const h=xIe(p);if(h&&au.protocols.indexOf(h)===-1){r(new Pi("Unsupported protocol "+h+":",Pi.ERR_BAD_REQUEST,t));return}d.send(n||null)})},G1={http:uIe,xhr:_Ie};Ue.forEach(G1,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const x2=t=>`- ${t}`,$Ie=t=>Ue.isFunction(t)||t===null||t===!1,R7={getAdapter:t=>{t=Ue.isArray(t)?t:[t];const{length:e}=t;let i,r;const n={};for(let a=0;a<e;a++){i=t[a];let o;if(r=i,!$Ie(i)&&(r=G1[(o=String(i)).toLowerCase()],r===void 0))throw new Pi(`Unknown adapter '${o}'`);if(r)break;n[o||"#"+a]=r}if(!r){const a=Object.entries(n).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(x2).join(`
`):" "+x2(a[0]):"as no adapter specified";throw new Pi("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return r},adapters:G1};function AE(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new Hb(null,t)}function F2(t){return AE(t),t.headers=yc.from(t.headers),t.data=NE.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),R7.getAdapter(t.adapter||Ax.adapter)(t).then(function(r){return AE(t),r.data=NE.call(t,t.transformResponse,r),r.headers=yc.from(r.headers),r},function(r){return D7(r)||(AE(t),r&&r.response&&(r.response.data=NE.call(t,t.transformResponse,r.response),r.response.headers=yc.from(r.response.headers))),Promise.reject(r)})}const L2=t=>t instanceof yc?{...t}:t;function jf(t,e){e=e||{};const i={};function r(c,u,d){return Ue.isPlainObject(c)&&Ue.isPlainObject(u)?Ue.merge.call({caseless:d},c,u):Ue.isPlainObject(u)?Ue.merge({},u):Ue.isArray(u)?u.slice():u}function n(c,u,d){if(Ue.isUndefined(u)){if(!Ue.isUndefined(c))return r(void 0,c,d)}else return r(c,u,d)}function a(c,u){if(!Ue.isUndefined(u))return r(void 0,u)}function o(c,u){if(Ue.isUndefined(u)){if(!Ue.isUndefined(c))return r(void 0,c)}else return r(void 0,u)}function s(c,u,d){if(d in e)return r(c,u);if(d in t)return r(void 0,c)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(c,u)=>n(L2(c),L2(u),!0)};return Ue.forEach(Object.keys(Object.assign({},t,e)),function(u){const d=l[u]||n,p=d(t[u],e[u],u);Ue.isUndefined(p)&&d!==s||(i[u]=p)}),i}const E7="1.6.8",Ox={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{Ox[t]=function(r){return typeof r===t||"a"+(e<1?"n ":" ")+t}});const _2={};Ox.transitional=function(e,i,r){function n(a,o){return"[Axios v"+E7+"] Transitional option '"+a+"'"+o+(r?". "+r:"")}return(a,o,s)=>{if(e===!1)throw new Pi(n(o," has been removed"+(i?" in "+i:"")),Pi.ERR_DEPRECATED);return i&&!_2[o]&&(_2[o]=!0,console.warn(n(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function BIe(t,e,i){if(typeof t!="object")throw new Pi("options must be an object",Pi.ERR_BAD_OPTION_VALUE);const r=Object.keys(t);let n=r.length;for(;n-- >0;){const a=r[n],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new Pi("option "+a+" must be "+l,Pi.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Pi("Unknown option "+a,Pi.ERR_BAD_OPTION)}}const H1={assertOptions:BIe,validators:Ox},pd=H1.validators;class h0{constructor(e){this.defaults=e,this.interceptors={request:new A2,response:new A2}}async request(e,i){try{return await this._request(e,i)}catch(r){if(r instanceof Error){let n;Error.captureStackTrace?Error.captureStackTrace(n={}):n=new Error;const a=n.stack?n.stack.replace(/^.+\n/,""):"";r.stack?a&&!String(r.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+a):r.stack=a}throw r}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=jf(this.defaults,i);const{transitional:r,paramsSerializer:n,headers:a}=i;r!==void 0&&H1.assertOptions(r,{silentJSONParsing:pd.transitional(pd.boolean),forcedJSONParsing:pd.transitional(pd.boolean),clarifyTimeoutError:pd.transitional(pd.boolean)},!1),n!=null&&(Ue.isFunction(n)?i.paramsSerializer={serialize:n}:H1.assertOptions(n,{encode:pd.function,serialize:pd.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&Ue.merge(a.common,a[i.method]);a&&Ue.forEach(["delete","get","head","post","put","patch","common"],h=>{delete a[h]}),i.headers=yc.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(f){typeof f.runWhen=="function"&&f.runWhen(i)===!1||(l=l&&f.synchronous,s.unshift(f.fulfilled,f.rejected))});const c=[];this.interceptors.response.forEach(function(f){c.push(f.fulfilled,f.rejected)});let u,d=0,p;if(!l){const h=[F2.bind(this),void 0];for(h.unshift.apply(h,s),h.push.apply(h,c),p=h.length,u=Promise.resolve(i);d<p;)u=u.then(h[d++],h[d++]);return u}p=s.length;let m=i;for(d=0;d<p;){const h=s[d++],f=s[d++];try{m=h(m)}catch(g){f.call(this,g);break}}try{u=F2.call(this,m)}catch(h){return Promise.reject(h)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=jf(this.defaults,e);const i=P7(e.baseURL,e.url);return w7(i,e.params,e.paramsSerializer)}}Ue.forEach(["delete","get","head","options"],function(e){h0.prototype[e]=function(i,r){return this.request(jf(r||{},{method:e,url:i,data:(r||{}).data}))}});Ue.forEach(["post","put","patch"],function(e){function i(r){return function(a,o,s){return this.request(jf(s||{},{method:e,headers:r?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}h0.prototype[e]=i(),h0.prototype[e+"Form"]=i(!0)});const dS=h0;class kx{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const r=this;this.promise.then(n=>{if(!r._listeners)return;let a=r._listeners.length;for(;a-- >0;)r._listeners[a](n);r._listeners=null}),this.promise.then=n=>{let a;const o=new Promise(s=>{r.subscribe(s),a=s}).then(n);return o.cancel=function(){r.unsubscribe(a)},o},e(function(a,o,s){r.reason||(r.reason=new Hb(a,o,s),i(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new kx(function(n){e=n}),cancel:e}}}const VIe=kx;function jIe(t){return function(i){return t.apply(null,i)}}function GIe(t){return Ue.isObject(t)&&t.isAxiosError===!0}const z1={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(z1).forEach(([t,e])=>{z1[e]=t});const HIe=z1;function C7(t){const e=new dS(t),i=u7(dS.prototype.request,e);return Ue.extend(i,dS.prototype,e,{allOwnKeys:!0}),Ue.extend(i,e,null,{allOwnKeys:!0}),i.create=function(n){return C7(jf(t,n))},i}const Sn=C7(Ax);Sn.Axios=dS;Sn.CanceledError=Hb;Sn.CancelToken=VIe;Sn.isCancel=D7;Sn.VERSION=E7;Sn.toFormData=uP;Sn.AxiosError=Pi;Sn.Cancel=Sn.CanceledError;Sn.all=function(e){return Promise.all(e)};Sn.spread=jIe;Sn.isAxiosError=GIe;Sn.mergeConfig=jf;Sn.AxiosHeaders=yc;Sn.formToJSON=t=>T7(Ue.isHTMLForm(t)?new FormData(t):t);Sn.getAdapter=R7.getAdapter;Sn.HttpStatusCode=HIe;Sn.default=Sn;const M7=Eve();window.location.host.includes("localhost")||window.location.hostname;var Lj;const zIe=((Lj=window.dev)==null?void 0:Lj.baseURL)||"http://localhost:3123",zb=Sn.create({baseURL:zIe});zb.interceptors.request.use(t=>{const e=localStorage.getItem(M7);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));zb.interceptors.response.use(t=>t,t=>{var e;if(t.message==="Network Error"&&console.log("network error"),t.response){((e=t.response)==null?void 0:e.status)===401&&N7();const i=t.response.data.message||t.response.data.error||t.response.data;console.log({message:i})}});const WIe=()=>{const t=localStorage.getItem(M7);zb.defaults.headers.common.Authorization=`Bearer ${t}`},N7=()=>{zb.defaults.headers.common.Authorization=void 0},Qg={...zb,addAuthorization:WIe,removeAuthorization:N7},xx="Missing tournamentId";async function A7(t){if(!(t!=null&&t.tournamentId))throw new Error(xx);return await Qg.post("/factory/tournamentinfo",t)}async function W1({providerAbbr:t}){if(!t)throw new Error("missing provicerAbbr");return await Qg.post("/provider/calendar",{providerAbbr:t})}async function O7(t){if(!(t!=null&&t.tournamentId))throw new Error(xx);if(!(t!=null&&t.eventId))throw new Error("missing eventId");return await Qg.post("/factory/eventdata",t)}async function qIe(t){if(!(t!=null&&t.tournamentId))throw new Error(xx);return Object.assign(t,{courtCompletedMatchUps:!0,withCourtGridRows:!0,usePublishState:!0,minCourtGridRows:10,nextMatchUps:!0}),await Qg.post("/factory/scheduledmatchUps",{params:t})}async function YIe(){return await Qg.get("/factory/version")}function iI(t){return`tournament_${t.toLowerCase()}`}function Fx(t){return`tab_tournament_${t.toLowerCase()}`}const Am={},q1=["Info","Events","Schedule","Matches","Players","Stats"];function Y1(t){t==="Schedule"&&qIe({tournamentId:Am.tournamentId}).then(e=>{const i=e==null?void 0:e.data;Rve({data:i})}),Am.tab=t,q1.forEach(e=>{const i=document.getElementById(iI(e));i.style.display=e===t?"block":"none"})}function OE(t){const e=document.getElementById(Fx(t));e.style.display="block"}function kE(t){const e=document.getElementById(Fx(t));e.style.display=As}const KIe=()=>{const t=document.createElement("div");t.className="container";const e=document.createElement("section");e.className="hero";const i=document.createElement("div");i.className="hero-body",i.id="tournament-hero";const r=document.createElement("div");r.className="columns";const n=document.createElement("div");n.className="column is-one-quarter has-text-centered",n.id=Bj,r.appendChild(n);const a=document.createElement("div");a.className="column has-text-centered",a.id=_j,r.appendChild(a),i.appendChild(r),e.appendChild(i),t.appendChild(e);const o=document.createElement("div"),s=document.createElement("div");t.appendChild(o),t.appendChild(s),q1.forEach(c=>{const u=document.createElement("section");u.className="section is-fluid is-centered",u.style.display="none",u.style.width="100%",u.id=iI(c),s.appendChild(u)}),o.className="tabs is-centered";const l=document.createElement("ul");return q1.forEach(c=>{const u=document.createElement("li");u.id=Fx(c),u.style.display="none",u.className="menu";const d=document.createElement("a");d.textContent=c,d.onclick=()=>Y1(c),u.appendChild(d),l.appendChild(u)}),o.appendChild(l),t};function JIe(){const t=document.createElement("div");t.className="main noselect";const e=document.createElement("nav");e.className="navbar";const i=document.createElement("div");i.className="navbar-brand";const r=document.createElement("div");r.onclick=()=>window.history.back(),r.className="navbar-item",r.innerHTML="<<",r.id="back",i.appendChild(r),e.appendChild(i),t.appendChild(e);const n=document.createElement("div");n.style.display="none",n.id=Ty;const a=document.createElement("div");a.style.display="none",a.id=sN;const o=document.createElement("div");o.className="controlBar flexcol flexgrow flexcenter",o.id=$j,a.appendChild(o);const s=document.createElement("div");s.className="flexcol flexgrow flexcenter box",s.id=uC,a.appendChild(s);const l=document.createElement("div");return l.style.backgroundColor="white",l.style.display="none",l.id=iT,l.appendChild(KIe()),t.appendChild(a),t.appendChild(l),t.appendChild(n),t}function pS(t){bre.forEach(e=>{const i=document.querySelector(`#${e}`);i&&(i.style.display=e===t?"block":"none")})}function XIe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=i=>r=>i(r).then(n=>console.log(n.data),n=>console.log(n));ZIe({...{getServerFactoryVersion:i=>t(YIe)(i),getProviderCalendar:i=>t(W1)(i),getTournamentInfo:i=>t(A7)(i),getEventData:i=>t(O7(i))},baseApi:Qg,context:Am})}function ZIe(t){if(typeof(window==null?void 0:window.dev)=="object")try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function QIe(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.onunhandledrejection=t=>{t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?console.warn("popup blocked"):console.warn("Unhandled rejection:",e&&(e.stack||e))}}const eye="@VERSION@",xE=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function FE(t,e,i,r){t.addEventListener?t.addEventListener(e,i,r):t.attachEvent&&t.attachEvent("on".concat(e),i)}function Bv(t,e,i,r){t.removeEventListener?t.removeEventListener(e,i,r):t.detachEvent&&t.detachEvent("on".concat(e),i)}function k7(t,e){const i=e.slice(0,e.length-1);for(let r=0;r<i.length;r++)i[r]=t[i[r].toLowerCase()];return i}function x7(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function tye(t,e){const i=t.length>=e.length?t:e,r=t.length>=e.length?e:t;let n=!0;for(let a=0;a<i.length;a++)r.indexOf(i[a])===-1&&(n=!1);return n}const YI={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":xE?173:189,"=":xE?61:187,";":xE?59:186,"'":222,"[":219,"]":221,"\\":220},Tu={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},K1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Jn={16:!1,18:!1,17:!1,91:!1},jr={};for(let t=1;t<20;t++)YI["f".concat(t)]=111+t;let Ir=[],rI=null,F7="all";const dc=new Map,Wb=t=>YI[t.toLowerCase()]||Tu[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),iye=t=>Object.keys(YI).find(e=>YI[e]===t),rye=t=>Object.keys(Tu).find(e=>Tu[e]===t);function L7(t){F7=t||"all"}function KI(){return F7||"all"}function nye(){return Ir.slice(0)}function aye(){return Ir.map(t=>iye(t)||rye(t)||String.fromCharCode(t))}function oye(){const t=[];return Object.keys(jr).forEach(e=>{jr[e].forEach(i=>{let{key:r,scope:n,mods:a,shortcut:o}=i;t.push({scope:n,shortcut:o,mods:a,keys:r.split("+").map(s=>Wb(s))})})}),t}function sye(t){const e=t.target||t.srcElement,{tagName:i}=e;let r=!0;const n=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(n||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(r=!1),r}function lye(t){return typeof t=="string"&&(t=Wb(t)),Ir.indexOf(t)!==-1}function uye(t,e){let i,r;t||(t=KI());for(const n in jr)if(Object.prototype.hasOwnProperty.call(jr,n))for(i=jr[n],r=0;r<i.length;)i[r].scope===t?i.splice(r,1).forEach(o=>{let{element:s}=o;return Lx(s)}):r++;KI()===t&&L7(e||"all")}function cye(t){let e=t.keyCode||t.which||t.charCode;const i=Ir.indexOf(e);if(i>=0&&Ir.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Ir.splice(0,Ir.length),(e===93||e===224)&&(e=91),e in Jn){Jn[e]=!1;for(const r in Tu)Tu[r]===e&&(ou[r]=!1)}}function _7(t){if(typeof t>"u")Object.keys(jr).forEach(n=>{Array.isArray(jr[n])&&jr[n].forEach(a=>LU(a)),delete jr[n]}),Lx(null);else if(Array.isArray(t))t.forEach(n=>{n.key&&LU(n)});else if(typeof t=="object")t.key&&LU(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),r=1;r<e;r++)i[r-1]=arguments[r];let[n,a]=i;typeof n=="function"&&(a=n,n=""),LU({key:t,scope:n,method:a,splitKey:"+"})}}const LU=t=>{let{key:e,scope:i,method:r,splitKey:n="+"}=t;x7(e).forEach(o=>{const s=o.split(n),l=s.length,c=s[l-1],u=c==="*"?"*":Wb(c);if(!jr[u])return;i||(i=KI());const d=l>1?k7(Tu,s):[],p=[];jr[u]=jr[u].filter(m=>{const f=(r?m.method===r:!0)&&m.scope===i&&tye(m.mods,d);return f&&p.push(m.element),!f}),p.forEach(m=>Lx(m))})};function $2(t,e,i,r){if(e.element!==r)return;let n;if(e.scope===i||e.scope==="all"){n=e.mods.length>0;for(const a in Jn)Object.prototype.hasOwnProperty.call(Jn,a)&&(!Jn[a]&&e.mods.indexOf(+a)>-1||Jn[a]&&e.mods.indexOf(+a)===-1)&&(n=!1);(e.mods.length===0&&!Jn[16]&&!Jn[18]&&!Jn[17]&&!Jn[91]||n||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Ir),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function B2(t,e){const i=jr["*"];let r=t.keyCode||t.which||t.charCode;if(!ou.filter.call(this,t))return;if((r===93||r===224)&&(r=91),Ir.indexOf(r)===-1&&r!==229&&Ir.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=K1[s];t[s]&&Ir.indexOf(l)===-1?Ir.push(l):!t[s]&&Ir.indexOf(l)>-1?Ir.splice(Ir.indexOf(l),1):s==="metaKey"&&t[s]&&Ir.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Ir=Ir.slice(Ir.indexOf(l))))}),r in Jn){Jn[r]=!0;for(const s in Tu)Tu[s]===r&&(ou[s]=!0);if(!i)return}for(const s in Jn)Object.prototype.hasOwnProperty.call(Jn,s)&&(Jn[s]=t[K1[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Ir.indexOf(17)===-1&&Ir.push(17),Ir.indexOf(18)===-1&&Ir.push(18),Jn[17]=!0,Jn[18]=!0);const n=KI();if(i)for(let s=0;s<i.length;s++)i[s].scope===n&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&$2(t,i[s],n,e);if(!(r in jr))return;const a=jr[r],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(Wb(u[p]));d.sort().join("")===Ir.sort().join("")&&$2(t,l,n,e)}}function ou(t,e,i){Ir=[];const r=x7(t);let n=[],a="all",o=document,s=0,l=!1,c=!0,u="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&_7(t,a);s<r.length;s++)t=r[s].split(u),n=[],t.length>1&&(n=k7(Tu,t)),t=t[t.length-1],t=t==="*"?"*":Wb(t),t in jr||(jr[t]=[]),jr[t].push({keyup:l,keydown:c,scope:a,mods:n,shortcut:r[s],method:i,key:r[s],splitKey:u,element:o});if(typeof o<"u"&&window){if(!dc.has(o)){const m=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return B2(f,o)},h=function(){let f=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;B2(f,o),cye(f)};dc.set(o,{keydownListener:m,keyupListenr:h,capture:d}),FE(o,"keydown",m,d),FE(o,"keyup",h,d)}if(!rI){const m=()=>{Ir=[]};rI={listener:m,capture:d},FE(window,"focus",m,d)}}}function dye(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(jr).forEach(i=>{jr[i].filter(n=>n.scope===e&&n.shortcut===t).forEach(n=>{n&&n.method&&n.method()})})}function Lx(t){const e=Object.values(jr).flat();if(e.findIndex(r=>{let{element:n}=r;return n===t})<0){const{keydownListener:r,keyupListenr:n,capture:a}=dc.get(t)||{};r&&n&&(Bv(t,"keyup",n,a),Bv(t,"keydown",r,a),dc.delete(t))}if((e.length<=0||dc.size<=0)&&(Object.keys(dc).forEach(n=>{const{keydownListener:a,keyupListenr:o,capture:s}=dc.get(n)||{};a&&o&&(Bv(n,"keyup",o,s),Bv(n,"keydown",a,s),dc.delete(n))}),dc.clear(),Object.keys(jr).forEach(n=>delete jr[n]),rI)){const{listener:n,capture:a}=rI;Bv(window,"focus",n,a),rI=null}}const LE={getPressedKeyString:aye,setScope:L7,getScope:KI,deleteScope:uye,getPressedKeyCodes:nye,getAllKeyCodes:oye,isPressed:lye,filter:sye,trigger:dye,unbind:_7,keyMap:YI,modifier:Tu,modifierMap:K1};for(const t in LE)Object.prototype.hasOwnProperty.call(LE,t)&&(ou[t]=LE[t]);if(typeof window<"u"){const t=window.hotkeys;ou.noConflict=e=>(e&&window.hotkeys===ou&&(window.hotkeys=t),ou),window.hotkeys=ou}const _U=[];function pye(){console.log(`%cversion: ${eye}`,"color: lightblue"),ou("shift+1,shift+3,esc,/",(t,e)=>{t.preventDefault();const r=ou.shift?e.key.split(e.splitKey)[1]:e.key;r==="/"&&_U.splice(0,_U.length),_U.push(r),_U.join("")==="esc13"&&XIe()}),pS(Ty),QIe()}const mye=t=>{let e;const i=Array.isArray(t)?t:[t];return r=>{if(e&&i.forEach(n=>n.removeFilter(e)),r){const n=r==null?void 0:r.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(n)},i.forEach(a=>a.addFilter(e))}else e=void 0}},$7=t=>(e,i)=>{const r=e.getDefinition();return t.includes(r.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"};function hye(t,e,i,r){const n=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${n})</span>`}function fye(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}var V2,rr="colors",Va="sizes",tt="space",gye={gap:tt,gridGap:tt,columnGap:tt,gridColumnGap:tt,rowGap:tt,gridRowGap:tt,inset:tt,insetBlock:tt,insetBlockEnd:tt,insetBlockStart:tt,insetInline:tt,insetInlineEnd:tt,insetInlineStart:tt,margin:tt,marginTop:tt,marginRight:tt,marginBottom:tt,marginLeft:tt,marginBlock:tt,marginBlockEnd:tt,marginBlockStart:tt,marginInline:tt,marginInlineEnd:tt,marginInlineStart:tt,padding:tt,paddingTop:tt,paddingRight:tt,paddingBottom:tt,paddingLeft:tt,paddingBlock:tt,paddingBlockEnd:tt,paddingBlockStart:tt,paddingInline:tt,paddingInlineEnd:tt,paddingInlineStart:tt,top:tt,right:tt,bottom:tt,left:tt,scrollMargin:tt,scrollMarginTop:tt,scrollMarginRight:tt,scrollMarginBottom:tt,scrollMarginLeft:tt,scrollMarginX:tt,scrollMarginY:tt,scrollMarginBlock:tt,scrollMarginBlockEnd:tt,scrollMarginBlockStart:tt,scrollMarginInline:tt,scrollMarginInlineEnd:tt,scrollMarginInlineStart:tt,scrollPadding:tt,scrollPaddingTop:tt,scrollPaddingRight:tt,scrollPaddingBottom:tt,scrollPaddingLeft:tt,scrollPaddingX:tt,scrollPaddingY:tt,scrollPaddingBlock:tt,scrollPaddingBlockEnd:tt,scrollPaddingBlockStart:tt,scrollPaddingInline:tt,scrollPaddingInlineEnd:tt,scrollPaddingInlineStart:tt,fontSize:"fontSizes",background:rr,backgroundColor:rr,backgroundImage:rr,borderImage:rr,border:rr,borderBlock:rr,borderBlockEnd:rr,borderBlockStart:rr,borderBottom:rr,borderBottomColor:rr,borderColor:rr,borderInline:rr,borderInlineEnd:rr,borderInlineStart:rr,borderLeft:rr,borderLeftColor:rr,borderRight:rr,borderRightColor:rr,borderTop:rr,borderTopColor:rr,caretColor:rr,color:rr,columnRuleColor:rr,fill:rr,outline:rr,outlineColor:rr,stroke:rr,textDecorationColor:rr,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Va,minBlockSize:Va,maxBlockSize:Va,inlineSize:Va,minInlineSize:Va,maxInlineSize:Va,width:Va,minWidth:Va,maxWidth:Va,height:Va,minHeight:Va,maxHeight:Va,flexBasis:Va,gridTemplateColumns:Va,gridTemplateRows:Va,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},vye=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,qb=()=>{const t=Object.create(null);return(e,i,...r)=>{const n=(a=>JSON.stringify(a,vye))(e);return n in t?t[n]:t[n]=i(e,...r)}},mS=Symbol.for("sxs.internal"),_x=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),j2=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:Iye}=Object.prototype,J1=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),yye=/\s+(?![^()]*\))/,Jh=t=>e=>t(...typeof e=="string"?String(e).split(yye):[e]),G2={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:Jh((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:Jh((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:Jh((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:Jh((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:Jh((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:Jh((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},_E=/([\d.]+)([^]*)/,bye=(t,e)=>t.length?t.reduce((i,r)=>(i.push(...e.map(n=>n.includes("&")?n.replace(/&/g,/[ +>|~]/.test(r)&&/&.*&/.test(n)?`:is(${r})`:r):r+" "+n)),i),[]):e,wye=(t,e)=>t in Uye&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,r,n,a)=>r+(n==="stretch"?`-moz-available${a};${J1(t)}:${r}-webkit-fill-available`:`-moz-fit-content${a};${J1(t)}:${r}fit-content`)+a):String(e),Uye={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Nc=t=>t?t+"-":"",B7=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(r,n,a,o,s)=>o=="$"==!!a?r:(n||o=="--"?"calc(":"")+"var(--"+(o==="$"?Nc(e)+(s.includes("$")?"":Nc(i))+s.replace(/\$/g,"-"):s)+")"+(n||o=="--"?"*"+(n||"")+(a||"1")+")":"")),Sye=/\s*,\s*(?![^()]*\))/,Tye=Object.prototype.toString,sf=(t,e,i,r,n)=>{let a,o,s;const l=(c,u,d)=>{let p,m;const h=f=>{for(p in f){const I=p.charCodeAt(0)===64,y=I&&Array.isArray(f[p])?f[p]:[f[p]];for(m of y){const b=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),S=typeof m=="object"&&m&&m.toString===Tye&&(!r.utils[b]||!u.length);if(b in r.utils&&!S){const w=r.utils[b];if(w!==o){o=w,h(w(m)),o=null;continue}}else if(b in G2){const w=G2[b];if(w!==s){s=w,h(w(m)),s=null;continue}}if(I&&(g=p.slice(1)in r.media?"@media "+r.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,U,T,P,R,D)=>{const E=_E.test(U),N=.0625*(E?-1:1),[A,M]=E?[P,U]:[U,P];return"("+(T[0]==="="?"":T[0]===">"===E?"max-":"min-")+A+":"+(T[0]!=="="&&T.length===1?M.replace(_E,(C,O,k)=>Number(O)+N*(T===">"?1:-1)+k):M)+(R?") and ("+(R[0]===">"?"min-":"max-")+A+":"+(R.length===1?D.replace(_E,(C,O,k)=>Number(O)+N*(R===">"?-1:1)+k):D):"")+")"})),S){const w=I?d.concat(p):[...d],U=I?[...u]:bye(u,p.split(Sye));a!==void 0&&n(H2(...a)),a=void 0,l(m,U,w)}else a===void 0&&(a=[[],u,d]),p=I||p.charCodeAt(0)!==36?p:`--${Nc(r.prefix)}${p.slice(1).replace(/\$/g,"-")}`,m=S?m:typeof m=="number"?m&&b in Dye?String(m)+"px":String(m):B7(wye(b,m??""),r.prefix,r.themeMap[b]),a[0].push(`${I?`${p} `:`${J1(p)}:`}${m}`)}}var g,v};h(c),a!==void 0&&n(H2(...a)),a=void 0};l(t,e,i)},H2=(t,e,i)=>`${i.map(r=>`${r}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,Dye={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},z2=t=>String.fromCharCode(t+(t>25?39:97)),um=t=>(e=>{let i,r="";for(i=Math.abs(e);i>52;i=i/52|0)r=z2(i%52)+r;return z2(i%52)+r})(((e,i)=>{let r=i.length;for(;r;)e=33*e^i.charCodeAt(--r);return e})(5381,JSON.stringify(t))>>>0),Hv=["themed","global","styled","onevar","resonevar","allvar","inline"],Pye=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},Rye=t=>{let e;const i=()=>{const{cssRules:n}=e.sheet;return[].map.call(n,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(n[o-1]&&(l=n[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===a)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},r=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in s)delete s[c]}const n=Object(t).styleSheets||[];for(const s of n)if(Pye(s)){for(let l=0,c=s.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const m=p.slice(14,-3).trim().split(/\s+/),h=Hv[m[0]];h&&(e||(e={sheet:s,reset:r,rules:{},toString:i}),e.rules[h]={group:d,index:l,cache:new Set(m)})}if(e)break}if(!e){const s=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,s(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,u=>u.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:r,toString:i}}const{sheet:a,rules:o}=e;for(let s=Hv.length-1;s>=0;--s){const l=Hv[s];if(!o[l]){const c=Hv[s+1],u=o[c]?o[c].index:a.cssRules.length;a.insertRule("@media{}",u),a.insertRule(`--sxs{--sxs:${s}}`,u),o[l]={group:a.cssRules[u+1],index:u,cache:new Set([s])}}Eye(o[l])}};return r(),e},Eye=t=>{const e=t.group;let i=e.cssRules.length;t.apply=r=>{try{e.insertRule(r,i),++i}catch{}}},Vv=Symbol(),Cye=qb(),Mye=(t,e)=>Cye(t,()=>(...i)=>{let r={type:null,composers:new Set};for(const n of i)if(n!=null)if(n[mS]){r.type==null&&(r.type=n[mS].type);for(const a of n[mS].composers)r.composers.add(a)}else n.constructor!==Object||n.$$typeof?r.type==null&&(r.type=n):r.composers.add(Nye(n,t));return r.type==null&&(r.type="span"),r.composers.size||r.composers.add(["PJLV",{},[],[],{},[]]),Aye(t,r,e)}),Nye=({variants:t,compoundVariants:e,defaultVariants:i,...r},n)=>{const a=`${Nc(n.prefix)}c-${um(r)}`,o=[],s=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,Iye.call(u,d)||(l[p]="undefined");const m=t[p];for(const h in m){const f={[p]:String(h)};String(h)==="undefined"&&c.push(p);const g=m[h],v=[f,g,!j2(g)];o.push(v)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:m,...h}=p;m=typeof m=="object"&&m||{};for(const g in h)h[g]=String(h[g]);const f=[h,m,!j2(m)];s.push(f)}return[a,r,o,s,l,c]},Aye=(t,e,i)=>{const[r,n,a,o]=Oye(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let m=0;m<p[Vv].length;m++){const[h,f]=p[Vv][m];d.rules[h].apply(f)}return p[Vv]=[],null}return p[Vv]=[],p.rules={},Hv.forEach(m=>p.rules[m]={apply:h=>p[Vv].push([m,h])}),p})(i):null,l=(s||i).rules,c=`.${r}${n.length>1?`:where(.${n.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||kye;const{css:p,...m}=d,h={};for(const v in a)if(delete m[v],v in d){let I=d[v];typeof I=="object"&&I?h[v]={"@initial":a[v],...I}:(I=String(I),h[v]=I!=="undefined"||o.has(v)?I:a[v])}else h[v]=a[v];const f=new Set([...n]);for(const[v,I,y,b]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),sf(I,[`.${v}`],[],t,U=>{l.styled.apply(U)}));const S=W2(y,h,t.media),w=W2(b,h,t.media,!0);for(const U of S)if(U!==void 0)for(const[T,P,R]of U){const D=`${v}-${um(P)}-${T}`;f.add(D);const E=(R?i.rules.resonevar:i.rules.onevar).cache,N=R?l.resonevar:l.onevar;E.has(D)||(E.add(D),sf(P,[`.${D}`],[],t,A=>{N.apply(A)}))}for(const U of w)if(U!==void 0)for(const[T,P]of U){const R=`${v}-${um(P)}-${T}`;f.add(R),i.rules.allvar.cache.has(R)||(i.rules.allvar.cache.add(R),sf(P,[`.${R}`],[],t,D=>{l.allvar.apply(D)}))}}if(typeof p=="object"&&p){const v=`${r}-i${um(p)}-css`;f.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),sf(p,[`.${v}`],[],t,I=>{l.inline.apply(I)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&f.add(v);const g=m.className=[...f].join(" ");return{type:e.type,className:g,selector:c,props:m,toString:()=>g,deferredInjector:s}};return _x(u,{className:r,selector:c,[mS]:e,toString:()=>(i.rules.styled.cache.has(r)||u(),r)})},Oye=t=>{let e="";const i=[],r={},n=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),n.push(...s);for(const l in o){const c=o[l];(r[l]===void 0||c!=="undefined"||s.includes(c))&&(r[l]=c)}}return[e,i,r,new Set(n)]},W2=(t,e,i,r)=>{const n=[];e:for(let[a,o,s]of t){if(s)continue;let l,c=0,u=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let m,h,f=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(h=h||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),u=!0}c+=f,m=!0}++f}if(h&&h.length&&(o={["@media "+h.join(", ")]:o}),!m)continue e}}}(n[c]=n[c]||[]).push([r?"cv":`${l}-${a[l]}`,o,u])}return n},kye={},xye=qb(),Fye=(t,e)=>xye(t,()=>(...i)=>{const r=()=>{for(let n of i){n=typeof n=="object"&&n||{};let a=um(n);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in n){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(n["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete n["@import"]}sf(n,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return _x(r,{toString:r})}),Lye=qb(),_ye=(t,e)=>Lye(t,()=>i=>{const r=`${Nc(t.prefix)}k-${um(i)}`,n=()=>{if(!e.rules.global.cache.has(r)){e.rules.global.cache.add(r);const a=[];sf(i,[],[],t,s=>a.push(s));const o=`@keyframes ${r}{${a.join("")}}`;e.rules.global.apply(o)}return r};return _x(n,{get name(){return n()},toString:n})}),$ye=class{constructor(t,e,i,r){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=r==null?"":String(r)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Nc(this.prefix)+Nc(this.scale)+this.token}toString(){return this.computedValue}},Bye=qb(),Vye=(t,e)=>Bye(t,()=>(i,r)=>{r=typeof i=="object"&&i||Object(r);const n=`.${i=(i=typeof i=="string"?i:"")||`${Nc(t.prefix)}t-${um(r)}`}`,a={},o=[];for(const l in r){a[l]={};for(const c in r[l]){const u=`--${Nc(t.prefix)}${l}-${c}`,d=B7(String(r[l][c]),t.prefix,l);a[l][c]=new $ye(c,d,l,t.prefix),o.push(`${u}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${r===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:n,toString:s}}),jye=qb(),V7=t=>{let e=!1;const i=jye(t,r=>{e=!0;const n="prefix"in(r=typeof r=="object"&&r||{})?String(r.prefix):"",a=typeof r.media=="object"&&r.media||{},o=typeof r.root=="object"?r.root||null:globalThis.document||null,s=typeof r.theme=="object"&&r.theme||{},l={prefix:n,media:a,theme:s,themeMap:typeof r.themeMap=="object"&&r.themeMap||{...gye},utils:typeof r.utils=="object"&&r.utils||{}},c=Rye(o),u={css:Mye(l,c),globalCss:Fye(l,c),keyframes:_ye(l,c),createTheme:Vye(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:n,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(s)),u});return e||i.reset(),i},Gye=()=>V2||(V2=V7()),Bt=(...t)=>Gye().css(...t);function Hye({variant:t}){return Bt({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const zye=Bt({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),Wye=Bt({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),qye=Bt({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function Yye({drawPosition:t,sideNumber:e}){return Bt({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function Kye({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Bt({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const $x=Bt({fontSize:"smaller",color:"gray"});var Jye=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function j7(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var G7={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=n(a,r(s)))}return a}function r(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=n(o,s));return o}function n(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(G7);var Xye=G7.exports;const yp=j7(Xye);function Zye({individualParticipant:t,className:e}){var i,r;const{city:n,state:a,countryCode:o}=((r=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:r[0])||{},s=[n,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=yp($x(),e),l.innerHTML=s,l}const Qye=Bt({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),ebe=Bt({display:"block"}),tbe=Bt({position:"fixed",right:0,left:0}),ibe=Bt({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),rbe=Bt({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),nbe=Bt({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),abe=Bt({fontWeight:"600",fontSize:"20px"}),q2=Bt({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),Y2="Nothing to see here";function as(t){return typeof t=="function"}function hS(t){return typeof t=="string"}function K2(t){return Array.isArray(t)}function $E(t){return typeof t=="object"&&!Array.isArray(t)}function obe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const J2=(()=>{const t=tbe(),e={},i=".5";let r=[],n,a=[],o=[],s;const l=f=>{if(f){let g;o=o.filter(v=>(v.id===f&&(g=v),v.id!==f)),g&&document.body.removeChild(g)}else{const g=o.pop();g&&document.body.removeChild(g)}},c=()=>{s&&(s.style.opacity=0,s.style.display="none")},u=f=>{const g=o.length;if(f&&e[g]===!1)return;const v=a.pop(),I=r.pop();as(v)&&v({content:I}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:n,behavior:"instant"}),c(),l()},d=()=>{s=document.createElement("div"),s.className=Qye(),s.id="cmdl-backdrop",s.onclick=()=>u(!0),document.body.appendChild(s)},p=({config:f})=>{n=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${n}px`,s||d(),s.style.display="",(f==null?void 0:f.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},m=({config:f,attr:g,attrs:v,unit:I="em",value:y})=>{var b;let S;return hS(g)?S=X1({element:f,attr:g}):K2(v)&&(S=(b=v.map(w=>X1({element:f,attr:w})).filter(Boolean))==null?void 0:b[0]),S!==void 0&&(y=S),isNaN(y)?y:`${y}${I}`},h=({buttons:f,config:g,modalNumber:v})=>{var I,y;const b=document.createElement("div");b.className=q2(),b.style.padding=m({config:g,attrs:["footer.padding","padding"],value:i});const S={label:((I=g==null?void 0:g.dictionary)==null?void 0:I.close)||"Close",onClick:J2.close,intent:"is-info"};for(const w of f){if(w.hide)continue;const U={...S};$E(w)&&Object.assign(U,w);const T=document.createElement("button");U.disabled!==void 0&&(T.disabled=U.disabled),U.id&&(T.id=U.id),T.className=((y=U==null?void 0:U.footer)==null?void 0:y.className)||"button font-medium",T.classList.add(U.intent),T.style="margin-right: .5em;",T.innerHTML=U.label||U.text,T.onclick=P=>{P.stopPropagation(),as(U.onClick)&&(T.classList.add("is-loading"),U.onClick({e:P,content:r[v]})),U.close!==!1&&(as(U.close)&&U.close(),J2.close())},b.appendChild(T)}return b};return{close:u,open:({title:f="",content:g,buttons:v,footer:I,config:y,onClose:b}={})=>{p({config:y}),a.push(b);const S=o.length+1;e[S]=y==null?void 0:y.clickAway;const w=document.createElement("section"),U=`cmdl-${S}`;w.className=ebe(),w.role="dialog",w.tabIndex=-1,w.id=U;const T=document.createElement("div");T.className=ibe(),T.style.maxWidth=`${(y==null?void 0:y.maxWidth)||450}px`,T.onclick=()=>u(!0);const P=document.createElement("div");P.className=rbe(),P.onclick=k=>k.stopPropagation();const R=document.createElement("div"),D=document.createElement("div");R.appendChild(D),P.appendChild(R);const E=({title:k,config:x})=>{R.className=k?nbe():"",R.style.padding=m({config:x,attrs:["title.padding","padding"],value:i}),D.className=k?abe():"",D.innerHTML=k};f&&E({title:f});const N=document.createElement("div");P.appendChild(N);const A=({content:k,config:x})=>{N.style.fontSize=m({config:x,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=m({config:x,attrs:["content.padding","padding"],value:i}),as(k)?r[S]=k(N):$E(k)?N.appendChild(k):hS(k)?N.innerHTML=k:N.innerHTML=Y2};if(A({content:g,config:y}),K2(v))I=h({buttons:v,config:y,modalNumber:S}),P.appendChild(I);else if(I){const k=document.createElement("div");k.className=q2(),k.style.padding=m({config:y,attrs:["footer.padding","padding"]}),$E(I)?k.appendChild(I):hS(I)?k.innerHTML=I:k.innerHTML=Y2,P.appendChild(k)}T.appendChild(P),w.appendChild(T),document.body.appendChild(w),o.push(w);const M=({content:k,config:x})=>{r[S]=void 0,obe(N),A({content:k,config:x})},C=({buttons:k,config:x})=>{P.removeChild(I),I=h({buttons:k,config:x,modalNumber:S}),P.appendChild(I)},O=({onClose:k})=>{a.length=0,a.push(k)};return{setContent:M,setButtons:C,update:({content:k,buttons:x,title:F,config:$,onClose:_})=>{y=$||y,k&&M({content:k,config:y}),x&&C({buttons:x,config:y}),_&&O({onClose:_}),F&&E({title:F,config:y})}}}}})();function X1({element:t,attr:e}){if(!hS(e))return;const i=e.split(".");for(const r of i)if(t=t==null?void 0:t[r],!t)return;return t}function sbe({individualParticipant:t,attribute:e,className:i}){const r=t==null?void 0:t.person,n=X1({element:r,attr:e});if(!n)return;const a=document.createElement("div");return a.className=yp($x(),i),a.innerHTML=n,a}function lbe({individualParticipant:t,className:e}){var i;const r=(i=t==null?void 0:t.teams)==null?void 0:i[0],n=(r==null?void 0:r.participantName)||" ",a=document.createElement("div");return a.className=yp($x(),e),a.classList.add("tmx-tm"),a.setAttribute("id",r==null?void 0:r.participantId),a.innerHTML=n,a}function ube(t){var e,i,r,n;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(((n=(r=t==null?void 0:t.composition)==null?void 0:r.configuration)==null?void 0:n.showAddress)??a==="ADDRESS")return Zye(t);if(a==="TEAM")return lbe(t);if(a){const o=sbe({...t,attribute:a});if(o)return o}return document.createElement("div")}const cbe=Bt({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function dbe({className:t,composition:e,side:i}){const r=(i==null?void 0:i.seedValue)||(i==null?void 0:i.seedNumber);if(!r)return"";const n=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=n,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${r}${o[1]}`,l=n.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t,c.innerHTML=s,c}const pbe=Bt({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function mbe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n}){var a,o,s,l,c,u,d;const p=e==null?void 0:e.configuration,m=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(r==null?void 0:r.matchUpType)||"SINGLES",h=t==null?void 0:t.rankings,f=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,I=g==null?void 0:g.scaleName,y=g==null?void 0:g.accessor,b=v==="RATING"?f:h,S=(s=(o=b==null?void 0:b.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===I))==null?void 0:s.scaleValue,w=(c=(l=b==null?void 0:b.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===I))==null?void 0:c.scaleValue,U=S&&y?S[y]:S||"",T=w&&y?w[y]:w||"",P=m==="SINGLES"?U:T,R=(u=p==null?void 0:p.scaleAttributes)==null?void 0:u.fallback,D=!n&&(P||R&&(U||T)),E=document.createElement("span");return D&&(E.className=yp(i,pbe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),E.innerHTML=D||"",E}var hbe=Object.defineProperty,yt=(t,e)=>{for(var i in e)hbe(t,i,{get:e[i],enumerable:!0})};function dP(){return"2.0.28"}var H7={};yt(H7,{competitionGovernor:()=>z7,drawsGovernor:()=>$9,entriesGovernor:()=>HQ,eventGovernor:()=>XQ,generationGovernor:()=>pee,matchUpFormatGovernor:()=>wee,matchUpGovernor:()=>Uee,mocksGovernor:()=>M$,participantGovernor:()=>vte,policyGovernor:()=>IQ,publishingGovernor:()=>$te,queryGovernor:()=>SQ,reportGovernor:()=>Wte,scheduleGovernor:()=>qte,scoreGovernor:()=>y_,tieFormatGovernor:()=>aie,tournamentGovernor:()=>hie,venueGovernor:()=>Tie});var z7={};yt(z7,{getLinkedTournamentIds:()=>lw,getTournamentIds:()=>ow,linkTournaments:()=>x9,mutate:()=>W7,query:()=>_9,unlinkTournament:()=>L9,unlinkTournaments:()=>F9});var W7={};yt(W7,{linkTournaments:()=>x9,unlinkTournament:()=>L9,unlinkTournaments:()=>F9});var fbe={};yt(fbe,{addNotice:()=>Tt,callListener:()=>uM,createInstanceState:()=>cwe,cycleMutationStatus:()=>IF,deepCopyEnabled:()=>vF,deleteNotice:()=>yF,deleteNotices:()=>iw,disableNotifications:()=>u9,enableNotifications:()=>IS,getDevContext:()=>no,getMethods:()=>p9,getNotices:()=>m9,getProvider:()=>cM,getTopics:()=>qo,getTournamentId:()=>Uh,getTournamentRecord:()=>bF,getTournamentRecords:()=>Sh,globalLog:()=>g9,handleCaughtError:()=>PP,removeTournamentRecord:()=>f9,setDeepCopy:()=>XI,setDevContext:()=>JI,setGlobalLog:()=>l9,setGlobalMethods:()=>c9,setGlobalSubscriptions:()=>pwe,setMethods:()=>d9,setStateMethods:()=>v9,setStateProvider:()=>uwe,setSubscriptions:()=>mwe,setTournamentId:()=>ZI,setTournamentRecord:()=>h9,setTournamentRecords:()=>DP,timeKeeper:()=>dwe});function ta(t){return typeof t=="function"}function On(t){return typeof t=="string"}function Ii(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function gbe(t,e){if(!Ii(t)||!Ii(e))return!1;let i=Object.keys(t),r=Object.keys(e);if(i.length!==r.length)return!1;for(let n of i)if(t[n]!==e[n])return!1;return!0}function q7(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Ii).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var vbe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function Z1(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),r=n=>n===void 0?null:n;return Object.assign({},...i.map(n=>Array.isArray(t[n])?{[n]:e?t[n]:t[n].map(a=>Z1(a))}:{[n]:e?r(t[n]):Z1(t[n])}))}function Q1(t){return Array.isArray(t)?t.length+t.map(Q1).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>Q1(t[e])).reduce((e,i)=>e+i,0):0}function Ibe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=Q1(t),r=e.split("").reduce((n,a)=>n+a.charCodeAt(0),0);return[e.length,i,r].map(n=>n.toString(36)).join("")}var Z={success:!0},ybe="error",bbe={SUCCESS:Z,ERROR:ybe},eM={message:"Chronological error; time violation.",code:"ANACHRONISM"},Y7={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},tM={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Ai={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},he={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},Yb={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Gf={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},cm={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},Ce={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},K7={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},ma={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},yh={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Bx={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Vx={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Hf={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},J7={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},X7={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},wbe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},jx={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},Kb={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},pP={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},ev={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},tv={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},Gx={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},mP={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Hx={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Jb={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Ps={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Z7={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Q7={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},eK={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},tK={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},iK={message:"Invalid action",code:"ERR_INVALID_ACTION"},iM={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},rK={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},nK={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},aK={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},zx={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},oK={message:"Existing round",code:"ERR_EXISTING_ROUND"},Ube={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},La={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Ri={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Wx={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},td={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},sK={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Ac={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Wt={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},ha={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},lK={message:"Event exists",code:"ERR_EXISTING_EVENT"},uK={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},cK={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},qx={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},Yx={message:"Missing stage",code:"ERR_MISSING_STAGE"},bp={message:"Invalid stage",code:"ERR_INVALID_STAGE"},dK={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},pK={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},mK={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},rM={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},Xb={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},fS={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},zf={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},tu={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Kx={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Jx={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},hK={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Zb={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},Xr={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},iv={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},an={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Xl={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Yn={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},kn={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},Xx={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},hP={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Sbe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},fK={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Zx={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},gK={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},Qx={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Tbe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},Wf={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Dbe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},eF={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},Pbe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},fP={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},Rbe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Ebe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},bh={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},Ve={message:"Missing value",code:"ERR_MISSING_VALUE"},vK={message:"Missing date",code:"ERR_MISSING_DATE"},IK={message:"No valid dates",code:"ERR_NO_VALID_DATES"},f0={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},gS={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},yK={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Tn={message:"Invalid Date",code:"ERR_INVALID_DATE"},vo={message:"Invalid time",code:"ERR_INVALID_TIME"},bK={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},nM={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},wK={message:"Invalid score",code:"ERR_INVALID_SCORE"},gP={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},Cbe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},tF={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},UK={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},vP={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},iF={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},rv={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Ks={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Po={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},SK={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},bs={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},TK={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},wh={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},Qb={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},vr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Ji={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},DK={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Mbe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},PK={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},id={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},RK={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},EK={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},CK={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},nv={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},IP={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},rF={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},aM={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},MK={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Nbe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},Abe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},NK={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},AK={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},oM={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},OK={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},nF={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},kK={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},aF={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},qf={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},xK={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},ew={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},FK={message:"Court exists",code:"ERR_EXISTING_COURT"},LK={message:"Venue exists",code:"ERR_EXISTING_VENUE"},av={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},rd={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},_K={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},oF={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},$K={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},BK={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Obe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},sF={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},VK={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},lF={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},uF={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},yP={message:"Missing context",code:"ERR_MISSING_CONTEXT"},jK={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},tw={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},GK={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},ov={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},HK={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},bP={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},zK={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},WK={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},qu={message:"Invalid object",code:"ERR_INVALID_OBJECT"},vS={message:"Invalid gender",code:"ERR_INVALID_GENDER"},g0={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},oe={message:"Invalid values",code:"ERR_INVALID_VALUES"},qK={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},cF={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},YK={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},wP={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},dF={message:"Value unchanged",code:"ABORT_UNCHANGED"},on={message:"Not found",code:"ERR_NOT_FOUND"},UP={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},KK={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},pF={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},JK={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},XK={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},sM={message:"Existing stage",code:"ERR_EXISTING_STAGE"},mF={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},SP={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},ZK={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},TP={message:"Scores present",code:"ERR_SCORES_PRESENT"},kbe={ANACHRONISM:eM,CANNOT_CHANGE_WINNING_SIDE:iF,CANNOT_MODIFY_TIEFORMAT:tF,CANNOT_MODIFY_PARTICIPANT_TYPE:UK,CANNOT_REMOVE_MAIN_STRUCTURE:Y7,CANNOT_REMOVE_PARTICIPANTS:vP,COURT_EXISTS:FK,COURT_NOT_FOUND:ew,DRAW_DEFINITION_NOT_FOUND:ma,DRAW_ID_EXISTS:Z7,DRAW_POSITION_ACTIVE:pP,DRAW_POSITION_ASSIGNED:Hf,DRAW_POSITION_NOT_CLEARED:X7,DRAW_POSITION_NOT_FOUND:wbe,DRAW_SIZE_MISMATCH:Hx,DUPLICATE_VALUE:qK,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:AK,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:NK,EVENT_EXISTS:lK,EVENT_NOT_FOUND:ha,EXISTING_DRAW_DEFINITIONS:K7,EXISTING_END_TIME:oF,EXISTING_FLIGHT:KK,EXISTING_MATCHUP_ID:XK,EXISTING_OUTCOME:JK,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:nv,EXISTING_PARTICIPANT:IP,EXISTING_POLICY_TYPE:Qx,EXISTING_PROFILE:pF,EXISTING_ROUND:oK,EXISTING_STAGE:sM,EXISTING_STRUCTURE:mF,INCOMPATIBLE_MATCHUP_STATUS:fS,INCOMPLETE_SOURCE_STRUCTURE:Bx,INSUFFICIENT_DRAW_POSITIONS:nF,INVALID_ACTION:iK,INVALID_ASSIGNMENT:iM,INVALID_BOOKINGS:f0,INVALID_CATEGORY:g0,INVALID_COLLECTION_DEFINITION:WK,INVALID_CONFIGURATION:zK,INVALID_DATE_AVAILABILITY:gS,INVALID_DATE:Tn,INVALID_DRAW_DEFINITION:cm,INVALID_DRAW_POSITION_FOR_SEEDING:Vx,INVALID_DRAW_POSITION:ev,INVALID_DRAW_SIZE:mP,INVALID_END_TIME:_K,INVALID_ENTRIES:cK,INVALID_EVENT_TYPE:Ac,INVALID_GAME_SCORES:nM,INVALID_GENDER:vS,INVALID_MATCHUP_FORMAT:Kx,INVALID_MATCHUP_STATUS:zf,INVALID_MATCHUP_STATUS_BYE:mK,INVALID_MATCHUP:kn,INVALID_OBJECT:qu,INVALID_PARTICIPANT_ID:Ks,INVALID_PARTICIPANT_IDS:Po,INVALID_PARTICIPANT_ROLE:SK,INVALID_PARTICIPANT_SEEDING:Q7,INVALID_PARTICIPANT_TYPE:bs,INVALID_PARTICIPANT:rv,INVALID_POLICY_DEFINITION:gK,INVALID_RECORDS:tM,INVALID_SCALE_ITEM:tw,INVALID_SEED_NUMBER:nK,INVALID_SEED_POSITION:aK,INVALID_SET_NUMBER:Pbe,INVALID_SIDE_NUMBER:eF,INVALID_SCORE:wK,INVALID_STAGE:bp,INVALID_START_TIME:BK,INVALID_STRUCTURE:yh,INVALID_STOP_TIME:$K,INVALID_TIE_FORMAT:tu,INVALID_TIME:vo,INVALID_TIME_ITEM:sF,INVALID_TOURNAMENT_DATES:bK,INVALID_TOURNAMENT_RECORD:Yb,INVALID_VALUES:oe,INVALID_WINNING_SIDE:gP,MATCHUP_NOT_FOUND:an,METHOD_NOT_FOUND:SP,MISSING_ASSIGNMENTS:qx,MISSING_ASYNC_STATE_PROVIDER:VK,MISSING_AVOIDANCE_POLICY:fK,MISSING_COLLECTION_DEFINITION:hK,MISSING_COURT_ID:bh,MISSING_COURTS_INFO:xK,MISSING_DATE_AVAILABILITY:yK,MISSING_DATE:vK,MISSING_DRAW_DEFINITION:Ce,MISSING_DRAW_ID:Ps,MISSING_DRAW_POSITION:tv,MISSING_DRAW_POSITIONS:Kb,MISSING_DRAW_SIZE:Jb,MISSING_ENTRIES:uK,MISSING_EVENT:Wt,MISSING_MATCHUP_FORMAT:Jx,MISSING_MATCHUP_ID:Xr,MISSING_MATCHUP_IDS:iv,MISSING_MATCHUP:Yn,MISSING_MATCHUPS:Xl,MISSING_PARTICIPANT_COUNT:RK,MISSING_PARTICIPANT_ID:vr,MISSING_PARTICIPANT_IDS:id,MISSING_PARTICIPANT_ROLE:TK,MISSING_PARTICIPANT:wh,MISSING_PARTICIPANTS:Qb,MISSING_PENALTY_ID:aF,MISSING_PENALTY_TYPE:kK,MISSING_PERSON_DETAILS:CK,MISSING_POLICY_ATTRIBUTES:Zx,MISSING_POLICY_DEFINITION:hP,MISSING_POLICY_TYPE:Xx,MISSING_POSITION_ASSIGNMENTS:pK,MISSING_ROUND_NUMBER:Ube,MISSING_SCHEDULE:jK,MISSING_SCORING_POLICY:Dbe,MISSING_SEED_ASSIGNMENTS:rK,MISSING_SEEDCOUNT_THRESHOLDS:tK,MISSING_SEEDING_POLICY:Sbe,MISSING_SET_NUMBER:Rbe,MISSING_SET_OBJECT:fP,MISSING_SIDE_NUMBER:Ebe,MISSING_STAGE:Yx,MISSING_STRUCTURE_ID:La,MISSING_STRUCTURE:td,MISSING_STRUCTURES:Wx,MISSING_TARGET_LINK:zx,MISSING_TIE_FORMAT:Zb,MISSING_TIME_ITEM:lF,MISSING_TIME_ITEMS:uF,MISSING_TOURNAMENT_ID:Gf,MISSING_TOURNAMENT_RECORD:he,MISSING_TOURNAMENT_RECORDS:Ai,MISSING_VALUE:Ve,MISSING_VENUE_ID:rd,MODIFICATIONS_FAILED:GK,NO_CANDIDATES:bP,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:OK,NO_MODIFICATIONS_APPLIED:ov,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:oM,NO_PARTICIPANT_REMOVED:PK,NO_VALID_ACTIONS:YK,NO_VALID_ATTRIBUTES:wP,NO_VALID_DATES:IK,NOT_FOUND:on,NOT_IMPLEMENTED:UP,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:rF,PARTICIPANT_ID_EXISTS:DK,PARTICIPANT_NOT_CHECKED_IN:EK,PARTICIPANT_NOT_FOUND:Ji,PARTICIPANT_PAIR_EXISTS:Mbe,PENALTY_NOT_FOUND:qf,POLICY_NOT_ATTACHED:Tbe,POLICY_NOT_FOUND:Wf,SCHEDULE_NOT_CLEARED:J7,SCHEDULED_MATCHUPS:ZK,SCORES_PRESENT:TP,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:eK,STAGE_SEQUENCE_LIMIT:dK,STRUCTURE_NOT_FOUND:Ri,TEAM_NOT_FOUND:cF,UNABLE_TO_ASSIGN_COURT:HK,UNLINKED_STRUCTURES:sK,UNRECOGNIZED_DRAW_TYPE:jx,UNRECOGNIZED_MATCHUP_FORMAT:Xb,UNRECOGNIZED_MATCHUP_STATUS:rM,VALUE_UNCHANGED:dF,VENUE_EXISTS:LK},Ui={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},QK={addNotice:Wbe,callListener:Xbe,cycleMutationStatus:zbe,deleteNotice:Kbe,deleteNotices:Ybe,disableNotifications:xbe,enableNotifications:Fbe,getMethods:hF,getNotices:qbe,getTopics:Jbe,getTournamentId:e9,getTournamentRecord:Lbe,getTournamentRecords:_be,removeTournamentRecord:jbe,setMethods:Hbe,setSubscriptions:Gbe,setTournamentId:Bbe,setTournamentRecord:$be,setTournamentRecords:Vbe,handleCaughtError:Zbe};function xbe(){Ui.disableNotifications=!0}function Fbe(){Ui.disableNotifications=!1}function e9(){return Ui.tournamentId}function Lbe(t){return Ui.tournamentRecords[t]}function _be(){return Ui.tournamentRecords}function $be(t){let e=t==null?void 0:t.tournamentId;return e?(Ui.tournamentRecords[e]=t,{success:!0}):{error:Yb}}function Bbe(t){return t?Ui.tournamentRecords[t]?(Ui.tournamentId=t,{success:!0}):{error:he}:(Ui.tournamentId=void 0,{success:!0})}function Vbe(t){Ui.tournamentRecords=t;let e=Object.keys(t);e.length===1?Ui.tournamentId=e[0]:e.length||(Ui.tournamentId=void 0)}function jbe(t){if(typeof t!="string")return{error:oe};if(!Ui.tournamentRecords[t])return{error:on};delete Ui.tournamentRecords[t];let e=Object.keys(Ui.tournamentRecords);return e.length===1?Ui.tournamentId=e[0]:e.length||(Ui.tournamentId=void 0),{success:!0}}function Gbe(t){return typeof t.subscriptions!="object"?{error:oe}:(Object.keys(t.subscriptions).forEach(e=>{Ui.subscriptions[e]=t.subscriptions[e]}),{...Z})}function Hbe(t){return typeof t!="object"?{error:oe}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Ui.methods[e]=t[e])}),{...Z})}function zbe(){let t=Ui.modified;return Ui.modified=!1,t}function Wbe({topic:t,payload:e,key:i},r){if(!(typeof t!="string"||typeof e!="object")&&(Ui.disableNotifications||(Ui.modified=!0),!(Ui.disableNotifications||!Ui.subscriptions[t]&&!r)))return i&&(Ui.notices=Ui.notices.filter(n=>!(n.topic===t&&n.key===i))),Ui.notices.push({topic:t,payload:e,key:i}),{...Z}}function hF(){return Ui.methods??{}}function qbe({topic:t}){return Ui.notices.filter(e=>e.topic===t).map(e=>e.payload)}function Ybe(){Ui.notices=[]}function Kbe({topic:t,key:e}){Ui.notices=Ui.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function Jbe(){return{topics:Object.keys(Ui.subscriptions)}}function Xbe({topic:t,notices:e},i){let r=Ui.subscriptions[t];r&&typeof r=="function"&&r(e);let n=i==null?void 0:i[t];n&&typeof n=="function"&&n(e)}function Zbe({engineName:t,methodName:e,params:i,err:r}){let n;return typeof r=="string"?n=r.toUpperCase():r instanceof Error&&(n=r.message),console.log("ERROR",{tournamentId:e9(),params:JSON.stringify(i),engine:t,methodName:e,error:n}),{error:n}}function sr(t,e){return(t??0)-(e??0)}function Xe(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function ws(t){return isNaN(t)?!1:t&&(t&t-1)===0}function X2(t){if(!t.length)return;let e=[...t].sort(sr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function Qbe(t){if(!ws(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function fF(t){return isNaN(t)?0:t%2&&t+1||t}function gF(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function ki(t){return!isNaN(parseFloat(t))}function t9(t){let e=Xe(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function sv(t){if(isNaN(t))return!1;for(;!ws(t);)t++;return t}function Ha(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function nt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function ewe(t=1,e=3,i=!0){let r=0;for(let n=0;n<e;n++)r+=Math.random()*(t/e);return i&&t>1?Math.round(r):r}function twe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function i9(t,e,i,r,n=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=i9(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),r&&(s=twe(s,r)),parseFloat(s.toFixed(n))}function ht(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,r)=>r.lastIndexOf(e)===i):[]}function iwe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function hn(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function Yf(t){return nt(t)?t:1/0}function fa(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function rwe(t){return r9(fa(t))}function r9(t){return Object.keys(t).reduce((e,i)=>{let r=t[i];return e[r]?e[r].push(i):e[r]=[i],e},{})}function nwe(t,e,i){return i.indexOf(t)===e}function n9(t){return t.filter(nwe)}function ra(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Uo(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Ee(t,e){return Array.from({length:e-t},(i,r)=>r+t)}function $s(t,e){return e.reduce((i,r,n)=>(r===t&&i.push(n),i),[])}function Hi(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,r,n)=>n.indexOf(i)===r)}function Z2(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Dn(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function awe(t,e){return Array.isArray(e)&&e.reduce((i,r)=>(i[r]=1+i[r]||1,i),{})[t]||0}function owe(t,e,i,r){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(r),...t.slice(e+i,t.length)):[]}function xr(t,e){return Array.isArray(t)?t.reduce((i,r,n)=>{let a=Math.floor(n/e);return i[a]=[].concat(i[a]||[],r),i},[]):[]}function a9(t,[e,...i]){return t.length?[t.slice(0,e),...a9(t.slice(e),[...i,e])]:[]}function swe(t){return t.reduce((e,i)=>{let r=e[e.length-1];return(!r||r[r.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function o9(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function s9(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function lM(t,e,i){return Array.isArray(t)?t.reduce((r,n,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return r[l]||(r[l]=[]),r[l].push(n),r},[]):[]}function lwe(t,e=1){if(!Array.isArray(t)||!t.every(nt))return[];let i=Math.min(...t,e),r=Math.max(...t);return Ee(i,r+1).filter(n=>!t.includes(n))}var Zt={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Fr=QK,Q2=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function uwe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Hi(Object.keys(t),Q2).length!==Q2.length)throw new Error("Global state provider is missing required methods");return Fr=t,{success:!0}}function cwe(){if(Fr.createInstanceState){try{Fr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:VK}}function no(t){return!t||typeof t!="object"?Zt.devContext??!1:typeof Zt.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Zt.devContext)==null?void 0:i[e])===t[e]})&&Zt.devContext}function dwe(t="reset",e="default"){var i,r;let n=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Zt.timers).filter(a=>a!=="default"||Zt.timers[a].startTime).map(a=>{let o=Zt.timers[a],s=o.state==="stopped"?0:(n-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:Zt.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Zt.timers[e].state==="stopped"?0:(n-(((i=Zt.timers[e])==null?void 0:i.startTime)??0))/1e3,o=Zt.timers[e].elapsedTime+a;return{state:Zt.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!Zt.timers[e]||t==="reset"){if(e==="allTimers")return Zt.timers={default:{elapsedTime:0}},!0;Zt.timers[e]={startTime:n,state:"active",elapsedTime:0}}return Zt.timers[e].elapsedTime||(Zt.timers[e].elapsedTime=0),t==="stop"&&Zt.timers[e].state!=="stopped"&&(Zt.timers[e].state="stopped")&&(Zt.timers[e].elapsedTime+=(n-(((r=Zt.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(Zt.timers[e].startTime=n)&&(Zt.timers[e].state="active"),Zt.timers[e]}function l9(t){ta(t)?Zt.globalLog=t:delete Zt.globalLog}function JI(t){Zt.devContext=t}function u9(){Fr.disableNotifications()}function IS(){Fr.enableNotifications()}function XI(t,e){typeof t=="boolean"&&(Zt.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Zt.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Zt.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Zt.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Zt.deepCopyAttributes.threshold=e.threshold))}function vF(){return{enabled:Zt.deepCopy,...Zt.deepCopyAttributes}}function pwe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Zt.globalSubscriptions[e]=t.subscriptions[e]}),{...Z}):{error:Ve,info:"missing subscriptions"}}function mwe(t){return t!=null&&t.subscriptions?Fr.setSubscriptions({subscriptions:t.subscriptions}):{error:Ve,info:"missing subscriptions"}}function c9(t){return t?typeof t!="object"?{error:oe}:(Object.keys(t).forEach(e=>{ta(t[e])&&(Zt.globalMethods[e]=t[e])}),{...Z}):{error:Ve,info:"missing method declarations"}}function d9(t){return t?typeof t!="object"?{error:oe}:Fr.setMethods(t):{error:Ve,info:"missing method declarations"}}function IF(){return Fr.cycleMutationStatus()}function Tt(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Zt.globalSubscriptions[t.topic];return Fr.addNotice(t,e)}function p9(){return{...Zt.globalMethods,...Fr.getMethods()}}function m9(t){return Fr.getNotices(t)}function yF({key:t,topic:e}){return Fr.deleteNotice({key:t,topic:e})}function iw(){return Fr.deleteNotices()}function qo(){return Fr.getTopics()}async function uM(t){return Fr.callListener(t,Zt.globalSubscriptions)}function Uh(){return Fr.getTournamentId()}function bF(t){return Fr.getTournamentRecord(t)}function Sh(){return Fr.getTournamentRecords()}function h9(t){return Fr.setTournamentRecord(t)}function DP(t){return Fr.setTournamentRecords(t)}function ZI(t){return Fr.setTournamentId(t)}function f9(t){return Fr.removeTournamentRecord(t)}function cM(){return Fr}function PP({engineName:t,methodName:e,params:i,err:r}){return(ta(Fr.handleCaughtError)&&Fr.handleCaughtError||QK.handleCaughtError)({engineName:t,methodName:e,params:i,err:r})}function g9(t,e){if(Zt.globalLog)try{Zt.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),l9()}else console.log(e,t)}function v9(t,e,i,r){if(!Ii(t))return{error:oe};ki||(i=1);let n=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(c=>{ta(s[c])?a[c]=s[c]:Ii(s[c])&&(e===!0||n!=null&&n.includes(c))&&(i===void 0||l<i)&&o(s[c],l+1)})};return o(t),r?c9(a):d9(a),{methods:a}}function hwe(t,e,i){return Object.keys(t).filter(r=>!e.includes(t[r])&&(!i||(Array.isArray(t[r])?t[r].length:!0)))}function He(t,e,i,r){var n;if(typeof t!="object"||t===null)return t;(n=vF())!=null&&n.enabled||(r=!0);let a=["",void 0,null];e&&a.push(!1);let o=hwe(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:r?t[s]:t[s].map(l=>He(l))}:{[s]:r?t[s]:He(t[s])}))}function ee({context:t,result:e,stack:i,info:r}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&r&&(e.info=r),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,He(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...Z}),e??{success:!0}}var sn="tournamentRecords",wF="policyDefinitions",Zl="tournamentRecord",Rs="drawDefinition",UF="matchUpFormat",Ll="participantId",I9="scheduleDates",fwe="tournamentId",gwe="scheduleDate",SF="structureId",TF="participant",rw="matchUpIds",vwe="policyType",y9="structures",wp="matchUpId",DF="inContext",PF="structure",RP="courtIds",Iwe="personId",EP="venueIds",b9="matchUps",w9="courtId",U9="eventId",nd="matchUp",S9="drawId",dm="error",lv="event",nw="param",ywe="uuids",bwe="averageMatchUpMinutes",wwe="recoveryMinutes",Uwe="periodLength",Swe="number",Ql="object",Xn="array",is="_validate",T9="_message",_l="_invalid",ad="_ofType",RF="_anyOf",QI="_oneOf",Twe={[sn]:Ai,[Zl]:he,[wF]:hP,[Rs]:Ce,[Ll]:vr,[UF]:Jx,[fwe]:Gf,[SF]:La,[rw]:iv,[TF]:wh,[y9]:Wx,[wp]:Xr,[PF]:td,[w9]:bh,[b9]:Xl,[U9]:ha,[nd]:Yn,[RP]:Ve,[EP]:Ve,[S9]:Ps,[lv]:Wt},Dwe={[sn]:Ql,[wF]:Ql,[Zl]:Ql,[Rs]:Ql,[I9]:Xn,[TF]:Ql,[rw]:Xn,[y9]:Xn,[PF]:Ql,[RP]:Xn,[EP]:Xn,[b9]:Xn,[nd]:Ql,[lv]:Ql,[ywe]:Xn};function kt(t,e,i){if(!t&&!Ii(t))return{error:oe};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:oe};let{paramError:r,errorParam:n}=Ewe(t,e);if(!r)return{valid:!0};let a=(t==null?void 0:t[n])===void 0?Twe[n]||oe:r[is]&&r[_l]||oe,o=n??(r[QI]&&Object.keys(r[QI]).join(", "));return ee({info:{param:o,message:r[T9]},result:{error:a},stack:i})}function D9(t,e){let i=Object.keys(t),r=Object.keys(e);return Hi(i,r)}function Pwe(t,e){if(!e)return;let i=D9(t,e);return i.length!==1?{error:oe}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function Rwe(t,e){if(!e)return;let i=D9(t,e).filter(r=>t[r]);return i.length<1?{error:oe}:i.reduce((r,n)=>({...r,[n]:!0}),{})}function Ewe(t,e){let i,r;return{paramError:e.find(({_ofType:n,_oneOf:a,_anyOf:o,_validate:s,_info:l,...c})=>{let u=a&&Pwe(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=o&&Rwe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(h=>typeof c[h]=="boolean"),m=p.find(h=>{let f=s&&!ta(s),g=t[h]&&!s&&Cwe(t,h,n),v=c[h]&&!t[h],I=f||g||v||s&&t[h]&&!Mwe(t[h],s);return I&&(i=h,r=l),I});return!p.length||m}),errorParam:i,paramInfo:r}}function Cwe(t,e,i){return i=i||Dwe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function Mwe(t,e){return ta(e)?e(t):!0}var P9="DYNAMIC",Oc="RANKING",Cd="RATING",Om="SCALE",Tl="SEEDING",Nwe={RANKING:Oc,RATING:Cd,SCALE:Om,SEEDING:Tl};function uv(t){var e;let i=kt(t,[{[TF]:!0}]);if(i.error)return i;let r=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Om))&&[Oc,Cd,Tl].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(r!=null&&r.length){let a=s=>r.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),o=ht(r.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,c,u,d,p]=l.itemType.split("."),m=p?`${d}.${p}`:d,h=c===Tl&&"seedings"||c===Oc&&"rankings"||"ratings";n[h][u]||(n[h][u]=[]),n[h][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:m})}}}return{...Z,...n}}function km(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let r={};return n(e,i,r),r;function n(a,o,s){if(!a||!o)return;let l=Object.keys(a),c=Object.keys(o),u=Object.assign({},...c.filter(m=>m.indexOf("||")).map(m=>m.split("||").map(h=>({[h]:m}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let m of l)if(d.indexOf(m)>=0||p){let h=u[m]||m,f=o[h]||p,g=a[m];if(typeof f=="object"&&typeof g!="function"&&!Array.isArray(f))if(Array.isArray(g)){let v=g.map(I=>{let y={};return n(I,f,y)!==!1?y:void 0}).filter(Boolean);s[m]=v}else g&&(s[m]={},n(g,f,s[m]));else{let v=a[m];if(Array.isArray(f)&&!f.includes(v))return!1;(o[m]||p&&o[m]!==!1)&&(s[m]=v)}}}}var v0=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,R9=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,$l=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,Rd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function I0(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=ct(t.scheduledTime)),!e)return;let i=fi(t.scheduledTime),r=ct(e);return r&&i&&(r+=`T${i}`),r}function Awe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function cv(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||Rd.test(Th(t,!0,!0)))}function Da(t){return Yd(t)||v0.test(t)}function Owe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return kwe(i,{displaySeconds:!1})}function kwe(t,e){let i=parseInt(t,10),r=Math.floor(i/3600),n=Math.floor((i-r*3600)/60),a=i-r*3600-n*60;return(!e||e!=null&&e.displaySeconds?r+":"+n+":"+a:r+":"+n).split(":").map(qa).join(":")}var EF=t=>{let e=ey(t)||Yd(t)?new Date(t):new Date,i=e.getUTCMonth()+1,r=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${qa(r)}-${qa(e.getUTCDate())}`};function xwe(t){let e=ey(t)||Yd(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function us(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let r=new Date(t),n=""+(r.getMonth()+1),a=""+r.getDate(),o=r.getFullYear();return n.length<2&&(n="0"+n),a.length<2&&(a="0"+a),i==="DMY"?[a,n,o].join(e):i==="MDY"?[n,a,o].join(e):i==="YDM"?[o,a,n].join(e):i==="DYM"?[a,o,n].join(e):i==="MYD"?[n,o,a].join(e):[o,n,a].join(e)}function y0(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function Fwe(t){return y0(t).getTime()}function ey(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Kf(t,e){if(!Da(t)||!Da(e))return[];let i=ct(t)+"T00:00",r=ct(e)+"T00:00",n=new Date(i),a=new Date(r),o=ey(a)&&ey(n)&&c(n,a),s=[],l=0;if(o){let u=n,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>us(u));function c(u,d){return u<=d}}var Lwe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Yd(t){return typeof t!="string"?!1:Lwe.test(t)}function CF(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(r=>!isNaN(parseInt(r)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function Pt(t){let e=fi(t);if(!e)return 0;let[i,r]=e.split(":").map(n=>parseInt(n));return i*60+r}function _we(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[qa(e),qa(i)].join(":")}function b0(t){return CF(t)?t.split(":").slice(0,2).map(qa).join(":"):void 0}function fi(t){return Yd(t)&&t.indexOf("T")>0?b0(t.split("T").reverse()[0]):b0(t)}function ct(t){return Yd(t)||$l.test(t)?t.split("T")[0]:void 0}function zv(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),ct(i.toISOString())}function w0(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function $we(t){let e=w0(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(qa).join(":")}function Bwe(t){var e;let i=w0(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function Th(t,e,i){let r=ct(t),n=fi(t),a=r?n:t;return t?e&&(r&&i&&t||$we(a))||Bwe(a):void 0}function E9(t,e){let i=w0(t),r=w0(e);if(parseInt(i.hours)<parseInt(r.hours))return-1;if(parseInt(i.hours)>parseInt(r.hours))return 1;if(i.hours===r.hours){if(parseInt(i.minutes)<parseInt(r.minutes))return-1;if(parseInt(i.minutes)>parseInt(r.minutes))return 1}return 0}function C9(t,e=7){let i=ct(t)+"T00:00",r=new Date(i),n=new Date(r.setDate(r.getDate()+e));return us(n)}function Vwe(t){return C9(t)}function jwe(t,e,i,r=!1){let n=new Date(e,0,1+(t-1)*7),a=r?0:1;return n.setDate(n.getDate()+(a-n.getDay())),us(n,i)}function Gwe(t,e,i){let r=new Date(t,0);return us(new Date(r.setDate(e)),i)}function er(t,e=void 0){let[i,r]=(t||"00:00").split(":").map(qa),n=y0(e).setHours(i,r,0,0);return y0(n)}function aw(t,e,i=!0){let r=new Date(t),n=(new Date(e).getTime()-r.getTime())/1e3/60;return i?Math.abs(Math.round(n)):Math.round(n)}function jn(t,e){let i=fi(t);if(!i)return"00:00";let r=isNaN(e)?0:e;return fi(MF(er(i),r).toISOString())}function MF(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function qa(t){return t.toString()[1]?t:"0"+t}function Bl(t,e){let i=new Date(t),r=new Date(e);return i.getFullYear()===r.getFullYear()&&i.getMonth()===r.getMonth()&&i.getDate()===r.getDate()}var Hwe={addDays:C9,addWeek:Vwe,addMinutesToTimeString:jn,convertTime:Th,getIsoDateString:I0,getUTCdateString:EF,DateHHMM:Owe,extractDate:ct,extractTime:fi,formatDate:us,getDateByWeek:jwe,isISODateString:Yd,isDate:ey,isTimeString:CF,offsetDate:y0,offsetTime:Fwe,sameDay:Bl,timeStringMinutes:Pt,timeToDate:er,timeUTC:xwe,validTimeValue:cv,validDateString:v0,timeValidation:Rd,dateValidation:$l};function Fe(t,e,i,r,n=0){if(cM().makeDeepCopy)return cM().makeDeepCopy(t,e,i,r);let a=vF(),{stringify:o,toJSON:s,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ta(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&n>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(m=>!i||!l||Array.isArray(l)&&!l.includes(m)||ta(l)&&!l(m)),p=(m,h)=>{u[m]=ta(h==null?void 0:h.toString)?h.toString():JSON.stringify(h)};for(let m of d){let h=t[m],f=ta(c)?c(h):void 0;if(f!==void 0)u[m]=f;else if(e&&m==="extensions"&&Array.isArray(h)){let g=NF(h);Object.assign(u,...g)}else r&&m==="extensions"?u[m]=[]:Array.isArray(o)&&o.includes(m)?p(m,h):Array.isArray(s)&&s.includes(m)&&ta(h==null?void 0:h.toJSON)?u[m]=h.toJSON():h===null?u[m]=void 0:Awe(h)?u[m]=new Date(h).toISOString():u[m]=Fe(h,e,i,r,n+1)}return u}function NF(t){return t==null?void 0:t.map(e=>{let{name:i,value:r}=e;return i&&r&&{[`_${i}`]:r}}).filter(Boolean)}var dM="voluntaryConsolation",su="competitiveBands",AF="roundRobinTally",Du="positionActions",Cr="matchUpActions",yS="rankingPoints",Jf="roundNaming",dv="participant",ty="progression",od="scheduling",iy="avoidance",zwe="display",Vl="scoring",Io="seeding",Xf="feedIn",Wwe="audit",U0="draws",qwe={POLICY_TYPE_VOLUNTARY_CONSOLATION:dM,POLICY_TYPE_COMPETITIVE_BANDS:su,POLICY_TYPE_ROUND_ROBIN_TALLY:AF,POLICY_TYPE_POSITION_ACTIONS:Du,POLICY_TYPE_MATCHUP_ACTIONS:Cr,POLICY_TYPE_RANKING_POINTS:yS,POLICY_TYPE_ROUND_NAMING:Jf,POLICY_TYPE_PARTICIPANT:dv,POLICY_TYPE_PROGRESSION:ty,POLICY_TYPE_SCHEDULING:od,POLICY_TYPE_AVOIDANCE:iy,POLICY_TYPE_DISPLAY:zwe,POLICY_TYPE_FEED_IN:Xf,POLICY_TYPE_SCORING:Vl,POLICY_TYPE_SEEDING:Io,POLICY_TYPE_AUDIT:Wwe,POLICY_TYPE_DRAWS:U0};function kc({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:r,internalUse:n,personId:a}){let o=t.find(l=>r&&l.participantId===r||a&&l.person&&l.person.personId===a),s=Fe(o,!1,n);if(s){let l=e==null?void 0:e[dv];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=uv({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return km({template:l.participant,source:s})}return s}var OF="element required",Ywe="missing name";function In(t){if(!t||typeof t!="object")return{error:Ve};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:oe};if(!(t!=null&&t.name))return{error:Ve,info:Ywe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],r=In({element:i,name:t.name});if(r.error)return ee({result:r,stack:"removeExtension"})}return{...Z}}return{error:Ve,info:OF}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...Z}):{...Z,info:on}}function Js({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(r=>i.includes(r)).length===t.length}function Mt(t){if(typeof t!="object")return{error:Ve};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ee({result:{error:oe},stack:e});if(!Js({extension:t.extension}))return ee({result:{error:oe,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let r of Object.values(t.tournamentRecords)){let n=Mt({extension:t.extension,element:r});if(n.error)return ee({result:n,stack:e})}return{...Z}}else return ee({result:{error:Ve},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let r=new Date().toISOString();Object.assign(t.extension,{createdAt:r})}let i=t.element.extensions.find(({name:r})=>r===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...Z}}function kF(t){return!t||typeof t!="object"?{error:Ve}:t.tournamentRecord?Mt({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:he}}function CP(t){return!t||typeof t!="object"?{error:Ve}:t.drawDefinition?Mt({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:ma}}function sd(t){return!t||typeof t!="object"?{error:Ve}:t.event?Mt({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:ha}}function M9(t){var e;if(!t||typeof t!="object")return{error:Ve};if(!t.participantId)return{error:vr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=kc({participantId:t.participantId,tournamentParticipants:i});return r?Mt({creationTime:t.creationTime,extension:t.extension,element:r}):{error:Ji}}function xF(t){return!t||typeof t!="object"?{error:Ve}:t.tournamentRecord?In({element:t.tournamentRecord,name:t.name}):{error:he}}function N9(t){return!t||typeof t!="object"?{error:Ve}:t.drawDefinition?In({element:t.drawDefinition,name:t.name}):{error:ma}}function MP(t){return!t||typeof t!="object"?{error:Ve}:t!=null&&t.event?In({element:t.event,name:t.name}):{error:ha}}function A9(t){var e;if(!t||typeof t!="object")return{error:Ve};if(!t.participantId)return{error:vr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],r=kc({participantId:t.participantId,tournamentParticipants:i});return r?In({element:r,name:t.name}):{error:Ji}}function ow({tournamentRecords:t}){return{tournamentIds:Ii(t)?Object.keys(t):[],...Z}}var Kwe="extensionQueries";function ft({discover:t,element:e,name:i,...r}){var n;if(!e||!i){if(t&&r){let o=Object.keys(r).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=r[c])==null?void 0:u.extensions)?r[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&r[o];!s&&r.tournamentRecords&&(s=Object.values(r.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(n=s==null?void 0:s.extensions)==null?void 0:n.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:on}}return ee({result:{error:Ve},stack:Kwe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:on}}var Jwe="activeSuspension",ry="appliedPolicies",S0="positionActions",O9="context",NP="delegatedOutcome",cs="disabled",AP="disableLinks",Zf="disableAutoCalc",T0="drawDeletions",Xwe="drawProfile",D0="entryProfile",Zwe="eventProfile",Qwe="eventWithdrawalRequests",eUe="factory",Fo="flightProfile",pM="groupingAttribute",Pu="lineUps",xm="linkedTournamentsIds",OP="matchUpHistory",FF="participantRepresentatives",pv="personRequests",tUe="rankingPoints",sl="roundTarget",sw="scheduleLimits",Ru="scheduleTiming",Fm="schedulingProfile",iUe="statusDetail",Qf="subOrder",xc="tally",Lm="tieFormatModification",k9={ACTIVE_SUSPENSION:Jwe,APPLIED_POLICIES:ry,AUDIT_POSITION_ACTIONS:S0,CONTEXT:O9,DELEGATED_OUTCOME:NP,DISABLED:cs,DISABLE_LINKS:AP,DISABLE_AUTO_CALC:Zf,DRAW_DELETIONS:T0,DRAW_PROFILE:Xwe,ENTRY_PROFILE:D0,EVENT_PROFILE:Zwe,EVENT_WITHDRAWAL_REQUESTS:Qwe,FLIGHT_PROFILE:Fo,GROUPING_ATTRIBUTE:pM,LINEUPS:Pu,LINKED_TOURNAMENTS:xm,MATCHUP_HISTORY:OP,PARTICIPANT_REPRESENTATIVES:FF,PERSON_REQUESTS:pv,RANKING_POINTS:tUe,ROUND_TARGET:sl,SCHEDULE_LIMITS:sw,SCHEDULE_TIMING:Ru,SCHEDULING_PROFILE:Fm,STATUS_DETAIL:iUe,SUB_ORDER:Qf,TALLY:xc,TIE_FORMAT_MODIFICATIONS:Lm,FACTORY:eUe},eV=[NP,cs,AP,Fo,Pu,OP,FF,pv,sl,sw,Ru,Fm,Qf,xc];function x9({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ai};let e=ow({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Mt({tournamentRecords:t,discover:!0,extension:{name:xm,value:{tournamentIds:i}}}):{...Z}}function F9({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ai};let e=In({name:xm,tournamentRecords:t,discover:!0});return ee({result:e,stack:"unlinkTournaments"})}function L9({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:oe};if(!e)return{error:Gf};let i=ow({tournamentRecords:t}),{tournamentIds:r}=i;if(!r.includes(e))return{error:Gf};let n;return r.every(a=>{var o;let s=t[a],{extension:l}=ft({element:s,name:xm});if(!l)return!0;let c=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(c!=null&&c.length)||c.length===1&&c.includes(e)||a===e){let p=xF({name:xm,tournamentRecord:s});return p.error&&(n=p.error),p.success}let u=c.filter(p=>p!==e);l.value={tournamentIds:u};let d=kF({tournamentRecord:s,extension:l});return d.error&&(n=d.error),d.success}),n?{error:n}:{...Z}}var _9={};yt(_9,{getLinkedTournamentIds:()=>lw,getTournamentIds:()=>ow});function lw({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Ai}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let r=t[e],n=r==null?void 0:r.tournamentId,{extension:a}=ft({element:r,name:xm}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==n);return{[e]:o}}))}}var $9={};yt($9,{addAdHocMatchUps:()=>uR,addDrawDefinitionTimeItem:()=>zL,addFinishingRounds:()=>mw,addGoesTo:()=>ip,addPlayoffStructures:()=>lR,addQualifyingStructure:()=>BJ,addVoluntaryConsolationStage:()=>_J,addVoluntaryConsolationStructure:()=>AL,allPlayoffPositionsFilled:()=>jL,alternateDrawPositionAssignment:()=>yJ,assignDrawPosition:()=>mX,assignDrawPositionBye:()=>$a,attachConsolationStructures:()=>uX,attachPlayoffStructures:()=>t_,attachQualifyingStructure:()=>HL,attachStructures:()=>sR,autoSeeding:()=>TRe,automatedPlayoffPositioning:()=>_w,automatedPositioning:()=>Lw,checkValidEntries:()=>mR,deleteAdHocMatchUps:()=>fX,drawMatic:()=>E_,findDrawDefinition:()=>o_,generateAdHocMatchUps:()=>hR,generateAdHocRounds:()=>R_,generateAndPopulatePlayoffStructures:()=>e_,generateDrawDefinition:()=>xR,generateDrawMaticRound:()=>I_,generateDrawStructuresAndLinks:()=>f_,generateDrawTypeAndModifyDrawDefinition:()=>g_,generateQualifyingStructure:()=>qL,generateVoluntaryConsolation:()=>GX,getAssignedParticipantIds:()=>Np,getAvailableMatchUpsCount:()=>cR,getAvailablePlayoffProfiles:()=>Bw,getDrawDefinitionTimeItem:()=>UL,getDrawParticipantRepresentativeIds:()=>n_,getDrawTypeCoercion:()=>Kw,getEligibleVoluntaryConsolationParticipants:()=>r_,getMatchUpsMap:()=>Zr,getParticipantIdFinishingPositions:()=>a_,getPositionAssignments:()=>fy,getPositionsPlayedOff:()=>Dv,getSeedingThresholds:()=>FL,getSeedsCount:()=>Jw,getStructureSeedAssignments:()=>ao,getTeamLineUp:()=>tp,getValidGroupSizes:()=>xw,isAdHoc:()=>va,isCompletedStructure:()=>Bc,isValidForQualifying:()=>h_,luckyLoserDrawPositionAssignment:()=>IJ,modifyDrawDefinition:()=>cX,modifyDrawName:()=>i_,modifySeedAssignment:()=>EJ,mutate:()=>B9,positionActions:()=>m_,pruneDrawDefinition:()=>pX,qualifierDrawPositionAssignment:()=>DJ,query:()=>IX,removeDrawPositionAssignment:()=>py,removeRoundMatchUps:()=>gX,removeSeededParticipant:()=>$J,removeStructure:()=>FJ,renameStructures:()=>xJ,resetDrawDefinition:()=>dX,resetVoluntaryConsolationStructure:()=>u8,setDrawParticipantRepresentativeIds:()=>V9,setPositionAssignments:()=>SJ,setStructureOrder:()=>OJ,setSubOrder:()=>vX,shiftAdHocRounds:()=>UJ,swapAdHocRounds:()=>TJ,swapDrawPositionAssignments:()=>RJ,updateTeamLineUp:()=>Fh,withdrawParticipantAtDrawPosition:()=>cJ});var B9={};yt(B9,{addAdHocMatchUps:()=>uR,addDrawDefinitionTimeItem:()=>zL,addPlayoffStructures:()=>lR,addQualifyingStructure:()=>BJ,addVoluntaryConsolationStage:()=>_J,addVoluntaryConsolationStructure:()=>AL,alternateDrawPositionAssignment:()=>yJ,assignDrawPosition:()=>mX,assignDrawPositionBye:()=>$a,attachConsolationStructures:()=>uX,attachPlayoffStructures:()=>t_,attachQualifyingStructure:()=>HL,attachStructures:()=>sR,automatedPlayoffPositioning:()=>_w,automatedPositioning:()=>Lw,deleteAdHocMatchUps:()=>fX,luckyLoserDrawPositionAssignment:()=>IJ,modifyDrawDefinition:()=>cX,modifyDrawName:()=>i_,modifySeedAssignment:()=>EJ,pruneDrawDefinition:()=>pX,qualifierDrawPositionAssignment:()=>DJ,removeDrawPositionAssignment:()=>py,removeRoundMatchUps:()=>gX,removeSeededParticipant:()=>$J,removeStructure:()=>FJ,renameStructures:()=>xJ,resetDrawDefinition:()=>dX,resetVoluntaryConsolationStructure:()=>u8,setDrawParticipantRepresentativeIds:()=>V9,setPositionAssignments:()=>SJ,setStructureOrder:()=>OJ,setSubOrder:()=>vX,shiftAdHocRounds:()=>UJ,swapAdHocRounds:()=>TJ,swapDrawPositionAssignments:()=>RJ,updateTeamLineUp:()=>Fh,withdrawParticipantAtDrawPosition:()=>cJ});var LF=t=>e=>t[e],_F=(t=[])=>t.map(wr).filter(Boolean),mM=(t=[])=>t.map(bt).filter(Boolean),bt=(t={})=>LF(t)("participantId"),wr=(t={})=>LF(t)("matchUpId"),ny=(t={})=>LF(t)("drawId");function V9({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:ma};if(!Array.isArray(t))return{error:oe};let i=mM((e==null?void 0:e.entries)||[]);return t.length&&Hi(t,i).length<t.length?{error:oe}:CP({drawDefinition:e,extension:{name:FF,value:t}})}var Ca="ABANDONED",Dh="AWAITING_RESULT",Ft="BYE",Yu="CANCELLED",Zi="COMPLETED",mv="DEAD_RUBBER",Ot="DEFAULTED",hr="DOUBLE_DEFAULT",ir="DOUBLE_WALKOVER",Yo="IN_PROGRESS",Xs="INCOMPLETE",$F="NOT_PLAYED",dn="RETIRED",ld="SUSPENDED",zi="TO_BE_PLAYED",jt="WALKOVER",rUe=[Dh,Zi,Ot,Yo,Xs,dn,ld],j9=[Dh,Zi,Ot,ir,hr,Yo,Xs,dn,ld,jt],G9=[Ca,Dh,Ft,Yu,Zi,mv,Ot,ir,hr,Yo,Xs,$F,dn,ld,zi,jt],H9=[Ft,ir,hr,Zi,Ot,dn,jt],z9=[Ca,Dh,Yu,mv,Yo,Xs,$F,ld,zi,void 0],Sr=[Yu,Ca,Zi,mv,Ot,ir,hr,dn,jt],BF=[Ca,Zi,Ot,ir,hr,Yo,dn,jt],W9=[Yo,Xs,ld,zi],q9={ABANDONED:Ca,AWAITING_RESULT:Dh,BYE:Ft,CANCELLED:Yu,COMPLETED:Zi,DEAD_RUBBER:mv,DEFAULTED:Ot,DOUBLE_WALKOVER:ir,DOUBLE_DEFAULT:hr,IN_PROGRESS:Yo,INCOMPLETE:Xs,NOT_PLAYED:$F,RETIRED:dn,SUSPENDED:ld,TO_BE_PLAYED:zi,WALKOVER:jt},Oe="MAIN",qe="QUALIFYING",Yr="CONSOLATION",Mr="VOLUNTARY_CONSOLATION",Fi="PLAY_OFF",VF=[Oe,qe,Yr,Fi,Mr],_m={[qe]:1,[Oe]:2,[Fi]:3,[Yr]:3,[Mr]:4},Y9="finishingPositions",K9="aggregateEventStructures",J9={[Oe]:1,[Fi]:2,[Yr]:3,[qe]:4,[Mr]:5},nUe={[Fi]:1,[Oe]:2,[Yr]:3,[qe]:4,[Mr]:5},kP="CLUSTER",aUe="SEPARATE",Kd="WATERFALL",xP="ITEM",Cn="CONTAINER",rs="DRAW",FP="RANDOM",So="TOP_DOWN",Jd="BOTTOM_UP",Eu="POSITION",Cu="WINNER",jl="LOSER",Gl="FIRST_MATCHUP",Lo="AD_HOC",oUe="AD_HOC",hv="FEED_IN",eg="COMPASS",tg="OLYMPIC",sUe="SINGLE_ELIMINATION",Bs="SINGLE_ELIMINATION",uw="DOUBLE_ELIMINATION",ig="FIRST_MATCH_LOSER_CONSOLATION",cw="FIRST_ROUND_LOSER_CONSOLATION",Up="LUCKY_DRAW",LP="CURTIS_CONSOLATION",lUe="CURTIS_CONSOLATION",jF="FEED_IN_CHAMPIONSHIP_TO_SF",ay="FEED_IN_CHAMPIONSHIP_TO_SF",GF="FEED_IN_CHAMPIONSHIP_TO_QF",oy="FEED_IN_CHAMPIONSHIP_TO_QF",HF="FEED_IN_CHAMPIONSHIP_TO_R16",sy="FEED_IN_CHAMPIONSHIP_TO_R16",X9="MODIFIED_FEED_IN_CHAMPIONSHIP",ly="MODIFIED_FEED_IN_CHAMPIONSHIP",dw="FEED_IN_CHAMPIONSHIP",_o="ROUND_ROBIN",Hl="ROUND_ROBIN_WITH_PLAYOFF",Z9="DECIDER",Q9="BACKDRAW",zF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},WF={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},fv="WIN_RATIO",Ph="ROUND_OUTCOME",e8=[eg,LP,oy,sy,ay,dw,GF,HF,jF,ig,cw,Up,ly,tg,Fi,Hl],uUe=[Lo,eg,LP,uw,oy,sy,ay,dw,hv,ig,cw,Up,ly,tg,Fi,_o,Hl,Bs],t8={MAIN:Oe,QUALIFYING:qe,CONSOLATION:Yr,ITEM:xP,CONTAINER:Cn,FIRST_MATCHUP:Gl,WINNER:Cu,LOSER:jl,AD_HOC:Lo,FEED_IN:hv,FLEX_ROUNDS:oUe,COMPASS:eg,PLAY_OFF:Fi,OLYMPIC:tg,KNOCKOUT:sUe,SINGLE_ELIMINATION:Bs,DOUBLE_ELIMINATION:uw,CURTIS:LP,FICSF:jF,FICQF:GF,FICR16:HF,MFIC:X9,VOLUNTARY_CONSOLATION:Mr,FIRST_MATCH_LOSER_CONSOLATION:ig,FIRST_ROUND_LOSER_CONSOLATION:cw,MODIFIED_FEED_IN_CHAMPIONSHIP:ly,FEED_IN_CHAMPIONSHIP_TO_R16:sy,FEED_IN_CHAMPIONSHIP_TO_QF:oy,FEED_IN_CHAMPIONSHIP_TO_SF:ay,FEED_IN_CHAMPIONSHIP:dw,LUCKY_DRAW:Up,ROUND_ROBIN_WITH_PLAYOFF:Hl,ROUND_ROBIN:_o,DECIDER:Z9,BACKDRAW:Q9,COMPASS_ATTRIBUTES:zF,OLYMPIC_ATTRIBUTES:WF,DRAW:rs,RANDOM:FP,TOP_DOWN:So,BOTTOM_UP:Jd,WATERFALL:Kd,WIN_RATIO:fv,ROUND_OUTCOME:Ph,MULTI_STRUCTURE_DRAWS:e8,generatedDrawTypes:uUe,stageOrder:_m,finishOrder:J9,AGGREGATE_EVENT_STRUCTURES:K9,FINISHING_POSITIONS:Y9},cUe=t8;function Rh(t,e,i){var r,n;let a=m=>{var h,f;return(f=(h=ft({element:m,name:sl}))==null?void 0:h.extension)==null?void 0:f.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===K9&&nUe,l=(i==null?void 0:i.mode)===Y9&&J9,c=l||s||_m,u=m=>(m==null?void 0:m.stage)===Oe&&(m==null?void 0:m.stageSequence)===1,d=m=>u(m)?-1:c[m==null?void 0:m.stage],p=m=>m==null?void 0:m.matchUps.every(({matchUpStatus:h})=>Sr.includes(h)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&c[t.stage]||0)-((e==null?void 0:e.stage)&&c[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((r=e==null?void 0:e.positionAssignments)==null?void 0:r.length)??1/0)-(((n=t==null?void 0:t.positionAssignments)==null?void 0:n.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(P0(t)||0)-(P0(e)||0)}function P0(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function et(t){let e=kt(t,[{[Rs]:!0,[SF]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:r}=t,{structures:n}=zl({drawDefinition:i}),a=n==null?void 0:n.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===r);if(!o)return{error:Ri};let s=o.structureType===xP?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===r)}):void 0;return{structure:o,containingStructure:s}}function zl({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:r,roundTarget:n,sortConfig:a,stages:o,stage:s}){var l;let c=!e&&Ce||!(e!=null&&e.structures)&&Wx||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let u=f=>{var g,v;let I=(v=(g=ft({element:f,name:sl}))==null?void 0:g.extension)==null?void 0:v.value;return!n||n===I},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(m).filter(h).filter(u).sort((f,g)=>Rh(f,g,a)))??[],p=t?Object.assign({},...VF.map(f=>{let g=d==null?void 0:d.filter(v=>v.stage===f);return(g==null?void 0:g.length)&&{[f]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function m(f){return!s&&!Array.isArray(o)||s&&f.stage===s||Array.isArray(o)&&o.includes(f.stage)}function h(f){return!r&&!Array.isArray(i)||r&&f.stageSequence===r||Array.isArray(i)&&i.includes(f.stageSequence)}}function i8({drawDefinition:t}){if(!t)return{error:Ce};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let r=i.stage;e[r]||(e[r]=[]);let{positionAssignments:n}=ei({structure:i}),a=(n==null?void 0:n.map(bt).filter(Boolean))??[];return e[r].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function ei({drawDefinition:t,structureId:e,structure:i}){let r,n=[];if(!i){if(!t)return{positionAssignments:n,error:Ce};if({structure:i,error:r}=et({drawDefinition:t,structureId:e}),r)return{positionAssignments:n,error:r}}return i.structures?n=[].concat(...i.structures.map(a=>ei({structure:a}).positionAssignments)):i.positionAssignments?n=i.positionAssignments:r=pK,{positionAssignments:n,error:r}}function Tr({drawDefinition:t,structureId:e,structure:i}){var r;let n=((r=ei({drawDefinition:t,structureId:e,structure:i}))==null?void 0:r.positionAssignments)||[],a=n==null?void 0:n.filter(u=>u.participantId??u.bye??u.qualifier),o=n&&(n==null?void 0:n.length)===(a==null?void 0:a.length),s=n==null?void 0:n.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),l=n==null?void 0:n.filter(u=>!u.participantId&&u.bye),c=n==null?void 0:n.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:o,positionAssignments:n,unassignedPositions:s,assignedPositions:a,qualifierPositions:c,byePositions:l}}var qF="addDrawDefinition",_P="addMatchUps",Fc="addParticipants",YF="addScaleItems",KF="addVenue",rg="audit",JF="deleteParticipants",XF="deleteVenue",ZF="deletedDrawIds",QF="deletedMatchUpIds",eL="modifyDrawDefinition",r8="modifyDrawEntries",n8="modifyEventEntries",tL="modifyMatchUp",Kr="modifyParticipants",iL="modifyPositionAssignments",rL="modifySeedAssignments",a8="modifyTournamentDetail",Sp="modifyVenue",hM="mutations",fM="publishEvent",o8="publishEventSeeding",s8="publishOrderOfPlay",nL="unPublishEvent",aL="unPublishEventSeeding",oL="unPublishOrderOfPlay",$P="updateInContextMatchUp",dUe={ADD_DRAW_DEFINITION:qF,ADD_MATCHUPS:_P,ADD_PARTICIPANTS:Fc,ADD_SCALE_ITEMS:YF,ADD_VENUE:KF,AUDIT:rg,DELETE_PARTICIPANTS:JF,DELETE_VENUE:XF,DELETED_DRAW_IDS:ZF,DELETED_MATCHUP_IDS:QF,MODIFY_DRAW_DEFINITION:eL,MODIFY_DRAW_ENTRIES:r8,MODIFY_EVENT_ENTRIES:n8,MODIFY_MATCHUP:tL,MODIFY_PARTICIPANTS:Kr,MODIFY_POSITION_ASSIGNMENTS:iL,MODIFY_SEED_ASSIGNMENTS:rL,MODIFY_TOURNAMENT_DETAIL:a8,MODIFY_VENUE:Sp,MUTATIONS:hM,PUBLISH_EVENT_SEEDING:o8,PUBLISH_EVENT:fM,PUBLISH_ORDER_OF_PLAY:s8,UNPUBLISH_EVENT_SEEDING:aL,UNPUBLISH_EVENT:nL,UNPUBLISH_ORDER_OF_PLAY:oL,UPDATE_INCONTEXT_MATCHUP:$P};function BP(t,e){var i;if(!t)return{error:Ce};let r=Date.now();t.updatedAt&&r===new Date(t.updatedAt).getTime()&&(r+=1);let n=new Date(r).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=n)}),{...Z}}function Lc({drawDefinition:t,tournamentId:e,matchUps:i,eventId:r}){return t&&BP(t),Tt({payload:{matchUps:i,tournamentId:e,eventId:r},topic:_P}),{...Z}}function Ku({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:r,action:n}){t&&BP(t),Tt({topic:QF,payload:{tournamentId:e,matchUpIds:i,eventId:r,action:n}});for(let a of i)yF({key:a});return{...Z}}function Et({drawDefinition:t,tournamentId:e,structureId:i,context:r,eventId:n,matchUp:a}){return a?(t&&pi({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:n}),Tt({topic:tL,payload:{matchUp:a,tournamentId:e,context:r},key:a.matchUpId}),{...Z}):(console.log(Yn),{error:Yn})}function pUe({tournamentId:t,inContextMatchUp:e}){return e?(Tt({payload:{inContextMatchUp:e,tournamentId:t},topic:$P,key:e.matchUpId}),{...Z}):{error:Yn}}function pw({tournamentId:t,eventId:e,drawDefinition:i}){return i?(BP(i),Tt({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:qF,key:i.drawId}),{...Z}):(console.log(Ce),{error:Ce})}function mUe({tournamentId:t,eventId:e,drawId:i}){return Tt({payload:{drawId:i,tournamentId:t,eventId:e},topic:ZF,key:i}),yF({key:i}),{...Z}}function pi({drawDefinition:t,tournamentId:e,structureIds:i,eventId:r}){return t?(BP(t,i),Tt({payload:{tournamentId:e,eventId:r,drawDefinition:t},topic:eL,key:t.drawId}),{...Z}):{error:Ce}}function l8({drawDefinition:t,tournamentId:e,structure:i,eventId:r}){if(!t)return{error:Ce};if(!i)return{error:td};let n=i.seedAssignments,a=i.structureId,o=t.drawId;return Tt({payload:{tournamentId:e,eventId:r,drawId:o,structureId:a,seedAssignments:n},topic:rL,key:t.drawId}),pi({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:r}),{...Z}}function _c({drawDefinition:t,tournamentId:e,structure:i,event:r}){if(!t)return{error:Ce};if(!i)return{error:td};let n=ei({structure:i}),a=i.structureId,o=t.drawId,s=r==null?void 0:r.eventId;return Tt({topic:iL,payload:{positionAssignments:n,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),pi({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...Z}}function u8({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:r}){var n,a;if(!e)return{error:Ce};let o=(n=e.structures)==null?void 0:n.find(l=>l.stage===Mr);if(!o)return{error:Ri};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],Ku({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Mr)),pi({tournamentId:t==null?void 0:t.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...Z}}function sL({drawPositions:t,structure:e}){var i;if([qe,Oe].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:r}=ei({structure:e});(i=r==null?void 0:r.filter(({drawPosition:n})=>t==null?void 0:t.includes(n)))==null||i.forEach(n=>{Mt({element:n,extension:{name:AP,value:!0}})})}function VP({drawDefinition:t,positionAction:e}){var i;let{extension:r}=ft({name:S0,element:t}),n=Array.isArray(r==null?void 0:r.value)?(r==null?void 0:r.value)??[]:[];if(!(n!=null&&n.length)){let o=t.structures.find(s=>s.stage===Oe);if(o){let s=(i=ei({structure:o}).positionAssignments)==null?void 0:i.map(({drawPosition:l,participantId:c,bye:u,qualifier:d})=>({drawPosition:l,participantId:c,qualifier:d,bye:u}));n.push({name:"initialMainAssignments",initialAssignments:s})}}let a={name:S0,value:n.concat(e)};Mt({element:t,extension:a})}function gv({tournamentRecord:t,drawDefinition:e,event:i}){var r;let n=((r=(t==null?void 0:t.events)||i&&[i])==null?void 0:r.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=n.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of s){let{structures:c,structureId:u}=l??{};c&&u&&(a[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}var pm="SINGLES",Ni="SINGLES",Xd="DOUBLES",ui="DOUBLES",Zs="TEAM",di="TEAM",hUe={SINGLES_MATCHUP:pm,SINGLES:Ni,DOUBLES_MATCHUP:Xd,DOUBLES:ui,TEAM_MATCHUP:Zs,TEAM:di};function jP(t){var e;let{sides:i,matchUpType:r}=t||{},n=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>r===ui?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return r===ui&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(n).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:n}}function ll(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}function GP(t){if(!Ii(t))return!1;let{matchUpId:e,drawPositions:i}=t,r=typeof e=="string",n=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>nt(a)||a===void 0||a===null);return r&&n}function po(t){return Array.isArray(t)?t.every(GP):!1}function Pn({matchUps:t=[],interpolate:e}){var i;if(!po(t))return{roundMatchUps:[],error:oe};let r=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Xe(m.roundNumber):m.roundNumber;return!m.roundNumber||p.includes(h)?p:p.concat(h)},[]).sort(sr).map(p=>{let m=t.filter(g=>g.roundNumber===p),h=m.find(({matchUpType:g})=>g===di)?m.filter(({matchUpType:g})=>g===di):m,f=g=>g.sort((v,I)=>sr(v.roundPosition,I.roundPosition));return{[p]:f(h)}}),n=t.reduce((p,m)=>{let h=typeof m.roundNumber=="string"?Xe(m.roundNumber):m.roundNumber;return p[h]||(p[h]=He({abbreviatedRoundName:m.abbreviatedRoundName,finishingRound:m.finishingRound,roundName:m.roundName})),p},{}),a=Object.assign({},...r);if(e){let p=Math.max(...Object.keys(a).map(h=>Xe(h)).filter(h=>!isNaN(h))),m=(i=a[p])==null?void 0:i.length;if(m>1&&ws(m)){let h=p+1,f=h+m/2;Ee(h,f).forEach((g,v)=>{a[g]=Ee(0,m/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var m,h,f;let g=(m=a[p])==null?void 0:m.length,v=(f=(h=a[p])==null?void 0:h.filter(y=>{var b;return!Sr.includes(y.matchUpStatus)&&!((b=y.score)!=null&&b.scoreStringSide1)}))==null?void 0:f.length,I=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:I}}})),l=0,c=0,u=Object.keys(a).map(p=>Xe(p)).filter(p=>!isNaN(p));u.forEach(p=>{var m,h,f,g,v;let I=a[p].sort((b,S)=>b.roundPosition-S.roundPosition),y=I.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,s[p].roundName=(h=n[p])==null?void 0:h.roundName,s[p].abbreviatedRoundName=(f=n[p])==null?void 0:f.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let b=y.sort(sr),S=xr(b,2);s[p].drawPositions=b,s[p].pairedDrawPositions=S}else{let b=s[p-1],S=b.drawPositions,w=b.matchUpsCount/s[p].matchUpsCount,U=xr(S,w),T=I.map(P=>{let{roundPosition:R}=P,D=[...P.drawPositions||[],void 0,void 0].slice(0,2);if(!R)return D;let E=(D==null?void 0:D.filter(Boolean))||[];if(!(E!=null&&E.length))return[void 0,void 0];if(p<3&&(E==null?void 0:E.length)===2)return D==null?void 0:D.slice().sort(sr);let N=Hi(S,E).length!==(E==null?void 0:E.length);if(E!=null&&E.length&&N)return(E==null?void 0:E.length)===1?[E[0],void 0]:D==null?void 0:D.slice().sort(sr);let A=(R-1)*2;return U.slice(A,A+2).map(M=>E==null?void 0:E.find(C=>M.includes(C)))});s[p].drawPositions=T==null?void 0:T.flat(),s[p].pairedDrawPositions=T}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=c,s[p].preFeedRound=!0,c+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!ws(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:u,roundProfile:s,...Z}}function mm({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=Fe(t),r=e.split("."),n=[],a;s({targetElement:i,attributes:r});let o={value:a};return n.length&&(o.values=n),o;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,m]of c.entries())if(l!=null&&l[m]){let h=c.slice(p+1);h.length?Array.isArray(l[m])?l[m].forEach(f=>s({targetElement:f,attributes:h})):(l=l[m],d({targetElement:l,index:p})):(a||(a=l[m]),n.includes(l[m])||n.push(l[m]))}function d({targetElement:p,index:m}){if(p&&m===c.length-1&&["string","number"].includes(typeof p)){let h=u?p.slice(0,u):p;a?n.includes(h)||n.push(h):(a=h,n.push(h))}}}}var c8=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(r=>{var n;return{[r]:(n=mm({element:e,accessor:r}))==null?void 0:n.value}})||typeof t=="object"&&Object.keys(t).map(r=>{var n;return{[r]:(n=mm({element:e,accessor:r}))==null?void 0:n.value}})||((i=typeof t=="string"&&mm({element:e,accessor:t}))==null?void 0:i.value)},ga=c8;function mw({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:r,roundLimit:n,matchUps:a,lucky:o,fmlc:s}){var l;if(!po(a))return[];let{roundProfile:c,roundNumbers:u=[]}=Pn({interpolate:!0,matchUps:a});r=r??Math.max(...u,0);let d=n?r-n:0,p=d&&((l=c==null?void 0:c[r-d])==null?void 0:l.matchUpsCount),m=c&&Object.values(c).map(ga("matchUpsCount")),h=(v,I)=>{let y=Math.min(...v);p&&I&&y===1&&(y=p);let b=Math.max(...v);return e&&b>e&&(b=e),[y,b]},f=c&&Object.assign({},...u.map(v=>{let I=(r??0)+1-v-d,y=c[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:I},S=m==null?void 0:m.slice(v-1).reduce((N,A)=>N+(A||0),0),w=s&&v!==1,U=1+t+(w?i??0:0),T=1,P=Ee(U,o?U+y*2:S+U+T),R=S+T-y,D=h(P.slice(R)),E=h(P.slice(0,R),!0);return b.finishingPositionRange={loser:D,winner:E},{[v]:b}})),g=no({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let I=v.roundNumber&&f[v.roundNumber];g&&!I&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=I==null?void 0:I.finishingRound,v.finishingPositionRange=I==null?void 0:I.finishingPositionRange}),a}function Zr({drawDefinition:t,structure:e}){let i={},r=[];return((t==null?void 0:t.structures)??[e]).filter(n=>n&&typeof n=="object").forEach(n=>{if(!n)return;let{structureId:a,matchUps:o,structures:s}=n,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(r.push(...d),d.forEach(p=>{p.tieMatchUps&&r.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=o;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{r.push(u),u.tieMatchUps&&r.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:r}}function Zd({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:r}){t=(e==null?void 0:e.mappedMatchUps)??t;let n=t[i],a=((n==null?void 0:n.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return r?s.map(c=>Object.assign(Fe(c,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((n==null?void 0:n.matchUps)||[]).concat(...a)}var hw="SIGN_IN_STATUS",d8="SIGNED_OUT",uy="SIGNED_IN",Za="TEAM",wt="INDIVIDUAL",_a="GROUP",st="PAIR",ii="TEAM",nI={TEAM_PARTICIPANT:Za,INDIVIDUAL:wt,GROUP:_a,TEAM:ii,PAIR:st},fUe={INDIVIDUAL:wt,GROUP:_a,PAIR:st,TEAM:ii,SIGN_IN_STATUS:hw,SIGNED_OUT:d8,SIGNED_IN:uy};function lL({participantsProfile:t,participants:e=[],deepCopy:i}){let r=new Map,n=i!==!1?Fe(e,t==null?void 0:t.convertExtensions,!0):e,a=n.filter(l=>l.participantType===ii),o=n.filter(l=>l.participantType===_a),s=n.filter(l=>l.participantType===st);return n.forEach(l=>{if(l.participantType===wt){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),r.get(u.participantId)||r.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:n,groupInfo:Object.fromEntries(r)}}function uL({drawDefinition:t,attributes:e}){let{extension:i}=ft({element:t,name:D0}),r=(i==null?void 0:i.value)||{};return e.forEach(n=>{Object.keys(n).forEach(a=>{r[a]?Object.assign(r[a],n[a]):r[a]=n[a]})}),i={name:D0,value:r},CP({drawDefinition:t,extension:i}),{entryProfile:r}}function fw({drawDefinition:t}){let{extension:e}=ft({element:t,name:D0});return{entryProfile:(e==null?void 0:e.value)||{}}}var Ro="ALTERNATE",gw="CONFIRMED",Ma="DIRECT_ACCEPTANCE",vw="FEED_IN",Iw="JUNIOR_EXEMPT",Mu="LUCKY_LOSER",yw="ORGANISER_ACCEPTANCE",bw="QUALIFIER",gUe="REGISTERED",ww="SPECIAL_EXEMPT",Ko="UNGROUPED",Tp="UNPAIRED",ng="WILDCARD",Nu="WITHDRAWN",bS=[gw,Ma,Iw,yw,ww],p8=[vw,Mu,bw],Dp=[gw,Ma,vw,Iw,yw,ww,ng],Jo=[gw,Ma,Iw,Mu,bw,yw,ww,ng],m8=[Ro,gw,Ma,vw,Iw,Mu,yw,bw,gUe,ww,Ko,Tp,ng,Nu],vUe={ALTERNATE:Ro,CONFIRMED:gw,DIRECT_ACCEPTANCE:Ma,DIRECT_ENTRY_STATUSES:Dp,DRAW_SPECIFIC_STATUSES:p8,EQUIVALENT_ACCEPTANCE_STATUSES:bS,FEED_IN:vw,JUNIOR_EXEMPT:Iw,LUCKY_LOSER:Mu,ORGANISER_ACCEPTANCE:yw,QUALIFIER:bw,SPECIAL_EXEMPT:ww,STRUCTURE_SELECTED_STATUSES:Jo,UNGROUPED:Ko,UNPAIRED:Tp,VALID_ENTRY_STATUSES:m8,WILDCARD:ng,WITHDRAWN:Nu};function cL({stage:t,drawDefinition:e}){let{entryProfile:i}=fw({drawDefinition:e}),r=Object.keys(i).includes(t);if(!r&&VF.includes(t)){let n=[{[t]:{drawSize:void 0,alternates:!0}}];return uL({drawDefinition:e,attributes:n}),!0}return r}function IUe({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=fw({drawDefinition:e});return((i=r[t])==null?void 0:i.alternates)||0}function yUe({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=fw({drawDefinition:e});return((i=r[t])==null?void 0:i.wildcardsCount)||0}function gM({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((r,n)=>n.entryStage===t&&n.entryStatus===i?r+1:r,0)}function Eh({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:r,entryStatuses:n,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var m,h;let f=(h=(m=ft({name:sl,element:p}))==null?void 0:m.extension)==null?void 0:h.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!n||p.entryStatus&&n.includes(p.entryStatus),I=p.entryStageSequence??1;return g&&(!r||I===r)&&v&&(!o||!f||o===f)?d.concat(p):d},[]))??[];if(a&&l===Fi){let{playoffEntries:d,error:p}=bUe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(m=>!e||m.placementGroup===e)}return u}function bUe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let r=[],n=(e.links??[]).find(a=>a.linkType===Eu&&a.target.structureId===i);if(n){let{finishingPositions:a,structureId:o}=n.source,{structure:s}=et({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===Cn&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(f=>{var g;let{participantId:v}=f,I=(g=ft({element:f,name:xc}).extension)==null?void 0:g.value;return I&&v?{[v]:I}:void 0}).filter(Boolean)),m=Object.keys(p).reduce((f,g)=>{let v=p[g],I=v.groupOrder||t&&v.provisionalOrder;return f.includes(I)||f.push(I),f},[]).length===Object.keys(p).length,h=Object.keys(p).filter(f=>{let g=p[f],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||m)&&h.forEach(f=>{let g=p[f],{groupOrder:v,provisionalOrder:I,GEMscore:y}=g,b=v||t&&I,S=[...a??[]].sort(sr).indexOf(b)+1;r.push({entryStage:Fi,entryStatus:vw,placementGroup:S,groupingValue:d,participantId:f,GEMscore:y})})})}return{playoffEntries:r}}function wUe({stage:t,drawDefinition:e}){return Dp.reduce((i,r)=>(gM({drawDefinition:e,entryStatus:r,stage:t})||0)+i,0)}function ao({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:r,structure:n}){var a;let o,s=[];n||({structure:n,error:o}=et({drawDefinition:i,structureId:r}));let l=ei({structure:n}).positionAssignments;if(o||!n)return{seedAssignments:[],error:Ri};r||(r=n.structureId);let{stage:c,stageSequence:u}=n,d=c===Fi&&i&&Eh({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:r,stage:c}),p=d?d.filter(f=>f.placementGroup===1).sort((f,g)=>f.GEMscore<g.GEMscore&&1||f.GEMscore>g.GEMscore&&-1||0).map((f,g)=>{let v=g+1;return{participantId:f.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],m=p==null?void 0:p.slice(0,e?p.length:l.length/2);m.length?s=m:n.seedAssignments?s=n.seedAssignments:o=rK;let h=n.seedLimit??((a=n==null?void 0:n.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:u,seedLimit:h,stage:c,error:o}}var h8="WALKOVER",tV="RETIRED",dL="COMPETITIVE",cy="ROUTINE",dy="DECISIVE",wS="winRatio",UUe=(t,e)=>(t||0)+(e||0);function f8(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&h8||i<=e[dy]&&dy||i<=e[cy]&&cy||dL}function g8({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((n,a)=>(n[0]+=a.side1Score||0,n[1]+=a.side2Score||0,n),[0,0]),r=e.reduce((n,a)=>(n[0]+=a.side1TiebreakScore||0,n[1]+=a.side2TiebreakScore||0,n),[0,0]);return r.reduce(UUe)&&(i[r[0]>r[1]?0:1]+=1),{sets:e,games:i,score:t}}function SUe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function v8(t){return t.map(SUe).sort().map(e=>parseFloat(e.toFixed(2)))}function Gt({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:r,structure:n,event:a}){if(!Array.isArray(e))return{error:Xx};let o={};return i&&s(i),a&&s(a),r&&s(r),n&&s(n),{appliedPolicies:o,...Z};function s(l){var c,u;let d=(u=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===ry))==null?void 0:u.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=Fe(d[p],!1,!0))}}function Ju({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:r,event:n}){if(!Array.isArray(t))return{error:Xx};let{appliedPolicies:a}=Gt({tournamentRecord:e,drawDefinition:i,structure:r,event:n}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:Wf.message}}function Pp({tournamentRecord:t,drawDefinition:e,policyType:i,structure:r,event:n}){if(!t)return{error:he};let{appliedPolicies:a}=Gt({tournamentRecord:t,drawDefinition:e,structure:r,event:n});return a!=null&&a[i]?{policy:a[i]}:{info:Wf==null?void 0:Wf.message}}var TUe={[su]:{policyName:"Competitive Bands Default",profileBands:{[dy]:20,[cy]:50}}},pL=TUe;function Uw({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Yn};let{score:r,winningSide:n}=i;if(!n)return{error:oe};let a=!e&&t&&Pp({policyType:su,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||pL[su].profileBands,s=g8({score:r}),l=v8([s]),c=f8(l,o),u=Array.isArray(l)?l[0]:l;return{...Z,competitiveness:c,pctSpread:u}}function I8({matchUp:t}){var e,i,r;if(!t)return{error:Yn};if(t&&!t.sides)return{error:kn};if(t&&!t.hasContext)return{error:yP};let n=(e=t.sides??[])==null?void 0:e.map(c=>c==null?void 0:c.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===wt}).map(c=>c.participantId).filter(Boolean))??[],o=(((r=t.sides??[])==null?void 0:r.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=ht(s.concat(n)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:n,...Z}}var R0="CHECK_IN",E0="CHECK_OUT",DUe="SCHEDULE",vv="SCHEDULE.ASSIGNMENT.VENUE",Au="SCHEDULE.ALLOCATION.COURTS",Qd="SCHEDULE.ASSIGNMENT.COURT",mL="SCHEDULE.COURT.ORDER",Iv="SCHEDULE.DATE",PUe="COMPLETED.DATE",y8="SCHEDULE.ASSIGN.OFFICIAL",yv="SCHEDULE.TIME.SCHEDULED",ns="SCHEDULE.TIME.START",pu="SCHEDULE.TIME.STOP",Dl="SCHEDULE.TIME.RESUME",Ou="SCHEDULE.TIME.END",hL="SCHEDULE.TIME.MODIFIERS",b8="TO_BE_ANNOUNCED",w8="NEXT_AVAILABLE",U8="FOLLOWED_BY",S8="AFTER_REST",T8="RAIN_DELAY",RUe="NOT_BEFORE",vM=[b8,w8,U8,S8,T8],EUe="ELIGIBILITY",CUe="REGISTRATION",MUe="SUSPENSION",NUe="MEDICAL",AUe="PENALTY",D8="SCALE",P8="RATING",R8="RANKING",fL="SEEDING",Rp="PUBLISH",Xo="PUBLIC",Ep="STATUS",OUe="MODIFICATION",kUe="RETRIEVAL",xUe="other",FUe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:vM,AFTER_REST:S8,ALLOCATE_COURTS:Au,ASSIGN_COURT:Qd,ASSIGN_OFFICIAL:y8,ASSIGN_VENUE:vv,CHECK_IN:R0,CHECK_OUT:E0,COMPLETED_DATE:PUe,COURT_ORDER:mL,ELIGIBILITY:EUe,END_TIME:Ou,FOLLOWED_BY:U8,MEDICAL:NUe,MODIFICATION:OUe,NEXT_AVAILABLE:w8,NOT_BEFORE:RUe,OTHER:xUe,PENALTY:AUe,PUBLIC:Xo,PUBLISH:Rp,RANKING:R8,RATING:P8,RAIN_DELAY:T8,REGISTRATION:CUe,RESUME_TIME:Dl,RETRIEVAL:kUe,SCALE:D8,SCHEDULE:DUe,SCHEDULED_DATE:Iv,SCHEDULED_TIME:yv,SEEDING:fL,START_TIME:ns,STATUS:Ep,STOP_TIME:pu,SUSPENSION:MUe,TIME_MODIFIERS:hL,TO_BE_ANNOUNCED:b8};function Ch({matchUp:t}){if(!t)return{error:Yn};if(!t.hasContext)return{error:yP};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:kn};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:r}=I8({matchUp:t}),n=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[R0,E0].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=n.map(s=>s.itemValue).filter(s=>n.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===R0);e==null||e.forEach((s,l)=>{let c=r==null?void 0:r[l],u=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),r==null||r.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let o=r==null?void 0:r.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...Z}}var E8={[Ni]:[Ni,"S"],[ui]:[ui,"D"],[di]:[di,"T"],S:[Ni,"S"],D:[ui,"D"],T:[di,"T"]},Bi=t=>e=>{let i=Ii(e)&&(e==null?void 0:e.matchUpType)||On(e)&&e;return i&&E8[t].includes(i)};function aI(t){var e;let{matchUpAverageTimes:i,matchUpFormat:r}=t||{},n=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===r)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=n.includes(r)?r:n[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function oI(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:r,matchUpFormat:n}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&r){let{greaterThan:l=0,lessThan:c=360}=o;if(r>l&&r<c)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:e.recoveryTimes}function C8({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(r=>Array.isArray(r)).map(r=>r.sort((n,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=n.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:n,categoryNames:a})=>!(a!=null&&a.length)&&!(n!=null&&n.length)||(a==null?void 0:a.includes(e))||(n==null?void 0:n.includes(i)))).find(Boolean)}function LUe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:r,matchUpFormat:n,categoryName:a,categoryType:o,policy:s}){var l;let c=(e==null?void 0:e.matchUpRecoveryTimes)&&oI({...e,averageMinutes:i,matchUpFormat:n}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&oI({...t,averageMinutes:i,matchUpFormat:n}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&oI({...s,averageMinutes:i,matchUpFormat:n}),p=[c,u,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,r==null?void 0:r.recoveryTimes];return C8({categoryName:a,categoryType:o,timesBlockArray:p})}function _Ue({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:r,tournamentScheduling:n,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&aI({...a,matchUpFormat:t}),c=(n==null?void 0:n.matchUpAverageTimes)&&aI({...n,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&aI({...o,matchUpFormat:t}),d=[l,c,u,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,r==null?void 0:r.averageTimes];return C8({categoryName:e,categoryType:i,timesBlockArray:d})}function Sw({tournamentRecord:t,categoryName:e,categoryType:i,event:r}){var n,a,o,s,l,c;e=e??((n=r==null?void 0:r.category)==null?void 0:n.categoryName)??((a=r==null?void 0:r.category)==null?void 0:a.ageCategoryCode),i=i??((o=r==null?void 0:r.category)==null?void 0:o.categoryType)??((s=r==null?void 0:r.category)==null?void 0:s.subType);let{policy:u}=Pp({policyType:od,tournamentRecord:t,event:r}),d=(l=t?ft({element:t,name:Ru}).extension:void 0)==null?void 0:l.value,p=(c=r&&ft({name:Ru,element:r}).extension)==null?void 0:c.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:u}}}var M8="DOUBLES_SINGLES",N8="SINGLES_DOUBLES",Eo="total",IM="participantConflict",uc="matchUpConflict",A8="ISSUE_IDS",fd="CONFLICT",gd="WARNING",yM="ERROR",bM="ISSUE",US="STATE",$Ue={SINGLES_DOUBLES:N8,DOUBLES_SINGLES:M8,TOTAL:Eo,CONFLICT_MATCHUP_ORDER:uc,CONFLICT_PARTICIPANTS:IM,SCHEDULE_ISSUE_IDS:A8,SCHEDULE_CONFLICT:fd,SCHEDULE_WARNING:gd,SCHEDULE_ERROR:yM,SCHEDULE_ISSUE:bM,SCHEDULE_STATE:US},Wl="SINGLES",$m="SINGLES",$o="DOUBLES",$c="DOUBLES",yr="TEAM",oo="TEAM",BUe="AGE",VUe="RATING",jUe="BOTH",GUe={AGE:BUe,BOTH:jUe,DOUBLES:$o,DOUBLES_EVENT:$c,RATING:VUe,SINGLES:Wl,SINGLES_EVENT:$m,TEAM_EVENT:oo,TEAM:yr};function Tw({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:r,categoryName:n,categoryType:a,eventType:o,event:s}){if(!i)return{error:he};o=o??(s==null?void 0:s.eventType)??$m;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=Sw({tournamentRecord:i,categoryName:n,categoryType:a,event:s}),u={...c,matchUpFormat:r,categoryType:a,defaultTiming:l};return HP({eventType:o,timingDetails:u})}function HP({timingDetails:t,eventType:e}){let i=_Ue(t),r=Object.keys((i==null?void 0:i.minutes)||{}),n=(i==null?void 0:i.minutes)&&((r==null?void 0:r.includes(e))&&i.minutes[e]||i.minutes.default),a=LUe({...t,averageMinutes:n}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=Bi($m)(e)?N8:M8,c=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:n,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function $U(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Cp({visibilityThreshold:t,timeItems:e,itemType:i}){let r=e.filter(a=>a&&a.itemType===i&&(!t||$U(a)<new Date(t).getTime())).sort((a,o)=>$U(a)-$U(o)).pop(),n=r&&$U(r);return{itemValue:r==null?void 0:r.itemValue,timeStamp:n}}function wM({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:yv,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:n}:i}function ep({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:Iv,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:n}:i}function O8({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:Au,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:Fe(n,!1,!0)}:i}function k8({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:Qd,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:n}:i}function x8({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:vv,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:n}:i}function gL({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:hL,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:n}:i}function Vp(t){if(R9.test(t)){let e=EF();return new Date(`${e}T${t}`)}else return new Date(t)}function HUe({matchUp:t}){if(!t)return{error:Yn};if(!t.timeItems)return{error:uF};let e=t.timeItems.filter(r=>[ns,pu,Dl,Ou].includes(r==null?void 0:r.itemType)).sort((r,n)=>Vp(r.itemValue).getTime()-Vp(n.itemValue).getTime()),i=e.reduce((r,n)=>{var a,o;let s,l=(a=n==null?void 0:n.itemType)==null?void 0:a.split("."),c=`SCHEDULE.TIME.${((o=n==null?void 0:n.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(c){case ns:s=0;break;case Ou:if(r.lastValue&&[ns,Dl].includes(r.lastType)){let u=Vp(n.itemValue).getTime()-Vp(r.lastValue).getTime();s=r.milliseconds+u}else s=r.milliseconds;break;case pu:if([ns,"SCHECULE.TIME.RESUME"].includes(r.lastType)){let u=Vp(n.itemValue).getTime()-Vp(r.lastValue).getTime();s=r.milliseconds+u}else s=r.milliseconds;break;default:s=r.milliseconds;break}return{milliseconds:s,lastType:c,lastValue:n.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([ns,Dl].includes(i.lastType)){let r=new Date().getTime()-Vp(i.lastValue).getTime();i.milliseconds+=r}return{milliseconds:i.milliseconds,time:zUe(i.milliseconds),relevantTimeItems:e}}function zUe(t){let e=(i,r=2)=>("00"+i).slice(-r);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function WUe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:r}){let{itemValue:n,timeStamp:a}=Cp({timeItems:(r==null?void 0:r.timeItems)||[],itemType:mL,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:n}:i}function qUe({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{startTime:(e=i.reduce((n,a)=>{let o=a.itemType===ns&&a;return o&&(!n||r(o)<r(n))?o:n},void 0))==null?void 0:e.itemValue}}function YUe(t=1){return Ee(0,t).map(Yt)}function Yt(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,r=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[r&63|128]+t[r>>8&255]+"-"+t[r>>16&255]+t[r>>24&255]+t[n&255]+t[n>>8&255]+t[n>>16&255]+t[n>>24&255]}function Dw(t){let{disableNotice:e,venue:i,context:r}=t;if(typeof i!="object")return{error:oe};let n=ll(t);i.venueId||(i.venueId=Yt());let a;for(let o of Object.values(n)){let s=KUe({disableNotice:!0,tournamentRecord:o,context:r,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||Tt({topic:KF,payload:{venue:i}}),He({...Z,venue:a})}function KUe({tournamentRecord:t,disableNotice:e,context:i,venue:r}){return t?r?(t.venues||(t.venues=[]),r.venueId||(r.venueId=Yt()),t.venues.reduce((n,a)=>n||a.venueId===r.venueId,void 0)?{error:LK}:(i&&Mt({element:r,extension:{value:i,name:O9}}),t.venues.push(r),e||Tt({payload:{venue:r,tournamentId:t.tournamentId},topic:KF}),{...Z,venue:Fe(r)})):{error:Ve,info:"missing venue"}:{error:he}}function Xu({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:he};if(!i)return{error:rd};let r=(e.venues??[]).reduce((n,a)=>a.venueId===i?a:n,void 0);if(!r&&t){let n=(lw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of n){let o=t[a],s=Xu({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return Dw({tournamentRecord:e,venue:s.venue}),{...Z,venue:r}}}return r?{...Z,venue:r}:{error:av}}function vL({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:r,venueId:n}=e,a=Xu({tournamentRecords:i,tournamentRecord:r,venueId:n});return Fe(a,t,!0)}function Mh({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:he};if(!i)return{error:bh};let r="findCourt",n,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(n=s,a=o)})}),n)return{...Z,court:n,venue:a};if(t){let o=(lw({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],c=Mh({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&Dw({tournamentRecord:e,venue:c.venue}),{...Z,court:n,venue:a}}}return ee({result:{error:ew},stack:r})}function F8(t){return Fe(Mh(t),!1,!0)}function zP({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:he};if(!i)return{error:bh};let r=Mh({tournamentRecord:t,courtId:i});if(r.error)return r;let n=r.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:m,pace:h,notes:f}))(r.court);return{...Z,courtInfo:Fe(n,!1,e)}}function ag({tournamentRecord:t,venueId:e}){var i;if(!t)return{error:he};if(!e)return{error:rd};let r=Xu({tournamentRecord:t,venueId:e});if(r.error)return r;let n=(((i=r.venue)==null?void 0:i.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(zP({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),a=r.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(r.venue),o=a&&{...a,courtsInfo:n};return{...Z,venueData:Fe(o,!1,!0)}}function JUe({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],r=n=>n.createdAt?new Date(n.createdAt).getTime():0;return{endTime:(e=i.reduce((n,a)=>{let o=a.itemType===Ou&&a;return o&&(!n||r(o)>r(n))?o:n},void 0))==null?void 0:e.itemValue}}function Yi({event:t,eventId:e}){var i,r;if(!t)return{error:Wt};let n=(i=ft({name:Fo,element:t}))==null?void 0:i.extension,a=e?Fe(n==null?void 0:n.value,!1,!0):n==null?void 0:n.value;return e&&((r=t.drawDefinitions)==null||r.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function xn(t){let{tournamentRecord:e,eventId:i,drawId:r}=t,n="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(r){let c,u=s.find(d=>{var p,m,h;let f=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===r);if(f)c=f,l=a[d.eventId].tournamentId;else{let g=(h=(m=d&&((p=Yi({event:d}))==null?void 0:p.flightProfile))==null?void 0:m.flights)==null?void 0:h.find(v=>v.drawId===r);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:r}}return f});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ee({result:{error:ha},stack:n})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ee({result:{error:ma},context:{drawId:r,eventId:i},stack:n})}}function WP(t){var e,i,r,n,a,o,s,l,c;let u=t.event,d=t.matchUpType,{scheduleVisibilityFilters:p,afterRecoveryTimes:m,tournamentRecord:h,usePublishState:f,scheduleTiming:g,matchUpFormat:v,publishStatus:I,matchUp:y}=t;if(!y)return{error:Yn};if(m&&!y.matchUpType&&!t.matchUpType&&(u||h)&&y.drawId){let M=(e=u==null?void 0:u.drawDefinitions)==null?void 0:e.find(O=>O.drawId===y.drawId);!M&&h&&({drawDefinition:M,event:u}=xn({tournamentRecord:h,drawId:y.drawId}));let C=y.structureId&&((i=M==null?void 0:M.structures)==null?void 0:i.find(({structureId:O})=>O===y.structureId));d=t.matchUpType||(C==null?void 0:C.matchUpType)||(M==null?void 0:M.matchUpType)||(u==null?void 0:u.eventType)!==yr&&(u==null?void 0:u.eventType)}let{milliseconds:b,time:S}=HUe({matchUp:y}),{startTime:w}=qUe({matchUp:y}),{endTime:U}=JUe({matchUp:y}),T,{visibilityThreshold:P,eventIds:R,drawIds:D}=p??{};if((!R||R.includes(y.eventId))&&(!D||D.includes(y.drawId))){let M={matchUp:y,visibilityThreshold:P},{allocatedCourts:C}=O8(M),{scheduledTime:O}=wM(M),{scheduledDate:k}=ep(M),{venueId:x}=x8(M),{courtId:F}=k8(M),{courtOrder:$}=WUe(M),{timeModifiers:_}=gL(M),L,B,V,G,j,H=y.matchUpType??d;if(g&&O&&m&&H){let J={matchUpFormat:y.matchUpFormat??v,...g};({averageMinutes:B=0,recoveryMinutes:V=0,typeChangeRecoveryMinutes:G=0}=HP({timingDetails:J,eventType:H})),(B||V)&&(L=U?jn(fi(U),V):jn(O,B+V)),G&&(j=U?jn(fi(U),G):jn(O,B+G))}!k&&O&&(k=ct(O));let W=I0({scheduledDate:k,scheduledTime:O}),Y={},q=((r=h&&x&&ag({tournamentRecord:h,venueId:x}))==null?void 0:r.venueData)||{};x&&(Y[x]=q);let{venueName:re,venueAbbreviation:K,courtsInfo:z}=q,te=(n=F&&(z==null?void 0:z.find(J=>J.courtId===F)))==null?void 0:n.courtName;for(let J of C||[]){if(!h)break;J.venueId&&!Y[J.venueid]&&(Y[J.venueId]=(a=ag({venueId:J.venueId,tournamentRecord:h}))==null?void 0:a.venueData);let ie=Y[J.venueId];J.venueName=ie==null?void 0:ie.venueName;let ne=(o=ie==null?void 0:ie.courtsInfo)==null?void 0:o.find(ue=>ue.courtId===J.courtId);J.courtName=ne==null?void 0:ne.courtName}T=He({typeChangeTimeAfterRecovery:j,timeAfterRecovery:L,scheduledDate:k,scheduledTime:O,isoDateString:W,allocatedCourts:C,timeModifiers:_,venueAbbreviation:K,venueName:re,venueId:x,courtOrder:$,courtName:te,courtId:F,typeChangeRecoveryMinutes:G,recoveryMinutes:V,averageMinutes:B,milliseconds:b,startTime:w,endTime:U,time:S})}else T=He({milliseconds:b,startTime:w,endTime:U,time:S});let{scheduledDate:E}=ep({matchUp:y}),{scheduledTime:N}=wM({matchUp:y});if(f&&(s=I==null?void 0:I.displaySettings)!=null&&s.draws){let M=I.displaySettings.draws,C=(l=(M==null?void 0:M[y.drawId])??(M==null?void 0:M.default))==null?void 0:l.scheduleDetails;if(C){let O=(c=C.find(k=>{var x;return E&&((x=k.dates)==null?void 0:x.includes(E))})??C.find(k=>{var x;return!((x=k.dates)!=null&&x.length)}))==null?void 0:c.attributes;if(O){let k=Object.assign({},...Object.keys(T).map(x=>({[x]:!0})),O);T=km({source:T,template:k})}}}let A=y.matchUpStatus&&Sr.includes(y.matchUpStatus)&&(ct(U)||ct(E)||ct(N))||void 0;return{schedule:T,endDate:A}}function pc(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(r=>r.tieFormatId===e)}function sI({item:t,drawDefinition:e,structure:i,event:r}){var n,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((n=e.tieFormats)==null?void 0:n.find(s=>t.tieFormatId===s.tieFormatId))||(r.tieFormat?r.tieFormat:(a=r.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function cn({drawDefinition:t,structure:e,matchUp:i,event:r}){return{tieFormat:sI({item:i,drawDefinition:t,structure:e,event:r})||sI({item:e,drawDefinition:t,structure:e,event:r})||pc(t)||pc(r)}}function XUe({matchUps:t}){let e=t.reduce((i,r)=>!r.collectionPosition||i.includes(r.collectionPosition)?i:i.concat(r.collectionPosition),[]).map(i=>({[i]:t.filter(r=>r.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function L8({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=xr(t,t.length/e).map(n=>n.reduce((a,o)=>a+o)),r=i.slice().sort(sr);return i.map(n=>r.indexOf(n)+1)}function SS(t){if(!Array.isArray(t))return"";let e=t.filter(ki);return e.length?ht([Math.min(...e),Math.max(...e)]).join("-"):""}function ZUe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:Ce};if(!e)return{error:La};let{structure:r}=et({drawDefinition:t,structureId:e});if((r==null?void 0:r.stage)!==Yr)return{error:bp,info:"Structure is not CONSOLATION stage"};let{links:n}=t,a=(n==null?void 0:n.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:m}=p.source;return d.includes(m)?d:d.concat(m)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Zd({structureId:d,matchUpsMap:i}),m=Pn({matchUps:p}).roundProfile;return{[d]:m}})),l=Zd({matchUpsMap:i,structureId:e}),{roundProfile:c}=Pn({matchUps:l}),u={};return a==null||a.forEach(d=>{var p,m,h;let{structureId:f,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:I,positionInterleave:y,roundNumber:b}=d.target,S=s[f],w=(p=S[1])==null?void 0:p.drawPositions,U=(m=S[g])==null?void 0:m.matchUpsCount;if(!U)return;let T=U?w.length/U:0,P=w.length/T,R=w.slice(),D=L8({roundPositionsCount:P,groupedOrder:I}),E=(D==null?void 0:D.length)||1;if(E<=P){let M=w.length/E,C=xr(R,M);v===Jd&&C.forEach(O=>O.reverse()),R=(D==null?void 0:D.length)&&(D==null?void 0:D.map(O=>C[O-1]).flat())||R}let N=xr(R,T);if(y){let M=Ee(0,y.interleave).map(()=>{}),C=Ee(0,y.offset).map(()=>{});N=N.map(k=>[k,...M]),N.unshift(C),N=N.flat(1);let O=N.length-y.offset;N=N.slice(0,O)}u[b]||(u[b]={});let A=(h=c==null?void 0:c[b])!=null&&h.feedRound?2:1;N.forEach((M,C)=>{let O=1+C*A;u[b][O]||(u[b][O]=SS(M))})}),{sourceDrawPositionRanges:u}}function Zu({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:r,event:n}){let a={policies:{}};if(!i)return a;let o=Ju({tournamentRecord:e,drawDefinition:r,event:n}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[su])??(o==null?void 0:o[su])??pL[su];a.policies[su]=s}return a}function QUe({drawPositions:t,roundProfile:e,roundNumber:i}){var r;let n=[void 0,void 0];if(s9(t))return{orderedDrawPositions:n,displayOrder:n};let a=e==null?void 0:e[i],o=((r=a==null?void 0:a.pairedDrawPositions)==null?void 0:r.find(l=>Dn(l||[],t.filter(Boolean))))??n,s=a==null?void 0:a.feedRound;if(o9(t)){let l=[...t].sort(sr);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(c=>!isNaN(Xe(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function C0({collectionPosition:t,collectionId:e,lineUp:i}){let r=[],n=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;r.includes(l)||(c&&n.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),r=r.filter(d=>d!==c),r.push(l))}}return{assignedParticipantIds:r,substitutions:n}}function Bo({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let r="getPairedParticipant";if(!t&&!e)return{error:he};if(!Array.isArray(i)||i.length>2)return{error:Po};if(!i.length)return ee({result:{error:id},stack:r});t=t??(e==null?void 0:e.participants)??[];let n=t.filter(s=>s.participantType===st&&Hi(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=n[0];if(!a)return ee({result:{error:Ji},stack:r});let o=Fe(n.slice(1),!1,!0);return{participant:Fe(a),duplicatedPairParticipants:o,...Z}}function tp({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:Ce};if(typeof e!="string")return{error:vr};let{extension:i}=ft({element:t,name:Pu});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function eSe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:r=[],participantMap:n,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:m})=>{var h,f,g,v;let{assignedParticipantIds:I,substitutions:y}=C0({collectionPosition:i,collectionId:o,lineUp:p});if(l===ui){if((I==null?void 0:I.length)<=2){let b=(f=(h=n==null?void 0:n[I[0]])==null?void 0:h.pairIdMap)==null?void 0:f[I[1]],S=(v=b&&((g=n[b])==null?void 0:g.participant)||Bo({participantIds:I,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:S,teamParticipant:m,substitutions:y}}}else if((I==null?void 0:I.length)>2)return{[d]:{teamParticipant:m,substitutions:y}}}else{let b=I==null?void 0:I[0];return b&&{[d]:{participantId:b,teamParticipant:m,substitutions:y}}}};if(!(r!=null&&r.length)){let d=(s==null?void 0:s.map(p=>{var m;let{teamParticipant:h,sideNumber:f}=p,g=p.lineUp||((m=tp({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:m.lineUp);return c({attribute:f,lineUp:g,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(r==null?void 0:r.map(d=>{var p,m,h;let f=(p=e.find(y=>y.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(y=>(y==null?void 0:y.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||f&&((m=n==null?void 0:n[f])==null?void 0:m.participant)||(t==null?void 0:t.find(({participantId:y})=>y===f)),I=(g==null?void 0:g.lineUp)||((h=tp({participantId:f,drawDefinition:a}))==null?void 0:h.lineUp);return c({attribute:d,lineUp:I,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function _8({drawDefinition:t}){if(typeof t!="object")return{error:cm};let e={},{structures:i=[],links:r=[]}=t||{},n=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(n)){let s=n[o].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){o[l]||(o[l]=[]),s==="0"&&[Yr,Fi].includes(d)||o[l].push(s);let p=r.filter(m=>m.source.structureId===l&&m.source.roundNumber>=c);for(let m of p){let h=m.source.roundNumber,f=m.target.roundNumber,g=m.target.structureId,v=i.find(y=>y.structureId===g).stage,I=[v,g,f,h].join("|");if(u[I])return;u[I]=!0,a({exitProfile:`${s}-${h}`,structureId:g,exitProfiles:o,targetRound:f,aggregator:u,stage:v})}}}function tSe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:r}){var n;if(!t)return{error:Ce};if(!i)return{error:La};if(!e){let s=Zd({matchUpsMap:r,structureId:i});if({roundProfile:e}=Pn({matchUps:s}),!e)return{error:Ve}}let a=(Math.min(...((n=e==null?void 0:e[1])==null?void 0:n.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,c;let u=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((c=e==null?void 0:e[1])==null?void 0:c.drawPositions)??[],p=xr(d,d.length/u),m=p.map(SS),h=p.map(y=>y.map(b=>b-a)).map(SS),f=o.map(y=>{var b;if(y>s)return;let S=((b=e==null?void 0:e[y])==null?void 0:b.drawPositions)??[];return xr(S,S.length/u)}).filter(Boolean),g=Ee(0,u).map(y=>f.map(b=>b[y]).flat().filter(Boolean).sort(sr)).map(y=>ht(y)),v=g.map(y=>swe(y).map(SS).join(", ")),I=Object.assign({},...Ee(0,u).map(y=>({[y+1]:{firstRoundDrawPositionsRange:m[y],firstRoundOffsetDrawPositionsRange:h[y],possibleDrawPositions:g[y],drawPositionsRange:v[y]}})));return{[s]:I}}))}}function IL({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:r}){var n;if(!i)return!1;r=r??i.matchUps??[],t=t??Pn({matchUps:r}).roundsNotPowerOf2;let a=!!((n=i.positionAssignments)!=null&&n.find(({drawPosition:o})=>o))||!!(r!=null&&r.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==Up)&&!(i!=null&&i.structures)&&t&&a}function va({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(n=>n==null?void 0:n.roundPosition)),r=!!(e!=null&&e.find(n=>{var a;return(a=n==null?void 0:n.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Mr&&(!e.length||!i&&!r)}var yL={[Jf]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[Oe]:"",[Fi]:"P",[qe]:"Q",[Yr]:"C"}}},iSe=yL;function rSe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o;let{roundProfile:s,roundMatchUps:l}=Pn({matchUps:r}),{structureAbbreviation:c,stage:u}=i,d=va({structure:i}),p=IL({structure:i}),m=i.structures,h={},f=yL[Jf],g=i.stage===qe,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(M=>M.stage===qe).map(({stageSequence:M})=>M??1),0):0,I=(i.stageSequence??1)<v?i.stageSequence??1:"",y=I&&(((n=t==null?void 0:t.affixes)==null?void 0:n.preQualifying)||f.affixes.preQualifying)||"",b=(t==null?void 0:t.roundNamingMap)||f.roundNamingMap||{},S=(t==null?void 0:t.abbreviatedRoundNamingMap)||f.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||f.affixes.preFeedRound,U=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||f.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||f.namingConventions).round,P=u&&u!==Oe?u[0]:"",R=(t==null?void 0:t.stageConstants)||f.stageConstants,D=u&&(R==null?void 0:R[u])||P,E=`${y}${D}${I}`,N=s?Object.keys(s):[],A=g&&R!=null&&R[qe]?`${R==null?void 0:R[qe]}-`:"";if(m||d||p)Object.assign(h,...N.map(M=>{let C=`${A}${T} ${M}`,O=`${U}${M}`;return{[M]:{roundName:C,abbreviatedRoundName:O}}}));else{let M=g&&((t==null?void 0:t.qualifyingFinishMap)||(f==null?void 0:f.qualifyingFinishMap)||{});Object.assign(h,...N.map(C=>{if(!(s!=null&&s[C]))return;let{matchUpsCount:O,preFeedRound:k}=s[C],x=O*2,F=(M==null?void 0:M[s==null?void 0:s[C].finishingRound])||M&&`${U}${x}`||b[O]||`${U}${x}`,$=k?`-${w}`:"",_=`${F}${$}`,L=[E,c,_].filter(Boolean).join("-"),B=`${S[O]||`${U}${x}`}${$}`,V=[E,c,B].filter(Boolean).join("-");return{[C]:{abbreviatedRoundName:V,roundName:L}}}))}return{roundNamingProfile:h,roundProfile:s,roundMatchUps:l}}function qP(t){var e,i,r;let n=kt(t,[{[nd]:!0}]);if(n.error)return n;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(r=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:r.participantType;o=s===wt&&Ni||s===st&&ui||s===ii&&ii||void 0}return{matchUpType:o}}var nSe="normal",iV="timed",aSe="final",bL="NOAD",TS="SET",oSe={S:nSe,F:aSe};function _n(t){if(typeof t=="string"){let e=t.startsWith("T")&&iV||t.startsWith(TS)&&TS||"";if(e===iV){let i=B8(t),r={simplified:!0,setFormat:i,bestOf:1};if(i)return r}if(e===TS)return sSe(t)}}function sSe(t){let e=t.split("-"),i=Pw(e[0].slice(3)),r=i===1||i%2!==0?i:void 0,n=i!==1&&i%2===0?i:void 0,a=e&&rV(e[1]),o=e&&rV(e[2]),s=a&&a.timed||o&&o.timed,l=r&&r<6||s&&n,c=!e[2]||o,u=a,d=He({setFormat:a,exactly:n,bestOf:r});if(o&&(d.finalSetFormat=o),l&&u&&c)return d}function rV(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=oSe[e[0]],r=e[1];if(i&&r){if(r.startsWith("TB")){let h=nV(r);return h===!1?!1:typeof h=="object"?{tiebreakSet:h}:void 0}if(r.startsWith("T"))return B8(r);let n=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=n&&V8(n[2])||!1,o=!(n!=null&&n[2])||a,s=n?Pw(n[1]):void 0,l=$8(r),c=l!==!1,u=c&&l||s,d=nV(r.split("/")[1]),p=d!==!1,m={setTo:s};return a&&(m.NoAD=!0),d?(m.tiebreakFormat=d,m.tiebreakAt=u):m.noTiebreak=!0,s&&o&&p&&c&&m||!1}}}function $8(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?Pw(i[1]):i[1])||!1}function nV(t){if(t)if(t.startsWith("TB")){let e=$8(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),r=i==null?void 0:i[1],n=i&&V8(i[2]),a=!(i!=null&&i[2])||n,o=Pw(r);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!nt(e)&&(s.modifier=e),n&&(s.NoAD=!0),s}else return!1}else return!1}function B8(t){var e;let i=t.slice(1),r=i.match(/^(\d+)(@?[A-Za-z]*)/),n=Pw(r==null?void 0:r[1]);if(!n)return;let a={timed:!0,minutes:n},o=r==null?void 0:r[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=r[2]),a}function V8(t){return t&&t.indexOf(bL)>=0}function Pw(t){return isNaN(Number(t))?0:Number(t)}function YP(t,e){return!Array.isArray(t)||!On(e)?!1:Hi(t,E8[e]).length}function Yp(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:r,matchUpStatuses:n,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:c,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:m,stageSequences:h,scheduledDates:f,scheduledDate:g,participantIds:v,processContext:I,tournamentIds:y,matchUpTypes:b,structureIds:S,readyToScore:w,courtIds:U,eventIds:T,venueIds:P,drawIds:R,stages:D,filterMatchUpIds:E=!0,filterMatchUpTypes:N=!0}=t,A=Array.isArray(v)?v.filter(Boolean):[],M=Array.isArray(n)?n.filter(Boolean):[],C=Array.isArray(r)?r.filter(Boolean):[],O=Array.isArray(D)?D.filter(Boolean):[],k=Array.isArray(h)?h.filter(Boolean):[],x=Array.isArray(c)?c.filter(Boolean):[],F=Array.isArray(m)?m.filter(Boolean):[],$=Array.isArray(d)?d.filter(Boolean):[],_=Array.isArray(s)?s.filter(Boolean):[],L=Array.isArray(p)&&E?p.filter(Boolean):[],B=Array.isArray(b)&&N?b.filter(Boolean):[],V=Array.isArray(U)?U.filter(Boolean):[],G=Array.isArray(P)?P.filter(Boolean):[],j=Array.isArray(o)&&o.filter(Boolean)||typeof l=="string"&&[l]||[],H=Array.isArray(f)&&f.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],W=Array.isArray(y)?y.filter(Boolean):[],Y=Array.isArray(T)?T.filter(Boolean):[],q=Array.isArray(R)?R.filter(Boolean):[],re=Array.isArray(S)?S.filter(Boolean):[];return e.filter(K=>{var z;if(w&&!Bi(Zs)(K)&&!K.readyToScore||K.winningSide&&a&&![1,2].includes(K.winningSide)||u!==void 0&&(u&&!K.tieMatchUps||!u&&K.tieMatchUps)||i!==void 0&&(i&&!K.collectionId||!i&&K.collectionId)||O.length&&!O.includes(K.stage)||k.length&&!k.includes(K.stageSequence)||x.length&&(!K.collectionId||!x.includes(K.collectionId))||F.length&&(!K.roundName||!F.includes(K.roundName))||$.length&&(!K.roundNumber||!$.includes(K.roundNumber))||_.length&&(!K.roundPosition||!_.includes(K.roundPosition))||M.length&&(!K.matchUpStatus||!M.includes(K.matchUpStatus))||C.length&&K.matchUpStatus&&C.includes(K.matchUpStatus)||L.length&&!L.includes(K.matchUpId)||B.length&&(!K.matchUpType||!YP(B,K.matchUpType))||j.length&&(!K.matchUpFormat||!j.includes(K.matchUpFormat)))return!1;if(H!=null&&H.length){let{scheduledTime:te}=wM({matchUp:K}),{scheduledDate:J}=ep({matchUp:K}),ie=ct(te)||J;if(!H.find(ne=>Bl(ne,ie)))return!1}if(V.length){let{courtId:te}=k8({matchUp:K}),{allocatedCourts:J}=O8({matchUp:K}),ie=J==null?void 0:J.map(({courtId:ne})=>ne);if(!V.filter(Boolean).includes(te)||ie!=null&&ie.includes(te))return!1}if(G.length){let{venueId:te}=x8({matchUp:K});if(!G.filter(Boolean).includes(te))return!1}if(I){if(W.length&&!W.includes(K.tournamentId)||Y.length&&!Y.includes(K.eventId)||q.length&&!q.includes(K.drawId)||re.length&&!re.includes(K.structureId))return!1;if(A.length){let te=((z=K.sides)==null?void 0:z.map(({participantId:J})=>J).filter(Boolean))??[];if(!A.some(J=>te.includes(J)))return!1}}return!0})}function lSe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:r,seedAssignments:n,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,c,u,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),m=a&&t,h=s&&e,f=m?(l=m[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?uSe({displaySideNumber:r,seedAssignments:n,participantId:f,assignment:p,sideNumber:s}):{...h==null?void 0:h[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&m){let v=(c=m[a])==null?void 0:c.teamParticipant,I=(u=m[a])==null?void 0:u.participant,y=(d=m[a])==null?void 0:d.substitutions;I&&(g.participant=I),y&&(g.substitutions=y),v&&(g.teamParticipant=v)}return g}function uSe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:r,sideNumber:n}){let a={drawPosition:r.drawPosition,displaySideNumber:t,sideNumber:n};if(i){let o=cSe({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else r.bye&&Object.assign(a,{bye:!0});return r.qualifier&&Object.assign(a,{qualifier:!0}),a}function cSe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var Qs="ANY",li="MALE",oa="MIXED",Kp="OTHER",Si="FEMALE",wL={ANY:Qs,MALE:li,FEMALE:Si,MIXED:oa,OTHER:Kp};function $t({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:m,contextProfile:h,drawDefinition:f,publishStatus:g,context:v={},exitProfiles:I,matchUpsMap:y,structure:b,inContext:S,event:w}){var U,T,P,R,D;let E={},N={};if(r=r??(o==null?void 0:o.participants),!b)return{collectionPositionMatchUps:E,error:td,roundMatchUps:N,matchUps:[]};let A=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],M=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],C=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],O=!(v!=null&&v.eventId)||!(A!=null&&A.length)&&!((U=c==null?void 0:c.eventIds)!=null&&U.filter(Boolean).length)||(A==null?void 0:A.includes(v.eventId))||((T=c==null?void 0:c.eventIds)==null?void 0:T.includes(v.eventId)),k=!(M!=null&&M.length)||M.includes(b.structureId),x=!f||!(C!=null&&C.length)||C.includes(f.drawId);if(!O||!k||!x)return{collectionPositionMatchUps:E,roundMatchUps:N,matchUps:[]};h&&!u&&(u=Zu({tournamentRecord:o,contextProfile:h,drawDefinition:f}));let{appliedPolicies:F}=Gt({drawDefinition:f}),$={...e,...F,...a},_=(P=$==null?void 0:$.scoring)==null?void 0:P.structures,L=b.stage&&(_==null?void 0:_.stage)&&(_==null?void 0:_.stage[b.stage]),B=b.stageSequence&&(L==null?void 0:L.stageSequence)&&L.stageSequence[b.stageSequence],V=((R=$==null?void 0:$.scoring)==null?void 0:R.requireAllPositionsAssigned)||(L==null?void 0:L.requireAllPositionsAssigned)||(B==null?void 0:B.requireAllPositionsAssigned);y||(y=Zr({drawDefinition:f,structure:b}));let{positionAssignments:G,allPositionsAssigned:j}=Tr({structure:b}),H=!V||j,{seedAssignments:W}=ao({provisionalPositioning:i,drawDefinition:f,structure:b});s=s??W;let{roundOffset:Y,structureId:q,structureName:re,stage:K,stageSequence:z}=b,{drawId:te,drawName:J,drawType:ie}=f??{};I=I||f&&_8({drawDefinition:f}).exitProfiles;let ne=I==null?void 0:I[q],ue=(ne==null?void 0:ne.length)&&(ne[0].split("-").map(de=>parseInt(de)).reduce((de,Ie)=>de+Ie)||0),ae=!!b.structures,ce=Zd({matchUpsMap:y,structureId:q,inContext:S}),pe=$==null?void 0:$[Jf],Se=rSe({roundNamingPolicy:pe,drawDefinition:f,structure:b,matchUps:ce}),{roundNamingProfile:Be,roundProfile:Pe}=Se;if(N=(Se==null?void 0:Se.roundMatchUps)??[],d&&(ce=Yp({matchUps:ce,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),S){let{sourceDrawPositionRanges:de}=ZUe({drawDefinition:f,matchUpsMap:y,structureId:q}),Ie=f?tSe({drawDefinition:f,roundProfile:Pe,matchUpsMap:y,structureId:q}).drawPositionsRanges:void 0;ce=ce.map(me=>at({scheduleVisibilityFilters:t,sourceDrawPositionRanges:de,drawPositionsRanges:Ie,roundNamingProfile:Be,initialRoundOfPlay:ue,appliedPolicies:$,usePublishState:l,publishStatus:g,isRoundRobin:ae,roundProfile:Pe,matchUp:me,event:w})),(ce==null?void 0:ce.filter(me=>Array.isArray(me.tieMatchUps))).forEach(me=>{let Me=me.tieMatchUps;ce=ce.concat(...Me)}),c&&(ce=Yp({processContext:!0,...c,matchUps:ce}))}else(ce==null?void 0:ce.filter(de=>Array.isArray(de.tieMatchUps))).forEach(de=>{let Ie=de.tieMatchUps;ce=ce.concat(...Ie)});return d&&(ce=Yp({matchUps:ce,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(ce=Yp({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ce})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||S)&&(N=Pn({matchUps:ce}).roundMatchUps??[]),(D=cn({drawDefinition:f,structure:b,event:w}))!=null&&D.tieFormat&&({collectionPositionMatchUps:E}=XUe({matchUps:ce})),{collectionPositionMatchUps:E,roundMatchUps:N,isRoundRobin:ae,roundProfile:Pe,matchUpsMap:y,matchUps:ce};function at({scheduleVisibilityFilters:de,sourceDrawPositionRanges:Ie,drawPositionsRanges:me,initialRoundOfPlay:Me,additionalContext:be,roundNamingProfile:_e,tieDrawPositions:Ne,appliedPolicies:se,isCollectionBye:ge,usePublishState:we,publishStatus:De,matchUpTieId:Le,isRoundRobin:ye,roundProfile:Te,sideLineUps:Ze,matchUp:je,event:ve}){var qt,Xi,Ke,At,Ei,dr,mn,cl,ba,wa,Es,ho,Qr,dl,pl;be=be??{};let Cs=(qt=cn({drawDefinition:f,structure:b,matchUp:je,event:ve}))==null?void 0:qt.tieFormat,hU=Cs==null?void 0:Cs.collectionDefinitions,Ba=je.collectionId&&(hU==null?void 0:hU.find(zt=>zt.collectionId===je.collectionId)),zh=je.collectionId?Ba==null?void 0:Ba.matchUpFormat:je.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(f==null?void 0:f.matchUpFormat)??(ve==null?void 0:ve.matchUpFormat),Fp=je.matchUpType||(Ba==null?void 0:Ba.matchUpType)||(b==null?void 0:b.matchUpType)||(f==null?void 0:f.matchUpType)||!Bi(yr)(ve==null?void 0:ve.eventType)&&(ve==null?void 0:ve.eventType),oE=ge?Ft:je.matchUpStatus,{schedule:Ov,endDate:sE}=WP({scheduleVisibilityFilters:de,afterRecoveryTimes:n,tournamentRecord:o,usePublishState:we,scheduleTiming:m,matchUpFormat:zh,publishStatus:De,matchUpType:Fp,matchUp:je,event:ve}),Lp=Ne??je.drawPositions??[],{collectionPosition:lE,collectionId:fU,roundPosition:rc}=je,Ht=je.roundNumber??be.roundNumber,gU=fU?eSe({tournamentParticipants:r,positionAssignments:G,collectionPosition:lE,drawDefinition:f,participantMap:p,drawPositions:Lp,collectionId:fU,sideLineUps:Ze,matchUpType:Fp}):void 0,vU=((Xi=_e==null?void 0:_e[Ht])==null?void 0:Xi.roundName)||be.roundName,kv=((Ke=_e==null?void 0:_e[Ht])==null?void 0:Ke.abbreviatedRoundName)||be.abbreviatedRoundName,IU=(At=Te==null?void 0:Te[Ht])==null?void 0:At.feedRound,yU=(Ei=Te==null?void 0:Te[Ht])==null?void 0:Ei.preFeedRound,bU=(dr=Te==null?void 0:Te[Ht])==null?void 0:dr.roundFactor,xv=me==null?void 0:me[Ht],wU=rc?xv==null?void 0:xv[rc]:void 0,Fv=Ie==null?void 0:Ie[Ht],UU=Ba!=null&&Ba.category?{...(v==null?void 0:v.category)||{},...Ba.category}:(v==null?void 0:v.category)??(ve==null?void 0:ve.category),SU=((mn=je.processCodes)==null?void 0:mn.length)&&je.processCodes||((cl=Ba==null?void 0:Ba.processCodes)==null?void 0:cl.length)&&(Ba==null?void 0:Ba.processCodes)||((ba=b==null?void 0:b.processCodes)==null?void 0:ba.length)&&(b==null?void 0:b.processCodes)||((wa=f==null?void 0:f.processCodes)==null?void 0:wa.length)&&(f==null?void 0:f.processCodes)||((Es=ve==null?void 0:ve.processCodes)==null?void 0:Es.length)&&(ve==null?void 0:ve.processCodes)||(o==null?void 0:o.processCodes),TU=(h==null?void 0:h.withCompetitiveness)&&Uw({...u,matchUp:je}),DU=je.finishingPositionRange??be.finishingPositionRange,_p=zt=>He(zt,void 0,!0),Ci={..._p(v),..._p({matchUpFormat:je.matchUpType===yr?void 0:zh,tieFormat:je.matchUpType!==yr?void 0:Cs,gender:(Ba==null?void 0:Ba.gender)??(ve==null?void 0:ve.gender),roundOfPlay:K!==qe&&nt(Me)&&Me+(Ht||0),endDate:je.endDate??sE,discipline:ve==null?void 0:ve.discipline,category:UU,finishingPositionRange:DU,abbreviatedRoundName:kv,drawPositionsRange:wU,competitiveProfile:TU,structureName:re,stageSequence:z,drawPositions:Lp,matchUpStatus:oE,processCodes:SU,isRoundRobin:ye,matchUpTieId:Le,preFeedRound:yU,matchUpType:Fp,roundFactor:bU,roundOffset:Y,structureId:q,roundNumber:Ht,feedRound:IU,roundName:vU,drawName:J,drawType:ie,schedule:Ov,drawId:te,stage:K}),...Fe(_p(je),!0,!0)};if(zh&&(ho=je.score)!=null&&ho.scoreStringSide1){let zt=_n(zh),{bestOf:ln,finalSetFormat:Ye,setFormat:pt}=zt??{};(Ye!=null&&Ye.tiebreakSet||pt!=null&&pt.tiebreakSet||pt!=null&&pt.timed)&&(Ci.score.sets=Ci.score.sets.sort((Jt,pr)=>Jt.setNumber-pr.setNumber).map((Jt,pr)=>(pr+1===ln?(Ye!=null&&Ye.tiebreakSet||Ye!=null&&Ye.timed)&&(Jt.tiebreakSet=!0):(pt!=null&&pt.tiebreakSet||pt!=null&&pt.timed)&&(Jt.tiebreakSet=!0),Jt)))}if(Array.isArray(Lp)){let{orderedDrawPositions:zt,displayOrder:ln}=QUe({drawPositions:Lp,roundProfile:Te,roundNumber:Ht}),Ye=(Qr=Te==null?void 0:Te[Ht])==null?void 0:Qr.feedRound,pt=ln[0]!==zt[0],Jt=zt.concat(void 0,void 0).slice(0,2).map((pr,si)=>{var bi;let Ua=si+1,$p=pt?3-Ua:Ua,nc=lSe({...gU,positionAssignments:G,displaySideNumber:$p,seedAssignments:s,drawPosition:pr,isFeedRound:Ye,sideNumber:Ua}),RU=(bi=je.sides)==null?void 0:bi.find(uE=>uE.sideNumber===Ua),EU=rc?(rc-1)*2+si+1:void 0,CU=EU?Fv==null?void 0:Fv[EU]:void 0;return _p({sourceDrawPositionRange:CU,...RU,...nc})});Object.assign(Ci,Fe({sides:Jt},!0,!0))}if(r&&Ci.sides){let zt=se==null?void 0:se[dv],ln=Ye=>{var pt;let Jt=(pt=p==null?void 0:p[Ye])==null?void 0:pt.participant;return Jt&&km({template:zt==null?void 0:zt.participant,source:Jt})};if(Ci.sides.filter(Boolean).forEach(Ye=>{var pt,Jt,pr;if(Ye.participantId){let si=Fe(ln(Ye.participantId)||r&&kc({policyDefinitions:se,participantId:Ye.participantId,tournamentParticipants:r,internalUse:!0,contextProfile:h}),void 0,!0);if(si){if(f!=null&&f.entries){let bi=f.entries.find(Ua=>Ua.participantId===Ye.participantId);bi!=null&&bi.entryStatus&&(si.entryStatus=bi.entryStatus),bi!=null&&bi.entryStage&&(si.entryStage=bi.entryStage)}Object.assign(Ye,{participant:si})}}if((Jt=(pt=Ye==null?void 0:Ye.participant)==null?void 0:pt.individualParticipantIds)!=null&&Jt.length&&!((pr=Ye.participant.individualParticipants)!=null&&pr.length)){let si=Ye.participant.individualParticipantIds.map(bi=>ln(bi)||r&&kc({policyDefinitions:se,tournamentParticipants:r,internalUse:!0,contextProfile:h,participantId:bi}));Object.assign(Ye.participant,{individualParticipants:si})}}),!Ci.matchUpType){let{matchUpType:Ye}=qP({matchUp:Ci});Ye&&Object.assign(Ci,{matchUpType:Ye})}if(h!=null&&h.inferGender&&(!Ci.gender||Ci.gender===oa)&&((dl=Ci.sides)==null?void 0:dl.length)===2&&Ci.matchUpType!==yr){let Ye=Ci.sides.map(pt=>{var Jt,pr,si,bi;if(Bi(Ni)(Ci.matchUpType))return(pr=(Jt=pt.participant)==null?void 0:Jt.person)==null?void 0:pr.sex;if(((bi=(si=pt.participant)==null?void 0:si.individualParticipants)==null?void 0:bi.length)===2){let Ua=ht(pt.participant.individualParticipants.map($p=>{var nc;return(nc=$p.person)==null?void 0:nc.sex})).filter(Boolean);if(Ua.length===1)return Ua[0]}});if(Ye.filter(Boolean).length===2&&ht(Ye).length===1){let pt=Ye[0];Ci.inferredGender=pt}}}if(Ci.tieMatchUps){let zt=Ci.matchUpStatus===Ft,ln=(pl=Ci.sides)==null?void 0:pl.map(({participant:Ye,drawPosition:pt,sideNumber:Jt,lineUp:pr})=>{let si=(Ye==null?void 0:Ye.participantType)===yr&&Ye;return{teamParticipant:si&&He({participantRoleResponsibilities:si.participantRoleResponsibilities,participantOtherName:si.participanOthertName,participantName:si.participantName,participantId:si.participantId,teamId:si.teamId}),drawPosition:pt,sideNumber:Jt,lineUp:pr}});Ci.tieMatchUps=Ci.tieMatchUps.map(Ye=>{let pt=Ci.matchUpId,Jt={finishingPositionRange:Ci.finishingPositionRange,abbreviatedRoundName:kv,roundNumber:Ht,roundName:vU};return at({tieDrawPositions:Lp,scheduleVisibilityFilters:de,sourceDrawPositionRanges:Ie,sideLineUps:ln,drawPositionsRanges:me,initialRoundOfPlay:Me,roundNamingProfile:_e,additionalContext:Jt,appliedPolicies:se,isCollectionBye:zt,usePublishState:we,publishStatus:De,matchUpTieId:pt,isRoundRobin:ye,roundProfile:Te,matchUp:Ye,event:ve})})}let Lv=Ci.sides&&Ci.sides.filter(zt=>zt==null?void 0:zt.participantId).length===2,PU=!Ci.winningSide;if(Object.assign(Ci,{readyToScore:H&&Lv&&PU,hasContext:!0}),Lv){let{allParticipantsCheckedIn:zt,checkedInParticipantIds:ln}=Ch({matchUp:Ci});Object.assign(Ci,{allParticipantsCheckedIn:zt,checkedInParticipantIds:ln})}return Array.isArray(h==null?void 0:h.exclude)&&(h==null||h.exclude.forEach(zt=>delete Ci[zt])),Ci}}function Md({matchUp:t}){return t?Sr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function KP({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:m,contextProfile:h,drawDefinition:f,exitProfiles:g,matchUpsMap:v,structureId:I,inContext:y,structure:b,context:S,event:w}){!b&&I&&({structure:b}=et({drawDefinition:f,structureId:I}));let U=$t({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:m,contextProfile:h,drawDefinition:f,exitProfiles:g,matchUpsMap:v,structure:b,inContext:y,context:S,event:w}),T=[],P=[],R=[],D=[],E=[];if(U.error)return U;let{matchUps:N}=U,{assignedPositions:A}=Tr({structure:b}),M=A==null?void 0:A.filter(O=>O.participantId).map(O=>O.drawPosition),C;return N.filter(O=>{var k;let x=((k=l==null?void 0:l.matchUpTypes)==null?void 0:k.length)===1&&l.matchUpTypes[0]===di;return!(O.matchUpType!==di&&x)}).forEach(O=>{var k,x,F,$;if(O.matchUpStatus===Ca){T.push(O);return}O.matchUpType===di&&(C=!0);let _=O.collectionId,L=_&&((k=O.sides)==null?void 0:k.every(W=>W.participantId)),B=!_&&((x=O.drawPositions)==null?void 0:x.filter(Boolean).length)===2,V=!_&&((F=O.drawPositions)==null?void 0:F.every(W=>M==null?void 0:M.includes(W))),G=A==null?void 0:A.filter(W=>W.bye).map(W=>W.drawPosition),j=!_&&(($=O.drawPositions)==null?void 0:$.find(W=>G==null?void 0:G.includes(W))),H=W9.includes(O.matchUpStatus)&&(L||B&&(!t||V));return j?E.push(O):Md({matchUp:O})?P.push(O):H?R.push(O):D.push(O)}),{includesTeamMatchUps:C,abandonedMatchUps:T,completedMatchUps:P,upcomingMatchUps:R,pendingMatchUps:D,byeMatchUps:E,structure:b}}function dSe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:Ce};if(!i)return{error:La};let{links:r}=bv({drawDefinition:t,structureId:i}),n=r.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=r.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:n,target:a}}}function BE({finishingPositions:t,linkCondition:e,linkType:i,source:r}){var n;let a=r.find(o=>{var s,l;let c=!((s=o.source)!=null&&s.finishingPositions)||!t||Dn(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&c&&o.linkType===i});return[Cu,jl].includes(a==null?void 0:a.linkType)&&!((n=a==null?void 0:a.source)!=null&&n.roundNumber)?ee({result:{error:oe},stack:"getTargetLink",context:a}):a}function bv({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((r,n)=>{var a,o;return((a=n.source)==null?void 0:a.structureId)===e&&(!i||n.source.roundNumber===i)&&(r.source=r.source.concat(n)),((o=n.target)==null?void 0:o.structureId)===e&&(!i||n.target.roundNumber===i)&&(r.target=r.target.concat(n)),r},{source:[],target:[]})}:{error:La}:{error:Ce}}function pSe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:r}=e,n=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===n.length?o=a.find(s=>s.roundPosition===r):a.length===n.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(r/2))),{matchUp:o}}return{message:"no progression found"}}function VE({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:r,targetLink:n}){var a;if(!n)return{error:zx};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:c,positionInterleave:u}}=n,{structure:d}=et({drawDefinition:r,structureId:o}),{positionAssignments:p}=ei({structure:d}),m=(e==null?void 0:e.filter(R=>R.structureId===(d==null?void 0:d.structureId))).filter(R=>R.roundNumber===c&&!R.matchUpTieId),h=m.length,f=Ee(1,h+1),g=h/t,v=Math.ceil(g*i),I=1-i%2;if(u!=null&&u.interleave&&g!==.5){let R=u.offset+(i-1)*u.interleave,D=i+R;v=Math.ceil(D/2),I=1-D%2}let y=f,b=f[v-1],S=L8({roundPositionsCount:f.length,groupedOrder:l}),w=(S==null?void 0:S.length)||1;if(w<=f.length){let R=h/w,D=xr(f,R);s===Jd&&D.forEach(E=>E.reverse()),y=(S==null?void 0:S.length)&&(S==null?void 0:S.map(E=>D[E-1]).flat())||y}s===So?b=y[v-1]:s===Jd?((!(S!=null&&S.length)||w>f.length)&&(v=m.length+1-v),b=y[v-1]):s===FP&&no()&&console.log(UP,{feedProfile:s});let U=b&&m.reduce((R,D)=>D.roundPosition===b?D:R,void 0),T;U!=null&&U.feedRound?(I=0,T=Math.min(...(U.drawPositions||[]).filter(Boolean))):T=((a=U==null?void 0:U.drawPositions)==null?void 0:a.length)===2&&(U==null?void 0:U.drawPositions[I]);let P=p==null?void 0:p.find(({drawPosition:R})=>R===T);if(P){let{extension:R}=ft({element:P,name:AP});if(R!=null&&R.value)return{disabledDrawPosition:T}}return{matchUp:U,targetDrawPosition:T,matchUpDrawPositionIndex:I}}function Rn({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:r,matchUpId:n}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===n));let{structure:o}=et({structureId:a==null?void 0:a.structureId,drawDefinition:r});return(o==null?void 0:o.finishingPosition)===Ph?mSe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:r,structure:o,matchUp:a}):hSe({matchUp:a})}function mSe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:r,matchUp:n}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:c}=n,{links:u}=dSe({roundNumber:n.roundNumber,structureId:r.structureId,drawDefinition:i}),d=u==null?void 0:u.source,p=BE({source:d,linkType:Cu}),m=BE({linkCondition:Gl,linkType:jl,source:d}),h=BE({source:d,linkType:jl}),f=m&&h;h||(h=m);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=h==null?void 0:h.target)==null?void 0:o.feedProfile,I=(s=m==null?void 0:m.target)==null?void 0:s.feedProfile,y,b,S,w,U,T,P,R,D,E;if(e&&(l||c)&&(P=l&&g!==rs&&t.find(({matchUpId:M})=>M===l),w=c&&v!==rs&&t.find(({matchUpId:M})=>M===c),P||w))return{matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:P}};let{roundPosition:N}=n;E=E||t.filter(M=>M.structureId===r.structureId);let A=E.reduce((M,C)=>C.roundNumber===n.roundNumber&&!C.matchUpTieId?M+1:M,0);return h&&!w&&v!==rs&&({matchUpDrawPositionIndex:T,targetDrawPosition:U,matchUp:w}=VE({targetLink:h,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),f&&I!==rs&&({matchUpDrawPositionIndex:S,targetDrawPosition:b,matchUp:y}=VE({targetLink:m,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!P&&g!==rs&&({matchUpDrawPositionIndex:D,targetDrawPosition:R,matchUp:P}=VE({targetLink:p,sourceRoundMatchUpCount:A,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),P||(E=E||t.filter(M=>M.structureId===r.structureId),{matchUp:P}=pSe({structureMatchUps:E,matchUp:n})),He({matchUp:n,targetLinks:{loserTargetLink:h,winnerTargetLink:p,byeTargetLink:m},targetMatchUps:{winnerMatchUpDrawPositionIndex:D,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:S,winnerTargetDrawPosition:R,loserTargetDrawPosition:U,byeTargetDrawPosition:b,winnerMatchUp:P,loserMatchUp:w,byeMatchUp:y},targetMatchUpIds:!!(l||c)})}function hSe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function fSe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(r=>{var n,a,o,s,l,c;let{matchUpId:u,structureId:d,drawPositions:p=[]}=r,{structure:m}=et({drawDefinition:t,structureId:d});if((m==null?void 0:m.finishingPosition)===fv){let{roundNumber:h}=r,f=h&&Xe(h)+1,g=m.matchUps??[],{roundMatchUps:v}=Pn({matchUps:g});if(f&&v!=null&&v[f]){let I=[...p].sort(sr).map((y,b)=>{let S=v[f].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(y)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:f,schedule:S==null?void 0:S.schedule,sideNumber:b+1,structureName:m.structureName}});Object.assign(r,{sidesTo:I})}}else{let h=Rn({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:r,drawDefinition:t,matchUpId:u}),{winnerMatchUp:f}=h.targetMatchUps,{loserMatchUp:g}=h.targetMatchUps;!r.winnerMatchUpId&&f&&(r.winnerMatchUpId=f.matchUpId),!r.loserMatchUpId&&g&&(r.loserMatchUpId=g.matchUpId);let v=jE({upcomingMatchUp:f}),I=jE({upcomingMatchUp:g});if(r.matchUpStatus!==Ft&&(g==null?void 0:g.matchUpStatus)===Ft){let{matchUp:b}=j8({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};I=b&&jE({upcomingMatchUp:b})||I}let y=(n=r.schedule)==null?void 0:n.timeAfterRecovery;if(y&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&Pt(v.schedule.scheduledTime)<Pt(y)&&(i[v.matchUpId]=r.matchUpId,v.schedule.scheduleConflict=r.matchUpId),(o=I==null?void 0:I.schedule)!=null&&o.scheduledTime&&Pt(I.schedule.scheduledTime)<Pt(y)&&(i[I.matchUpId]=r.matchUpId,I.schedule.scheduleConflict=r.matchUpId)),Object.assign(r,{winnerTo:v,loserTo:I}),(s=r.drawPositions)==null?void 0:s.filter(Boolean).length){let b=((c=(l=h.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:c.linkCondition)===Gl,S=gSe(r);if(S.length){let w=mM(f==null?void 0:f.sides),U=mM(g==null?void 0:g.sides),T=S.find(({participantId:R})=>w.includes(R))?[]:S,P=S.find(({participantId:R})=>U.includes(R))?[]:S;g&&b&&P.length<2&&P.push({bye:!0,tbd:!0}),T!=null&&T.length&&f&&(!h.targetMatchUpIds&&f&&(f=e.find(({matchUpId:R})=>R===f.matchUpId)),f.potentialParticipants||(f.potentialParticipants=[]),f.potentialParticipants.push(T)),P!=null&&P.length&&g&&(h.targetMatchUpIds||(f=e.find(({matchUpId:R})=>R===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(P))}}}}),Object.keys(i).length&&e.forEach(r=>{Object.keys(i).includes(r.matchUpId)&&(r.schedule.scheduleConflict=i[r.matchUpId])}),{scheduleConflictMatchUpIds:i}}function gSe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:r,qualifier:n})=>i||r&&{participantId:r}||n&&{qualifier:n}).filter(Boolean))||[]}function j8({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var r;let{matchUpId:n,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===zi)return{matchUp:t};if(a===Ft){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((r=Rn({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:r.targetMatchUps)||{},j8({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function jE(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:r,roundNumber:n,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function cr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=wv(t);if(i.error)return ee({result:i,stack:e});let{abandonedMatchUps:r,completedMatchUps:n,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(r??[]).concat(...n??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function wv(t){if(!(t!=null&&t.drawDefinition))return{error:Ce};let{tournamentParticipants:e,contextContent:i,matchUpsMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:m,scheduleTiming:h,participantMap:f,publishStatus:g,contextProfile:v,drawDefinition:I,nextMatchUps:y,inContext:b,context:S,event:w}=t,U=[],T=[],P=[],R=[],D=[];v&&!i&&(i=Zu({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let E;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(b||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:E}=lL({participants:e,participantsProfile:s})));let{structures:N}=zl({drawDefinition:I});if(!N)return{error:Ri};r||(r=Zr({drawDefinition:I}));let A=I&&_8({drawDefinition:I}).exitProfiles;N.forEach(O=>{let{byeMatchUps:k=[],pendingMatchUps:x=[],upcomingMatchUps:F=[],completedMatchUps:$=[],abandonedMatchUps:_=[]}=KP({matchUpFilters:y?void 0:m,contextFilters:y?void 0:p,inContext:b||y||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:f,scheduleTiming:h,publishStatus:g,contextProfile:v,drawDefinition:I,exitProfiles:A,matchUpsMap:r,structure:O,context:S,event:w});U=U.concat(..._),T=T.concat(...$),P=P.concat(...F),R=R.concat(...x),D=D.concat(...k)});let M=O=>(!m&&!y&&!p||(m&&(O=Yp({matchUps:O,...m})),p&&(O=Yp({matchUps:O,...p,processContext:!0}))),O),C={abandonedMatchUps:M(U),completedMatchUps:M(T),upcomingMatchUps:M(P),pendingMatchUps:M(R),byeMatchUps:M(D),matchUpsMap:r,...Z,groupInfo:E};if(y){let O=typeof y=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:k,completed:x,upcoming:F,pending:$,bye:_}=O,L=[].concat(...k&&U||[],...x&&T||[],...F&&P||[],...$&&R||[],..._&&D||[]);fSe({inContextDrawMatchUps:L,drawDefinition:I})}return C}function ip({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:Ce};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=cr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];mw({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Rn({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,m=Zd({matchUpsMap:i,structureId:s}).find(h=>h.matchUpId===o);if(m&&(d&&(n.winnerMatchUpIds[m.matchUpId]=d,Object.assign(m,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[m.matchUpId]=p,a.loserMatchUpId=p,m.loserMatchUpId=p,a.finishingPositionRange))){let h=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],f=h&&[Math.min(...h),Math.max(...h)];a.finishingPositionRange.loser=f,m.finishingPositionRange.loser=f}}),{inContextDrawMatchUps:t,goesToMap:n}}function G8(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function vSe(t){let e=Object.assign({},...bc.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return G8(e[t])}var bc=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function H8({participant:t,withISO2:e,withIOC:i}){let{person:r,individualParticipants:n}=t,a=[r,n==null?void 0:n.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let c=bc.find(({iso:u})=>u===l);i&&c!=null&&c.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&c!=null&&c.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}a.forEach(o)}function ISe({participantMap:t,template:e}){var i;let r=Object.values(t);for(let n of r){let a=n.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?km({template:e,source:s}):s)}}}}function Mp(t){var e;let{tournamentRecord:i,participantId:r}=t,n=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(n)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===r);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Ji}}function ul({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:r}){if(!r)return{error:Ve,info:OF};if(e&&!Array.isArray(e))return{error:oe,context:{itemSubTypes:e}};if(!Array.isArray(r.timeItems))return{error:uF};let n=r.timeItems.filter(o=>(o==null?void 0:o.itemType)===i).filter(o=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=o==null?void 0:o.itemSubTypes)==null?void 0:l.includes(s)})).sort((o,s)=>{let l=new Date(o.createdAt||void 0).getTime(),c=new Date(s.createdAt||void 0).getTime();return l-c}),a=n.pop();if(a){let o={timeItem:a,...Z};return t&&Object.assign(o,{previousItems:n}),o}else return{info:on}}function UL({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:r}){if(!e)return{error:Ps};if(!e.timeItems)return{info:on};let{timeItem:n,previousItems:a,info:o}=ul({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function Rw({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:r}){if(!r)return{error:Wt};if(!r.timeItems)return{info:on};let{timeItem:n,previousItems:a,info:o}=ul({returnPreviousValues:t,element:r,itemSubTypes:e,itemType:i});return n&&{timeItem:n,previousItems:a}||{info:o}}function Ew({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:r}){if(!e)return{error:he};if(!e.timeItems)return{info:on};let{timeItem:n,previousItems:a,info:o}=ul({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:r});return n&&{timeItem:n,previousItems:a}||{info:o}}function SL({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:r,itemType:n}){if(!e)return{error:he};if(!i)return{error:vr};let a=Mp({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:on};let{timeItem:s,previousItems:l,info:c}=ul({element:a.participant,returnPreviousValues:t,itemSubTypes:r,itemType:n});return s&&{timeItem:s,previousItems:l}||{info:c}}var ySe={[_a]:"groupParticipantIds",[st]:"pairParticipantIds",[ii]:"teamParticipantIds"},bSe={[_a]:"groups",[ii]:"teams"};function z8({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:r,withScaleValues:n,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let c of i.participants??[]){let u=c==null?void 0:c.participantId;u&&SSe({participantMap:l,participantId:u})}for(let c of i.participants??[]){let u=Fe(c,e,a),{participantId:d,individualParticipantIds:p,participantType:m}=u;if(Object.assign(l[d].participant,u),p&&USe({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:m,participantId:d}),r&&(l[d].participant.signedIn=wSe(u)),n){let{ratings:h,rankings:f,seedings:g}=uv({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=f,l[d].participant.ratings=h}(s||o)&&H8({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let c=Ii(t)?t:void 0;ISe({participantMap:l,template:c})}return{participantMap:l}}function wSe(t){let{timeItem:e}=ul({itemType:hw,element:t});return(e==null?void 0:e.itemValue)===uy}function USe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:r,participantId:n}){for(let a of t){let o=i[a].participant;if(o[ySe[r]].push(n),[ii,_a].includes(r)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e,p=bSe[r];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(r===st){let s=t.find(l=>l!==a);i[a].pairIdMap[n]=s,i[a].pairIdMap[s]=n}}}function SSe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Ni]:{...i},[ui]:{...i},[ii]:{...i},...i}}}function Nh({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:r,inContext:n}){var a;if(e)return{participantMap:(a=z8({...t,...r,tournamentRecord:i}))==null?void 0:a.participantMap};let o=Fe(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>H8({participant:l,...t}));let s;if((n||t!=null&&t.withGroupings)&&o!=null&&o.length&&({participantsWithGroupings:o,groupInfo:s}=lL({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:c,rankings:u}=uv({participant:l});l.rankings=u,l.ratings=c}return{participants:o,groupInfo:s}}function Qu(t){let{participants:e=[],contextContent:i,participantMap:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:m,nextMatchUps:h,inContext:f,context:g,event:v}=t;if(!v)return{error:Wt};let{eventId:I,eventName:y,endDate:b,eventType:S,category:w,gender:U,matchUpFormat:T}=v??{},P={...g,...He({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:T,eventName:y,eventType:S,category:w,eventId:I,gender:U})};b&&(P.endDate=b),p&&!i&&(i=Zu({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let R;if(!(e!=null&&e.length)&&!r&&u){let N=Nh({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:f});r=N.participantMap,e=N.participants??[],R=N.groupInfo}let D=v.drawDefinitions??[],E=Sw({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:D.flatMap(N=>{let{matchUps:A}=cr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,context:P,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:m,participantMap:r,scheduleTiming:E,nextMatchUps:h,inContext:f,event:v});return A??[]}),groupInfo:R}}function Lr(t){let e=kt(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:he};let{participantMap:i,participants:r}=t,{scheduleVisibilityFilters:n,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:m,nextMatchUps:h,context:f}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];r||({participants:r,participantMap:i}=Nh({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:I}=Gt({tournamentRecord:c}),y={...f,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},b=Zu({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(S=>{var w;return y.eventDrawsCount=((w=S.drawDefinitions)==null?void 0:w.length)??0,Qu({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:I,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,contextContent:b,contextFilters:m,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:h,participants:r,inContext:u,event:S}).matchUps??[]}).concat(...c.matchUps??[])}}function Us({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:r,policyDefinitions:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){return typeof r!="object"||!Object.keys(r).length?{error:Ai}:{matchUps:Object.keys(r).map(c=>{let u=r[c];return Lr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:n,tournamentRecord:u,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function Ah(t,e){return TSe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function TSe(t,e){return(_m[t==null?void 0:t.stage]||0)-(_m[e==null?void 0:e.stage]||0)}function Nn(t){let{participants:e,participantMap:i,contextContent:r}=t,{scheduleVisibilityFilters:n,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:m,drawDefinition:h,nextMatchUps:f,inContext:g,context:v,event:I}=t,{eventId:y,eventName:b,endDate:S,eventType:w,category:U,gender:T,matchUpFormat:P}=I??{},R={...v,surfaceCategory:(I==null?void 0:I.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:P,eventType:w,eventName:b,category:U,eventId:y,endDate:S,gender:T},D;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:D}=Nh({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:m,inContext:g})),m&&!r&&(r=Zu({policyDefinitions:l,tournamentRecord:u,contextProfile:m,drawDefinition:h,event:I})),{...cr({context:R,tournamentAppliedPolicies:a,scheduleVisibilityFilters:n,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:h,contextContent:r,contextFilters:p,contextProfile:m,matchUpFilters:d,participantMap:i,nextMatchUps:f,inContext:g,event:I}),groupInfo:D}}function Zo(t){var e;let i=ll(t),r=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(r))return{error:Xl};if(!Array.isArray(n))return{error:Ps};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:r.map(y=>y.matchUpId);if(!Array.isArray(l))return{error:iv};let c={},u={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let m=Object.values(i),h=m.reduce((y,b)=>y.concat(b.events??[]).map(S=>(S.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:y})=>y===Eu),f=r;if(h.length){f=Us({nextMatchUps:!0,tournamentRecords:i}).matchUps;let y=h.reduce((b,S)=>{var w,U;let T=(w=S.source)==null?void 0:w.structureId,P=(U=S.target)==null?void 0:U.structureId;return T&&P&&(d[P]=T),T&&!b.includes(T)&&b.push(T),b},[]);for(let b of y)c[b]=[];for(let b of f??[]){let S=b.containerStructureId||b.structureId;y.includes(S)&&c[S].push(b.matchUpId)}}let g=y=>{u[y]||(u[y]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[y]=[])},v=(y,b)=>{u[y].matchUpIds.forEach(S=>{u[b].matchUpIds.push(S)}),u[b].matchUpIds.push(y),u[y].dependentMatchUpIds.push(b),a&&u[y].participantIds.forEach(S=>u[b].participantIds.push(S))},I=y=>{let b=Object.keys(c).length;for(let S of y||[]){let{matchUpId:w,winnerMatchUpId:U,loserMatchUpId:T}=S;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:D}=jP(S);u[w].participantIds=D}U&&(g(U),v(w,U),p[U].push(w)),T&&(g(T),v(w,T),p[T].push(w)),u[w].sources.push(p[w]);let P=p[w].map(D=>u[D].sources[0]).flat(),R=p[w].map(D=>u[D].sources[1]).flat();if(u[w].sources.push(P,R),b){let D=S.containerStructureId||S.structureId,E=d[D];if(c[E])for(let N of c[E])g(N),v(N,w),p[N].push(w)}}}};if(s)ip({drawDefinition:s}),f!=null&&f.length||(f=Nn({drawDefinition:s}).matchUps),I(f);else{if(f!=null&&f.length||(f=Us({nextMatchUps:!0,tournamentRecords:i}).matchUps),!n.length){let y=m!=null&&m.length?m.map(({events:b=[]})=>b.map(({drawDefinitions:S=[]})=>S.map(({drawId:w})=>w))).flat(1/0):[];y&&(n=y)}for(let y of n){let b=f==null?void 0:f.filter(S=>S.drawId===y).sort(Ah);if(!(b!=null&&b.find(({roundPosition:S})=>!S))){let S=b==null?void 0:b.find(({tournamentId:U})=>U),{drawDefinition:w}=xn({tournamentRecord:i[S==null?void 0:S.tournamentId],drawId:y});w&&ip({drawDefinition:w})}I(b)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:p,matchUps:f,...Z}}function _r(t){var e,i;let r=t==null?void 0:t.matchUp,n=(t==null?void 0:t.score)||(r==null?void 0:r.score),a=(e=n==null?void 0:n.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:c,side1PointScore:u,side2PointScore:d}=a||{},p=o||s||l||c||u||d;return!!(((i=n==null?void 0:n.sets)==null?void 0:i.length)>1||p)}function Cw({matchUpStatus:t}){return H9.includes(t)}function DSe({matchUpStatus:t}){return BF.includes(t)}function UM({matchUpStatus:t}){return z9.includes(t)}function TL({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:r,score:n}){var a;let o=r==null?void 0:r.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(TL))==null?void 0:a.length;return _r({score:n})||s||e&&o||t&&DSe({matchUpStatus:t})&&![Ot,jt,Yo].includes(t)}function Mw(t){var e;let{drawDefinition:i,findContainer:r,structureId:n,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=gv({drawDefinition:i}),c=n?l[n]||[]:[];if(!o){let T=et({drawDefinition:i,structureId:n});if(T.error)return T;o=r?T.containingStructure??T.structure:T.structure}if(va({structure:o}))return{structure:o,isAdHoc:!0,error:ev};let{matchUps:u}=cr({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=u==null?void 0:u.filter(T=>T.structureId===n||c.includes(T.structureId)),{matchUpDependencies:p}=Zo({drawIds:[i.drawId],matchUps:u,drawDefinition:i}),m=[],h=[],f={},g=[];for(let T of u??[]){if(T.structureId===n||c.includes(T.structureId)){h.push(...T.drawPositions??[]);let P=T.roundNumber;for(let R of(T.drawPositions??[]).filter(Boolean))(!f[R]||P&&f[R]>P)&&(f[R]=P)}TL(T)&&(g.push(T),m.push(T.matchUpId,...((e=p==null?void 0:p[T==null?void 0:T.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=ht(h.filter(Boolean)).sort(sr),I=ht(m),y=ht(d==null?void 0:d.map(({matchUpId:T,drawPositions:P})=>I.includes(T)?P:[]).flat().filter(Boolean)).sort(sr),{positionAssignments:b}=ei({drawDefinition:i,structure:o}),S=b==null?void 0:b.filter(T=>T.bye).map(T=>T.drawPosition),w=b==null?void 0:b.filter(T=>T.qualifier).map(T=>T.drawPosition),U=(v==null?void 0:v.filter(T=>!y.includes(T)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:f,activeDependentMatchUpIds:I,qualifyingDrawPositions:w,inactiveDrawPositions:U,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:S,activeMatchUps:g,structure:o}}function Bm({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(sr)[0]}}var oc={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},M0=[];function Qa(t,e){typeof t=="string"&&(t={method:t}),(e||no())&&M0.push(t)}function PSe(t){let e=M0.slice();return t&&(M0.length=0),e}function RSe(t){let e=PSe(t).map(i=>{let{color:r,keyColors:n,method:a,newline:o}=i,s=Object.keys(oc).includes(r)?oc[r]:oc.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=n&&Object.keys(n).includes(u)&&oc[n[u]]?oc[n[u]]:oc.brightwhite;return`${oc.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,c,oc.white,l,oc.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function ESe(){M0.length=0}function $a({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUpsMap:a,structureId:o,structure:s,event:l}){var c,u,d;if(!r)return{error:Ce};if(s||({structure:s}=et({drawDefinition:r,structureId:o})),!s)return{error:Ri};o||({structureId:o}=s);let p="assignDrawPositionBye";Qa({method:p,color:"cyan",drawPosition:n}),a||(a=Zr({drawDefinition:r}));let{positionAssignments:m}=ei({structure:s}),{activeDrawPositions:h}=Mw({drawDefinition:r,structureId:o});if((c=m==null?void 0:m.find(D=>D.drawPosition===n))!=null&&c.bye)return{...Z};if(h!=null&&h.includes(n))return{error:pP};let f=m==null?void 0:m.find(D=>D.drawPosition===n);if(!f)return{error:ev};let{filled:g,containsBye:v,assignedParticipantId:I}=CSe(f);if(v)return{...Z};if(g&&!v)return ee({result:{error:Hf},stack:p});let y=cr({inContext:!0,drawDefinition:r,matchUpsMap:a}).matchUps??[],b={isCollectionMatchUp:!1},{matchUps:S}=$t({provisionalPositioning:t,drawDefinition:r,matchUpFilters:b,matchUpsMap:a,structure:s});if(m==null||m.forEach(D=>{D.drawPosition===n&&(D.bye=!0)}),s.structureType===Cn)return MSe({tournamentRecord:i,drawDefinition:r,drawPosition:n,matchUps:S}),_c({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),aV({assignedParticipantId:I,isPositionAction:e,drawDefinition:r,drawPosition:n,structureId:o,stack:p});let{roundProfile:w,roundMatchUps:U}=Pn({matchUps:S}),T=(u=w&&Object.keys(w).map(D=>parseInt(D)).reverse())==null?void 0:u.find(D=>{var E;return(E=w==null?void 0:w[D].drawPositions)==null?void 0:E.includes(n)}),P=T?U==null?void 0:U[T].find(({drawPositions:D})=>D==null?void 0:D.includes(n)):void 0;P&&W8({tournamentRecord:i,drawDefinition:r,matchUp:P,event:l});let R=(d=P==null?void 0:P.drawPositions)==null?void 0:d.find(D=>D!==n);if(P&&R){let D=DL({sourceDrawPositions:P.drawPositions,matchUpId:P.matchUpId,inContextDrawMatchUps:y,drawPositionToAdvance:R,tournamentRecord:i,drawDefinition:r,matchUpsMap:a});if(D.error)return D}return _c({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:s,event:l}),aV({assignedParticipantId:I,isPositionAction:e,drawDefinition:r,drawPosition:n,structureId:o,stack:p})}function aV({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:r,structureId:n,stack:a}){return e&&VP({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:r,structureId:n,name:a}}),ee({result:{...Z},stack:a})}function CSe(t){let e=t.bye,i=t.qualifier,r=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:r,filled:e||i||r}}function W8({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:r,event:n}){Object.assign(r,{matchUpStatus:Ft,score:void 0,winningSide:void 0}),Et({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(n==null?void 0:n.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:r})}function MSe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:r,event:n}){r.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&W8({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function DL({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,event:s}){var l,c;Qa({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let u=a.drawMatchUps.find(S=>S.matchUpId===o),d=(l=e.find(S=>S.matchUpId===o))==null?void 0:l.structureId,{structure:p}=et({drawDefinition:n,structureId:d}),{positionAssignments:m}=ei({structure:p}),h=m==null?void 0:m.filter(S=>S.bye).map(S=>S.drawPosition),f=(c=u==null?void 0:u.drawPositions)==null?void 0:c.find(S=>S!==t),g=f&&(h==null?void 0:h.includes(f)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:I,winnerMatchUp:y,loserTargetDrawPosition:b}}=Rn({inContextDrawMatchUps:e,drawDefinition:n,matchUpId:o});if(y&&y.structureId===(p==null?void 0:p.structureId)&&NSe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:y,matchUpsMap:a,event:s}),I&&g&&I.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:S}=I;if(S===1){let w=$a({structureId:v.target.structureId,drawPosition:b,tournamentRecord:r,drawDefinition:n,event:s});if(w.error)return w}else q8({loserTargetDrawPosition:b,tournamentRecord:r,loserTargetLink:v,drawDefinition:n,loserMatchUp:I,matchUpsMap:a,event:s})}return{...Z}}function NSe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:r,drawDefinition:n,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,c,u,d,p,m;let h="advanceWinner",f=o.drawMatchUps.find(F=>F.matchUpId===a.matchUpId),g=(l=e.find(F=>F.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=et({drawDefinition:n,structureId:g}),{positionAssignments:I}=ei({structure:v}),y=(c=I==null?void 0:I.find(({drawPosition:F})=>F===t))==null?void 0:c.bye,b=(u=f.drawPositions)==null?void 0:u.filter(Boolean),S=I==null?void 0:I.filter(F=>b==null?void 0:b.includes(F.drawPosition)),w=I==null?void 0:I.find(({drawPosition:F})=>F===t),U=i==null?void 0:i.find(F=>F!==t),T=(d=U&&(S==null?void 0:S.find(({drawPosition:F})=>F===U)))==null?void 0:d.bye,P=y&&T;if(P&&console.log({isByeAdvancedBye:P}),(b==null?void 0:b.length)>1&&y&&!T)return ee({result:{error:Hf},stack:h});let R=b==null?void 0:b.find(F=>F!==t),D=P,E=[...(f.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=E.map(F=>!F&&!D||F===t?(D=!0,t):F).sort(sr);if(!D)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:S}),ee({result:{error:Hf},stack:h});let A=(p=I==null?void 0:I.find(({drawPosition:F})=>F===R))==null?void 0:p.bye,M=(m=I==null?void 0:I.find(({drawPosition:F})=>F===t))==null?void 0:m.bye;Object.assign(f,{matchUpStatus:M||A?Ft:zi,score:void 0,winningSide:void 0,drawPositions:N});let C=f.drawPositions.find(F=>!E.includes(F));Qa({method:h,color:"brightyellow",changedDrawPosition:C,pairedDrawPositionIsBye:A,drawPositionIsBye:M}),Et({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,eventId:s==null?void 0:s.eventId,context:h,drawDefinition:n});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:k,loserTargetDrawPosition:x}}=Rn({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(A||M){let F=A?t:R;if(F)DL({drawPositionToAdvance:F,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:n,matchUpsMap:o});else if(M&&O&&k)if(k.feedRound)q8({loserTargetDrawPosition:x,tournamentRecord:r,loserTargetLink:O,drawDefinition:n,loserMatchUp:k,matchUpsMap:o});else{let $=1-a.roundPosition%2,_=k.drawPositions[$],L=$a({structureId:O.target.structureId,drawPosition:_,tournamentRecord:r,drawDefinition:n,event:s});if(L.error)return L}}}function q8({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){let{roundNumber:s}=n;Qa({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[n.structureId].matchUps,{initialRoundNumber:c}=Bm({drawPosition:t,matchUps:l});if(c===s){let u=$a({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:r,event:o});if(u.error)return u}}function Y8({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:n,event:a}){let{matchUps:o}=$t({drawDefinition:i,matchUpsMap:r,structure:n,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Ft:zi}),Et({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function Nw(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:r}=t,{tournamentRecord:n,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:c}=et({drawDefinition:a,structureId:o}),u=(Tr({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||r&&p.drawPosition===r);if(u&&i&&!r&&(r=u==null?void 0:u.drawPosition),!r)return{error:tv};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=Mw({drawDefinition:a,structureId:o});return d.includes(r)?{error:pP}:(e||({matchUps:e}=cr({inContext:!0,drawDefinition:a,matchUpsMap:s})),SM({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,structureId:o,drawPosition:r,matchUpsMap:s,event:l}).drawPositionCleared?(_c({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:c,event:l}),{...Z,participantId:i}):{error:X7})}function SM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,structureId:a,event:o}){var s,l;let{structure:c}=et({drawDefinition:i,structureId:a});if(!c)return{error:Ri};let u=Tr({drawDefinition:i,structure:c}).positionAssignments||[],d=u.some(y=>{if(y.drawPosition===r)return delete y.participantId,delete y.qualifier,delete y.bye,!0});if(c.structureType===Cn)return Y8({positionAssignments:u,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:c}),{drawPositionCleared:d,...Z};let p={isCollectionMatchUp:!1},{matchUps:m}=$t({drawDefinition:i,matchUpFilters:p,matchUpsMap:n,structure:c,event:o}),{roundProfile:h,roundMatchUps:f}=Pn({matchUps:m}),g=(s=h&&Object.keys(h))==null?void 0:s.map(y=>Xe(y)),v=r,I=(l=g==null?void 0:g.map(y=>{var b,S,w,U;let T=(S=(b=h==null?void 0:h[y])==null?void 0:b.pairedDrawPositions)==null?void 0:S.find(C=>C.includes(v)),P=T==null?void 0:T.find(C=>C!==v),R=u.find(C=>C.drawPosition===P),D=h==null?void 0:h[y+1],E=R==null?void 0:R.bye,N=(w=D==null?void 0:D.pairedDrawPositions)==null?void 0:w.find(C=>C.includes(P)),A=E&&N&&D&&((U=D.drawPositions)==null?void 0:U.includes(P)),M=T&&{pairedDrawPositionByeAdvancedPair:!A&&N,pairedDrawPosition:P,targetDrawPosition:v,relevantPair:T,roundNumber:y};return A&&(v=P),M}).filter(y=>y==null?void 0:y.targetDrawPosition))==null?void 0:l.reduce((y,b)=>{let{roundNumber:S,relevantPair:w,targetDrawPosition:U,pairedDrawPosition:T,pairedDrawPositionByeAdvancedPair:P}=b,R={roundNumber:S,targetDrawPosition:U,relevantPair:w},D=P&&{roundNumber:S+1,targetDrawPosition:T,relevantPair:P,subsequentRoundRemoval:!0},E=[R,D].filter(Boolean);return y.concat(...E)},[]);return I==null||I.forEach(({roundNumber:y,targetDrawPosition:b,relevantPair:S})=>{let w=f==null?void 0:f[y].find(U=>{var T;return Dn((T=U.drawPositions)==null?void 0:T.filter(Boolean),S.filter(Boolean))});w&&(ASe({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:y,matchUpsMap:n}),K8({inContextDrawMatchUps:t,positionAssignments:u,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:r,matchUpsMap:n,structure:c,event:o}))}),{tasks:I,drawPositionCleared:d,positionAssignments:u}}function ASe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,roundNumber:a,structureId:o}){let{structure:s}=et({drawDefinition:r,structureId:o});if(!s)return{error:Ri};if(s.structureType===Cn)return;n=n||Zr({drawDefinition:r});let l=((n==null?void 0:n.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:c}=Bm({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var m;return p.roundNumber>=a&&p.roundNumber!==c&&((m=p.drawPositions)==null?void 0:m.includes(e))}),d=ei({drawDefinition:r,structureId:o}).positionAssignments??[];return u==null||u.forEach(p=>K8({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,structure:s})),{...Z}}function K8({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:r,targetMatchUp:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var c,u,d,p,m,h;let f="removeDrawPosition",g=(c=n.drawPositions)==null?void 0:c.slice(),v=n.matchUpStatus,I=n.winningSide;o=o??Zr({drawDefinition:r});let y=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:b}=Bm({drawPosition:a,matchUps:y});if(n.roundNumber&&b&&n.roundNumber>b){let N=(n.drawPositions??[]).map(A=>A===a?void 0:A);n.drawPositions=N}if(n.matchUpType===di){let N=(((u=t==null?void 0:t.find(A=>A.matchUpId===n.matchUpId))==null?void 0:u.sides)??[]).reduce((A,M,C)=>M.drawPosition===a?C:A,void 0);N!==void 0&&(p=(d=n.sides)==null?void 0:d[N])!=null&&p.lineUp&&((m=n.sides)==null||delete m[N].lineUp,Et({tournamentId:i==null?void 0:i.tournamentId,context:`${f}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:n,drawDefinition:r}))}let S=Rn({matchUpId:n.matchUpId,inContextDrawMatchUps:t,drawDefinition:r}),{targetLinks:{winnerTargetLink:w},targetMatchUps:{loserMatchUp:U,winnerMatchUp:T,loserMatchUpDrawPositionIndex:P}}=S,R=e.filter(({drawPosition:N})=>{var A;return(A=n.drawPositions)==null?void 0:A.includes(N)}).filter(N=>N.bye).length,D=R&&Ft||n.matchUpStatus&&[Ot,jt].includes(n.matchUpStatus)&&n.matcHUpStatus||((h=n.drawPositions)==null?void 0:h.length)===2&&zi||void 0;n.matchUpStatus=D,n.matchUpStatus&&[jt,Ot].includes(n.matchUpStatus)&&(n.winningSide=void 0);let E=g==null?void 0:g.find(N=>{var A;return!((A=n.drawPositions)!=null&&A.includes(N))});if(g!=null&&g.includes(a)&&v===n.matchUpStatus&&I===n.winningSide||(E&&Qa({method:f,color:"brightyellow",removedDrawPosition:E}),Et({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:n,context:`${f}-${a}`,drawDefinition:r})),U&&U.structureId!==S.matchUp.structureId&&!R){let{drawPositions:N,roundNumber:A}=U;if(A===1){let M=N[P];SM({structureId:U.structureId,drawPosition:M,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o})}else{let M=Math.min(...N.filter(Boolean)),C=OSe({loserMatchUpDrawPosition:M,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,loserMatchUp:U,matchUpsMap:o,event:l});if(C.error)return ee({result:C,stack:f});let O=((o==null?void 0:o.mappedMatchUps)||{})[U.structureId].matchUps,{initialRoundNumber:k}=Bm({drawPosition:M,matchUps:O});k===1&&(Qa({method:f,color:"brightyellow",loserMatchUpDrawPosition:M}),SM({structureId:U.structureId,drawPosition:M,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,matchUpsMap:o}))}}return T&&T.structureId!==S.matchUp.structureId&&w.target.feedProfile,{...Z}}function OSe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,loserMatchUp:n,matchUpsMap:a,event:o}){var s;let{structure:l}=et({structureId:n.structureId,drawDefinition:r}),{positionAssignments:c}=ei({structure:l});if((s=c==null?void 0:c.find(u=>u.drawPosition===t))!=null&&s.bye){let u=Nw({drawPosition:t,structureId:n.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,matchUpsMap:a,event:o});if(u.error)return u}return{...Z}}function Np({drawDefinition:t,stages:e}){if(!t)return{error:Ce};let i=((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)),r=ht(i.map(n=>{let{positionAssignments:a}=ei({structure:n});return a?a.map(bt):[]}).flat().filter(Boolean));return{...Z,assignedParticipantIds:r}}function ds(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((r,n)=>{let{entryStage:a,entryStatus:o}=n,s=`_${a||Oe}${o||""}`;return r[s]||(r[s]=[]),r[s].push(n),r},{}),i=r=>isNaN(r)?1/0:r;return Object.keys(e).map(r=>e[r].sort((n,a)=>i(n.entryPosition)-i(a.entryPosition)).map((n,a)=>{let o=a+1;return{...n,entryPosition:o}})).flat()}function Id(t){return[Tp,Ko].includes(t)}function N0({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:r,participantIds:n,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var p,m,h,f,g,v,I,y,b,S,w,U;if(!n||!Array.isArray(n))return{error:Ks,method:"modifyEntriesStatus",participantIds:n};if(!r&&!d)return{error:Wt};if(a&&!m8.includes(a))return{error:aM};if(o&&!VF.includes(o))return{error:bp};let T="modifyEntriesStatus",P=[];if(!a&&!s)return ee({result:{error:Ve},info:"Missing entryStatus",stack:T});if(s&&!Js({extension:s,requiredAttributes:["name"]}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:s},stack:T});let R=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach($=>{let _=Np({stages:u&&[u],drawDefinition:$}).assignedParticipantIds??[];R.push(..._)});let D=(i==null?void 0:i.participants)??[];if(!n.every($=>{var _;let L=(_=kc({tournamentParticipants:D,participantId:$}))==null?void 0:_.participantType;return!(L&&[st,Za].includes(L)&&Id(a))&&!(a&&d!=null&&d.eventType&&L===wt&&[$o,oo].includes(d.eventType)&&[Ro,...bS].includes(a))}))return{error:aM};let E=d&&Yi({event:d}).flightProfile,N=(m=E==null?void 0:E.flights)==null?void 0:m.find($=>$.drawId===c),A=$=>{let _=($||[]).filter(B=>!u||!B.entryStage||u===B.entryStage).filter(({participantId:B})=>n.includes(B)),L=B=>a&&R.includes(B.participantId)&&!(bS.includes(B.entryStatus)&&bS.includes(a));return _.every(B=>L(B)&&!e?!1:(a&&(B.entryStatus=a,delete B.entryPosition),o&&(B.entryStage=o,delete B.entryPosition),s&&(s.value?Mt({element:B,extension:s}):In({element:B,name:s.name})),!0))?{...Z}:{error:nv}},M=({flight:$,drawDefinition:_})=>{d&&(d.entries=ds({entries:d.entries??[]})),$&&($.drawEntries=ds({entries:$.drawEntries})),_&&(_.entries=ds({entries:_.entries}))},C=$=>{let{flight:_,drawDefinition:L}=$,B="updateDrawEntries";if(_){let V=A(_.drawEntries);if(V.error)return ee({result:V,stack:B})}if(L){let V=A(L.entries);if(V.error)return ee({result:V,stack:B});P.includes(L.drawId)||P.push(L.drawId)}return{...Z}},O=((h=d==null?void 0:d.entries)==null?void 0:h.find(({entryPosition:$})=>$))??(((f=N==null?void 0:N.drawEntries)==null?void 0:f.find(({entryPosition:$})=>$))||((g=r==null?void 0:r.entries)==null?void 0:g.find(({entryPosition:$})=>$)));if(t&&!O&&M({flight:N,drawDefinition:r}),N||r){let $=C({flight:N,drawDefinition:r});if($.error)return ee({result:$,stack:T})}let k=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:$})=>$))??[],x=((I=E==null?void 0:E.flights)==null?void 0:I.filter($=>!k.includes($.drawId)))||[];for(let $ of x){let _=$&&C({flight:$});if(_!=null&&_.error)return ee({result:_,stack:T})}let F=((y=E==null?void 0:E.flights)==null?void 0:y.length)===1&&(((b=d==null?void 0:d.drawDefinitions)==null?void 0:b.length)??0)<=((S=E==null?void 0:E.flights)==null?void 0:S.length);if(!N&&!r&&a&&p8.includes(a))return{error:AK};if(!N&&!r||a===Nu||l&&F){let $=A(d==null?void 0:d.entries);if($!=null&&$.error)return ee({result:$,stack:T});let _;if(a===Nu&&((w=E==null?void 0:E.flights)==null||w.every(L=>{let B=A(L.drawEntries);return B.error?(_=B.error,!1):(L.drawEntries=L.drawEntries.filter(({participantId:V})=>!n.includes(V)),!0)}),(U=d==null?void 0:d.drawDefinitions)==null||U.every(L=>{var B;let V=A(L.entries);return V.error?(_=V.error,!1):(L.entries=(B=L.entries)==null?void 0:B.filter(({participantId:G})=>!n.includes(G)),!0)})),_)return ee({result:{error:_},stack:T})}t&&M({flight:N,drawDefinition:r});for(let $ of(d==null?void 0:d.drawDefinitions)??[])P.length&&!P.includes($.drawId)||pi({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...Z}}function J8(t){let{participantMap:e,participantId:i,matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||r===Ft||e[i].scheduleItems.push({...u,scheduledDate:ct(u==null?void 0:u.scheduledDate),scheduledTime:fi(u==null?void 0:u.scheduledTime),checkScoreHasValue:_r({score:p}),matchUpStatus:r,roundPosition:n,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function Pl({requireTimeStamp:t,scaleAttributes:e,participant:i}){var r,n;if(!i)return{error:wh};if(!Ii(e))return{error:oe};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,c=[Om,o,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,m,h]=((r=u.itemType)==null?void 0:r.split("."))??[];if(d!==Om)return{error:tw};let f=((n=a&&mm({element:u.itemValue,accessor:a}))==null?void 0:n.value)||u.itemValue,g={eventType:m,scaleDate:u.itemDate,scaleValue:f,scaleName:h,scaleType:p};return{...Z,scaleItem:g}}}return{...Z,scaleItem:void 0}}function kSe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:r,event:n}){var a,o,s;let l={},c=m=>[Om,Tl,n.eventType,m].join("."),u=Object.assign({},...(r.timeItems||[]).filter(({itemType:m})=>m.split(".")[1]===Tl).map(({itemType:m,itemValue:h})=>({[m]:h}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(c),p=Hi(Object.keys(u),d);if((!e||!Object.keys(u).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let m=Object.keys(t.stageSeedingScaleNames).map(f=>{let g=c(t.stageSeedingScaleNames[f]),v=u[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else if(p){let m=p.map(h=>u[h]);l.seedValue=m.pop()}}else if(!e&&typeof i=="object"){let m=Object.keys(i).map(f=>{let g=c(i[f]),v=u[g];return[f,v]}).filter(f=>f[1]).map(f=>({[f[0]]:{seedValue:f[1]}})),h=Object.assign({},...m);l.seedAssignments=h}else{let{categoryName:m,ageCategoryCode:h}=n.category||{},f=[h,n.eventId,m].filter(Boolean),g;for(let v of f){let I={eventType:n.eventType,scaleType:Tl,scaleName:v},y=Pl({scaleAttributes:I,participant:r});if(y.scaleItem){g=y.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function xSe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:r,seedValue:n,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...NF(d??[])):{},m=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:o,eventId:a});i.events[a]=He(m,!1,!1,!0),r&&(e&&(i.events[a].seedAssignments=e),n&&(i.events[a].seedValue=n))}function JP(t,e){return(t||"").localeCompare(e||"")}function FSe({tournamentRecord:t,status:e=Xo}){var i,r,n;let a=`${Rp}.${Ep}`;return(n=(r=(i=Ew({tournamentRecord:t,itemType:a}))==null?void 0:i.timeItem)==null?void 0:r.itemValue)==null?void 0:n[e]}function LSe(t){let{tournamentId:e}=t??{};return!!e}function mo({event:t,status:e=Xo}){var i,r,n;let a=`${Rp}.${Ep}`;return(n=(r=(i=Rw({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:r.itemValue)==null?void 0:n[e]}function PL({drawDetails:t,drawId:e}){var i,r;return(r=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:r.published}function Oh(t){var e,i,r,n,a,o,s;let{tournamentRecord:l,drawDefinition:c,eventIds:u,eventId:d,drawIds:p,drawId:m,event:h}=t??{};if(l&&!LSe(l))return{error:oe};if(d&&!h)return{error:ha};if(Array.isArray(u)&&u!=null&&u.length){let y={};for(let b of u){if(!On(b))return{error:oe};let S=(e=xn({tournamentRecord:l,eventId:b}))==null?void 0:e.event;if(!S)return{error:ha};let w=GE({event:S});y[b]=w}return{...Z,publishState:y}}if(h){let y=GE({event:h}),b={};if(m)return c?{publishState:{status:{published:!!((i=y.status.publishedDrawIds)!=null&&i.includes(m)),drawDetail:(r=y.status.drawDetails)==null?void 0:r[m]},...Z}}:{error:ma};if(Array.isArray(p)&&p!=null&&p.length){let S=((n=h.drawDefinitions)==null?void 0:n.map(ny))??[];for(let w of p){if(!On(w))return{error:oe};if(!S.includes(w))return{error:ma};b[w]={status:{published:!!y.status.publishedDrawIds.includes(w),drawDetail:(a=y.status.drawDetails)==null?void 0:a[w]}}}}else b=y;return{...Z,publishState:b}}let f=[],g=!1,v={},I=FSe({tournamentRecord:l});v.tournament=I??{};for(let y of(l==null?void 0:l.events)??[]){let b=GE({event:y});v[y.eventId]=b,b.status.published&&(f.push(y.eventId),g=!0);for(let{drawId:S}of y.drawDefinitions??[]){let w=(s=(o=b.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(S);w&&(v[S]={status:{published:w}})}}return l&&(v.tournament.status={published:g,publishedEventIds:f}),{...Z,publishState:v}}function GE({event:t}){var e;let i=mo({event:t});if(!i)return{status:{published:!1}};let r={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(r,i.seeding);let n=i.drawDetails??{};for(let o of((e=t.drawDefinitions)==null?void 0:e.map(ny))||[])n[o]||(n[o]={publishingDetail:{published:!1}});let a=n&&Object.keys(n).length&&Object.keys(n).filter(o=>PL({drawDetails:n,drawId:o}))||i.drawIds;return{status:{published:a&&a.length>0,publishedDrawIds:a,publishedSeeding:r,drawDetails:n}}}function _Se({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:r,matchUpStatus:n,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],m=I=>Math.abs(I[0]-I[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:u});let h=p.structureParticipation[l],{winner:f,loser:g}=t,v=r?f:g;r&&(h.winCount+=1,n===jt&&(h.walkoverWinCount+=1),n===Ot&&(h.defaultWinCount+=1)),v&&(!h.finishingPositionRange||m(v)<m(h.finishingPositionRange))&&(h.finishingPositionRange=v),i&&((!h.finishingRound||i<h.finishingRound)&&(h.finishingMatchUpId=c,h.finishingRound=i,h.roundNumber=s),i===1&&(h.participantWon=r))}function oV(t){var e,i,r,n,a,o,s,l,c,u;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:m,participantMap:h,withOpponents:f,withMatchUps:g,withEvents:v,withDraws:I,finishingPositionRange:y,finishingRound:b,matchUpStatus:S,stageSequence:w,roundNumber:U,structureId:T,score:P,stage:R,withRankingProfile:D,tieWinningSide:E,roundPosition:N,matchUpTieId:A,matchUpSides:M,collectionId:C,matchUpType:O,winningSide:k,matchUpId:x,schedule:F,eventId:$,drawId:_,sides:L}=t,B=f&&(L==null?void 0:L.length)===2&&Object.assign({},...L.map(({sideNumber:V},G)=>{let j=L[1-G].participantId;return V&&{[V]:j}}).filter(Boolean));for(let V of L){let{participantId:G,sideNumber:j,bye:H}=V;if(H)continue;let W=k===j,Y=K=>{var z,te;let J=(z=h[K])==null?void 0:z.participant,ie=J==null?void 0:J.participantType,ne=[{participantId:K,participantType:ie}];if(ie!==Za)for(let ue of(J==null?void 0:J.individualParticipantIds)||[]){let ae=(te=h[ue])==null?void 0:te.participant;ne.push({participantType:ae==null?void 0:ae.participantType,participantId:ue})}return ne},q=(K,z)=>{if(g){if(h[K].matchUps[x]={participantWon:W,matchUpType:O,structureId:T,sideNumber:j,matchUpId:x,eventId:$,drawId:_,stage:R},f){let te=Y(z);h[K].matchUps[x].opponentParticipantInfo=te}C&&(h[K].matchUps[x].collectionId=C)}f&&z&&(h[K].opponents[z]={participantId:z,matchUpId:x,eventId:$,drawId:_}),D&&_Se({finishingPositionRange:y,participantMap:h,participantWon:W,finishingRound:b,matchUpStatus:S,participantId:K,stageSequence:w,roundNumber:U,structureId:T,matchUpId:x,drawId:_,stage:R}),(p||d)&&J8({participantMap:h,participantId:K,matchUpStatus:S,roundPosition:N,matchUpType:O,roundNumber:U,structureId:T,matchUpId:x,schedule:F,drawId:_,score:P})},re=({participant:K,partnerParticipantId:z})=>{var te,J,ie;let ne=(ue,ae)=>{ue&&(ue.partnerParticipantIds||(ue.partnerParticipantIds=[]),ue.partnerParticipantIds.includes(ae)||ue.partnerParticipantIds.push(ae))};I&&ne((te=K==null?void 0:K.draws)==null?void 0:te[_],z),v&&ne((J=K==null?void 0:K.events)==null?void 0:J[$],z),g&&ne((ie=K==null?void 0:K.matchUps)==null?void 0:ie[x],z)};if(G&&h[G]){let K=B==null?void 0:B[j];q(G,K);let z=((e=h[G])==null?void 0:e.participant.participantType)===st,te=((i=h[G])==null?void 0:i.participant.individualParticipantIds)||[];if(A){if(m){let J=ie=>h[ie].matchUps[A]={participantWon:E===j,matchUpId:A,matchUpType:di,sideNumber:j};J(G),te.forEach(J)}if(I&&!h[G].draws[_]){let J=(n=(r=M.find(ue=>ue.sideNumber===j))==null?void 0:r.participant)==null?void 0:n.participantId,ie=(s=(o=(a=h[J])==null?void 0:a.draws)==null?void 0:o[_])==null?void 0:s.entryStatus,ne=ue=>h[ue].draws[_]={entryStatus:ie,eventId:$,drawId:_};ne(G),te.forEach(ne)}}if(z&&(te.forEach(J=>h[J]&&q(J,K)),te.forEach((J,ie)=>{let ne=te[1-ie],ue=h[J];ue&&re({participant:ue,partnerParticipantId:ne})}),v&&M)){let J=(c=(l=M.find(ie=>ie.sideNumber===j))==null?void 0:l.participant)==null?void 0:c.participantId;if(J){let ie=(u=h[J])==null?void 0:u.events[$];ie?(h[G].events[$]={...ie},te.forEach(ne=>h[ne].events[$]={...ie})):console.log("Missing teamEntry",{eventId:$,teamParticipantId:J})}}if(k){let J=ie=>{W?(h[ie].counters[O].wins+=1,h[ie].counters.wins+=1,S===jt&&(h[ie].counters[O].walkoverWins+=1,h[ie].counters.walkoverWins+=1),S===Ot&&(h[ie].counters[O].defaultWins+=1,h[ie].counters.defaultWins+=1)):(h[ie].counters[O].losses+=1,h[ie].counters.losses+=1,S===jt&&(h[ie].counters[O].walkovers+=1,h[ie].counters.walkovers+=1),S===Ot&&(h[ie].counters[O].defaults+=1,h[ie].counters.defaults+=1))};J(G),te.forEach(J)}}}}function $Se(t){var e,i,r,n,a,o,s;let{participantFilters:l,convertExtensions:c,policyDefinitions:u,tournamentRecord:d,usePublishState:p,contextProfile:m,participantMap:h,withPotentialMatchUps:f,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:I,withTeamMatchUps:y,withStatistics:b,withOpponents:S,withMatchUps:w,withSeeding:U,withEvents:T,withDraws:P}=t,R=l==null?void 0:l.participantIds,D=F=>{var $,_;let L=[F];return(_=($=h[F])==null?void 0:$.participant.individualParticipantIds)==null||_.forEach(B=>L.push(B)),L.some(B=>!(R!=null&&R.length)||R.includes(B))?L:[]},E={withMatchUps:w||g,withEvents:T||g,withDraws:P||g,withPotentialMatchUps:f,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:I,withTeamMatchUps:y,withStatistics:b,participantMap:h,withOpponents:S,withSeeding:U},N=[],A={},M=[],C={},O={},k={},x=({eventType:F,scaleNames:$,participantId:_})=>{var L,B,V,G;return(G=(V=(B=(L=h[_].participant)==null?void 0:L.rankings)==null?void 0:B[F])==null?void 0:V.find(j=>$.includes(j.scaleName)))==null?void 0:G.scaleValue};for(let F of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes(F.eventId))continue;let{drawDefinitions:$=[],extensions:_=[],eventType:L,eventName:B,category:V,entries:G,eventId:j,gender:H}=F,{flightProfile:W}=Yi({event:F}),Y=(W==null?void 0:W.flights)??[],q=Oh({event:F}).publishState;q&&(C[j]=q);let re=(e=q==null?void 0:q.status)==null?void 0:e.publishedSeeding;if(T||U||g){let z=c?Object.assign({},...NF(_??[])):{};O[j]={...z,eventName:B,eventType:L,category:V,eventId:j,gender:H};let te=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean);for(let J of G){let{participantId:ie}=J;if(!ie||!h[ie])continue;let ne=x({eventType:L,scaleNames:te,participantId:ie}),ue,ae;if(U){let pe=h[ie].participant;({seedAssignments:ue,seedValue:ae}=kSe({publishedSeeding:re,usePublishState:p,withSeeding:U,participant:pe,event:F}))}let ce=pe=>{var Se,Be;if((Be=(Se=h[pe])==null?void 0:Se.events)!=null&&Be[j])return;let Pe=h[pe];xSe({convertExtensions:c,seedAssignments:ue,participant:Pe,withSeeding:U,seedValue:ae,eventId:j,ranking:ne,entry:J})};ce(ie),(h[ie].participant.individualParticipantIds||[]).forEach(ce)}}let K=(i=C==null?void 0:C[j])==null?void 0:i.publishedSeeding;if(P||g||U){let z=J=>J?Object.assign({},...J.map(({participantId:ie,seedValue:ne,seedNumber:ue})=>({[ie]:{seedValue:ne,seedNumber:ue}}))):void 0,te=ht([...$.map(ny),...Y.map(ny)]);for(let J of te){let ie=$.find(ye=>ye.drawId===J),ne=Y==null?void 0:Y.find(ye=>ye.drawId===J),ue=(ie==null?void 0:ie.entries)||(ne==null?void 0:ne.drawEntries),{structures:ae=[],drawOrder:ce,drawName:pe,drawType:Se}=ie??{},Be=ne==null?void 0:ne.flightNumber,Pe=[V==null?void 0:V.categoryName,V==null?void 0:V.ageCategoryCode].filter(Boolean),at=((ie==null?void 0:ie.structures)||[]).sort((ye,Te)=>Rh(ye,Te)).map(({structureId:ye,structures:Te})=>[ye,...(Te||[]).map(({structureId:Ze})=>Ze)]).flat(1/0),de,Ie,me,Me,be=0,_e=ae.filter(({stage:ye,stageSequence:Te})=>ye===Oe&&Te===1||ye===qe).flatMap(ye=>{let{seedAssignments:Te,stageSequence:Ze,stage:je}=ye,{positionAssignments:ve}=ei({structure:ye});return je===Oe?(be=(ve==null?void 0:ve.length)??0,me=ve,Me=Te):Ze===1&&(de=ve,Ie=Te),ve}).map(({participantId:ye})=>ye).filter(Boolean),Ne=z(Me),se=z(Ie),ge=ie?ue.filter(({participantId:ye})=>_e.includes(ye)):ue,we=!p||(K==null?void 0:K.published)&&(((r=K==null?void 0:K.drawIds)==null?void 0:r.length)===0||((n=K==null?void 0:K.drawIds)==null?void 0:n.includes(J)));for(let ye of ge){let{entryStatus:Te,entryStage:Ze,entryPosition:je,participantId:ve}=ye,qt=x({participantId:ve,scaleNames:Pe,eventType:L}),Xi=Ke=>{var At,Ei,dr,mn,cl;if((At=h[Ke].draws)!=null&&At[J])return;let ba=U&&we,wa=ba?{}:void 0,Es=ba?((Ei=Ne==null?void 0:Ne[ve])==null?void 0:Ei.seedValue)||((dr=Ne==null?void 0:Ne[ve])==null?void 0:dr.seedNumber):void 0,ho=Es?Ne==null?void 0:Ne[ve]:void 0,Qr=ba?((mn=se==null?void 0:se[ve])==null?void 0:mn.seedValue)||((cl=se==null?void 0:se[ve])==null?void 0:cl.seedNumber):void 0,dl=Qr?se==null?void 0:se[ve]:void 0;wa&&Es&&(wa[Oe]=ho),wa&&Qr&&(wa[qe]=dl);let pl=Es||Qr;pl&&(h[Ke].participant.seedings[L]||(h[Ke].participant.seedings[L]=[]),ho&&h[Ke].participant.seedings[L].push({...ho,scaleName:J}),dl&&h[Ke].participant.seedings[L].push({...dl,scaleName:J}),wa&&(h[Ke].events[j].seedAssignments||(h[Ke].events[j].seedAssignments={}),Object.keys(wa).forEach(Cs=>h[Ke].events[j].seedAssignments[Cs]=wa[Cs]))),(P||g)&&(h[Ke].draws[J]=He({seedAssignments:wa,entryPosition:je,entryStatus:Te,entryStage:Ze,seedValue:pl,eventId:j,ranking:qt,drawId:J},!1,!1,!0))};[Ko,Tp].includes(Te)||(Xi(ve),(a=h[ve].participant.individualParticipantIds||[])==null||a.forEach(Xi))}let De=((ie==null?void 0:ie.structures)??[]).reduce((ye,Te)=>(ye.includes(Te.stage)||ye.push(Te.stage),ye),[]),Le=((ie==null?void 0:ie.links)??[]).length;k[J]={qualifyingPositionAssignments:de,qualifyingSeedAssignments:Ie,mainPositionAssignments:me,qualifyingSeedingMap:se,mainSeedAssignments:Me,orderedStructureIds:at,mainSeedingMap:Ne,flightNumber:Be,linksCount:Le,drawOrder:ce,drawName:pe,drawType:Se,drawSize:be,drawId:J,stages:De}}}if(g||I||y||b||S||w||P){let z=!!I||f,te=((o=Qu({afterRecoveryTimes:!!I,policyDefinitions:u,tournamentRecord:d,inContext:!0,contextProfile:m,participantMap:h,nextMatchUps:z,event:F}))==null?void 0:o.matchUps)??[];for(let J of te){let{finishingPositionRange:ie,potentialParticipants:ne,tieMatchUps:ue=[],sides:ae=[],winningSide:ce,matchUpType:pe,matchUpId:Se,eventId:Be,drawId:Pe,collectionId:at,stageSequence:de,finishingRound:Ie,matchUpStatus:me,roundPosition:Me,roundNumber:be,structureId:_e,schedule:Ne,score:se,stage:ge}=J;A[Se]=J;let we={finishingPositionRange:ie,finishingRound:Ie,stageSequence:de,roundPosition:Me,collectionId:at,roundNumber:be,structureId:_e,schedule:Ne,eventId:Be,drawId:Pe,score:se,stage:ge};oV({...we,...E,matchUpStatus:me,winningSide:ce,matchUpType:pe,matchUpId:Se,sides:ae});for(let De of ue){let{winningSide:Le,sides:ye=[],matchUpId:Te,matchUpStatus:Ze,matchUpType:je}=De;oV({...we,...E,winningSide:Le,tieWinningSide:ce,matchUpTieId:Se,matchUpId:Te,sides:ye,matchUpSides:ae,matchUpStatus:Ze,matchUpType:je})}Array.isArray(ne)&&(z||I||v)&&((s=ne.flat().map(bt).filter(Boolean))==null||s.forEach(De=>{var Le;(Le=D(De))==null||Le.forEach(ye=>{h[ye]&&(h[ye].potentialMatchUps[Se]=He({tournamentId:d==null?void 0:d.tournamentId,matchUpId:Se,eventId:Be,drawId:Pe}))}),(I||v)&&J8({potential:!0,participantMap:h,participantId:De,matchUpStatus:me,roundPosition:Me,structureId:_e,matchUpType:pe,roundNumber:be,matchUpId:Se,schedule:Ne,drawId:Pe,score:se})}))}M.push(...te)}}if(b||g||I){let F=Object.values(h);for(let $ of F){let{wins:_,losses:L,[Ni]:{wins:B,losses:V},[ui]:{wins:G,losses:j}}=$.counters,H=(W,Y,q)=>{let re=Y+q,K=Y,z=re&&K/re;$.statistics[W]={denominator:re,numerator:K,statValue:z,statCode:W}};if(b&&(H(wS,_,L),H(`${wS}.${Ni}`,B,V),H(`${wS}.${ui}`,G,j)),g){let W=(Y=[])=>Math.abs(Y[0]-Y[1]);for(let Y of Object.keys($.draws)){let{orderedStructureIds:q=[],flightNumber:re}=k[Y]||{};if($.structureParticipation&&q.length){let K,z=0,te=q.map(J=>{let ie=$.structureParticipation[J];if(!ie)return;K||(K=ie==null?void 0:ie.finishingPositionRange),W(K)>W(ie==null?void 0:ie.finishingPositionRange)&&(K=ie==null?void 0:ie.finishingPositionRange);let ne=ie.stage!==qe;return ne&&(z+=1),He({...ie,participationOrder:ne?z:void 0,flightNumber:re})}).filter(Boolean);$.draws[Y]&&($.draws[Y].finishingPositionRange=K,$.draws[Y].structureParticipation=te)}}}if(I){let W=Ii(I)?I.scheduledMinutesDifference:0,Y=$.scheduleItems||[],q=$.potentialMatchUps||{},re=Y.reduce((z,te)=>{let{scheduledDate:J,scheduledTime:ie}=te;return z[J]||(z[J]=[]),ie&&z[J].push(te),z},{});Object.values(re).forEach(z=>z.sort(E9));for(let z of Y){let{typeChangeTimeAfterRecovery:te,timeAfterRecovery:J,scheduledDate:ie,scheduledTime:ne}=z,ue=re[ie],ae=Pt(ne);for(let ce of ue){if(ce.matchUpId===z.matchUpId||[jt,Ot].includes(ce.matchUpStatus)&&!ce.checkScoreHasValue)continue;let pe=z.matchUpType!==ce.matchUpType&&te||J,Se=z.drawId===ce.drawId,Be=q[z.matchUpId]&&q[ce.matchUpId],Pe=Pt(ce.scheduledTime),at=Math.abs(Pe-ae),de=Pe>=ae;if((W&&!isNaN(W)?at<=W:de&&Pt(ce.scheduledTime)<Pt(pe))&&!(Be&&Se)&&de){let Ie=[z.matchUpId,ce.matchUpId].sort(JP).join("|");$.scheduleConflicts[Ie]={priorScheduledMatchUpId:z.matchUpId,matchUpIdWithConflict:ce.matchUpId}}}}let K=$.participant.participantId;Object.keys($.scheduleConflicts).length&&N.push(K),h[K].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:N,eventsPublishStatuses:C,derivedEventInfo:O,derivedDrawInfo:k,mappedMatchUps:A,participantMap:h,matchUps:M}}function Aw({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var r;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:m,eventIds:h,genders:f}=t,g=hl(h)&&((r=e==null?void 0:e.events)==null?void 0:r.filter(S=>h==null?void 0:h.includes(S.eventId)))||(e==null?void 0:e.events)||[],v=a&&BSe({drawEntryStatuses:a,tournamentEvents:g}),I=s&&VSe({eventEntryStatuses:s,tournamentEvents:g}),y=o!==void 0&&[!0,!1].includes(o)&&g.reduce((S,w)=>S.concat(...(w.drawDefinitions||[]).map(U=>i8({drawDefinition:U}).allPositionedParticipantIds).filter(Boolean)),[]),b=S=>n==null?void 0:n.reduce((w,U)=>{let{accessor:T,value:P}=U,{values:R}=mm({element:S,accessor:T});return w&&(R==null?void 0:R.includes(P))},!0);if(i=i==null?void 0:i.filter(S=>{var w,U;let T=(U=(w=ul({element:S,itemType:hw}))==null?void 0:w.timeItem)==null?void 0:U.itemValue,{participantRoleResponsibilities:P,participantType:R,participantRole:D,participantId:E,person:N}=S,A=Array.isArray(f)&&(f==null?void 0:f.length)&&(N==null?void 0:N.sex)&&f.includes(N.sex);return m?f&&A||o&&y.includes(E)||o===!1&&!y.includes(E)||(v==null?void 0:v.includes(E))||(I==null?void 0:I.includes(E))||(d==null?void 0:d.includes(E))||p&&T===p||u&&R&&hl(u)&&u.includes(R)||l&&D&&hl(l)&&l.includes(D)||c&&hl(P)&&hl(c)&&c.find(M=>P==null?void 0:P.includes(M))||(n==null?void 0:n.length)&&hl(n)&&b(S):(!f||A)&&(o===void 0||o&&y.includes(E)||o===!1&&!y.includes(E))&&(!v||v.includes(E))&&(!I||I.includes(E))&&(!d||d.includes(E))&&(!p||T===p)&&(!u||R&&hl(u)&&u.includes(R))&&(!l||D&&hl(l)&&l.includes(D))&&(!c||hl(P)&&hl(c)&&c.find(M=>P==null?void 0:P.includes(M)))&&(!(n!=null&&n.length)||hl(n)&&b(S))}),g.length&&h){let S=g.filter(w=>h.includes(w.eventId)).map(w=>{let U=(w.entries||[]).map(P=>P.participantId);if(Bi(Wl)(w.eventType))return U;let T=((e==null?void 0:e.participants)??[]).filter(P=>U.includes(P.participantId)).map(P=>P.individualParticipantIds).flat(1);return U.concat(...T)}).flat(1);i=i==null?void 0:i.filter(w=>S.includes(w.participantId))}return i}function hl(t){return t&&Array.isArray(t)&&t.length}function BSe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:r})=>Array.isArray(t)?t.includes(r):!0;return ht(e.reduce((r,n)=>{var a,o;let{flightProfile:s}=Yi({event:n}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(bt):[]).flat())||[],c=((o=n.drawDefinitions)==null?void 0:o.map(({entries:u})=>u?u.filter(i).map(bt):[]))||[];return r.concat(...l,...c)},[]))}function VSe({eventEntryStatuses:t,tournamentEvents:e}){return ht(e.reduce((i,r)=>{let n=(r.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(bt);return i.concat(...n)},[]))}function Wi(t){var e;let{withIndividualParticipants:i,participantFilters:r={},withPotentialMatchUps:n,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:m,usePublishState:h,contextProfile:f,withStatistics:g,withOpponents:v,withMatchUps:I,internalUse:y,withSeeding:b,withEvents:S,withDraws:w,withISO2:U,withIOC:T}=t;if(!c)return{error:he};(I||a)&&Zo({tournamentRecord:c});let{participantMap:P}=z8({convertExtensions:o,tournamentRecord:c,withSignInStatus:d,withScaleValues:m,internalUse:y,withISO2:U,withIOC:T}),R=$Se({withMatchUps:I??a,withEvents:S??a,withDraws:w??a,withPotentialMatchUps:n,participantFilters:r,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:p,usePublishState:h,withStatistics:g,participantMap:P,withOpponents:v,contextProfile:f,withSeeding:b}),{participantIdsWithConflicts:D,eventsPublishStatuses:E,derivedEventInfo:N,derivedDrawInfo:A,mappedMatchUps:M}=R,C=R.matchUps;P=R.participantMap;let O=u??n,k=({potentialMatchUps:B,scheduleConflicts:V,scheduleItems:G,participant:j,statistics:H,opponents:W,matchUps:Y,events:q,draws:re})=>{let K=Object.values(re),z=Object.values(W);return v&&(K==null||K.forEach(te=>{te.opponents=z.filter(J=>J.drawId===te.drawId)})),He({...j,scheduleConflicts:u?Object.values(V):void 0,draws:w||a?K:void 0,events:S||a?Object.values(q):void 0,matchUps:I||a?Object.values(Y):void 0,opponents:v?z:void 0,potentialMatchUps:O?Object.values(B):void 0,statistics:g?Object.values(H):void 0,scheduleItems:l?G:void 0},!1,!1,!0)},x=new Map;for(let B of Object.keys(P))x.set(B,k(P[B]));let F=[...x.values()],$=(e=s==null?void 0:s[dv])==null?void 0:e.participant,_=Aw({participants:F,participantFilters:r,tournamentRecord:c});if(i){let B=Ii(i)?i:void 0;for(let V of _)for(let G of V.individualParticipantIds??[]){V.individualParticipants||(V.individualParticipants=[]);let j=x.get(G);V.individualParticipants.push(B?km({template:B,source:j}):j)}}let L=$?_.map(B=>km({source:B,template:$})):_;return{participantIdsWithConflicts:D,eventsPublishStatuses:E,derivedEventInfo:N,derivedDrawInfo:A,mappedMatchUps:M,participantMap:P,participants:L,...Z,matchUps:C}}function hm({participantId:t,drawDefinition:e,entryStatus:i,entryStage:r}){var n;if(!e)return{error:Ce};let a=(n=e.entries)==null?void 0:n.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!r||r===o.entryStage));return t&&a}function Uv(t){var e,i,r,n,a,o,s,l,c;let{provisionalPositioning:u,drawDefinition:d,stageSequence:p,structureId:m,stage:h}=t;if(!d)return{error:Ce};let{entryProfile:f}=fw({drawDefinition:d}),g=h&&p&&((r=(i=(e=f==null?void 0:f[h])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:r.qualifiersCount)||h&&((n=f==null?void 0:f[h])==null?void 0:n.qualifiersCount)||0,v={};if(!m)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:I}=et({drawDefinition:d,structureId:m}),y=(a=d.links)==null?void 0:a.filter(w=>{var U;return((U=w==null?void 0:w.target)==null?void 0:U.structureId)===(I==null?void 0:I.structureId)}),b=0;if(y!=null&&y.length)for(let w of y){let U=(o=et({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((U==null?void 0:U.stage)===qe){let T=w.source.roundNumber,P=w.target.roundNumber,R=0;if(U.structureType===Cn){let D=((s=U.structures)==null?void 0:s.length)??0,E=((l=w.source.finishingPositions)==null?void 0:l.length)??0;R=D*E}else R=((c=$t({matchUpFilters:{roundNumbers:[T]},structure:U,afterRecoveryTimes:!1,provisionalPositioning:u,inContext:!1}).matchUps)==null?void 0:c.length)||0;v[P]||(v[P]=0),v[P]+=R,b+=R}}let S=Object.keys(v);if(S.length<=1){let w=S[0]||1;v[w]=Math.max(v[w]||0,g)}return b=Math.max(b,g),{qualifiersCount:b,roundQualifiersCounts:v}}function A0({stage:t,drawDefinition:e}){var i;let{entryProfile:r}=fw({drawDefinition:e});return((i=r==null?void 0:r[t])==null?void 0:i.drawSize)||0}function jSe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n}=t,a=A0({stage:n,drawDefinition:i}),{qualifiersCount:o}=Uv({provisionalPositioning:e,drawDefinition:i,stageSequence:r,stage:n});return a&&a-o}function X8({stage:t,drawDefinition:e}){return!!(t===Mr||cL({stage:t,drawDefinition:e})&&A0({stage:t,drawDefinition:e}))}function Z8({entryStatus:t=Ma,drawDefinition:e,stageSequence:i,stage:r}){if(t===Ro)return IUe({stage:r,drawDefinition:e})?{positionsAvailable:1/0,...Z}:{error:NK};let n=jSe({drawDefinition:e,stageSequence:i,stage:r}),a=yUe({drawDefinition:e,stage:r}),o=gM({entryStatus:ng,drawDefinition:e,stage:r}),s=gM({entryStatus:Ma,drawDefinition:e,stage:r}),l=o+s,c=l>=n,u=n-l;return r!==Mr&&c?{error:oM}:t===ng?o<a?{...Z}:{error:oM}:{positionsAvailable:u,...Z}}function Q8(t){let{entryStatus:e=Ma,entryStageSequence:i,entryStage:r=Oe,ignoreStageSpace:n,drawDefinition:a,entryPosition:o,participant:s,roundTarget:l,extensions:c,extension:u,drawType:d}=t,p="addDrawEntry";if(!a)return{error:Ce};if(!r)return{error:Yx};if(d!==Lo&&!X8({stage:r,drawDefinition:a}))return ee({result:{error:bp},stack:p});let m=Z8({stageSequence:i,stage:r,drawDefinition:a,entryStatus:e});if(!n&&!m.success&&(!d||d!==Lo))return{error:m.error};if(u&&!Js({extension:u}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:u},stack:p});let h=t.participantId||(s==null?void 0:s.participantId);if(!h)return ee({result:{error:vr},stack:p});let f=e===Mu&&hm({participantId:h,drawDefinition:a,entryStatus:e}),g=r===Mr&&hm({participantId:h,drawDefinition:a,entryStage:r}),v=e!==Mu&&r!==Mr&&hm({drawDefinition:a,participantId:h});if(v||f||g)return ee({context:{invalidEntry:v,invalidLuckyLoser:f,invalidVoluntaryConsolation:g},result:{error:IP},stack:p});let I=He({entryStageSequence:i,participantId:h,entryPosition:o,entryStatus:e,entryStage:r,extensions:c});return u&&Mt({element:I,extension:u}),l&&Mt({extension:{name:"roundEntry",value:l},element:I}),a.entries||(a.entries=[]),a.entries.push(I),pi({drawDefinition:a}),{...Z}}function GSe(t){let e="addDrawEntries",{entryStatus:i=Ma,stage:r=Oe,autoEntryPositions:n=!0,ignoreStageSpace:a,drawDefinition:o,participantIds:s,stageSequence:l,roundTarget:c,extension:u}=t;if(!r)return{error:Yx};if(!o)return{error:Ce};if(!Array.isArray(s))return{error:Po};if(!X8({stage:r,drawDefinition:o}))return{error:bp};if(u&&!Js({extension:u}))return ee({result:{error:oe},info:"Invalid extension",context:{extension:u},stack:e});let d=Z8({drawDefinition:o,stageSequence:l,entryStatus:i,stage:r});if(!a&&!d.success)return{error:d.error};let p=d.positionsAvailable??0;if(!a&&r!==Mr&&p<s.length)return{error:rF};let m=s.reduce((h,f)=>{let g=i===Mu&&hm({participantId:f,drawDefinition:o,entryStatus:i}),v=r===Mr&&hm({entryStage:r,drawDefinition:o,participantId:f});return i!==Mu&&r!==Mr&&hm({drawDefinition:o,participantId:f})||g||v?h.concat(f):h},[]);return s.filter(h=>h&&!m.includes(h)).forEach(h=>{let f={entryStageSequence:l,entryStage:r,participantId:h,entryStatus:i};u&&Mt({element:f,extension:u}),c&&Mt({extension:{name:sl,value:c},element:f}),o.entries||(o.entries=[]),o.entries.push(f)}),n&&(o.entries=ds({entries:o.entries})),pi({drawDefinition:o}),m!=null&&m.length?{info:"some participantIds could not be added",participantIdsNotAdded:m,...Z}:{...Z}}function RL({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:r,participantIds:n,entryStatus:a,roundTarget:o,entryStage:s,extension:l,drawId:c,event:u}){if(!(n!=null&&n.length))return{error:id};if(!u)return{error:ha};if(!c)return{error:Ps};let d=(u.entries||[]).map(bt);if(n.filter(h=>!d.includes(h)).length)return{error:uK};if(r){let h=GSe({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:r,participantIds:n,entryStatus:a,roundTarget:o,extension:l});if(h.error)return h}let{flightProfile:p}=Yi({event:u}),m=p==null?void 0:p.flights.find(h=>h.drawId===c);return m!=null&&m.drawEntries&&(n.forEach(h=>{let f=a===Mu&&HE({participantId:h,entryStatus:a,flight:m}),g=s===Mr&&HE({participantId:h,entryStage:s,flight:m});!(a!==Mu&&s!==Mr&&HE({flight:m,participantId:h}))&&!f&&!g&&m.drawEntries.push({participantId:h,entryStatus:a,entryStage:s})}),t&&(m.drawEntries=ds({entries:m.drawEntries}))),{...Z}}function HE({participantId:t,entryStatus:e,entryStage:i,flight:r}){var n;let a=(n=r.drawEntries)==null?void 0:n.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function Ow({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:r,event:n}){var a,o,s,l;let c="removeEventEntries";if(!(n!=null&&n.eventId))return{error:Wt};if(!Array.isArray(e)||e.some(f=>!On(f)))return ee({result:{error:Ks},stack:c});let u=(n.drawDefinitions??[]).flatMap(f=>Np({drawDefinition:f}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=n.entries)==null?void 0:a.filter(f=>f.entryStatus&&i.includes(f.entryStatus)))||[]).map(bt).filter(f=>!u.includes(f)),p=(r&&((o=n.entries)==null?void 0:o.filter(f=>f.entryStage&&f.entryStage===r))||[]).map(bt).filter(f=>!u.includes(f));if(e.length?e=e.filter(f=>(!(i!=null&&i.length)||d.includes(f))&&(!r||p.includes(f))):d.length&&p.length?e=Hi(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&u.some(f=>e.includes(f)))return ee({result:{error:nv},stack:c});if(!(e!=null&&e.length))return{...Z,participantIdsRemoved:[]};let m=[];n.entries=(n.entries??[]).filter(f=>{let g=!e.includes(f==null?void 0:f.participantId);return g||m.push(f.participantId),g}),t&&(n.entries=ds({entries:n.entries}));let{flightProfile:h}=Yi({event:n});return(s=h==null?void 0:h.flights)==null||s.forEach(f=>{f.drawEntries=(f.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=n.drawDefinitions)==null||l.forEach(f=>{f.entries=(f.entries??[]).filter(g=>!e.includes(g.participantId))}),{...Z,participantIdsRemoved:m}}var eJ={[Cr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},Sv=eJ;function Rl(t){var e,i;let{entryStatus:r=Ma,autoEntryPositions:n=!0,enforceGender:a=!0,participantIds:o=[],entryStageSequence:s,policyDefinitions:l,entryStage:c=Oe,tournamentRecord:u,ignoreStageSpace:d,drawDefinition:p,roundTarget:m,extensions:h,extension:f,drawId:g,event:v}=t,I="addEventEntries";if(!v)return{error:Wt};if(!(o!=null&&o.length))return ee({result:{error:id},stack:I});if(!(v!=null&&v.eventId))return{error:ha};let y=Gt({tournamentRecord:u,event:v}).appliedPolicies??{},b=(l==null?void 0:l[Cr])??(y==null?void 0:y[Cr])??Sv[Cr],S=(a??((e=b==null?void 0:b.participants)==null?void 0:e.enforceGender))!==!1,w=[],U=[];if(h&&(!Array.isArray(h)||!h.every(M=>Js({extension:M})))||f&&!Js({extension:f}))return ee({context:He({extension:f,extensions:h}),result:{error:oe},info:"Invalid extension(s)",stack:I});let T=!!u,P=[],R,D=((i=u==null?void 0:u.participants)==null?void 0:i.filter(M=>{var C,O,k;if(!o.includes(M.participantId))return!1;let x=Bi(Ni)(v.eventType)&&M.participantType===wt&&!Id(r),F=v.eventType===ui&&M.participantType===st;return x&&(!v.gender||!S||[oa,Qs].includes(v.gender)||v.gender===((C=M.person)==null?void 0:C.sex))||F&&!Id(r)||v.eventType===ui&&M.participantType===wt&&Id(r)?!0:x&&v.gender&&S&&![oa,Qs].includes(v.gender)&&v.gender!==((O=M.person)==null?void 0:O.sex)?(P.push({participantId:M.participantId,sex:(k=M.person)==null?void 0:k.sex}),!1):v.eventType===ii&&(M.participantType===ii||Id(r)&&M.participantType===wt)}).map(M=>M.participantId))??[],E=o.filter(M=>!T||D.includes(M));v.entries||(v.entries=[]);let N=v.entries.map(M=>{var C;return M.participantId||((C=M.participant)==null?void 0:C.participantId)});if(E.forEach(M=>{var C;if(!N.includes(M)){let O=He({participantId:M,entryStatus:r,entryStage:c,extensions:h});f&&Mt({element:O,extension:f}),m&&Mt({extension:{name:sl,value:m},element:O}),s&&(O.entryStageSequence=s),w.push(O.participantId),(C=v.entries)==null||C.push(O)}}),g&&!Id(c)){let M=RL({participantIds:E,autoEntryPositions:n,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:r,roundTarget:m,entryStage:c,extension:f,drawId:g,event:v});M.error&&(R=M.error)}if(v.eventType&&[$c,oo].includes(v.eventType)){let M=(v.entries||[]).map(x=>x.participantId),C=(v.entries||[]).filter(x=>Id(x.entryStatus)).map(x=>x.participantId),O=((u==null?void 0:u.participants)??[]).filter(x=>M.includes(x.participantId)&&x.participantType&&[st,ii].includes(x.participantType)).map(x=>x.individualParticipantIds).flat(1/0),k=C.filter(x=>O.includes(x));k.length&&(U.push(...k),Ow({participantIds:k,autoEntryPositions:!1,event:v}))}if(E.length!==o.length)return ee({context:{mismatchedGender:P,gender:v.gender},result:{error:Po},stack:I});n&&(v.entries=ds({entries:v.entries||[]}));let A=w.length-U.length;return ee({result:{...Z,addedEntriesCount:A},stack:I,info:R})}var tJ="ADMINISTRATION",HSe="CAPTAIN",zSe="COACH",en="COMPETITOR",iJ="MEDIA",rJ="MEDICAL",EL="OFFICIAL",nJ="OTHER",aJ="SECURITY",CL={ADMINISTRATION:tJ,CAPTAIN:HSe,COACH:zSe,COMPETITOR:en,MEDIA:iJ,MEDICAL:rJ,OFFICIAL:EL,OTHER:nJ,SECURITY:aJ};function ML({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:r,suppressErrors:n}){let a="removeIndividualParticipantIds";if(!r)return ee({result:{error:he},stack:a});if(!i||!e)return ee({result:{error:Ve},stack:a});let o=(r.participants??[]).find(u=>u.participantId===i);if(!o)return ee({result:{error:Ji},stack:a});if(![ii,_a].includes(o.participantType))return ee({result:{participantType:o.participantType,error:bs},stack:a});let s=oJ({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:r,suppressErrors:n}),{removed:l,error:c}=s;if(c)return ee({result:s,stack:a});if(t)for(let u of r.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(m=>!d.includes(m));Rl({participantIds:p,entryStatus:Ko,tournamentRecord:r,event:u})}}return l&&Tt({topic:Kr,payload:{tournamentId:r.tournamentId,participants:[o]}}),{...Z,...s}}function oJ({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:r,mappedMatchUps:n,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let c=[],u=[];a||({participants:a,mappedMatchUps:n}=Wi({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:h})=>h===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:h})=>h),p=(e.individualParticipantIds??[]).filter(h=>{var f;let g=t==null?void 0:t.includes(h),v=g&&((f=a==null?void 0:a.find(y=>y.participantId===h))==null?void 0:f.matchUps.filter(({eventId:y})=>d.includes(y)).map(({matchUpId:y})=>n==null?void 0:n[y]).filter(({winningSide:y,score:b})=>y||_r({score:b}))),I=g&&!(v!=null&&v.length);if(g&&!I&&u.push(h),I){l.push(h);for(let y of i.events??[])for(let b of y.drawDefinitions??[]){let{extension:S}=ft({element:b,name:Pu}),w=S==null?void 0:S.value[e.participantId];S&&w&&(S.value[e.participantId]=w.filter(T=>T.participantId!==h),Mt({element:b,extension:S}),pw({drawDefinition:b}));let U=Nn({drawDefinition:b,inContext:!1}).matchUps??[];for(let T of U){let P=T.sides??[];for(let R of P){let D=R.lineUp??[];D.find(E=>E.participantId===h)&&(R.lineUp=D.filter(E=>E.participantId!==h),Et({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:T}))}}}}else c.push(h);return!I});e.individualParticipantIds=p;let m={groupingParticipantId:e.participantId,cannotRemove:u,notRemoved:c,removed:l};return u.length&&!r&&{...m,cannotRemove:u,error:vP}||m}function XP({participantRole:t=en,individualParticipantIds:e=[],groupingTypes:i=[Za,_a],tournamentRecord:r}){if(!r)return{error:he};let n=r.participants??[],{participants:a,mappedMatchUps:o}=Wi({withMatchUps:!0,tournamentRecord:r,withEvents:!0}),s=0;return n.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=oJ({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:r,mappedMatchUps:o,participants:a});c&&s++}),s?Z:{error:PK}}function kh(t){var e,i,r;if(!(t!=null&&t.tournamentRecord))return{error:he};if(!((e=t==null?void 0:t.participantIds)!=null&&e.length))return{error:id};let{addIndividualParticipantsToEvents:n,tournamentRecord:a,participantIds:o}=t,s=((i=a.participants)==null?void 0:i.length)||0;if(!s)return{...Z};let l=(r=a.events||[])==null?void 0:r.filter(({eventType:g})=>g===yr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:I})=>I)}).flat(1/0),c=Wi({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],u=()=>{let g=(Lr({matchUpFilters:{drawIds:l,matchUpTypes:[ui]},tournamentRecord:a}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:I})=>I)).flat().filter(Boolean);return Hi(g,o)},d=(l==null?void 0:l.length)&&u(),p=c.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(I=>(!(l!=null&&l.length)||!(l!=null&&l.includes(I.drawId)))&&I.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:nv};let m={},h={};for(let g of a.events||[]){let v=Ow({participantIds:o,event:g});if(v.error)return v;m[g.eventId]=v.participantIdsRemoved}a.participants=a.participants.filter(g=>{let v=o.includes(g.participantId)||g.participantType===st&&g.individualParticipantIds.some(I=>o.includes(I));if(!v&&g.participantType===yr&&g.individualParticipantIds.some(I=>o.includes(I))&&(g.individualParticipantIds=g.individualParticipantIds.filter(I=>!o.includes(I))),v&&n&&[st,ii].includes(g.participantType))for(let I of g.individualParticipantIds||[])o.includes(I)||(h[g.participantId]||(h[g.participantId]=[]),h[g.participantId].push(I));return!v});let f=s-a.participants.length;if(XP({individualParticipantIds:o,tournamentRecord:a}),n)for(let g of a.events||[]){let v=m[g.eventId].map(I=>h[I]||[]).flat();Rl({participantIds:v,entryStatus:Ko,tournamentRecord:a,event:g})}return f&&Tt({payload:{participantIds:o,tournamentId:a.tournamentId},topic:JF}),f?{...Z,participantsRemovedCount:f}:{error:vP}}function sJ({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:r,event:n,stage:a}){var o;let s=n.entries??[];if(r){let{flightProfile:c}=Yi({event:n}),u=(o=c==null?void 0:c.flights)==null?void 0:o.find(d=>d.drawId===r);u?s=u.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&Jo.includes(c.entryStatus)));return{entries:s,stageEntries:l}}function lJ({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:he};if(!r)return ee({result:{error:vr},stack:l});if(!o)return{error:Wt};if(!o.eventType||![$c,oo].includes(o.eventType))return ee({result:{error:Ac},stack:l});let c=e.participants??[],u=c.find(I=>I.participantId===r);if(!u)return ee({result:{error:Ji},stack:l});if(!u.participantType||![st,Za].includes(u.participantType)||u.participantType===Za&&o.eventType!==oo||u.participantType===st&&o.eventType!==$c)return{error:bs};let d=(o.entries??[]).find(I=>I.participantId===r);if(!d)return{error:MK};let{stageEntries:p}=sJ({selected:!1,drawDefinition:i,drawId:n,event:o,stage:a}),m=p.map(bt),h=c.filter(({participantId:I})=>m.includes(I)).map(({individualParticipantIds:I})=>I).flat().filter(Boolean),f=(s=u.individualParticipantIds)==null?void 0:s.filter(I=>$s(I,h).length===1),g=Ow({participantIds:[r],event:o});if(g.error||f!=null&&f.length&&(g=Rl({participantIds:f,entryStatus:Ko,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:n,event:o}),g.error))return g;let v;return t&&kh({participantIds:[r],tournamentRecord:e}).success&&(v=!0),{...Z,participantRemoved:v}}function NL({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a}){return lJ({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:r,drawId:n,event:a})}function uJ(t){if(!t.tournamentRecord)return{error:he};let{participantIds:e,...i}=t,r=0,n=[];for(let a of e){let o=lJ({participantId:a,...i});o.success&&(r+=1),o.error&&n.push(o.error)}return r?{destroyedCount:r,...Z}:{error:n}}function py(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:r,destroyPair:n,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",c=Nw(t);if(c.error)return ee({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:m}=t;if([Ro,Nu].includes(a)&&u){let{tournamentRecord:f}=t,{participant:g}=Mp({tournamentRecord:f,participantId:u}),{participantType:v,individualParticipantIds:I}=g??{};if(n&&v===st){let y=NL({tournamentRecord:f,drawDefinition:r,participantId:u,event:p});if(y.error)return ee({result:y,stack:l});I&&N0({participantIds:I,tournamentRecord:f,drawDefinition:r,entryStatus:a,drawId:s,event:p})}else N0({participantIds:[u],tournamentRecord:f,drawDefinition:r,entryStatus:a,drawId:s,event:p})}if(i){let f=$a({tournamentRecord:e,drawDefinition:r,drawPosition:d,structureId:m,matchUpsMap:o,event:p});if(f.error)return ee({result:f,stack:l})}let{structure:h}=et({drawDefinition:r,structureId:m});return sL({structure:h,drawPositions:[d]}),VP({drawDefinition:r,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:m}}),c}function cJ(t){return Object.assign(t,{entryStatus:Nu}),py(t)}function TM(t){return On(t)?t.split(" ").map(e=>e.split("").map((i,r)=>r?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function zr(t){return On(t)?TM(t.replace(/_/g," ")):""}var wc=({finishingPosition:t=Ph,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:r=[],stageSequence:n=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:m,roundLimit:h,stageOrder:f,structures:g,stage:v})=>{let I={structureId:p??Yt(),structureAbbreviation:i,finishingPosition:t,seedAssignments:r,matchUpFormat:s,stageSequence:n,structureName:c};a&&(I.structureOrder=a),l&&(I.structureType=l),o&&(typeof o=="string"?I.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(I.seedingProfile=o.positioning)),u&&(I.matchUpType=u),m&&(I.roundOffset=m),f&&(I.stageOrder=f),h&&(I.roundLimit=h),v&&(I.stage=v),e&&(I.qualifyingRoundNumber=e);let y=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?I.structures=g:(I.matchUps=d,I.positionAssignments=ht(y).sort((b,S)=>b-S).map(b=>({drawPosition:b}))),I},Ya=wc;function AL({structureName:t=zr(Mr),structureAbbreviation:e,drawDefinition:i,matchUpType:r,structureId:n}){if(!i)return{error:Ce};let a=Ya({stage:Mr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:n,matchUpType:r});return i.structures||(i.structures=[]),i.structures.push(a),pi({drawDefinition:i,structureIds:[a.structureId]}),{...Z}}function OL({drawPositions:t}){if(!(t!=null&&t.length))return{error:Kb};let e=n=>t.filter(a=>a!==n).map(a=>[n,a]),i=[].concat(...(t??[]).map(e)),r=ht(i.map(ZP)).map(n=>n.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:r}}function ZP(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(sr).join("|")}function dJ({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,m)=>m),r=i(2*Math.round(t/2)+1).slice(1),n=i(r.length-1).map(()=>[]),a=r.slice(0,r.length/2),o=r.slice(r.length/2);r.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{n[p].push([a[v],o[v]])});let m=a.shift(),h=a.pop(),f=o.shift();a=[m,f,...a].filter(Boolean),o=[...o,h].filter(Boolean)});let s=a.shift(),l=a.pop(),c=o.shift();a=[s,c,...a].filter(Boolean),o=[...o,l].filter(Boolean);let u=d=>d[0].reduce((p,m)=>p+m);return[...n].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(m=>m<=t)).map(p=>{let m=p.map(h=>h+e);return ZP(m)}))}function WSe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,r,n)=>r.includes(e)?n+1:i,void 0):{error:Ve}}var qSe={getRoundRobinGroupMatchUps:OL,determineRoundNumber:WSe,drawPositionsHash:ZP,groupRounds:dJ};function kw(t){var e;let{groupNameBase:i="Group",playoffAttributes:r,stageSequence:n=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=Oe,matchUpType:c,roundTarget:u,structureId:d,groupNames:p,drawSize:m,idPrefix:h,isMock:f,uuids:g}=t,v=t.structureName??((e=r==null?void 0:r[0])==null?void 0:e.name)??zr(Oe),{groupCount:I,groupSize:y}=YSe({structureOptions:a,appliedPolicies:o,drawSize:m}),b=fv,S,w=Ee(1,I+1).map(T=>{let P=KSe({groupSize:y,structureOrder:T,matchUpType:c,drawSize:m,idPrefix:h,isMock:f});S=Array.isArray(P)?Math.max(...P.map(({roundNumber:D})=>D??0)):0;let R=(p==null?void 0:p[T-1])??`${i} ${T}`;return wc({structureId:g==null?void 0:g.pop(),structureType:xP,finishingPosition:b,structureOrder:T,structureName:R,matchUps:P})}),U=wc({structureId:d??(g==null?void 0:g.pop()),structureType:Cn,finishingPosition:b,seedingProfile:s,structureName:v,stageSequence:n,structures:w,stage:l});return u&&Mt({extension:{name:sl,value:u},element:U}),{structures:[U],maxRoundNumber:S,groupCount:I,links:[],groupSize:y,...Z}}function YSe({appliedPolicies:t,structureOptions:e,drawSize:i}){let r=e==null?void 0:e.groupSize,n=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=xw({groupSizeLimit:n,drawSize:i}),o=a&&Math.max(...a);r&&a!=null&&a.includes(r)||(r&&r>4||!(a!=null&&a.includes(4))?r=o:r=4);let s=Math.ceil(i/r);return{groupSize:r,groupCount:s}}function xw({drawSize:t,groupSizeLimit:e=10}){let i=Ee(3,e+1).filter(r=>{let n=Math.ceil(t/r),a=n*r-t,o=Math.ceil(t/n),s=Math.ceil(a/n);return(!a||a<r)&&o===r&&o>=3&&s<2});return{...Z,validGroupSizes:i}}function KSe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:r,idPrefix:n,isMock:a,uuids:o}){let s=(t-1)*i,l=Ee(1+s,i+1+s),c=OL({drawPositions:l}).uniqueMatchUpGroupings??[],u=dJ({groupSize:i,drawPositionOffset:s});return c.map(p).sort((m,h)=>(m.roundNumber??1/0)-(h.roundNumber??1/0));function d(m){return u.reduce((h,f,g)=>f.includes(m)?g+1:h,void 0)}function p(m){let h=ZP(m),f=d(h),g=[1,r],v=JSe({structureOrder:t,drawPositions:m,roundNumber:f,idPrefix:n,uuids:o}),I={matchUpStatus:f?zi:Ft,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:m,roundNumber:f,matchUpId:v};return a&&(I.isMock=!0),I}}function JSe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:r,uuids:n}){return r?`${r}-${t}-${i}-DP-${e.join("-")}`:(n==null?void 0:n.pop())||Yt()}function kL(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:r}=t;if(!nt(i))return{seedBlocks:void 0,...ee({result:{error:oe},context:{participantsCount:i},stack:"getSeedBlocks"})};let n=sv(i);if(e){let m=Math.min(e,n),h=[],f=1;for(Ee(0,m).forEach(()=>{h.push([f]),f++});f<n;){let g=Ee(f,f+m);f+=m,h.push(g)}return{...Z,seedBlocks:h}}let a=Ee(1,n+1),o=[],s=n/2;for(;s>1;){let m=xr(a,s),h=m.length;m.forEach((f,g)=>{let v,I=g<h/2,y=g%2===0,b=f[0],S=f[f.length-1];r&&h>4?h===8?v=I?S:b:v=y?b:S:v=I?b:S,Dn(f,o)||o.push(v)}),s=s/2}let l=a.filter(m=>!o.includes(m));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let c=Ee(0,20).map(m=>Math.pow(2,m));c.unshift(1);let u=c.indexOf(n),d=0,p=[];return Ee(0,u).forEach(m=>{p.push(o.slice(d,d+c[m])),d+=c[m]}),{...Z,seedBlocks:p}}function xL({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!nt(e))return{seedGroups:void 0,...ee({result:{error:oe},context:{drawSize:e},stack:i})};if(t){if(!nt(t))return{seedGroups:void 0,...ee({context:{roundRobinGroupsCount:t},result:{error:oe},stack:i})};let r=1,n=Math.floor(e/t);return{seedGroups:Ee(0,n).map(()=>{let a=Ee(r,r+t);return r+=t,a})}}else{let{seedBlocks:r}=kL({participantsCount:e,roundRobinGroupsCount:t}),n=0;return{seedGroups:(r||[]).map(a=>(a||[]).map(()=>(n+=1,n)))}}}function FL({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=xw({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return ee({context:{roundRobinGroupsCount:t},result:{error:oe}})}let{seedGroups:r}=xL({drawSize:e,roundRobinGroupsCount:t}),n=(r==null?void 0:r.map(a=>Math.min(...a)))||[];return{...Z,seedingThresholds:n}}function og(t){if(!t)return 1/0;if(nt(t))return Xe(t);let e=t.split("-")[0];return nt(e)?Xe(e):1/0}function XSe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(sr),e.reverse(),e}function ZSe({blockPattern:t,index:e}){let i=0;for(let r of t){if(i===e)return r;let n=0;for(;n<r.length;){if(i===e)return r;i+=1,n++}}}function QSe({positioning:t,size:e}){let i=XSe({size:e}),r=[],n=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,m)=>(t&&[kP,Kd].includes(t)&&m%2?o(p):a(p))||a(p),l=(p,m)=>{if(p.every(h=>!n.includes(h))){let h=s(p,m);return n.push(h),h}},c=p=>{let m=p.filter(h=>!n.includes(h));if(m.length)return n.push(...m),m},u=(p,m)=>{let h=s(p,m);if(!n.includes(h))return n.push(h),h},d=Ee(1,e+1);for(let p of i)if(p===1){let m=xr(d,2),h=m.map(l).filter(Boolean);h.length&&r.push(h);let f=m.flatMap(c).filter(Boolean);f.length&&r.push(f)}else{let m=xr(d,p).map(u).filter(Boolean);m.length&&r.push(m)}return{divisions:i,divisionGroupings:r}}function xh({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:r,drawDefinition:n,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:td};let{matchUps:c,roundMatchUps:u}=$t({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=ao({provisionalPositioning:t,returnAllProxies:e,drawDefinition:n,structure:o}),{positionAssignments:p}=Tr({structure:o}),m=p==null?void 0:p.length,h=(d==null?void 0:d.length)??0,f=[],g=Object.keys(u).map(O=>parseInt(O)).sort((O,k)=>O-k).map(O=>{let k=u[O].map(F=>F.drawPositions).flat(1/0).filter(Boolean),x=k.filter(F=>!f.includes(F));return f=f.concat(...k),x}).filter(O=>O.length).reverse(),v=g.pop()??[],I=v&&Math.min(...v)-1||0;r=r??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let y=(v==null?void 0:v.length)||0,b=g.filter(O=>O.filter(k=>k<=h).length),{stage:S,structureType:w,roundLimit:U}=o,T=w===Cn,P=!T&&(g==null?void 0:g.length),R=!T&&S===qe&&U,D=b.flat(1/0),E=P?D==null?void 0:D.length:0,N=a?m:h,A=IL({drawDefinition:n,structure:o,matchUps:c}),M=A?0:!P&&N||N&&D.length<N&&N-D.length||0;if(R){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:x})=>x===o.roundLimit).length:0,k=v.length/O;if(!P){let x=Fw(r),F=xr(v,k),$=1,_=Ee(0,F[0].length).map(()=>{let L=Ee($,$+F.length);return $+=F.length,L});({validSeedBlocks:l}=pJ({drawPositionBlocks:F,nonRandom:r==null?void 0:r.nonRandom,positioning:x,seedGroups:_}))}}else T?{validSeedBlocks:l}=e0e({nonRandom:r==null?void 0:r.nonRandom,seedingProfile:r,structure:o}):P?l=b.map(O=>({seedNumbers:O,drawPositions:O})):A&&xr(v,2).map((O,k)=>({drawPositions:[O[0]],seedNumbers:[k+1]})).forEach(O=>l.push(O));if(!T&&!A&&!R){let{blocks:O}=t0e({drawPositionOffset:I,seedNumberOffset:E,seedCountGoal:M,seedingProfile:r,baseDrawSize:y});O.forEach(k=>l.push(k))}let C=l.flatMap(O=>O.drawPositions).reduce((O,k)=>(v==null?void 0:v.includes(k))&&O,!0);return!A&&!P&&!T&&!C?{error:aK,validSeedBlocks:[],isContainer:T,isFeedIn:P}:{isLuckyStructure:A,validSeedBlocks:l,isContainer:T,isFeedIn:P}}function e0e({seedingProfile:t,structure:e,nonRandom:i}){var r;let n=e.structures||[],a=n.length,o=(r=ei({structure:e}))==null?void 0:r.positionAssignments,s=Fw(t),l=(o==null?void 0:o.length)??0,{seedGroups:c}=xL({roundRobinGroupsCount:a,drawSize:l}),u=n.map(d=>{var p;return(p=ei({structure:d}).positionAssignments)==null?void 0:p.map(m=>m.drawPosition)});return pJ({drawPositionBlocks:u,positioning:s,seedGroups:c,nonRandom:i})}function pJ({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:r}){let n=[],{divisionGroupings:a}=QSe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let c=ZSe({blockPattern:a,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,m=t[p].slice().filter((f,g)=>c.includes(g+1)&&f);e!==Kd?m=r?m:hn(m):l%2&&m.reverse();let h=m.find(f=>!o.includes(f));h&&(o.push(h),n.push({drawPositions:[h],seedNumbers:[u]}))})}),{validSeedBlocks:n}}function t0e(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:r=0,seedingProfile:n,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:c}=kL({cluster:Fw(n)===kP,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>a)break;let p=d.map(h=>h+e),m=u(s+1,d.length).map(h=>+h+r);s+=d.length,l.push({drawPositions:p,seedNumbers:m})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(m,h)=>h+d)}}function O0({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:r,structureId:n,seedNumber:a}){var o,s,l,c,u,d;let{structure:p}=et({drawDefinition:e,structureId:n});t||(t=Gt({drawDefinition:e}).appliedPolicies);let m=i==null?void 0:i.validSeedBlocks;return!m&&p&&(m=(o=xh({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.strict?(((d=m.find(h=>h.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(r):[].concat(...m.map(h=>h.drawPositions)).includes(r)}function mJ(t){var e,i,r;let{provisionalPositioning:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:c}=t,{structure:u}=et({drawDefinition:a,structureId:l}),{seedAssignments:d}=ao({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,drawDefinition:a,structure:u}),{positionAssignments:p}=Tr({structure:u}),m=(e=p==null?void 0:p.filter(M=>M.participantId??M.bye??M.qualifier))==null?void 0:e.map(M=>M.drawPosition).filter(Boolean),{appliedPolicies:h}=Gt({drawDefinition:a}),f=((s==null?void 0:s.validSeedBlocks)||u&&((i=xh({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,appliedPolicies:h,drawDefinition:a,seedingProfile:o,structure:u}))==null?void 0:i.validSeedBlocks)||[]).filter(M=>M.drawPositions.filter(C=>!(m!=null&&m.includes(C))).length)[0],g=d==null?void 0:d.map(M=>M.participantId).filter(Boolean),v=p==null?void 0:p.map(M=>M.participantId).filter(Boolean),I=g==null?void 0:g.filter(M=>v==null?void 0:v.includes(M)),y=g==null?void 0:g.filter(M=>!(v!=null&&v.includes(M))),b=d==null?void 0:d.filter(M=>y==null?void 0:y.includes(M.participantId)),S=d==null?void 0:d.filter(M=>!M.participantId),w=(b!=null&&b.length&&b.length>0?b.length:(S==null?void 0:S.length)??0)&&(f==null?void 0:f.drawPositions.filter(M=>!(m!=null&&m.includes(M))))||[],U=c?hn(w):w,T=[],P=U.map(()=>{var M;let C=(M=A(b,T))==null?void 0:M.participantId;return C&&T.push(C),C}).filter(Boolean),R=d==null?void 0:d.filter(M=>I==null?void 0:I.includes(M.participantId)).map(M=>M.seedNumber),D=((f==null?void 0:f.seedNumbers)||[]).filter(M=>!(R!=null&&R.includes(M))),E=d==null?void 0:d.filter(M=>D.includes(M.seedNumber)).map(M=>M.participantId),N=(r=h==null?void 0:h.seeding)==null?void 0:r.duplicateSeedNumbers;return{nextSeedBlock:f,unplacedSeedParticipantIds:N===void 0||N?P:E,unplacedSeedNumbers:D,unfilledPositions:U,unplacedSeedAssignments:b};function A(M,C){let O=M.filter(F=>!C.includes(F.participantId)),k=Math.min(...O.map(F=>og(F.seedValue))),x=O.filter(F=>og(F.seedValue)===k);return hn(x).pop()}}function Fw(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function Tv({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:r,participantId:n,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:c,event:u}){var d,p,m;let h="assignSeed",{structure:f}=et({drawDefinition:i,structureId:o}),{positionAssignments:g}=Tr({structure:f}),v=ao({provisionalPositioning:t,drawDefinition:i,structure:f}).seedAssignments,I=v.map(T=>T.seedNumber),y=hm({drawDefinition:i,participantId:n});if(n&&!y)return ee({result:{error:Ks},context:{participantId:n},stack:h});let b=u?(p=(d=Yi({event:u}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,S=b&&b>1,w=(m=g==null?void 0:g.find(T=>T.participantId===n))==null?void 0:m.drawPosition;if(w&&!O0({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return ee({result:{error:Vx},context:{assignedDrawPosition:w},info:"invalid seed position",stack:h});I.includes(s)||v.push({seedNumber:s,seedValue:l});let U;return v.forEach(T=>{T.participantId===n&&T.seedNumber!==s&&(T.participantId=void 0),T.seedNumber===s&&(T.participantId=n,!(r!=null&&r.groupSeedingThreshold)&&!S&&(T.seedValue=l??s),U=!0)}),U?(l8({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:f,eventId:c}),{...Z}):ee({result:{error:nK},stack:h})}function LL({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:r,drawDefinition:n,matchUp:a,event:o}){var s,l,c,u;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((c=a.sides)==null?void 0:c.find(g=>g.sideNumber===d)),{extension:m}=ft({element:n,name:Pu}),h=(m==null?void 0:m.value)||{},f=Fe(h[i],!1,!0);if(p)(u=a==null?void 0:a.sides)==null||u.forEach(g=>{g.sideNumber===d&&(g.lineUp=f)});else{a.sides=[1,2].map(v=>{var I;return{...((I=a.sides)==null?void 0:I.find(y=>y.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=f)}Et({tournamentId:r==null?void 0:r.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUp:a})}function hJ(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:r,matchUpsMap:n,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Zd({structureId:r.structureId,matchUpsMap:n});!e&&a&&(e=s.find(({drawPositions:h,roundNumber:f})=>f===o&&(h==null?void 0:h.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=o&&s.find(({roundNumber:h,roundPosition:f})=>h===o&&f===u),p=d==null?void 0:d.matchUpStatus,m=[ir,hr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:m}}function i0e({drawPosition:t,drawPositions:e}){let i=!1,r=!!(e!=null&&e.includes(t));return{updatedDrawPositions:r?e||[]:[...e,void 0,void 0].slice(0,2).map(n=>!n&&!r?(r=!0,i=!0,t):n).sort(sr).filter(Boolean),positionAdded:i,positionAssigned:r}}function fJ({structureId:t,matchUpsMap:e,matchUp:i}){let r=i==null?void 0:i.roundPosition,n=r%2?1:-1,a=r+n;return{pairedPreviousMatchUp:Zd({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function gJ({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:r,matchUp:n}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=fJ({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:r});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(u=>u.matchUpId===s),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;n.matchUpStatusCodes=(n.matchUpStatusCodes??[]).map(u=>{let d=On(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function DS({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let r=t.filter(({winnerMatchUpId:n,loserMatchUpId:a})=>a===i||n===i).sort((n,a)=>n.roundPosition-a.roundPosition);return t.find(n=>n.matchUpId===i).feedRound?1:r.reduce((n,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:n},void 0)}function sg({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:r,drawDefinition:n,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:c}){var u,d,p,m;let h="assignMatchUpDrawPosition";s||(s=Zr({drawDefinition:n})),t||(t=cr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[]);let f=t.find(C=>C.matchUpId===l),g=f==null?void 0:f.structureId,v=(u=n==null?void 0:n.structures)==null?void 0:u.find(C=>C.structureId===g);if(!v)return{error:Ri};let I=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(C=>C.matchUpId===l),y=(I==null?void 0:I.drawPositions)??[],{positionAdded:b,positionAssigned:S,updatedDrawPositions:w}=i0e({drawPosition:o,drawPositions:y}),{positionAssignments:U}=ei({drawDefinition:n,structure:v}),T=(p=U==null?void 0:U.filter(C=>w.includes(C.drawPosition)))==null?void 0:p.find(({bye:C})=>C),P=(I==null?void 0:I.matchUpStatus)&&[jt,Ot].includes(I.matchUpStatus)&&w.filter(Boolean).length<2;if(a=T&&Ft||a||P&&I.matchUpStatus||(I==null?void 0:I.matchUpStatus)&&[ir,hr].includes(I.matchUpStatus)&&I.matchUpStatus||zi,I&&b){t=cr({inContext:!0,drawDefinition:n,matchUpsMap:s}).matchUps??[];let C=P&&DS({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;I!=null&&I.matchUpStatusCodes&&gJ({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:r,matchUpsMap:s,matchUp:I}),Object.assign(I,{drawPositions:w,winningSide:C,matchUpStatus:a}),Et({tournamentId:i==null?void 0:i.tournamentId,eventId:f==null?void 0:f.eventId,context:h,drawDefinition:n,matchUp:I})}let R=Rn({inContextDrawMatchUps:t,inContextMatchUp:f,drawDefinition:n,matchUpId:l}),{targetMatchUps:{winnerMatchUp:D,loserMatchUp:E,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:A}}=R,M=Zd({structureId:v.structureId,matchUpsMap:s});if(S&&T){if(D)if([Ft,ir,hr].includes(a)){let C=sg({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(C.error)return C}else{let{structureId:C}=D;C!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(D&&f&&!f.feedRound){let{pairedPreviousMatchUpIsDoubleExit:C}=hJ({targetMatchUp:I,drawPosition:o,matchUpsMap:s,structure:v});if(C){let O=sg({matchUpId:D.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((I==null?void 0:I.matchUpType)===di){let C=t==null?void 0:t.find(({matchUpId:x})=>x===I.matchUpId),O=((C==null?void 0:C.sides)??[]).reduce((x,F,$)=>F.drawPosition===o?$:x,void 0),k=(m=U==null?void 0:U.find(x=>x.drawPosition===o))==null?void 0:m.participantId;k&&O!==void 0&&LL({inContextTargetMatchUp:C,drawPositionSideIndex:O,teamParticipantId:k,tournamentRecord:i,drawDefinition:n,matchUp:I})}if((A==null?void 0:A.linkCondition)===Gl&&w.filter(Boolean).length===2&&!T&&M.filter(({drawPositions:C,roundNumber:O})=>O===1&&Dn(C,w)).every(({matchUpStatus:C})=>[Zi,dn].includes(C))&&E){let{structureId:C}=E,O=$a({drawPosition:N,tournamentRecord:i,drawDefinition:n,structureId:C,matchUpsMap:s,event:c});if(O.error)return O}return S?{...Z}:ee({result:{error:Hf},context:{drawPosition:o},stack:h})}function vJ({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:r,structure:n}){var a,o,s,l;let c=((s=(o=(a=gv({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[n.structureId])==null?void 0:s.map(({structureId:h})=>h))||[];c.push(n==null?void 0:n.structureId);let u=(i==null?void 0:i.map(({drawPosition:h})=>h))||[],d=(t==null?void 0:t.filter(h=>c.includes(h.structureId)&&Hi(h.drawPositions??[],u).length))??[],p=d.map(({matchUpId:h})=>h),m=((l=r==null?void 0:r.drawMatchUps)==null?void 0:l.filter(h=>p.includes(h.matchUpId)))??[];return{drawPositions:u,matchUps:m,targetMatchUps:d}}function _L({lineUp:t}){if(!Array.isArray(t))return;let e={};return ht(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:r,collectionPosition:n})=>[r,n].join("|"))).filter(Boolean)).forEach(i=>{let[r,n]=i.split("|"),a=parseInt(n),{assignedParticipantIds:o}=C0({collectionPosition:a,collectionId:r,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:r,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function ql(t){return`${t} must be an array`}function QP({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(ql("lineUp")),{valid:!1,errors:i,error:oe};let r=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(ql("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),n=ht(t.map(bt)).length===t.length;return n||i.push("Duplicated participantId(s)"),{valid:r&&n,errors:i,error:i.length?oe:void 0}}function Fh({drawDefinition:t,participantId:e,tieFormat:i,lineUp:r}){if(typeof t!="object")return{error:Ce};if(typeof e!="string")return{error:vr};let n=QP({lineUp:r,tieFormat:i});if(!n.valid)return n;let{extension:a}=ft({element:t,name:Pu}),o=(a==null?void 0:a.value)||{};return o[e]=_L({lineUp:r}),Mt({element:t,extension:{name:Pu,value:o}}),pw({drawDefinition:t}),{...Z}}function $L({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:r,matchUpsMap:n,assignments:a,structure:o,event:s}){if(!r)return{error:Ce};let{drawPositions:l,matchUps:c,targetMatchUps:u}=vJ({inContextDrawMatchUps:t,matchUpsMap:n,assignments:a,structure:o});for(let d of u)d.matchUpType===Zs&&(d.sides??[]).forEach((p,m)=>{var h;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let f=c.find(({matchUpId:g})=>g===d.matchUpId);if((h=f==null?void 0:f.sides)!=null&&h[m]){if(delete f.sides[m].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&Fh({drawDefinition:r,participantId:v,lineUp:[],tieFormat:g})}Et({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:r,matchUp:f})}}});return{...Z}}function el({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var m,h,f;let g="assignDrawPosition";if(!s&&!i)return ee({result:{error:vr},stack:g});u=u??Zr({drawDefinition:a}),e||({matchUps:e}=cr({inContext:!0,drawDefinition:a,matchUpsMap:u}));let v=et({drawDefinition:a,structureId:d});if(v.error)return ee({result:v,stack:g});let{structure:I}=v;if(!I)return{error:Ri};if(va({structure:I}))return ee({result:{error:kn},stack:g});let{seedAssignments:y}=ao({provisionalPositioning:t,drawDefinition:a,structure:I}),b=(m=y==null?void 0:y.find(D=>D.participantId===s))==null?void 0:m.seedNumber,{appliedPolicies:S}=Gt({tournamentRecord:n,drawDefinition:a,structure:I,event:p});if(b&&!O0({seedNumber:b,appliedPolicies:S,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return ee({result:{error:Vx},context:{drawPosition:c},stack:g});let w=Tr({structure:I}).positionAssignments||[],U=w==null?void 0:w.find(D=>D.drawPosition===c);if(!U)return ee({result:{error:ev},context:{drawPosition:c},stack:g});if(w!=null&&w.map(bt).includes(s))return ee({result:{error:nv},context:{drawPosition:c},stack:g});let{containsParticipant:T,containsBye:P}=R(U);if(P){let D=Nw({inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(D.error)return ee({result:D,stack:g})}if(T&&U.participantId!==s){let{activeDrawPositions:D}=Mw({drawDefinition:a,structureId:d});if(D.includes(c))return ee({result:{error:pP},stack:g});$L({assignments:[U],inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:I})}if(U.participantId=s,i&&(U.qualifier=!0),((I==null?void 0:I.stageSequence)||0)>1||I.stage&&[Yr,Fi].includes(I.stage)){let D=I.stage===qe?qe:Oe,E=(((f=(h=a.structures)==null?void 0:h.find(N=>(N==null?void 0:N.stage)===D&&(N==null?void 0:N.stageSequence)===1))==null?void 0:f.seedAssignments)??[]).find(N=>N.participantId===s);if(E!=null&&E.participantId){let{participantId:N,seedNumber:A,seedValue:M}=E;Tv({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:n,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:A,seedValue:M,structureId:d,event:p})}}if(I.structureType!==Cn)r0e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:n,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:I,event:p});else{Y8({positionAssignments:w,tournamentRecord:n,drawDefinition:a,matchUpsMap:u,structure:I});let{drawPositions:D,matchUps:E,targetMatchUps:N}=vJ({assignments:[U],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:I});if(D&&(E==null?void 0:E.length)===1&&E[0].matchUpType===di){let A=((N==null?void 0:N[0].sides)??[]).reduce((M,C,O)=>D!=null&&D.includes(C.drawPosition)?O:M,void 0);LL({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:E[0],drawPositionSideIndex:A,tournamentRecord:n,drawDefinition:a})}}return _c({tournamentId:n==null?void 0:n.tournamentId,drawDefinition:a,structure:I,event:p}),{positionAssignments:w,...Z};function R(D){let E=D.bye,N=D.qualifier,A=D.participantId;return{containsBye:E,containsQualifier:N,containsParticipant:A,filled:E||N||A}}}function r0e({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=$t({provisionalPositioning:t,matchUpFilters:c,drawDefinition:n,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Pn({matchUps:u}),{initialRoundNumber:p}=Bm({drawPosition:a,matchUps:u}),m=p&&(d==null?void 0:d[p].find(h=>{var f;return(f=h.drawPositions)==null?void 0:f.includes(a)}));if(m){let h=sg({matchUpId:m.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:r,drawDefinition:n,drawPosition:a,matchUpsMap:o});if(h.error)return ee({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:h})}return{...Z}}function BL(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:r,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:Ce};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=Zr({drawDefinition:a}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=cr({inContext:!0,drawDefinition:a,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));let{positionAssignments:m}=ei({drawDefinition:a,structureId:l}),h=m==null?void 0:m.find(y=>y.drawPosition===s);if(h!=null&&h.participantId){let y=h.participantId,b=el({inContextDrawMatchUps:d,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return b.success?I({removedParticipantId:y}):ee({result:b,stack:u})}let f=Nw({inContextDrawMatchUps:d,tournamentRecord:n,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(f.error)return ee({result:f,stack:u});let g=f.participantId,v=el({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:n,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(!v.success)return ee({result:v,stack:u});return I({removedParticipantId:g});function I({removedParticipantId:y}){let{structure:b}=et({drawDefinition:a,structureId:l});sL({drawPositions:[s],structure:b});let S={[e]:o,name:r,drawPosition:s,structureId:l};return VP({drawDefinition:a,positionAction:S}),ee({context:{removedParticipantId:y},result:{...Z},stack:u})}}function n0e({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return BL({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function IJ(t){return n0e(t)}function a0e({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return BL({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function yJ(t){return a0e(t)}function bJ({params:t,modMap:e,structure:i}){let{tournamentRecord:r,drawDefinition:n,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],Et({tournamentId:r==null?void 0:r.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUp:o}))}function wJ(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let r=kt(t,i);if(r.error)return r;let n=et(t);if(n.error)return n;let a=n.structure;if(!va({structure:a}))return ee({result:{error:yh,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Pn({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Xl}}function UJ(t){var e;let i=wJ(t,[{targetRoundNumber:!0,roundNumber:!0,[ad]:Swe}]);if(i.error)return i;let{structure:r,roundMatchUps:n,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return ee({result:{error:oe},info:"roundNumbers must be valid rounds"});let l=o>s,c=l?Ee(s+1,o+1):Ee(o,s),u={};return c.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(l?1:-1)})),(e=n==null?void 0:n[s])==null||e.forEach(({matchUpId:d})=>u[d]=o),bJ({params:t,modMap:u,structure:r}),{...Z}}function SJ({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:r,event:n}){var a;if(!r)return{error:Ce};if(!Array.isArray(t))return{error:oe};let o="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=et({drawDefinition:r,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:Ri};let m=(a=ei({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),h=u==null?void 0:u.map(({drawPosition:v})=>v);if(Hi(m,h).length!==(m==null?void 0:m.length))return ee({result:{error:oe},info:"drawPositions do not match",stack:o});let f=Zr({drawDefinition:r}),{matchUps:g}=cr({inContext:!0,drawDefinition:r,matchUpsMap:f});for(let v of u||[]){let{drawPosition:I,participantId:y,bye:b,qualifier:S}=v;if(b){let w=$a({tournamentRecord:i,drawDefinition:r,drawPosition:I,matchUpsMap:f,structureId:c,structure:p,event:n});if(w!=null&&w.error)return w}else if(S)u.forEach(w=>{w.drawPosition===I&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(y){let w=el({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:r,participantId:y,drawPosition:I,matchUpsMap:f,structureId:c,event:n});if(w!=null&&w.error)return w}}_c({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:r,structure:p,event:n})}let s=t.map(({structureId:l})=>l);return pi({tournamentId:i==null?void 0:i.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:r,structureIds:s}),{...Z}}function TJ(t){let e=wJ(t,[{roundNumbers:!0,[ad]:Xn,[is]:o=>o.length===2&&o.every(ki)}]);if(e.error)return e;let{structure:i,roundMatchUps:r,roundNumbers:n}=e;if(!t.roundNumbers.every(o=>n==null?void 0:n.includes(o)))return ee({result:{error:oe,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((r==null?void 0:r[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),bJ({params:t,modMap:a,structure:i}),{...Z}}function o0e({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n}){return BL({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:r,structureId:n})}function DJ(t){return o0e(t)}function s0e({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:r,event:n}){if(!e)return{error:Ce};if(!r)return{error:La};if((i==null?void 0:i.length)!==2)return{error:oe,drawPositions:i};let a=Zr({drawDefinition:e}),{matchUps:o}=cr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:Ri};let l;if(s.structureType===Cn?l=c0e({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}):l=l0e({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:n}),l.error)return l;if(sL({structure:s,drawPositions:i}),VP({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:r}}),_c({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:n}),n.eventType===oo){let c=$t({matchUpFilters:{matchUpTypes:[Zs]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(m=>i.includes(m))}),u=$t({matchUpFilters:{matchUpTypes:[Zs]},structure:s}).matchUps;c.forEach(d=>{(d.sides||[]).forEach(p=>{var m;let h=p==null?void 0:p.drawPosition;if(i.includes(h)){let f=p.participantId,g=u.find(({matchUpId:I})=>I===d.matchUpId),v=(m=d==null?void 0:d.sides)==null?void 0:m.reduce((I,y,b)=>y.drawPosition===h?b:I,void 0);LL({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:f,tournamentRecord:t,drawDefinition:e,matchUp:g,event:n})}})})}return pi({drawDefinition:e,structureIds:[r]}),{...Z}}function l0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(c=>r==null?void 0:r.includes(c.drawPosition));if(!s)return{error:oe,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...Z};if(s.filter(({qualifier:c})=>c).length===2)return{...Z};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?PJ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o}):u0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:n,structure:a,event:o})}function PJ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=r.find(({bye:h})=>h),l=r.find(({participantId:h})=>h),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,m=py({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n});return m.error||(m=py({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n}),m.error)||($a({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:n,event:o}),m=el({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:n,event:o}),m.error)?m:{...Z}}function u0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:r,matchUpsMap:n,structure:a,event:o}){let s=Object.assign({},...r.map((l,c)=>{let{drawPosition:u}=l,d={...r[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),$L({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:r,structure:a,event:o}),{...Z}}function c0e({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:r,matchUpsMap:n,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(m=>r==null?void 0:r.includes(m.drawPosition));return p&&u.push(...p),u},[]);if(l.filter(({bye:u})=>u).length===2)return{...Z};if(l.filter(({qualifier:u})=>u).length===2)return{...Z};$L({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,assignments:l,structure:a,event:o});let c=l.some(({qualifier:u})=>u);if(l.some(({bye:u})=>u)&&!c)PJ({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:n,structure:a,event:o});else{let u=Fe(l,!1,!0);l.forEach((d,p)=>{let m=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=m})}return{...Z}}function RJ(t){return s0e(t)}function EJ({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:r,structureId:n,seedValue:a,event:o}){if(!i)return{error:Ce};if(!n)return{error:La};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===r);if(e&&!s)return{error:Ks};let{structure:l}=et({drawDefinition:i,structureId:n});if(!l)return{error:Ri};if(!(!t||ki(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>ki(p)&&Xe(p)>0)))return{error:oe};let{seedAssignments:c}=ao({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===r);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(m=>parseInt(m)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:r};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return l8({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...Z}}function CJ({drawDefinition:t,structureId:e}){if(!t)return{error:Ce};let{structure:i}=et({drawDefinition:t,structureId:e}),r=((t==null?void 0:t.links)||[]).filter(n=>{var a;return((a=n.source)==null?void 0:a.structureId)===e}).map(n=>{var a;return(a=n.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(n=>r.includes(n.structureId)),structure:i}}function eR({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:r,stages:n,event:a,stage:o}){if(!a)return{error:Wt};let s={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=zl({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:r,stages:n,stage:o});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function VL({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,stage:o}){if(!e)return{error:he};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=eR({withStageGrouping:t,stageSequences:i,stageSequence:r,roundTarget:n,stages:a,event:c,stage:o});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Bc(t){if(!(t!=null&&t.drawDefinition))return!1;let e=KP(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:r,pendingMatchUps:n,upcomingMatchUps:a}=e||{};return i&&(r=r==null?void 0:r.filter(({matchUpType:o})=>o===di),n=n==null?void 0:n.filter(({matchUpType:o})=>o===di),a=a==null?void 0:a.filter(({matchUpType:o})=>o===di)),!!(r!=null&&r.length&&!(n!=null&&n.length)&&!(a!=null&&a.length))}function jL(t){var e,i;let{drawDefinition:r,structureId:n}=t;if(!r)return{error:Ce};let{playoffStructures:a}=CJ({drawDefinition:r,structureId:n});if(!(a!=null&&a.length))return!1;let o=((i=(e=r==null?void 0:r.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&Jo.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,c)=>{var u;return!!((u=ei({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function DM({significantCharacters:t,accessors:e=[],value:i}){let r=[],n=e[0];if(i!=null&&i[n]){let o=e.slice(1);if(Array.isArray(i[n]))i[n].forEach(s=>{let l=DM({accessors:o,significantCharacters:t,value:s});r.push(...l)});else if(i=i[n],o.length){let s=DM({accessors:o,significantCharacters:t,value:i});r.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;r.push(s)}}return r}function d0e({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:r}){if(!Array.isArray(e))return{error:Zx};if(!Array.isArray(r))return{error:Qb};let n={};return t.forEach(a=>{let o=r.find(l=>l.participantId===a),{values:s}=MJ({policyAttributes:e,idCollections:i,participants:r,participant:o});s&&s.forEach(l=>{n[l]||(n[l]=[]),n[l].includes(a)||n[l].push(a)})}),n}function MJ({policyAttributes:t,idCollections:e,participants:i,participant:r}){if(!Array.isArray(t))return{error:Zx};if(!r)return{error:wh};let n=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");n.push(...DM({significantCharacters:c,value:r,accessors:u}))}else if(o){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var m;let h=i.find(f=>f.participantId===p);if((m=h==null?void 0:h.individualParticipantIds)!=null&&m.includes(r.participantId)){let f=h==null?void 0:h.participantId;n.push(f)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(r.participantId)&&n.push(u)})}),{values:ht(n)}}function sV({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:r}){let n=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=n[a.participantId],{values:s}=MJ({participants:e,policyAttributes:i,idCollections:r,participant:o});return{...a,values:s}})}function NJ({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(r=>r==null?void 0:r.participantId).map(r=>{let{drawPosition:n,participantId:a}=r,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[n]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function p0e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=NJ(t);return i.map(a=>{let o=e.filter(c=>a.includes(c)),s=n(o),l=o.filter(c=>!s.includes(c)).filter(c=>{var u;let d=lV(c);return!((u=r[d])!=null&&u.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function n(a){return a.filter(s=>!o(s));function o(s){let l=lV(s);return!a.includes(l)}}}function m0e(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,r=NJ(t);return i.map(n=>{let a=e.filter(l=>n.includes(l)),o=a.length===n.length?a:[],s=n.filter(l=>{var c;return(c=r[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function lV(t){return Number(t%2?t+1:t-1)}function h0e({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function f0e({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:r,unfilledPositions:n,isRoundRobin:a}){let o=r.map(s=>a?m0e({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}):p0e({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:n}));if(a){let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function AJ({positionAssignments:t,participantIds:e}){let i=t.map(r=>r.participantId);return e.filter(r=>!i.includes(r))}function g0e({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:r,groupKey:n}){var a;let o=Object.assign({},...Object.keys(r).map(u=>[u,r[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),s=Object.keys(o).reduce((u,d)=>o[d].length>u?o[d].length:u,0),l=Object.keys(o).filter(u=>o[u].length===s),c=Uo(i?l:Object.keys(o));return n=t&&(a=o[n])!=null&&a.length?n:c,{participantId:n&&o[n]?Uo(o[n]):Uo(e),groupKey:n}}function v0e({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(r=>({[r.drawPosition]:r})));return t.map(r=>r.filter(Boolean).map(n=>i[n]).filter(Boolean).filter(n=>!n.participantId&&!n.bye).map(n=>n.drawPosition)).flat().filter(Boolean)}function I0e({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:r,drawPositionGroups:n,pairedPriority:a,allGroups:o,groupKey:s}){let l=n.reduce((T,P)=>P.length>T?P.length:T,0)<=2,c=AJ({positionAssignments:t,participantIds:e}),u=v0e({positionAssignments:t,drawPositionGroups:n}),{participantId:d,groupKey:p}=g0e({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),m=h0e({participantId:d,allGroups:o}),h=f0e({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:m,participantIdGroups:i,drawPositionChunks:r,unfilledPositions:u}),{unassigned:f,unpaired:g,pairedNoConflict:v}=h,I=(v==null?void 0:v.length)&&v[0],y=(g==null?void 0:g.length)&&g[0],b=a&&I?I:y,S=a?y:I,w=(b==null?void 0:b.length)&&b||(S==null?void 0:S.length)&&S,U;if(w!=null&&w.length){let T=ra(w);U=ra(T)}else{let T=ra(f[0]);U=ra(T)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:U}}function k0({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(r=>{let n=r.map(s=>s.drawPosition),a=OL({drawPositions:n}).uniqueMatchUpGroupings??[],o=Object.assign({},...r.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Dn(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),r.conflict=!0)})}):e.forEach(r=>{var n,a;Dn(((n=r[0])==null?void 0:n.values)||[],((a=r[1])==null?void 0:a.values)||[])&&(i.push(r),r.conflict=!0)}),i}function y0e({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:r,isRoundRobin:n}){return r.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(o!=null&&o.includes(c))).filter(c=>{let u=i.find(f=>f.includes(c)).find(f=>f!==c),d=t.find(f=>f.drawPosition===u),p=k0({isRoundRobin:n,groupedParticipants:[[s,d]]}),m=[t.find(f=>f.drawPosition===c),d],h=k0({isRoundRobin:n,groupedParticipants:[m]});return!p.length&&!h.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function uV(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:r,unseededByePositions:n,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(y=>y==null?void 0:y.length).filter(Boolean)),p=d>2,m=Fe(e,!1,!0).filter(y=>!y.qualifier),h=e.filter(y=>!y.participantId&&(!y.bye||(n==null?void 0:n.includes(y.drawPosition)))).map(y=>y.drawPosition);Ee(0,r).forEach(()=>{let{newGroupKey:y,selectedParticipantId:b,targetDrawPosition:S}=I0e({...t,candidatePositionAssignments:m,allGroups:l,groupKey:u});u=y,m.forEach(w=>{w.drawPosition===S&&(w.participantId=b)})});let f=sV({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=xr(f,d),v=k0({groupedParticipants:g,isRoundRobin:p}),I=0;for(;I<20&&v.length;){let y=y0e({positionedParticipants:f,potentialDrawPositions:h,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(y.length){let b=b0e({candidatePositionAssignments:m,swapOptions:y});b.error&&console.log({result:b}),f=sV({candidatePositionAssignments:m,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=xr(f,d),v=k0({groupedParticipants:g,isRoundRobin:p}),I++}else I=20}return m.forEach(y=>{if(y.bye&&y.participantId){let b=iM;c.push(b)}if(y.qualifier&&y.participantId){let b=iM;c.push(b)}}),{positionAssignments:m,conflicts:v.length,groupedParticipants:g,errors:c}}function b0e({candidatePositionAssignments:t,swapOptions:e}){let i=ra(e);if(!i)return{error:{message:"No swap options"}};let r=i.drawPosition,n=ra(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===r),o=t.find(c=>c.drawPosition===n)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...Z}}function w0e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var m;if(!u)return{error:fK};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:g}=u,{roundsToSeparate:v}=u,I="randomUnseededSeparation",{structure:y}=et({drawDefinition:a,structureId:c}),{matchUps:b}=$t({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(g&&ws(g)&&!v){let _=Qbe(g)||0,L=b.reduce((B,V)=>V.roundNumber>B?V.roundNumber:B,0);v=L<_?1:L-_+1}let{positionAssignments:S}=Tr({structure:y}),w=lL({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,U=S==null?void 0:S.filter(_=>!_.participantId),T=S==null?void 0:S.map(_=>_.drawPosition),P=(y==null?void 0:y.structureType)===Cn,R=P?{structure:y,matchUps:b,allDrawPositions:T,roundsToSeparate:v}:{matchUps:b,allDrawPositions:T,roundsToSeparate:v},{drawPositionGroups:D,drawPositionChunks:E}=P?U0e(R):S0e(R),N={groupParticipants:s.filter(_=>_.participantType===_a).map(_=>_.participantId),teamParticipants:s.filter(_=>_.participantType===ii).map(_=>_.participantId),pairParticipants:s.filter(_=>_.participantType===st).map(_=>_.participantId)},A=d0e({targetParticipantIds:e,policyAttributes:f,idCollections:N,participants:s});if(A.error)return ee({result:A,stack:I});let M=Object.assign({},...e.map(_=>{let L=Object.keys(A).filter(B=>(A[B]??[]).includes(_));return{[_]:L}})),C=AJ({participantIds:e,positionAssignments:S});if(C.length>((U==null?void 0:U.length)||0))return{error:nF};let O,k=C.length,x=Ee(0,h).map(()=>uV({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));if(O=x.reduce((_,L)=>!_||(L.conflicts||0)<(_.conflicts||0)?L:_,void 0),!O||O.conflicts){let _=Ee(0,h).map(()=>uV({initialPositionAssignments:S,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:r,participantIdGroups:M,drawPositionChunks:E,drawPositionGroups:D,policyAttributes:f,idCollections:N,allGroups:A,drawSize:d}));O=x.concat(..._).filter(L=>{var B;return!((B=L.errors)!=null&&B.length)}).reduce((L,B)=>!L||(B.conflicts||0)<(L.conflicts||0)?B:L,void 0)}if(!O)return{error:bP};let F=(((m=ei({structure:y}))==null?void 0:m.positionAssignments)??[]).filter(_=>_.participantId).map(_=>_.participantId),$=O.positionAssignments.filter(_=>!F.includes(_.participantId));for(let _ of $)if(_.bye){let L=$a({tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:I})}else if(_.participantId){let L=el({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,..._});if(L.error)return ee({result:L,stack:I,context:{assignment:_}})}return{...Z}}function U0e(t){let{structure:{structures:e}}=t,i=e.map(r=>r.positionAssignments.map(n=>n.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function S0e({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let r=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),n=r.flat().sort(sr),a=Math.max(...n),o=t.filter(u=>u>a),s=n.length,l=Ee(s===2?1:2,s).filter(u=>u===gF(u)),c=l.slice(0,e||l.length).reverse().map(u=>xr(n,u));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:r,drawPositionChunks:c}}function T0e({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var m,h;let f="positionUnseededParticipants";u||({structure:u}=et({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:g}=Tr({structure:u}),{seedAssignments:v}=ao({provisionalPositioning:t,drawDefinition:a,structure:u}),I=v==null?void 0:v.map(D=>D.participantId).filter(Boolean),{stage:y,stageSequence:b}=u,S=y===qe?(h=(m=ft({element:u,name:sl}))==null?void 0:m.extension)==null?void 0:h.value:void 0,w=Eh({provisionalPositioning:t,drawDefinition:a,stageSequence:b,entryStatuses:Dp,structureId:c,roundTarget:S,stage:y}),U=w.filter(D=>!(I!=null&&I.includes(D.participantId))).map(D=>D.participantId),T=g==null?void 0:g.filter(D=>!D.participantId&&!D.bye&&!D.qualifier).map(D=>D.drawPosition);if(!r&&U.length>((T==null?void 0:T.length)||0))return ee({result:{error:nF},context:{unseededParticipantsCount:U.length,unfilledDrawPositionsCount:T==null?void 0:T.length},stack:f});let{appliedPolicies:P}=Gt({tournamentRecord:n,drawDefinition:a,event:p}),R=P==null?void 0:P[iy];if(u.stage===Fi){let D=w.reduce((E,N)=>(E[N.groupingValue]||(E[N.groupingValue]=[]),E[N.groupingValue].push(N.participantId),E),{});Object.keys(D).length&&(R||(R={policyName:"Playoff Avoidance"}),R.policyAttributes||(R.policyAttributes=[]),R.policyAttributes.push({groupings:D}))}return R&&s?w0e({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:R,drawSize:d,entries:w}):D0e({provisionalPositioning:t,unseededParticipantIds:U,inContextDrawMatchUps:e,unfilledDrawPositions:T,multipleStructures:r,tournamentRecord:n,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function D0e({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:r,multipleStructures:n,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?hn(r):r.reverse();for(let m of e){let h=p.pop();if(!n||h){let f=el({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:m,drawPosition:h,matchUpsMap:l,structureId:c,event:d});if(f!=null&&f.error&&console.log("!!!!!",{result:f}),f==null?void 0:f.error)return ee({result:f,stack:"randomUnseededDistribution"})}}return{...Z}}function P0e(t){let e=t.structure??et(t).structure,i="positionQualifiers",r=[];if(e.stage===Yr)return ee({result:{error:bp},stack:i});let{unplacedRoundQualifierCounts:n,positionAssignments:a,roundDrawPositions:o}=R0e(t);for(let s of Object.keys(n)){let l=a==null?void 0:a.filter(c=>o[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(n[s]>(l||0))return ee({result:{error:OK},context:{unfilledDrawPositions:l},stack:i});Ee(0,n[s]).forEach(()=>{let c=ra(l);r.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...Z,qualifierDrawPositions:r}}function R0e({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=et({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:r}=Tr({structure:e}),{stage:n,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=Uv({drawDefinition:t,stageSequence:a,structureId:i,stage:n}),l=(s?Object.keys(s):[]).map(f=>Xe(f)),{matchUps:c}=$t({structure:e}),{roundProfile:u}=Pn({matchUps:c}),d=Object.assign({},...l.filter(f=>u==null?void 0:u[f]).map(f=>{var g,v;return{[f]:((v=(g=u==null?void 0:u[f])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=r==null?void 0:r.filter(f=>f.qualifier).map(f=>f.drawPosition),m=o-((p==null?void 0:p.length)??0),h=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(f=>{let g=r==null?void 0:r.filter(v=>{var I,y;return v.qualifier&&((y=(I=d[f])==null?void 0:I.drawPositions)==null?void 0:y.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[f]:((s==null?void 0:s[f])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:m,placedQualifiersCount:h,roundQualifiersCounts:s,positionAssignments:r,roundDrawPositions:d,qualifiersCount:o}}function cV({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:r,validSeedBlocks:n,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:m}){let h=[],f=[],g=0;if(p||({structure:p}=et({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),r||(r=Gt({drawDefinition:a}).appliedPolicies),!n){let v=p&&xh({provisionalPositioning:t,appliedPolicies:r,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&f.push(v.error),n=v==null?void 0:v.validSeedBlocks}return c=c??(n==null?void 0:n.length)??0,Ee(0,c).forEach(()=>{if(g<(c||0)){let v=E0e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:m});v!=null&&v.success&&(g++,h.push(...v.seedPositions??[])),v.error&&f.push({seedPositionError:v.error})}}),f.length?{error:f}:{...Z,seedPositions:h}}function E0e({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=mJ({provisionalPositioning:t,randomize:!0,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,structureId:s,event:c}),{appliedPolicies:p}=Gt({drawDefinition:r}),{avoidance:m}=p??{};m&&o&&(u==null?void 0:u.length)>2;let h=[];for(let f of u){let g=d.pop();if(!g)return{error:tv};h.push(g);let v=el({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:r,seedingProfile:n,participantId:f,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...Z,seedPositions:h}}function C0e({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:r}=Tr({structure:i}),{seedAssignments:n}=ao({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(n||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return r==null?void 0:r.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function M0e({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let r=[];e.forEach(a=>{if(i-r.length>a.drawPositions.length)r.push(...a.drawPositions);else{let o=PM(xr(a.drawPositions,2)),s,l=t[r.length];for(;s=PS(o,l);)r.push(s),l=t[r.length]}});let n=r.map(a=>Array.isArray(a)?hn(a):a).flat(1/0);return t9(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:n}function PS(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,r=t[1].flat(1/0).length;if(i===r){let n=t[0].flat(1/0).includes(e)?t[0]:t[1];return PS(e?n:t[Math.round(Math.random())],e)}return i<r?PS(t[1],e):PS(t[0],e)}function PM(t){let e=Math.floor(t.length/2);return t.length>2?[PM(t.slice(0,e)),PM(t.slice(e))]:t}function N0e({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:r,seedingProfile:n,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=xh({provisionalPositioning:t,appliedPolicies:i,drawDefinition:r,seedingProfile:n,structure:s}));let{isFeedIn:c,isLuckyStructure:u,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let m=C0e({provisionalPositioning:t,drawDefinition:r,structure:s})??[],h=ht([].concat(...e.map(S=>S.drawPositions))),f=m.filter(S=>h.includes(S.drawPosition)),g=(S,w)=>og(S.seedValue)-og(w.seedValue),v=p.reduce((S,w)=>{let U=f.filter(T=>{var P;return(P=w.drawPositions)==null?void 0:P.includes(T.drawPosition)}).sort(g);return S.concat(...U)},[]).map(S=>S.drawPosition),I=M0e({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),y=dV({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),b=dV({orderedSeedDrawPositions:I,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:u,positionedSeeds:m,isContainer:d,isFeedIn:c}}function dV({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(r=>r.drawPositions).map(r=>r==null?void 0:r.sort((n,a)=>n-a)).filter(r=>(r==null?void 0:r[0])+1===(r==null?void 0:r[1]));return t.map(r=>i.find(n=>n==null?void 0:n.includes(r))).filter(Boolean).map(r=>r==null?void 0:r.reduce((n,a)=>t.includes(a)?n:a,void 0)).filter(Boolean)}function A0e({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:r,drawDefinition:n,seedLimit:a,structure:o,isFeedIn:s}){var l,c;let u=(l=r==null?void 0:r.seeding)==null?void 0:l.seedingProfile,d=o.stage===qe,{positionAssignments:p}=Tr({structure:o}),m=p==null?void 0:p.filter(O=>O.participantId).map(O=>O.drawPosition),h={isCollectionMatchUp:!1},{matchUps:f,roundMatchUps:g}=$t({provisionalPositioning:t,matchUpFilters:h,structure:o}),v=(g==null?void 0:g[1])||[],I=o.structureType===Cn?f:v,y=ht([].concat(...I.map(O=>O.drawPositions))),b=Math.min(...y)-1,S=m==null?void 0:m.filter(O=>y.includes(O)),w=O=>{let k=Math.ceil(O.length/2),x=[O.slice(0,k),O.slice(k)],F=x.map(H=>[].concat(...H.flat(1/0)).length),$=Math.min(...F.flat(1/0)),_=Math.max(...F.flat(1/0)),L=F.indexOf(_),B=$!==_,V=hn(x),[G,j]=!$||B?[x[L],x[1-L]]:[V[0],V[1]];return{greaterHalf:G,lesserHalf:j}},U=O=>{let{greaterHalf:k,lesserHalf:x}=w(O),{greaterHalf:F,lesserHalf:$}=w(k),_=hn(F.flat(1/0)).pop(),L=F.flat().filter(B=>B!==_);return{newlyFilteredChunks:[...x,...$,L],drawPosition:_}},T=O=>!e.includes(O),P=O=>!(S!=null&&S.includes(O)),R=O=>{let k=xr(O.sort(sr),Math.ceil(O.length/4)).map($=>$.filter(P)),x=[].concat(...k.flat(1/0)).length,F=[];for(let $=0;$<x;$++){let{newlyFilteredChunks:_,drawPosition:L}=U(k);F.push(L),k=_}return F},{validSeedBlocks:D}=xh({provisionalPositioning:t,allPositions:!0,appliedPolicies:r,drawDefinition:n,structure:o}),E=D==null?void 0:D.map(O=>{var k;return(k=O.drawPositions)==null?void 0:k.map(x=>x+b)}),N;if(s){let O=y.length,{seedBlocks:k}=kL({cluster:Fw(u)===kP,participantsCount:O});N=k.map(x=>x.map(F=>F+b)).map(R).filter(x=>x.length)}else d?N=E==null?void 0:E.map(O=>O.filter(P)):N=E==null?void 0:E.map(R).filter(O=>O.length);let A=I.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((k,x)=>k-x)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),M=O=>A.reduce((k,x)=>x.includes(O)?x.reduce((F,$)=>$!==O?$:F,void 0):k,void 0),C=N.map(O=>O.map(M)).flat(1/0).filter(P).filter(T).filter(Boolean);if(d&&!o.structures){let O=a%4,k=C.slice(0,O),x=(c=g[o.roundLimit])==null?void 0:c.length,F=xr(C.slice(O),x).map(hn).flat();C=k.concat(F)}return{unseededByePositions:C}}function O0e({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:r,event:n}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=$t({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:r,event:n}),c=(l==null?void 0:l[1])||[],u=(r==null?void 0:r.structureType)===Cn,d=u?s:c,p=u?((a=r==null?void 0:r.structures)==null?void 0:a.length)||0:s.length,{structureId:m,stage:h,stageSequence:f}=r,g=Eh({entryStatuses:Jo,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),{qualifiersCount:v}=Uv({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:m,stage:h}),I=g.length+v,{positionAssignments:y,unassignedPositions:b}=Tr({structure:r}),S=b==null?void 0:b.map(D=>D.drawPosition),w=y==null?void 0:y.filter(D=>D.bye).length,U=y==null?void 0:y.filter(D=>D.bye).map(D=>D.drawPosition),T=d.map(D=>D.drawPositions).filter(D=>D==null?void 0:D.reduce((E,N)=>!(U!=null&&U.includes(N))&&E,!0)).flat(1/0).filter(D=>S==null?void 0:S.includes(D)),P=y==null?void 0:y.length,R=P?P-I:0;return R>p&&r.stageSequence===1&&r.stage!==Yr&&(R=p),{placedByes:w,byesCount:R,relevantMatchUps:d,placedByePositions:U,roundMatchUps:l,positionsToAvoidDoubleBye:T}}function pV({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:r,seedBlockInfo:n,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var p;l||({structure:l}=et({drawDefinition:r,structureId:s})),s||(s=l==null?void 0:l.structureId);let m=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===qe),{byesCount:h,placedByes:f,relevantMatchUps:g}=O0e({provisionalPositioning:t,drawDefinition:r,matchUpsMap:o,structure:l,event:d}),v=h-(f||0);if(v<=0)return{...Z};let{strictSeedOrderByePositions:I,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:S}=N0e({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:r,seedingProfile:a,seedBlockInfo:n,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[Cn,xP].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),U=m&&y!=null&&y.length?y:I,{unseededByePositions:T}=A0e({provisionalPositioning:t,seedOrderByePositions:U,isLuckyStructure:b,appliedPolicies:i,drawDefinition:r,seedLimit:c,structure:l,isFeedIn:S}),P=N=>N%2,R=(N,A)=>(N||[]).every(M=>P(M)?A!==M+1:A!==M-1),D=[].concat(...U);if(!u)for(;T.length;){let N=T.find(A=>R(D,A));N?(D.push(N),T=T.filter(A=>A!==N)):(D.push(...T),T=[])}w&&(D=hn(D),no({ignoreSeededByes:w})&&console.log({byePositions:D}));let E=D.slice(0,v);for(let N of E){let A=$a({provisionalPositioning:t,tournamentRecord:e,drawDefinition:r,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(A!=null&&A.error)return A}return{...Z,unseededByePositions:T,byeDrawPositions:E}}function Lw(t){var e,i,r,n;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:c=!0,tournamentRecord:u,placementGroup:d,seedingProfile:p,structureId:m,seedLimit:h,seedsOnly:f,drawType:g,drawSize:v,event:I}=t,y=[];o||(u9(),a=Fe(a,!1,!0));let b=x=>(o||IS(),ee({result:x,stack:"automatedPositioning"})),S=x=>(o||IS(),x),w=et({drawDefinition:a,structureId:m});if(w.error)return b(w);let U=w.structure;if(!U)return{error:Ri};let T=t.appliedPolicies||((e=Gt({drawDefinition:a,structure:U,event:I}))==null?void 0:e.appliedPolicies),{qualifiersCount:P}=Uv({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,drawDefinition:a,structureId:m}),R=Dp;if(!((i=Eh({stageSequence:U.stageSequence,provisionalPositioning:s,stage:U.stage,placementGroup:d,drawDefinition:a,entryStatuses:R,structureId:m}))!=null&&i.length)&&!P)return S({...Z});let D=t.matchUpsMap??Zr({drawDefinition:a}),E=t.inContextDrawMatchUps??((r=cr({inContext:!0,drawDefinition:a,matchUpsMap:D}))==null?void 0:r.matchUps),N=[],A=xh({provisionalPositioning:s,appliedPolicies:T,drawDefinition:a,seedingProfile:p,structure:U});if(A.error)return A;let{validSeedBlocks:M}=A;y.push({validSeedBlocks:M});let C=t.participants||(u?(n=Wi({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:u}))==null?void 0:n.participants:[]);if(Fw(U.seedingProfile||p)===Kd){let x=c?pV({provisionalPositioning:s,tournamentRecord:u,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:D,structure:U,seedLimit:h,seedsOnly:f,event:I}):void 0;if(x!=null&&x.error)return b(x);N=x.unseededByePositions,y.push({action:"positionByes",unseededByePositions:N});let F=U.seedingProfile?{positioning:U.seedingProfile}:p;if(x=cV({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:E,tournamentRecord:u,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:D,structure:U,event:I}),x.error)return b(x);y.push({seedPositions:x.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Up){let F=U.seedingProfile?{positioning:U.seedingProfile}:p,$=cV({seedingProfile:F,provisionalPositioning:s,inContextDrawMatchUps:E,tournamentRecord:u,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:D,structure:U,event:I});if($.error)return b($);y.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let x=c?pV({provisionalPositioning:s,tournamentRecord:u,appliedPolicies:T,drawDefinition:a,seedBlockInfo:A,matchUpsMap:D,structure:U,seedLimit:h,seedsOnly:f,event:I}):void 0;if(x!=null&&x.error)return b(x);N=x==null?void 0:x.unseededByePositions,y.push({action:"positionByes",byeDrawPositions:x==null?void 0:x.byeDrawPositions,unseededByePositions:N})}let O={};if(!f){let x=P0e({inContextDrawMatchUps:E,tournamentRecord:u,appliedPolicies:T,validSeedBlocks:M,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:D,structure:U});if(x.error||(x.conflicts&&(O.qualifierConflicts=x.conflicts),y.push({action:"positionQualifiers",qualifierDrawPositions:x.qualifierDrawPositions}),x=T0e({provisionalPositioning:s,inContextDrawMatchUps:E,unseededByePositions:N,multipleStructures:l,tournamentRecord:u,drawDefinition:a,seedBlockInfo:A,participants:C,matchUpsMap:D,structureId:m,structure:U,drawSize:v,event:I}),x.error))return b(x);x.conflicts&&(O.unseededConflicts=x.conflicts),y.push({action:"positionUnseededParticipants"})}let{positionAssignments:k}=ei({drawDefinition:a,structure:U});return pi({drawDefinition:a,structureIds:[m]}),o||IS(),{positionAssignments:k,conflicts:O,...Z,positioningReport:y}}function _w(t){var e;let{applyPositioning:i=!0,provisionalPositioning:r,tournamentRecord:n,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:c,event:u}=t;if(!u)return{error:ha};if(!a)return{error:ma};if(!Bc({drawDefinition:a,structureId:s})&&!r)return{error:Bx};let d=(e=CJ({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((h,f)=>P0(h)-P0(f)),p=[],m=[];if(d)for(let h of d){let{structureId:f}=h,g=Lw({structureId:f,provisionalPositioning:r,applyPositioning:i,tournamentRecord:n,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:c});if(g.error)return g;g.positionAssignments&&p.push({positionAssignments:g.positionAssignments,structureId:f}),g.positioningReport&&m.push(g.positioningReport)}return{...Z,structurePositionAssignments:p,positioningReports:m}}function OJ({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>nt(i)))&&ee({result:{error:oe},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let r=e[i.structureId];r&&(i.structureOrder=r)}),t.structures.sort((i,r)=>Yf(i.structureOrder)-Yf(r.structureOrder)),{...Z}):{error:Ce}}function tR({drawDefinition:t}){var e,i,r,n,a,o,s;let l=t.structures??[],c=t.links??[],u=new Map,d=U=>{let T=u.get(U)||u.set(U,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&u.get(U);if(T&&!(T!=null&&T.stage)){let P=l.find(R=>R.structureId===U);T.stage=P==null?void 0:P.stage}return T},p={},m={},h=c.map(U=>{let T=U.source.structureId,P=U.target.structureId,R=d(T),D=d(P);return[Jd,So,FP,Kd].includes(U.target.feedProfile)?(R==null||R.targets.push(P),D==null||D.sources.push(T)):U.target.feedProfile===rs&&(D==null||D.drawSources.push(T),R==null||R.drawTargets.push(P)),m[P]=m[P]||U.target.feedProfile===rs,p[P]=ht([...p[P]||[],T]).filter(Boolean),[U.source.structureId,U.target.structureId]});for(let U of u.keys()){let T=u.get(U);if(T){let P=T.targets??[];for(;P.length;){let R=P.pop(),D=R&&u[R];(e=D==null?void 0:D.targets)!=null&&e.length?P.push(...D.targets):D&&(T.rootStage=D.stage)}if(T.rootStage||(T.rootStage=T.stage),!((i=T.targets)!=null&&i.length)){let R=T.sources??[];for(;R.length;){let D=R.pop(),E=D&&u[D];if((r=E==null?void 0:E.sources)!=null&&r.length){for(let N of E.sources)(n=T.progeny)!=null&&n.includes(N)||(a=T.progeny)==null||a.push(N);R.push(...E.sources)}}}}}let f=0;for(let U of u.keys()){let T=u.get(U);if(T&&T.rootStage===qe){let P=[(o=T.drawTargets)==null?void 0:o[0]],R=0;for(;P.length;){R+=1;let D=P.pop(),E=D?u.get(D):void 0;(s=E==null?void 0:E.drawTargets)!=null&&s.length&&P.push(E.drawTargets[0])}T.distanceFromMain=R,R>f&&(f=R)}}let g=h.length;Ee(0,Math.ceil(g/2)).forEach(()=>{h=Ee(0,g).map(U=>{let T=h[U],P=h.reduce((R,D)=>Dn(T,D)?R.concat(...D):R,[])||[];return ht(T.concat(...P))})});let v=h[0],I=(U,T)=>Hi(U,T).length===U.length,y=h.slice(1).reduce((U,T)=>U&&I(T,v),!0),b=[v].filter(Boolean),S=[v].filter(Boolean);l.forEach(U=>{let{structureId:T,stage:P}=U;b.find(R=>R.includes(T))||(b.push([T]),P!==Mr&&S.push([T]))});let w=y&&S.length===1;return!(c!=null&&c.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(u),allStructuresLinked:w,maxQualifyingDepth:f,sourceStructureIds:p,hasDrawFeedProfile:m,structureGroups:b}}function kJ({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=tR({drawDefinition:t});for(let r of t.structures){let n=i[r.structureId];n.distanceFromMain&&(r.stageSequence=e+1-n.distanceFromMain)}return{...Z}}function ud(t){var e;let{duplicateValues:i=!0,creationTime:r=!0,removePriorValues:n,timeItem:a,element:o}=t;if(!a)return{error:lF};if(!o)return{error:Ve,info:OF};let s=a&&Object.keys(a),l=["itemType","itemValue"];if(l.filter(c=>s.includes(c)).length!==l.length)return{error:sF};if(!o.timeItems)o.timeItems=[];else{let{itemType:c,itemSubTypes:u,itemValue:d}=a,p=c&&((e=ul({itemSubTypes:u,itemType:c,element:o}))==null?void 0:e.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!i)return{...Z}}if(a.itemSubTypes&&!a.itemSubTypes.length&&delete a.itemSubTypes,r){let c=new Date().toISOString();Object.assign(a,{createdAt:c})}return n&&(o.timeItems=o.timeItems.filter(({itemType:c})=>a.itemType!==c)),n&&!a.itemValue||o.timeItems.push(a),{...Z}}function GL({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:r,participantId:n,timeItem:a}){if(!i)return{error:he};if(!n)return{error:vr};let o=Mp({tournamentRecord:i,participantId:n});return o.error?o:ud({element:o.participant,removePriorValues:e,duplicateValues:r,creationTime:t,timeItem:a})}function Lh(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:r,creationTime:n,timeItem:a}=t;return i?ud({element:i,removePriorValues:e,duplicateValues:r,creationTime:n,timeItem:a}):{error:he}}function _h(t){let{removePriorValues:e,duplicateValues:i,creationTime:r,timeItem:n,event:a}=t;return a?ud({removePriorValues:e,duplicateValues:i,element:a,creationTime:r,timeItem:n}):{error:ha}}function HL({tournamentRecord:t,drawDefinition:e,structure:i,link:r}){if(!t)return{error:he};if(!e)return{error:Ce};let n=k0e({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:r});if(n.error)return n;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return Lh({tournamentRecord:t,timeItem:a}),n}function k0e({drawDefinition:t,tournamentId:e,structure:i,eventId:r,link:n}){var a;if(!t)return{error:Ce};if(!i)return{error:td};if(!n)return{error:zx};let o=n.target.structureId,s=et({drawDefinition:t,structureId:o});if(s.error)return ee({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:s});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(n),kJ({drawDefinition:t});let l=((a=$t({structure:i}))==null?void 0:a.matchUps)||[];return Lc({drawDefinition:t,tournamentId:e,matchUps:l,eventId:r}),pi({drawDefinition:t,structureIds:[i.structureId]}),{...Z}}function xJ({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:oe};if(!t)return{error:Ce};let i=Object.assign({},...e.map(r=>{if(!Ii(r))return;let{structureId:n,structureName:a}=r||{};if(!(!n||!a))return{[n]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:Ve};for(let r of t.structures||[]){let n=i[r.structureId];n&&(r.structureName=n)}return{...Z}}function zL({drawDefinition:t,timeItem:e}){if(!t)return{error:ma};if(!e)return{error:lF};let i=e&&Object.keys(e),r=["itemType","itemValue"];if(r.filter(a=>i.includes(a)).length!==r.length)return{error:sF};t.timeItems||(t.timeItems=[]);let n=new Date().toISOString();return Object.assign(e,{createdAt:n}),t.timeItems.push(e),pw({drawDefinition:t}),{...Z}}function FJ(t){var e;let{tournamentRecord:i,drawDefinition:r,structureId:n,event:a}=t,o=kt(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=r.structures??[],l=s.find(I=>I.structureId===n);if(!l)return{error:Ri};let c=s.find(({stage:I,stageSequence:y})=>I===Oe&&y===1),u=n===(c==null?void 0:c.structureId),d=s.filter(({stage:I})=>I===qe).map(ga("structureId"));if(u&&!d.length)return{error:Y7};let p=d.includes(n),m=x0e({isQualifyingStructure:p,structure:l,...t});if(m!=null&&m.error)return m;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=L0e({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:r,structureId:n}),{removedMatchUpIds:g,removedStructureIds:v}=_0e({relatedStructureIdsMap:f,qualifyingStructureIds:d,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:r,structureIdsToRemove:h,structureId:n});if(F0e({removedMatchUpIds:g,drawDefinition:r}),u){let I=(e=c.matchUps??[])==null?void 0:e.map(ga("matchUpId"));g.push(...I),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return p&&kJ({drawDefinition:r}),Ku({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:r}),pi({drawDefinition:r,eventId:a==null?void 0:a.eventId}),{...Z,removedMatchUpIds:g,removedStructureIds:v}}function x0e({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:r,structure:n,event:a,force:o}){var s,l,c,u,d,p;let m=[r];if(t){let h=g=>{var v;return(v=i.links)==null?void 0:v.find(I=>I.target.structureId===g)},f=(s=h(r))==null?void 0:s.source.structureId;for(;f;)m.push(f),f=(l=h(f))==null?void 0:l.source.structureId}if((c=cr({matchUpFilters:{structureIds:m},drawDefinition:i}).matchUps)!=null&&c.some(({score:h})=>_r({score:h}))){let h=(u=Gt({tournamentRecord:e,drawDefinition:i,structure:n,event:a}))==null?void 0:u.appliedPolicies;if(!(o??((p=(d=h==null?void 0:h[Vl])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:TP}}return{...Z}}function F0e({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=cr({drawDefinition:e});i==null||i.forEach(r=>{r.winnerMatchUpId&&t.includes(r.winnerMatchUpId)&&delete r.winnerMatchUpId,r.loserMatchUpId&&t.includes(r.loserMatchUpId)&&delete r.loserMatchUpId})}function L0e({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureId:a}){let o=(n.structures??[]).map(ga("structureId")),s=u=>{var d;return((d=n.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(r==null?void 0:r.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=n.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return o.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function _0e({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:r,drawDefinition:n,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...V0e({idBeingRemoved:c,drawDefinition:n}));let u=B0e({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:n,structureId:o});s.push(...u.removedStructureIds);let d=$0e({relatedStructureIdsMap:t,mainStageSequence1:r,idBeingRemoved:c,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function $0e({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:r}){var n;return t&&((n=e.get(t))==null?void 0:n.filter(a=>a!==(i==null?void 0:i.structureId)||r===i.structureId))}function B0e({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:r,structureId:n}){var a;let o=[];return r.links=((a=r.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==n)&&(r.structures=(r.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function V0e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=et({structureId:t,drawDefinition:e}),r=$t({structure:i}).matchUps;return _F(r)}function x0({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:r}){if(!e)return{error:Ce};if(!cL({drawDefinition:e,stage:r}))return{error:bp};let n=wUe({drawDefinition:e,stage:r}),{qualifiersCount:a}=Uv({drawDefinition:e,stageSequence:t,stage:r}),o=n+a;if(i<o)return{error:Hx};let{entryProfile:s}=uL({attributes:[{[r]:{drawSize:i}}],drawDefinition:e});return pi({drawDefinition:e}),{...Z,entryProfile:s}}function LJ({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?cL({drawDefinition:e,stage:i})?i!==Oe?{error:Hx,info:"qualifiersCount can only be set for main stage"}:(uL({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),pi({drawDefinition:e}),{...Z}):{error:bp}:{error:Ce}}function j0e({drawDefinition:t,drawSize:e}){if(!t)return{error:Ce};let i=x0({stage:Mr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(pi({drawDefinition:t}),{...Z})}function _J(t){return j0e(t)}function $J({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:r}){var n;let a="removeSeededParticipant";if(!t)return{error:he};if(!e)return{error:Ce};let o=(e.structures??[]).find(s=>s.structureId===r);return o?!o.stage||![Oe,qe].includes(o.stage)||o.stage===Oe&&o.stageSequence!==1?ee({result:{error:yh},stack:a}):(n=o.seedAssignments)!=null&&n.find(s=>s.participantId===i)?{...Z}:ee({info:"participant not seeded",result:{error:on},context:{participantId:i}}):ee({result:{error:Ri},stack:a})}function $w({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:r,targetStructureId:n,linkType:a=Cu}){return!r||!n?{error:La}:{link:He({linkType:a,source:{roundNumber:i,structureId:r,finishingPositions:e},target:{feedProfile:rs,roundNumber:t,structureId:n}})}}function WL({roundPosition:t,roundNumber:e,idPrefix:i,uuids:r}){return i?`${i}-${e}-${t}`:(r==null?void 0:r.pop())||Yt()}function F0({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:r,idPrefix:n,isMock:a,uuids:o,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let m=s==null?void 0:s[l],h=s==null?void 0:s[l+1];d&&(m.roundNumber=d),h&&d&&(h.roundNumber=d);let f=WL({roundPosition:u,roundNumber:i,idPrefix:n,uuids:o}),g={roundPosition:u,children:[m,h],matchUpId:f};c.push(g);let v={drawPositions:g.children.map(I=>I==null?void 0:I.drawPosition).filter(Boolean),matchUpStatus:zi,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),r.push(v),u++,l+=2}return{roundNodes:c,matchUps:r}}function tl({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:r,matchUpType:n,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||r&&s<=r)return{matchUps:[],roundsCount:0};if(r&&(!ws(s)||s%r)){let g=r;for(;g<s;)g=2*g;s=g}let u=r&&!(s%2)&&(!isNaN(r)||i&&!isNaN(i))&&(s/r===Math.round(s/r)||i&&s/i===Math.round(s/i));if(!ws(s)&&!u)return{matchUps:[],roundsCount:0};let d=Ee(1,s+1).map(g=>({drawPosition:g})),p,m=[],h=1;for({roundNodes:p,matchUps:m}=F0({matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,nodes:d,uuids:c}),h++,a=a??i;p.length>1;)r&&p.length===r&&(a=h-1),{roundNodes:p,matchUps:m}=F0({nodes:p,matchUpType:n,roundNumber:h,idPrefix:o,matchUps:m,isMock:l,uuids:c}),h++;let f=h-1;return m=mw({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:f,roundLimit:a,matchUps:m}),a?m=m.filter(g=>a&&(g.roundNumber??0)<=a):a=h-1,{drawSize:s,matchUps:m,roundsCount:f,roundLimit:a}}function qL(t){var e,i,r,n,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return ee({result:{error:Ce},stack:s});if(t.drawSize&&!nt(t.drawSize)||t.participantsCount&&!nt(t.participantsCount)||t.qualifyingPositions&&!nt(t.qualifyingPositions))return ee({result:{error:oe},stack:s});let l=t.drawSize??fF(t.participantsCount),{qualifyingRoundNumber:c,qualifyingPositions:u,targetStructureId:d,structureOptions:p,appliedPolicies:m,drawDefinition:h,matchUpFormat:f,structureName:g,structureId:v,roundTarget:I,drawType:y,idPrefix:b,isMock:S,uuids:w}=t;if(!t.drawSize)return ee({result:{error:Jb},context:{drawSize:l},stack:s});if(u&&u>=t.drawSize)return ee({result:{error:oe},context:{drawSize:l,qualifyingPositions:u},stack:s});let U,T,P,R,D=0,E,N=1,{structureProfiles:A}=tR({drawDefinition:h}),M=A[d];if(!M)return ee({result:{error:Ri},context:{targetStructureId:d},stack:s});let C=h.matchUpType,O=I?`${I}-`:"",k=M.stage===qe,x=((i=(e=m==null?void 0:m[Jf])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((n=(r=iSe[Jf])==null?void 0:r.namingConventions)==null?void 0:n.pre),F=k&&x?`${x}-`:"",$=g??(O?`${F}${zr(qe)} ${O}`:`${F}${zr(qe)}`);if(y===_o){let{maxRoundNumber:B,structures:V,groupCount:G}=kw({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),stage:qe,structureOptions:p,appliedPolicies:m,stageSequence:N,matchUpType:C,roundTarget:I,idPrefix:b,drawSize:l,isMock:S,uuids:w});D=G,U=B,P=V[0],E=[1]}else({drawSize:l,matchUps:R,roundLimit:U,roundsCount:T}=tl({qualifyingRoundNumber:c,qualifyingPositions:u,matchUpType:C,idPrefix:b,drawSize:l,isMock:S,uuids:w})),U||(U=T),P=Ya({structureName:g??$,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:U,stage:qe,matchUpFormat:f,stageSequence:N,matchUpType:C,roundLimit:U,matchUps:R}),I&&Mt({extension:{name:sl,value:I},element:P}),D=(a=R==null?void 0:R.filter(B=>B.roundNumber===U))==null?void 0:a.length;let _=y===_o?Eu:Cu,L=P&&U&&((o=$w({sourceStructureId:P.structureId,sourceRoundNumber:U,targetStructureId:d,finishingPositions:E,linkType:_}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:D,...Z,structure:P,link:L}}function BJ(t){let e=t.tournamentRecord;if(!e)return{error:he};let i=G0e(t);if(i.error)return i;let{qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t,d={itemType:"addQualifyingStructures",itemValue:He({drawId:o.drawId,qualifyingRoundNumber:r,qualifyingPositions:n,targetStructureId:a,structureName:s,matchUpType:l,drawSize:c,drawType:u})};return Lh({tournamentRecord:e,timeItem:d}),i}function G0e(t){if(!t.drawDefinition)return{error:Ce};if(!t.targetStructureId)return{error:La};let e=qL(t);if(e.error)return e;let{structure:i,link:r}=e;return!i||!r?{error:oe}:HL({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:r})}function H0e({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:r,idPrefix:n,matchUps:a,isMock:o,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Ee(0,u).map(f=>d?d+f:void 0),m=[];for(let f=0;f<u;f++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},I=l[f];I.roundNumber=i-1;let y=WL({roundPosition:I.roundPosition,roundNumber:i,idPrefix:n,uuids:s}),b={roundPosition:I.roundPosition,drawPositions:[g],matchUpStatus:zi,roundNumber:i,matchUpId:y};t&&(b.matchUpType=r),o&&(b.isMock=!0),a.push(b);let S={children:[I,v]};m.push(S)}let h=e?e-u:void 0;return{roundNodes:m,matchUps:a,drawPosition:h}}function Vc(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:r=0,skipRounds:n=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:m,uuids:h,fmlc:f}=t;a=a??A(e);let g=z0e({drawSize:a}),v=g.length,I=0;if(i!=null&&i.length)I=i.reduce((M,C)=>M+C,0);else if(e){let M=e-a;i=g.filter(C=>C<=M?(M-=C,!0):!1),I=i.reduce((C,O)=>C+O,0),r=i.length}else n>=v?r=0:c&&(r=v-c,n=0),i=g.filter((M,C)=>c&&!r||r&&C>=n+r||C<n?0:M),I=i.reduce((M,C)=>M+C,0),r=i.length;let y=[...g,...i].sort((M,C)=>C-M),b=y.length,S=[...(l??[]).map(M=>M-1),...(o??[]).map(M=>b-M)].map(M=>y[M]).reduce((M,C)=>M+C,0);I=I-S;let w=0,U=[],T,P=1,R=Ee(0,a).map((M,C)=>({drawPosition:C+1+I})),D=I+1;for(let M of g){if({roundNodes:T,matchUps:U}=F0({matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:m,nodes:R,uuids:h}),P++,i.includes(M)){let C=fa(i)[M],O=Ee(0,C),k=b+1-P,x=(o==null?void 0:o.includes(k))??(l==null?void 0:l.includes(P));O.forEach(()=>{({roundNodes:T,matchUps:U,drawPosition:D}=H0e({drawPosition:!x&&D||void 0,nodes:T,matchUpType:d,roundNumber:P,idPrefix:p,matchUps:U,isMock:m,uuids:h,fed:w})),P++,w+=1})}R=T}b!==P-1&&console.log("ERROR");let E=a-I;U=mw({finishingPositionOffset:u?E:s,positionsFed:I,roundsCount:b,matchUps:U,fmlc:f});let N=T!=null&&T.length?T[0]:T;return N&&(N.roundNumber=P-1,N.matchUps=U),{draw:N,matchUps:U,roundsCount:b};function A(M){let C=gF(M);return C>M?C/2:C}}function z0e({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Ee(0,e).reverse().map(i=>Math.pow(2,i))}function ff(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:m,sequenceLimit:h,stage:f=Oe,drawSize:g,idPrefix:v,isMock:I,uuids:y}=t;if(!(!o||!c||o!=null&&o[l])||g<2||h&&s>h)return{};let b=[],S=[],w=[],U=t.matchUpType??(p==null?void 0:p.matchUpType),T=e+1,P=e+g,R=`${T}-${P}`,D=o==null?void 0:o[l],E=r&&`${r} `||"",N=(o==null?void 0:o[R])??(n==null?void 0:n[R]),A=t.structureName||(N==null?void 0:N.name)||(D==null?void 0:D.name)&&(i?`${E}${D==null?void 0:D.name}`:D.name)||`${E}${R}`,M=(N==null?void 0:N.abbreviation)??(D==null?void 0:D.abbreviation),C=t.structureId??(D==null?void 0:D.structureId)??(y==null?void 0:y.pop()),O={idPrefix:v&&`${v}-${A}-RP`,finishingPositionOffset:e,matchUpType:U,drawSize:g,isMock:I,uuids:y},{matchUps:k}=m?Vc(O):tl(O),x=Ya({structureAbbreviation:M,stageSequence:s,structureName:A,matchUpType:U,roundOffset:d,structureId:C,matchUps:k,stage:f});b.push(...k),S.push(x);let F=Math.ceil(Math.log(g)/Math.log(2)),$=u?Math.min(u-d,F):!a||T<a?F:0;return g>2&&Ee(1,$+1).forEach(L=>_(L)),{structureId:x.structureId,matchUps:b,structureName:A,structures:S,links:w,...Z};function _(L){let B=g/Math.pow(2,L);if(B<2)return;let V=g/Math.pow(2,L)+e;if(a&&V+1>a)return;let{structures:G,structureId:j,matchUps:H,links:W}=ff({finishingPositionOffset:V,exitProfile:`${l}-${L}`,roundOffset:d+L,stageSequence:s+1,drawSize:B,addNameBaseToAttributeName:i,playoffStructureNameBase:r,finishingPositionNaming:n,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:h,matchUpType:U,idPrefix:v,uuids:y,stage:f});if(x.structureId&&j){let Y={linkType:jl,source:{roundNumber:L,structureId:x.structureId},target:{roundNumber:1,feedProfile:So,structureId:j}};W&&x&&W.push(Y),W!=null&&W.length&&w.push(...W)}return G!=null&&G.length&&S.push(...G),H!=null&&H.length&&b.push(...H),{structureId:j,childLinks:W,structures:S}}}function YL({drawDefinition:t,matchUpsMap:e,structureId:i}){let r=et({drawDefinition:t,structureId:i});if(r.error)return ee({result:r});let{matchUps:n}=$t({structure:r.structure,matchUpsMap:e});return{...Pn({matchUps:n}),matchUps:n,matchUpsMap:e}}function mV({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=YL({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(VJ(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{W0e({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function W0e({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((n,a)=>n||isNaN(a),!1))return!1;let[i,r]=e;return Ee(i,(r||i)+1).includes(t)}function VJ(t){var e,i;return[ht(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),ht(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function q0e(t){return VJ(t).map(e=>Ee(e[0],e[1]&&e[1]+1||e[0]+1))}function Dv({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:oe,context:{structureIds:e}};if(!t)return{error:Ce};e=e??(t.structures??[]).filter(a=>a.stage!==qe).map(({structureId:a})=>a);let r=e.map(a=>{var o;let{roundProfile:s}=YL({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(q0e).flat()}).flat(),n=r.filter(a=>(a==null?void 0:a.length)===1).sort(sr).flat();return{positionsNotPlayedOff:ht(r.flat()).filter(a=>!n.includes(a)),positionsPlayedOff:n}}function jJ({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:r}){if(!i)return{error:Ce};if(!r)return{error:La};if(!e)return{error:Ve,info:"missing playoffPositions"};let n=Dv({drawDefinition:i});if(n.error)return n;let a=n.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=mV({finishingPositions:o,drawDefinition:i,structureId:r}),l=Object.values(s).reduce((v,I)=>v.includes(I.roundNumber)?v:v.concat(I.roundNumber),[]).map(v=>Xe(v)).filter(v=>!t.includes(v)),c=mV({finishingPositions:a,drawDefinition:i,structureId:r}),u=c?Object.values(c):[],d=c?u.reduce((v,I)=>v.includes(I.roundNumber)?v:v.concat(I.roundNumber),[]).map(v=>Xe(v)):[],p=l.filter(v=>!d.includes(v)).sort(sr),{roundProfile:m}=YL({drawDefinition:i,structureId:r}),h=p.map(v=>{let I=m==null?void 0:m[v].finishingPositionRange.loser,[y,b]=I??[0,0];return Ee(y,(b||y)+1)}).flat().sort(sr),{playoffRoundsRanges:f}=Y0e({playoffSourceRounds:p,roundProfile:m}),g=[...p,...d];return{playoffPositionsReturned:h,playedOffSourceRounds:d,playoffRoundsRanges:f,playoffSourceRounds:p,sourceRounds:g,roundProfile:m}}function Y0e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let r=e[i].finishingPositionRange.loser,[n,a]=r,o=Ee(n,(a||n)+1);return{finishingPositionRange:r.join("-"),finishingPositions:o,roundNumber:i}})}}function Bw({drawDefinition:t,structureId:e}){if(!t)return{error:Ce};let{matchUps:i,matchUpsMap:r}=Nn({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:n,positionsPlayedOff:a}=Dv({drawDefinition:t,matchUpsMap:r}),{structures:o}=zl({drawDefinition:t}),s=o.filter(c=>!e&&c.stage!==Mr||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=K0e({playoffPositions:n,drawDefinition:t,structure:c,matchUps:i}),{error:p,...m}=d;if(p)return d;l[u]={structureId:u,...m}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function K0e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:r}){var n,a,o,s,l,c,u,d,p;let m=i==null?void 0:i.structureId,{links:h}=bv({drawDefinition:e,structureId:m});if(i.structureType===Cn||i.structures){let w=(a=(n=ei({structure:i}))==null?void 0:n.positionAssignments)==null?void 0:a.length,U=i.structures.length,T=(w??0)/U,P=((o=h.source)==null?void 0:o.flatMap(({source:x})=>(x==null?void 0:x.finishingPositions)||[]))||[],R=Ee(1,T+1).filter(x=>!P.includes(x)),D=((l=(s=r.find(x=>x.containerStructureId===m&&x.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],E=h==null?void 0:h.source.map(({target:x})=>x.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:A=[]}=Dv({structureIds:E,drawDefinition:e}),M=[...N,...A],C=Ee(D[0],D[1]+1).filter(x=>!M.includes(x)),O=xr(C,C.length/R.length),k=R.map((x,F)=>{let $=O[F],_=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:x,finishingPositions:$,finishingPositionRange:_}});return{positionsNotPlayedOff:C,playoffFinishingPositionRanges:k,finishingPositionsAvailable:R,finishingPositionsPlayedOff:P,positionsPlayedOff:N,groupCount:U,groupSize:T}}let f=((c=h==null?void 0:h.source)==null?void 0:c.filter(w=>w.linkCondition!==Gl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],g=((u=h==null?void 0:h.source)==null?void 0:u.filter(w=>w.linkCondition===Gl).map(w=>{var U;return(U=w.source)==null?void 0:U.roundNumber}))||[],v=jJ({excludeRoundNumbers:f,playoffPositions:t,drawDefinition:e,structureId:m}),I=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,y=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:b,error:S}=v;for(let w of g){let U=h==null?void 0:h.source.find(E=>E.source.roundNumber===w),T=U==null?void 0:U.target.roundNumber,P=U==null?void 0:U.target.structureId,R=r.filter(({roundNumber:E,structureId:N})=>N===P&&E===T),D=R.filter(({sides:E})=>E.find(N=>N.participantFed&&!N.participantId)).length;if(I&&D===R.length){I.push(w);let E=(p=(d=b==null?void 0:b[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(E){let N=Math.min(...E),A=N+D,M=Ee(N,A),C={finishingPositionRange:[N,A-1].join("-"),finishingPositions:M,roundNumber:w};y.push(C)}}}return I&&I.sort(sr),y.sort((w,U)=>w.roundNumber-U.roundNumber),{playoffRounds:I,playoffRoundsRanges:y,error:S}}function J0e({playoffGroups:t,drawDefinition:e,structureId:i}){var r,n;if(!e)return{error:Ce};if(typeof i!="string"||!Array.isArray(t))return{error:oe};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(n=(r=Bw({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>a.includes(o.finishingPosition)))==null?void 0:n.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function GJ(t){var e,i;let{finishingPositionOffset:r=0,playoffAttributes:n,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=Oe,matchUpType:c,structureId:u,idPrefix:d,drawSize:p,isMock:m,uuids:h}=t,f={finishingPositionOffset:r,matchUpType:c,drawSize:p,idPrefix:d,isMock:m,uuids:h},{matchUps:g}=o?Vc(f):tl(f),v=Ya({structureName:s||((e=n==null?void 0:n[0])==null?void 0:e.name)||zr(Oe),structureId:u||(h==null?void 0:h.pop()),stageSequence:a,matchUpType:c,matchUps:g,stage:l}),I=[v],y=[];if(p>2){let b=p/2,{matchUps:S}=tl({finishingPositionOffset:r+b,idPrefix:d&&`${d}-c`,drawSize:b,matchUpType:c,isMock:m}),w=zr(Yr),U=((i=n==null?void 0:n["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),T=Ya({structureName:U,matchUps:S,structureId:h==null?void 0:h.pop(),stage:Yr,stageSequence:1,matchUpType:c});I.push(T);let P={linkType:jl,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:So,structureId:T.structureId}};y.push(P)}return{...Z,structures:I,links:y}}function HJ({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:r,feedPolicy:n,fmlc:a}){let o=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(n==null?void 0:n.roundGroupedOrder)||[],l=n==null?void 0:n.roundFeedProfiles;return Ee(1+e,r+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?So:Jd,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:jl,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},m=s[c-1];return m&&(p.target.groupedOrder=m),no()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=Gl,p.target.feedProfile=So),o.includes(d)?p:void 0}).filter(Boolean)}function zJ(t){var e,i;let{playoffStructureNameBase:r,finishingPositionOffset:n,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:c=Oe,matchUpType:u,structureId:d,drawSize:p,idPrefix:m,isMock:h,uuids:f}=t,g={finishingPositionOffset:n,matchUpType:u,drawSize:p,idPrefix:m,isMock:h,uuids:f},{matchUps:v,roundsCount:I}=l?Vc(g):tl(g),y=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??zr(Oe),b=wc({structureId:d||(f==null?void 0:f.pop()),structureName:y,stageSequence:a,matchUpType:u,matchUps:v,stage:c}),S=[b],w=[];if(p>2){let U=[0,2].slice(0,p/16).map((T,P)=>{let R=P+1,{consolationStructure:D}=X0e({idPrefix:m&&`${m}-c${P}`,structureId:f==null?void 0:f.pop(),playoffStructureNameBase:r,playoffAttributes:o,structureNameMap:s,stageSequence:R,roundOffset:T,matchUpType:u,drawSize:p,isMock:h,index:P,uuids:f});S.push(D);let E=HJ({consolationStructure:D,roundsCount:2,mainStructure:b,roundOffset:T});return{consolationStructure:D,links:E}}).map(T=>T.links).flat();if(w.push(...U),p>=4&&p<=16||p>32){let{matchUps:T}=tl({idPrefix:m&&`${m}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:u,isMock:h}),P=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??zr(Fi),R=(s==null?void 0:s[P])||P,D=r?`${r} ${R}`:R,E=wc({structureId:f==null?void 0:f.pop(),matchUps:T,stageSequence:2,stage:Fi,structureName:D,matchUpType:u}),N={linkType:jl,source:{roundNumber:I-1,structureId:b.structureId},target:{structureId:E.structureId,feedProfile:So,roundNumber:1}};S.push(E),w.push(N)}}return{structures:S,links:w,...Z}}function X0e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:r,roundOffset:n=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var p,m;let h=l/(2*Math.pow(2,n)),{matchUps:f,roundsCount:g}=Vc({finishingPositionOffset:h,baseDrawSize:h,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:c,uuids:d}),v=u===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||u===1&&((m=i==null?void 0:i["0-3"])==null?void 0:m.name)||`${zr(Yr)} ${u+1}`,I=(r==null?void 0:r[v])||v,y=t?`${t} ${I}`:I;return{consolationStructure:wc({matchUps:f,stage:Yr,structureName:y,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function Gp(t){var e,i,r,n;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:c,structureName:u,stage:d=Oe,structureId:p,matchUpType:m,skipRounds:h,feedRounds:f,idPrefix:g,drawSize:v,isMock:I,uuids:y,fmlc:b}=t,S=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[Xf])||((i=t.appliedPolicies)==null?void 0:i[Xf]),w={finishingPositionOffset:a,matchUpType:m,skipRounds:h,drawSize:v,idPrefix:g,isMock:I,uuids:y},{matchUps:U}=c?Vc(w):tl(w),T=Ya({structureName:u||((r=s==null?void 0:s[0])==null?void 0:r.name)||zr(Oe),structureId:p||(y==null?void 0:y.pop()),stageSequence:o,matchUpType:m,matchUps:U,stage:d}),P=[T],R=[],D=v/2,{matchUps:E,roundsCount:N}=Vc({finishingPositionOffset:D,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:D,matchUpType:m,feedRounds:f,skipRounds:h,isMock:I,uuids:y,fmlc:b});if(v>2){let A=((n=s==null?void 0:s["0-1"])==null?void 0:n.name)??zr(Yr),M=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${A}`:A,C=Ya({matchUps:E,structureId:y==null?void 0:y.pop(),stage:Yr,stageSequence:1,structureName:M,matchUpType:m});P.push(C);let O=HJ({consolationStructure:C,mainStructure:T,roundsCount:N,feedPolicy:S,fmlc:b});R.push(...O)}return{...Z,structures:P,links:R}}function WJ({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:r,policyDefinitions:n,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:m}){var h,f,g,v,I,y;c=c||(n==null?void 0:n[Xf]);let b="processPlayoffGroups",S=0,w=[],U=[],T=[],{error:P,positionRangeMap:R}=J0e({structureId:r,drawDefinition:o,playoffGroups:s});if(P)return ee({result:{error:P},stack:b});if(!(!R||s!=null&&s.every(D=>{let{finishingPositions:E=[]}=D;if(!E.length)return!1;let N=[...E].sort(sr).map((A,M)=>(E[M+1]||A)-A).every(A=>A<2);return(!t||N)&&E.every(A=>R[A])})))return ee({context:{validFinishingPositions:Object.values(R)},result:{error:oe},stack:b});for(let D of s){let E=D.finishingPositions,N=R&&E.map($=>{var _;return(_=R[$])==null?void 0:_.finishingPositions}).flat(),A=u*E.length,M=sv(A),C=M===2&&Bs||D.drawType||Bs;N&&(S=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,k=D.structureName||O&&((f=(h=D.playoffAttributes)==null?void 0:h[O])==null?void 0:f.name)||((v=(g=D.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),x={addNameBaseToAttributeName:D.addNameBaseToAttributeName,playoffStructureNameBase:D.playoffStructureNameBase,finishingPositionNaming:D.finishingPositionNaming,finishingPositionLimit:D.finishingPositionLimit,structureId:D.structureId??(m==null?void 0:m.pop()),playoffAttributes:D.playoffAttributes,structureNameMap:D.structureNameMap,sequenceLimit:D.sequenceLimit,structureName:k,idPrefix:d&&`${d}-po`,appliedPolicies:n,finishingPositionOffset:S,stage:Fi,stageSequence:a,matchUpType:l,drawSize:M,isMock:p,uuids:m},F=({playoffStructures:$,playoffLinks:_})=>{let[L]=$,B=BU({playoffStructureId:L.structureId,finishingPositions:E,sourceStructureId:r});T.push(B),T.push(..._),U.push(...$),w.push({structureId:L.structureId,finishingPositions:E}),S+=A};if(C===Bs){let{matchUps:$}=tl({finishingPositionLimit:S+A,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,matchUpType:l,drawSize:M,isMock:p,uuids:m}),_=Ya({structureId:D.structureId??(m==null?void 0:m.pop()),matchUpFormat:e,stage:Fi,structureName:k,stageSequence:a,matchUps:$});U.push(_);let L=BU({playoffStructureId:_.structureId,finishingPositions:E,sourceStructureId:r});T.push(L),S+=A,w.push({structureId:_.structureId,finishingPositions:E})}else if([eg,tg,Fi].includes(C)){let $={playoffAttributes:D.playoffAttributes??i,playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(m==null?void 0:m.pop()),structureName:D.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:S,stage:Fi,roundOffset:0,stageSequence:a,drawSize:M,isMock:p,uuids:m};C===eg?Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??zF,roundOffsetLimit:3}):C===tg&&Object.assign($,{playoffAttributes:(D==null?void 0:D.playoffAttributes)??i??WF,roundOffsetLimit:2});let _=ff($);if(_.error)return _;if((I=_.links)!=null&&I.length&&T.push(..._.links),(y=_.structures)!=null&&y.length&&U.push(..._.structures),U.sort(Rh),_.structureId){let L=BU({playoffStructureId:_.structureId,finishingPositions:E,sourceStructureId:r});T.push(L),w.push({structureId:_.structureId,finishingPositions:E})}S+=A}else if([ig,dw,sy,oy,ay,ly].includes(C)){let $=[m==null?void 0:m.pop(),m==null?void 0:m.pop()],_={playoffStructureNameBase:D.playoffStructureNameBase,structureId:D.structureId??(m==null?void 0:m.pop()),playoffAttributes:D.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:S,uuids:$,stage:Fi,structureName:k,matchUpType:l,feedPolicy:c,drawSize:M,isMock:p},L={[ig]:{fmlc:!0,feedRounds:1},[ly]:{feedRounds:1},[sy]:{feedsFromFinal:3},[oy]:{feedsFromFinal:2},[ay]:{feedsFromFinal:1}};Object.assign(_,L[C]||{});let{structures:B,links:V}=Gp(_),[G]=B,j=BU({playoffStructureId:G.structureId,finishingPositions:E,sourceStructureId:r});T.push(j),T.push(...V),U.push(...B),w.push({structureId:G.structureId,finishingPositions:E}),S+=A}else if([_o].includes(C)){let{structures:$,links:_}=kw({...x,structureOptions:D.structureOptions||{groupSize:4}});F({playoffStructures:$,playoffLinks:_})}else if([cw].includes(C)){let{structures:$,links:_}=GJ(x);F({playoffStructures:$,playoffLinks:_})}else if([lUe].includes(C)){let{structures:$,links:_}=zJ(x);F({playoffStructures:$,playoffLinks:_})}else if([Lo].includes(C)){let $=Ya({structureId:D.structureId??(m==null?void 0:m.pop()),structureName:D.structureName,finishingPosition:wS,stage:Fi,stageSequence:a,matchUps:[]});F({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:R,structures:U,links:T}}function BU({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Eu,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:rs,roundNumber:1}}}function Vw({matchUp:t,tieFormat:e,isMock:i,uuids:r}){let{collectionDefinitions:n}=e??{};return{tieMatchUps:(n??[]).map(a=>jw({matchUp:t,collectionDefinition:a,uuids:r,isMock:i})).filter(Boolean).flat()}}function jw({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:r,isMock:n,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??o??0,d=p=>{if(!n&&!(r!=null&&r.isMock))return(a==null?void 0:a.pop())??Yt();let m=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${r==null?void 0:r.matchUpId}-${m}-TMU-${p+1}`};return Ee(0,u).map(p=>{let m=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:zi,collectionPosition:m,collectionId:l,processCodes:c,matchUpType:s,isMock:n}})}function Z0e(t){var e,i,r;let n="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ee({result:{error:Ve},info:"playoffGroups required",stack:n});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:c,groupCount:u,groupSize:d,event:p}=t,{structures:m=[],links:h=[],finishingPositionTargets:f,positionRangeMap:g,error:v}=WJ({requireSequential:o,sourceStructureId:a,playoffGroups:c,groupCount:u,groupSize:d,...t});if(v)return{error:v};let I=f==null?void 0:f.map(({finishingPositions:D})=>D).flat().map(D=>g[D].finishingPositions).flat();l.structures.push(...m),l.links.push(...h);let{matchUps:y,matchUpsMap:b}=cr({inContext:!0,drawDefinition:l}),S=m.map(({structureId:D})=>D),w=y==null?void 0:y.filter(({structureId:D})=>S.includes(D)).map(wr),U=(e=b==null?void 0:b.drawMatchUps)==null?void 0:e.filter(({matchUpId:D})=>w==null?void 0:w.includes(D));if(U!=null&&U.length){let D=(i=cn({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;D&&U.forEach(E=>{let{tieMatchUps:N}=Vw({isMock:t.isMock,tieFormat:D,matchUp:E});Object.assign(E,{tieMatchUps:N,matchUpType:Zs})})}let{positionAssignments:T}=ei({structureId:a,drawDefinition:l}),P={};T==null||T.forEach(D=>{var E,N,A;let M=(A=(N=(E=ft({element:D,name:xc}))==null?void 0:E.extension)==null?void 0:N.value)==null?void 0:A.groupOrder;M&&(P[M]||(P[M]=[]),P[M].push(D.participantId))});let R=_w({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return R.error&&((r=R.error)==null?void 0:r.code)!==Bx.code?ee({result:R,stack:n}):{structures:m,links:h,positionsPlayedOff:I,drawDefinition:l,...Z}}var Ka="SET3-S:6/TB7",Q0e="SET3-S:6NOAD",qJ="SET3-S:6/TB7-F:TB10",eTe="SET3-S:4/TB7",tTe="SET3-S:4/TB5@3",iTe="SET1-S:T20",rTe="SET1-S:8/TB7",nTe="SET1-S:8/TB7@7",aTe={FORMAT_STANDARD:Ka,FORMAT_STANDARD_NOAD:Q0e,FORMAT_ATP_DOUBLES:qJ,FORMAT_SHORT_SETS:eTe,FORMAT_FAST4:tTe,FORMAT_PRO_SET:rTe,FORMAT_COLLEGE_PRO_SET:nTe,TIMED20:iTe};function KL({winningSide:t,matchUpFormat:e=Ka,matchUpStatus:i,tallyPolicy:r,score:n}){let a=[0,0],o=n==null?void 0:n.sets,s=typeof t=="number"&&t-1,l=_n(e),c=JL((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Ot&&r!=null&&r.setsCreditForDefaults||i===jt&&r!=null&&r.setsCreditForWalkovers))a[s]=c;else for(let u of o||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof s=="number"&&i===dn&&(+a[1-s]===c&&(a[1-s]-=1),r!=null&&r.setsCreditForRetirements&&(a[s]=c)),a}function YJ({matchUpFormat:t=Ka,winningSide:e,matchUpStatus:i,tallyPolicy:r,score:n}){var a,o;let{sets:s}=n||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,c=_n(t),u=(c==null?void 0:c.bestOf)??1,d=JL(u),p=((a=c==null?void 0:c.setFormat)==null?void 0:a.tiebreakAt)||0,m=[[],[]];if(typeof l=="number"&&(i===Ot&&r!=null&&r.gamesCreditForDefaults||i===jt&&r!=null&&r.gamesCreditForWalkovers)){let h=((o=c==null?void 0:c.setFormat)==null?void 0:o.setTo)||0,f=d*h;m[l].push(f)}else s.forEach((h,f)=>{var g;let v=(h.setNumber||f+1)>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",I=(g=c==null?void 0:c[v])==null?void 0:g.based,y=c==null?void 0:c[v].tiebreakSet,{side1Score:b,side2Score:S}=h;hV(I)&&(m[0].push(Xe(b||0)),m[1].push(Xe(S||0))),y&&h.winningSide&&(r==null?void 0:r.gamesCreditForTiebreakSets)!==!1&&m[h.winningSide-1].push(1)});if(i===dn&&typeof l=="number"){let h=s.length>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",f=c==null?void 0:c[h];if(hV(f.based)){let g=(f==null?void 0:f.setTo)||0,v=y=>{if(!(!c||y===""))return+y===p-1||+y===p?Xe(p||0)+1:+y<p?g:p},I=KL({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:r});if(m.map(y=>y[l]<=y[1-l]).reduce((y,b)=>y+(b?1:0),0)>I[1-l]){let y=m[l].length,b=v(m[1-l][y-1]);b&&(m[l][y-1]=b)}d>m[l].length&&r!=null&&r.gamesCreditForRetirements&&m[l].push(g)}}return[m[0].reduce((h,f)=>h+f,0),m[1].reduce((h,f)=>h+f,0)]}function KJ({matchUpFormat:t,score:e}){var i;let r=t?_n(t):void 0,n=(r==null?void 0:r.bestOf)??1,a=JL(n),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,c)=>{var u;let d=(l.setNumber||c+1)>a&&r!=null&&r.finalSetFormat?"finalSetFormat":"setFormat",p=(u=r==null?void 0:r[d])==null?void 0:u.based;if(JJ(p)){let{side1Score:m,side2Score:h}=l;m&&(s[0]+=Xe(m||0)),h&&(s[1]+=Xe(h||0))}else l.side1TiebreakScore&&(s[0]+=Xe(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=Xe(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function JL(t){return t&&Math.ceil(t/2)||1}function JJ(t){return t==="P"}function hV(t){return!JJ(t)}function oTe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:n}){var a;let o=e&&_n(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,c=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,m=i!=null&&i.groupTotalSetsPlayed?n:r*(l||0)||d+p,h=Math.round(d/m*1e3)/1e3;(h===1/0||isNaN(h))&&(h=m);let f=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=f+g,I=Math.round(f/v*1e3)/1e3;(I===1/0||isNaN(I))&&(I=f);let y=t[u].matchUpsWon,b=t[u].matchUpsLost,S=y+b,w=Math.round(y/S*1e3)/1e3;(w===1/0||isNaN(w))&&(w=y);let U=t[u].gamesWon||0,T=t[u].gamesLost||0,P=(r||0)*(l||0)*(c||0),R=Math.max(P,U+T),D=Math.round(U/R*1e3)/1e3;(D===1/0||isNaN(D))&&(D=0);let E=Math.round(t[u].pointsWon/t[u].pointsLost*1e3)/1e3;(E===1/0||isNaN(E))&&(E=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=h,t[u].tieMatchUpsWon=f,t[u].tieMatchUpsPct=I,t[u].matchUpsPct=w,t[u].gamesWon=U,t[u].gamesLost=T,t[u].gamesPct=D,t[u].pointsPct=E,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function Gw({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:r,matchUps:n}){var a,o,s,l,c,u,d;let p={},m=(i==null?void 0:i.excludeMatchUpStatuses)||[],h=n==null?void 0:n.filter(g=>(g.tieMatchUps||!m.includes(g.matchUpStatus))&&(!(t!=null&&t.length)||Hi(t,[lf(g,0),lf(g,1)]).length===2)),f=(a=h==null?void 0:h.flatMap(({score:g,tieMatchUps:v})=>{var I;return v?v.filter(({matchUpStatus:y})=>!m.includes(y)).flatMap(({score:y})=>{var b;return((b=y==null?void 0:y.sets)==null?void 0:b.length)??0}):((I=g==null?void 0:g.sets)==null?void 0:I.length)??0}))==null?void 0:a.reduce((g,v)=>g+v,0);for(let g of h??[]){let{matchUpStatus:v,tieMatchUps:I,tieFormat:y,score:b,winningSide:S,sides:w}=g,U=y&&g._disableAutoCalc&&y.collectionDefinitions.every(({scoreValue:R})=>R),T=S&&sTe(g),P=S&&lTe(g);if(!T&&!P)if(v&&Sr.includes(v)){let R=lf(g,0),D=lf(g,1);R&&(cc(p,R),p[R].matchUpsCancelled+=1),D&&(cc(p,D),p[D].matchUpsCancelled+=1)}else if(I!=null&&I.length){r=0;for(let R of I){if(R.winningSide){let D=(o=w==null?void 0:w.find(({sideNumber:N})=>N===R.winningSide))==null?void 0:o.participantId,E=(s=w==null?void 0:w.find(({sideNumber:N})=>N===R.winningSide))==null?void 0:s.participantId;D&&E&&(cc(p,D),cc(p,E),p[D].tieMatchUpsWon+=1,p[E].tieMatchUpsLost+=1,Bi(Ni)(R.matchUpType)?(p[D].tieSinglesWon+=1,p[E].tieSinglesLost+=1):Bi(ui)(R.matchUpType)&&(p[D].tieDoublesWon+=1,p[E].tieDoublesLost+=1))}fV({score:R.score,manualGamesOverride:U,participantResults:p,sides:w})}}else fV({manualGamesOverride:U,participantResults:p,score:b,sides:w});else if(cc(p,T),cc(p,P),I==null?void 0:I.length){r=0;for(let R of I){let{matchUpType:D}=R,E=Bi(ui)(D),N=Bi(Ni)(D);R.winningSide&&(R.winningSide===S?(T&&(p[T].tieMatchUpsWon+=1,N&&(p[T].tieSinglesWon+=1),E&&(p[T].tieDoublesWon+=1)),P&&(p[P].tieMatchUpsLost+=1,N&&(p[P].tieSinglesLost+=1),E&&(p[P].tieDoublesLost+=1))):R.winningSide!==S&&(P&&(p[P].tieMatchUpsWon+=1,N&&(p[P].tieSinglesWon+=1),E&&(p[P].tieDoublesWon+=1)),T&&(p[T].tieMatchUpsLost+=1,N&&(p[T].tieSinglesLost+=1),E&&(p[T].tieDoublesLost+=1)))),gV({matchUpFormat:R.matchUpFormat,matchUpStatus:R.matchUpStatus,score:R.score,winningParticipantId:T,losingParticipantId:P,participantResults:p,isTieMatchUp:!0,manualGamesOverride:U,tallyPolicy:i,winningSide:S})}XJ({winningParticipantId:T,losingParticipantId:P,participantResults:p,matchUpStatus:v})}else gV({matchUpFormat:g.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:T,manualGamesOverride:U,losingParticipantId:P,participantResults:p,matchUpStatus:v,tallyPolicy:i,winningSide:S,score:b});if(U){let R=(l=w==null?void 0:w.find(({sideNumber:A})=>A===1))==null?void 0:l.participantId,D=(c=w==null?void 0:w.find(({sideNumber:A})=>A===2))==null?void 0:c.participantId;cc(p,R),cc(p,D);let E=(u=b==null?void 0:b.sets)==null?void 0:u.reduce((A,M)=>A+((M==null?void 0:M.side1Score)??0),0),N=(d=b==null?void 0:b.sets)==null?void 0:d.reduce((A,M)=>A+(M.side2Score??0),0);R&&(p[R].gamesWon+=E,p[R].gamesLost+=N),D&&(p[D].gamesWon+=N,p[D].gamesLost+=E)}}return oTe({participantResults:p,matchUpFormat:e,tallyPolicy:i,perPlayer:r,totalSets:f}),{participantResults:p}}function sTe(t){let e=t.winningSide-1;return lf(t,e)}function lTe(t){let e=1-(t.winningSide-1);return lf(t,e)}function lf(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function cc(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function fV({manualGamesOverride:t,participantResults:e,score:i,sides:r}){let{sets:n}=i||{},a=[[],[]],o=[0,0];for(let l of n||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(o[c-1]+=1),a[0].push(Xe(u||0)),a[1].push(Xe(d||0))}let s=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];r.forEach((l,c)=>{let{participantId:u}=l;u&&(cc(e,u),e[u].setsWon+=o[c],e[u].setsLost+=o[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function gV({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:r,matchUpFormat:n,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:l,score:c}){let u=l&&l-1,d=1-u;o||XJ({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:a});let p=KL({matchUpStatus:a,matchUpFormat:n,tallyPolicy:s,winningSide:l,score:c}),m=YJ({matchUpStatus:a,matchUpFormat:n,tallyPolicy:s,winningSide:l,score:c}),{pointsTally:h}=KJ({score:c,matchUpFormat:n});t&&(i[t].setsWon+=p[u],i[t].setsLost+=p[d],r||(i[t].gamesWon+=m[u],i[t].gamesLost+=m[d]),i[t].pointsWon+=h[u],i[t].pointsLost+=h[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[u],r||(i[e].gamesWon+=m[d],i[e].gamesLost+=m[u]),i[e].pointsWon+=h[d],i[e].pointsLost+=h[u])}function XJ({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:r}){e&&(r===jt&&(i[e].walkovers+=1),r===Ot&&(i[e].defaults+=1),r===dn&&(i[e].retirements+=1),[Ot,dn,jt].includes(r)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function uTe({matchUps:t,order:e,report:i}){let r={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(r[o.participantId]=o.participant.participantName)})});let n=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;n.push(u);let d=`Excluded: ${c}`;n.push(d)}else{let c=(f,g)=>parseFloat(a.reversed?f:g)-parseFloat(a.reversed?g:f),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=f=>{f.groups&&Object.keys(f.groups).sort(c).forEach(g=>{let v=f.groups[g].map(y=>r[y]).join(", "),I=`${g} ${f.attribute}: ${v}`;n.push(I)})},p=a.reversed?" in reverse order":"",m=a.groups?"grouped":"separated",h=`Step ${o+1}: ${u} particiants were ${m}${p} by ${a.attribute}`;if(n.push(h),a.idsFilter){let f=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;n.push(f)}d(a)}n.push("----------------------")}),n.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;n.push(`${l}: ${r[o]} => resolved: ${!!s}`)}),n.join(`\r
`)}function ZJ({participantResults:t,participantIds:e,attribute:i}){return QJ({participantResults:t,participantIds:e}).reduce((r,n)=>{let{participantId:a,results:o}=n,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(r[s]?r[s].push(a):r[s]=[a]),r},{})}function QJ(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,r)=>(e.push({participantId:i,i:r,results:t.participantResults[i]}),e),[])}var cTe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],zE={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function vV(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:r,tallyPolicy:n}=t,a=[];if(e&&!dTe(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(n==null?void 0:n.groupOrderKey)?n.groupOrderKey:"matchUpsWon",s=ZJ({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(h=>parseFloat(h)).sort((h,f)=>f-h).map(h=>s[h]).map(h=>{let f=eX({participantIds:h,...t});return a.push(...f.report??[]),f.order}).flat(1/0),c=1,u;l.forEach((h,f)=>{f&&(h.resolved||u&&!h.resolved)&&(c+=1),u=h.resolved,h.resolved?(h.position=f+1,c=h.position):h.position=c});let d=l.map(({position:h})=>h),p=fa(d);return l.forEach(h=>{let{participantId:f,position:g}=h||{},v=i[f];h.GEMscore=m(v);let I=p[g];(h==null?void 0:h.position)!==void 0&&(I>1&&(h.ties=I,r&&(h.subOrder=r[f])),h.rankOrder=g,h.groupOrder=g+(h.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function m(h){return(Array.isArray(n==null?void 0:n.GEMscore)?Object.keys(zE).filter(f=>n.GEMscore.includes(f)):Object.keys(zE)).map(f=>(h[f]||0)*Math.pow(10,zE[f].toFixed(3))).reduce((f,g)=>f+g,0)}}function dTe({participantResults:t,participantsCount:e}){let i=QJ({participantResults:t}).filter(r=>e-1===r.results.matchUpsWon+r.results.matchUpsLost+r.results.matchUpsCancelled);return e===i.length}function pTe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:r,attribute:n,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=Gw({participantIds:a&&e,matchUpFormat:i,tallyPolicy:r,matchUps:o}),c=ZJ({participantResults:l,participantIds:e,attribute:n}),u=[{attribute:n,reversed:s,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,m)=>s?p-m:m-p).map(p=>c[p]).map(p=>{let m=eX({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:r,matchUps:o});return u.push(...m.report??[]),m.order}).flat(1/0)),{order:d,report:u}}function eX({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:r,tallyPolicy:n,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(n!=null&&n.headToHead)||!n.headToHead.disabled&&!e)){let u=mTe({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[u],headToHeadWinner:d,report:s}}}let c=((n==null?void 0:n.tallyDirectives)||cTe).filter(u=>{let d=!(ki(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||o.push(u),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:m})=>(l=pTe({disableHeadToHead:m,participantIds:i,matchUpFormat:r,tallyPolicy:n,attribute:u,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function mTe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function Pv({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:r=[],subOrderMap:n,perPlayer:a}){if(!(r!=null&&r.length)||!po(r))return{error:Xl};let o=ht(r.map(({structureId:y})=>y));if(o.length!==1)return ee({result:{error:oe,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let s=r.filter(y=>y&&y.matchUpStatus!==Ft),l=s.length&&ht(s.map(({drawPositions:y})=>y).flat()).length,c=s.filter(y=>Md({matchUp:y})).length===s.length;c||(a=0);let u=r.every(({matchUpType:y,tieMatchUps:b})=>y===di&&(b==null?void 0:b.every(S=>Md({matchUp:S})))),d=t==null?void 0:t[AF],p=r.filter(y=>Md({matchUp:y})||y.matchUpType===di),{participantResults:m}=Gw({matchUps:p,matchUpFormat:i,tallyPolicy:d,perPlayer:a}),h,f,{groupOrder:g,report:v}=vV({matchUps:p,participantResults:m,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:n});if(c&&g)h=v,f=g,g.forEach(y=>{let{participantId:b,groupOrder:S,rankOrder:w,subOrder:U,ties:T,GEMscore:P}=y,R=m[b];Object.assign(R,{groupOrder:S,rankOrder:w,GEMscore:P,subOrder:U,ties:T})});else{let{groupOrder:y,report:b}=vV({requireCompletion:!1,participantResults:m,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:n,matchUps:r});h=b,f=y,y&&y.forEach(S=>{let{participantId:w,groupOrder:U,GEMscore:T}=S,P=m[w];Object.assign(P,{provisionalOrder:U,GEMscore:T})})}let I={completedTieMatchUps:u,readableReport:"",participantResults:m,bracketComplete:c,order:[],report:h};if((c||u)&&(I.order=f),e||no({tally:!0})){let y=uTe({matchUps:r,report:h,order:f});no({tally:!0})&&console.log(y),I.readableReport=y}return I}function tX({positionAssignments:t}){let e=(t||[]).filter(ga(Ll)).map(n=>{let{extension:a}=ft({element:n,name:Qf}),o=Xe(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:n.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:n})=>n),r=fa(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:n})=>r[n]===1).map(({participantId:n,subOrder:a})=>({[n]:a})))}}function XL({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:r,matchUps:n,event:a}){if(!po(n))return{error:oe};if(!t)return{error:oe};let{policyDefinitions:o}=Ju({policyTypes:[AF],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=tX({positionAssignments:t}),l=n.length?Pv({policyDefinitions:o,matchUpFormat:r,subOrderMap:s,matchUps:n}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(m=>{let{participantId:h}=m;if(p.includes(h)){let f={value:c[h],name:xc};Mt({element:m,extension:f}),c[h].ties||In({element:m,name:Qf})}else In({element:m,name:xc}),In({element:m,name:Qf})}),pi({drawDefinition:i}),{...Z,participantResults:c,bracketComplete:u,report:d}}function iX({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function gi({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:r,drawDefinition:n,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:c}){if(!n)return{error:Ce};if(!o)return{error:Xr};if(typeof o!="string")return{error:oe};let{structures:u=[]}=zl({drawDefinition:n});r&&!i&&(i=Zu({contextProfile:r,drawDefinition:n}));for(let d of u){let{matchUps:p}=$t({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:n,contextProfile:r,matchUpsMap:a,inContext:s,structure:d,context:l,event:c}),{matchUp:m}=iX({matchUps:p,matchUpId:o});if(m)return{matchUp:m,structure:d}}return{error:an}}function iR(t){var e;return typeof t!="object"?{error:Ve}:typeof t.element!="object"?{error:oe}:t.notes?typeof t.notes!="string"&&!((e=t.notes)!=null&&e.testing)?{error:oe}:(Object.assign(t.element,{notes:t.notes}),{...Z}):{error:Ve}}function rX(t){return typeof t!="object"?{error:Ve}:typeof t.element!="object"?{error:oe}:(t.element.notes&&delete t.element.notes,{...Z})}var rR={matchUpStatus:zi,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Vs(t){var e,i,r,n,a,o,s,l;let c="modifyMatchUpScore",u=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:m,removeWinningSide:h,tournamentRecord:f,drawDefinition:g,matchUpStatus:v,removeScore:I,winningSide:y,matchUpId:b,event:S,notes:w,score:U}=t,T=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Gt({policyTypes:[Vl],tournamentRecord:f,drawDefinition:g,structure:p,event:S}))==null?void 0:e.appliedPolicies,P=d.matchUpType===di;if(P&&g){if(b&&d.matchUpId!==b){let C=gi({drawDefinition:g,matchUpId:b,event:S});if(!C.matchUp)return{error:an};({matchUp:d,structure:p}=C)}}else d.matchUpId!==b&&console.log("!!!!!");v&&[jt,ir].includes(v)||I?Object.assign(d,{...rR}):U&&(d.score=U);let R=v&&(d==null?void 0:d.matchUpStatus)===Ot&&v!==Ot;v&&(d.matchUpStatus=v),u&&(d.matchUpFormat=u),m&&(d.matchUpStatusCodes=m),y&&(d.winningSide=y),h&&(d.winningSide=void 0),!p&&g&&({structure:p}=gi({drawDefinition:g,matchUpId:b,event:S})),v&&!d.winningSide&&_r(d)&&!Sr.includes(v)&&![Dh,ld].includes(v)&&(d.matchUpStatus=Yo);let D;if((R&&(i=d==null?void 0:d.processCodes)!=null&&i.length||v===Ot)&&(D=(n=(r=T==null?void 0:T[Vl])==null?void 0:r.processCodes)==null?void 0:n.incompleteAssignmentsOnDefault),!d.collectionId){let C=(p==null?void 0:p.structureType)===Cn,O=va({structure:p});if(IL({drawDefinition:g,structure:p})||O||C){let k=$=>{u=P?"SET1-S:T100":u??d.matchUpFormat??($==null?void 0:$.matchUpFormat)??(g==null?void 0:g.matchUpFormat)??(S==null?void 0:S.matchUpFormat);let _=P?{matchUpTypes:[di]}:void 0,{matchUps:L}=$t({afterRecoveryTimes:!1,tournamentRecord:f,inContext:!0,matchUpFilters:_,drawDefinition:g,structure:$,event:S});return O&&($.positionAssignments=ht(L.flatMap(B=>(B.sides??[]).map(V=>V.participantId)).filter(Boolean)).map(B=>({participantId:B}))),XL({positionAssignments:$.positionAssignments,tournamentRecord:f,drawDefinition:g,matchUpFormat:u,matchUps:L,event:S})},x=C&&p.structures.find($=>$==null?void 0:$.matchUps.find(_=>_.matchUpId===b)),F=k(x||p);if(F.error)return ee({result:F,stack:c})}}if(w){let C=iR({element:d,notes:w});if(C.error)return ee({result:C,stack:c})}let E=f==null?void 0:f.tournamentId,N=qo().topics.includes($P),A=(N||D)&&Zr({drawDefinition:g}),M=A&&((a=cr({matchUpFilters:{matchUpIds:[b]},nextMatchUps:!0,tournamentRecord:f,inContext:!0,drawDefinition:g,matchUpsMap:A}).matchUps)==null?void 0:a[0]);if(N&&M&&pUe({tournamentId:E,inContextMatchUp:M}),Array.isArray(D)&&M&&!((o=M.sides)!=null&&o.every(({participantId:C})=>C)))if(v===Ot)d.processCodes=ht([...d.processCodes??[],...D]);else for(let C of D||[]){let O=C&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(C));(l=d==null?void 0:d.processCodes)==null||l.splice(O,1)}return Et({eventId:S==null?void 0:S.eventId,context:c,drawDefinition:g,tournamentId:E,matchUp:d}),{...Z}}function ZL(t){let{dualWinningSideChange:e,matchUpStatusCodes:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=Cw({matchUpStatus:r})||[Yu,Ca].includes(r)&&e,s="attemptToModifyScore",l=!!a.collectionId,c=va({structure:n});if(!(l||c||hTe({structure:n,matchUp:a})))return{error:qx};let u=[jt].includes(r),d=Vs({...t,matchUpStatusCodes:o&&i||[],matchUpStatus:o&&r||Zi,context:s,removeScore:u});return ee({result:d,stack:s})}function hTe({structure:t,matchUp:e}){var i;let{drawPositions:r}=e,{positionAssignments:n}=Tr({structure:t});return((i=n==null?void 0:n.filter(a=>(r==null?void 0:r.includes(a.drawPosition))&&a.participantId))==null?void 0:i.length)===2}function nX({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(r=>nt(r==null?void 0:r.groupValue)&&(r==null?void 0:r.groupNumber)).map(r=>({[r.groupNumber]:{...r,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(r=>Xe(r));return{groupValueGroups:e,groupValueNumbers:i}}function fTe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:r,tieMatchUps:n}){let a=n.filter(I=>I.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(I=>Sr.includes(I.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:m,scoreValue:h,setValue:f}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(I=>{I.winningSide&&(v[I.winningSide-1]+=1)}),nt(p)?a.forEach(I=>{I.winningSide&&(o[I.winningSide-1]+=p)}):nt(f)?a.forEach(I=>{var y,b;(b=(y=I.score)==null?void 0:y.sets)==null||b.forEach(S=>{S.winningSide&&(o[S.winningSide-1]+=f)})}):nt(h)?a.forEach(I=>{var y,b;(b=(y=I.score)==null?void 0:y.sets)==null||b.forEach(S=>{let{side1TiebreakScore:w=0,side2TiebreakScore:U=0,side1Score:T=0,side2Score:P=0}=S;(I.matchUpStatus===Zi||I.winningSide||S.winningSide)&&(T||P?(o[0]+=T,o[1]+=P):(w||U)&&S.winningSide&&(o[S.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(I=>{if(I.winningSide){let y=I.collectionPosition,b=gTe({collectionDefinition:t,collectionPosition:y});nt(b)&&(o[I.winningSide-1]+=b)}}),nt(d)){let I;if(m!=null&&m.aggregateValue)l&&(nt(p||f||h)&&o[0]!==o[1]?I=o[0]>o[1]?1:2:v[0]!==v[1]&&(I=v[0]>v[1]?1:2));else if(m!=null&&m.valueGoal)I=o.reduce((y,b,S)=>b>=m.valueGoal?S+1:y,0);else{let y=Math.floor(t.matchUpCount/2)+1;I=v.reduce((b,S,w)=>S>=y?w+1:b,0)}I&&(g?i[u].values[I-1]+=d:s[I-1]+=d)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):s.forEach((I,y)=>r[y]+=I||0)}function gTe({collectionDefinition:t,collectionPosition:e}){var i,r;return(r=(i=t.collectionValueProfiles||[])==null?void 0:i.find(n=>n.collectionPosition===e))==null?void 0:r.matchUpValue}function aX({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let n of t){if(typeof n!="object")return i.push(`valueProfile is not type object: ${n}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=n;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let r=t.map(n=>n.collectionPosition);return r.length!==ht(r).length?(i.push("collectionPositions are not unique"),{errors:i}):{...Z}}var vTe="MIXED events can not contain mixed singles or { gender: ANY } collections",ITe="events with { gender: ANY } can not contain MIXED singles collections";function nR(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:r,gender:n}=t;return i&&n&&[li,Si].includes(i)&&i!==n?ee({result:{valid:!1,error:vS},context:{gender:n},stack:e}):i===oa&&(n===Qs||n===oa&&r!==ui)?ee({result:{error:vS,valid:!1},info:vTe,stack:e}):i===Qs&&n===oa&&r!==ui?ee({result:{error:vS,valid:!1},info:ITe,stack:e}):{valid:!0}}function aR(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return yTe(t,e)}function my(t){return!isNaN(Number(t))&&Number(t)}function oX(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function yTe(t,e){var i;let r=my(t.bestOf)||void 0,n=my(t.exactly)||void 0,a=r||n;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return oX(t.setFormat);let o=a&&`${TS}${a}`||"",s=IV(t.setFormat,e),l=s&&`S:${s}`||"",c=IV(t.finalSetFormat,e),u=a&&a>1&&c&&s!==c&&`F:${c}`||"";if(o&&s)return[o,l,u].filter(d=>d).join("-")}function IV(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return oX(t);if(t.tiebreakSet)return yV(t.tiebreakSet);let i=my(t.setTo);if(i){let r=t.NoAD&&bL||"",n=yV(t.tiebreakFormat),a=n&&`/${n}`||"",o=my(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(n!==!1)return`${i}${r}${a}${s}`}}}function yV(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&my(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?bL:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Ia({matchUpFormat:t}){if(typeof t!="string")return!1;let e=_n(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),r=i==null?void 0:i[1],n=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],c=o==null?void 0:o[3];return aR(e,!!(i&&n&&r===a||o&&l&&s===c))===t}var bTe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),wTe=t=>t.filter(Boolean).every(ki);function Hw(t){let e=t.category;if(typeof e!="object")return{error:g0};let{ageCategoryCode:i,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!bTe([i,r,n,s],"string")||!wTe([a,o]))return{error:g0};let c=t.consideredDate??ct(new Date().toLocaleDateString("sv"));if(!Da(c))return{error:Tn};let[u]=c.split("-").slice(0,3).map(x=>parseInt(x)),d=zv(c,-1),[p,m]=d.split("-").slice(1,3).map(x=>parseInt(x)),h=`${qa(p)}-${qa(m)}`,f=zv(c,1),[g,v]=f.split("-").slice(1,3).map(x=>parseInt(x)),I=`${qa(g)}-${qa(v)}`,y=o&&zv(c,-1*365*o),b=a&&zv(c,-1*365*a),S=[],w=x=>!S.includes(x)&&S.push(x);i=i??s;let U=/^([UO]?)(\d{1,2})([UO]?)$/,T=/^C(\d{1,2})-(\d{1,2})$/,P=i==null?void 0:i.includes("-"),R=P&&(i==null?void 0:i.match(T)),D=i==null?void 0:i.match(U),E=(x,F)=>`${x}-${F}`,N=x=>{let F=u-x,$=E(F,I);e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=x-1)},A=x=>{let F=u-x-1,$=E(F,I);e.ageMin&&e.ageMin>x&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>x&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==$&&w(`Invalid submitted ageMinDate: ${n}`),n=$,i&&(e.ageMax&&e.ageMax!==x&&(w(`Invalid submitted ageMax: ${a}`),y=void 0),a=x)},M=x=>{let F=u-x,$=E(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x+1&&(w(`Invalid submitted ageMin: ${o}`),y=void 0),o=x+1)},C=x=>{let F=u-x-1,$=E(F,h);e.ageMaxDate&&e.ageMaxDate!==$&&w(`Invalid submitted ageMaxDate: ${r}`),r=$,i&&(e.ageMin&&e.ageMin!==x&&(w(`Invalid submitted ageMin: ${o}`),y=void 0),o=x)},O=x=>{let[F,$,_]=(x.match(U)||[]).slice(1),L=parseInt($);F==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(L)):F==="O"&&M(L),_==="U"?(e.ageMaxDate&&e.ageMaxDate!==r&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),A(L)):_==="O"&&C(L),r=r??y,n=n??b};if(R){if(r=void 0,n=void 0,a=void 0,o=void 0,e.ageMin){let $=u-e.ageMin;r=E($,h)}if(e.ageMax){let $=u-e.ageMax-1;n=E($,I)}let[x,F]=((i==null?void 0:i.match(T))??[]).slice(1).map($=>parseInt($));x<=F?(o=x,a=F,l=!0):w(`Invalid combined age range ${i}`)}else P?i==null||i.split("-").forEach(O):D?O(i):(o&&M(o),a&&A(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let k=He({consideredDate:c,combinedAge:l,ageMaxDate:r,ageMinDate:n,ageMax:a,ageMin:o});return S.length&&(k.errors=S),k}function L0({category:t}){if(!Ii(t))return{error:oe};let e=Hw({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:r}=t;return i&&!ki(i)?ee({result:{error:oe},context:{ratingMax:i}}):r&&!ki(r)?ee({result:{error:oe},context:{ratingMin:r}}):{...e}}function oR({childCategory:t,withDetails:e,category:i}){let r=L0({category:i}),n=L0({category:t}),a=n.ageMin&&(r.ageMin&&n.ageMin<r.ageMin||r.ageMax&&n.ageMin>r.ageMax),o=n.ageMax&&(r.ageMax&&n.ageMax>r.ageMax||r.ageMin&&n.ageMax<r.ageMin),s=n.ageMinDate&&r.ageMaxDate&&new Date(n.ageMinDate)>new Date(r.ageMaxDate),l=n.ageMaxDate&&r.ageMinDate&&new Date(n.ageMaxDate)<new Date(r.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=He({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!c&&!s&&!l&&!u&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:r,childCategoryDetails:n}),d}function zw({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:r=!0,referenceCategory:n,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ee({result:{errors:l,error:qu},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:m,matchUpFormat:h,matchUpValue:f,matchUpType:g,scoreValue:v,setValue:I,category:y,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof m!="number"&&l.push(`matchUpCount is not type number: ${m}`),g&&!YP([Ni,ui],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([f,d,v,I].map(nt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),f&&typeof f!="number"&&l.push(`matchUpValue is not type number: ${f}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&m){let S=aX({collectionValueProfiles:c,matchUpCount:m});S.errors&&l.push(...S.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),h&&!Ia({matchUpFormat:h})&&l.push(`Invalid matchUpFormat: ${h}`),r){let S=nR({referenceGender:a,matchUpType:g,gender:b});if(S.error)return ee({context:{referenceGender:a,gender:b},result:S,stack:s})}if(t&&n&&y){let S=oR({category:n,childCategory:y});if(!S.valid)return ee({result:{error:g0},context:S,stack:s})}return l.length?ee({result:{errors:l,error:WK},stack:s}):{valid:!0}}function Kn(t){var e,i,r,n;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,c=t==null?void 0:t.event,u="validateTieFormat",d=[];if(!t||!l||typeof l!="object")return d.push("tieFormat must be an object"),ee({result:{error:tu},context:{tieFormat:l,errors:d},stack:u});if(typeof l.winCriteria!="object")return d.push("tieFormat.winCriteria must be an object"),ee({result:{error:tu},context:{tieFormat:l,errors:d},stack:u});if(!Array.isArray(l.collectionDefinitions))return d.push(ql("tieFormat.collectionDefinitions")),ee({result:{error:tu},context:{tieFormat:l,errors:d},stack:u});let p,m=l.collectionDefinitions.every(I=>{let{setValue:y,scoreValue:b,collectionValue:S}=I;(y||b)&&!S&&(p=!0);let{valid:w,errors:U}=zw({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:s,checkCategory:a,checkGender:o,event:c});return w?!0:(Array.isArray(U)&&d.push(...U),!1)}),h=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!p||((r=l.winCriteria)==null?void 0:r.aggregateValue);if(!(h||(n=l.winCriteria)!=null&&n.aggregateValue))return p?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ee({context:{tieFormat:l,errors:d,aggregateValueImperative:p},result:{error:tu},stack:u});let f=l.collectionDefinitions.map(({collectionId:I})=>I),g=!s||f.length===ht(f).length,v=m&&h&&g;return v?{valid:v,errors:d}:ee({result:{error:tu},context:{tieFormat:l,errors:d},stack:u})}function Ww(t){var e,i,r,n,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:c,structure:u,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((P,R)=>P+R)))return{error:oe};if(!d)return{error:Yn};let m=((e=cn({matchUp:d,drawDefinition:l,structure:u,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!m)return{error:Zb};let h=Kn({tieFormat:m});if(h.error)return h;let f=(m==null?void 0:m.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:I,groupValueNumbers:y}=nX(m);for(let P of f)fTe({collectionDefinition:P,groupValueNumbers:y,groupValueGroups:I,sideTieValues:v,tieMatchUps:g});for(let P of y){let R=I[P],{allGroupMatchUpsCompleted:D,matchUpCount:E,winCriteria:N,groupValue:A,sideWins:M,values:C}=R,O;if(N!=null&&N.aggregateValue)D&&C[0]!==C[1]&&(O=C[0]>C[1]?1:2);else if(N!=null&&N.valueGoal)O=C.reduce((k,x,F)=>x>=N.valueGoal?F+1:k,void 0);else{let k=Math.floor(E/2)+1;O=M.reduce((x,F,$)=>F>=k?$+1:x,void 0)}O&&(v[O-1]+=A||0)}let b=v.map((P,R)=>(P||0)+o[R]),S={side1Score:b[0],side2Score:b[1],winningSide:void 0},w=b.join(s),U=b.slice().reverse().join(s),T;if(m!=null&&m.winCriteria){let{valueGoal:P,aggregateValue:R,tallyDirectives:D}=m.winCriteria;if(P?T=(i=b.map((E,N)=>({sideNumber:N+1,points:E})).find(({points:E})=>E>=P))==null?void 0:i.sideNumber:R&&g.every(E=>E.matchUpStatus&&Sr.includes(E.matchUpStatus)||E.winningSide)&&b[0]!==b[1]&&(T=b[0]>b[1]?1:2),!T&&D){let E=d.matchUpId,N=d.hasContext?d:((r=c==null?void 0:c.drawMatchUps)==null?void 0:r[E])||l&&((n=gi({inContext:!0,drawDefinition:l,matchUpId:E}))==null?void 0:n.matchUp);if(N){let{completedTieMatchUps:A,order:M}=Pv({matchUps:[N]});if(A&&M!=null&&M.length){let C=M[0].participantId;T=(a=N.sides.find(({participantId:O})=>O===C))==null?void 0:a.sideNumber}}}}return T&&(S.winningSide=T),{scoreStringSide1:w,scoreStringSide2:U,winningSide:T,set:S}}function qw({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:r,eventId:n}){var a,o;if(r){t||(t=(a=gi({matchUpId:r.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=ft({element:e,name:Pu}),l=Fe((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});r.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(u=>{var d;let p=u.participantId,m=p&&l[p]||void 0,{lineUp:h,...f}=((d=r.sides)==null?void 0:d.find(({sideNumber:v})=>v===u.sideNumber))??{},g=h!=null&&h.length?h:m;return{...c(u),...f,lineUp:g}}),Et({context:"ensureSidLineUps",matchUp:r,drawDefinition:e,tournamentId:i,eventId:n})}}function Vr(t){if(t)return Fe(t,!1,!0)}function QL(t){let e=kt(t,[{[sn]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,r)=>{i.tournamentIdMap[r]=[];let n=t.tournamentRecords[r].events??[],a=n.map(({eventId:s})=>s),o=n.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[r].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function sX({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:r}=QL({tournamentRecords:t});return(r?Object.keys(r):[]).find(n=>e&&(r==null?void 0:r[n].includes(e))||i&&(r==null?void 0:r[n].includes(i)))}function ec(t){var e,i,r,n;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:c,matchUpId:u,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},m=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&sX({tournamentRecords:p,...t});let h=m&&p[m];if(!h)return{error:he};let f=gi({drawDefinition:o,event:d,matchUpId:u});if(f.error)return f;if(!f.matchUp)return{error:an};let{matchUp:g,structure:v}=f;if(!g.tieMatchUps)return{error:kn};qw({tournamentId:h==null?void 0:h.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:I}=ft({name:Zf,element:g});if(I!=null&&I.value)if(l)In({element:g,name:Zf});else return{...Z,score:g.score};let y=(r=cn({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:r.tieFormat;g.tieFormat=Vr(y);let b=Ww({drawDefinition:o,matchUpsMap:c,structure:v,matchUp:g,event:d}),{winningSide:S,set:w,scoreStringSide1:U,scoreStringSide2:T}=b,P=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!P)return{...Z};let R={scoreStringSide1:U,scoreStringSide2:T,sets:w?[w]:[]},D=S&&[1,2].includes(S),E=D&&Zi||TL({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:R})&&Yo||zi,N=!!(g.winningSide&&!D),A=g.tieMatchUps.find(({score:C,winningSide:O,matchUpStatus:k})=>{var x;return((x=C==null?void 0:C.sets)==null?void 0:x.length)&&(C.sets[0].side1Score||C.sets[0].side2Score)||k&&Sr.includes(k)||O}),M;if(g.tieFormat&&!D&&!A){let C=(n=cn({drawDefinition:o,structure:v,event:d}))==null?void 0:n.tieFormat;C&&JSON.stringify(y)===JSON.stringify(C)&&(g.tieFormatId=void 0,g.tieFormat=void 0,M=!0)}return Vs({appliedPolicies:t.appliedPolicies,matchUpStatus:E,score:R,removeWinningSide:N,tournamentRecord:h,drawDefinition:o,removeScore:l,winningSide:S,matchUpId:u,matchUp:g,event:d}),{...Z,score:R,removeWinningSide:N,tieFormatRemoved:M,winningSide:S}}function UTe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:r,winningDrawPosition:n,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var m,h,f,g,v;let I="directWinner";if(o){let y=c.drawPositions||[],b=y[t],S=o.source.structureId,w=et({structureId:S,drawDefinition:l});if(w.error)return w;let{structure:U}=w,{positionAssignments:T}=Tr({structureId:S,drawDefinition:l}),P=(m=T==null?void 0:T.find(M=>M.drawPosition===n))==null?void 0:m.participantId,R=o.target.structureId,{positionAssignments:D}=Tr({structureId:R,drawDefinition:l}),E=(h=D==null?void 0:D.find(M=>M.participantId===P))==null?void 0:h.drawPosition,N=D==null?void 0:D.filter(M=>{let C=y.includes(M.drawPosition),O=!M.participantId&&!M.bye&&!M.qualifier;return C&&O}).map(M=>M.drawPosition),A=N==null?void 0:N.includes(b);if(P&&o.target.roundNumber===1&&A)el({drawPosition:b,participantId:P,structureId:R,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(P&&N!=null&&N.length){let M=N.pop();M&&el({participantId:P,structureId:R,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,drawPosition:M,matchUpsMap:d,event:p})}else if(E){let M=sg({drawPosition:E,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(M.error)return ee({result:M,stack:I})}else if((U==null?void 0:U.stage)!==qe){let M="winner target position unavaiallble";return console.log(M),{error:M}}if(U!=null&&U.seedAssignments&&U.structureId!==R){let M=U.seedAssignments.find(({participantId:O})=>O===P),C=M==null?void 0:M.participantId;M&&C&&Tv({eventId:c==null?void 0:c.eventId,structureId:R,...M,tournamentRecord:a,drawDefinition:l,participantId:C})}}else{let y=sg({matchUpId:c.matchUpId,drawPosition:n,inContextDrawMatchUps:e,sourceMatchUpStatus:r,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(y.error)return y}if(u&&i){let y=(f=u.sides)==null?void 0:f.find(b=>b.sideNumber===i);if(y!=null&&y.lineUp){let b=u.roundPosition,S=c.roundPosition,w=b===S&&b!==1||Math.floor(b/2)===S?2:1,U=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:R})=>R===c.matchUpId),T=[1,2].map(R=>{var D;return{...((D=U.sides)==null?void 0:D.find(E=>E.sideNumber===R))||{},sideNumber:R}});U.sides=T;let P=U.sides.find(R=>R.sideNumber===w);if(P){let R=(v=y.lineUp)==null?void 0:v.filter(D=>D==null?void 0:D.participantId);P.lineUp=_L({lineUp:R}),Et({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:U,context:I,drawDefinition:l})}}}return{...Z}}function STe(t){var e,i,r;let{loserMatchUpDrawPositionIndex:n,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:c,loserTargetLink:u,drawDefinition:d,loserMatchUp:p,dualMatchUp:m,matchUpsMap:h,event:f}=t,g="directLoser",v=u.linkCondition,I=p.drawPositions||[],y=v===Gl&&p.roundNumber===2&&Math.min(...I.filter(Boolean)),b=y||I[n],S=y||I[1-n],w=u.source.structureId,{structure:U}=et({structureId:w,drawDefinition:d}),{matchUps:T}=$t({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:U,event:f}),P=T.filter(L=>{var B;return(B=L.drawPositions)==null?void 0:B.includes(l)}).filter(L=>{let B=L.sides.find(G=>G.drawPosition===l),V=L.matchUpStatus===jt||L.matchUpStatus===Ot&&!_r(L);return(B==null?void 0:B.sideNumber)===L.winningSide&&!V}),R=v===Gl&&P.length===0,{positionAssignments:D}=Tr({structureId:w,drawDefinition:d}),E=(e=D==null?void 0:D.find(L=>L.drawPosition===l))==null?void 0:e.participantId,N=u.target.structureId,{positionAssignments:A}=Tr({structureId:N,drawDefinition:d}),M=A==null?void 0:A.filter(({drawPosition:L})=>I.includes(L));if(M!=null&&M.some(L=>L.participantId===E))return{...Z};let C=M==null?void 0:M.filter(L=>{let B=I.includes(L.drawPosition),V=!L.participantId&&!L.bye&&!L.qualifier;return B&&V}).map(L=>L.drawPosition),O=C==null?void 0:C.includes(b),k=u.target.roundNumber>1&&(C==null?void 0:C.length),x=u.target.roundNumber===1&&O;if(y){let L=F();if(L.error)return ee({result:L,stack:g})}else if(x){let L=_();if(L.error)return ee({result:L,stack:g})}else if(E&&k){C.sort(sr);let L=C[0],B=el({participantId:E,structureId:N,drawPosition:L,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:d,matchUpsMap:h,event:f});if(B.error)return ee({result:B,stack:g})}else return ee({result:{error:ev},context:{loserDrawPosition:l,loserTargetLink:u},stack:g});if(U!=null&&U.seedAssignments&&U.structureId!==N){let L=U.seedAssignments.find(({participantId:V})=>V===E),B=L==null?void 0:L.participantId;L&&B&&Tv({eventId:p==null?void 0:p.eventId,structureId:N,...L,tournamentRecord:c,drawDefinition:d,participantId:B})}if(m&&o){let L=(i=m.sides)==null?void 0:i.find(B=>B.sideNumber===3-o);if(L!=null&&L.lineUp){let{roundNumber:B,eventId:V}=p,{roundPosition:G}=m,j=B===1?2-G%2:1,H=(r=h==null?void 0:h.drawMatchUps)==null?void 0:r.find(({matchUpId:q})=>q===p.matchUpId),W=[1,2].map(q=>{var re;return{...((re=H.sides)==null?void 0:re.find(K=>K.sideNumber===q))||{},sideNumber:q}});H.sides=W;let Y=H.sides.find(q=>q.sideNumber===j);Y&&(Y.lineUp=_L({lineUp:L.lineUp}),Et({tournamentId:c==null?void 0:c.tournamentId,matchUp:H,context:g,drawDefinition:d,eventId:V}))}}return{...Z};function F(){let L="loserLinkFedFMLC";return ee(R?{result:_(),stack:L}:{result:$(),stack:L})}function $(){let L=$a({drawPosition:S,structureId:N,tournamentRecord:c,drawDefinition:d,event:f});return ee({result:L,stack:"assignLoserPositionBye"})}function _(){let L=E?el({drawPosition:b,participantId:E,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:d,matchUpsMap:h,event:f}):{error:vr};return ee({result:L,stack:"assignLoserDrawPosition"})}}function lX(t){var e;let i=ZL(t);if(i.error)return i;let r=Cw({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:m,matchUpId:h,structure:f,matchUp:g,event:v}=t,I="directParticipants",y=!!g.collectionId,b=va({structure:f}),S=g.drawPositions,w;if(y){let{matchUpTieId:U,matchUpsMap:T}=t,P=ec({appliedPolicies:t.appliedPolicies,matchUpId:U,tournamentRecord:s,drawDefinition:l,matchUpsMap:T,event:v});if(w=P&&{tieMatchUpResult:P},S=(e=o.find(({matchUpId:R})=>R===U))==null?void 0:e.drawPositions,!n)return ee({result:{...Z,...w},stack:I})}if(b)return ee({result:{...Z,...w},stack:I});if(S){let U=a?a-1:p-1,T=1-U,P=S[U],R=S[T],{targetLinks:{loserTargetLink:D,winnerTargetLink:E,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:A,loserMatchUpDrawPositionIndex:M,winnerMatchUp:C,loserMatchUp:O,byeMatchUp:k}}=m;if(C){let x=UTe({sourceMatchUpStatus:r&&c||Zi,winnerMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:P,tournamentRecord:s,winnerTargetLink:E,drawDefinition:l,winnerMatchUp:C,dualMatchUp:u,matchUpsMap:d,event:v});if(x.error)return ee({result:x,stack:I})}if(O){let x=STe({sourceMatchUpStatus:r&&c||Zi,loserMatchUpDrawPositionIndex:M,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:R,tournamentRecord:s,loserTargetLink:D,drawDefinition:l,loserMatchUp:O,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:v});if(x.error)return ee({result:x,stack:I})}if(k){let x=k.drawPositions||[],F=Math.min(...x.filter(Boolean)),$=N.target.structureId,_=$a({drawPosition:F,structureId:$,tournamentRecord:s,drawDefinition:l,event:v});if(_.error)return ee({result:_,stack:I})}}else return ee({result:{error:Kb},stack:I});return ee({result:{...Z,...w},stack:I})}function e_(t){var e,i,r,n;let a="genPlayoffStructure";if(!t.drawDefinition)return ee({result:{error:Ce},stack:a});let o=Bw(t);if(o.error)return ee({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionNaming:u,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:m,roundOffsetLimit:h,tournamentRecord:f,exitProfileLimit:g,roundProfiles:v,roundNumbers:I,idPrefix:y,isMock:b,event:S,uuids:w}=t,U=Fe(t.drawDefinition,!1,!0),{structure:T}=et({structureId:s,drawDefinition:U});if(!T)return ee({result:{error:Ri},stack:a});if(T.structureType===Cn||T.structures)return Z0e({sourceStructureId:T.structureId,...t,...o,drawDefinition:U});let{playoffRoundsRanges:P,playoffRounds:R}=o,{playoffPositionsReturned:D,error:E,playoffSourceRounds:N,playoffRoundsRanges:A}=jJ(t);if(E)return ee({result:{error:E},stack:a});let M=(v==null?void 0:v.length)&&Object.assign({},...v),C=I||typeof v=="object"&&v.map(q=>Object.keys(q)).flat(),O=Array.isArray(C)&&C.map(q=>!isNaN(q)&&Xe(q)).filter(Boolean);if(O){if(!Array.isArray(O))return ee({result:{error:oe},context:{validRoundNumbers:O},stack:a});O.forEach(q=>{if(!(R!=null&&R.includes(q)))return ee({result:{error:oe},context:{roundNumber:q},stack:a})})}m&&m.forEach(q=>{if(!(D!=null&&D.includes(q)))return ee({result:{error:oe},context:{playoffPosition:q},stack:a})});let k=O||N,x=O?P:A,F=[],$=[];for(let q of k??[]){let re=x==null?void 0:x.find(ae=>ae.roundNumber===q);if(!re)return ee({result:{error:oe},context:{roundNumber:q},stack:a});let K=re.finishingPositions.length,z=Math.min(...re.finishingPositions)-1,te=2,J=q&&(M==null?void 0:M[q])&&te+M[q]-1,ie=ff({exitProfile:`0-${q}`,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionOffset:z,playoffAttributes:p,exitProfileLimit:g,stage:Fi,roundOffset:0,drawDefinition:U,sequenceLimit:J,stageSequence:te,drawSize:K,idPrefix:y,isMock:b,uuids:w,finishingPositionNaming:u,finishingPositionLimit:d,roundOffsetLimit:h});if(ie.error)return ee({result:ie,stack:a});let{structures:ne,links:ue}=ie;if(ne!=null&&ne.length&&F.push(...ne),ue!=null&&ue.length&&$.push(...ue),ie.structureId&&q){let ae={linkType:jl,source:{structureId:s,roundNumber:q},target:{structureId:ie.structureId,feedProfile:So,roundNumber:1}};$.push(ae)}}if(!F.length)return ee({result:{error:oe},info:"No structures generated",stack:a});U.structures.push(...F),U.links.push(...$);let{matchUps:_,matchUpsMap:L}=cr({inContext:!0,drawDefinition:U}),B=F.map(({structureId:q})=>q),V=_==null?void 0:_.filter(({structureId:q})=>B.includes(q)).map(wr),G=(e=L==null?void 0:L.drawMatchUps)==null?void 0:e.filter(({matchUpId:q})=>V==null?void 0:V.includes(q));if(G!=null&&G.length){let q=(i=cn({drawDefinition:U,event:S}))==null?void 0:i.tieFormat;q&&G.forEach(re=>{let{tieMatchUps:K}=Vw({matchUp:re,tieFormat:q,isMock:b});Object.assign(re,{tieMatchUps:K,matchUpType:di})})}(r=_==null?void 0:_.filter(q=>Md({matchUp:q})&&q.structureId===s))==null||r.forEach(q=>{let{matchUpId:re,score:K,winningSide:z}=q,te=Rn({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),J=lX({inContextDrawMatchUps:_,tournamentRecord:f,drawDefinition:U,matchUpsMap:L,winningSide:z,targetData:te,matchUpId:re,structure:T,matchUp:q,score:K,event:S});J.error&&console.log(J.error)}),(n=_==null?void 0:_.filter(q=>q.matchUpStatus===Ft&&q.structureId===s))==null||n.forEach(q=>{let{matchUpId:re}=q,K=Rn({inContextDrawMatchUps:_,drawDefinition:U,matchUpId:re}),{targetLinks:{loserTargetLink:z},targetMatchUps:{loserMatchUpDrawPositionIndex:te,loserMatchUp:J}}=K;if(z&&J){let ie=z.target.structureId,ne=J.drawPositions[te],ue=$a({drawPosition:ne,structureId:ie,tournamentRecord:f,drawDefinition:U,event:S});ue.error&&console.log(ue.error)}});let j=[],H=ip({inContextDrawMatchUps:_,drawDefinition:U,matchUpsMap:L}).goesToMap,{structure:W}=et({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:Y}=$t({structure:W});return Y.forEach(q=>{var re,K;let z=H==null?void 0:H.loserMatchUpIds[q.matchUpId];if(z&&q.loserMatchUpId!==z){q.loserMatchUpId=z;let J={tournamentId:f==null?void 0:f.tournamentId,eventId:(re=t.event)==null?void 0:re.eventId,context:a,matchUp:q};j.push(J)}let te=H==null?void 0:H.winnerMatchUpIds[q.matchUpId];if(te&&q.winnerMatchUpId!==te){q.winnerMatchUpId=te;let J={tournamentId:f==null?void 0:f.tournamentId,eventId:(K=t.event)==null?void 0:K.eventId,context:a,matchUp:q};j.push(J)}}),{structures:F,matchUpModifications:j,links:$,drawDefinition:U,...Z}}function uX(t){return sR({...t,itemType:"attachConsolationStructures"})}function t_(t){return sR({...t,itemType:"attachPlayoffStructures"})}function sR({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:r,structures:n,links:a=[],event:o}){var s,l,c;let u="attachStructures";if(!r)return{error:Ce};if(!Array.isArray(n)||!Array.isArray(a))return ee({result:{error:oe},stack:u});let d=y=>{var b;return[y.source.structureId,y.source.roundNumber||((b=y.source.finishingPositions)==null?void 0:b.join("|")),y.target.roundNumber].join("|")},p=(s=r.links)==null?void 0:s.map(d);if(a.some(y=>{let b=d(y);return p==null?void 0:p.includes(b)}))return ee({result:{error:mF},info:"playoff structure exists",stack:u});a.length&&((l=r.links)==null||l.push(...a));let m=n.map(({structureId:y})=>y),h=(c=r.structures)==null?void 0:c.map(({structureId:y})=>y);r.structures=(r.structures??[]).map(y=>m.includes(y.structureId)?n.find(({structureId:b})=>b===y.structureId):y);let f=n==null?void 0:n.filter(({structureId:y})=>!(h!=null&&h.includes(y)));f.length&&r.structures.push(...f),ip({drawDefinition:r});let g=n.map(y=>{var b;return((b=$t({structure:y}))==null?void 0:b.matchUps)||[]}).flat();Lc({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUps:g});let v=n.map(({structureId:y})=>y);if(pi({drawDefinition:r,structureIds:v}),e==null?void 0:e.length){let y={};e.forEach(S=>{var w;let U=(w=S.matchUp)==null?void 0:w.matchUpId;U&&(y[U]=S)});let b=S=>{S.matchUps.forEach(w=>{if(y[w.matchUpId]){let{tieMatchUps:U,...T}=y[w.matchUpId].matchUp;if(Object.assign(w,T),U==null?void 0:U.length){let P={};U.forEach(R=>y[R.matchUpId]=R),w.tieMatchUps.forEach(R=>Object.assign(R,P[R.matchUpId]))}y[w.matchUpId].matchUp=w,Et(y[w.matchUpId])}})};r.structures.forEach(S=>{if(h!=null&&h.includes(S.structureId))if(S.structures)for(let w of S.structures)b(w);else b(S)})}let I=f.map(ga("structureId"));if(i){let y={itemValue:{structureIds:v,drawId:r.drawId},itemType:t};ud({element:i,timeItem:y})}return{...Z,addedStructureIds:I}}function lR(t){var e,i;let{structures:r,links:n,matchUpModifications:a,error:o}=e_(t);if(o)return{error:o};let s=t.drawDefinition;return t_({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:r,links:n})}function rp(t){let e=kt(t,[{_anyOf:{[sn]:!1,[Zl]:!1,[Rs]:!1,[lv]:!1},[wF]:!0}]);if(e.error)return e;let i=[],r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r){let n=bV(t,r);if(n.error)return n;i.push(...(n==null?void 0:n.applied)??[]),t.drawDefinition&&pi({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:he};for(let a of n){let o=t.tournamentRecords[a],s=bV(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:he};return i.length?{...Z,applied:i}:{error:Qx}}function bV(t,e){let i=Gt(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let r=[],n=Object.keys(t.policyDefinitions);if(!n.length)return{error:hP};for(let a of n)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Ii(o))return{error:oe};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!On(s))return{error:oe};i[a]=t.policyDefinitions[a],r.push(a)}return r!=null&&r.length?{...Mt({element:e,extension:{name:ry,value:i}}),applied:r}:{applied:r,error:Qx}}function i_({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:r,drawId:n,event:a}){var o;if(!r||typeof r!="string")return ee({result:{error:oe},context:{drawName:r}});i||(i=Yi({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===n);if(s){s.drawName=r;let l={name:Fo,value:{...i,flights:i.flights}};sd({event:a,extension:l})}return e&&(e.drawName=r,pi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:Ce}:{...Z,flight:s}}function cX({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:r,event:n}){var a;if(!Ii(i))return{error:oe};let o=Yi({event:n}).flightProfile,s=i.drawName&&i_({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:r,event:n});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(c=>c.drawId===r));if(!l&&!e)return{error:Ce};if(l){let c={name:Fo,value:{...o,flights:o.flights}};sd({event:n,extension:c})}return e&&(i.policyDefinitions&&rp({policyDefinitions:i.policyDefinitions,drawDefinition:e}),pi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...Z}}function dX({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var r,n;if(!i)return{error:Ce};let a=Zr({drawDefinition:i}),o=l=>{var c;return(c=a==null?void 0:a.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![qe,Oe].includes(u))&&(l.positionAssignments=c.map(h=>(delete h.participantId,h)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:m}=$t({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let h of p){let{matchUpId:f,roundNumber:g}=h,v=h.sides||[],I=o(f);if(I){if(delete I.extensions,delete I.notes,I.matchUpStatus!==Ft&&Object.assign(I,rR),g&&g>1&&((r=I.drawPositions)==null?void 0:r.length)&&!m){let y=v==null?void 0:v.map(({drawPosition:S,participantFed:w})=>!w&&S).filter(Boolean),b=I.drawPositions.map(S=>y.includes(S)?void 0:S);I.drawPositions=b}e?delete I.timeItems:(n=I.timeItems)!=null&&n.length&&(I.timeItems=I.timeItems.filter(y=>y.itemType&&![Au,Qd,vv,y8,Iv,yv].includes(y.itemType))),Et({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:I})}}}let s=(i.structures||[]).map(({structureId:l})=>l);return pi({drawDefinition:i,structureIds:s}),{...Z}}function Yw({tournamentRecord:t}){var e;if(!t)return{error:he};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},r={};return((e=t.events)==null?void 0:e.map(n=>{let a=n.eventId;return r[a]=n,((n==null?void 0:n.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:n,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:c}=tR({drawDefinition:n}),u=r[a],d=((n==null?void 0:n.structures)||[]).map(b=>{let{stage:S,stageSequence:w,structureId:U}=b,T=_m[S],{inContextStructureMatchUps:P}=Mw({drawDefinition:n,structure:b,event:u}),R=P==null?void 0:P.filter(({winningSide:L})=>L),D=R.filter(Boolean).length||0;s+=D,l+=P.length-s;let E=Math.max(R.filter(({roundNumber:L})=>L===1).map(({roundPosition:L})=>L)),{positionAssignments:N}=ei({structure:b}),A=N==null?void 0:N.filter(({participantId:L})=>L);o+=(A==null?void 0:A.length)??0;let M=((N==null?void 0:N.length)??0)-((A==null?void 0:A.length)??0),{roundMatchUps:C,roundProfile:O,roundNumbers:k,maxMatchUpsCount:x}=Pn({matchUps:P}),F=O&&Object.keys(O).filter(L=>!O[L].inactiveRound).map(L=>parseInt(L)),$=O&&Object.keys(O).filter(L=>O[L].inactiveRound).map(L=>parseInt(L)),_=O&&Object.values(O).every(L=>L.inactiveRound);return{positionsAssignedCount:(A==null?void 0:A.length)??0,maxWinningSideFirstRoundPosition:E,unassignedPositionsCount:M,inactiveStructure:_,maxMatchUpsCount:x,inactiveRounds:$,roundMatchUps:C,activeRounds:F,roundNumbers:k,roundProfile:O,structureId:U,stageSequence:w,orderNumber:T,stage:S}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),m=d.filter(({inactiveStructure:b})=>!b).length,{links:h}=bv({structureId:p.structureId,drawDefinition:n}),f=Xe(p.activeRounds[0])===1&&p.activeRounds.length===1&&m===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!h.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),I=n.drawId;o&&!s&&i.positionsNoOutcomes.push(I),g&&i.inactive.push(I),f&&i.matchPlay.push(I),v&&i.canBePruned.push(I);let y={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:f,drawId:I};i.drawAnalysis[I]=y}),{...Z,drawsAnalysis:i}}function pX({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:r}){var n;if(!e)return{error:he};if(!i)return{error:Ce};let a=[],{drawsAnalysis:o}=Yw({tournamentRecord:e});if(o.canBePruned.includes(r)){let s=o.matchPlay.includes(r),l=o.drawAnalysis[r],{structures:[c]}=zl({stageSequence:1,drawDefinition:i,stage:Oe}),u=l.structuresData.find(({structureId:h})=>c.structureId===h),d=(c.matchUps??[]).sort((h,f)=>h.roundPosition-f.roundPosition);a=d.filter(({roundNumber:h})=>!u.inactiveRounds.includes(h));let p=a.map(wr),m=d.map(wr).filter(h=>!p.includes(h));if(s){let h=a.filter(({roundNumber:y})=>!u.inactiveRounds.includes(y)).filter(({winningSide:y})=>y),f=h.map(wr),g=p.filter(y=>!f.includes(y));m.push(...g);let v=h.flatMap(y=>y.drawPositions??[]).filter(Boolean).flat(),I=Object.assign({},...v.map((y,b)=>({[y]:b+1})));if(h.forEach(y=>{t?y.drawPositions=y.drawPositions.map(b=>I[b]):delete y.drawPositions}),t){let y=(n=c==null?void 0:c.positionAssignments)==null?void 0:n.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=I[b.drawPosition],b));c.positionAssignments=y}else c.positionAssignments=[];c.matchUps=h,a=h}Ku({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,drawDefinition:i}),pi({drawDefinition:i})}return{...Z,matchUps:a}}function mX({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,qualifier:a,event:o,bye:s}){if(!e)return{error:Ce};if(!r)return{error:tv};if(!n)return{error:La};if(s){let l=$a({tournamentRecord:t,drawDefinition:e,drawPosition:r,structureId:n,event:o});if(l.error)return l}else{if(a)return{error:UP};{let l=el({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:r,structureId:n,event:o});if(l.error)return l}}return{...Z}}function hX(t){var e,i,r,n,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(m=>{var h;return(h=m.matchUps)==null?void 0:h.some(({matchUpId:f})=>o.includes(f))}))==null?void 0:i.structureId)??((n=(r=s==null?void 0:s.structures)==null?void 0:r[0])==null?void 0:n.structureId);if(!l)return{error:Ri};let c=(a=s.structures)==null?void 0:a.find(m=>m.structureId===l);if(!c)return{error:Ri};let u=c==null?void 0:c.matchUps,d=u==null?void 0:u.find(m=>!!m.roundPosition);if(c.structures||d||c.finishingPosition===Ph)return{error:yh};let p=u.filter(({roundNumber:m})=>{var h;return(h=t.roundNumbers)==null?void 0:h.includes(m)}).map(wr);return o=o.filter(m=>!p.includes(m)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:u,matchUpIds:o,structureId:l,structure:c}}function fX(t){let e=kt(t,[{[Rs]:!0},{[QI]:{[rw]:!1,roundNumbers:!1},[_l]:oe,[ad]:Xn}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:r=!0,removeCompleted:n=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=hX(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,m=[],h=(d==null?void 0:d.filter(({matchUpId:v,score:I,winningSide:y})=>{if(y&&!n)return!1;if(_r({score:I})){if(!y&&!i)return!1;m.push(v)}else if(!r)return!1;return p==null?void 0:p.includes(v)}))??[],f=h.map(wr),g=h.map(({tieMatchUps:v})=>v==null?void 0:v.map(wr)).filter(Boolean).flat();if(f.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:y})=>!f.includes(y)),Ku({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=ht(c.matchUps.map(ga("roundNumber"))),I=lwe(v);if(I.length){I.reverse();for(let y of I)c.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>y&&(b.roundNumber-=1,Et({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(m.length){c.positionAssignments=ht(c.matchUps.flatMap(w=>(w.sides??[]).map(U=>U.participantId)).filter(Boolean)).map(w=>({participantId:w}));let y=(c==null?void 0:c.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:b}=$t({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),S=XL({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:y,matchUps:b,event:s});S.error&&console.log(S)}pi({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!f.length&&p.length?{error:TP}:{...Z,deletedMatchUpsCount:[...f,...g].length}}function gX({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:r,roundNumber:n,event:a}){if(!e)return{error:he};if(!i)return{error:Ce};if(!n)return ee({result:{error:Ve},info:"roundNumber required"});let o=et({drawDefinition:i,structureId:r});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:yh}:va({structure:s})?TTe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:n,structure:s}):(console.log("not implemented"),{...Z})}function TTe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:r,structure:n,eventId:a}){let o=(n==null?void 0:n.matchUps)??[],s=[],l=[],c=!1;if(o.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(sr).includes(r)){let u=o.filter(d=>{let p=d.roundNumber===r&&(!Sr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(wr))),!p});l.length&&(Ku({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===r)||(u.forEach(d=>{d.roundNumber>r&&(d.roundNumber-=1,Et({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),n.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...Z}}function uR(t){var e,i,r,n,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:c,matchUps:u,event:d}=t;if(typeof c!="object")return{error:Ce};let p=t==null?void 0:t.structureId;if(!p&&((e=c.structures)==null?void 0:e.length)===1&&(p=(r=(i=c.structures)==null?void 0:i[0])==null?void 0:r.structureId),typeof p!="string")return{error:La};if(!po(u))return{error:oe,info:ql("matchUps")};let m=(n=c.structures)==null?void 0:n.find(I=>I.structureId===p);if(!m)return{error:Ri};let h=(m==null?void 0:m.matchUps).find(I=>!!I.roundPosition);if(m.structures||h||m.finishingPosition===Ph)return{error:yh};let f=((o=(a=Lr({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(wr))??[],g=u.map(wr);if(Dn(f,g))return{error:XK,info:"One or more matchUpIds already present in tournamentRecord"};m.matchUps.push(...u);let v=u.map(({tieMatchUps:I})=>I).filter(Boolean).flat();return s||(Lc({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...u],eventId:d==null?void 0:d.eventId,drawDefinition:c}),pi({drawDefinition:c,structureIds:[p]})),{...Z}}function vX({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:r,subOrder:n,event:a}){var o;if(!e)return{error:Ce};if(!r)return{error:La};if(!i)return{error:tv};let{structure:s}=et({drawDefinition:e,structureId:r});if(!s)return{error:Ri};let l=s;s.structures&&s.structureType===Cn&&(l=(o=s.structures)==null?void 0:o.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(g=>g.drawPosition===i)}));let c=l==null?void 0:l.positionAssignments,u=c==null?void 0:c.find(h=>h.drawPosition===i);u&&Mt({element:u,extension:{name:Qf,value:n}});let d=((a==null?void 0:a.eventType)===di||e.matchUpType===di||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[di]},{matchUps:p}=$t({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),m=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return XL({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:m,matchUps:p,event:a}),pi({drawDefinition:e,structureIds:[r]}),{...Z}}var IX={};yt(IX,{addGoesTo:()=>ip,allPlayoffPositionsFilled:()=>jL,checkValidEntries:()=>mR,findDrawDefinition:()=>o_,getAssignedParticipantIds:()=>Np,getAvailableMatchUpsCount:()=>cR,getAvailablePlayoffProfiles:()=>Bw,getDrawDefinitionTimeItem:()=>UL,getDrawParticipantRepresentativeIds:()=>n_,getDrawTypeCoercion:()=>Kw,getEligibleVoluntaryConsolationParticipants:()=>r_,getMatchUpsMap:()=>Zr,getParticipantIdFinishingPositions:()=>a_,getPositionAssignments:()=>fy,getPositionsPlayedOff:()=>Dv,getSeedingThresholds:()=>FL,getSeedsCount:()=>Jw,getStructureSeedAssignments:()=>ao,getTeamLineUp:()=>tp,getValidGroupSizes:()=>xw,isAdHoc:()=>va,isCompletedStructure:()=>Bc,isValidForQualifying:()=>h_,positionActions:()=>m_});function r_({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:r,policyDefinitions:n,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:m}){var h,f,g,v,I;if(!s)return{error:Ce};let y=[Oe,Fi];i&&y.push(qe);let b=m!=null&&m.eventType?{matchUpTypes:[m.eventType]}:void 0,S=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&m?((h=Qu({contextFilters:{stages:y},matchUpFilters:b,tournamentRecord:o,inContext:!0,event:m}))==null?void 0:h.matchUps)??[]:((f=Nn({contextFilters:{stages:y},matchUpFilters:S,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:f.matchUps)??[],U=Eh({stage:Mr,drawDefinition:s}).map(({participantId:_})=>_),T={},P={},R={},D={};n||(n=Ju({policyTypes:[dM],tournamentRecord:o,drawDefinition:s,event:m}).policyDefinitions);let E=n==null?void 0:n[dM];t=t.length&&t||(E==null?void 0:E.excludedMatchUpStatuses)||[],e=e??(E==null?void 0:E.includeEventParticipants),d=d??(E==null?void 0:E.allEntries),r=r??(E==null?void 0:E.finishingRoundLimit),a=a??(E==null?void 0:E.roundNumberLimit),l=l??(E==null?void 0:E.matchUpsLimit),c===void 0&&(c=(E==null?void 0:E.requirePlay)!==void 0?E.requirePlay:!0),u===void 0&&(u=(E==null?void 0:E.requireLoss)!==void 0?E.requireLoss:!0),p=p??(E==null?void 0:E.winsLimit);for(let _ of w){if(c&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==ir||_.finishingRound&&r&&_.finishingRound>=r||_.finishingRound&&a&&_.finishingRound<=a)continue;let L=(g=_.sides)==null?void 0:g.find(({sideNumber:V})=>_.winningSide&&V===3-_.winningSide),B=(v=_.sides)==null?void 0:v.find(({sideNumber:V})=>_.winningSide&&V===_.winningSide);if((I=_.sides)==null||I.forEach(V=>{var G;let j=(G=V==null?void 0:V.participant)==null?void 0:G.participantId;j&&(R[j]=V.participant,_.matchUpStatus===ir&&!c&&(P[j]=V.participant,T[j]||(T[j]=0),(!_.matchUpStatus||!t.includes(_.matchUpStatus))&&(T[j]+=1)))}),L==null?void 0:L.participant){let V=L.participant.participantId;P[V]=L.participant,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}if(B!=null&&B.participant){let V=B.participant.participantId;D[V]||(D[V]=0),D[V]+=1,T[V]||(T[V]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(T[V]+=1)}}let N=(o==null?void 0:o.participants)&&!c&&!u&&d,A=N?((e&&m?m.entries:s.entries)??[]).filter(_=>![Nu,Ko].includes(_.entryStatus)).map(({participantId:_})=>_):[],M=Object.keys(P),C=N?((o==null?void 0:o.participants)??[]).filter(({participantId:_})=>A.includes(_)):u&&Object.values(P)||Object.values(R),O=_=>!u||M.includes(_),k=_=>!c||(T[_]||0)>=0,x=_=>!p||(D[_]||0)<=p,F=_=>!l||T[_]<=l,$=_=>!U.includes(_);return{eligibleParticipants:C.filter(_=>O(_.participantId)&&k(_.participantId)&&x(_.participantId)&&F(_.participantId)&&$(_.participantId)).map(_=>{var L;return{..._,individualParticipants:(L=_.individualParticipantIds)==null?void 0:L.map(B=>{var V;return(V=o==null?void 0:o.participants)==null?void 0:V.find(G=>G.participantId===B)})}}),losingParticipantIds:M,...Z}}function cR(t){var e,i,r,n,a,o,s,l;let c=kt(t,[{drawDefinition:!0}]);if(c.error)return c;let{drawDefinition:u,roundNumber:d}=t,p=t.structureId??(((e=u.structures)==null?void 0:e.length)===1&&((r=(i=u.structures)==null?void 0:i[0])==null?void 0:r.structureId));if(typeof p!="string")return{error:La};let m=(n=u.structures)==null?void 0:n.find(w=>w.structureId===p);if(!m)return{error:Ri};let h,f=(a=m.matchUps??[])==null?void 0:a.reduce((w,U)=>(U.roundPosition&&(h=!0),((U==null?void 0:U.roundNumber)||0)>w?U.roundNumber:w),0);if(m.structures||h||m.finishingPosition===Ph)return{error:yh};let g=((o=u==null?void 0:u.entries)==null?void 0:o.filter(w=>{let U=w.entryStatus;return Jo.includes(U)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,I=d??f??1,y=((l=(s=m.matchUps)==null?void 0:s.filter(w=>w.roundNumber===I))==null?void 0:l.length)??0,b=v-y,S=b>0?b:0;return{...Z,availableMatchUpsCount:S,lastRoundNumber:f,roundMatchUpsCount:v}}function n_({drawDefinition:t}){var e;let i=ft({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function DTe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:Ce};let r=cr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),n=Fe(r.matchUps,!1,!0),a=ht(n.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=n.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function a_({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:Ce};let{participantIds:r,participantIdMatchUps:n}=DTe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(r==null?void 0:r.map(o=>{let s=n[o].filter(d=>[Zi,Ft].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(h=>h.bye),m=d.sides.find(h=>h.participantId===o).sideNumber;return(d.winningSide||t&&p&&m)===m?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function cd({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:r}){if(!e&&!t)return{error:he};if(!r)return{error:Ps};if(!e&&t){if(typeof i!="string"&&(i=sX({tournamentRecords:t,drawId:r}),!i))return{error:Gf};if(e=t[i],!e)return{error:he}}let n=e&&xn({tournamentRecord:e,drawId:r});return n!=null&&n.drawDefinition?{drawDefinition:n.drawDefinition,event:n.event,tournamentRecord:e,...Z}:ee({result:{error:ma},stack:"findDrawDefinition"})}function o_(t){let{drawDefinition:e,error:i}=cd(t);return i?{error:i}:{drawDefinition:Fe(e)}}function RM({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:r,linkType:n}){let{links:a}=bv({drawDefinition:i,structureId:r})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===n).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=et({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}var PTe="qualifierDrawPositionAssignment",RTe="withdrawParticipantAtDrawPosition",ETe="alternateDrawPositionAssignment",CTe="luckyLoserDrawPositionAssignment",wV="removeDrawPositionAssignment",MTe="swapDrawPositionAssignments",NTe="modifyPairAssignment",ATe="modifyParticipantOtherName",UV="assignDrawPosition",OTe="removeSeededParticipant",kTe="assignDrawPositionBye",xTe="modifySeedAssignment",yX="addPenalty",s_="MODIFY_PAIR",dR="QUALIFIER",l_="ALTERNATE",u_="WITHDRAW",Vm="ASSIGN",EM="REMOVE",c_="LUCKY",lI="REMOVE_SEED",d_="SWAP",hy="NICKNAME",fm="SEED_VALUE",jm="PENALTY",_0="BYE",FTe={MODIFY_PAIR_ASSIGNMENT:s_,QUALIFYING_PARTICIPANT:dR,ALTERNATE_PARTICIPANT:l_,WITHDRAW_PARTICIPANT:u_,ASSIGN_PARTICIPANT:Vm,LUCKY_PARTICIPANT:c_,REMOVE_ASSIGNMENT:EM,SWAP_PARTICIPANTS:d_,ADD_NICKNAME:hy,REMOVE_SEED:lI,ADD_PENALTY:jm,ASSIGN_BYE:_0,SEED_VALUE:fm};function LTe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:r,drawId:n,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[Ko,Tp].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=r.individualParticipantIds,c=e?t.filter(({participantId:d})=>s.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:He({payload:{participantId:r.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:n},method:NTe,availableIndividualParticipantIds:s,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:s_},!1,!1,!0)}}return{}}function np(t){var e,i;let{inContextDrawMatchUps:r,targetData:n,drawDefinition:a,relevantLink:o}=t;if((o==null?void 0:o.linkCondition)===Gl&&((e=n==null?void 0:n.matchUp)==null?void 0:e.matchUpStatus)===Ft)return!1;let{targetMatchUps:{loserMatchUp:s,winnerMatchUp:l},targetLinks:c}=n,u=[Ot,jt].includes(s==null?void 0:s.matchUpStatus),d=((i=l==null?void 0:l.drawPositions)==null?void 0:i.filter(Boolean).length)||0;if(s!=null&&s.winningSide&&!u||l!=null&&l.winningSide&&d===2&&(!l.feedRound||![jt,Ot].includes(l==null?void 0:l.matchUpStatus)))return!0;let p=s&&Rn({matchUpId:s.matchUpId,inContextDrawMatchUps:r,drawDefinition:a}),m=l&&Rn({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:a}),h=p&&np({relevantLink:c==null?void 0:c.loserTargetLink,targetData:p,inContextDrawMatchUps:r,drawDefinition:a});return!!(m&&np({targetData:m,inContextDrawMatchUps:r,drawDefinition:a})||h)}var bX={[Du]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[qe,Oe],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[hy,jm,dR,fm],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},RS="positionAction",CM="matchUpAction";function wX({actionType:t=RS,appliedPolicies:e,drawDefinition:i,structure:r}){var n,a;let o=t===RS&&Du||t===CM&&Cr,s=t===RS&&bX||t===CM&&eJ,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),c=((a=(n=i.links)==null?void 0:n.filter(m=>{var h;return((h=m==null?void 0:m.target)==null?void 0:h.structureId)===(r==null?void 0:r.structureId)}))==null?void 0:a.map(({target:m})=>m.feedProfile))??[],{enabledStructures:u,disabledStructures:d}=l||{},p=d==null?void 0:d.find(m=>{let{stages:h,stageSequences:f,structureTypes:g,feedProfiles:v}=m;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(I=>c.includes(I)))&&(!(h!=null&&h.length)||Array.isArray(h)&&(h==null?void 0:h.includes(r==null?void 0:r.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(r==null?void 0:r.structureType)))&&(!(f!=null&&f.length)||Array.isArray(f)&&f.includes(r==null?void 0:r.stageSequence))});return{enabledStructures:u,actionsDisabled:p,actionsPolicy:l}}function SV({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function UX({enabledStructures:t,drawDefinition:e,structure:i}){var r,n;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((n=(r=e.links)==null?void 0:r.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:n.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:m}=c||{},h=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(a),f=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(m!=null&&m.length)||Array.isArray(m)&&m.some(I=>l.includes(I));return f&&g&&v&&c&&h})}}function Bn({action:t,policyActions:e}){var i;let r=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return r?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!r}var SX="replaceTieMatchUpParticipantId",TX="assignTieMatchUpParticipantId",MM="removeTieMatchUpParticipantId",TV="assignMatchUpSideParticipant",_Te="removeMatchUpSideParticipant",DX="substituteParticipant",NM="REMOVE_SUBSTITUTION",PX="REPLACE_PARTICIPANT",p_="REMOVE_PARTICIPANT",AM="setMatchUpStatus",OM="SUBSTITUTION",RX="SCHEDULE",$Te="PENALTY",kM="REFEREE",EX="STATUS",xM="START",CX="SCORE",FM="END",BTe={REPLACE_TEAM_POSITION_METHOD:SX,ASSIGN_TEAM_POSITION_METHOD:TX,REMOVE_TEAM_POSITION_METHOD:MM,REPLACE_PARTICIPANT:PX,SUBSTITUTION_METHOD:DX,REMOVE_SUBSTITUTION:NM,REMOVE_PARTICIPANT:p_,SCHEDULE_METHOD:AM,SUBSTITUTION:OM,SCHEDULE:RX,PENALTY:$Te,REFEREE:kM,STATUS:EX,SCORE:CX,START:xM,END:FM};function VTe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:r,inContextMatchUp:n,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var m,h,f,g,v,I,y,b,S,w,U,T,P,R,D;let E=[],N=(m=n.sides)==null?void 0:m.find(W=>W.participant),A=n.gender===oa&&n.sideNumber&&((h=n.sides)==null?void 0:h.filter(W=>W.particiapntId).length)===1&&((g=(f=N==null?void 0:N.participant)==null?void 0:f.person)==null?void 0:g.sex),M=n.matchUpType,C=(o??((v=r==null?void 0:r.participants)==null?void 0:v.enforceGender))!==!1?n.gender:void 0,O=(y=(I=n.sides)==null?void 0:I.flatMap(W=>{var Y;return((Y=W.participant)==null?void 0:Y.individualParticipants)||W.participant}).filter(Boolean))==null?void 0:y.map(bt),k=(b=n.sides)==null?void 0:b.filter(W=>!l||W.sideNumber===l).flatMap(W=>{var Y;return((Y=W.participant)==null?void 0:Y.individualParticipants)||W.participant}).filter(Boolean),x=k==null?void 0:k.map(bt),F=(w=(S=e==null?void 0:e.find(W=>W.matchUpId===n.matchUpTieId))==null?void 0:S.sides)==null?void 0:w.map(W=>{var Y;return(Y=W.participant)==null?void 0:Y.individualParticipants.filter(({participantId:q,person:re})=>!(x!=null&&x.includes(q))&&(!C||C===Qs||re.sex===C||C===oa&&!A||A&&re.sex!==A))}),$=l?F==null?void 0:F[l-1]:F==null?void 0:F.map((W,Y)=>({participants:W,sideNumber:Y+1})),_=l?(U=F==null?void 0:F[l-1])==null?void 0:U.map(bt):F==null?void 0:F.map((W,Y)=>({participants:W==null?void 0:W.map(bt),sideNumber:Y+1})),L=l&&(Bi(pm)(M)&&!(x!=null&&x.length)||Bi(Xd)(M)&&((x==null?void 0:x.length)??0)<2)||!l&&(Bi(pm)(M)&&((x==null?void 0:x.length)??0)<2||Bi(Xd)(M)&&((x==null?void 0:x.length)??0)<4),B=_==null?void 0:_.filter(W=>!(O!=null&&O.includes(W))),V=$==null?void 0:$.filter(({participantId:W})=>B.includes(W));if(L&&B!=null&&B.length&&E.push({availableParticipantIds:B,method:TX,availableParticipants:V,type:Vm,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),x!=null&&x.length&&(!_r(u)||(T=p==null?void 0:p.substitutions)!=null&&T.length)&&E.push({method:MM,type:p_,existingParticipantIds:x,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),V!=null&&V.length&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&E.push({availableParticipantIds:B,method:SX,availableParticipants:V,type:PX,existingParticipantIds:x,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Bn({policyActions:a,action:NM})&&((P=p==null?void 0:p.substitutions)==null?void 0:P.length)){let W=((R=p.participant)==null?void 0:R.participantType)===wt&&[p.participantId]||((D=p.participant)==null?void 0:D.participantType)===st&&p.participant.individualParticipantIds||[],Y=p.substitutions.map(q=>q.participantId).filter(q=>W.includes(q));(!s||Y.includes(s))&&E.push({method:MM,type:NM,substitutedParticipantIds:Y,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let G=t==null?void 0:t[Cr],j=G==null?void 0:G.substituteWithoutScore,H=G==null?void 0:G.substituteAfterCompleted;if(Bn({policyActions:a,action:OM})&&i.length===2&&(!l&&x!=null&&x.length||l&&p!=null&&p.participant)&&(j||_r(u))&&(H||u.matchUpStatus&&!Sr.includes(u.matchUpStatus))&&k!=null&&k.length&&$.length){let W=k.map(bt);E.push({info:"list of team players available for substitution",method:DX,availableParticipantIds:_,existingParticipantIds:W,availableParticipants:$,existingParticipants:k,type:OM,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return E}function jTe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:r,returnParticipants:n,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var m,h,f,g,v;if(i.includes(s))return{};let I=(m=l.find(E=>E.type===Vm))==null?void 0:m.availableParticipantIds,y=(h=a==null?void 0:a[Du])==null?void 0:h.otherFlightEntries,b=(f=a==null?void 0:a[Du])==null?void 0:f.restrictQualifyingAlternates,S=(o.entries??[]).filter(({entryStage:E})=>!b||(u.stage===qe?E===qe:E!==qe)).sort((E,N)=>(E.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:E})=>E).filter(Boolean),{allPositionedParticipantIds:w}=i8({drawDefinition:o}),U=r.map(E=>E.participantId).filter(Boolean),T=S.filter(E=>u.stage&&[qe,Oe,Fi].includes(u.stage)?!(w!=null&&w.includes(E)):!U.includes(E)),P=((p==null?void 0:p.entries)??[]).filter(E=>E.entryStatus===Ro&&MX({restrictQualifyingAlternates:b,structure:u,entry:E})&&(u.stage&&[qe,Oe,Fi].includes(u.stage)?!(w!=null&&w.includes(E.participantId)):!U.includes(E.participantId))).sort((E,N)=>(E.entryPosition??1/0)-(N.entryPosition??1/0)).map(E=>E.participantId),R=ht(T.concat(P));if(y){let E=(v=(g=p?Yi({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(A=>A.participantId&&![Nu,Ko,Tp].includes(A.entryStatus)&&!S.includes(A.participantId)).map(({participantId:A})=>A)).flat().filter(Boolean);E!=null&&E.length&&R.push(...E)}I!=null&&I.length&&(R=R.filter(E=>!I.includes(E)));let D=n?t==null?void 0:t.filter(E=>R.includes(E.participantId)):void 0;return D==null||D.forEach(E=>{let N=(o.entries??[]).find(A=>A.participantId===E.participantId);E.entryPosition=N==null?void 0:N.entryPosition}),D==null||D.sort((E,N)=>(E.entryPosition||1/0)-(N.entryPosition||1/0)),R.length?{validAlternatesAction:He({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:ETe,availableAlternatesParticipantIds:R,type:l_,availableAlternates:D})}:{}}function MX({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:r}=e;if(!i.entryStage||i.entryStage===r||r===qe&&!t||i.entryStage===Oe&&r===Yr)return!0}function GTe({eventEntries:t,structure:e}){let i=n=>n.entryStatus===Ro&&MX({structure:e,entry:n}),r=(n,a)=>(n.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(r).map(bt)}function HTe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:r,drawDefinition:n,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var p,m,h,f,g;let v=[],I=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:D})=>D===c.roundNumber),y=((p=n==null?void 0:n.entries)==null?void 0:p.filter(({entryStatus:D})=>D&&Dp.includes(D)).map(bt))??[],b=I.map(D=>(D.sides??[]).flatMap(bt)).flat().filter(Boolean),S=y.filter(D=>!i.includes(D)&&(!t||!b.includes(D))),w=e==null?void 0:e.filter(D=>S==null?void 0:S.includes(D.participantId)).map(D=>Fe(D,void 0,!0));w==null||w.forEach(D=>{let E=(n.entries??[]).find(N=>N.participantId===D.participantId);D.entryPosition=E==null?void 0:E.entryPosition}),S.length&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:TV,type:Vm,availableParticipantIds:S,participantsAvailable:w});let U=(d==null?void 0:d.entries)??[],T=GTe({eventEntries:U,structure:l}),P=ht(y.concat(T));if(r){let D=(h=(m=d?Yi({event:d}):void 0)==null?void 0:m.flights)==null?void 0:h.filter(E=>E.drawId!==u).flatMap(E=>E.drawEntries.filter(N=>N.participantId&&![Nu,Ko,Tp].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);D!=null&&D.length&&P.push(...D)}P=P.filter(D=>!i.includes(D)&&!S.includes(D)&&(!t||!b.includes(D)));let R=e==null?void 0:e.filter(D=>P.includes(D.participantId)).map(D=>Fe(D,void 0,!0));return R==null||R.forEach(D=>{let E=(n.entries??[]).find(N=>N.participantId===D.participantId);D.entryPosition=E==null?void 0:E.entryPosition}),R==null||R.sort((D,E)=>(D.entryPosition||1/0)-(E.entryPosition||1/0)),P.length&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:P,participantsAvailable:R,method:TV,type:Ro}),!_r(c)&&o&&(g=(f=c.sides)==null?void 0:f.find(D=>D.sideNumber===o))!=null&&g.participantId&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:_Te,type:p_}),v}function pR(t){var e,i,r,n,a,o,s,l,c;if(!t)return{error:oe};let{drawDefinition:u,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:m,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v}=t,I=t.tournamentRecord??(t.tournamentId&&On(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!I)return{error:he};if(!v||!On(v))return{error:Xr};if(g&&![1,2].includes(g))return ee({result:{error:oe},context:{sideNumber:g}});if(!u){let ne=(Lr({tournamentRecord:I}).matchUps??[]).find(ae=>ae.matchUpId===v);d=((I==null?void 0:I.events)??[]).find(ae=>ae.eventId===(ne==null?void 0:ne.eventId));let ue=((d==null?void 0:d.drawDefinitions)??[]).find(ae=>ae.drawId===(ne==null?void 0:ne.drawId));ue&&(u=ue)}if(!u)return{error:Ce};let y=Wi({withIndividualParticipants:!0,tournamentRecord:I}).participants,{drawId:b}=u,{matchUp:S,structure:w}=gi({drawDefinition:u,matchUpId:v,event:d});if(!S)return{error:an};let U=Gt({tournamentRecord:I,drawDefinition:u,structure:w,event:d}).appliedPolicies??{};Object.assign(U,m??{});let T=(i=U==null?void 0:U[Du])==null?void 0:i.otherFlightEntries,P=(U==null?void 0:U[Cr])??Sv[Cr],{enabledStructures:R}=wX({actionType:CM,appliedPolicies:U,drawDefinition:u,structure:w}),{policyActions:D}=UX({enabledStructures:R,drawDefinition:u,structure:w}),E=t.matchUpsMap??Zr({drawDefinition:u}),N=t.inContextDrawMatchUps??cr({tournamentParticipants:y,inContext:!0,drawDefinition:u,matchUpsMap:E,event:d}).matchUps,A=N==null?void 0:N.find(ne=>ne.matchUpId===v),M=g&&((r=A==null?void 0:A.sides)==null?void 0:r.find(ne=>ne.sideNumber===g)),C=((n=A==null?void 0:A.sides)==null?void 0:n.map(ne=>{var ue;return ne.participantId||((ue=ne.participant)==null?void 0:ue.participantid)}).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:k}=Tr({structure:w}),{structureId:x}=w??{},F=[];if(!x)return{validActions:F};let $=va({structure:w}),_=S.collectionId;if($&&!_){let ne=HTe({restrictAdHocRoundParticipants:p,tournamentParticipants:y,matchUpParticipantIds:C,otherFlightEntries:T,drawDefinition:u,structureId:x,sideNumber:g,matchUpId:v,structure:w,matchUp:S,drawId:b,event:d});F.push(...ne)}let L=Bc({drawDefinition:u,structure:w}),B=O==null?void 0:O.filter(ne=>ne.participantId).map(ne=>ne.drawPosition),V=O==null?void 0:O.filter(ne=>ne.bye).map(ne=>ne.drawPosition),G=S.matchUpStatus===Ft||!_&&((a=S.drawPositions)==null?void 0:a.reduce((ne,ue)=>(V==null?void 0:V.includes(ue))||ne,!1));if(G)return{validActions:F,isByeMatchUp:G};Bn({policyActions:D,action:kM})&&F.push({type:kM,payload:{matchUpId:v}});let j=!Cw({matchUpStatus:S.matchUpStatus}),H=(o=U==null?void 0:U.scoring)==null?void 0:o.structures,W=(w==null?void 0:w.stage)&&(H==null?void 0:H.stage)&&(H==null?void 0:H.stage[w.stage]),Y=(w==null?void 0:w.stageSequence)&&(W==null?void 0:W.stageSequence)&&W.stageSequence[w.stageSequence],q=!((s=U==null?void 0:U.scoring)!=null&&s.requireAllPositionsAssigned||W!=null&&W.requireAllPositionsAssigned||Y!=null&&Y.requireAllPositionsAssigned)||k,re=S.sides&&S.sides.filter(ne=>ne==null?void 0:ne.participantId).length===2,K=S.matchUpStatus&&[ir,hr].includes(S.matchUpStatus),z=Rn({inContextDrawMatchUps:N,drawDefinition:u,matchUpId:v}),te=np({inContextDrawMatchUps:N,drawDefinition:u,targetData:z}),J=(((l=A==null?void 0:A.drawPositions)==null?void 0:l.length)===2&&A.drawPositions.every(ne=>B==null?void 0:B.includes(ne))&&((c=A==null?void 0:A.sides)==null?void 0:c.length)===2&&A.sides.every(({participantId:ne})=>ne)||re)&&!(K&&te),ie={method:yX,type:jm,payload:{drawId:b,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(j&&F.push({payload:{drawId:b,matchUpId:v,schedule:{}},method:AM,type:RX}),Bn({policyActions:D,action:jm})&&(M!=null&&M.participant||!g&&C!=null&&C.length)&&F.push(ie),j&&J&&F.push({type:EX}),q&&J){let{matchUpId:ne,matchUpFormat:ue}=S,ae={drawId:b,matchUpId:ne,matchUpFormat:ue,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};F.push({info:"set outcome and winningSide",method:AM,type:CX,payload:ae}),Bn({policyActions:D,action:xM})&&F.push({type:xM}),Bn({policyActions:D,action:FM})&&F.push({type:FM})}if(_&&A){let ne=VTe({specifiedPolicyDefinitions:m,inContextDrawMatchUps:N,matchUpParticipantIds:C,matchUpActionsPolicy:P,inContextMatchUp:A,policyActions:D,enforceGender:h,participantId:f,sideNumber:g,matchUpId:v,matchUp:S,drawId:b,side:M});F.push(...ne)}return{structureIsComplete:L,validActions:F,isDoubleExit:K,...Z}}function zTe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:r,activeDrawPositions:n,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var p,m,h,f,g,v,I;if(n.includes(s)||r&&!e)return{};let{sourceStructureIds:y,targetStructureIds:b}=((p=o.links)==null?void 0:p.reduce((T,P)=>{var R,D;let E=(R=P.source)==null?void 0:R.structureId,N=(D=P.target)==null?void 0:D.structureId;return T.sourceStructureIds.includes(E)||T.sourceStructureIds.push(E),T.targetStructureIds.includes(N)||T.targetStructureIds.push(N),T},{sourceStructureIds:[],targetStructureIds:[]}))||{},S=[],w=((m=o.links)==null?void 0:m.filter(T=>{var P;return((P=T.target)==null?void 0:P.structureId)===c.structureId}))??[];for(let T of w){let P=(h=T==null?void 0:T.source)==null?void 0:h.structureId,{structure:R}=et({structureId:P,drawDefinition:o}),D=(R==null?void 0:R.finishingPosition)===Ph&&((y==null?void 0:y.length)!==1||(b==null?void 0:b.length)!==1),E={};if(D){let{matchUps:M}=$t({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:C}=Bm({drawPosition:s,matchUps:M}),O=(v=(g=(f=o.links)==null?void 0:f.find(k=>{var x;return((x=k.target)==null?void 0:x.structureId)===(c==null?void 0:c.structureId)&&k.target.roundNumber===C}))==null?void 0:g.source)==null?void 0:v.roundNumber;E.roundNumbers=[O]}let{completedMatchUps:N}=KP({structureId:P,inContext:!0,matchUpFilters:E,drawDefinition:o}),A=a.map(M=>M.participantId).filter(Boolean);(I=N==null?void 0:N.filter(({matchUpType:M,winningSide:C})=>C&&((d==null?void 0:d.eventType)!==yr||M===yr)).map(({winningSide:M,sides:C})=>M&&(C==null?void 0:C[1-(M-1)])).map(bt).filter(M=>M&&!A.includes(M)))==null||I.forEach(M=>{S.includes(M)||S.push(M)})}let U=t==null?void 0:t.filter(T=>S==null?void 0:S.includes(T.participantId));return U==null||U.forEach(T=>{let P=(o.entries??[]).find(R=>R.participantId===T.participantId);T.entryPosition=P==null?void 0:P.entryPosition}),S!=null&&S.length?{validLuckyLosersAction:{type:c_,method:CTe,availableLuckyLosers:U,availableLuckyLoserParticipantIds:S,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function WTe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:r,tournamentParticipants:n,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:m,event:h}){var f,g,v;let{drawId:I}=c,y=[],b,S,w=[],U=(g=(f=l==null?void 0:l[Io])==null?void 0:f.validSeedPositions)==null?void 0:g.ignore;if(U||({unplacedSeedParticipantIds:b,unplacedSeedAssignments:S,unfilledPositions:w}=mJ({provisionalPositioning:r,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:m,event:h})),w!=null&&w.length||(w=o.filter(T=>!T.participantId&&!T.bye&&!T.qualifier).map(T=>T.drawPosition)),d||y.push({payload:{drawId:I,structureId:m,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:kTe,type:_0}),a&&U){let T=o.map(N=>N.participantId).filter(Boolean),P={structureIds:t},{completedMatchUps:R}=wv({inContext:!0,matchUpFilters:P,drawDefinition:c}),D=ht((v=(R??[]).filter(({matchUpType:N})=>(h==null?void 0:h.eventType)!==yr||N===yr))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(bt)).flat().filter(N=>N&&!T.includes(N))),E=s?n==null?void 0:n.filter(N=>D==null?void 0:D.includes(N.participantId)).map(N=>Fe(N,void 0,!0)):void 0;return E==null||E.forEach(N=>{let A=(c.entries??[]).find(M=>M.participantId===N.participantId);N.entryPosition=A==null?void 0:A.entryPosition}),E!=null&&E.length&&y.push(He({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:i,method:UV,type:Vm,availableParticipantIds:D,participantsAvailable:E})),{validAssignmentActions:y}}if(w.includes(p)||d){let T;if(S!=null&&S.length){let R=S.filter(D=>b==null?void 0:b.includes(D.participantId));R.sort(qTe),T=R.map(D=>D.participantId)}else T=e;let P=s?n==null?void 0:n.filter(R=>T.includes(R.participantId)).map(R=>Fe(R,void 0,!0)):void 0;P!=null&&P.length&&y.push(He({payload:{drawId:I,structureId:m,drawPosition:p},willDisableLinks:i,method:UV,type:Vm,availableParticipantIds:T,participantsAvailable:P}))}return{validAssignmentActions:y}}function qTe(t,e){return t.bye||og(t.seedValue)<og(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function YTe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:r,appliedPolicies:n,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var c,u,d;let p=[],m=[],h=[],f=[],g=i.map(T=>T.participantId).filter(Boolean),v=n==null?void 0:n[Du],I=!(v!=null&&v.disableRoundRestrictions)&&t[o],y=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:b,relevantLinks:S}=RM({targetRoundNumber:I,linkType:Cu,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&f.push(...b);let{sourceStructureIds:w,relevantLinks:U}=RM({targetRoundNumber:I,linkType:Eu,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&f.push(...w);for(let T of S){let P=(c=a.structures)==null?void 0:c.find(D=>D.structureId===T.source.structureId);if((P==null?void 0:P.stage)!==qe)continue;let R=Bc({structureId:T.source.structureId,drawDefinition:a});if(!y||R){let D=P.qualifyingRoundNumber,{matchUps:E}=$t({matchUpFilters:{roundNumbers:[D],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:P});for(let N of E){let A=N.sides.find(C=>(C==null?void 0:C.sideNumber)===N.winningSide),M=N.matchUpStatus===Ft&&((u=N.sides)==null?void 0:u.find(({participantId:C})=>C));if(A||M){let{participantId:C,participant:O}=A||M||{};C&&!g.includes(C)&&(O&&r&&p.push(O),m.push(C))}}}}for(let T of U){let P=(d=a.structures)==null?void 0:d.find(D=>D.structureId===T.source.structureId);if((P==null?void 0:P.stage)!==qe)continue;let R=Bc({structureId:T.source.structureId,drawDefinition:a});if(!y||R){let{positionAssignments:D}=ei({structure:P}),E=(D==null?void 0:D.map(N=>{var A;let M=N.participantId,C=(A=ft({element:N,name:xc}).extension)==null?void 0:A.value;return C?{participantId:M,groupOrder:C==null?void 0:C.groupOrder}:{}}).filter(({groupOrder:N,participantId:A})=>N===1&&!g.includes(A)).map(({participantId:N})=>N))??[];if(E&&m.push(...E),r){let N=e.filter(({participantId:A})=>E.includes(A));p.push(...N)}}}return m.length&&h.push(He({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:PTe,type:dR,qualifyingParticipantIds:m,qualifyingParticipants:r?p:void 0})),{validAssignmentActions:h,sourceStructureIds:f}}function KTe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:r,activeDrawPositions:n,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:m,event:h}){if(n.includes(u))return{};let f=R=>!t||R.participantId||R.qualifier||R.bye,g=r==null?void 0:r.filter(R=>R!==u&&!(c&&s.includes(R))),v=(a==null?void 0:a.filter(R=>f(R)&&(g==null?void 0:g.includes(R.drawPosition))))??[],I=v.map(({drawPosition:R})=>R),{matchUps:y}=$t({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:h}),b=y.filter(({drawPositions:R})=>Dn(R,I)),S=Object.assign({},...b.map(R=>{var D;return(D=R.sides)==null?void 0:D.filter(({sourceDrawPositionRange:E})=>E).map(({drawPosition:E,sourceDrawPositionRange:N})=>({[E]:N}))}).flat()),w=v.map(R=>R.participantId).filter(Boolean),U=(i??[]).filter(R=>w.includes(R.participantId)),T=Object.assign({},...U.map(R=>({[R.participantId]:R}))),P=v.map(R=>{let D=T==null?void 0:T[R.participantId],E=S[R.drawPosition];return He({...R,participant:o?Fe(D,!1,!0):void 0,sourceDrawPositionRange:E})});return P.length?{validSwapAction:{payload:{drawId:m,structureId:d,drawPositions:[u]},willDisableLinks:e,method:MTe,type:d_,availableAssignments:P}}:{}}function m_(t){var e;let i=kt(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:r,returnParticipants:n=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:c}=t,u=t.tournamentParticipants??(o&&Wi({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=et({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:Ri};let m=p.structureId;if(d=Mw({drawDefinition:s,structureId:m}),l===void 0&&!d.isAdHoc)return{error:tv};if(d.isAdHoc)return pR(t);if(d.error)return d;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:g,byeDrawPositions:v}=d,I=Gt({tournamentRecord:o,drawDefinition:s,structure:p,event:c}).appliedPolicies??{};Object.assign(I,r??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:S}=wX({actionType:RS,appliedPolicies:I,drawDefinition:s,structure:p}),w=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:U}=RM({finishingPosition:fv,targetRoundNumber:1,linkType:Eu,drawDefinition:s,structureId:m})||{},T;U!=null&&U.length&&(T=U.reduce((H,W)=>Bc({structureId:W,drawDefinition:s})&&H,!0));let P=U.length,R=U.length&&!T,{policyActions:D}=UX({enabledStructures:b,drawDefinition:s,structure:p}),E=![qe,Oe].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,A=[],{assignedPositions:M,positionAssignments:C}=Tr({structure:p}),O=M==null?void 0:M.find(H=>H.drawPosition===l);if(!((e=C==null?void 0:C.map(H=>H.drawPosition))!=null&&e.includes(l)))return{error:ev};let{stage:k,stageSequence:x}=p,F=[k];k===Yr&&F.push(Oe),k===Oe&&F.push(Yr);let $=Eh({entryStatuses:Dp,provisionalPositioning:a,drawDefinition:s,stageSequence:x,structureId:m,stages:F}),_=Np({drawDefinition:s,stages:F}).assignedParticipantIds??[],L=$.filter(H=>!_.includes(H.participantId)).map(H=>H.participantId),B=v.includes(l),V=g.includes(l);if(S)return{hasPositionAssigned:!!O,info:"Actions Disabled for structure",isActiveDrawPosition:V,isDrawPosition:!0,validActions:[],isByePosition:B};if(Bn({policyActions:D,action:Vm})&&!V&&C&&!R&&(!O||B)){let{validAssignmentActions:H}=WTe({positionSourceStructureIds:U,unassignedParticipantIds:L,possiblyDisablingAction:E,isWinRatioFedStructure:P,tournamentParticipants:u,positionAssignments:C,returnParticipants:n,appliedPolicies:I,drawDefinition:s,isByePosition:B,drawPosition:l,structureId:m,event:c});H==null||H.forEach(W=>A.push(W))}if(Bn({policyActions:D,action:dR})){let{validAssignmentActions:H}=YTe({drawPositionInitialRounds:h,tournamentParticipants:u,positionAssignments:C,returnParticipants:n,appliedPolicies:I,drawDefinition:s,drawPosition:l,structureId:m,drawId:N});H==null||H.forEach(W=>A.push(W))}let{participantId:G}=O||{},j=G&&u.find(H=>H.participantId===G);if(O){Bn({policyActions:D,action:EM})&&!V&&(A.push({type:EM,method:wV,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:E}),B||A.push({type:u_,method:RTe,payload:{drawId:N,structureId:m,drawPosition:l},willDisableLinks:E}),Bn({policyActions:D,action:_0})&&!B&&A.push({type:_0,method:wV,payload:{drawId:N,structureId:m,drawPosition:l,replaceWithBye:!0},willDisableLinks:E}));let H=p.stage===qe||p.stage===Oe&&p.stageSequence===1;if(!B&&SV({activePositionOverrides:w,activeDrawPositions:g,action:fm})&&Bn({policyActions:D,action:fm})&&O0({drawDefinition:s,structureId:m,drawPosition:l})&&H){let{seedAssignments:W}=ao({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y,seedValue:q}=(W==null?void 0:W.find(re=>re.participantId===G))??{};A.push({type:fm,method:xTe,participant:j,seedNumber:Y,payload:{drawId:N,structureId:m,participantId:G,seedValue:q}})}if(!B&&SV({activePositionOverrides:w,activeDrawPositions:g,action:lI})&&Bn({policyActions:D,action:lI})&&O0({drawDefinition:s,structureId:m,drawPosition:l})&&H){let{seedAssignments:W}=ao({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Y}=(W==null?void 0:W.find(q=>q.participantId===G))??{};A.push({method:OTe,type:lI,participant:j,seedNumber:Y,payload:{participantId:G,structureId:m,drawId:N}})}if(!B&&G){if(Bn({policyActions:D,action:jm})){let W={type:jm,method:yX,participant:j,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};A.push(W)}if(Bn({policyActions:D,action:hy})){let W={type:hy,method:ATe,participant:j,payload:{participantId:G,otherName:void 0}};A.push(W)}}if(Bn({policyActions:D,action:d_})){let{validSwapAction:W}=KTe({possiblyDisablingAction:E,tournamentParticipants:u,inactiveDrawPositions:f,activeDrawPositions:g,positionAssignments:C,returnParticipants:n,byeDrawPositions:v,drawDefinition:s,isByePosition:B,drawPosition:l,structureId:m,structure:p,drawId:N});W&&A.push(W)}}if(Bn({policyActions:D,action:l_})&&!R){let{validAlternatesAction:H}=jTe({possiblyDisablingAction:E,tournamentParticipants:u,positionAssignments:C,activeDrawPositions:g,returnParticipants:n,appliedPolicies:I,drawDefinition:s,drawPosition:l,validActions:A,structureId:m,structure:p,drawId:N,event:c});H&&A.push(H)}if(Bn({policyActions:D,action:c_})&&!R&&C){let{validLuckyLosersAction:H}=zTe({sourceStructuresComplete:T,possiblyDisablingAction:E,isWinRatioFedStructure:P,tournamentParticipants:u,activeDrawPositions:g,positionAssignments:C,drawDefinition:s,drawPosition:l,structureId:m,structure:p,drawId:N});H&&A.push(H)}if((j==null?void 0:j.participantType)===st&&Bn({policyActions:D,action:s_})){let{validModifyAssignedPairAction:H}=LTe({tournamentParticipants:u,returnParticipants:n,drawPosition:l,participant:j,drawId:N,event:c});H&&A.push(H)}return{hasPositionAssigned:!!O,isActiveDrawPosition:V,isDrawPosition:!0,isByePosition:B,validActions:A,...Z}}function Kw({policyDefinitions:t,appliedPolicies:e,drawType:i}){var r,n;let a=(r=t==null?void 0:t[U0])==null?void 0:r.drawTypeCoercion,o=(n=e==null?void 0:e[U0])==null?void 0:n.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function fy({tournamentRecord:t,drawDefinition:e,stage:i=Oe,structureId:r,structure:n}){var a;if(!t)return{error:he};if(!n&&!e)return{error:Ce};if(!n&&!r&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(n=e.structures.find(l=>l.stage===i)),!n&&!r)return{error:La};let{error:o,positionAssignments:s}=ei({drawDefinition:e,structureId:r,structure:n});return{positionAssignments:s??[],structureId:n==null?void 0:n.structureId,error:o}}function h_({structureId:t,drawDefinition:e}){if(!e)return{error:Ce};if(!On(t))return{error:oe};let i=bv({drawDefinition:e,structureId:t});if(i.error)return i;let r=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),n=!Hi([Jd,So,FP,Kd],r).length;return{...Z,valid:n}}function NX({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:oe};let i=sv(t);return i?{drawSize:i}:ee({result:{error:oe},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function Jw(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:r}=t||{},{requireParticipantCount:n=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let h=Ju({tournamentRecord:a,drawDefinition:o,event:s});if(h.error)return ee({result:h,stack:l});i=h.policyDefinitions}let u=nt(c);if(c&&!u)return ee({result:{error:oe},context:{participantsCount:c},stack:l});if(n&&!u)return ee({result:{error:RK},stack:l});if(isNaN(r))if(c)({drawSize:r}=NX({participantsCount:c}));else return ee({result:{error:Jb},stack:l});let d=n&&c||r;if(d&&d>r)return{error:rF};let p=i==null?void 0:i[Io];if(!p)return{error:gK};let m=p.seedsCountThresholds;return m?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:m.filter(h=>e?h.drawSize<=r:r===h.drawSize).reduce((h,f)=>c&&c>=f.minimumParticipantCount?f.seedsCount:h,0)}):{error:tK}}function mR({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:r,participantMap:n,enforceGender:a,participants:o,event:s}){var l;if((!o||!n)&&i&&({participants:o,participantMap:n}=Wi({tournamentRecord:i})),!o)return{error:Qb};if(!Array.isArray(o))return{error:oe};if(!s)return{error:Wt};let c=(e==null?void 0:e[Cr])??(r==null?void 0:r[Cr])??Sv[Cr],u=(a??((l=c==null?void 0:c.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,m=d===$c,h=d===oo&&ii||m&&st||wt,f=Object.assign({},...(t??s.entries??[]).map(I=>({[I.participantId]:I.entryStatus}))),g=Object.keys(f),v=o.filter(I=>g.includes(I.participantId)).filter(I=>{let y=JTe({participant:I,participantType:h,eventType:d,entryStatusMap:f}),b=XTe({genderEnforced:u,participantMap:n,eventGender:p,participant:I,isDoubles:m,mismatch:y});return y||!b});if(v.length){let I=v.map(y=>y.participantId);return{error:cK,invalidParticipantIds:I}}return{...Z,valid:!0}}function JTe({participant:t,participantType:e,eventType:i,entryStatusMap:r}){let n=r[t.participantId],a=i&&[$c,oo].includes(i)&&t.participantType===wt&&(Id(n)||n===Nu);return t.participantType!==e&&!a}function XTe(t){var e,i,r;let{participant:n,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:c}=t,u=!s&&l&&ht(((e=n==null?void 0:n.individualParticipantIds)==null?void 0:e.map(h=>{var f,g,v;return(v=(g=(f=a==null?void 0:a[h])==null?void 0:f.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(u!=null&&u.length)||Qs===o||[li,Si].includes(o)&&u[0]===o||oa===o&&(u.length==1&&((i=n.individualParticipantIds)==null?void 0:i.length)===1||u.length===2),p=(r=n==null?void 0:n.person)==null?void 0:r.sex,m=!(n!=null&&n.person)||!o||[Qs,oa].includes(o)||[li,Si].includes(o)&&p===o;return!c||d&&m}function AX({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:r,uuids:n}){var a;let o="generateQualifyingSTructures",s=[],l=[],c=[],u=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,m=0,h,f=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];f=g.roundTarget||f;let I=1,y=0,b,S,w;for(let U of(v||[]).sort(u)){let T=fF(U.drawSize||U.participantsCount),{qualifyingRoundNumber:P,structureOptions:R,matchUpFormat:D,structureName:E,structureId:N,drawType:A}=U,M=U.matchUpType,C=U.qualifyingPositions||ZTe({drawSize:T,qualifyingRoundNumber:P}),O,k,x;if(!nt(T))return ee({result:{error:Jb},stack:o});let F=t.length>1?`${f}-`:"",$=v.length>1||F?I:"",_=E||(F||$?`${zr(qe)} ${F}${$}`:zr(qe));if(A===_o){let{structures:L,groupCount:B,maxRoundNumber:V}=kw({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),stage:qe,structureOptions:R,appliedPolicies:e,stageSequence:I,matchUpType:M,roundTarget:f,drawSize:T,idPrefix:i,isMock:r,uuids:n});y=B,O=V,k=L[0],h=[1]}else({drawSize:T,matchUps:x,roundLimit:O}=tl({qualifyingRoundNumber:P,qualifyingPositions:C,matchUpType:M,drawSize:T,idPrefix:i,isMock:r,uuids:n})),k=Ya({structureName:U.structureName||_,structureId:N||(n==null?void 0:n.pop()),qualifyingRoundNumber:O,stage:qe,matchUpFormat:D,stageSequence:I,matchUpType:M,roundLimit:O,matchUps:x}),f&&Mt({extension:{name:sl,value:f},element:k}),y=((a=x==null?void 0:x.filter(L=>L.roundNumber===O))==null?void 0:a.length)||0;if(I>1){let{link:L}=$w({sourceStructureId:S,sourceRoundNumber:b,targetStructureId:k.structureId,finishingPositions:w===Eu?[1]:void 0,linkType:w});c.push(L),p+=(T||0)-y}else p+=T||0;w=A===_o?Eu:Cu,S=k.structureId,b=O,l.push(k),I+=1}m+=y,s.push({qualifiersCount:y,finalQualifyingRoundNumber:b,finalQualifyingStructureId:S,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:m,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...Z,links:c}}function ZTe({drawSize:t,qualifyingRoundNumber:e}){let i=t,r=0;for(;r<e;)i=Math.floor(i/2),r+=1;return i}function OX(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,r=Xe(t.drawSize),n=e&&(typeof e=="boolean"||e<=2)&&r===2&&Bs||t.drawType||Bs,a=e8.includes(n);if(r&&a){if(e&&(typeof e=="boolean"&&r<4||r<=e))n=Bs;else if(r<4&&i)return{...ee({context:{enforceMinimumDrawSize:i,drawSize:r,drawType:n},result:{error:mP},stack:"getCoercedDrawType"}),drawType:n}}return{drawType:n}}function QTe(t){let{drawDefinition:e,structureOptions:i,requireSequential:r}=t,n={structureName:zr(Oe),...t,stage:Oe},{structures:a,groupCount:o,groupSize:s}=kw(n);if(o<1)return{error:zK};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:zr(Fi)}],[c]=a,{structures:u,links:d}=WJ({sourceStructureId:c.structureId,requireSequential:r,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return u&&a.push(...u),{...Z,structures:a,links:d}}function eDe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let r=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),n=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=r.map((c,u)=>{let d=r.indexOf(c)%2?So:Jd,p=1+u;return{linkType:jl,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:Cu,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:So,roundNumber:n,structureId:t.structureId}},l=[{linkType:Cu,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:So,roundNumber:1,structureId:i.structureId}},{linkType:jl,source:{roundNumber:n,structureId:t.structureId},target:{feedProfile:So,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function tDe({structureName:t,matchUpType:e,idPrefix:i,drawSize:r,isMock:n,uuids:a}){let o=[],{matchUps:s}=Vc({linkFedFinishingRoundNumbers:[1],drawSize:r+1,matchUpType:e,idPrefix:i,isMock:n}),l=wc({structureName:t||zr(Oe),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:Oe,matchUpType:e,matchUps:s});o.push(l);let c=r/2,{matchUps:u}=Vc({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:r-1,isConsolation:!0,matchUpType:e,isMock:n,uuids:a}),d=wc({structureName:zr(Q9),matchUps:u,structureId:a==null?void 0:a.pop(),stage:Yr,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=tl({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:n}),m=wc({structureName:zr(Z9),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Fi,matchUpType:e});o.push(m);let h=eDe({mainStructure:l,consolationStructure:d,deciderStructure:m});return{structures:o,links:h,...Z}}function iDe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:r,matchUpType:n,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!nt(o)||o<2)return{matchUps:[],roundsCount:0};if(ws(o))return tl(t);let c=rDe(o),u=c.shift(),d=Ee(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],m=1;({matchUps:p}=F0({roundNumber:m,matchUpType:n,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),m++;let h=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,I=Ee(1,v+1);r&&v===r&&(h=m-1);let y=I.map(b=>{let S=WL({roundPosition:b,roundNumber:m,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:m,matchUpId:S}});p.push(...y),m++}let f=m-1;return p=mw({finishingPositionOffset:i,lucky:!0,roundsCount:f,roundLimit:h,matchUps:p}),h&&(p=p.filter(g=>g.roundNumber<=h)),{matchUps:p,roundsCount:f,roundLimit:h}}function rDe(t){let e=Xe(t),i=e%2?e+1:e,r=!!(Math.ceil(i/2)%2),n=[{participantsCount:i,preFeedRound:r}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);n.push({participantsCount:i,preFeedRound:l,feedRound:s})}return n}function kX(t){var e,i;let{playoffAttributes:r,stageSequence:n=1,stage:a=Oe,matchUpType:o,drawSize:s,uuids:l}=t,c=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||c()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Gt(t),p=((e=t.policyDefinitions)==null?void 0:e[Xf])||(d==null?void 0:d[Xf]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let m=t.structureName??((i=r==null?void 0:r[0])==null?void 0:i.name)??zr(Oe),h=()=>{let{matchUps:f}=tl(t);return{structures:[Ya({stageSequence:n,structureName:m,matchUpType:o,structureId:u,matchUps:f,stage:a})],links:[],...Z}};return{generators:{[Lo]:()=>({structures:[Ya({finishingPosition:fv,stageSequence:n,structureName:m,matchUps:[],matchUpType:o,structureId:u,stage:a})],links:[],...Z}),[Up]:()=>{let{matchUps:f}=iDe(t);return{structures:[Ya({stageSequence:n,structureName:m,matchUpType:o,structureId:u,matchUps:f,stage:a})],links:[],...Z}},[Bs]:()=>h(),[uw]:()=>tDe(t),[eg]:()=>ff({...t,roundOffsetLimit:3,playoffAttributes:r??zF}),[tg]:()=>ff({...t,roundOffsetLimit:2,playoffAttributes:r??WF}),[Fi]:()=>ff(t),[hv]:()=>{let{matchUps:f}=Vc({drawSize:s,uuids:l,matchUpType:o});return{structures:[Ya({stageSequence:n,structureName:m,matchUpType:o,structureId:u,stage:Oe,matchUps:f})],links:[],...Z}},[cw]:()=>GJ(t),[ig]:()=>Gp({...t,feedRounds:1,fmlc:!0}),[X9]:()=>Gp({...t,feedRounds:1}),[jF]:()=>Gp({...t,feedsFromFinal:1}),[GF]:()=>Gp({...t,feedsFromFinal:2}),[HF]:()=>Gp({...t,feedsFromFinal:3}),[dw]:()=>Gp(t),[LP]:()=>zJ(t),[_o]:()=>kw(t),[Hl]:()=>QTe(t)}}}function f_(t){var e,i,r,n,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:c,drawDefinition:u,tieFormat:d,isMock:p,uuids:m}=t||{},h=Xe(t.drawSize),f=t.drawTypeCoercion??Kw({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=OX({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:f,drawSize:h});if(v.error)return v;let I=v.drawType,y=[],b=[],S=(t==null?void 0:t.matchUpType)??Ni,w=(e=u==null?void 0:u.structures)==null?void 0:e.filter(({stage:j})=>j===qe);w&&y.push(...w);let U=w==null?void 0:w.map(({structureId:j})=>j),T=(i=u==null?void 0:u.structures)==null?void 0:i.find(({stage:j,stageSequence:H})=>j===Oe&&H===1),P=(r=u==null?void 0:u.links)==null?void 0:r.filter(j=>j.target.structureId===(T==null?void 0:T.structureId)&&(U==null?void 0:U.includes(j.source.structureId))),R=(j,H)=>{var W;if(j.linkType===Eu&&H!=null&&H.structures){let Y=j.source.finishingPositions||[];return H.structures.length*Y.length}else if(j.linkType===Cu&&(W=H==null?void 0:H.matchUps)!=null&&W.length){let Y=j.source.roundNumber;return H.matchUps.filter(({roundNumber:q})=>q===Y).length}},D=w==null?void 0:w.map(j=>{var H,W,Y;let q=P==null?void 0:P.find(J=>J.target.structureId===j.structureId),re=((W=(H=ei({structure:j}))==null?void 0:H.positionAssignments)==null?void 0:W.length)??0;if(!q)return re;let K=q==null?void 0:q.source.structureId,z=(Y=u.structures)==null?void 0:Y.find(J=>J.structureId===K),te=R(q,z)||0;return re-te}).filter(Boolean).reduce((j,H)=>j+H,0),E=P==null?void 0:P.map(j=>{let H=j.source.structureId,W=w==null?void 0:w.find(Y=>Y.structureId===H);return R(j,W)}).filter(Boolean).reduce((j,H)=>j+H,0),N=!!(T&&!((n=T==null?void 0:T.matchUps)!=null&&n.length));if(w!=null&&w.length&&!N)return{error:sM};let A=!(w!=null&&w.length)&&t.qualifyingProfiles,M=(A==null?void 0:A.length)&&AX({idPrefix:t.idPrefix,qualifyingProfiles:A,appliedPolicies:l,isMock:p,uuids:m});if(M!=null&&M.error)return M;let{qualifyingDrawPositionsCount:C,qualifyingDetails:O,qualifiersCount:k}=M||{qualifyingDrawPositionsCount:D,qualifiersCount:E};C&&(M!=null&&M.structures&&y.push(...M.structures),M!=null&&M.links&&b.push(...M.links)),Object.assign(t,He({drawSize:h,matchUpType:S,tieFormat:d}));let x=I!==Lo&&(!h||h<2||!c&&![hv,Up].includes(I)&&([Hl,_o].includes(I)&&h<3||![_o,Hl].includes(I)&&!ws(h)));if(x&&!C)return ee({context:{drawSize:h,invalidDrawSize:x},result:{error:mP},stack:g});let{generators:F,error:$}=kX(t);if($)return{error:$};let _=F[I];if(!_)return{error:jx};let L=_==null?void 0:_();if(L.error)return L;let{structures:B,links:V}=L;if(B!=null&&B.length){let j=B.find(({stage:H,stageSequence:W})=>H===Oe&&W===1);if(T&&j){if(N){let H=j.structureId;if(j.structureId=T.structureId,V==null?void 0:V.length)for(let W of V)W.source.structureId===H&&(W.source.structureId=T.structureId),W.target.structureId===H&&(W.target.structureId=T.structureId)}else if(!s)return{error:sM}}y.push(...B)}y.sort(Rh),V!=null&&V.length&&b.push(...V);let G=L.structures.find(({stage:j,stageSequence:H})=>j===Oe&&H===1);for(let j of O||[]){let{finalQualifyingRoundNumber:H,finalQualifyingStructureId:W,roundTarget:Y,finishingPositions:q,linkType:re}=j,K=G&&((a=$w({targetStructureId:G.structureId,sourceStructureId:W,sourceRoundNumber:H,finishingPositions:q,targetEntryRound:Y,linkType:re}))==null?void 0:a.link);if(K!=null&&K.error)return K;K&&b.push(K)}return P&&b.push(...P),{...Z,qualifyingResult:{qualifyingDrawPositionsCount:C,qualifiersCount:k},structures:y,links:b}}function g_(t){var e,i;let{modifyOriginal:r=!0,stageSequence:n=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ee({result:{error:Ce},stack:o});let s=r?t.drawDefinition:Fe(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:c}=t;if(l){let S=Kn({tieFormat:l});if(S.error)return S}l=Vr(l??((e=cn({drawDefinition:s}))==null?void 0:e.tieFormat)),c=c??(s.matchUpType||Ni),t.tieFormat=l,t.matchUpType=c;let u=A0({drawDefinition:s,stage:Oe});t.drawSize=t.drawSize??u,!u&&t.drawSize&&x0({drawSize:t.drawSize,drawDefinition:s,stageSequence:n,stage:Oe});let d=Zr({drawDefinition:s}).drawMatchUps.map(wr),p=f_(t);if(p.error)return ee({result:p,stack:o});let{structures:m,links:h,qualifyingResult:f}=p;s.structures=m,s.links=h;let g=Math.max(t.qualifiersCount??0,(f==null?void 0:f.qualifiersCount)||0);if(f!=null&&f.qualifyingDrawPositionsCount&&!A0({stage:qe,drawDefinition:s})){let S=x0({drawSize:f.qualifyingDrawPositionsCount,stage:qe,drawDefinition:s});if(S.error)return S}if(g){let S=LJ({qualifiersCount:g,drawDefinition:s,stage:Oe});if(S.error)return S}let v=t.drawSize??u;Object.assign(t,He({drawSize:v,matchUpType:c,tieFormat:l}));let{matchUps:I,matchUpsMap:y}=cr({drawDefinition:s});l&&(I==null||I.forEach(S=>{if(!d.includes(S.matchUpId)){let{tieMatchUps:w}=Vw({tieFormat:l,matchUp:S,isMock:a});Object.assign(S,{tieMatchUps:w,matchUpType:c})}}));let{inContextDrawMatchUps:b}=ip({drawDefinition:s,matchUpsMap:y});return pi({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:b,drawDefinition:s,matchUpsMap:y,...Z,structures:m,matchUps:I,links:h}}function lg(t){let{tournamentRecord:e,scaleAttributes:i,participantId:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!r)return{error:vr};let{participant:a,tournamentId:o}=Mp({tournamentRecords:n,tournamentRecord:e,participantId:r});return a?{...Pl({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Ji}}function ug(t){let{removePriorValues:e,tournamentRecord:i,participantId:r,scaleItem:n}=t,a,o;if(!FX({scaleItem:n}))return{error:tw};if(r&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===r),o)){let s=LX({removePriorValues:e,participant:o,scaleItem:n});if(s.error)return s;a=!s.valueChanged;let{topics:l}=qo();l.includes(Kr)&&Tt({topic:Kr,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...Z,info:dF,existingValue:n==null?void 0:n.scaleValue}||o&&{...Z,newValue:n==null?void 0:n.scaleValue}||{error:Ji}}function xX(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:r,tournamentRecord:n,auditData:a,context:o}=t;if(!n)return{error:he};if(!n.participants)return{error:Qb};let s=0,l={},c=[];for(let p of i){let m=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let h of p.scaleItems)if(FX({scaleItem:h}))Array.isArray(l[m])||(l[m]=[]),l[m].push(h);else return{error:tw}}n.participants.forEach(p=>{let{participantId:m}=p||{};Array.isArray(l[m])&&l[m].forEach(h=>{LX({participant:p,scaleItem:h,removePriorValues:r}),c.push(p),s++})});let u=s?void 0:ov,{topics:d}=qo();if(d.includes(Kr)&&s&&Tt({topic:Kr,payload:{tournamentId:n.tournamentId,participants:c}}),o){let{eventId:p,drawId:m,...h}=o,f=((e=h.scaleAttributes)==null?void 0:e.scaleType)&&[h.scaleAttributes.scaleType];if(Object.keys(h).length){let g={itemType:YF,itemValue:h};if(f&&(g.itemSubTypes=f),m||p){let{drawDefinition:v,event:I}=xn({tournamentRecord:n,eventId:p,drawId:m});m&&zL({drawDefinition:v,timeItem:g}),p&&_h({event:I,timeItem:g})}else Lh({tournamentRecord:n,timeItem:g})}}return a&&d.includes(rg)&&Tt({topic:rg,payload:a}),He({...Z,modificationsApplied:s,info:u})}function FX({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(r=>e==null?void 0:e.includes(r)).length===i.length}function LX({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:wh};let r=i&&Object.keys(i),n=["scaleType","eventType","scaleName"];if(n.filter(c=>r.includes(c)&&i[c]).length!==n.length)return{error:tw};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=Pl({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Om,c,u,d].join("."),m=He({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(m.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(h=>h.itemType!==p)),e.timeItems.push(m)}return{...Z,valueChanged:l,newValue:i.scaleValue}}var Td="ELO",_X="NTRP",nDe="TRN",$X="UTR",v_="WTN",aDe={ELO:Td,NTRP:_X,TRN:nDe,UTR:$X,WTN:v_},oDe={[Td]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[_X]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[$X]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[v_]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},Ta=oDe,sDe=t=>250/Math.pow(t+5,.4),lDe=()=>1;function uDe(t=3,e=2){let i=t/e;return isNaN(i)?tf.kDefault():i}var tf={nSpread:400,diffThreshold:.125,kCalc:sDe,kMultiplier:uDe,kDefault:lDe};function BX(t){let{winnerRating:e,loserRating:i,ratingRange:r}=t,{ratings:n=Ta,winnerCountables:a=1,loserCountables:o=0,ratingType:s=Td,maxCountables:l,countables:c}=t||{},u=n==null?void 0:n[s];if(!u)return{error:Ve};r=u.range||r,e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=r[0]>r[1],p=u.decimalsCount||0,m=d?r.slice().reverse():r,h=(O,k)=>parseFloat(k)>=Math.min(...O)&&parseFloat(k)<=Math.max(...O);(!h(r,e)||!h(r,i))&&(h(r,e)||(e=u.defaultInitialization),h(r,i)||(i=u.defaultInitialization));let f=({value:O,sourceRange:k,targetRange:x})=>(O-k[0])*(x[1]-x[0])/(k[1]-k[0])+x[0],g=f({targetRange:Ta[Td].range,sourceRange:m,value:d?r[0]-e:e}),v=f({targetRange:Ta[Td].range,sourceRange:m,value:d?r[0]-i:i}),I=(O,k)=>1/(1+Math.pow(10,(k-O)/tf.nSpread)),y=I(g,v),b=I(v,g),S=tf.kCalc(a),w=tf.kCalc(o),U=tf.kMultiplier(l,c),T=g+U*S*(1-y),P=v+U*w*(0-b),R=f({sourceRange:Ta[Td].range,value:T,targetRange:m}),D=f({sourceRange:Ta[Td].range,value:P,targetRange:m}),E=d?r[0]-R:R,N=parseFloat(parseFloat(E).toFixed(p)),A=d?r[0]-D:D,M=parseFloat(parseFloat(A).toFixed(p)),C=Math.max(...r)?Math.abs(e-i)/Math.max(...r):0;return(R>D&&C>tf.diffThreshold||N<0||M<0)&&(N=e,M=i),{newWinnerRating:N,newLoserRating:M}}var cDe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function VX(t){var e,i;let{removePriorValues:r=!0,tournamentRecord:n,ratingType:a=Td,considerGames:o,matchUpIds:s,asDynamic:l}=t;if(!n)return{error:he};if(!Array.isArray(s))return{error:Xl};if(typeof a!="string")return{error:oe,ratingType:a};if(!Ta[a])return{error:oe};let c=Ta[a],{accessor:u}=c,d={},p=t.matchUps??Lr({matchUpFilters:{matchUpIds:s,matchUpStatuses:Sr},tournamentRecord:n,inContext:!0}).matchUps??[];p.sort(Ah);for(let h of p){let{endDate:f,matchUpFormat:g,score:v,sides:I,winningSide:y}=h,b=h.matchUpType,S={eventType:b,scaleName:a,scaleType:Cd},w=`${a}.${P9}`,U={scaleName:w,eventType:b,scaleType:Cd},T=Object.assign({},...(I??[]).map(k=>{let{sideNumber:x,participant:F}=k;return x&&{[x]:[F==null?void 0:F.participantId,...(F==null?void 0:F.individualParticipantIds)??[]].filter(Boolean).flat()}})),P=l?w:a,R=Object.assign({},...Object.values(T).flat().map(k=>{let{scaleItem:x}=lg({scaleAttributes:U,tournamentRecord:n,participantId:k}),{scaleItem:F}=lg({tournamentRecord:n,scaleAttributes:S,participantId:k}),$=u?{[u]:void 0}:void 0;return k&&{[k]:x??F??{scaleName:P,eventType:b,scaleDate:f,scaleType:Cd,scaleValue:$}}})),D=g?_n(g):{},E=(D==null?void 0:D.bestOf)||1,N=(D==null?void 0:D.setsTo)||1,A=o?E&N:E,M=(v==null?void 0:v.sets)&&cDe(v.sets)||y===1&&[1,0]||[0,1],C=y?T[y]:[],O=y?T[3-y]:[];for(let k of C){let x=(e=R[k])==null?void 0:e.scaleValue,F=typeof x=="object"?x[u]:x;for(let $ of O){let _=(i=R[$])==null?void 0:i.scaleValue,L=typeof _=="object"?_[u]:_,B=y?M[y]:[0,0],V=y?M[3-y]:[0,0],{newWinnerRating:G,newLoserRating:j}=BX({winnerCountables:B,loserCountables:V,maxCountables:A,winnerRating:F,loserRating:L,ratingType:a}),H=u?{...x,[u]:G}:G,W=u?{..._,[u]:j}:j;R[k].scaleValue=H,R[$].scaleValue=W;let Y=ug({participantId:k,removePriorValues:r,tournamentRecord:n,scaleItem:{...R[k],scaleName:P}});if(Y.error||(Y=ug({participantId:$,removePriorValues:r,tournamentRecord:n,scaleItem:{...R[$],scaleName:P}}),Y.error))return Y}}Object.assign(d,R)}let m=p.map(({matchUpId:h})=>h);return{...Z,modifiedScaleValues:d,processedMatchUpIds:m}}function hR(t){var e;let{matchUpIds:i=[],drawDefinition:r,roundNumber:n,newRound:a,isMock:o,event:s}=t;if(typeof r!="object")return{error:Ce};let{participantIdPairings:l,matchUpsCount:c}=t,u=cR(t);if(u.error)return ee({result:u});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:m=0}=u;if(!c)a?c=m:p>0&&(c=p);else if(c>m&&t.restrictMatchUpsCount!==!1)return ee({result:{error:oe,info:"matchUpsCount error",context:{roundMatchUpsCount:m}}});if(l&&!Array.isArray(l)||c&&!nt(c)||i&&!Array.isArray(i)||!l&&!c)return{error:oe,info:"matchUpsCount or pairings error"};if(c&&t.restrictMatchUpsCount!==!1&&c>32)return{error:oe,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(d||0))return{error:oe,info:"roundNumber error"};let h=n??(a&&(d??0)+1||d||1);l=l??Ee(0,c).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let I=r.drawId,y=t.idPrefix??"ah";return`${I}-${y}-${h}-${v}`},g=l==null?void 0:l.map((v,I)=>{let y=(v==null?void 0:v.participantIds)??[void 0,void 0];y.push(void 0,void 0);let b=y.slice(0,2).map((w,U)=>He({sideNumber:U+1,participantId:w})),S=i[I]??f(I)??Yt();return{roundNumber:h,matchUpStatus:zi,matchUpId:S,sides:b}});if(g!=null&&g.length){let v=(e=cn({drawDefinition:r,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(I=>{let{tieMatchUps:y}=Vw({tieFormat:v,matchUp:I,isMock:o});Object.assign(I,{tieMatchUps:y,matchUpType:di})})}return{roundNumber:h,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...Z}}function dDe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:r,deltaObjects:n}){let a=Object.assign({},...e.map(I=>({[I.pairing]:I.value}))),o=Object.keys(i),s=[],l=DV({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r}),c=[WE(l)];s.push(l);let u=l.value,d=l,p=0,m=0,h=o.length,f;do h-=1,f=o.length*i[o[0]].length;while(f>t&&h>5);let g=[];o.forEach(I=>{i[I].slice(0,h).forEach(y=>{m+=1;let b=gm(I,y.opponent);if(!g.includes(b)){let S=DV({stipulated:[[I,y.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:n,valueObjects:r});if(!c.includes(WE(S))){c.push(WE(S)),s.push(S);let{maxDelta:w,value:U}=S;w<d.maxDelta&&(d=S),(U<u||U===u&&Math.round(Math.random()))&&(u=U),g.push(b),p+=1}}}),s=s.filter(y=>Math.abs(y.value-u)<5)}),s.sort((I,y)=>I.maxDiff-y.maxDiff);let v=ra(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:m,candidate:v}}function WE(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function DV({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:r,valueObjects:n,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,m]=d,h=gm(p,m),f=i[h];s.push({participantIds:d,value:f}),l+=i[h]}),xr(t,a).map(d=>hn(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((m,h)=>o.includes(h)||m,!1)){o.push(...p);let m=d.value;l+=m,s.push({participantIds:p,value:m})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=gm(m,h),g=r[f];return g>d?g:d},0),u=s.reduce((d,p)=>{let[m,h]=p.participantIds,f=gm(m,h),g=n[f];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function gm(t,e){return[t,e].sort(JP).join("|")}function jX({participantIds:t}){let e={},i=[];t.forEach(n=>{e[n]=t.filter(a=>a!==n),e[n].forEach(a=>{let o=gm(a,n);i.includes(o)||i.push(o)})});let r=Object.assign({},...i.map(n=>({[n]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:r}}function pDe({matchUps:t}){let e=[];for(let i of t){let r=i.sides.map(bt);if(r.length===2){let[n,a]=r,o=gm(n,a);e.includes(o)||e.push(o)}}return{encounters:e}}function mDe({possiblePairings:t,valueObjects:e}){let i={};for(let n of Object.keys(t)){let a=t[n].map(o=>r(n,o));i[n]=a.sort((o,s)=>o.value-s.value)}function r(n,a){let o=gm(n,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var hDe=0;function fDe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:r,pairing:n}){var a;let o=((a=Ta[r])==null?void 0:a.defaultInitialization)??hDe;return n.split("|").map(s=>{var l;if(i===$o){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||o):o*2}else return e[s]||o})}function gDe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:r,maxIterations:n,deltaObjects:a,valueObjects:o,eventType:s,scaleName:l,salted:c}){r.forEach(v=>{let I=fDe({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),y=typeof c=="number"&&c||.5,b=c&&(Math.round(Math.random())?y:y*-1)||0,S=Math.abs(I[0]-I[1])+b,w=Math.abs(I[0]-I[1]);a[v]=w,o[v]||(o[v]=0),o[v]+=S?Math.pow(S,2):0});let u=r.map(v=>({pairing:v,value:o[v]})).sort((v,I)=>v.value-I.value),{pairingValues:d}=mDe({possiblePairings:i,valueObjects:o}),{candidate:p,candidatesCount:m,deltaCandidate:h,iterations:f}=dDe({valueSortedPairings:u,maxIterations:n,pairingValues:d,deltaObjects:a,valueObjects:o}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:m,deltaCandidate:h,iterations:f,candidate:p}}var vDe=100,IDe=100,yDe=4e3;function I_({encounterValue:t=vDe,sameTeamValue:e=IDe,maxIterations:i=yDe,generateMatchUps:r=!0,ignoreLastRoundNumber:n,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:l,drawDefinition:c,adHocRatings:u,salted:d=.5,roundNumber:p,structureId:m,matchUpIds:h,eventType:f,structure:g,scaleName:v,idPrefix:I,isMock:y,event:b}){var S,w;if(!c)return{error:Ce};if(!g&&!m)return{error:Ri};if(g||(g=et({drawDefinition:c,structureId:m}).structure),!Ii(g))return{error:td};if(!(l!=null&&l.length))return{error:id};let U=[...a??[],...(g==null?void 0:g.matchUps)??[]],{encounters:T}=pDe({matchUps:U}),P=(o==null?void 0:o.participants)??[];if(s){let L=ht(g!=null&&g.matchUps?g.matchUps.map(({roundNumber:V})=>V):[]),B=Math.max(...L,0);if(B){let V=(S=g==null?void 0:g.matchUps)==null?void 0:S.filter(({roundNumber:G})=>G===B).map(({matchUpId:G})=>G);VX({ratingType:v||((w=b==null?void 0:b.category)==null?void 0:w.ratingType),tournamentRecord:o,asDynamic:!0,matchUpIds:V})}}let{valueObjects:R}=bDe({tournamentParticipants:P,encounterValue:t,sameTeamValue:e,encounters:T}),{uniquePairings:D,possiblePairings:E,deltaObjects:N}=jX({participantIds:l}),A={tournamentParticipants:P,possiblePairings:E,drawDefinition:c,participantIds:l,uniquePairings:D,maxIterations:i,adHocRatings:u,deltaObjects:N,valueObjects:R,eventType:f,scaleName:v,structure:g,salted:d},{candidatesCount:M,participantIdPairings:C,iterations:O,candidate:k}=gDe(A);if(!M)return{error:bP};let x,F;if(r){let L=hR({structureId:g==null?void 0:g.structureId,ignoreLastRoundNumber:n,participantIdPairings:C,newRound:!0,drawDefinition:c,roundNumber:p,matchUpIds:h,idPrefix:I,isMock:y,event:b});if(L.error)return L;x=L.roundNumber,F=L.matchUps}let{maxDelta:$,maxDiff:_}=k;return{roundNumber:x,participantIdPairings:C,candidatesCount:M,...Z,iterations:O,matchUps:F,maxDelta:$,maxDiff:_}}function bDe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:r}){let n={};for(let o of t)n[o]||(n[o]=0),n[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===ii);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=jX({participantIds:s});for(let c of l)n[c]||(n[c]=0),n[c]+=r}return{valueObjects:n}}function GX(t){var e,i,r,n;let{drawType:a=Bs,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:c,automated:u,placeByes:d,isMock:p,event:m}=t,h=t==null?void 0:t.drawDefinition;if(!h)return{error:Ce};let f=Mr,g=Eh({stageSequence:1,drawDefinition:h,stage:f}),v=[_o,uw,Hl].includes(a)?g.length:sv(g.length);if(!c&&a===hv&&g.length<2||a===_o&&g.length<3)return{error:mP};let{tieFormat:I,matchUpType:y}=t;if(I){let M=Kn({tieFormat:I});if(M.error)return M}I=Vr(I??((e=cn({drawDefinition:h}))==null?void 0:e.tieFormat)),y=y??h.matchUpType??Ni;let{structures:b}=zl({stageSequence:1,drawDefinition:h,stage:f});if(b.length>1)return{error:dK};if((r=(i=b==null?void 0:b[0])==null?void 0:i.matchUps)!=null&&r.length)return{error:mF};let S=(n=b==null?void 0:b[0])==null?void 0:n.structureId;Object.assign(t,He({structureName:t.structureName??zr(Mr),structureId:S,matchUpType:y,tieFormat:I,drawSize:v,stage:f}));let w=kX(t);if(w.error)return w;let U=w.generators[a];if(!U)return{error:jx};let T=U==null?void 0:U();if(T.error)return T;let{structures:P,links:R}=T,D=P.map(M=>$t({structure:M}).matchUps).flat();I&&D.forEach(M=>{let{tieMatchUps:C}=Vw({matchUp:M,tieFormat:I,isMock:p});Object.assign(M,{tieMatchUps:C,matchUpType:y})}),(!s||!o)&&(h=Fe(h,!1,!0)),h.links||(h.links=[]),R.length&&h.links.push(...R);let E=P.map(({structureId:M})=>M);h.structures||(h.structures=[]);let N=h.structures.map(({structureId:M})=>M);h.structures=h.structures.map(M=>E.includes(M.structureId)?P.find(({structureId:C})=>C===M.structureId):M);let A=P.filter(({structureId:M})=>!N.includes(M));return A.length&&h.structures.push(...A),u&&Lw({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:h,structureId:S,placeByes:d,drawSize:v,event:m}),o&&pi({drawDefinition:h}),{links:R,structures:P,...Z}}var y_={};yt(y_,{addGame:()=>XX,addPoint:()=>JX,addSet:()=>QX,addShot:()=>ZX,analyzeSet:()=>vy,calculateHistoryScore:()=>qX,checkScoreHasValue:()=>_r,checkSetIsComplete:()=>vR,clearHistory:()=>KX,generate:()=>HX,generateScoreString:()=>El,generateTieMatchUpScore:()=>Ww,getSetComplement:()=>P_,getTiebreakComplement:()=>wR,helpers:()=>rZ,isValidMatchUpFormat:()=>Ia,keyValueScore:()=>CZ,mutate:()=>WX,parseMatchUpFormat:()=>_n,parseScoreString:()=>j0,query:()=>kZ,redo:()=>eZ,reverseScore:()=>zX,setServingSide:()=>YX,stringifyMatchUpFormat:()=>aR,tidyScore:()=>OZ,umo:()=>iZ,undo:()=>tZ,validateScore:()=>D_,validateTieFormat:()=>Kn});var HX={};yt(HX,{generateScoreString:()=>El,generateTieMatchUpScore:()=>Ww,reverseScore:()=>zX});function El(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:r=!1,matchUpStatus:n,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:Ve,info:"missing sets"};let c=a&&_n(a),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},m=r||!(!e||!s||s===1),h=i?wDe({matchUpStatus:n}):"",f=(l==null?void 0:l.sort(UDe).map(g).filter(Boolean).join(" "))||"";if(!h)return f;if(s===2)return`${h} ${f}`;return`${f} ${h}`;function g(v){let I=u&&v.setNumber===u&&d?d:p,y=O=>ki(O==null?void 0:O.side1Score)||ki(O==null?void 0:O.side2Score),b=O=>ki(O==null?void 0:O.side1TiebreakScore)||ki(O==null?void 0:O.side2TiebreakScore),S=(I==null?void 0:I.tiebreakSet)||!y(v)&&b(v),{side1Score:w,side2Score:U,side1TiebreakScore:T,side2TiebreakScore:P}=v,R=T||(ki(T)||o?0:""),D=P||(ki(P)||o?0:"");if(S)return`[${(m?[D,R]:[R,D]).join("-")}]`;let E=Math.min(R,D),N=E?`(${E})`:"",A=w||(ki(w)||o?0:""),M=U||(ki(U)||o?0:""),C=m?`${[M,A].join("-")}${N}`:`${[A,M].join("-")}${N}`;return["-"," "].includes(C)&&(C=""),C}}function wDe({matchUpStatus:t}){let e={[dn]:"RET",[jt]:"WO",[hr]:"DF/DF",[ir]:"WO/WO",[ld]:"SUS",[Ca]:"ABN",[Ot]:"DEF",[mv]:"DR"};return t&&e[t]||""}function UDe(t,e){return t.setNumber-e.setNumber}function zX(t){if(!(t!=null&&t.score))return{error:Ve};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=a;return He({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:u,side2Score:c,setNumber:d})}),r=El({sets:i}),n=El({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:r,scoreStringSide2:n},...Z}}var WX={};yt(WX,{addGame:()=>XX,addPoint:()=>JX,addSet:()=>QX,addShot:()=>ZX,calculateHistoryScore:()=>qX,clearHistory:()=>KX,redo:()=>eZ,setServingSide:()=>YX,umo:()=>iZ,undo:()=>tZ});function Ap({matchUp:t}){let{extension:e}=ft({name:OP,element:t});if(!e)return{error:on};let{history:i=[],undoHistory:r=[]}=e.value;return{history:i,undoHistory:r,...Z}}function qX(t){var e,i;if(!t)return{error:Ve};let{matchUp:r,updateScore:n}=t;if(!r)return{error:Yn};let a=((e=Ap({matchUp:r}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:oe,info:"history is not an array"};let{matchUpFormat:o}=r;if(!o)return{error:Jx};if(!Ia({matchUpFormat:o}))return{error:Kx};let s=_n(o),{bestOf:l,finalSetFormat:c,setFormat:u}=s,d=["0","15","30","40","A","G"],p={sets:[]},m=[],h,f=[0,0],g=1,v=0,I,y=0,b=E=>[1,2].includes(E),S=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),U=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),T=U(),P=w(),R=S(),D=0;for(let E of a){D+=1,I=p.sets.length+1===l;let N=I&&c?c:u,{tiebreakAt:A,setTo:M,NoAD:C,tiebbreakFormat:O}=N,k=R.side1Score===A&&R.side1Score===R.side2Score,x=!!N.tiebreakSet,F=x?N.tiebreakSet:O,{tiebreakTo:$,NoAD:_}=F||{},L=()=>{h=void 0,f=[0,0],g=3-g,R.side1TiebreakScore=0,R.side2TiebreakScore=0,R.side1PointScore="",R.side2PointScore="",y=0},B=j=>{R.winningSide=j;let{s:H,...W}=R;p.sets.push(W),T=U(),P=w(),R=S(),L()},V=j=>{P.winningSide=j;let{g:H,...W}=P;R.games.push(W),T=U(),P=w(),L();let Y=`side${j}Score`;R[Y]+=1},G=j=>{T.winningSide=j;let{p:H,...W}=T;P.points.push(W),T=U(),y=0;let Y=()=>f.reduce((re,K)=>re+K)%4/4>.5?g:3-g,q=j-1;if(k||x){f[q]+=1,h=Y(),R[`side${j}TiebreakScore`]=f[q],R[`side${3-j}TiebreakScore`]=f[1-q];let re=_?1:2;if(f[q]>=$&&f[q]>=f[1-q]+re)return V(j),{gameCompleted:!0}}else if(f[1-q]===4&&f[q]===3?f[1-q]-=1:f[q]+=1,R.side1PointScore=d[f[0]],R.side2PointScore=d[f[1]],f[q]===5||f[q]===4&&f[1-q]<3||C&&f[q]===4)return V(j),{gameCompleted:!0}};if(b(E.srv)&&(g=E.srv),["p","s","g","o"].includes(E.u)&&m.push(E.u),E.shotOutcome&&(T.shots.push(E),E.shotType==="SERVE"&&["OUT","NET"].includes(E.shotOutcome)&&(y+=1),y===2)){let j=3-g;G(j)}if(b(E.p)||nt(E.pointNumber)){let j=E.winningSide||E.p;if((i=G(j))!=null&&i.gameCompleted)continue}if(b(E.g)||nt(E.gameNumber)){let j=E.winningSide||E.g;P.winningSide=j;let H=`side${j}Score`,W=`side${3-j}Score`;if(m.length&&(m.includes("p"),m=[]),V(j),R[H]===M&&R[H]-R[W]>=(C?1:2)&&(B(j),I))break}if(b(E.s)||nt(E.setNumber)){let j=E.winningSide||E.s;if(B(j),m.length&&(m.includes("p"),m.includes("g"),m=[]),I)break}}return D!==a.length&&console.log({error:"Match completed with excess history"}),(R.side1Score||R.side2Score||R.games.length||R.side1TiebreakScore||R.side2TiebreakScore)&&p.sets.push(R),p.scoreStringSide1=El({...p,matchUpFormat:o}),p.scoreStringSide2=El({...p,matchUpFormat:o,reversed:!0}),g=h||g,n&&(r.score=p),{...Z,servingSide:g,score:p}}function Op({undoHistory:t,history:e,matchUp:i}){return Mt({element:i,extension:{value:{history:e,undoHistory:t},name:OP}})}function YX({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:eF};let{history:i=[]}=Ap({matchUp:t});return i.push({srv:e}),Op({matchUp:t,history:i})}function KX({matchUp:t}){return Op({matchUp:t})}function JX({matchUp:t,point:e}){if(!e||!t)return{error:Ve};if(typeof e!="object")return{error:oe,context:{point:e}};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function XX({matchUp:t,game:e}){if(typeof e!="object")return{error:oe,context:{game:e}};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function ZX({matchUp:t,shot:e}){if(typeof e!="object")return{error:Ve};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function QX({matchUp:t,set:e}){if(typeof e!="object")return{error:Ve};let{history:i=[]}=Ap({matchUp:t});return i.push(e),Op({matchUp:t,history:i})}function eZ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ap({matchUp:t});return i.length&&e.push(i.pop()),Op({matchUp:t,history:e,undoHistory:i})}function tZ({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ap({matchUp:t});return i.push(e.pop()),Op({matchUp:t,history:e,undoHistory:i})}var iZ={},rZ={};yt(rZ,{keyValueScore:()=>CZ,parseMatchUpFormat:()=>_n,stringifyMatchUpFormat:()=>aR,tidyScore:()=>OZ});var vm=" ",LM="DEF",SDe="COMPLETED",nZ="WO",TDe="WO/WO",aZ="ABN",oZ="SUS",sZ="RET",lZ="INT",uZ=[sZ,LM,nZ,TDe,aZ,oZ,lZ],_M="DEFAULTED",cZ="WALKOVER",dZ="ABANDONED",pZ="SUSPENDED",mZ="RETIRED",hZ="INTERRUPTED",DDe=[mZ,_M,cZ],PDe="Enter Score",Gm="()",ap="[]",b_=["up","left","shift+tab"],w_=["enter","down","tab","right"],$0="backspace",fZ="r",gZ="s",vZ="a",IZ="d",yZ="w",bZ="i",fR=[fZ,IZ,yZ,vZ,gZ,bZ],gR="space",qE=["[","("],B0=[...b_,...w_,gR,"]"],wZ="-",RDe="/",Im=wZ,Cl=wZ,UZ=[RDe],EDe=0,CDe=["=","+","num_1","num_2","shift+=","shift+-"],U_=["0","1","2","3","4","5","6","7","8","9"].concat(fR),SZ=U_.map(t=>`shift+${t}`),TZ=[Im,$0].concat(B0,UZ),DZ=[U_,SZ,TZ].join(","),MDe=[DZ,b_,w_,CDe].join(","),NDe={OUTCOMEKEYS:fR,SIDE1KEYS:U_,SIDE2KEYS:SZ,MODIFIERS:TZ,PROMPT:PDe,MOVEUP:b_,MOVEDOWN:w_,HOTKEYS:MDe};function Xh({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=PZ({scoreString:t}),e===2){let r=(t&&t[t.length-1])!==vm?vm:"";return t+r+i}else return i+vm+t}function PZ({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of uZ){let r=t==null?void 0:t.indexOf(i);r===0?t=t.slice(i.length+1).trim()+vm:r>0&&(t=t.slice(0,r)),r>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function $M({analysis:t,scoreString:e,sets:i,lowSide:r}){var n,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:c,removed:u}=PZ({scoreString:e});if(e=c,u)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(I=>I!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:m}=t.setFormat,{tiebreakTo:h,NoAD:f}=m||{},{isTiebreakEntry:g}=gf({brackets:ap,scoreString:e}),v=ODe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:I}=gf({brackets:Gm,scoreString:s}),{lastOpenBracketIndex:y,isTiebreakEntry:b}=gf({brackets:ap,scoreString:s}),S=s&&s[s.length-1].trim(),w=s&&!isNaN(S),U=t.isIncompleteSetScore;if(g&&b){let T=s.slice(y+1).split(Cl),P=(T==null?void 0:T.length)>0&&T[0]!==void 0&&!isNaN(parseInt(T[0]))&&parseInt(T[0])||void 0,R=(T==null?void 0:T.length)>1&&T[1]!==void 0&&parseInt(T[1])||void 0,D=[P,R];if(R){let E=r===1?1:0;D[E]=((D==null?void 0:D[1-E])||0)+(f?1:2),(D[E]||0)<h&&(D[E]=h),s=e.slice(0,y+1),s+=D.join(Cl)}else P!==void 0?(s=e.slice(0,y+1),s+=P):(s=e.slice(0,y),U=!0);d.side1TiebreakScore=D[0]||0,d.side2TiebreakScore=D[1]||0}if(s.length||(s=void 0),U){let T=(n=d.side1Score)==null?void 0:n.toString();if(T){let P=T==null?void 0:T.slice(0,T.length-1);d.side1Score=!isNaN(P)&&parseInt(P)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let T=(a=d.side2Score)==null?void 0:a.toString(),P=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let R=T==null?void 0:T.slice(0,T.length-1);d.side2Score=!isNaN(R)&&parseInt(R)||void 0}else{let R=P==null?void 0:P.slice(0,P.length-1);d.side1Score=!isNaN(R)&&parseInt(R)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else I?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!b?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function gf({brackets:t=Gm,scoreString:e}){if(!e)return{};let[i,r]=t.split(""),n=e.split(""),a=Math.max(...$s(i,n)),o=Math.max(...$s(r,n));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function ADe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[r,n]=ap.split(""),a=t.split(""),o=Math.max(...$s(r,a)),s=Math.max(...$s(n,a)),l=Math.max(...$s(Cl,a));return i&&o>s&&l>o}function ODe(t){return t.split("").reduce((e,i,r)=>(i.match(/\d+/g)&&e.push(r),e),[]).pop()}function RZ(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:r}=t||{},n=i?1:2;return e+1>=r?e+n:parseInt(r)}function PV({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:r}){var n;let a=_n(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((n=r==null?void 0:r.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:n.indexOf(s))+1||void 0;return DDe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function vR({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:r,isDecidingSet:n,set:a}){var o;if(!a)return{error:Ve,info:"missing set"};e=e||i&&_n(i);let s=n&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:c}=a,{setTo:u,tiebreakAt:d}=s,p=IR({set:a}),m=Math.abs(l-c),h=l>=u||c>=u,f=r||l>=u&&c>=u||d&&d<u&&(l===d||c===d),g=t||f&&(p===1&&a.side1TiebreakScore>a.side2TiebreakScore||p===2&&a.side2TiebreakScore>a.side1TiebreakScore),v=!f&&s.NoAD||f||r&&(o=s.tiebreakFormat)!=null&&o.NoAD?1:2,I=m>=v;return!!((h&&(I||f)||r)&&(!f||g))}function IR({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function S_({analysis:t,set:e}){let i=IR({set:e}),{isDecidingSet:r,isTiebreakSet:n,matchUpScoringFormat:a}=t;return vR({matchUpScoringFormat:a,isDecidingSet:r,isTiebreakSet:n,set:e})&&i}function kDe({analysis:t,scoreString:e,sets:i,value:r}){let n;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];r=Xe(r);let{validSide2Score:o,requiresTiebreak:s}=xDe({analysis:t,set:a,value:r});if(o){n=!0,e=(e||"")+r,a.side2Score=r;let l=S_({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let c=Gm.split("")[0];e+=c}else t.isDecidingSet||(e+=vm)}return{sets:i,scoreString:e,updated:n}}function xDe({analysis:t,set:e={},value:i}){let r=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:n,setTo:a,NoAD:o}=r,{side1Score:s}=e,l,c;return n&&n<a?s===n?l=i<=a:l=i<=n:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(n&&n<a?c=s===a&&i===n||s===n&&i===a:c=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function EZ({lowSide:t,value:e,sets:i,scoreString:r,winningSide:n,matchUpStatus:a}){let o;return e===fZ?r?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:sZ}),n=t===2?1:2,a=mZ):(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:LM}),n=t===2?1:2,a=_M):e===IZ?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:LM}),n=t===2?1:2,a=_M):e===yZ?(o=!0,i=[],r=nZ,n=t===2?1:2,a=cZ):e===gZ&&r?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:oZ}),a=pZ,n=void 0):e===vZ?(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:aZ}),a=dZ,n=void 0):e===bZ&&r&&(o=!0,r=Xh({scoreString:r,lowSide:t,outcome:lZ}),a=hZ,n=void 0),{updated:o,sets:i,scoreString:r,matchUpStatus:a,winningSide:n}}function FDe(t){let{sets:e,info:i,scoreString:r,winningSide:n,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==$0&&(e=[{setNumber:1}]);let d=e.length-1;if(fR.includes(l)){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;m&&!h?i="missing side2Score":o.finalSetIsComplete||n?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:c}=EZ({lowSide:s,value:l,sets:e,scoreString:r,matchUpStatus:a,winningSide:n}))}else if(l===$0){if({scoreString:r,sets:e,outcomeRemoved:u}=$M({analysis:o,scoreString:r,sets:e}),(r==null?void 0:r.trim())===""&&(r=r.trim()),r||(e=[]),u){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p;if(m&&h){let f=m>h&&1||h>m&&2||void 0;f&&(p.winningSide=f,e.push({setNumber:e.length+1}))}}a=void 0,n=void 0,c=!0}else if(o.hasOutcome)i="has outcome";else{if(n)return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===gR){let p=e[e.length-1]||{},{side1Score:m,side2Score:h}=p,f=m>h&&1||h>m&&2||void 0;f&&!n&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=f,e.push({setNumber:e.length+1}),r+=" ",c=!0)}else if(l===Im&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&r&&o.isNumericEnding)r+="-",e[d].side2Score=0,a=void 0,n=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let m=Xe((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Xe(m),p=e[d].side1Score.toString(),c=!0}else{let m=Xe((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Xe(m),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let m=(e.slice(0,d)||[]).filter(h=>h).map(h=>{let{side1Score:f,side2Score:g}=h;return[f,g].join("-")}).join(" ");m?r=m+" "+p:r=p}}}return{sets:e,scoreString:r,winningSide:n,matchUpStatus:a,info:i,updated:c}}function LDe({analysis:t,auto:e,lowSide:i,scoreString:r="",sets:n,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]=ap.split("");if(t.isMatchTiebreakEntry||(r+=d),n[t.setNumber-1]){let{lastOpenBracketIndex:p}=gf({brackets:ap,scoreString:r}),m=(r.slice((p??0)+1)+(e?"":a)).split(Cl);if((((o=m[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(m[0]=(m[0]||"")+a),i===2&&(m[1]=(m[1]||"")+a);let h=[m[0]||0,m[1]||0].map(v=>Xe(v)),f=i===1?1:0;h[f]=h[1-f]+(u?1:2),h[f]<c&&(h[f]=c);let g=n[n.length-1];g.side1TiebreakScore=h[0],g.side2TiebreakScore=h[1],r=r.slice(0,(p??0)+1),r+=h.join(Cl),s=!0}else{let h=[m[0]||0,m[1]||0].map(g=>Xe(g)),f=n[n.length-1];f.side1TiebreakScore=h[0],f.side2TiebreakScore=h[1],r+=a,s=!0}}else{let p=RZ({lowValue:Xe(a||0),tiebreakTo:c,NoAD:u}),m=[Xe(a),p];i===2&&m.reverse();let h={side1TiebreakScore:m[0],side2TiebreakScore:m[1],setNumber:(n==null?void 0:n.length)+1||1};n.push(h),r+=m.join(Cl),s=!0}return{info:l,scoreString:r,sets:n,updated:s}}function _De({analysis:t,lowSide:e,scoreString:i,value:r}){let{setTo:n,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=r===parseInt(a||n);if(a&&a<n&&r>a)return{scoreString:i};if(o&&r===n||r>n)return{scoreString:i};let l=h(),c=[r,l];e===2&&c.reverse();let u=Gm.split("")[0],d=c.join(Im)+(s?u:vm);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},m=S_({analysis:t,set:p});return p.winningSide=m||void 0,{scoreString:i,set:p};function h(){return s?r+1:r+1===n?r+(o?1:2):n}}function $De({matchUpFormat:t,scoreString:e,winningSide:i,value:r,sets:n}){var a,o,s;let l=(((a=n==null?void 0:n.filter(_=>_==null?void 0:_.winningSide))==null?void 0:a.length)||0)+(i?0:1),c=_n(t),u=l===(c==null?void 0:c.bestOf),d=u&&(c==null?void 0:c.finalSetFormat)||(c==null?void 0:c.setFormat)||{},p=d==null?void 0:d.timed,m=u&&n[(c==null?void 0:c.bestOf)-1],h=m==null?void 0:m.winningSide,{isTiebreakEntry:f}=gf({brackets:Gm,scoreString:e}),{isTiebreakEntry:g}=gf({brackets:ap,scoreString:e}),v=f||g,I=!!d.tiebreakSet,y=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),b=e&&!isNaN(y),S=!v&&y===Im,w=f&&qE.includes(y),U=g&&qE.includes(y),T=g&&y===Cl,P=e==null?void 0:e.split(""),[R]=ap.split(""),D=P&&Math.max(...$s(R,P)),E=P&&Math.max(...$s(Cl,P)),N=P&&E>D,A=(s=n[n.length-1])==null?void 0:s.winningSide,M=(n==null?void 0:n.length)&&!A,C=uZ.find(_=>(e==null?void 0:e.indexOf(_))>=0),O=!isNaN(r),k=r===gR,x=B0.includes(r),F=e==null?void 0:e.split("").find(_=>qE.includes(_)),$=x&&g&&!U&&(T||!ADe({scoreString:e}));return{isTiebreakSetValue:I&&O,matchUpScoringFormat:c,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:M,isSpace:k,isCloser:x,isTiebreakCloser:x&&F&&v&&b,isDecidingSet:u,isTiebreakSet:I,isTimedSet:p,isNumericEnding:b,isNumericValue:O,hasOpener:F,hasOutcome:C,finalSet:m,finalSetIsComplete:h,lastSetIsComplete:A,isInvalidSetTiebreakValue:k&&v&&w,isInvalidMatchTiebreakValue:$,isTiebreakEntry:v,isSetTiebreakEntry:f,isMatchTiebreakEntry:g,isIncompleteSetScore:S,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:U,isPartialMatchTiebreakValue:T}}function CZ(t){let{lowSide:e=1,value:i}=t,{scoreString:r,sets:n,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!DZ.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:m}=PV({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=m;let h=$De({value:i,winningSide:a,scoreString:r,sets:n,matchUpFormat:s});if(UZ.includes(i)&&(i=Im),h.hasOpener&&h.isTiebreakEntry&&!h.isTiebreakSet&&p&&Xe(i)===0&&(h.isTiebreakCloser=!0),B0.includes(i)&&h.hasOpener&&(i=""),B0.includes(i)&&(i=gR),h.lastSetIsComplete){let f=(r==null?void 0:r.length)&&r[r.length-1];r&&f!==" "&&(r+=" ")}if(h.isTimedSet)({info:d,sets:n,scoreString:r,updated:u,matchUpStatus:o,winningSide:a}=FDe({analysis:h,lowSide:e,scoreString:r,sets:n,matchUpStatus:o,winningSide:a,value:i}));else if(fR.includes(i))h.finalSetIsComplete||a?d="final set is already complete":!h.isTiebreakEntry&&!h.isIncompleteSetScore?{sets:n,scoreString:r,matchUpStatus:o,winningSide:a,updated:u}=EZ({lowSide:e,sets:n,scoreString:r,matchUpStatus:o,winningSide:a,value:i}):h.isTiebreakEntry||h.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===$0)u=!0,{scoreString:r,sets:n}=$M({analysis:h,scoreString:r,sets:n,lowSide:e}),r||(n=[]),o=void 0,a=void 0;else if(h.hasOutcome)d="has outcome";else if(i===Im&&!h.isMatchTiebreakEntry)(!h.isSetTiebreakEntry||h.isSetTiebreakEntry&&!h.isNumericEnding)&&(u=!0,{scoreString:r,sets:n}=$M({analysis:h,scoreString:r,sets:n,lowSide:e}),o=void 0);else if(i===Cl&&h.isMatchTiebreakEntry&&!h.isSetTiebreakEntry)h.matchTiebreakHasJoiner?d="existing joiner":h.isNumericEnding&&(u=!0,r+=Cl);else if([Im,Cl].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(h.isIncompleteSetScore)h.isNumericValue&&({sets:n,scoreString:r,updated:u}=kDe({analysis:h,scoreString:r,sets:n,value:i}));else if(h.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(h.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(h.isTiebreakCloser){let f=h.isSetTiebreakEntry?Gm:ap,g=f.split("").reverse()[0],v=f.split("")[0],I=n[n.length-1],{tiebreakFormat:y}=h.setFormat,{tiebreakTo:b,NoAD:S}=y||{},w=IR({set:I});if(!h.isTiebreakSet){let T=parseInt(r.split(v).reverse()[0]),P=RZ({lowValue:T,tiebreakTo:b,NoAD:S});w===1?(I.side1TiebreakScore=P,I.side2TiebreakScore=T):(I.side1TiebreakScore=T,I.side2TiebreakScore=P)}r=(r||"")+g,h.isDecidingSet||(r+=vm);let U=S_({analysis:h,set:I});I.winningSide=U||void 0,u=!0}else if(h.isTiebreakSetValue)({info:d,scoreString:r,sets:n,updated:u}=LDe({analysis:h,auto:c,lowSide:e,scoreString:r,sets:n,value:i}));else if(h.isSetTiebreakEntry){let[f]=Gm.split(""),g=Math.max(...$s(f,r.split(""))),v=r.slice(g+1),I=v&&Xe(v)===EDe,y=Xe(v?v+i:i),{tiebreakFormat:b}=h.setFormat,{tiebreakTo:S,NoAD:w}=b||{};!I&&v.length<2?w&&y>S-1?d="invalid low value for NoAD tiebreak":(u=!0,r=(r||"")+i):d=I?"tiebreak begins with zero":"tiebreak digit limit"}else if(h.isCloser)d=`invalid key: ${i}`;else if(h.isGameScoreEntry)d="game scoreString entry";else if(h.lastSetIsComplete||!n.length){u=!0;let{scoreString:f,set:g}=_De({analysis:h,lowSide:e,scoreString:r,value:Xe(i)});g&&(g.setNumber=(n==null?void 0:n.length)+1||1),n=(n==null?void 0:n.concat(g).filter(Boolean))||[g],r=f||void 0}else console.log("error: unknown outcome")}if(u){n=n==null?void 0:n.filter(Boolean);let{matchUpWinningSide:f}=PV({sets:n,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=f,f&&(!o||[zi,Xs].includes(o))?(o=SDe,n=n.filter(g=>{let{side1Score:v,side2Score:I,side1TiebreakScore:y,side2TiebreakScore:b}=g;return v||I||y||b})):r&&!a&&![pZ,dZ,hZ].includes(o)&&(o=void 0),{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}return{updated:u,scoreString:r,sets:n,winningSide:a,matchUpStatus:o,info:d}}var yR="\\d+-\\d+",gy="\\d+-\\d+\\(\\d+\\)",T_="\\[\\d+-\\d+\\]",BDe="\\d+-\\d+\\(\\d+-\\d+\\)",VDe=new RegExp(`(${yR}),`,"g"),jDe=new RegExp(`(${gy}),`,"g"),GDe=[yR,gy,T_,BDe],HDe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],zDe=HDe.map(t=>{let e=t.split("").map(i=>GDe[i]).join(" ");return new RegExp(`^${e}$`)});function RV(t){return!t||zDe.some(e=>e.test(t))}function WDe(t){let e="[];",i="()",r=e+i,n=[e[0],i[0]],a=Object.assign({},...r.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let c=r.includes(l)&&l,u=n.includes(c);if(u&&c)return a[c]+=1,o=c,l;if(!u&&c&&o&&c!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(m=>m!==o);if(d.includes(c))a[o]||(o="");else return a[c]||(o=""),p}return l}).join("");return t!==s?s:t}function ES(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function qDe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function cg(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((r,n)=>+r-+n))===1}return!1}function V0(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(n=>parseInt(n.join("")));e&&i.reverse();let r=i;if(Math.abs(r.reduce((n,a)=>+n-+a))>=2)return r.join("-")}function EV(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function YDe(t){return t.startsWith("(")&&t.endsWith(")")}function KDe({score:t,applied:e}){t=WDe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let U=w.replace(")",") ");t=t.replace(w,U)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let r=/\(([\d- ]+)\)/g,n=/\(([\d- ]+)\)/,a=t.match(r);for(let w of a||[]){let[U]=w.match(n).slice(1),T=U.replace(/ /g,"");t=t.replace(w,`(${T})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(U,T)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(U=>{let T=U.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(U,T)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let U=new RegExp(`(\\d+)${w}(\\d+)`,"g"),T=t.match(U);T&&T.forEach(P=>t=t.replace(P,P.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[U]=w.match(/\((\d+), \)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[U]=w.match(/\((\d+)\/\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&U==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${U})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[U]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${U},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[U]=w.match(/\(\/(\d+)\)/).slice(1);U.length===2?t=t.replace(w,`(${U})`):U.length===1&&parseInt(U)<6?t=t.replace(w,`(6-${U})`):t=t.replace(w,`(${U})`)});let p,m,h,f,g,v=()=>{g=fa(t.split("")),m=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],h=g["["]===g["]"]+1,f=m&&!h};v();let I=/(\d+-\d+\(\d+)0,/;if(I.test(t)){let[w]=t.match(I).slice(1);t=t.replace(I,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(YDe)?t=w.map(U=>{let T=U.slice(1,U.length-1);return T.length>2?T:U}).join(" "):t=w.join(" ")}v();let y=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!y&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],U=0;for(let T of t.split("").reverse())T===")"&&(U?w.push("("):U+=1),T==="("&&(U-=1),w.push(T);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),f&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),f){let w="",U=0;for(let T of t.split(""))T==="("&&(U?w+=")":U+=1),T===")"&&(U-=1),w+=T;t=w}v(),h&&!m&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let S=w=>{let U=w.indexOf("("),T=w.indexOf(")");return U>=0&&T>=0&&U<T};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);S(w)&&(t=w,v())}return{score:t,applied:e}}function bR(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=$s("-",t.split(""));if(!e.length)return t;let i=t.split("-"),r=!(i.length%2),n=!!(e.length%2);return r&&n&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function JDe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[VDe,jDe].forEach(i=>{let r=t.match(i);r!=null&&r.length&&(r.forEach(n=>{t=t.replace(n,n.slice(0,n.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(bR).join(" "),{score:t,applied:e}}function XDe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let r=t.split(" ");t=r.map(p=>{let m=/^-(\d+)$/;if(m.test(p)){let[h]=p.match(m).slice(1);if(h.length===2)return h.split("").join("-")}return p}).join(" "),r=t.split(" ");let n=r.filter(ES),a=0,o="";for(let p of n){let m=$s(p,r).filter(v=>!a||v>a)[0],h=r.slice(a,m-1),f=r[m-1],g=e(f);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),I=Math.abs(v.reduce((y,b)=>+y-+b));if(I===1){let y=[h.join(" "),[f,p].join("")].join(" ");o+=y,a=m+1}else if(I===0){let y=Math.max(...v);if([4,5,6,7,8,9].includes(y)){let b=[6,4].includes(y)?y+1:y-1,S=[y,b].sort().reverse().join("-"),w=[h.join(" "),[S,p].join("")].join(" ");o+=w,a=m+1}}}}if(n.length&&o.length){let p=r.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(r.length===2&&["(","["].some(p=>r[1].includes(p))){let p=e(r[0]).split("");if(Math.abs(p.reduce((m,h)=>+m-+h,0))===1)return r[1]=i(r[1]),{score:r.join("")}}let s=r.map(p=>qDe(p)&&"bracket"||cg(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,m="";return r.forEach((h,f)=>{s[f]==="bracket"&&p==="set"?(h=i(h),m+=h):m+=` ${h}`,p=s[f]}),{score:m.trim()}}r=t.split(" ");let l,c=r.map(p=>{let m=new RegExp(/^(\d+)-(\d+)$/);if(m.test(p)){let[h,f]=p.match(m).slice(1),g=Math.abs([h,f].reduce((I,y)=>+I-+y)),v=Math.max(h,f);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=$s("tiebreak",c);if(u.length){let p="";r.forEach((m,h)=>{u.includes(h)?p+=`(${m}) `:u.includes(h+1)?p+=`${m}`:p+=`${m} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,m,h]=t.match(d).slice(1),f=Math.max(m,h)>=10;!cg(p)&&f&&(t=t.replace(d,`${p} [${m}-${h}]`))}return c=[],t=t.split(" ").map(p=>{let m=/^\((.*)\)$/,h=m.test(p),f=new RegExp(T_).test(p)&&"super"||new RegExp(gy).test(p)&&"tiebreak"||new RegExp(yR).test(p)&&"standard"||"unknown";return c.push(f),f==="standard"&&h?p.match(m)[1]:p}).join(" "),{score:t}}function ZDe({score:t,applied:e}){for(let T of[".",","," ","/"]){let P=new RegExp(`^(\\d+)\\${T}(\\d+)$`);if(P.test(t)){let R=t.match(P).slice(1).map(E=>parseInt(E)),D=Math.abs(R[0]-R[1]);D<=10&&D>=2&&(t=t.split(T).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[T,P,R,D,E,N]=t.match(i).slice(1);t=t.replace(i,`${T}${P}-${R} ${D}-${E}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let r=/\(6,\)/g;r.test(t)&&(t=t.replace(r,"(6, 0)"),e.push("missingZeroPattern1"));let n=/^\d{3,}\(/,a=/\(\d+\)\d+/;[n,a].forEach(()=>{t=t.split(" ").map(T=>(n.test(T)&&(T=T.replace("("," (")),a.test(T)&&(T=T.replace(")",") ")),T)).join(" "),e.push("spaceConsiderationPatterns")});let o=bR(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[T,P,R]=t.match(s).slice(1),[D,E]=P.split("");t=`${T}-${D} ${E}-${R}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[T,P]=t.match(c).slice(1),R=T.trim(),D=P.trim();if(l.test(R)&&l.test(D)){let E=R.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${E} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[T,P]=t.match(u).slice(1),R=T.trim(),D=P.trim();if(l.test(R)&&l.test(D)){let E=R.match(l).slice(1,3).join("-"),N=D.match(l).slice(1,3).join("-");t=`${E} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let T=t.match(d)[0],P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("singleSetCommaSeparationPattern")}let p=0,m=/(\d+)-(\d{2})-(\d+)/;for(;m.test(t)&&p<3;){let[T,P,R]=t.match(m).slice(1),D=P.split(""),E=`${T}-${D[0]} ${D[1]}-${R}`;t=t.replace(m,E),e.push("noSetSeparationPattern"),p+=1}let h=/(^|\s)7-6\s(\d+)\s/g,f=t.match(h);if(f!=null&&f.length){let T=/(^|\s)7-6\s(\d+)\s/;f.forEach(P=>{let R=P.match(T).slice(2)[0];t=t.replace(P,`7-6(${R}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(T=>{let P=T.slice(0,T.length-1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(T=>{let P=" "+T.slice(1).split(" ").join("-");t=t.replace(T,P),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let T=t.match(v)[0],P=T.split("/").map(R=>`(${R})`).join(" ")+" ";t=t.replace(T,P),e.push("slashCommaSetPattern")}let I=/\(6-\)/g;I.test(t)&&(t=t.replace(I,"(6-0)"),e.push("missingZeroPattern2"));let y=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(y.test(t)){let T=t.match(y),P=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),R=t;T.forEach(D=>{let[E,N]=D.match(P).slice(1),A=`${E}-${N}`;R=R.replace(D,A)}),t=R,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[T,P,R]=t.match(b).slice(1);T.replace(/\D/g,"").length>=4&&(t=T+` ${P}${R}`,e.push("spaceSeparatedSuperPattern"))}let S=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let T of t.match(S)||[]){let[P,R,D,E]=T.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,A]=R.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${P}${R}(${D})${E}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let T of t.match(w)||[]){let P=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[R,D,E]=T.match(P).slice(1),[N,A]=R.split("-").map(M=>parseInt(M));Math.abs(N-A)===1&&(t=t.replace(T,`${R}(${D})${E}`),e.push("floatingTiebreakPattern2"))}let U=/(^|\s)(\d \d)\(/g;for(let T of t.match(U)||[]){let P=/(^|\s)(\d \d)\(/,[R,D]=T.match(P).slice(1);t=t.replace(T,`${R}${D.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function QDe({score:t,matchUpStatus:e}){var i;let r=t==null?void 0:t.split(" ");t=r.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(cg(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let c=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(ki(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=V0(c.split(""),u)}}t=t.replace(l,`(${c})`)}r=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=r.length-1;t=r.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==o;if(a.test(l)&&u){let[d,p,m]=Array.from(l.match(a)).slice(1),h=Math.min(p,m);return`${d}(${h})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=r.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1);return cg(c)?`${c}(${u})`:c}return l}).join(" "),r=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=r.map(l=>{if(a.test(l)){let[c]=l.match(a).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function ePe({score:t,attributes:e,identifier:i}){var r,n,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let m of s||[]){let h=(n=(r=m.match(/^\((.*)\)$/))==null?void 0:r.slice(1))==null?void 0:n[0],f=t.split(m)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){let I=f.slice(f.length-2).split("").map(y=>parseInt(y));if(Math.abs(I[0]-I[1])===1)continue}let g=EV(h),v=bR(g);t=t.replace(m,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(m=>{let h=EV(m.match(/^\[(.*)\]$/)[1]);t=t.replace(m,`(${h}) `).trim()});let c=[")","]"],u=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&c.some(m=>t.endsWith(m))&&u.some(m=>t.includes(m))){let m="",h=t.split(/[)\]]/).filter(Boolean).map(y=>(y.startsWith(",")&&(y=y.slice(1)),y.trim())),f=h.every(y=>y.includes(",")||ES(y)),g=h.every(y=>y.includes("/")||ES(y)),v=h.every(y=>y.includes("-")||ES(y)),I=f&&","||v&&"-"||g&&"/";if(I){let y;h.forEach(b=>{if(b.startsWith("("))if(y==="set"&&(m+=" "),b.includes(I))m+=b.slice(1).split(I).map(S=>S.trim()).join("-"),y="set";else{let S=b.slice(1);m+=`(${S}) `,y="tiebreak"}else if(b.startsWith("[")){let S=b.slice(1).split(I).map(U=>parseInt(U.trim())),w=Math.min(...S);y==="set"?m+=`(${w}) `:m+=`[${S.join("-")}] `,y="tiebreak"}}),t=m.trim()}}let d=fa(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&cg(t)&&ki(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function MZ({score:t}){let e=t.split(""),i=[],r,n=()=>r=[void 0,void 0,void 0],a=()=>{let s=`${r[0]}-${r[1]}`;return r[2]&&(s+=` (${r[2]})`),n(),r.push(r),s};n();let o=()=>r[0]!==void 0&&r[1]!==void 0&&Math.abs(parseInt(r[0])-parseInt(r[1]));for(;e.length;){let s=e.shift(),l=ki(s)&&parseInt(s),c=r[0]!==void 0&&r[1]!==void 0;if(ki(l)){if(r[0]===void 0){r[0]=l;continue}if(r[1]===void 0&&(r[1]=l,o())){i.push(a()),r=[void 0,void 0];continue}if(c&&e.length===1&&ki(e[0])){let u=e.pop();r[0]=r[0].toString()+r[1].toString(),r[1]=u,i.push(a()),r=[void 0,void 0]}c&&o()}}return{sets:i}}function BM(t){let e=t.indexOf("1"),i=t.split(""),r=i.every(n=>!isNaN(n));if(r&&t.length===3&&e===0){let n=V0(i,e);if(n)return n}if(r&&t.length===7&&e>3){let n=i.slice(4),a=V0(n,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function NZ(t){let{score:e}=t,{applied:i,matchUpStatus:r}=t,n=e==null?void 0:e.toString().split(""),a=n==null?void 0:n.every(s=>ki(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=n.join(""));let s=a?n.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(MZ({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c} ${u}-${d} [${p}${m}-${h}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c}(${u}) ${d}-${p} ${m}-${h}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c} ${u}-${d}(${p}) ${m}-${h}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,c,u,d,p,m,h]=s;e=`${l}-${c} ${u}-${d} ${p}-${m}(${h})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=BM(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=xr(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,I]=g.split("").map(S=>parseInt(S)),y=Math.abs(v-I),b=v>I?1:2;return y>1&&b||b*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=fa(c),p=c.map(g=>Math.abs(g)),m=fa(p),h=c[0]<0,f=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(m).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,I,y,b,S]=s,w=c.reduce((U,T,P)=>T<0?P:U,void 0);if(w===0){let U=Math.min(I,y);e=`${g}-${v}(${U}) ${b}-${S}`,i.push("chunkSplitTiebreak1")}else if(w===1){let U=Math.min(b,S);e=`${g}-${v} ${I}-${y}(${U})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${I}-${y}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,I,y,b,S,w,U]=s;h||f?s[5]===1&&(h?e=`${g}-${v}(${I}) ${y}-${b} [${S}${w}-${U}]`:e=`${g}-${v} ${I}-${y}(${b}) [${S}${w}-${U}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:r}}function AZ(t){let e=[0,0],i=[],r=t.split(" "),n=/(\d+)-(\d+)/;r.forEach(l=>{if(n.test(l)){let c=l.match(n).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function tPe({score:t,matchUpStatus:e,attributes:i}){let r=[],n,a=t.split(" "),o=a.length;t=a.map((u,d)=>{if(new RegExp(gy).test(u)){let m=u.slice(3),h=u.slice(0,3),f=h.split("-");if(!cg(h)&&!e){let g=Math.max(...f),v=h.indexOf(g),I=[g,g-1];return v&&I.reverse(),I.join("-")+m}}else if(u.length===2&&ki(u))return u.split("").join("-");u=bR(u);let p=new RegExp(`^${T_}$`).test(u)&&"super"||new RegExp(`^${gy}$`).test(u)&&"tiebreak"||new RegExp(`^${yR}$`).test(u)&&"standard"||"unknown";if(r.push(p),o>1&&p==="standard"&&d<2){let[m,h]=u.split("-"),f=Math.abs(parseInt(m)-parseInt(h)),g=Math.max(m,h),v=Math.min(m,h),I=[parseInt(m),parseInt(h)].indexOf(v);if(g>9&&f>2){let y=g.toString().split(""),b=y.find(S=>parseInt(S)>v||d&&parseInt(S)<=n)??y[0];b&&(u=I?[b,v].join("-"):[v,b].join("-"))}g>(n||0)&&(n=g)}if(p==="standard"){let[m,h]=u.split("-");if(!Math.abs(parseInt(m)-parseInt(h))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=AZ(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:r}}function iPe({score:t}){let{setsTied:e,winningSide:i}=AZ(t),r=/\s\((\d+)\)$/;if(!i&&e&&r.test(t)){let s=t.match(r).slice(1)[0],l=s<=8?10:s+2;t=t.replace(r,` [${l}-${s}]`)}let n=t.split(" "),a=n[n.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>ki(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...n.slice(0,n.length-1),`7-6(${s})`].join(" ")}else{o=o.map(c=>parseInt(c));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(c=>+c>=10)){let c=o.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(o=c)}t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" ")}else n.length===3&&s>=7&&l>2&&(t=[...n.slice(0,n.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function rPe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function nPe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function aPe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let r=i.indexOf("1");if(i.length%2){if(i.length===3&&r===0){let n=V0(i.split(""),r);return e.push("getSuper"),n}}else{let{score:n,applied:a}=NZ({score:i,applied:[]});n!==i&&(i=n,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function oPe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&BM(t)?{score:BM(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function sPe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function lPe({score:t,profile:e,applied:i}){var r;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(r=e==null?void 0:e.matchUpStatuses)==null?void 0:r.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function uPe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(n=>t.endsWith(n))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(n=>t.includes(n));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let r=/(.*)[A-Za-z]+$/;return r.test(t)&&(t=t.match(r).slice(1)[0].trim()),{score:t,attributes:e}}function cPe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function dPe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(n=>e.test(n))&&(t=i.map(n=>e.test(n)?n.replace("/","-"):n).join(" "));let r=/^(\d+), *(\d+)$/;if(r.test(t)){let[n,a]=t.match(r).slice(1);t=[n,a].join("-")}return{score:t}}function pPe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let r of i||[]){let n=r.replace("/","-");t=t.replace(r,n)}return{score:t}}function mPe({score:t}){if(t.includes(",")){let e=t.split(",").map(r=>r.trim()),i=r=>/\d \d/.test(r);e.every(i)&&(t=e.map(r=>{let n=/\d+ \d+/g;for(let a of r.match(n)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);r=r.replace(a,`${o}-${s}`)}return r}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>ki(i))&&e.length===4&&(t=e)}return{score:t}}function hPe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var fPe={handleTiebreakSlashSeparation:pPe,handleSetSlashSeparation:cPe,punctuationAdjustments:KDe,handleGameSeparation:dPe,joinFloatingTiebreak:XDe,handleBracketSpacing:JDe,handleSpaceSeparator:mPe,separateScoreBlocks:aPe,matchKnownPatterns:ZDe,removeDanglingBits:uPe,removeErroneous:oPe,handleWalkover:sPe,properTiebreak:QDe,handleNumeric:NZ,handleRetired:lPe,containedSets:ePe,sensibleSets:tPe,stringScore:rPe,superSquare:iPe,setBuilder:MZ,excisions:hPe,replaceOh:nPe},YE={},gPe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],vPe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function OZ(t){if(!t.score)return{error:oe};let{score:e,sheetName:i,identifier:r,fileName:n,stepLog:a,fullLog:o,profile:s}=t,l=[],c,u=[],d,p,m=e,h=g=>{g.forEach(v=>{p=fPe[v]({profile:s,identifier:r,matchUpStatus:c,attributes:d,applied:u,score:m});let I=p.score!==m;I&&l.push({method:v,score:p.score}),a&&(o||I||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),m=p.score})};h(gPe);let f=RV(m);return f||(m=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),h(vPe),f=RV(m),f||(m="")),u.forEach(g=>{YE[g]||(YE[g]=0),YE[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:f,score:m}}var kZ={};yt(kZ,{analyzeSet:()=>vy,checkScoreHasValue:()=>_r,checkSetIsComplete:()=>vR,getSetComplement:()=>P_,getTiebreakComplement:()=>wR,isValidMatchUpFormat:()=>Ia,parseScoreString:()=>j0,validateScore:()=>D_,validateTieFormat:()=>Kn});function IPe({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){let a=(n==null?void 0:n.sets)??[],o=((a==null?void 0:a.filter(b=>b==null?void 0:b.winningSide))||[]).reduce((b,S)=>{let{winningSide:w}=S;if(!w)return b;let U=w-1;return b[U]++,b},[0,0]),s=r?r-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&o[s],u=l!==void 0&&o[l],d=e?_n(e):void 0,p=Math.max(...o),m=fa(o)[p],h=d==null?void 0:d.bestOf,f=h&&Math.ceil(h/2)||1,g=i??t,v=g&&[Ot,dn,jt].includes(g),I=!d||!a.length||a.every((b,S)=>{let w=S+1,U=w===h,T=w===a.length,{side1Score:P,side2Score:R,side1TiebreakScore:D,side2TiebreakScore:E,winningSide:N}=b,A=Math.max(P??0,R??0),M=D??E,{finalSetFormat:C,setFormat:O}=d,k=U&&C||O;if(M){let{tiebreakTo:x,NoAD:F}=(k==null?void 0:k.tiebreakFormat)||{},$=Math.max(D??0,E??0);if(F&&$>x||$<x&&N&&(T&&!v||!T))return!1}return k.setTo?!(!k.noTiebreak&&A>k.setTo+1):!0}),y=(!e||p===f)&&m===1&&o.indexOf(p)+1||void 0;return{valid:I&&(r&&c>u&&r===y||!r&&!y||v)}}function D_({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}){if(typeof n!="object")return{error:oe};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=n,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:oe,info:l};if(s!==void 0&&typeof s!="string")return{error:oe,info:l};if(a!==void 0&&!Array.isArray(a))return{error:oe,info:ql("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==ht(c).length)return{error:oe,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:m,side1TiebreakScore:h,side2TiebreakScore:f,side1PointScore:g,side2PointScore:v,winningSide:I,setNumber:y}=d;if(![[p,m],[h,f],[g,v]].filter(b=>b.some(S=>S!==void 0)).every(b=>b.every(S=>nt(S))))return{error:oe,info:"non-numeric values"};if(![y,I].filter(b=>b!==void 0).every(b=>nt(b)))return{error:oe,info:"non-numeric values"};if(I&&![1,2].includes(I))return{error:oe,info:"winningSide must be 1 or 2"}}let{valid:u}=IPe({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:r,score:n});if(!u)return{error:wK,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var P_=t=>{let{isSide1:e,lowValue:i,setTo:r,tiebreakAt:n,NoAD:a}=t;if(i===void 0)return!1;let o=Xe(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),n&&n<r&&o>n&&(o=n);let s;return a&&!n?(o>r&&(s=r),s=o<r?r:r-1):s=o+1<r&&r||n&&n<r&&o===n&&r||!n&&o+2||r+1,[e?o:s,e?s:o]},wR=t=>{let{isSide1:e,lowValue:i,tiebreakTo:r,tiebreakNoAd:n}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),n&&a>r-1&&(a=r-1);let o=yPe({lowValue:a,NoAD:n,tiebreakTo:r});return[e?a:o,e?o:a]};function yPe(t){let{lowValue:e,NoAD:i,tiebreakTo:r}=t,n=i?1:2;return e+1>=r?e+n:r}function j0({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((r,n)=>i({set:r,setNumber:n+1}));function i({set:r,setNumber:n}){let a=(r==null?void 0:r.startsWith("["))&&r.split("[")[1].split("]")[0].split("-").map(f=>parseInt(f)),o=r.includes("(")&&r.split("(")[0]||r.includes("[")&&r.split("[")[0]||r,s=!a&&o.split("-").map(f=>parseInt(f)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=r.includes("(")?r.split("(")[1].split(")")[0]:void 0,u=(c&&wR({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[m,h]=a||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:m,side2TiebreakScore:h,winningSide:l,setNumber:n}}}function bPe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:r}){if(!r)return;let n=IR({set:r});return vR({matchUpScoringFormat:t,set:r,isDecidingSet:e,isTiebreakSet:i})&&n||void 0}function vy(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:fP};let{setNumber:r}=e||{},{bestOf:n}=i||{},a=!!(r&&n&&r===n),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),c=!s&&!l,u=!!(r&&n&&r<=n),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],m=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],h=d.filter(C=>C!==void 0).length,f=p.filter(C=>C!==void 0).length,g=m.filter(C=>C!==void 0).length,v=d==null?void 0:d.filter(C=>!isNaN(C)).length,I=m==null?void 0:m.filter(C=>!isNaN(C)).length,{tiebreakAt:y}=o||{},b=y&&d.filter(C=>C>=y).length===2,S=b&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(I&&!v),U=!!(e!=null&&e.winningSide),{error:T,result:P}=wPe({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:m}),{error:R,result:D}=UPe({setObject:e,setFormat:o,sideTiebreakScores:m}),E=c&&!w&&P||s&&w&&D,N=u&&!(s&&!w)&&!(c&&w)&&(!U||E),A=bPe({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),M={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:b,isCompletedSet:U,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:E,leadingSide:S,setFormat:o,sideGameScores:d,sideGameScoresCount:h,sidePointScores:p,sidePointScoresCount:f,sideTiebreakScores:m,sideTiebreakScoresCount:g,winningSide:A};return(e==null?void 0:e.winningSide)!==void 0&&(w?(M.isValidTiebreakSetOutcome=D,D||(M.tiebreakSetError=R)):(M.isValidStandardSetOutcome=P,P||(M.standardSetError=T))),M}function wPe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:r}){if(!t)return{result:!1,error:fP};let n=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||n||a)return{result:!1,error:oe};if((i==null?void 0:i.filter(U=>!isNaN(U)).length)!==2)return{result:!1,error:nM};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(o&&i!=null&&i.find(U=>U>=o)))return{result:!1,error:nM};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:gP};let d=(t==null?void 0:t.winningSide)-1,p=1-d,m=i[d],h=i[p],f=m-h;if(!(m>h))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(r==null?void 0:r.filter(U=>!isNaN(U)).length)===2,I=r==null?void 0:r[d],y=r==null?void 0:r[p],b=s&&i.filter(U=>U>=s).length===2;if(g){let{NoAD:U,tiebreakTo:T}=l;if(b){if(f>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(T))return{result:!1,error:{message:"tiebreakTo error"}};if(!(T&&r!=null&&r.find(N=>N>=T)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let P=s<o?o:o+1;if(m>P)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!I||!y||I<y)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let R=U?1:2,D=I-y,E=y>=T-1;if(D&&E&&D<R)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(m>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let S=c?1:2,w=h>=o-1;return f&&w&&!b&&f<S?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:f>S&&m>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function UPe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:fP};let r=!!(e!=null&&e.tiebreakSet),n=!!(e!=null&&e.timed);if(!e||!r||n)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:gP};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let m=s?1:2,h=d-p,f=p>=l-1;return h&&f&&h<m?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var xZ={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},FZ={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},LZ={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},_Z={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},$Z={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},BZ={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},VZ={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},jZ={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},GZ={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},HZ={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},zZ={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},WZ={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},qZ={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},YZ={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},KZ={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},JZ={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},XZ={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},VM="COLLEGE_DEFAULT",jM="COLLEGE_JUCO",GM="COLLEGE_D3",ZZ="DOMINANT_DUO",QZ="DOMINANT_DUO_MIXED",eQ="LAVER_CUP",tQ="TEAM_DOUBLES_3_AGGREGATION",iQ="TIME_TENNIS_DUAL",rQ="TIME_TENNIS_PRO_CIRCUIT",nQ="USTA_BREWER_CUP",aQ="USTA_OZAKI_CUP",oQ="USTA_COLLEGE",sQ="USTA_GOLD_TEAM_CHALLENGE",lQ="USTA_LEVEL_1",uQ="USTA_INTERSECTIONAL",cQ="USTA_SECTION_BATTLE",dQ="USTA_SOUTHERN_LEVEL_5",pQ="USTA_TOC",mQ="USTA_WTT_ITT",hQ="USTA_ZONAL",SPe={COLLEGE_D3:GM,COLLEGE_DEFAULT:VM,COLLEGE_JUCO:jM,DOMINANT_DUO:ZZ,DOMINANT_DUO_MIXED:QZ,LAVER_CUP:eQ,TEAM_DOUBLES_3_AGGREGATION:tQ,TIME_TENNIS_DUAL:iQ,TIME_TENNIS_PRO_CIRCUIT:rQ,USTA_BREWER_CUP:nQ,USTA_OZAKI_CUP:aQ,USTA_COLLEGE:oQ,USTA_GOLD_TEAM_CHALLENGE:sQ,USTA_INTERSECTIONAL:uQ,USTA_LEVEL_1:lQ,USTA_SECTION_BATTLE:cQ,USTA_SOUTHERN_LEVEL_5:dQ,USTA_TOC:pQ,USTA_WTT_ITT:mQ,USTA_ZONAL:hQ},fQ="STANDARD",CV={[fQ]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[GM]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Ka,matchUpCount:6,matchUpValue:1},tieFormatName:GM,valueGoal:5},[VM]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Ka},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Ka},tieFormatName:VM,valueGoal:4},[jM]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Ka},tieFormatName:jM,valueGoal:5},[eQ]:JZ,[ZZ]:zZ,[QZ]:VZ,[tQ]:FZ,[iQ]:jZ,[rQ]:BZ,[nQ]:GZ,[aQ]:HZ,[oQ]:WZ,[sQ]:xZ,[uQ]:$Z,[lQ]:qZ,[cQ]:_Z,[dQ]:LZ,[mQ]:YZ,[pQ]:XZ,[hQ]:KZ},TPe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(CV).includes(t.namedFormat)?t.namedFormat:fQ,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],r,{category:n,gender:a}=(t==null?void 0:t.event)??{},o=Fe(CV[e],!1,!0),s=l=>{var c,u;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??Yt();let d=(u=t==null?void 0:t.event)==null?void 0:u.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(r={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:qJ,collectionName:"Doubles",matchUpType:ui,...o.doubles},{collectionId:s(1),matchUpFormat:Ka,collectionName:"Singles",matchUpType:Ni,...o.singles}]},o.tieFormatName&&(r.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),r=o),t!=null&&t.hydrateCollections&&r.collectionDefinitions.forEach(l=>{n&&!l.category&&(l.category=n),a&&!l.gender&&(l.gender=a)}),r},Hm=TPe;function DPe(t){var e,i,r;let{existingDrawDefinition:n,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:c,isMock:u,event:d}=t,{tieFormat:p,matchUpFormat:m}=t;if(l===yr&&c===yr){let h=(i=(e=n==null?void 0:n.structures)==null?void 0:e.find(({stage:f})=>f===Oe))==null?void 0:i.tieFormat;p=p||h||s&&((r=d==null?void 0:d.tieFormat)==null?void 0:r.tieFormatName)===s&&d.tieFormat||s&&Hm({namedFormat:s,hydrateCollections:a,isMock:u,event:d})||(d==null?void 0:d.tieFormat)||Hm({event:d,isMock:u,hydrateCollections:a}),m=void 0}else m||(p=void 0,d!=null&&d.matchUpFormat||(m=Ka));if(p){let h=Kn({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(h.error)return h}return{tieFormat:p,matchUpFormat:m}}function PPe(t){var e,i,r,n,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,drawEntries:l,appliedPolicies:c,structureId:u,idPrefix:d,isMock:p}=t,m=t.qualifyingProfiles,h=m!=null&&m.length?AX({uuids:t.uuids,qualifyingProfiles:m,appliedPolicies:c,idPrefix:d,isMock:p}):void 0;if(h!=null&&h.error)return h;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:U})=>U!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:U})=>U.structureId!==s);let{qualifiersCount:f,qualifyingDrawPositionsCount:g,qualifyingDetails:v}=h??{};g&&(h!=null&&h.structures&&((r=o.structures)==null||r.push(...h.structures)),h!=null&&h.links&&((n=o.links)==null||n.push(...h.links)));let I=(a=o.structures)==null?void 0:a.find(({stage:U,stageSequence:T})=>U===Oe&&T===1),{qualifiersCount:y}=Uv({stageSequence:1,drawDefinition:o,structureId:u,stage:Oe}),b=Math.max(f??0,y??0),S=LJ({qualifiersCount:b,drawDefinition:o,stage:Oe});if(S.error||(S=x0({drawSize:g,stage:qe,drawDefinition:o}),S.error))return S;RPe({drawDefinition:o,drawEntries:l});let w=EPe({mainStructure:I,qualifyingDetails:v,drawDefinition:o});return w.error?w:{drawDefinition:o,structureId:u}}function RPe({drawDefinition:t,drawEntries:e}){for(let i of(e??[]).filter(({entryStage:r})=>r===qe)){let r={...i,entryStage:i.entryStage??Oe,drawDefinition:t};Q8(r)}}function EPe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var r;for(let n of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:c}=n,u=t&&((r=$w({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:r.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function gQ(t){var e,i;let{participantIds:r}=t,n=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||Jo.includes(o)}).map(bt))??[];if(r){let a=r.filter(o=>!(n!=null&&n.includes(o)));if(a!=null&&a.length)return ee({result:{error:Ks},info:{invalidParticipantIds:a}})}else r=n;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>r.length-1&&(!t.enableDoubleRobin||t.roundsCount>(r.length-1)*2)?{error:oe,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:oe,info:"roundsCount must be less than 32"}:{participantIds:r}}function R_(t){var e;let i=[],{roundsCount:r=1,drawDefinition:n,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:c}=t,u,d=gQ(t);if(d.error)return d;for(let p of Ee(1,r+1)){let m=hR({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:n,matchUpsCount:a,structureId:o,roundNumber:u,idPrefix:s,isMock:l,event:c});if(m.error)return ee({result:m,info:{iteration:p}});(e=m.matchUps)!=null&&e.length&&i.push(...m.matchUps),u=((m==null?void 0:m.roundNumber)??1)+1}return{matchUps:i}}function CPe(t){var e;let{tournamentRecord:i,participantIds:r,scaleName:n,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=Ta[n])==null?void 0:e.accessor),l=i.participants??[];for(let c of r??[]){let u=l==null?void 0:l.find(p=>p.participantId===c),d=MV({scaleName:`${n}.${P9}`,participant:u,eventType:a});!d&&n&&(d=MV({scaleAccessor:s,participant:u,scaleName:n,eventType:a})),d&&!o[c]&&(o[c]=d)}return o}function MV({scaleType:t=Cd,scaleAccessor:e,participant:i,scaleName:r,eventType:n}){var a,o;let s=(o=(a=i&&Pl({scaleAttributes:{eventType:n??$m,scaleType:t,scaleName:r},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&Ii(s)?s[e]:s}function E_(t){var e,i;let r=NPe(t);if(r!=null&&r.error)return r;let n=gQ(t);if(n.error)return n;let a=MPe(t);if(a.error)return a;let o=CPe(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),c=[],u=[],d;for(let p of Ee(1,(t.roundsCount??1)+1)){let m=I_({...t,participantIds:n.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(m.error)return m;let{matchUps:h,...f}=m;u.push({...f,iteration:p,matchUpsCount:h==null?void 0:h.length}),d=((f==null?void 0:f.roundNumber)??1)+1,h!=null&&h.length&&c.push(...h)}return{...Z,matchUps:c,roundResults:u}}function MPe(t){var e,i,r;if(t.structureId)return t.structureId;let n=t.drawDefinition,a=(i=(e=n==null?void 0:n.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let c=l.stage&&_m[l.stage];return va({structure:l})&&c>(_m[s==null?void 0:s.stage]||1)?l:s},void 0),o=(r=n==null?void 0:n.structures)==null?void 0:r.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?va({structure:o})?{structure:o}:{error:cm}:{error:Ri}}function NPe(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:oe,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Lo?{error:cm}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:oe,info:"Missing Entries"}:{error:void 0}}function APe(t){var e,i;let{tournamentRecord:r,drawDefinition:n,structureId:a,idPrefix:o,isMock:s,event:l}=t,c=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:m})=>(!p||p===Oe)&&m&&Jo.includes(m)),u=c==null?void 0:c.map(bt),d=c?Math.floor(c.length/2):0;if(t.automated)return OPe({...t,participantIds:u});{let p=R_({roundsCount:t.roundsCount,drawDefinition:n,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&uR({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:r,drawDefinition:n,structureId:a,event:l})}return{...Z}}function OPe(t){var e,i;let{restrictEntryStatus:r,generateMatchUps:n,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},c=E_({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:n??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:r,structureId:a,matchUpIds:o});return c.error?c:((i=c==null?void 0:c.matchUps)!=null&&i.length&&uR({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:c.matchUps,event:t.event,structureId:a}),{...Z})}function kPe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:r,participantCount:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:c}){var u,d;r=r??n;let p=et({drawDefinition:o,structureId:l});if(p.error)return p;let m=p.structure;if(!m)return{error:Ri};let{positionAssignments:h}=Tr({structure:m}),f=(h==null?void 0:h.length)||0;if(c>f)return{error:eK};let g=(u=m.structures)==null?void 0:u.length,v=nt(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),I=(d=xL({roundRobinGroupsCount:g,drawSize:f}))==null?void 0:d.seedGroups,{seedsCount:y}=Jw({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:r,drawSize:f});return y&&a!=null&&a[Io]&&c>y&&e&&(c=y),m.seedLimit=c,m.seedAssignments=Ee(1,c+1).map(b=>{let S=I==null?void 0:I.find(T=>T.includes(b)),w=S&&Math.min(...S),U=v&&b>=v?w:b;return{participantId:void 0,seedNumber:b,seedValue:U}}),pi({drawDefinition:o,structureIds:[l]}),{...Z,seedLimit:c}}function $h({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:r,stageSequence:n,entries:a,event:o,stage:s}){if(!e)return{error:he};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!n||!u.entryStageSequence||u.entryStageSequence===n)&&Jo.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=lg({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!r&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(r||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function vQ(t){let e="prepareStage",{drawDefinition:i}=t,{structures:r}=zl({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),n=t.preparedStructureIds||[],a=r==null?void 0:r.find(({structureId:m})=>!n.includes(m));if(!a)return ee({result:{error:Ri},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=jPe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&LPe({...t,seedsCount:s,structure:a,structureId:o});let u=t.automated!==!1&&t.drawType!==Lo&&!(t.qualifyingOnly&&t.stage!==qe),d=((r==null?void 0:r.length)||0)>1,p=u?FPe({...t,multipleStructures:d,seedLimit:c,structureId:o}):{};return p!=null&&p.error?ee({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function xPe({entries:t,stage:e,stageSequence:i,roundTarget:r}){return t.filter(n=>{var a,o;let s=(o=(a=ft({name:sl,element:n}))==null?void 0:a.extension)==null?void 0:o.value;return(!n.entryStage||n.entryStage===e)&&(!i||!n.entryStageSequence||n.entryStageSequence===i)&&(!r||!s||s===r)&&Dp.includes(n.entryStatus)})}function FPe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=Lw({...t,seedsOnly:e});if(i.error)return i;let r=i==null?void 0:i.positionAssignments,n=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:r,positioningReport:n}}function LPe(t){let{seededParticipants:e,seedingScaleName:i,entries:r,event:n}=t,a=r.map(bt);e?_Pe({...t,enteredParticipantIds:a}):(n||i)&&$Pe({...t,enteredParticipantIds:a})}function _Pe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:r,tournamentRecord:n,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?xh({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:c}):void 0;r.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=r.length).sort((p,m)=>p.seedNumber<m.seedNumber?-1:p.seedNumber<m.seedNumber?1:0).forEach(p=>{let{participantId:m,seedNumber:h,seedValue:f}=p;Tv({provisionalPositioning:e,tournamentRecord:n,drawDefinition:o,seedingProfile:s,participantId:m,seedBlockInfo:d,structureId:l,seedNumber:h,seedValue:f,event:u})})}function $Pe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:r,seedAssignmentProfile:n,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:m}=(d==null?void 0:d.category)||{},h=d==null?void 0:d.eventType,f=BPe({...t,ageCategoryCode:m,categoryName:p,eventType:h})||l&&VPe({...t,ageCategoryCode:m,categoryName:p,eventType:h}),g=(f==null?void 0:f.length)??0;g<e&&(e=g),f==null||f.filter(({participantId:v})=>r.includes(v)).slice(0,a||e).forEach((v,I)=>{let y=I+1,{participantId:b,scaleValue:S}=v,w=(n==null?void 0:n[y])||S||y;Tv({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:c,participantId:b,structureId:u,seedNumber:y,seedValue:w,event:d})})}function BPe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:r,entries:n,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},c=o==null?void 0:o.eventType,u={scaleName:i||s||l||o.eventId,scaleType:Tl,eventType:c};return $h({scaleAttributes:u,tournamentRecord:e,stageSequence:r,entries:n,stage:a}).scaledEntries}function VPe(t){let{tournamentRecord:e,stageSequence:i,event:r,entries:n,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(r==null?void 0:r.category)||{},l=r==null?void 0:r.eventType;return $h({scaleAttributes:{scaleName:o||s,scaleType:Oc,eventType:l},tournamentRecord:e,stageSequence:i,entries:n,stage:a}).scaledEntries}function jPe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=xPe(t);e>i.length&&(e=i.length);let{seedLimit:r}=kPe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return r&&r<e&&(e=r),{seedsCount:e,stageEntries:i,seedLimit:r}}function GPe(t){var e;let i=g_({...t,modifyOriginal:!1});if(i.error)return i;let r=i.drawDefinition,{ignoreStageSpace:n,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:m}=t,h=[],f=[],g=HPe({ignoreStageSpace:n,drawDefinition:r,drawEntries:c,drawType:p,entries:m});if(g.error)return g;let v=p===Up?0:Xe(t.seedsCount??0),I=vQ({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:r,seedingProfile:s,participants:l,stage:Oe,seedsCount:v,placeByes:u,drawSize:d,entries:m});if(I.error&&!I.conflicts)return I;(e=I.positioningReport)!=null&&e.length&&h.push({[Oe]:I.positioningReport});let y=I.structureId;return I.conflicts&&(f=I.conflicts),p===Lo&&t.roundsCount&&APe({...t,drawDefinition:r,structureId:y}),{drawDefinition:r,positioningReports:h,conflicts:f,structureId:y}}function HPe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:r,drawType:n,entries:a}=t;for(let o of a){if(r&&o.entryStage&&o.entryStage!==Oe)continue;let s={...o,ignoreStageSpace:e??n===Lo,entryStage:o.entryStage??Oe,drawDefinition:i,drawType:n},l=Q8(s);if(r&&l.error)return l}return{error:void 0}}var zPe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),WPe=zPe;function qPe(t){let{drawId:e=Yt(),processCodes:i,matchUpType:r,drawType:n}=t??{},a=WPe();return Object.assign(a,{processCodes:i,matchUpType:r,drawType:n,drawId:e})}function C_(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:r,matchUpFormat:n,structureId:a,matchUpId:o,event:s}=t,l=kt(t,[{[Rs]:!0,[UF]:!0}]);if(l.error)return l;if(!Ia({matchUpFormat:n}))return{error:Xb};let c="setMatchUpFormat";if(o){let u=gi({drawDefinition:r,matchUpId:o,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===yr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:kn};d&&(d.matchUpFormat=n,Et({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:r,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===yr)return{error:Ac};for(let u of e){let d=et({drawDefinition:r,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=n)}}else if(a){if((s==null?void 0:s.eventType)===yr)return{error:Ac};let u=et({drawDefinition:r,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=n)}else r&&(r.matchUpFormat=n);return e=e??(a?[a]:void 0),pi({drawDefinition:r,structureIds:e}),{...Z}}function YPe({tieFormat:t}){let e=Kn({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Yt());return{tieFormat:t}}function KPe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:r,tieFormat:n,event:a}){if((i||n)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&n&&JSON.stringify(a.tieFormat)===JSON.stringify(n))){if(n){let o=YPe({tieFormat:n});if(o.error)return o;e.tieFormat=o.tieFormat??n}else if(i){let o=C_({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}r&&(e.matchUpType=r)}return{error:void 0}}var IQ={};yt(IQ,{attachPolicies:()=>rp,findPolicy:()=>Pp,getAppliedPolicies:()=>Gt,getPolicyDefinitions:()=>Ju,mutate:()=>yQ,query:()=>wQ,removePolicy:()=>bQ});var yQ={};yt(yQ,{attachPolicies:()=>rp,removePolicy:()=>bQ});function bQ(t){let e=kt(t,[{[vwe]:!0,_anyOf:{[sn]:!1,[Zl]:!1,[Rs]:!1,[lv]:!1}}]);if(e.error)return e;let i,r=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(r)return NV(t,r);if(t.tournamentRecords){let n=Object.keys(t.tournamentRecords);if(!n.length)return{error:he};for(let a of n){let o=t.tournamentRecords[a],s=NV(t,o);if(s.error)return s;i=!0}}else return{error:he};return i?{...Z}:{error:Wf}}function NV(t,e){let i=Gt(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Mt({element:e,extension:{name:ry,value:i}}):In({element:e,name:ry}),{...Z}):{error:Wf}}var wQ={};yt(wQ,{findPolicy:()=>Pp,getAppliedPolicies:()=>Gt,getPolicyDefinitions:()=>Ju});var UQ={[Io]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Hl]:{positioning:Kd},[_o]:{positioning:Kd}},positioning:aUe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},HM=UQ;function JPe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:r}){if(e&&typeof e!="object")return ee({info:"policyDefinitions must be an object",result:{error:oe},stack:r});let n={[iy]:t==null?void 0:t[iy]};return e?XPe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:n,drawDefinition:i}):n.avoidance&&rp({drawDefinition:i,policyDefinitions:n}),!(t!=null&&t[Io])&&!(e!=null&&e[Io])&&(rp({policyDefinitions:HM,drawDefinition:i}),t&&Object.assign(t,HM)),{error:void 0}}function XPe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:r}){for(let n of Object.keys(t))JSON.stringify(e==null?void 0:e[n])!==JSON.stringify(t[n])&&(i[n]=t[n]);Object.keys(i).length&&(rp({policyDefinitions:i,drawDefinition:r}),e&&Object.assign(e,i))}function ZPe(t){var e,i,r,n,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:c,matchUpType:u,tieFormat:d,drawType:p,stack:m,event:h}=t,f=t.drawId?(e=h==null?void 0:h.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;f&&p!==f.drawType&&(f.drawType=p);let g=f??qPe({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=KPe({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:u,tieFormat:d,event:h});if(v.error)return ee({result:v,stack:m});let I=JPe({appliedPolicies:l,policyDefinitions:c,drawDefinition:g,stack:m});if(I.error)return I;let y=(r=(i=f==null?void 0:f.structures)==null?void 0:i.find(w=>w.stage===Oe&&w.stageSequence===1))==null?void 0:r.structureId,b=f?(n=f.structures)==null?void 0:n.filter(w=>w.stage===qe):[],S=(b==null?void 0:b.length)===1&&!((a=b[0].matchUps)!=null&&a.length)&&b[0].structureId;return{drawDefinition:g,structureId:y,existingDrawDefinition:f,existingQualifyingPlaceholderStructureId:S}}function QPe(t){var e,i;let r="generateOrGetExisting",n=[],a=[],o=ZPe(t);if(o.error)return ee({result:o,stack:r});let s=o.existingDrawDefinition,l=o.drawDefinition??{},c=o.structureId,u=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&PPe({...t,...o})||GPe({...t,...o,entries:u});return d.error?ee({result:d,stack:r}):((e=d.positioningReports)!=null&&e.length&&n.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,c=d.structureId,{existingDrawDefinition:s,positioningReports:n,drawDefinition:l,structureId:c,conflicts:a,entries:u})}function eRe(t){var e,i,r;let{qualifyingPlaceholder:n,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:c,drawDefinition:u,seedingProfile:d,participants:p,structureId:m,entries:h,stack:f}=t,g=n&&!(a!=null&&a.length)&&!o,v=[];if(a){let I=(w,U)=>w.stageSequence-U.stageSequence,y=(w,U)=>w.roundTarget-U.roundTarget,b=[],S=1;a.sort(y);for(let w of a){if(!Array.isArray(w.structureProfiles))return ee({info:ql("structureProfiles"),result:{error:Ve},stack:f});S=w.roundTarget||S;let U=((e=w.structureProfiles)==null?void 0:e.sort(I))||[],T=1;for(let P of U){let{qualifyingRoundNumber:R,qualifyingPositions:D,seededParticipants:E,seedingScaleName:N,seedsCount:A=0,seedByRanking:M,placeByes:C,drawSize:O}=P,k=vQ({...t,seedingProfile:P.seedingProfile??d,stageSequence:T,qualifyingRoundNumber:R,preparedStructureIds:b,qualifyingPositions:D,seededParticipants:E,stage:qe,seedingScaleName:N,appliedPolicies:l,drawDefinition:u,qualifyingOnly:c,seedByRanking:M,participants:p,roundTarget:S,seedsCount:A,placeByes:C,drawSize:O,entries:h});if(k.error)return k;k.structureId&&b.push(k.structureId),T+=1,(i=k.conflicts)!=null&&i.length&&v.push(...k.conflicts),(r=k.positioningReport)!=null&&r.length&&s.push({[qe]:k.positioningReport})}S+=1}}else if(m&&g){let I=Ya({structureName:zr(qe),stage:qe}),{link:y}=$w({sourceStructureId:I.structureId,targetStructureId:m,sourceRoundNumber:0,linkType:Eu});u.structures||(u.structures=[]),u.structures.push(I),u.links||(u.links=[]),u.links.push(y)}return{qualifyingConflicts:v,error:void 0}}var SQ={};yt(SQ,{addGoesTo:()=>ip,allCompetitionMatchUps:()=>Us,allDrawMatchUps:()=>Nn,allEventMatchUps:()=>Qu,allPlayoffPositionsFilled:()=>jL,allTournamentMatchUps:()=>Lr,analyzeDraws:()=>Yw,analyzeMatchUp:()=>yy,analyzeTournament:()=>__,bulkUpdatePublishedEventIds:()=>V_,calculateWinCriteria:()=>Vh,categoryCanContain:()=>oR,checkMatchUpIsComplete:()=>Md,checkValidEntries:()=>mR,compareTieFormats:()=>ku,competitionScheduleMatchUps:()=>tU,credits:()=>tRe,drawMatchUps:()=>t$,eventMatchUps:()=>AR,filterParticipants:()=>Aw,findDrawDefinition:()=>o_,findExtension:()=>ft,getAllDrawMatchUps:()=>cr,getAllEventData:()=>j_,getAllStructureMatchUps:()=>$t,getAllowedDrawTypes:()=>UR,getAllowedMatchUpFormats:()=>x_,getAppliedPolicies:()=>Gt,getAssignedParticipantIds:()=>Np,getAvailableMatchUpsCount:()=>cR,getAvailablePlayoffProfiles:()=>Bw,getCategoryAgeDetails:()=>Hw,getCheckedInParticipantIds:()=>Ch,getCompetitionDateRange:()=>TR,getCompetitionMatchUps:()=>Iy,getCompetitionParticipants:()=>M_,getCompetitionPenalties:()=>F_,getCompetitionVenues:()=>Xw,getCourtInfo:()=>zP,getCourts:()=>i$,getDrawData:()=>DR,getDrawDefinitionTimeItem:()=>UL,getDrawParticipantRepresentativeIds:()=>n_,getDrawTypeCoercion:()=>Kw,getEligibleVoluntaryConsolationParticipants:()=>r_,getEntriesAndSeedsCount:()=>MR,getEvent:()=>a$,getEventData:()=>PR,getEventMatchUpFormatTiming:()=>W_,getEventProperties:()=>r$,getEventPublishStatus:()=>mo,getEventStructures:()=>eR,getEventTimeItem:()=>Rw,getEvents:()=>n$,getFlightProfile:()=>Yi,getLinkedTournamentIds:()=>lw,getMatchUpCompetitiveProfile:()=>Uw,getMatchUpContextIds:()=>X_,getMatchUpDailyLimits:()=>kR,getMatchUpDailyLimitsUpdate:()=>q_,getMatchUpDependencies:()=>Zo,getMatchUpFormat:()=>Z_,getMatchUpFormatTiming:()=>Tw,getMatchUpFormatTimingUpdate:()=>z_,getMatchUpScheduleDetails:()=>WP,getMatchUpType:()=>qP,getMatchUpsMap:()=>Zr,getMatchUpsStats:()=>Q_,getMaxEntryPosition:()=>H_,getModifiedMatchUpFormatTiming:()=>NR,getPairedParticipant:()=>Bo,getParticipantEventDetails:()=>N_,getParticipantIdFinishingPositions:()=>a_,getParticipantMembership:()=>A_,getParticipantResults:()=>Gw,getParticipantScaleItem:()=>lg,getParticipantSchedules:()=>O_,getParticipantSignInStatus:()=>k_,getParticipantTimeItem:()=>SL,getParticipants:()=>Wi,getPersonRequests:()=>kp,getPolicyDefinitions:()=>Ju,getPositionAssignments:()=>fy,getPositionsPlayedOff:()=>Dv,getPredictiveAccuracy:()=>J_,getProfileRounds:()=>CR,getPublishState:()=>Oh,getRoundMatchUps:()=>Pn,getRounds:()=>e$,getScaleValues:()=>uv,getScaledEntries:()=>$h,getScheduledRoundsDetails:()=>Zw,getSchedulingProfile:()=>ic,getSchedulingProfileIssues:()=>G_,getSeedingThresholds:()=>FL,getSeedsCount:()=>Jw,getStructureSeedAssignments:()=>ao,getTeamLineUp:()=>tp,getTieFormat:()=>B_,getTimeItem:()=>ul,getTournamentIds:()=>ow,getTournamentInfo:()=>Bh,getTournamentPenalties:()=>SR,getTournamentPersons:()=>L_,getTournamentStructures:()=>VL,getTournamentTimeItem:()=>Ew,getValidGroupSizes:()=>xw,getVenueData:()=>ag,getVenuesAndCourts:()=>tc,isAdHoc:()=>va,isCompletedStructure:()=>Bc,isValidForQualifying:()=>h_,isValidMatchUpFormat:()=>Ia,matchUpActions:()=>pR,participantScaleItem:()=>Pl,participantScheduledMatchUps:()=>Y_,positionActions:()=>m_,publicFindVenue:()=>vL,tallyParticipantResults:()=>Pv,tieFormatGenderValidityCheck:()=>nR,tournamentMatchUps:()=>OR,validMatchUp:()=>GP,validMatchUps:()=>po,validateCollectionDefinition:()=>zw,validateLineUp:()=>QP});function tRe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var TQ={};yt(TQ,{filterParticipants:()=>Aw,getCompetitionParticipants:()=>M_,getPairedParticipant:()=>Bo,getParticipantEventDetails:()=>N_,getParticipantMembership:()=>A_,getParticipantScaleItem:()=>lg,getParticipantSchedules:()=>O_,getParticipantSignInStatus:()=>k_,getParticipantTimeItem:()=>SL,getParticipants:()=>Wi,getScaleValues:()=>uv,participantScaleItem:()=>Pl,validateLineUp:()=>QP});function M_(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Ai};let i=[],r={},n={},a={},o=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:m,matchUps:h,derivedEventInfo:f,derivedDrawInfo:g}=Wi({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(r,p),Object.assign(n,f),Object.assign(a,g),i.push(...m??[]),o.push(...h??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:n,derivedDrawInfo:a,participantMap:r,mappedMatchUps:s,participants:i,...Z,matchUps:o}}function N_({tournamentRecord:t,participantId:e}){if(!t)return{error:he};if(!e)return{error:vr};let i=[e].concat((t.participants??[]).filter(r=>{var n;return(r==null?void 0:r.participantType)&&[ii,st].includes(r.participantType)&&((n=r.individualParticipantIds)==null?void 0:n.includes(e))}).map(r=>r.participantId));return{eventDetails:(t.events??[]).filter(r=>{let n=((r==null?void 0:r.entries)??[]).map(a=>a.participantId);return Dn(n,i)}).map(r=>({eventName:r.eventName,eventId:r.eventId}))}}function A_({tournamentRecord:t,participantId:e}){if(!t)return{error:he};if(!e)return{error:vr};let{participants:i}=Wi({participantFilters:{participantTypes:[ii,st,_a]},tournamentRecord:t});return(i??[]).filter(r=>{var n;return(n=r.individualParticipantIds)==null?void 0:n.includes(e)}).reduce((r,n)=>{let a=n.participantType;return a&&(r[a]||(r[a]=[]),r[a].push(n)),r},{})}function O_({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:he};if(typeof t!="object")return{error:qu,context:{participantFilters:t}};let i={eventIds:t.eventIds},r=Lr({tournamentRecord:e,contextFilters:i}).matchUps??[],n=Object.assign({},...r.map(l=>({[l.matchUpId]:l}))),a=r.filter(({schedule:l})=>l&&Object.keys(l).length),o=Zo({tournamentRecord:e,matchUps:r}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(m=>{if(m.participant)return[m.participant].concat(...m.participant.individualParticipants||[]);o[l.matchUpId]&&!u&&(u=(o[l.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(let m of d){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:m})=>m).flat().map(({participant:m})=>m&&[m].concat(...m.individualParticipants||[])).filter(Boolean).flat())||[];for(let m of p){let{participantId:h}=m;s[h]||(s[h]={potentialMatchUps:[],participant:m,matchUps:[]}),s[h].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...Z}}function k_({tournamentRecord:t,participantId:e}){if(!t)return{error:he};if(!e)return{error:vr};let{participant:i}=Mp({tournamentRecord:t,participantId:e});if(!i)return{error:Ji};let{timeItem:r}=ul({itemType:hw,element:i});return r&&r.itemValue===uy&&uy}var DQ={};yt(DQ,{analyzeDraws:()=>Yw,analyzeTournament:()=>__,getAllowedDrawTypes:()=>UR,getAllowedMatchUpFormats:()=>x_,getAppliedPolicies:()=>Gt,getCompetitionDateRange:()=>TR,getCompetitionPenalties:()=>F_,getPolicyDefinitions:()=>Ju,getTournamentInfo:()=>Bh,getTournamentPenalties:()=>SR,getTournamentPersons:()=>L_,getTournamentStructures:()=>VL,getTournamentTimeItem:()=>Ew});function x_({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:he};let{appliedPolicies:n}=Gt({tournamentRecord:t});return(((r=n==null?void 0:n[Vl])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function UR({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:he};let{appliedPolicies:n}=Gt({tournamentRecord:t});return(((r=n==null?void 0:n[U0])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function SR({tournamentRecord:t}){if(!t)return{error:he};let e=((t==null?void 0:t.participants)??[]).reduce((i,r)=>{let{participantId:n}=r;return(r.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(n):i[o]={...a,participantIds:[n]}}),i},{});return{penalties:Object.values(e)}}function F_({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ai};let e=[];for(let i of Object.values(t)){let{penalties:r}=SR({tournamentRecord:i});e.push(...r??[])}return{penalties:e}}function PQ({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:m,notes:h})=>({eventId:e,eventName:i,eventType:r,eventLevel:n,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:m,notes:h}))(t)}}var iRe={[dv]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},rRe=iRe;function Bh(t){var e,i,r,n;let{tournamentRecord:a}=t??{};if(!a)return{error:he};let o=(({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:m,tournamentName:h,promotionalName:f,onlineResources:g,localTimeZone:v,startDate:I,endDate:y,hostCountryCode:b,venues:S,notes:w,updatedAt:U})=>({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:m,tournamentName:h,promotionalName:f,onlineResources:g,localTimeZone:v,startDate:I,endDate:y,hostCountryCode:b,venues:S,notes:w,updatedAt:U}))(a),s=Wi({participantFilters:{participantRoles:[tJ,EL,iJ,rJ,aJ]},policyDefinitions:rRe,tournamentRecord:a}).participants;s&&(o.tournamentContacts=s);let l=((n=(r=(i=(e=Oh({tournamentRecord:a}))==null?void 0:e.publishState)==null?void 0:i.tournament)==null?void 0:r.status)==null?void 0:n.publishedEventIds)||[],c=[];for(let u of a.events??[])if(!(t!=null&&t.usePublishState)||l.includes(u.eventId)){let d=PQ({event:u}).eventInfo;d&&c.push(d)}return o.eventInfo=c,{tournamentInfo:Fe(o,!1,!0),...Z}}function TR({tournamentRecords:t}){if(!Ii(t))return{error:Ai};let e=Object.keys(t??{}).reduce((n,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=Bh({tournamentRecord:o}),c=s&&new Date(ct(s));(!n.startDate||c&&c<n.startDate)&&(n.startDate=c);let u=l&&new Date(ct(l));return(!n.endDate||u&&u>n.endDate)&&(n.endDate=u),n},{startDate:void 0,endDate:void 0}),i=e.startDate&&ct(e.startDate.toISOString()),r=e.endDate&&ct(e.endDate.toISOString());return!i||!r?{error:vK}:{startDate:i,endDate:r}}function L_({tournamentRecord:t,participantFilters:e}){if(!t)return{error:he};let i=t.participants||[];e&&(i=Aw({participants:i,participantFilters:e,tournamentRecord:t}));let r={},n=a=>{if(a.person){let{personId:o}=a.person;r[o]?r[o].participantIds.push(a.participantId):r[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&n(a)}),{tournamentPersons:Object.values(r)}}function nRe(t){var e,i,r,n,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===ii))==null?void 0:i.length)===2,c=((r=t.events)==null?void 0:r.length)===1&&t.events[0],u=((n=c==null?void 0:c.drawDefinitions)==null?void 0:n.length)===1&&c.drawDefinitions[0],d=((s=(o=((a=u==null?void 0:u.structures)==null?void 0:a.length)===1&&u.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(c.tieFormat&&l&&d)}function __({tournamentRecord:t}){if(!t)return{error:he};let{drawsAnalysis:e}=Yw({tournamentRecord:t}),i={isDual:nRe(t),drawsAnalysis:e};return{...Z,analysis:i}}var RQ={};yt(RQ,{compareTieFormats:()=>ku,getTieFormat:()=>B_,tieFormatGenderValidityCheck:()=>nR,validateCollectionDefinition:()=>zw});function G0(t){var e;if(!t)return{};let i=[],r=t.tieFormatName,n=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=a;i.includes(s)||i.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,o===Xd?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&r||"UNNAMED",matchUpFormats:i,tieFormatDesc:n}}function ku({considerations:t={},descendant:e,ancestor:i}){var r,n;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=G0(e),{matchUpFormats:c,tieFormatDesc:u}=G0(i),d=ht((s??[]).filter(U=>!(c??[]).includes(U)).concat((c??[]).filter(U=>!(s??[]).includes(U)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionName:U})=>U).join("|")),m=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")!==i.collectionDefinitions.map(({collectionOrder:U})=>U).join("|")),h=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U}))),f=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(U=>({[U.collectionId]:U})));a.collectionIds=Z2(Object.keys(h),Object.keys(f)),o.collectionIds=Z2(Object.keys(f),Object.keys(h)),a.collectionsValue=AV(h),o.collectionsValue=AV(f),a.groupsCount=((r=i==null?void 0:i.collectionGroups)==null?void 0:r.length)??(0-(((n=e==null?void 0:e.collectionGroups)==null?void 0:n.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,I=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,y=o.collectionsValue.assignmentValues.some((U,T)=>{let P=a.collectionsValue.assignmentValues[T];return!P||U.valueKey!==P.valueKey||U.value!==P.value?!0:Array.isArray(U.value)?U.value.every((R,D)=>P.value[D]===R):!1}),b=p||m||u!==l||I||y||g!==0,S=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=S.length&&S;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:m,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:u,...Z,different:b,invalid:w}}function AV(t){let e=[],i=[],r=0;return{totalValue:Object.keys(t).sort(JP).reduce((n,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,m={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},h=Object.keys(m).filter(g=>![void 0,null].includes(m[g]));h.length!==1&&e.push({collectionId:a});let f=h[0];if(f){let g=f==="collectionValueProfiles"?Object.values(s):m[f];i.push({valueKey:f,value:g})}return r+=c,s?n+s.reduce((g,v)=>g+v.value,0):c?nt(u)?n+u*c:nt(d)?n+d*c:nt(p)?n+p*c:n+l:n},0),totalMatchUps:r,invalidValues:e,assignmentValues:i}}function $_(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=EQ(t);return{matchUp:Fe(e,!0,!0),error:i}}function EQ({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var p;if(!i)return{error:he};if(typeof s!="string")return{error:Xr};if(!a||!d){let f=(Lr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!f)return{error:an};({eventId:c,drawId:u}=f),{event:d,drawDefinition:a}=xn({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:ma};n&&!r&&(r=Zu({tournamentRecord:i,contextProfile:n}));let m={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:h=[]}=Nh({participantsProfile:t,tournamentRecord:i,contextProfile:n,inContext:l});if(o){let f=(Nn({context:l?m:void 0,participants:h,afterRecoveryTimes:e,contextContent:r,contextProfile:n,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!f)return{error:an};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===f.structureId);return{drawDefinition:a,structure:g,matchUp:f}}else{let{matchUp:f,structure:g}=gi({context:l?m:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:r,drawDefinition:a,contextProfile:n,matchUpId:s,inContext:l,event:d});return{matchUp:f,structure:g,drawDefinition:a}}}function B_({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,structure:n,eventId:a,drawId:o,event:s}){var l,c,u,d,p;if(!t)return{error:he};if(!o&&!s&&!i&&!r)return ee({result:{error:Ve},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(I=>I.eventId===a));let m=$_({tournamentRecord:t,drawDefinition:e,matchUpId:r,drawId:o,event:s});if(r&&m!=null&&m.error)return m;if(!e&&m!=null&&m.drawDefinition&&(e=m==null?void 0:m.drawDefinition),n=n??(m==null?void 0:m.structure),!n&&i&&!r){if(!e)return{error:Ps};let I=et({drawDefinition:e,structureId:i});if(I.error)return I;n=I.structure}let h=((n==null?void 0:n.tieFormat)||(n==null?void 0:n.tieFormatId))&&((c=cn({structure:n,drawDefinition:e,event:s}))==null?void 0:c.tieFormat),f=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((u=cn({drawDefinition:e,event:s}))==null?void 0:u.tieFormat),g=(d=cn({event:s}))==null?void 0:d.tieFormat,v=(p=cn({matchUp:m==null?void 0:m.matchUp,drawDefinition:e,structure:n,event:s}))==null?void 0:p.tieFormat;return{...Z,matchUp:m==null?void 0:m.matchUp,structureDefaultTieFormat:Vr(h),eventDefaultTieFormat:Vr(g),drawDefaultTieFormat:Vr(f),tieFormat:Vr(v),structure:n}}var CQ={};yt(CQ,{bulkUpdatePublishedEventIds:()=>V_,getAllEventData:()=>j_,getCourtInfo:()=>zP,getDrawData:()=>DR,getEventData:()=>PR,getEventPublishStatus:()=>mo,getPublishState:()=>Oh,getVenueData:()=>ag});function V_({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:he};if(!(e!=null&&e.length))return{error:Ve,info:"Missing outcomes"};let r=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(r);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>n.includes(a.eventId))).filter(a=>{let o=mo({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:c}=a;return r[c].filter(u=>{let d=s?Object.keys(o.drawDetails).filter(p=>PL({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:r}}function MQ({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let r=Ii(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(r))return r!=null&&r.length?!!r.filter(n=>!t.length||t.includes(n)).length:!1}function NQ({convertExtensions:t,ignoreDisabled:e,venue:i,court:r}){var n;let a={...Fe(r,t,!0),venueId:i.venueId},{extension:o}=ft({name:cs,element:r});if(e&&o){let s=Ii(o.value)?(n=o.value)==null?void 0:n.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function tc(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:r=[],dates:n}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(r.length&&!r.includes(p.venueId))){if(i){let{extension:m}=ft({name:cs,element:p});if(m!=null&&m.value)continue}o.includes(p.venueId)||(c.push(Fe(p,e,!0)),o.push(p.venueId));for(let m of p.courts??[])if(!s.includes(m.courtId)){if(i){let{extension:f}=ft({name:cs,element:m});if(MQ({extension:f,dates:n}))continue}let{inContextCourt:h}=NQ({convertExtensions:e,ignoreDisabled:i,venue:p,court:m});l.push(h),s.push(m.courtId)}}}),{courts:l,venues:c,...Z}}function aRe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:r}){if(!e)return{error:Ai};let n=Fe(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=ft({name:cs,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=n.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(r!=null&&r.length))return c;let{extension:u}=ft({name:cs,element:c});return MQ({extension:u,dates:r})}).filter(Boolean).map(c=>{let{inContextCourt:u}=NQ({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?o.concat(l):o},[]);return{venues:n,courts:a}}function Xw({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Ai}:Object.keys(t).reduce((r,n)=>{let a=t[n],{venues:o}=aRe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!r.venueIds.includes(l)&&(r.venues.push(s),r.venueIds.push(l))}),r},{venues:[],venueIds:[]})}function j_({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:he};let i=t.events||[],r=(t==null?void 0:t.participants)||[],{tournamentInfo:n}=Bh({tournamentRecord:t}),{venues:a}=tc({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,c=PQ({event:s}).eventInfo,u=Sw({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(m=>{let h=(({drawId:y,drawName:b,matchUpFormat:S,updatedAt:w})=>({matchUpFormat:S,updatedAt:w,drawName:b,drawId:y}))(m),{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:I}=wv({requireParticipants:!0,tournamentParticipants:r,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:m,event:s});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:I}}}),p=mo({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:n,venuesData:a,eventsData:o}}}function AQ({publishStatus:t,drawId:e}){var i,r,n;return t!=null&&t.drawDetails?(n=(r=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:r.publishingDetail)==null?void 0:n.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function DR(t){var e,i;let{tournamentParticipants:r=[],includePositionAssignments:n,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,status:c=Xo,drawDefinition:u,noDeepCopy:d,sortConfig:p,context:m,event:h}=t;if(!u)return{error:Ce};let f=(({matchUpFormat:D,updatedAt:E,drawType:N,drawName:A,drawId:M})=>({matchUpFormat:D,updatedAt:E,drawName:A,drawType:N,drawId:M}))(u),g,v,{allStructuresLinked:I,sourceStructureIds:y,hasDrawFeedProfile:b,structureGroups:S}=tR({drawDefinition:u});if(!I)return{error:sK};let w=(t==null?void 0:t.publishStatus)??mo({event:h,status:c}),U=t.eventPublished??!!((i=(e=Oh({event:h}).publishState)==null?void 0:e.status)!=null&&i.published),T=!1,P=!1,R=S.map(D=>{let E={},N=D.map(A=>{let{structure:M}=et({drawDefinition:u,structureId:A}),{seedAssignments:C}=ao({drawDefinition:u,structure:M});return(M==null?void 0:M.stage)===Oe&&M.stageSequence===1&&(g=C),(M==null?void 0:M.stage)===qe&&M.stageSequence===1&&(v=C),M}).sort((A,M)=>Rh(A,M,p)).map(A=>{var M;if(!A)return;let C=A==null?void 0:A.structureId,O=[];A.stage&&[Oe,Yr,Fi].includes(A.stage)&&(O=g),(A==null?void 0:A.stage)===qe&&(O=v);let{matchUps:k,roundMatchUps:x,roundProfile:F}=$t({seedAssignments:(M=A==null?void 0:A.seedAssignments)!=null&&M.length?void 0:O,context:{drawId:f.drawId,...m},tournamentParticipants:r,policyDefinitions:a,tournamentRecord:o,usePublishState:l,publishStatus:w,drawDefinition:u,inContext:s,structure:A,event:h}),{positionAssignments:$}=ei({structure:A}),_=$==null?void 0:$.filter(ga(Ll)).map(V=>{let{drawPosition:G,participantId:j}=V,{extension:H}=ft({element:V,name:xc});return P=!0,{participantResult:H==null?void 0:H.value,participantId:j,drawPosition:G}});if(!(_!=null&&_.length)&&k.length&&t.allParticipantResults){let{subOrderMap:V}=tX({positionAssignments:$}),G=Pv({matchUpFormat:A.matchUpFormat,policyDefinitions:a,subOrderMap:V,matchUps:k});_=$==null?void 0:$.filter(ga(Ll)).map(j=>{let{drawPosition:H,participantId:W}=j;return P=!0,{participantResult:W&&G.participantResults[W],participantId:W,drawPosition:H}})}let L=A?(({stageSequence:V,structureName:G,structureType:j,matchUpFormat:H,stage:W})=>({stageSequence:V,structureName:G,structureType:j,matchUpFormat:H,stage:W}))(A):{};L.sourceStructureIds=y[C],L.hasDrawFeedProfile=b[C],L.positionAssignments=$,L.structureActive=k.reduce((V,G)=>{var j;let H=[Zi,Yu,Ot,dn,jt,Yo,hr,ir].includes(G.matchUpStatus);return V||H||!!G.winningSide||!!((j=G.score)!=null&&j.scoreStringSide1)},!1);let B=k.reduce((V,G)=>V&&[Ft,Zi,dn,jt,Ot,Ca].includes(G.matchUpStatus),!!k.length);return L.structureCompleted=B,E[C]=B,L.structureActive&&(T=!0),{...L,participantResults:_,seedAssignments:O,roundMatchUps:x,roundProfile:F,structureId:C}});return N.forEach(A=>{var M;n||delete A.positionAssignments,A.sourceStructuresComplete=(M=A.sourceStructureIds)==null?void 0:M.every(C=>E[C])}),N}).flat();return f.drawActive=T,f.participantPlacements=P,f.drawGenerated=R==null?void 0:R.reduce((D,E)=>D||!!(E!=null&&E.roundMatchUps),!1),f.drawCompleted=R==null?void 0:R.reduce((D,E)=>D&&E.structureCompleted,!0),f.drawPublished=l?U&&AQ({publishStatus:w,drawId:f.drawId}):void 0,{structures:!l||f.drawPublished?d?R:Fe(R,!1,!0):void 0,drawInfo:d?f:Fe(f,!1,!0),...Z}}function PR(t){var e,i;let{includePositionAssignments:r,participantsProfile:n,policyDefinitions:a,usePublishState:o,status:s=Xo,sortConfig:l}=t,c=kt(t,[{tournamentRecord:!0},{[RF]:{event:!1,eventId:!1}}]);if(c.error)return c;let u=Fe(t.tournamentRecord,!1,!0),d=t.event?void 0:xn({tournamentRecord:u,eventId:t.eventId}).event,p=t.event?Fe(t.event,!1,!0):d&&Fe(d,!1,!0)||void 0;if(!p)return{error:ha};let{eventId:m}=p,{tournamentId:h,endDate:f}=u,g=mo({event:p,status:s}),v=Oh({event:p}).publishState??{},I=!!((e=v==null?void 0:v.status)!=null&&e.published),{participants:y}=Wi({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:a,...n,tournamentRecord:u}),b=({stage:A,drawId:M})=>{var C,O,k;if(!o)return!0;let x=(O=(C=g==null?void 0:g.drawDetails)==null?void 0:C[M])==null?void 0:O.stageDetails;return!x||!Object.keys(x).length?!0:(k=x[A])==null?void 0:k.published},S=({structureId:A,drawId:M})=>{var C,O,k;if(!o)return!0;let x=(O=(C=g==null?void 0:g.drawDetails)==null?void 0:C[M])==null?void 0:O.structureDetails;return!x||!Object.keys(x).length?!0:(k=x[A])==null?void 0:k.published},w=({drawId:A})=>o?AQ({publishStatus:g,drawId:A}):!0,U=({drawId:A,structure:M})=>{var C,O,k,x;if(!o)return M;let F=(x=(k=(O=(C=g==null?void 0:g.drawDetails)==null?void 0:C[A])==null?void 0:O.structureDetails)==null?void 0:k[M.structureId])==null?void 0:x.roundLimit;if(nt(F)){let $=Ee(1,F+1),_={},L={};for(let B of $)M.roundMatchUps[B]&&(_[B]=M.roundMatchUps[B],L[B]=M.roundProfile[B]);M.roundMatchUps=_,M.roundProfile=L}return M},T=p.drawDefinitions||[],P=!o||I?T.filter(w).map(A=>(({drawInfo:M,structures:C})=>({...M,structures:C}))(DR({allParticipantResults:t.allParticipantResults,context:{eventId:m,tournamentId:h,endDate:f},includePositionAssignments:r,tournamentParticipants:y,noDeepCopy:!0,policyDefinitions:a,tournamentRecord:u,usePublishState:o,drawDefinition:A,publishStatus:g,sortConfig:l,event:p}))).map(({structures:A,...M})=>{let C=A==null?void 0:A.filter(({stage:O,structureId:k})=>S({structureId:k,drawId:M.drawId})&&b({stage:O,drawId:M.drawId})).map(O=>U({drawId:M.drawId,structure:O}));return{...M,structures:C}}).filter(A=>{var M;return(M=A.structures)==null?void 0:M.length}):void 0,{tournamentInfo:R}=Bh({tournamentRecord:u}),D=(u.venues||[]).map(A=>(({venueData:M})=>({...M}))(ag({tournamentRecord:u,venueId:A.venueId}))),E=(({eventId:A,eventName:M,eventType:C,eventLevel:O,surfaceCategory:k,matchUpFormat:x,category:F,gender:$,startDate:_,endDate:L,ballType:B,discipline:V})=>({eventId:A,eventName:M,eventType:C,eventLevel:O,surfaceCategory:k,matchUpFormat:x,category:F,gender:$,startDate:_,endDate:L,ballType:B,discipline:V}))(p),N={tournamentInfo:R,venuesData:D,eventInfo:E,drawsData:P};return N.eventInfo.publishState=v,N.eventInfo.published=(i=v==null?void 0:v.status)==null?void 0:i.published,{...Z,eventData:N,participants:y}}var OQ={};yt(OQ,{getPersonRequests:()=>kp,getProfileRounds:()=>CR,getScheduledRoundsDetails:()=>Zw,getSchedulingProfile:()=>ic,getSchedulingProfileIssues:()=>G_});function RR({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:r,categoryName:n,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ia({matchUpFormat:r}))return{error:Xb};let c=Object.keys(i).filter(d=>!o||d===o),u;return c.forEach(d=>{var p;if(u)return;let m=i[d],h=l?(p=xn({tournamentRecord:m,eventId:l}))==null?void 0:p.event:void 0;return u=Tw({tournamentRecord:m,matchUpFormat:r,categoryName:n,categoryType:a,eventType:s,event:h}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function Zw({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:r=30,matchUps:n,rounds:a}){if(typeof i!="object")return{error:Ai};if(!Array.isArray(a))return{error:Ve,info:ql("rounds")};let o={},s=[];a.sort((p,m)=>(p.sortOrder??0)-(m.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>gv({tournamentRecord:p}).containedStructures)),n||({matchUps:n}=Us({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var m;let h=p.periodLength||r,f=[];e!=null&&e[p.structureId]?f.push(...e[p.structureId]):f.push(p.structureId);let g=n?Yp({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:f,matchUps:n}).sort(Ah):[],{segmentNumber:v,segmentsCount:I}=p.roundSegment||{};if(nt(v)&&ws(g==null?void 0:g.length)&&ws(I)&&v>0&&v<=I&&I<(g==null?void 0:g.length)&&!((m=p.matchUpIds)!=null&&m.length)){let w=g.length/I,U=w*(v-1);g=g.slice(U,U+w)}let y=i[p.tournamentId],b=xn({drawId:p.drawId,tournamentRecord:y}).event,S=[];for(let w of g){let U=w.matchUpFormat;U&&(o[U]||(o[U]=[],o[U].push(w)),S.push(U))}for(let w of S){let{eventType:U,category:T}=b??{},{categoryName:P,ageCategoryCode:R}=T??{},{typeChangeRecoveryMinutes:D,recoveryMinutes:E,averageMinutes:N,error:A}=RR({categoryName:P??R,categoryType:T==null?void 0:T.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:U});if(A)return{error:A,round:p};let M=g.filter(O=>(t||!Sr.includes(O.matchUpStatus))&&O.matchUpStatus!==Ft).map(wr);M.forEach(O=>{d[O]={typeChangeRecoveryMinutes:D,recoveryMinutes:E,averageMinutes:N},c[O]=E,u[O]=N}),s.push(...M),l=Math.max(N||0,l);let C=`${N}|${h}`;return{roundPeriodLength:h,recoveryMinutes:E,averageMinutes:N,matchUpIds:M,hash:C}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...Z}}function kQ({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:r}){let n=[],a=t==null?void 0:t.map(s=>{let l=ct(s==null?void 0:s.scheduleDate);if(!l){n.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){n.push(`Missing venueId: ${p}`);return}let m=d.filter(h=>{let f=i.includes(h.eventId)&&r.includes(h.drawId);return f||n.push(`Invalid eventId: ${h.eventId} or drawId: ${h.drawId}`),f});if(m.length)return{venueId:p,rounds:m}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),o=n.length;return{updatedSchedulingProfile:a,modifications:o,issues:n}}function ER({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:oe};let{venueIds:i,tournamentsMap:r}=sRe({tournamentRecords:t}),n,a,o=e.every(s=>{let{scheduleDate:l,venues:c}=s;return Da(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(m=>{var h,f,g,v;if(!m)return a="empty round",!1;let{roundSegment:I,tournamentId:y,structureId:b,roundNumber:S,eventId:w,drawId:U}=m,T=(v=(g=(f=(h=r==null?void 0:r[y])==null?void 0:h[w])==null?void 0:f[U])==null?void 0:g[b])==null?void 0:v.includes(S);T||(a="Invalid rounds");let{segmentNumber:P,segmentsCount:R}=I||{},D=!I||nt(P)&&ws(R)&&P<=R;return D||(a="Invalid segment"),T&&D}):(n=av,!1):(a="rounds should be an array",!1)}):!1});return!o&&!n&&(n=oe),{valid:!!o,error:n,info:a}}function oRe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:r}=t,n=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!r||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(n.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;o.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let m=p.drawId;s.push(m),i[c][d][m]={};let{structures:h}=zl({drawDefinition:p});(h||[]).forEach(f=>{var g;let v=f.structureId,{matchUps:I}=$t({structure:f}),{roundMatchUps:y}=Pn({matchUps:I}),b=y&&Object.keys(y).map(S=>parseInt(S));i[c][d][m][v]=b,a.push(v),(g=f.structures)!=null&&g.length&&f.structures.forEach(S=>{a.push(S.structureId),i[c][d][m][S.structureId]=b})})})})),{tournamentMap:i,tournamentIds:n,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function sRe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:r,eventIds:n,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:m,eventIds:h,drawIds:f}=oRe({tournamentRecord:c});return m.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...h),l.drawIds.push(...f),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:r,eventIds:n,drawIds:a}}function ic({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ai};let{extension:i}=ft({element:e,name:Fm,tournamentRecords:t,discover:!0}),r=(i==null?void 0:i.value)||[];if(r.length){let{venueIds:n}=Xw({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=QL({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=kQ({schedulingProfile:r,venueIds:n,eventIds:a,drawIds:o});if(l){r=s;let u=Rv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:r});return u.error?u:{schedulingProfile:r,modifications:l,issues:c}}}return{schedulingProfile:r,modifications:0}}function Rv({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let r=ER({tournamentRecords:t,schedulingProfile:i});return r.error?r:i?Mt({tournamentRecords:t,discover:!0,extension:{name:Fm,value:i}}):In({element:e,name:Fm,tournamentRecords:t,discover:!0})}function Qw(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=ic({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:r}=Xw({tournamentRecords:i}),{eventIds:n,drawIds:a}=QL({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=kQ({schedulingProfile:t.schedulingProfile,venueIds:r,eventIds:n,drawIds:a});return s?{...Rv({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...Z,modifications:s,issues:l}}function G_(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:r=30}=t??{};if(typeof i!="object")return{error:Yb};if(!Array.isArray(e))return{error:oe};if(!e.every(Da))return{error:Tn};let n=[],a=0,o={},{schedulingProfile:s}=ic({tournamentRecords:i});if(!s)return{issues:n,...Z};let{matchUps:l}=Us({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let m of p||[])if(m){let{rounds:h}=m,f=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=Zw({tournamentRecords:i,periodLength:r,matchUps:l,rounds:h}),{matchUpDependencies:I}=Zo({tournamentRecords:i,matchUps:l}),y=b=>{let S;return v==null||v.find((w,U)=>{let T=w.matchUpIds.includes(b);return T&&(S=U),T}),S};if(g==null||g.forEach((b,S)=>{var w;let U=g.slice(S+1),T=Hi(U,((w=I==null?void 0:I[b])==null?void 0:w.matchUpIds)||[]);T.length&&f.push({matchUpId:b,shouldBeAfter:T})}),f.length){a+=f.length;let b=f.map(({matchUpId:S,shouldBeAfter:w})=>{let U=y(S),T=ht(w.map(y));return o[d]||(o[d]={}),o[d][U]||(o[d][U]=[]),T.forEach(P=>{o[d][U].includes(P)||o[d][U].push(P)}),{matchUpId:S,matchUpRoundIndex:U,earlierRoundIndices:T,shouldBeAfter:w}});n.push(...b)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...n.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:m}=u;return{[d]:{earlierRoundIndices:m,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:o,...Z}}function kp(t){let{tournamentRecords:e,requestType:i}=t,r=kt(t,[{[sn]:!0}]);if(r.error)return r;let n={};for(let a of Object.values(e)){let{extension:o}=ft({element:a,name:pv}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};n[c]||(n[c]=[]);for(let d of u)i&&d.requestType!==i||n[c].push(d)}}return{personRequests:n,...Z}}function zM(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:r,tournamentId:n,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,c=r?e:o,u=[n,s,l,c,a].join("|");return He({structureId:c,roundSegment:i,tournamentId:n,roundNumber:a,eventId:s,drawId:l,id:u})}function OV({round:t,matchUps:e,events:i,tournamentRecords:r}){let n=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=n||{},{categoryName:l,ageCategoryCode:c}=o||{},u=fa(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let m=u[p],h=RR({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:r,matchUpFormat:p,categoryType:s,eventType:a});if(h.error)return h;let f=h.averageMinutes*m;isNaN(d)||(d+=f)}),{roundMinutes:d}}function lRe(t){return(t||[]).reduce((e,i)=>{var r,n;let a=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((s,l)=>s+l,0),o=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function kV(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,r=t.filter(({winningSide:c,matchUpStatus:u})=>c||Sr.includes(u)).length||0,n=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==Ft).length||0,a=e-i,o=a===r,s=a-n,l=a-n;return{unscheduledCount:s,incompleteCount:l,scheduledCount:n,completedCount:r,matchUpsCount:e,isScheduled:a===n,isComplete:o,byeCount:i}}function CR({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:r}){if(i&&!t){if(typeof i!="object")return{error:Yb};t={[i.tournamentId]:i}}if(e){let a=ER({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=ic({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:on};let n={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=zM(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(n[u.id]=u.roundSegment.segmentsCount),He({id:r?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:n}}var xQ={};yt(xQ,{getEntriesAndSeedsCount:()=>MR,getMaxEntryPosition:()=>H_});function MR({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:r,event:n,stage:a}){if(!n)return{error:Wt};let{entries:o,stageEntries:s}=sJ({drawDefinition:e,drawId:r,stage:a,event:n}),l=s.length,{drawSize:c}=NX({participantsCount:l}),u=Jw({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return ee({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:o,seedsCount:d,stageEntries:s}}function H_(t){let{entries:e=[],entryStatus:i,stage:r}=t;return Math.max(...e.filter(n=>(!r||r===n.entryStage)&&(!i||n.entryStatus===i)&&!isNaN(n.entryPosition)).map(({entryPosition:n})=>Xe(n||0)),0)}var FQ={};yt(FQ,{allCompetitionMatchUps:()=>Us,allDrawMatchUps:()=>Nn,allEventMatchUps:()=>Qu,allTournamentMatchUps:()=>Lr,analyzeMatchUp:()=>yy,calculateWinCriteria:()=>Vh,checkMatchUpIsComplete:()=>Md,competitionScheduleMatchUps:()=>tU,drawMatchUps:()=>t$,eventMatchUps:()=>AR,getAllDrawMatchUps:()=>cr,getAllStructureMatchUps:()=>$t,getCheckedInParticipantIds:()=>Ch,getCompetitionMatchUps:()=>Iy,getEventMatchUpFormatTiming:()=>W_,getMatchUpCompetitiveProfile:()=>Uw,getMatchUpContextIds:()=>X_,getMatchUpDailyLimits:()=>kR,getMatchUpDailyLimitsUpdate:()=>q_,getMatchUpDependencies:()=>Zo,getMatchUpFormat:()=>Z_,getMatchUpFormatTiming:()=>Tw,getMatchUpFormatTimingUpdate:()=>z_,getMatchUpScheduleDetails:()=>WP,getMatchUpType:()=>qP,getMatchUpsStats:()=>Q_,getModifiedMatchUpFormatTiming:()=>NR,getParticipantResults:()=>Gw,getPredictiveAccuracy:()=>J_,getRoundMatchUps:()=>Pn,getRounds:()=>e$,isValidMatchUpFormat:()=>Ia,matchUpActions:()=>pR,participantScheduledMatchUps:()=>Y_,tallyParticipantResults:()=>Pv,tournamentMatchUps:()=>OR,validMatchUp:()=>GP,validMatchUps:()=>po});function LQ({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ai};let i=[],r;for(let n of Object.values(t)){let{extension:a}=ft({element:n,name:e});a&&!r&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),r=!0);let o=n.events??[];for(let s of o){let{eventId:l}=s,{extension:c}=ft({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function z_({tournamentRecords:t}){return LQ({extensionName:Ru,tournamentRecords:t})}var KE="ADULT",JE="JUNIOR",VU="WHEELCHAIR",_Q={[od]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[ui]:30,default:60}}]},defaultDailyLimits:{[Ni]:2,[ui]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ka],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[VU],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[KE,VU],minutes:{default:60,[ui]:30}},{categoryTypes:[JE],minutes:{default:60,[ui]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[KE,VU],minutes:{default:30}},{categoryTypes:[JE],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[KE,JE],minutes:{default:30}},{categoryTypes:[VU],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},uRe=_Q;function W_({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:r}){if(!r)return{error:Wt};let n=[],a;if(e!=null&&e.length){let d=[];n=e.map(p=>{let m=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(m==null?void 0:m.matchUpFormat)&&Ia({matchUpFormat:m==null?void 0:m.matchUpFormat}))return d.push(m.matchUpFormat),m}).filter(Boolean)}else{let{policy:d}=Pp({policyType:Vl,tournamentRecord:t,event:r});if(d!=null&&d.matchUpFormats)n=d==null?void 0:d.matchUpFormats;else{let{extension:p}=ft({name:Ru,element:r}),m,h;p!=null&&p.value?{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=p.value:{matchUpAverageTimes:m,matchUpRecoveryTimes:h}=uRe[od],n=ht([...(m||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=r,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:Wt};let u=n.map(({matchUpFormat:d,description:p})=>{let m=Tw({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:o,event:r});return{matchUpFormat:d,description:p,...m}});return He({eventMatchUpFormatTiming:u,info:a})}function NR(t){let e=kt(t,[{[Zl]:!0},{[is]:f=>Ia({matchUpFormat:f}),[_l]:Xb,[UF]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:r,event:n}=t,{extension:a}=ft({name:Ru,element:n}),o=a==null?void 0:a.value,{extension:s}=ft({element:i,name:Ru}),l=s==null?void 0:s.value,c=(o==null?void 0:o.matchUpAverageTimes)&&aI({...o,matchUpFormat:r}),u=(l==null?void 0:l.matchUpAverageTimes)&&aI({...l,matchUpFormat:r}),d=[c,u].find(f=>f),p=(o==null?void 0:o.matchUpRecoveryTimes)&&oI({...o,matchUpFormat:r}),m=(l==null?void 0:l.matchUpRecoveryTimes)&&oI({...l,matchUpFormat:r}),h=[p,m].find(f=>f);return{matchUpFormat:r,recoveryTimes:h,averageTimes:d}}function q_({tournamentRecords:t}){return LQ({extensionName:sw,tournamentRecords:t})}var eU=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function Y_({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!po(e))return{error:Xl};if(!Array.isArray(t))return{error:oe};let i=e.filter(Boolean).filter(({schedule:r})=>eU({schedule:r,scheduleAttributes:t})).reduce((r,n)=>{let{schedule:a}=n,o=ct(a==null?void 0:a.scheduledDate),s=fi(a==null?void 0:a.scheduledTime);return o&&s&&(r[o]?r[o].push(n):r[o]=[n]),r},{});return Object.keys(i).forEach(r=>{i[r].sort((n,a)=>{var o,s;return E9(fi((o=n.schedule)==null?void 0:o.scheduledTime),fi((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...Z,scheduledMatchUps:i}}function cRe({tournamentRecords:t}){var e;let i=[],r={};for(let n of Object.values(t))for(let a of n.events??[]){let o=mo({event:a}),s=o==null?void 0:o.drawDetails;Ii(s)?(Object.assign(r,s),i.push(...Object.keys(s).filter(l=>PL({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:r}}function H0({schedulingProfile:t,matchUps:e=[]}){let i={},r=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let m=r({eventId:l,drawId:c,structureId:u,roundNumber:d});i[m]=p})});let n=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&ct(l.scheduledDate)||l.scheduledTime&&ct(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},m=p.scheduledTime&&fi(p.scheduledTime)||"noScheduledTime";c[m]||(c[m]=[]),c[m].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((m,h)=>{let f=i[r(m)]||0,g=i[r(h)]||0;return f-g}),n.push(...p)}}return n}function K_({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:oe};let r=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>o?c:o},1),n=e?Math.max(e,r):r,a=Ee(0,n).map(o=>({matchUps:Ee(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:o+1,venueId:u,courtId:c}}})}));return i.forEach((o,s)=>{var l;for(let c of o.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}function AR(t){let{participants:e,contextContent:i,participantMap:r}=t,{tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:m,contextProfile:h,nextMatchUps:f,tournamentId:g,inContext:v,context:I,event:y}=t;if(!y)return{error:Wt};let{eventId:b,eventName:S,endDate:w,eventType:U,category:T,gender:P}=y??{},R={...I,...He({surfaceCategory:y.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:y.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:S,eventType:U,category:T,eventId:b,gender:P})},D;!e&&u&&({participants:e,participantMap:r,groupInfo:D}=Nh({participantsProfile:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:h,inContext:v})),h&&!i&&(i=Zu({policyDefinitions:l,tournamentRecord:u,contextProfile:h,event:y}));let E=mo({event:y});return{...(y.drawDefinitions??[]).reduce((N,A)=>{var M;let C=wv({context:R,tournamentAppliedPolicies:n,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:m,participantMap:r,publishStatus:E,contextProfile:h,drawDefinition:A,nextMatchUps:f,inContext:v,event:y});return(M=Object.keys(C))==null||M.forEach(O=>{Array.isArray(C[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(C[O]))}),N},{}),...Z,groupInfo:D}}function OR(t){if(!(t!=null&&t.tournamentRecord))return{error:he};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:m,context:h}=t,f=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:I,groupInfo:y}=Nh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=Zu({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=Gt({tournamentRecord:s}),S=(u==null?void 0:u.eventIds)??[];return{...g.filter(w=>!S.includes(w.eventId)).map(w=>{var U,T,P;let R={eventDrawsCount:((T=(U=Yi({event:w}).flightProfile)==null?void 0:U.flights)==null?void 0:T.length)||((P=w.drawDefinitions)==null?void 0:P.length)||0,...h};return AR({context:R,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:I,participants:v,tournamentId:f,nextMatchUps:m,inContext:l,event:w})}).reduce((w,U)=>{var T;return(T=U&&Object.keys(U).filter(P=>!["success","matchUpsMap"].includes(P)))==null||T.forEach(P=>{Array.isArray(U[P])&&(w[P]||(w[P]=[]),w[P]=w[P].concat(U[P]),w.matchUpsCount+=U[P].length)}),w},{matchUpsCount:0}),groupInfo:y}}function Iy({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:r,usePublishState:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Ai};let c=Object.keys(i).map(d=>{let p=i[d];return OR({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:r,tournamentRecord:p,usePublishState:n,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(m=>{Array.isArray(p[m])&&(d[m]||(d[m]=[]),d[m]=d[m].concat(p[m])),m==="groupInfo"&&Object.assign(u,p[m])}),d),{}),groupInfo:u}}function tU(t){var e,i,r,n,a,o,s,l;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Ai};let{courts:c,venues:u}=tc(t),d=ic(t).schedulingProfile,{sortDateMatchUps:p=!0,courtCompletedMatchUps:m,alwaysReturnCompleted:h,activeTournamentId:f,tournamentRecords:g,withCourtGridRows:v,minCourtGridRows:I,usePublishState:y,status:b=Xo,sortCourtsData:S}=t,w=y?(i=(e=Ew({tournamentRecord:g[f??Uh()],itemType:`${Rp}.${Ep}`}).timeItem)==null?void 0:e.itemValue)==null?void 0:i[b]:void 0,U=h?Iy({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Zi]},contextFilters:t.contextFilters}).completedMatchUps:[];if(y&&(!w||!Object.keys(w).length))return{completedMatchUps:U,dateMatchUps:[],courtsData:[],venues:u};let T,P;y&&({drawIds:T,detailsMap:P}=cRe({tournamentRecords:g})),T!=null&&T.length&&(t.contextFilters||(t.contextFilters={}),(r=t.contextFilters)!=null&&r.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(x=>T.includes(x)):t.contextFilters.drawIds=T),(n=w==null?void 0:w.eventIds)!=null&&n.length&&(t.matchUpFilters||(t.matchUpFilters={}),(a=t.matchUpFilters)!=null&&a.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(x=>w.eventIds.includes(x)):t.matchUpFilters.eventIds=w.eventIds),(o=w==null?void 0:w.scheduledDates)!=null&&o.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(x=>w.scheduledDates.includes(x)):t.matchUpFilters.scheduledDates=w.scheduledDates),h&&(t.matchUpFilters||(t.matchUpFilters={}),(l=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&l.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Zi)||t.matchUpFilters.excludeMatchUpStatuses.push(Zi):t.matchUpFilters.excludeMatchUpStatuses=[Zi]);let{completedMatchUps:R,upcomingMatchUps:D,pendingMatchUps:E,groupInfo:N}=Iy({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),A=[...D??[],...E??[]];P&&Object.keys(P).length&&(A=A.filter(x=>{let{drawId:F,structureId:$,stage:_}=x;if(!P[F])return!1;if(P[F].stageDetails){let L=Object.keys(P[F].stageDetails),B=L.filter(G=>!P[F].stageDetails[G].published),V=L.filter(G=>P[F].stageDetails[G].published);return B.length&&B.includes(_)?!1:V.length&&V.includes(_)?!0:B.length&&!B.includes(_)&&!V.length}if(P[F].structureDetails){let L=Object.keys(P[F].structureDetails),B=L.filter(G=>!P[F].structureDetails[G].published),V=L.filter(G=>P[F].structureDetails[G].published);return B.length&&B.includes($)?!1:V.length&&V.includes($)?!0:B.length&&!B.includes($)&&!V.length}return!0}));let M=p?H0({matchUps:A,schedulingProfile:d}):A,C=c==null?void 0:c.map(x=>{let F=k(x);return{surfaceCategory:(x==null?void 0:x.surfaceCategory)??"",matchUps:F,...x}}),O={completedMatchUps:h?U:R,dateMatchUps:M,courtsData:C,groupInfo:N,venues:u};if(v){let{rows:x,courtPrefix:F}=K_({minRowsCount:I,courtsData:C});O.courtPrefix=F,O.rows=x}return{...O,...Z};function k({courtId:x}){let F=(m?M.concat(R??[]):M).filter($=>{var _,L,B;return((_=$.schedule)==null?void 0:_.courtId)===x||((B=(L=$.schedule)==null?void 0:L.allocatedCourts)==null?void 0:B.map(({courtId:V})=>V).includes(x))});return S?H0({matchUps:F,schedulingProfile:d}):F}}function kR({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Ai};let i=Object.keys(t).filter(n=>!e||n===e),r;return i.forEach(n=>{let a=t[n],{matchUpDailyLimits:o}=dRe({tournamentRecord:a});r=o}),{matchUpDailyLimits:r}}function dRe(t){var e;let i=kt(t,[{[Zl]:!0}]);if(i.error)return i;let{tournamentRecord:r}=t,{policy:n}=Pp({policyType:od,tournamentRecord:r}),{extension:a}=ft({element:r,name:sw}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function J_(t){var e,i,r,n;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:c,exclusionRule:u,zoneDoubling:d,matchUpType:p,scaleName:m,eventId:h,zonePct:f,drawId:g,event:v}=t;if(!s&&!a)return{error:he};if(p&&![Ni,ui].includes(p))return{error:oe,info:{matchUpType:p}};if(a&&!po(a))return{error:oe,context:{matchUps:a}};let I=Ta[m],y=(I==null?void 0:I.ascending)??t.ascending??!1,b=(I==null?void 0:I.accessor)??t.valueAccessor,S=Array.isArray(I==null?void 0:I.range)?Math.abs(I.range[0]-I.range[1]):0,w=nt(f)&&S?(f??0/100)*S:t.zoneMargin??S,U={withScaleValues:!0,withCompetitiveness:!0},T={matchUpTypes:p?[p]:[Ni,ui]},P=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(k=>k.drawId===g):h&&(a=a.filter(k=>k.eventId===h)):a===void 0&&(a=g&&!l&&[]||!g&&h&&!v&&[]||g&&((i=Nn({inContext:!0,drawDefinition:l,contextFilters:T,contextProfile:U,participants:P}))==null?void 0:i.matchUps)||!g&&h&&((r=Qu({inContext:!0,contextFilters:T,contextProfile:U,participants:P,event:v}))==null?void 0:r.matchUps)||((n=Lr({tournamentRecord:s,contextFilters:T,contextProfile:U}))==null?void 0:n.matchUps)||[]),p&&(a=a.filter(k=>k.matchUpType===p));let R=a.filter(({winningSide:k,score:x,sides:F,matchUpStatus:$})=>![dn,Ot,jt,mv,Ca].includes($??"")&&_r({score:x})&&(F==null?void 0:F.length)===2&&k),D=mRe({matchUps:R,excludeMargin:c,exclusionRule:u,valueAccessor:b,ascending:y,scaleName:m}),E=!d||Bi(Ni)(p)?w:(w||0)*2,N=w?R.map(({competitiveProfile:k,matchUpType:x,score:F,sides:$})=>{let _=$Q({singlesForDoubles:o,valueAccessor:b,matchUpType:x,scaleName:m,sides:$}),L=Math.abs(_[0].value-_[1].value);return{competitiveness:k==null?void 0:k.competitiveness,valuesGap:L,score:F}}).filter(({valuesGap:k})=>k<=E):[],A=pRe({zoneData:N}),M=A&&[].concat(Object.values(A)).flat().length,C=M&&Object.assign({},...Object.keys(A).map(k=>({[k]:Math.round(1e4*A[k].length/M)/100}))),O=R.length-((N==null?void 0:N.length)||0);return{...Z,relevantMatchUps:R,zoneDistribution:C,zoneData:N,accuracy:D,nonZone:O}}function pRe({zoneData:t}){let e={[dL]:[],[cy]:[],[dy]:[]};for(let i of t){let{competitiveness:r,score:n,valuesGap:a}=i;e[r]&&e[r].push({score:n,valuesGap:a})}return e}function $Q({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:r,scaleName:n,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=o[0]&&c<=o[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let m of u){let{scaleValue:h,value:f}=xV({singlesForDoubles:t,valueAccessor:i,participant:m,matchUpType:r,scaleName:n}),{exclude:g,exclusionValue:v}=s(h);g&&c.push(v),d.push(h),f&&!isNaN(p)?p+=f:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=xV({singlesForDoubles:t,valueAccessor:i,matchUpType:r,participant:l,scaleName:n}),{exclude:m,exclusionValue:h}=s(d);return m&&c.push(h),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function xV({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:r,scaleName:n}){var a,o,s,l,c;let u=t?Ni:i,d=(o=(a=r==null?void 0:r.rankings)==null?void 0:a[u])==null?void 0:o.find(h=>h.scaleName===n),p=(c=((l=(s=r==null?void 0:r.ratings)==null?void 0:s[u])==null?void 0:l.find(h=>h.scaleName===n))||d)==null?void 0:c.scaleValue,m=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:m}}function mRe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:r,scaleName:n,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:m}=c;if(!m)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:Ve};let h=m-1,f=$Q({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:n,sides:d});if(e){let S=f.map(({exclusionValues:w})=>w).flat();if(S.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:S,winningSide:m,sideValues:f});continue}}if(f.filter(S=>![void 0,"",null].includes(S.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:m,sideValues:f});continue}let g=f[h].value-f[1-h].value,v=parseFloat(t||0),I=v&&Math.abs(g)<v;if(I){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:m,excludeGap:I,sideValues:f,valuesGap:g});continue}let y=r?g:g*-1,b=m===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;y>0?o.affirmative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:m,sideValues:f,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Vh({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:r}=nX({collectionGroups:e}),n;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,m=s&&r.includes(s);if(nt(p||d))n=!0;else{if(m)continue;if(typeof l=="number"&&nt(l))i+=l;else if(o!=null&&o.length)for(let h of o)i+=h.matchUpValue;else typeof u=="number"&&nt(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return n||!i?{aggregateValue:!0,...Z}:{valueGoal:Math.floor(i/2)+1,...Z}}function X_({matchUps:t,matchUpId:e}){if(!po(t))return{error:oe};let i=t.find(s=>s.matchUpId===e),{drawId:r,eventId:n,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:r,eventId:n,structureId:a,tournamentId:o}}function iU(t,e){if(!Ii(t))return{error:oe};if(!Array.isArray(e))return{error:oe};let i={};for(let{param:r,error:n,attr:a}of e){let o=hRe({params:t,param:r,attr:a,error:n});if(o!=null&&o.error)return o;i[r]=o}return i}function hRe({params:t,param:e,attr:i,error:r}){if(e===PF&&Ii(t.drawDefinition)&&On(t.structureId)){let n=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!n.length&&r?{error:r}:{structure:n}}if(e===nd){let n=EQ({...t,...i});return n.error&&r?{...n,error:r}:n}return{error:on,info:{param:e}}}function Z_(t){var e,i;let{structureId:r,matchUpId:n,event:a}=t,o=t.drawDefinition,s=kt(t,[{[Zl]:!0},{[RF]:{[SF]:!1,[wp]:!1,[S9]:!1,[lv]:!1}}]);if(s[dm])return s;let l=(e=iU(t,[{[nw]:nd,[dm]:Ve}]))==null?void 0:e.matchUp;if(n&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let c=l==null?void 0:l.structure;if(!c&&r&&!n){if(!o)return{error:Ps};let h=et({drawDefinition:o,structureId:r});if(h.error)return h;c=h.structure}let u=c==null?void 0:c.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,m=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||u||d||p;return{structureDefaultMatchUpFormat:u,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:m}}function Q_({profileBands:t,tournamentRecord:e,matchUps:i}){if(!po(i))return{error:Xl};let r=!t&&Pp({policyType:su,tournamentRecord:e}).policy,n=t||(r==null?void 0:r.profileBands)||pL[su].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(g8),s=(p,m)=>{let h=f8(m,n);return p[h]+=1,p},l=v8(o).reduce((p,m)=>s(p,m),{[dL]:0,[cy]:0,[dy]:0,[h8]:0}),c=Object.keys(l).reduce((p,m)=>(l[m]||0)+p,0),u=Object.keys(l).map(p=>{let m=parseFloat((l[p]/c).toFixed(4));return{[p]:m*100}}),d=a.filter(({matchUpStatus:p})=>p===tV).length;return u.push({[tV]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...Z}}var{stageOrder:FV}=cUe;function fRe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(FV[t==null?void 0:t.stage]||0)-(FV[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function e$({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:r,tournamentRecords:n,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var m;if(r&&!Array.isArray(r||typeof r[0]!="object"))return{error:oe,inContextMatchUps:r};if(o&&!n){if(typeof o!="object")return{error:Yb};n={[o.tournamentId]:o}}let h=typeof n!="object"||!Object.keys(n).length;if((d||c||!r||!a&&(t||i||a||s))&&h)return{error:Ai};let f=Object.assign({},...Object.values(n??{}).map(({venues:U=[],tournamentId:T})=>({[T]:U==null?void 0:U.map(({venueId:P})=>P)}))),g=Object.values(n??{}).map(({events:U=[],tournamentId:T,startDate:P,endDate:R})=>U.map(D=>({...D,validVenueIds:f[T],startDate:D.startDate??P,endDate:D.endDate??R}))).flat(),{segmentedRounds:v,profileRounds:I}=n&&(t||i||a||s)&&CR({tournamentRecords:n,schedulingProfile:a})||{},y=t&&Object.assign({},...I.map(U=>({[U.id]:U}))),b=r||n&&((m=Us({tournamentRecords:n,matchUpFilters:l}))==null?void 0:m.matchUps)||[],S=[],w=b&&Object.values(b.reduce((U,T)=>{var P;let R=zM(T).id,D=v==null?void 0:v[R],E=[...((P=U[R])==null?void 0:P.matchUps)??[],T],{containerStructureId:N,stageSequence:A,structureName:M,tournamentId:C,isRoundRobin:O,matchUpType:k,roundNumber:x,roundOffset:F,structureId:$,eventName:_,roundName:L,drawName:B,eventId:V,drawId:G}=T,j=O?N:$;return{...U,[R]:{id:u?R:void 0,structureId:j,stageSequence:A,segmentsCount:D,structureName:M,tournamentId:C,matchUpType:k,roundNumber:x,roundOffset:F,eventName:_,roundName:L,drawName:B,matchUps:E,eventId:V,drawId:G}}},{})).map(U=>{let{minFinishingSum:T,winnerFinishingPositionRange:P}=lRe(U.matchUps),R=U.segmentsCount;if(R){let k=U.matchUps.length/R;return xr(U.matchUps.sort((x,F)=>x.roundPosition-F.roundPosition),k).map((x,F)=>{let{unscheduledCount:$,incompleteCount:_,matchUpsCount:L,isScheduled:B,isComplete:V,byeCount:G}=kV(x),j=OV({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return He({...U,...p,roundSegment:{segmentsCount:R,segmentNumber:F+1},winnerFinishingPositionRange:P,unscheduledCount:$,incompleteCount:_,minFinishingSum:T,matchUpsCount:L,isScheduled:B,roundTiming:j,isComplete:V,byeCount:G,matchUps:x})})}let{unscheduledCount:D,incompleteCount:E,matchUpsCount:N,isScheduled:A,isComplete:M,byeCount:C}=kV(U.matchUps),O=OV({matchUps:U.matchUps,tournamentRecords:n,events:g,round:U});return He({...U,...p,winnerFinishingPositionRange:P,unscheduledCount:D,incompleteCount:E,minFinishingSum:T,matchUpsCount:N,isScheduled:A,roundTiming:O,isComplete:M,byeCount:C})}).flat().filter(U=>{if(t){let F=ct(t),$=u?U.id:zM(U).id;if(F&&y[$]&&ct(y[$].scheduleDate)===F)return!1}let{isComplete:T,isScheduled:P}=U,R=!i||!T,D=!e||!P,E=d||c?g==null?void 0:g.find(({eventId:F})=>F===U.eventId):void 0,N=(E==null?void 0:E.startDate)??(o==null?void 0:o.startDate),A=(E==null?void 0:E.endDate)??(o==null?void 0:o.endDate),M=!c||!N||new Date(c)>=new Date(N),C=!c||!A||new Date(c)<=new Date(A),O=M&&C,k=!d||(E==null?void 0:E.validVenueIds.includes(d)),x=R&&D&&k&&O;return x||S.push(U),x}).sort(fRe)||[];return{...Z,rounds:w,excludedRounds:S}}function yy(t){var e;let{matchUp:i,sideNumber:r,setNumber:n,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:Yn};s=s||(i==null?void 0:i.matchUpFormat);let l=_n(s),c=!!(i!=null&&i.winningSide),u=(e=i.score)==null?void 0:e.sets,d=u==null?void 0:u.length,p=n&&n-1,m=!!(u!=null&&u.find((V,G)=>V.setNumber===n&&G===p)),h=(u==null?void 0:u.filter(V=>V==null?void 0:V.winningSide))||[],f=(h==null?void 0:h.length)||0,g=n&&(u==null?void 0:u.slice(n))||[],v=!!(d&&n&&g!=null&&g.reduce((V,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&V,!0)),I=n<=d&&u.find(V=>V.setNumber===n),y=I&&vy({setObject:I,matchUpScoringFormat:l}),{isCompletedSet:b,sideGameScores:S,sideTiebreakScores:w}=y||{},U=!!(I&&!b&&v||n&&n===d+1&&!c),T=[1,2].includes(r),P=T?r-1:0,R=I&&T&&(!a&&!o&&S[P]!==void 0&&S[P]||a&&w[P]!==void 0&&w[P]),D=!!R,E=h==null?void 0:h.map(V=>vy({setObject:V,matchUpScoringFormat:l}).isValidSetOutcome).reduce((V,G)=>V&&G,!0),N=h.reduce((V,G)=>{let{winningSide:j}=G,H=j-1;return V[H]++,V},[0,0]),A=i==null?void 0:i.winningSide,M=A&&A-1,C=1-M,O=N[M],k=N[C],x=Math.max(...N),F=fa(N)[x],{bestOf:$}=l??{},_=$&&Math.ceil($/2)||1,L=x===_&&F===1&&N.indexOf(x)+1||void 0,B=O>k&&A===L;return{completedSetsHaveValidOutcomes:E,validMatchUpWinningSide:B,calculatedWinningSide:L,matchUpScoringFormat:l,validMatchUpOutcome:L&&E&&B,isLastSetWithValues:v,completedSetsCount:f,isCompletedMatchUp:c,isValidSideNumber:T,hasExistingValue:D,existingValue:R,isExistingSet:m,isActiveSet:U,...y}}function t$({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,tournamentId:v,inContext:I,context:y,event:b}){let{eventId:S,eventName:w,endDate:U,eventType:T,category:P,gender:R}=b??{},D={...y,...He({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:U??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:T,category:P,eventId:S,gender:R})},E;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:E}=Nh({participantsProfile:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:h,inContext:I})),b&&h&&!u&&(u=Zu({policyDefinitions:a,tournamentRecord:s,contextProfile:h,drawDefinition:f,event:b})),{...wv({context:D,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:r,afterRecoveryTimes:n,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:m,contextProfile:h,drawDefinition:f,nextMatchUps:g,inContext:I,event:b}),groupInfo:E}}var BQ={};yt(BQ,{getCompetitionVenues:()=>Xw,getCourts:()=>i$,getVenuesAndCourts:()=>tc,publicFindVenue:()=>vL});function i$({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(r=>e?r.venueId===e:i?i.includes(r.venueId):!0).map(r=>{let{venueId:n}=r,a=Fe(r.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:n})),a}).flat()}:{error:he}}var VQ={};yt(VQ,{categoryCanContain:()=>oR,getCategoryAgeDetails:()=>Hw,getEvent:()=>a$,getEventProperties:()=>r$,getEventStructures:()=>eR,getEventTimeItem:()=>Rw,getEvents:()=>n$,getFlightProfile:()=>Yi,getScaledEntries:()=>$h});function r$({tournamentRecord:t,event:e}){var i,r;if(!t)return{error:he};if(!e)return{error:Wt};let n=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((r=e.category)==null?void 0:r.ageCategoryCode),{eventType:s}=e,l=n.map(m=>m.participantId),c=a.filter(m=>l.includes(m.participantId)),u,d,p;return{entryScaleAttributes:c.map(m=>{var h,f,g,v,I,y;let{participantId:b,participantName:S,name:w}=m,U={scaleType:fL,eventType:s,scaleName:o},T=(f=(h=Pl({participant:m,scaleAttributes:U}))==null?void 0:h.scaleItem)==null?void 0:f.scaleValue;U={scaleType:R8,eventType:s,scaleName:o};let P=(v=(g=Pl({participant:m,scaleAttributes:U}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;U={scaleType:P8,eventType:s,scaleName:o};let R=(y=(I=Pl({participant:m,scaleAttributes:U}))==null?void 0:I.scaleItem)==null?void 0:y.scaleValue;return u=!!(u||T),d=!!(d||P),p=!!(p||R),{participantId:b,participantName:S||w,seed:T,ranking:P,rating:R}}),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:p}}function n$({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:r,eventIds:n,drawIds:a,context:o}){var s,l,c,u;if(!t)return{error:he};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:h})=>!n||Array.isArray(n)&&n.includes(h)).map(h=>{var f;let g=(f=h.drawDefinitions)==null?void 0:f.map(ny);if(a!=null&&a.length&&!Hi(a,g).length)return;let v=Fe(h);return r&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),m={};if(e){let h=Wi({withScaleValues:!0,tournamentRecord:t}).participantMap,f=g=>g.reduce((v,I)=>v+parseFloat(I),0);for(let g of p){let v=i??g.eventType,I=g.eventId;m[I]||(m[I]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let y=(g.entries??[]).filter(({entryStatus:R})=>Jo.includes(R)).map(bt),b=R=>{var D,E,N,A,M,C;if((D=R==null?void 0:R.ratings)!=null&&D[v])for(let O of((E=R==null?void 0:R.ratings)==null?void 0:E[v])??[]){let k=O.scaleName;m[I].ratings[k]||(m[I].ratings[k]=[]);let x=(N=Ta[k])==null?void 0:N.accessor;if(x){let F=parseFloat((A=O.scaleValue)==null?void 0:A[x]);F&&m[I].ratings[k].push(F)}}if((M=R==null?void 0:R.rankings)!=null&&M[v])for(let O of((C=R==null?void 0:R.rankings)==null?void 0:C[v])??[]){let k=O.scaleName;m[I].ranking[k]||(m[I].ranking[k]=[]),O.scaleValue&&m[I].ranking[k].push(O.scaleValue)}};for(let R of y){let D=(s=h==null?void 0:h[R])==null?void 0:s.participant;if((D==null?void 0:D.participantType)!==wt)for(let E of(D==null?void 0:D.individualParticipantIds)??[]){let N=(l=h==null?void 0:h[E])==null?void 0:l.participant;b(N)}else b(D)}let S=m[I].ratings;for(let R of Object.keys(S)){let D=S[R];if(!D.length)continue;let E=(c=X2(D))==null?void 0:c.toFixed(2);m[I].ratingsStats[R]={avg:parseFloat((f(D)/D.length).toFixed(2)),median:E?parseFloat(E):void 0,max:Math.max(...D),min:Math.min(...D)}}let w=(R,D)=>{var E,N;let A=M=>{var C,O,k,x,F,$,_,L,B,V;if((C=m[I].draws)!=null&&C[R]&&(O=M==null?void 0:M.ratings)!=null&&O[v])for(let G of((k=M==null?void 0:M.ratings)==null?void 0:k[v])??[]){let j=G.scaleName;(x=m[I].draws[R])!=null&&x.ratings[j]||(m[I].draws[R].ratings[j]=[]);let H=(F=Ta[j])==null?void 0:F.accessor;if(H){let W=parseFloat(($=G.scaleValue)==null?void 0:$[H]);W&&m[I].draws[R].ratings[j].push(W)}}if((_=m[I].draws)!=null&&_[R]&&(L=M==null?void 0:M.rankings)!=null&&L[v])for(let G of((B=M==null?void 0:M.rankings)==null?void 0:B[v])??[]){let j=G.scaleName;(V=m[I].draws[R])!=null&&V.ranking[j]||(m[I].draws[R].ranking[j]=[]);let H=G.scaleValue;H&&m[I].draws[R].ranking[j].push(H)}};for(let M of D.filter(Boolean)){let C=(E=h==null?void 0:h[M])==null?void 0:E.participant;if((C==null?void 0:C.participantType)!==wt)for(let O of(C==null?void 0:C.individualParticipantIds)??[]){let k=(N=h==null?void 0:h[O])==null?void 0:N.participant;A(k)}else A(C)}},U=[],T=R=>(a==null?void 0:a.length)&&a.includes(R)||U.includes(R);for(let R of g.drawDefinitions??[]){let D=R.drawId;if(T(D))continue;let E=Np({drawDefinition:R}).assignedParticipantIds??[];m[I].draws[D]||(m[I].draws[D]={ratingsStats:{},ratings:{},ranking:{}}),U.push(D),w(D,E)}let P=Yi({event:g}).flightProfile;for(let R of(P==null?void 0:P.flights)??[]){let D=R.drawId;if(T(D))continue;let E=R.drawEntries.map(bt);w(D,E)}for(let R of U){let D=m[I].draws[R].ratings;for(let E of Object.keys(D)){let N=D[E];if(!N.length)continue;let A=(u=X2(N))==null?void 0:u.toFixed(2);m[I].draws[R].ratingsStats[E]={avg:parseFloat((f(N)/N.length).toFixed(2)),median:A?parseFloat(A):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return He({eventScaleValues:m,events:p,...Z})}function a$({tournamentRecord:t,drawDefinition:e,context:i,event:r}){var n;if(!t)return{error:he};if(!r)return{error:Wt};let a=Fe(r);i&&Object.assign(a,i);let o=e&&((n=a.drawDefinitions)==null?void 0:n.find(({drawId:s})=>e.drawId===s));return He({drawDefinition:o,event:a})}function gRe(t){var e,i;let r="validateAndDeriveDrawValues",{appliedPolicies:n,policyDefinitions:a}=yRe(t),o=bRe({...t,policyDefinitions:a,appliedPolicies:n}),s=IRe(t),l=wRe({...t,consideredEntries:s,appliedPolicies:n});if(l!=null&&l.error)return ee({result:l,stack:r});let c=URe({...t,consideredEntries:s}),u=vRe({...t,appliedPolicies:n,policyDefinitions:a,drawSize:c});if(u.error)return ee({result:u,stack:r});let d=u.drawType;if(isNaN(c)&&d!==Lo)return ee({result:{error:Jb},stack:r});let p=(a==null?void 0:a[Io])??(n==null?void 0:n[Io]),m=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[Io]||(a[Io]={...HM[Io]}),a[Io].seedingProfile=m);let h=SRe({...t,drawType:d});return h!=null&&h.error?ee({result:h,stack:r}):{drawSize:c,drawType:d,enforceGender:o,seedingProfile:m,appliedPolicies:n,policyDefinitions:a}}function vRe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:r=!0,drawSize:n}=t,a=t.drawTypeCoercion??Kw({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=OX({drawType:t.drawType,enforceMinimumDrawSize:r,drawTypeCoercion:a,drawSize:n});return o.error?o:{drawType:o.drawType}}function jQ(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...Jo,bw].includes(e.entryStatus))}function IRe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:r}){return(r&&[]||jQ(e)||(t?i:[])).filter(({entryStage:n})=>!n||n===Oe)}function yRe(t){let{tournamentRecord:e,event:i}=t,r=Gt({tournamentRecord:e,event:i}).appliedPolicies??{},n=Fe(t.policyDefinitions??{},!1,!0);return{appliedPolicies:r,policyDefinitions:n}}function bRe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var r,n,a,o;return t??((n=(r=e==null?void 0:e[Cr])==null?void 0:r.participants)==null?void 0:n.enforceGender)??((o=(a=i==null?void 0:i[Cr])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function wRe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:r,enforceGender:n,participantMap:a,participants:o,event:s}=t;return s&&o&&mR({consideredEntries:e,policyDefinitions:r,appliedPolicies:i,participantMap:a,enforceGender:n,participants:o,event:s})}function URe(t){return!t.drawSize&&t.consideredEntries.length&&![Lo,uw,hv,_o,Hl].includes(t.drawType??"")&&sv(t.consideredEntries.length)||t.drawSize&&Xe(t.drawSize)||!1}function SRe(t){var e,i;let{tournamentRecord:r,event:n,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&r&&UR({tournamentRecord:r,categoryType:(e=n==null?void 0:n.category)==null?void 0:e.categoryType,categoryName:(i=n==null?void 0:n.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:Gx}:{...Z}}function xR(t){let{voluntaryConsolation:e,tournamentRecord:i,event:r}=t,n="generateDrawDefinition",{participants:a,participantMap:o}=Wi({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=jQ(r==null?void 0:r.entries)??[],l=gRe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return ee({result:l,stack:n});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:m,seedingProfile:h}=l,f=r==null?void 0:r.eventType,g=t.matchUpType??f,v=DPe({...t,enforceGender:m,eventType:f,matchUpType:g});if(v.error)return ee({result:v,stack:n});let{matchUpFormat:I,tieFormat:y}=v;if(t.drawId&&typeof t.drawId!="string")return ee({result:{error:oe},stack:n});let b=QPe({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:I,seedingProfile:h,participants:a,eventEntries:s,matchUpType:g,tieFormat:y,drawSize:d,drawType:p,event:r});if(b.error)return ee({result:b,stack:n});let{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:T,conflicts:P,entries:R}=b;if(!U)return ee({result:{error:oe},stack:n});let D=eRe({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:c,drawDefinition:U,seedingProfile:h,participants:a,structureId:T,entries:R,params:t,stack:n});if(D.error)return D;let{qualifyingConflicts:E}=D;return U.drawName=t.drawName??(p&&zr(p)),d&&typeof e=="object"&&d>=4&&AL({...e,drawDefinition:U,matchUpType:g}),{existingDrawDefinition:!!S,qualifyingConflicts:E,positioningReports:w,drawDefinition:U,structureId:T,...Z,conflicts:P}}function GQ({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:r,scaleName:n}){if(!t)return{error:Ve,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,r).map(({participantId:s},l)=>({[s]:l+1})));n=n||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Tl,scaleName:n,scaleDate:o}],participantId:s}))}}function TRe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:r,scaleName:n,drawSize:a,drawId:o,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=MR({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:m,stageEntries:h}=d;if(!h||!m)return{error:oe};let f=$h({tournamentRecord:t,scaleAttributes:r,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=GQ({scaleAttributes:r,scaledEntries:f,stageEntries:h,seedsCount:m,scaleName:n});return{scaleItemsWithParticipantIds:g}}var HQ={};yt(HQ,{addDrawEntries:()=>RL,addEventEntries:()=>Rl,addEventEntryPairs:()=>KQ,destroyPairEntries:()=>uJ,destroyPairEntry:()=>NL,getEntriesAndSeedsCount:()=>MR,getMaxEntryPosition:()=>H_,modifyEntriesStatus:()=>N0,modifyEventEntries:()=>JQ,mutate:()=>zQ,promoteAlternate:()=>qQ,promoteAlternates:()=>s$,query:()=>xQ,removeDrawEntries:()=>YQ,removeEventEntries:()=>Ow,setEntryPosition:()=>o$,setEntryPositions:()=>WQ});var zQ={};yt(zQ,{addDrawEntries:()=>RL,addEventEntries:()=>Rl,addEventEntryPairs:()=>KQ,destroyPairEntries:()=>uJ,destroyPairEntry:()=>NL,modifyEntriesStatus:()=>N0,modifyEventEntries:()=>JQ,promoteAlternate:()=>qQ,promoteAlternates:()=>s$,removeDrawEntries:()=>YQ,removeEventEntries:()=>Ow,setEntryPosition:()=>o$,setEntryPositions:()=>WQ});function o$({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:r,skipRefresh:n,event:a}){let o="setEntryPositions";if(!t)return{error:he};if(!i)return ee({result:{error:vr},stack:o});if(r!==void 0&&!Number.isSafeInteger(r))return{error:oe,entryPosition:r};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=r)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===r&&c.participantId!==i&&(c.entryPosition+=.1)})};return n||(a!=null&&a.entries&&(s(a),a.entries=ds({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=ds({entries:e.entries}))),{...Z}}function WQ({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:r}){if(!t)return{error:he};if(!Array.isArray(e))return{error:oe};for(let n of e){let{participantId:a,entryPosition:o}=n,s=o$({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:r});if(s.error)return s}return r!=null&&r.entries&&(r.entries=ds({entries:r.entries})),i!=null&&i.entries&&(i.entries=ds({entries:i.entries})),{...Z}}function qQ(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:oe,participantId:e}:s$({...t,participantIds:[e].filter(Boolean)})}function s$({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:r,stage:n=Oe,eventId:a,event:o}){if(!t)return{error:he};if(!Array.isArray(i))return{error:oe,participantIds:i};if(!o)return{error:Wt};let s="promoteAlternates";if(o){let l=LV({element:o,participantIds:i,stageSequence:r,stage:n});if(l.error)return l}if(e){let l=LV({element:e,participantIds:i,stageSequence:r,stage:n});if(l.error)return a?ee({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...Z},stack:s}):l}return{...Z}}function LV({participantIds:t,stageSequence:e,element:i,stage:r}){let n=(i.entries||[]).filter(d=>d.entryStatus===Ro),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=n.reduce((d,p)=>{let{entryPosition:m}=p;return isNaN(m)&&d||(!d||m<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:MK};let l=s.filter(({entryStatus:d})=>d!==Ro);if(l.length)return{error:aM,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==r);if(c.length)return{error:Nbe,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:Abe,invalidStageSequence:u};for(let d of s){d.entryStatus=Ma;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(h=>{h.entryStatus===Ro&&h.entryPosition>p&&(h.entryPosition=h.entryPosition-1)});let m=Math.max(...i.entries.filter(h=>h.entryStatus===Ma&&!isNaN(h.entryPosition)).map(({entryPosition:h})=>Xe(h||0)),0);d.entryPosition=m||0}return{...Z}}function YQ({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:r,stages:n,event:a}){var o;if(!a)return{error:Wt};if(!r)return{error:Ps};if(!(e!=null&&e.length))return{error:id};let s=Np({drawDefinition:i,stages:n}).assignedParticipantIds??[];if(Dn(s,e))return{error:nv};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:c}=Yi({event:a}),u=(o=c==null?void 0:c.flights)==null?void 0:o.find(d=>d.drawId===r);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(l),t&&(u.drawEntries=ds({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=ds({entries:i.entries}))),{...Z}}function il(t){var e,i,r,n,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:c,pairOverride:u,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:he};if(!d)return ee({result:{error:wh},stack:o});d.participantId||(d.participantId=Yt()),p.participants||(p.participants=[]);let{participantId:m,individualParticipantIds:h}=d;if(p.participants.reduce((b,S)=>S.participantId===m||b,!1))return{error:DK};let{participantType:f,participantRole:g}=d;if(!f||!Object.keys(nI).includes(f))return{error:bs,participantType:f};if(!g)return{error:TK};let v=p.participants||[],I=v.filter(b=>b.participantType===wt).map(b=>b.participantId);if(f!==wt&&d.person)return{error:oe,person:d.person};if(h&&!Array.isArray(h))return{error:oe,individualParticipantIds:h};if(f===st){if(d.person)return{error:oe,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!u)return ee({info:"PAIR must be 2 individualParticipantIds",result:{error:Po},stack:o});{let w=v.filter(U=>U.participantType===wt).map(U=>U.participantId);if(!Array.isArray(d.individualParticipantIds))return ee({result:{error:Po},stack:o});if(!d.individualParticipantIds.reduce((U,T)=>w.includes(T)&&U,!0))return ee({result:{error:Po},stack:o})}}else return ee({result:{error:id},stack:o});let b=v.filter(w=>w.participantType===st).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),S=d.participantType===st&&b.find(w=>Hi(w.individualParticipantIds,d.individualParticipantIds).length===2);if(S&&!s)return{...Z,existingParticipant:!0,participant:l&&Fe(S.participant)};if(!d.participantName){let w=v.filter(T=>{var P;return(P=d.individualParticipantIds)==null?void 0:P.includes(T.participantId)}),U=w.map(T=>{var P;return(P=T.person)==null?void 0:P.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(U+="/Unknown"),d.participantName=U}}else if(f===wt){if(!((r=d.person)!=null&&r.standardFamilyName)||!((n=d.person)!=null&&n.standardGivenName))return{error:CK};if(!d.participantName){let b=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=b}}else if(f&&[ii,_a].includes(f)){if(h||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let b of d.individualParticipantIds){if(typeof b!="string")return ee({result:{participantId:b,error:oe},stack:o});if(!I.includes(b))return ee({result:{participantId:b,error:Ji},stack:o})}}else return{error:bs};p.participants.push(d),c||Tt({payload:{tournamentId:p.tournamentId,participants:[d]},topic:Fc});let y={participant:l&&Fe(d),...Z};return He(y)}function Ss({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:r=[]}){if(!i)return{error:he};i.participants||(i.participants=[]);let n=i.participants.map(d=>d.participantId)||[];r.forEach(d=>{d.participantId||(d.participantId=Yt())});let a=r.filter(d=>!n.includes(d.participantId)),o=r.filter(d=>n.includes(d.participantId)),s=a.filter(d=>d.participantType===wt),l=a.filter(d=>d.participantType!==wt),c=s.concat(...l),u=[];if(c.length){for(let p of c){let m=il({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(m.error)return m;m.success&&!m.existingParticipant&&u.push(m.participant)}u.length&&Tt({topic:Fc,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&Fe(u),addedCount:u.length,...Z};return o.length&&Object.assign(d,{notAdded:o,info:IP}),He(d)}else return{info:"No new participants to add",addedCount:0,...Z}}function KQ({allowDuplicateParticipantIdPairs:t,entryStage:e=Oe,entryStatus:i=Ro,participantIdPairs:r=[],tournamentRecord:n,drawDefinition:a,event:o,uuids:s}){if(!n)return{error:he};if(!o)return{error:Wt};if(o.eventType!==ui)return{error:Ac};let l=[],c=new Map;for(let I of n.participants??[]){let{participantType:y,participantId:b,person:S,individualParticipantIds:w}=I;y===wt&&S!=null&&S.sex?c.set(b,S.sex):y===st&&w&&l.push(w)}let u=r.filter(I=>{if(I.length!==2||!c.has(I[0])||!c.has(I[1]))return!0;if(!o.gender||o.gender===Qs)return!1;let y=I.map(S=>c.get(S)),b=o.gender===li&&(y[0]!==li||y[1]!==li)||o.gender===Si&&(y[0]!==Si||y[1]!==Si);return o.gender===oa&&(y.sort(JP),(y[0]!==Si||y[1]!==li)&&(b=!0)),b});if(u.length)return{error:Po,invalidParticipantIdPairs:u};let d=r.map(I=>({participantId:(s==null?void 0:s.pop())??Yt(),participantRole:en,individualParticipantIds:I,participantType:st})),p=t?d:d.filter(I=>!l.find(y=>Hi(y,I.individualParticipantIds).length===2)),m,h=[];if(p){let I=Ss({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:n});if(I.error)return I;h=I.participants||[],m=I.info}let f=r.map(I=>{let y=h.find(S=>Hi(S.individualParticipantIds,I).length===2);if(y)return y;let{participant:b}=Bo({tournamentRecord:n,participantIds:I});return b}).map(I=>I.participantId),g=Rl({participantIds:f,tournamentRecord:n,drawDefinition:a,entryStatus:i,entryStage:e,event:o});p.length&&Tt({payload:{participants:p},topic:Fc});let v=p.map(bt);return{...g,info:m,newParticipantIds:v}}function JQ({entryStatus:t=Ma,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:r=Oe,tournamentRecord:n,event:a}){if(!n)return{error:he};if(!a)return{error:Wt};let o=n.participants??[],s=o.filter(f=>f.participantType===wt).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:Po,invalidParticipantIds:l};let c=i.filter(f=>f.length!==2);if(c.length)return{error:Po,invalidParticipantIdPairs:c};let u=o.filter(f=>f.participantType===st).map(f=>f.individualParticipantIds),d=i.filter(f=>!u.find(g=>Hi(g,f).length===2)).map(f=>({participantType:st,participantRole:en,individualParticipantIds:f})),p=Ss({participants:d,tournamentRecord:n});if(p.error)return p;let m=i.map(f=>{let{participant:g}=Bo({tournamentRecord:n,participantIds:f});return g}).map(f=>({participantId:f,entryStatus:t,entryStage:r})),h=e.map(f=>({entryStatus:Ko,participantId:f,entryStage:r}));return a.entries=(a.entries??[]).filter(f=>f.entryStage===r),a.entries=a.entries.concat(...m,...h),{...Z}}var XQ={};yt(XQ,{addDrawDefinition:()=>_R,addEvent:()=>rU,addFlight:()=>BR,assignSeedPositions:()=>see,attachFlightProfile:()=>m$,categoryCanContain:()=>oR,deleteDrawDefinitions:()=>FR,deleteEvents:()=>uee,deleteFlightAndFlightDraw:()=>aee,deleteFlightProfileAndFlightDraws:()=>tee,getCategoryAgeDetails:()=>Hw,getEvent:()=>a$,getEventProperties:()=>r$,getEventStructures:()=>eR,getEventTimeItem:()=>Rw,getEvents:()=>n$,getFlightProfile:()=>Yi,getScaledEntries:()=>$h,modifyEvent:()=>cee,modifyEventMatchUpFormatTiming:()=>iee,modifyPairAssignment:()=>oee,mutate:()=>ZQ,query:()=>VQ,refreshEventDrawOrder:()=>p$,removeEventMatchUpFormatTiming:()=>LR,removeScaleValues:()=>h$,removeSeeding:()=>lee,setEventDates:()=>ree,setEventDisplay:()=>$R,setEventEndDate:()=>c$,setEventStartDate:()=>u$,updateDrawIdsOrder:()=>d$,validateCategory:()=>L0});var ZQ={};yt(ZQ,{addDrawDefinition:()=>_R,addEvent:()=>rU,addFlight:()=>BR,assignSeedPositions:()=>see,attachFlightProfile:()=>m$,deleteDrawDefinitions:()=>FR,deleteEvents:()=>uee,deleteFlightAndFlightDraw:()=>aee,deleteFlightProfileAndFlightDraws:()=>tee,modifyEvent:()=>cee,modifyEventMatchUpFormatTiming:()=>iee,modifyPairAssignment:()=>oee,refreshEventDrawOrder:()=>p$,removeEventMatchUpFormatTiming:()=>LR,removeScaleValues:()=>h$,removeSeeding:()=>lee,setEventDates:()=>ree,setEventDisplay:()=>$R,setEventEndDate:()=>c$,setEventStartDate:()=>u$,updateDrawIdsOrder:()=>d$,validateCategory:()=>L0});function Ev({removePriorValues:t=!0,status:e=Xo,statusObject:i,event:r}){if(!Ii(i))return{error:oe};let n=mo({event:r,status:e}),a=`${Rp}.${Ep}`,o={itemValue:{[e]:{...n,...i}},itemType:a};return _h({timeItem:o,removePriorValues:t,event:r})}function Cv(t){var e,i,r,n,a,o,s;let{includePositionAssignments:l,removePriorValues:c,tournamentRecord:u,status:d=Xo,event:p,drawIdsToRemove:m,drawIdsToAdd:h}=t;if(!u)return{error:he};if(!p)return{error:Wt};let{appliedPolicies:f}=Gt({tournamentRecord:u,event:p}),g={...f,...t.policyDefinitions},v=((e=p.drawDefinitions)==null?void 0:e.map(({drawId:D})=>D))??[],I=t.drawDetails?Object.keys(t.drawDetails):[],y=I.length?[]:t.drawIds,b=(h??[]).concat(...m??[],...y??[],...I),S=b.filter(D=>!v.includes(D));if(S.length)return ee({result:{error:ma},context:{invalidDrawIds:S}});let w=mo({event:p,status:d}),U=Object.keys((w==null?void 0:w.drawDetails)||{}).filter(D=>v.includes(D)).reduce((D,E)=>(D[E]=w.drawDetails[E],D),{});for(let D of v)if((!b.length||b.includes(D))&&(m!=null&&m.includes(D)||y!=null&&y.length&&!y.includes(D)?U[D]={...U[D],publishingDetail:{published:!1}}:(h!=null&&h.includes(D)||y!=null&&y.includes(D)||!(y!=null&&y.length))&&(U[D]={...U[D],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[D]){let E=t.drawDetails[D],N=E.structureDetails??U[D].structureDetails,A=E.stageDetails??U[D].stageDetails??{},{structureIdsToRemove:M=[],structureIdsToAdd:C=[],publishingDetail:O={},stagesToRemove:k=[],stagesToAdd:x=[]}=E;if((C||x)&&(O.published=!0),U[D]={publishingDetail:O,structureDetails:N,stageDetails:A},C.length||M.length){let $=(((n=(r=p.drawDefinitions)==null?void 0:r.find(L=>L.drawId===D))==null?void 0:n.structures)??[]).map(({structureId:L})=>L),_=(C??[]).concat(M??[]).filter(L=>!$.includes(L));if(_.length)return ee({result:{error:Ri},context:{invalidStructureIds:_}});N=N??{};for(let L of $)M.includes(L)?N[L]={published:!1}:N[L]={published:!0};U[D].structureDetails=N}let F=(((o=(a=p.drawDefinitions)==null?void 0:a.find($=>$.drawId===D))==null?void 0:o.structures)??[]).map(({stage:$})=>$);if(x.length){for(let $ of x)A[$]={published:!0};for(let $ of F)A[$]||(A[$]={published:!1})}if(x.length||k.length){for(let $ of k)A[$]={published:!1};for(let $ of F)A[$]||(A[$]={published:!0})}(x.length||k.length)&&(U[D].stageDetails=A)}Ev({statusObject:{drawDetails:U},removePriorValues:c,status:d,event:p});let{topics:T}=qo(),P=T.includes(fM),R=P||t.returnEventData?(s=PR({includePositionAssignments:l,usePublishState:!0,tournamentRecord:u,policyDefinitions:g,event:p}))==null?void 0:s.eventData:void 0;return P&&Tt({payload:{eventData:R,tournamentId:u.tournamentId},topic:fM}),{...Z,eventData:R}}var QQ="deleteDrawDefinitions",eee="autoSchedulingAudit",WM="deleteEvents",DRe={AUTO_SCHEDULING_AUDIT:eee,DELETE_EVENTS:WM,DELETE_DRAW_DEFINITIONS:QQ};function FR(t){var e,i,r;if(!t.tournamentRecord)return{error:he};let n="deleteDrawDefinitions",a=t.drawIds??[],o=t.event,{autoPublish:s=!0,tournamentRecord:l,auditData:c,eventId:u,force:d}=t,{appliedPolicies:p}=Gt({tournamentRecord:l,event:o}),m={...p,...t.policyDefinitions},h=Array.isArray(a)?a[0]:void 0;if(!o){let D=xn({tournamentRecord:l,eventId:u,drawId:h});if(D.error)return D;o=D.event}let f=[],g=[],v=[];if(!(o!=null&&o.drawDefinitions))return ee({info:"event has no drawDefinition",result:{...Z},stack:n});let I=o.drawDefinitions.map(({drawId:D})=>D);if(a.length||(a=I),a=a.filter(D=>I.includes(D)),!a.length)return ee({info:"nothing to do; no matching drawIds in event.",result:{...Z},stack:n});let y=Fe(Yi({event:o}).flightProfile,!1,!0),b=({participantId:D,drawPosition:E,qualifier:N,bye:A})=>({bye:A,qualifier:N,drawPosition:E,participantId:D}),S=d??((i=(e=p==null?void 0:p[Vl])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),w=mo({event:o})??{},U=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],T,P=[],R=o.drawDefinitions.filter(D=>{var E,N,A,M,C,O,k,x;if(a.includes(D.drawId)){let F=((E=Nn({event:o,drawDefinition:D}))==null?void 0:E.matchUps)??[];if(F.some(({score:Y})=>_r({score:Y}))&&!S)return P.push(D.drawId),!0;let{drawId:$,drawType:_,drawName:L}=D,B=(N=y==null?void 0:y.flights)==null?void 0:N.find(Y=>Y.drawId===D.drawId);B&&(B.drawEntries=(A=B.drawEntries)==null?void 0:A.filter(Y=>Jo.includes(Y.entryStatus))),U.includes($)&&(U=U.filter(Y=>Y!==$),T=!0);let V=(C=(M=zl({stageSequence:1,drawDefinition:D,stage:Oe}))==null?void 0:M.structures)==null?void 0:C[0],G=(k=(O=V?fy({structureId:V.structureId,tournamentRecord:l,drawDefinition:D}):void 0)==null?void 0:O.positionAssignments)==null?void 0:k.map(b),j=(x=zl({stage:qe,drawDefinition:D}))==null?void 0:x.structures,H=j!=null&&j.length?j.map(Y=>{var q;let re=Y.stageSequence;return{positionAssignments:(q=fy({structureId:Y.structureId,tournamentRecord:l,drawDefinition:D}))==null?void 0:q.positionAssignments.map(b),stageSequence:re}}):void 0,W={action:QQ,payload:{drawDefinitions:[D],eventId:u??(o==null?void 0:o.eventId),auditData:c}};v.push(W),f.push(He({tournamentId:l.tournamentId,eventId:u??(o==null?void 0:o.eventId),qualifyingPositionAssignments:H,positionAssignments:G,auditData:c,drawType:_,drawName:L,drawId:$})),F==null||F.forEach(({matchUpId:Y})=>g.push(Y))}return!a.includes(D.drawId)});if(P.length&&!d)return ee({context:{drawIdsWithScoresPresent:P},result:{error:TP},stack:n});if(o.drawDefinitions=R,y&&sd({event:o,extension:{name:Fo,value:y}}),Qw({tournamentRecord:l}),T){let D={};for(let N of U)D[N]=((r=w.drawDetails)==null?void 0:r[N])??{published:!0};let E=Ev({statusObject:{drawDetails:D},event:o});if(E.error)return{error:E.error}}if(v.length&&Tt({topic:rg,payload:v}),g.length&&Ku({tournamentId:l==null?void 0:l.tournamentId,matchUpIds:g}),a.forEach(D=>{mUe({drawId:D})}),PRe({event:o,deletedDrawsDetail:f,auditData:c}),s&&T){let D=Cv({drawIdsToRemove:a,policyDefinitions:m,tournamentRecord:l,event:o});if(D.error)return{...Z,info:D.error}}return{...Z}}function PRe({event:t,deletedDrawsDetail:e,auditData:i}){let{extension:r}=ft({name:T0,element:t}),n={...i,deletedDrawsDetail:e},a={name:T0,value:Array.isArray(r==null?void 0:r.value)?r==null?void 0:r.value.concat(n):[n]};Mt({element:t,extension:a})}function tee({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:r,force:n}){var a;if(!e)return{error:he};if(!r)return{error:Wt};let{flightProfile:o}=Yi({event:r});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:c})=>c).filter(Boolean),l=FR({eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:r,force:n});return l.error?l:MP({event:r,name:Fo})}return{...Z}}function l$(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:r,tournamentId:n,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Ai};let s=Object.keys(o).filter(c=>!n||n===c);if(n&&!s.includes(n))return{error:oe};let l;for(let c of s){let u=o[c],{event:d}=xn({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=RRe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:r,recoveryTimes:i});if(p.error)return p}return!a||l?{...Z}:{error:ha}}function RRe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:r,event:n}){if(!t)return{error:he};if(r&&!Array.isArray(r))return{error:oe};if(e&&!Array.isArray(e))return{error:oe};let a=Ru;if(n){let{extension:o}=ft({element:n,name:a}),s=(o==null?void 0:o.value)||{},l=_V({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Mt({element:n,extension:{name:a,value:l}})}else{let{extension:o}=ft({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=_V({...s,matchUpFormat:i,averageTimes:r,recoveryTimes:e});Mt({extension:{name:a,value:l},element:t})}return{...Z}}function _V(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:r}=t,{averageTimes:n,recoveryTimes:a}=t;n=(n||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(n==null?void 0:n.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==r)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[r],averageTimes:n});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(r)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==r)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[r],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function iee(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:r,matchUpFormat:n,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:he};if(!Ia({matchUpFormat:n}))return{error:oe};if(!s)return{error:Wt};let{averageTimes:l=[],recoveryTimes:c=[]}=NR({tournamentRecord:e,matchUpFormat:n,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},m={categoryNames:[d],minutes:{}},h=y=>{var b,S;if((b=y.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((S=y.categoryNames)!=null&&S.includes(d)&&(y.categoryNames=y.categoryNames.filter(w=>w!==d),p={minutes:y.minutes,categoryNames:[d]},!y.categoryNames.length)))return y},f=r&&!isNaN(Xe(r)),g=i&&!isNaN(Xe(i)),v=l.map(h).filter(y=>{var b;return(b=y==null?void 0:y.categoryNames)==null?void 0:b.length}),I=c.map(h).filter(y=>{var b;return(b=y==null?void 0:y.categoryNames)==null?void 0:b.length});return f&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||Ni]:r}),v.push(p)),g&&(Object.assign(m.minutes,{[(s==null?void 0:s.eventType)||Ni]:i}),I.push(m)),!f&&!g?{error:oe}:l$({averageTimes:f&&v,recoveryTimes:g&&I,tournamentRecord:e,matchUpFormat:n,eventId:o,event:s})}function LR(t){if(t.event)return $V({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=kt(t,[{[sn]:!0,[U9]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:r}=t;for(let n of Object.values(i??{})){let{event:a}=xn({tournamentRecord:n,eventId:r});if(a)return $V({event:a})}}return{error:ha}}function $V({event:t}){return MP({event:t,name:Ru})}function u$({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:he};if(!e)return{error:Wt};if(!$l.test(i))return{error:Tn};let r=nee(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(ct(i)).getTime();if(!n||!a||o<n||o>a)return{error:Tn};let s=e.endDate&&new Date(ct(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...Z}}function c$({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:he};if(!e)return{error:Wt};if(!$l.test(i))return{error:Tn};let r=nee(t);if(r.error)return r;let{tournamentStartDate:n,tournamentEndDate:a}=r,o=new Date(ct(i)).getTime();if(!n||!a||o<n||o>a)return{error:Tn};let s=e.startDate&&new Date(ct(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...Z}}function ree({tournamentRecord:t,event:e,startDate:i,endDate:r}){if(!t)return{error:he};if(!e)return{error:Wt};if(!i&&!r)return{error:Ve,info:"missing date"};if(i&&!$l.test(i))return{error:Tn};if(r&&!$l.test(r))return{error:Tn};if(i&&r){let n=new Date(ct(i)).getTime(),a=new Date(ct(r)).getTime();if(n>a)return{error:oe}}if(i){let n=u$({tournamentRecord:t,event:e,startDate:i});if(n.error)return n}if(r){let n=c$({tournamentRecord:t,event:e,endDate:r});if(n.error)return n}return{...Z}}function nee(t){let{startDate:e,endDate:i}=t;return!$l.test(e)||!$l.test(i)?ee({result:{error:bK},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(ct(e)).getTime(),tournamentEndDate:new Date(ct(i)).getTime()}}function d$({event:t,orderedDrawIdsMap:e}){var i,r;if(typeof t!="object")return{error:Wt};if(!e)return{error:Ve,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:oe,info:"orderedDrawIdsMap must be an object"};let n=Object.values(e);if(!n.every(o=>!isNaN(o)))return{error:oe,info:"drawOrder must be numeric"};if(ht(n).length!==n.length)return{error:oe,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Hi(o,s).length!==o.length)return{error:oe,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Yi({event:t});return(r=a==null?void 0:a.flights)==null||r.forEach(o=>{o.flightNumber=e[o.drawId]}),{...Z}}function p$({tournamentRecord:t,event:e}){var i;if(!t)return{error:he};if(!e)return{error:Wt};let{flightProfile:r}=Yi({event:e}),n=(r==null?void 0:r.flights)&&Object.assign({},...r.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?d$({event:e,orderedDrawIdsMap:n}):{...Z}}function aee({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:r,event:n,force:a}){var o,s;if(!e)return{error:he};if(!r)return{error:Ps};if(!n)return{error:Wt};let{flightProfile:l}=Yi({event:n});if(l&&(o=l.flights)!=null&&o.find(c=>c.drawId===r)){let c=l.flights.filter(d=>d.drawId!==r),u={name:Fo,value:{...l,flights:c}};sd({event:n,extension:u})}if((s=n.drawDefinitions)!=null&&s.find(c=>c.drawId===r)){let c=FR({drawIds:[r],eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:n,force:a});if(c.error)return c}return p$({tournamentRecord:e,event:n})}function oee({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:r,participantId:n,event:a,uuids:o}){var s,l;if(!a)return{error:Wt};if((a==null?void 0:a.eventType)!==$o)return{error:Ac};if(o&&!Array.isArray(o))return{error:oe};if(!i)return{error:he};if(![t,e,n].every(g=>typeof g=="string"))return{error:vr};if(!(((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:g})=>[Ko,Tp].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:Ks};let c=(i.participants||[]).find(g=>g.participantId===n);if((c==null?void 0:c.participantType)!==st)return{error:rv,participant:c};let u=c.individualParticipantIds,d=[t,...u.filter(g=>g!==e)],{participant:p}=Bo({participantIds:d,tournamentRecord:i}),m;if(p)m=p.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:en,individualParticipantIds:d,participantType:st},v=il({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;m=v.participant.participantId}let{flightProfile:h}=Yi({event:a});if(r){let g=(l=h==null?void 0:h.flights)==null?void 0:l.find(({drawId:v})=>v===r.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===n?{...v,participantId:m}:v)),r.entries=r.entries.map(v=>v.participantId===n?{...v,participantId:m}:v);for(let v of r.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(I=>I.participantId===n?{...I,participantId:m}:I);else if(v.structures)for(let I of v.structures)I.positionAssignments=I.positionAssignments.map(y=>y.participantId===n?{...y,participantId:m}:y)}a.entries=a.entries.map(g=>g.participantId===n&&{...g,participantId:m}||g.participantId===t&&{...g,participantId:e}||g);let f=i.events.some(({entries:g,eventId:v,drawDefinitions:I})=>a.eventId===v?I.some(({drawId:y,entries:b})=>y===(r==null?void 0:r.drawId)?!1:b==null?void 0:b.find(S=>S.participantId===n)):g==null?void 0:g.find(y=>y.participantId===n));if(!f){let g=kh({addIndividualParticipantsToEvents:!1,participantIds:[n],tournamentRecord:i});if(g.error)return g}return{...Z,participantOtherEntries:f,newPairParticipantId:m}}function _R(t){var e,i,r,n,a,o,s,l,c,u,d,p;let{flight:m,suppressNotifications:h,modifyEventEntries:f,existingDrawCount:g,allowReplacement:v,checkEntryStatus:I,tournamentRecord:y,drawDefinition:b,event:S}=t;if(!b)return{error:Ce};if(!S)return{error:Wt};S.drawDefinitions||(S.drawDefinitions=[]);let{drawId:w,drawName:U,entries:T}=b,{entries:P}=S,R=0;if(g!==void 0&&g!==S.drawDefinitions.length)return{error:oe,info:"drawDefintions count mismatch"};let{flightProfile:D}=Yi({event:S}),E=m&&((e=D==null?void 0:D.flights)==null?void 0:e.find(B=>B.flightNumber===m.flightNumber)),N=(n=(r=(i=D==null?void 0:D.links)==null?void 0:i.find(B=>{var V;return((V=B==null?void 0:B.target)==null?void 0:V.drawId)===w}))==null?void 0:r.source)==null?void 0:n.drawId;if(N&&!S.drawDefinitions.find(B=>B.drawId===N))return ee({result:{error:Ce},info:{sourceDrawId:N}});if(E&&E.drawId!==b.drawId)return ee({result:{error:cm},info:{relevantFlight:E}});let A=T==null?void 0:T.every(({participantId:B,entryStatus:V})=>{let G=E==null?void 0:E.drawEntries.find(j=>j.participantId===B);return!V||(G==null?void 0:G.entryStatus)===V}),M=!I||P&&(T==null?void 0:T.every(({participantId:B,entryStatus:V,entryStage:G})=>{var j;return((j=P.find(H=>H.participantId===B&&(!H.entryStage||H.entryStage===G)))==null?void 0:j.entryStatus)===V}));if(E&&!A)return ee({result:{error:cm},context:{drawEntriesPresentInFlight:A,matchingEventEntries:M,relevantFlight:E},info:"Draw entries are not present in flight or do not match entryStatuses"});if(f&&(T==null||T.filter(Boolean).forEach(B=>{if(B!=null&&B.entryStatus&&Jo.includes(B==null?void 0:B.entryStatus)){let V=P==null?void 0:P.filter(Boolean).find(G=>G.participantId===B.participantId);V&&B.entryStatus&&(V==null?void 0:V.entryStatus)!==B.entryStatus&&(V.entryStatus=B.entryStatus,R+=1)}})),P&&!M)return ee({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:M,eventEntries:P},error:cm}});let C=((o=(a=D==null?void 0:D.flights)==null?void 0:a.map(({flightNumber:B})=>!isNaN(B)&&Xe(B)))==null?void 0:o.filter(Boolean))||[],O=((s=S.drawDefinitions.map(({drawOrder:B})=>B&&Xe(B)))==null?void 0:s.filter(Boolean))||[],k=Math.max(0,...O,...C)+1,x=(l=D==null?void 0:D.flights)==null?void 0:l.find(B=>B.drawId===w),F;if(x){x.drawName=b.drawName,F={name:Fo,value:{...D,flights:D.flights}};let B=x.flightNumber;B&&!O.includes(B)?k=B:x.flightNumber=k}else{let B=(D==null?void 0:D.flights)||[];B.push({manuallyAdded:!0,flightNumber:k,drawEntries:T,drawName:U,drawId:w}),F={name:Fo,value:{...D||{},flights:B}}}sd({event:S,extension:F}),Object.assign(b,{drawOrder:k});let $=S.drawDefinitions.find(B=>B.drawId===w),_=y==null?void 0:y.tournamentId,L=S.eventId;if($){if(!v)return{error:Z7};let B=((u=(c=Nn({drawDefinition:$}))==null?void 0:c.matchUps)==null?void 0:u.map(wr))??[],V=(d=Nn({drawDefinition:b}))==null?void 0:d.matchUps;if(!h){B!=null&&B.length&&Ku({matchUpIds:B,action:"modifyDrawDefinition",tournamentId:_,eventId:L}),V!=null&&V.length&&Lc({matchUps:V,tournamentId:_,eventId:L}),S.drawDefinitions=S.drawDefinitions.map(j=>j.drawId===w?b:j);let G=(p=b.structures)==null?void 0:p.map(({structureId:j})=>j);pi({drawDefinition:b,tournamentId:_,structureIds:G,eventId:L})}}else if(S.drawDefinitions.push(b),!h){let{matchUps:B}=Nn({drawDefinition:b,event:S});B&&Lc({tournamentId:y==null?void 0:y.tournamentId,matchUps:B}),pw({drawDefinition:b,tournamentId:_,eventId:L})}return{...Z,modifiedEventEntryStatusCount:R}}function see(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:qx};if(!r)return{error:he};if(!l)return{error:Ps};let d=ao({provisionalPositioning:e,drawDefinition:n,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:m}=d,h=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:I}=v;m&&I<=m&&(!i||h[I])&&(h[I]=v)});let f=Object.values(h),g=f.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==n9(g).length)return{error:Q7};for(let v of f){let I=Tv({...v,provisionalPositioning:e,tournamentRecord:r,drawDefinition:n,seedingProfile:a,structureId:o,event:c});if(I!=null&&I.error)return I;I!=null&&I.success&&u++}return u?{...Z,modifications:u}:{error:ov}}function m$({deleteExisting:t,event:e,flightProfile:i}){var r;let n="attachFlightProfile";if(!i)return ee({result:{error:Ve},stack:n});if(!e)return ee({result:{error:Wt},stack:n});let{flightProfile:a}=Yi({event:e});return a&&!t?ee({result:{error:pF},stack:n}):(r=e.drawDefinitions)!=null&&r.length?ee({result:{error:K7},stack:n}):(sd({event:e,extension:{name:Fo,value:i}}),{flightProfile:Fe(i,!1,!0),...Z})}function ERe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var r;if(!t)return{error:he};if(!i)return{error:id};if(!e)return{error:Ve,info:"scaleAttributes required"};let{scaleType:n,eventType:a,scaleName:o}=e,s=[D8,n,a,o].join(".");return(r=t.participants)==null||r.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==s))}),{...Z}}function h$({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:r,drawId:n,event:a,stage:o}){var s;if(!a)return{error:Wt};if(r&&!Array.isArray(r))return ee({result:{error:oe},info:ql("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(n){let{flightProfile:u}=Yi({event:a}),d=(s=u==null?void 0:u.flights)==null?void 0:s.find(p=>p.drawId===n);d?l=d.drawEntries:l=i==null?void 0:i.entries}let c=(l||[]).filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!r||r.includes(u.entryStatus))).map(bt);return ERe({tournamentRecord:t,scaleAttributes:e,participantIds:c})}function $R({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:r=Xo,event:n}){if(!e)return ee({result:{error:he}});if(!n)return ee({result:{error:Wt}});if(!Ii(i))return ee({result:{error:Ve}});if(Ii(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>gbe(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[o].scheduleDetails=l}}let a=Ev({statusObject:{displaySettings:i},removePriorValues:t,status:r,event:n});return a.error?a:{...Z}}function lee({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:r,drawId:n,event:a,stage:o}){var s,l;if(!t)return{error:he};if(!a)return{error:Wt};r=r||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let c={eventType:a.eventType,scaleType:Tl,scaleName:r};return h$({tournamentRecord:t,scaleAttributes:c,drawDefinition:e,entryStatuses:i,drawId:n,event:a,stage:o})}function uee({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:he};if(!e.events)return{error:ha};if(!Array.isArray(i))return{error:Ve,info:ql("drawIds")};let r=[],n=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let u={action:WM,payload:{events:[s]}};r.push(u),n.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===$o?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Ko&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?o.push(...l):a.push(...l),!c}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return Qw({tournamentRecord:e}),r.length&&(Tt({topic:rg,payload:r}),Lh({tournamentRecord:e,timeItem:{itemType:WM,itemValue:n}})),{...Z}}function cee({tournamentRecord:t,eventUpdates:e,eventId:i,event:r}){var n;let a="modifyEvent";if(!t)return ee({result:{error:he},stack:a});if(!On(i))return ee({result:{error:Wt},context:{eventId:i},stack:a});if(!Ii(e))return ee({result:{error:oe},context:{eventUpdates:e},stack:a});let o=((n=r==null?void 0:r.entries)==null?void 0:n.filter(({entryStatus:m})=>{let h=m;return[...Jo,Ro].includes(h)}).map(({participantId:m})=>m))??[],s=o?Wi({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],l=[],c=s.reduce((m,h)=>{var f,g;let v=(f=h.person)!=null&&f.sex?[h.person.sex]:((g=h.individualParticpants)==null?void 0:g.map(I=>{var y;return(y=I.person)==null?void 0:y.sex}))||[];return l.push(...v),m.includes(h.participantType)?m:m.concat(h.participantType)},[]),u=ht(l),d=!u.length||[oa,Qs].includes(e.gender??"")||u.length===1&&u[0]===e.gender;if(e.gender&&!d)return ee({context:{gender:e.gender,validGender:d},result:{error:oe},stack:a});let p=(c.includes(yr)&&[yr]||c.includes(wt)&&[Wl]||c.includes(st)&&[$o]||[$o,Wl,yr]).includes(e.eventType??"");return e.eventType&&!p?ee({context:{participantType:e.eventType,validEventType:p},result:{error:oe},stack:a}):(e.eventType&&(r.eventType=e.eventType),e.eventName&&(r.eventName=e.eventName),e.gender&&(r.gender=e.gender),{...Z})}function BR({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:r,event:n,stage:a}){var o,s,l;let c="addFlight";if(!n)return ee({result:{error:Wt},stack:c});if(!i)return ee({result:{error:Ve},stack:c});if(e!=null&&e.length){let g=(n.entries??[]).map(bt),v=e.map(bt);if(Hi(v,g).length!==v.length)return ee({result:{error:oe},stack:c})}let u=(o=Yi({event:n}))==null?void 0:o.flightProfile,d=((l=(s=u==null?void 0:u.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&Xe(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,m={drawId:r||Yt(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(m.stage=a),t&&(m.qualifyingPositions=t),((u==null?void 0:u.flights)||[]).find(({drawId:g})=>g===m.drawId))return ee({result:{error:KK},stack:c});let h=((u==null?void 0:u.flights)||[]).concat(m),f={name:Fo,value:{...u||{},flights:h}};return sd({event:n,extension:f})}var CRe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},MRe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},NRe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},dee={COLLEGE_D3:CRe,COLLEGE_DEFAULT:MRe,COLLEGE_JUCO:NRe,DOMINANT_DUO:zZ,DOMINANT_DUO_MIXED:VZ,LAVER_CUP:JZ,TEAM_DOUBLES_3_AGGREGATION:FZ,TIME_TENNIS_DUAL:jZ,TIME_TENNIS_PRO_CIRCUIT:BZ,USTA_BREWER_CUP:GZ,USTA_OZAKI_CUP:HZ,USTA_COLLEGE:WZ,USTA_GOLD_TEAM_CHALLENGE:xZ,USTA_INTERSECTIONAL:$Z,USTA_LEVEL_1:qZ,USTA_SECTION_BATTLE:_Z,USTA_SOUTHERN_LEVEL_5:LZ,USTA_TOC:XZ,USTA_WTT_ITT:YZ,USTA_ZONAL:KZ};function rU({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:r}){var n,a,o,s;if(!e)return{error:he};if(e.events||(e.events=[]),!r)return{error:Wt};let{startDate:l,endDate:c}=e;if(!i&&((n=r.entries)!=null&&n.length||(a=r.drawDefinitions)!=null&&a.length)){let d=He({drawDefinitions:!!((o=r.drawDefinitions)!=null&&o.length),entries:!!((s=r.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:oe,context:d}}let u={eventType:$m,drawDefinitions:[],entries:[],startDate:l,endDate:c,...r};if(r.eventType===oo){if(r.tieFormat){let d=Kn({tieFormat:r.tieFormat});if(d.error)return d}else if(r.tieFormatName){if(!dee[r.tieFormatName])return{context:{tieFormatName:r.tieFormatName},error:oe};let d=Hm({isMock:e==null?void 0:e.isMock,namedFormat:r.tieFormatName,event:r});u.tieFormat=d}}if(u.eventId||(u.eventId=Yt()),e.events.reduce((d,p)=>d||p.eventId===u.eventId,void 0))return{error:lK};{let d=u;if(e.events.push(d),!t){let{topics:p}=qo();if(p.includes(_P)){let m=Qu({event:r}).matchUps??[];Lc({tournamentId:e==null?void 0:e.tournamentId,eventId:r.eventId,matchUps:m})}for(let m of r.drawDefinitions||[])pw({drawDefinition:m})}return{...Z,event:u}}}var pee={};yt(pee,{drawMatic:()=>E_,garman:()=>vee,generateAdHocMatchUps:()=>hR,generateAdHocRounds:()=>R_,generateAndPopulatePlayoffStructures:()=>e_,generateCourts:()=>f$,generateDrawDefinition:()=>xR,generateDrawMaticRound:()=>I_,generateDrawStructuresAndLinks:()=>f_,generateDrawTypeAndModifyDrawDefinition:()=>g_,generateFlightProfile:()=>kRe,generateLineUps:()=>gee,generateQualifyingStructure:()=>qL,generateSeedingScaleItems:()=>GQ,generateVoluntaryConsolation:()=>GX,roundRobinGroups:()=>qSe});var ARe="splitLevelBased",mee="splitWaterfall",hee="splitShuttle",ORe={SPLIT_LEVEL_BASED:ARe,SPLIT_WATERFALL:mee,SPLIT_SHUTTLE:hee};function kRe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:m}=t;if(!p)return{error:Wt};let h=p.entries??[],{flightProfile:f}=Yi({event:p});if(f&&i&&!o)return{error:pF};let g=t.scaledEntries??$h({tournamentRecord:r,scaleAttributes:n,scaleSortMethod:a,sortDescending:s,event:p,stage:m}).scaledEntries,v=g.map(bt),I=hn(h.filter(({participantId:R})=>!v.includes(R)).filter(R=>(!m||!R.entryStage||R.entryStage===m)&&(!R.entryStatus||Dp.includes(R.entryStatus)))),y=g.concat(...I),b=y.length,S=Math.ceil(b/c),w=xr(y,S);u===mee?w=lM(y,c):u===hee&&(w=lM(y,c,!0));function U(R){return(R||[]).map(({participantId:D,scaleValue:E})=>{let N=h.find(A=>A.participantId===D);return N!=null&&N.scaleValue&&E&&(N.scaleValue=E),N}).sort((D,E)=>D.scaleValue-E.scaleValue).map((D,E)=>(D.scaleValue&&(D.seedNumber=E+1),D))}let T=Ee(0,c).map(R=>{let D=R+1;return{flightNumber:D,drawId:(d==null?void 0:d.pop())??Yt(),drawEntries:U(w[R]),drawName:(l==null?void 0:l.length)&&l[R]||`${e} ${D}`}}),P={scaleAttributes:n,splitMethod:u,flights:T};if(i){let R=m$({flightProfile:P,deleteExisting:o,event:p});return{splitEntries:no()&&w||void 0,...R}}else return{flightProfile:P,...Z}}var xRe="ASC",fee="ASC",FRe="DESC",qM="DESC",LRe={ASC:xRe,ASCENDING:fee,DESC:FRe,DESCENDING:qM};function gee(t){var e,i,r,n,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:c,scaleAccessor:u,singlesOnly:d,attach:p,event:m}=t;if((m==null?void 0:m.eventType)!==oo)return{error:Ac};if(!l)return{error:he};if(!o&&!c)return{error:ma};if(o=o??((e=cn({drawDefinition:c,event:m}))==null?void 0:e.tieFormat),Kn({tieFormat:o}).error)return{error:tu};if(typeof u!="object"&&!s)return{error:oe,context:{scaleAccessor:u}};let h={},f=((c==null?void 0:c.entries)??(m==null?void 0:m.entries)??[]).filter(C=>(C==null?void 0:C.entryStatus)===Ma).map(bt),{participants:g=[]}=Wi({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:C})=>f.includes(C)),I=C=>C===Oc?"rankings":"ratings",y=((i=m==null?void 0:m.category)==null?void 0:i.categoryName)??((r=m==null?void 0:m.category)==null?void 0:r.ageCategoryCode),{scaleName:b=y,scaleType:S=Oc,sortOrder:w,accessor:U}=u||{},T=I(S),P=(C,O)=>{var k,x,F;let $=(k=C[T])==null?void 0:k[O];if(!$&&s&&($=(x=C[T])==null?void 0:x[pm]),Array.isArray($)){let _=(F=$.find(L=>L.scaleName===b))==null?void 0:F.scaleValue;if(ki(_))return _;if(U&&typeof _=="object")return _[U]}return 0},R=(C,O,k)=>{let x=w===qM?O:C,F=w===qM?C:O;return P(x,k)-P(F,k)},D=(C,O)=>R(C,O,pm),E=(C,O)=>R(C,O,Xd),N=[],A=(o==null?void 0:o.collectionDefinitions)??[];for(let C of v){let O=((n=C.individualParticipants)==null?void 0:n.sort(D))??[],k=d?O:((a=C.individualParticipants)==null?void 0:a.sort(E))??[],x={};for(let $ of A){let _=[],{collectionId:L,matchUpCount:B,matchUpType:V,gender:G}=$,j=Bi(pm)(V);Ee(0,B).forEach(H=>{let W=j?O:k??[],Y=H+1,q=[];Ee(0,j?1:2).forEach(re=>{var K;let z=(K=W==null?void 0:W.find(te=>{var J;let ie=G&&([li,Si].includes(G)&&G||G===oa&&[li,Si][re]);return(!ie||ie===((J=te.person)==null?void 0:J.sex))&&!_.includes(te.participantId)}))==null?void 0:K.participantId;z&&(q.push(z),_.push(z),x[z]||(x[z]=[]),x[z].push({collectionPosition:Y,collectionId:L}))}),j||N.push(q)})}let F=Object.keys(x).map($=>({collectionAssignments:x[$],participantId:$}));h[C.participantId]=F}let M=[];for(let C of N){let{participant:O}=Bo({tournamentParticipants:g,participantIds:C});if(!O){let k={individualParticipantIds:C,participantRole:en,participantType:st};M.push(k)}}if(p){for(;M.length;)il({participant:M.pop(),tournamentRecord:l});Mt({element:c,extension:{name:Pu,value:h}})}return{...Z,lineUps:h,participantsToAdd:M}}function f$(t){if(!t)return{error:Ve};let e=kt(t,[{dates:!1,[is]:o=>Array.isArray(o)&&o.every(Da)},{uuids:!1,[is]:o=>Array.isArray(o)&&o.every(On)},{startTime:!1,endTime:!1,[is]:CF},{idPrefix:!1,namePrefix:!1,[is]:On},{count:!0,[is]:ki}]);if(e.error)return e;let{startDate:i,endDate:r}=t.tournamentRecord??{},n=t.dates||i&&r&&Kf(i,r)||[],a=Ee(1,t.count+1).map(o=>{var s,l;return He({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Yt(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:n.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...Z,courts:a}}var vee={};yt(vee,{default:()=>BRe,garman:()=>bee});function nU({court:t,date:e}){let i=e&&t.dateAvailability.find(n=>Bl(n.date,e)),r=t.dateAvailability.find(n=>!n.date);return i||r}function Mv(t){let e=kt(t,[{courtDate:!0,_ofType:Ql}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:r}=t,n=[],a=er(r.startTime);(r.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>b0(s.startTime).localeCompare(b0(l.startTime))).forEach(s=>{let l={startTime:fi(a.toISOString()),endTime:s.startTime};er(s.startTime)>a&&n.push(l),er(s.endTime)>a&&(a=er(s.endTime))});let o={startTime:fi(a.toISOString()),endTime:r.endTime};return er(r.endTime)>a&&n.push(o),{timeSlots:n}}function _Re({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:r}){let n=o=>{var s;let{timeSlots:l}=Mv({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=er(o.startTime),l=er(o.endTime);return s>i||l<r?!1:aw(i,l)>=t}return{enoughTime:n}}function Iee(t){let e=kt(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Xn}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:r,periodStart:n,date:a}=t,o=t.courts,s=er(n),l=MF(s,i),{enoughTime:c}=_Re({averageMatchUpMinutes:i,includeBookingTypes:r,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=nU({date:a,court:u});return!!(d&&c(d))}))||[]).length,...Z}}function VR(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:r,periodLength:n=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:oe,courts:o};if(!Array.isArray(s))return{error:f0};if(!Da(a))return{error:Tn};r&&(Array.isArray(r)?r.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:c}=s.reduce((m,h)=>{let{courtId:f}=h;return f?m.courtBookings[f]?m.courtBookings[f].push(h):m.courtBookings[f]=[h]:m.unassignedBookings.push(h),m},{courtBookings:{},unassignedBookings:[]}),u=o.map((m,h)=>{let{courtId:f,courtName:g}=m,v=l[f]||[],I=nU({date:a,court:m})||{},{bookings:y=[],startTime:b,endTime:S,date:w}=I,U=[i[h]&&{startTime:b,endTime:i[h]},...Fe(y,!1,!0),...v].filter(Boolean);return{courtId:f,courtName:g,dateAvailability:{bookings:U,startTime:b,endTime:S,date:w}}});c.sort((m,h)=>Pt(m.startTime)-Pt(h.startTime));let d=()=>u.map(m=>{let h=m.dateAvailability,{timeSlots:f=[]}=Mv({courtDate:h});return{courtName:m.courtName,courtId:m.courtId,timeSlots:f}}).flat(),p=[];for(let m of c){let{startTime:h,endTime:f,averageMinutes:g,recoveryMinutes:v,matchUpId:I}=m,y=Pt(h),b=Pt(f),S=d().reduce((w,{courtId:U,courtName:T,timeSlots:P})=>{let R;return P.find(({startTime:D,endTime:E})=>{R=Pt(D)-y;let N=y>=Pt(D);return b<=Pt(E)&&w.startDifference!==0&&((R===0||R+n>=0)&&(w.startDifference===void 0||R<w.startDifference)||N)})?{courtName:T,courtId:U,startDifference:R}:w},{});if(S.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:I,startTime:h,endTime:f};p.push(w),(e=u.find(({courtId:U})=>U===S.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:m})}return{virtualCourts:u.map(({courtId:m,courtName:h,dateAvailability:f})=>({dateAvailability:[f],courtName:h,courtId:m})),assignedBookings:p}}function jR({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let r=(t||90)+(i||0);return e>r?r:e||30}function yee(t){let{startTime:e="8:00",endTime:i="20:30",count:r=10,date:n}=t??{};return Ee(0,r).map(()=>({dateAvailability:[{date:n,startTime:e,endTime:i}]}))}function dg({scheduleDate:t,startTime:e,endTime:i,courts:r}){let n=e&&"startTime"||i&&"endTime"||void 0;return r.reduce((a,o)=>{let s=nU({date:t,court:o}),l=n&&((s==null?void 0:s[n])||o[n]);return l&&(!a||e&&Pt(l)<Pt(a)||i&&Pt(l)>Pt(a))?l:a},void 0)}function $Re({averageMinutes:t,startTime:e,endTime:i,courts:r,date:n}){e=e||dg({courts:r,scheduleDate:n,startTime:!0}),i=i||dg({courts:r,scheduleDate:n,endTime:!0});let a;if(e&&i){let o=er(e),s=er(i);for(let l of r||[]){if(!Array.isArray(l.dateAvailability))continue;let c=nU({court:l,date:n}),{timeSlots:u}=Mv({courtDate:c});u==null||u.forEach(d=>{let p=er(d.startTime),m=er(d.endTime);if(p>s||p<o||m<o)return!1;if(aw(p,m)>=t){let h=fi(p.toISOString());(!a||h<a)&&(a=h)}})}}return{firstTimeSlotStartTime:a}}function g$(t){let e=kt(t,[{courts:!0,_ofType:Xn}]);if(e.error)return e;let{date:i=EF(),startTime:r="08:00",endTime:n="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||jR({averageMatchUpMinutes:c}),i=ct(i),r=fi(r),n=fi(n);let m=0,h=0,f=0,g=0,v=0;!o&&d&&(o=yee({startTime:r,endTime:n,count:d,date:i}));let{virtualCourts:I}=VR({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:y}=$Re({averageMinutes:c,courts:I,startTime:r,endTime:n,date:i});s&&y&&(r=y||r);let b=Pt(r),S=Pt(n)-b,w=Math.floor(S/a),U=Ee(0,w+1).map(T=>{let P=b+T*a,R=_we(P),D=Iee({courts:I??[],averageMatchUpMinutes:c,periodStart:R,date:i});if(D.error)return{error:D.error};let{availableToScheduleCount:E=0}=D,N=E>h?E-h:0;v+=T?E:0;let A=T?v/T:E,M=a*A/c,C=T?M*(T-1)+A:A,O=E?h&&C-m||N:0;m=C,h=E,f+=O;let k=Xe(f)-g;return g+=k,{periodStart:R,add:k,availableToScheduleCount:E,newCourts:N,totalMatchUps:g}});return{scheduleTimes:U.reduce((T,P)=>{let R=Ee(0,P.add).map(()=>({scheduleTime:P.periodStart}));return T.concat(...R)},[]).flat(),timingProfile:U,totalMatchUps:g}}var bee={getCourtsAvailableAtPeriodStart:Iee,generateTimeSlots:Mv,getScheduleTimes:g$,courtGenerator:yee},BRe=bee,wee={};yt(wee,{isValid:()=>Ia,isValidMatchUpFormat:()=>Ia,parse:()=>_n,stringify:()=>aR});var Uee={};yt(Uee,{allCompetitionMatchUps:()=>Us,allDrawMatchUps:()=>Nn,allEventMatchUps:()=>Qu,allTournamentMatchUps:()=>Lr,analyzeMatchUp:()=>yy,applyLineUps:()=>Hee,assignMatchUpSideParticipant:()=>Tee,assignTieMatchUpParticipantId:()=>z0,bulkMatchUpStatusUpdate:()=>Bee,calculateWinCriteria:()=>Vh,checkInParticipant:()=>I$,checkMatchUpIsComplete:()=>Md,checkOutParticipant:()=>v$,competitionScheduleMatchUps:()=>tU,disableTieAutoCalc:()=>Lee,drawMatchUps:()=>t$,enableTieAutoCalc:()=>kee,eventMatchUps:()=>AR,findMatchUp:()=>$_,getAllDrawMatchUps:()=>cr,getAllStructureMatchUps:()=>$t,getCheckedInParticipantIds:()=>Ch,getCompetitionMatchUps:()=>Iy,getEventMatchUpFormatTiming:()=>W_,getMatchUpCompetitiveProfile:()=>Uw,getMatchUpContextIds:()=>X_,getMatchUpDailyLimits:()=>kR,getMatchUpDailyLimitsUpdate:()=>q_,getMatchUpDependencies:()=>Zo,getMatchUpFormat:()=>Z_,getMatchUpFormatTiming:()=>Tw,getMatchUpFormatTimingUpdate:()=>z_,getMatchUpScheduleDetails:()=>WP,getMatchUpType:()=>qP,getMatchUpsStats:()=>Q_,getModifiedMatchUpFormatTiming:()=>NR,getParticipantResults:()=>Gw,getPredictiveAccuracy:()=>J_,getRoundMatchUps:()=>Pn,getRounds:()=>e$,isValidMatchUpFormat:()=>Ia,matchUpActions:()=>pR,mutate:()=>See,participantScheduledMatchUps:()=>Y_,query:()=>FQ,removeDelegatedOutcome:()=>xee,removeMatchUpSideParticipant:()=>w$,removeTieMatchUpParticipantId:()=>Pee,replaceTieMatchUpParticipantId:()=>b$,resetAdHocMatchUps:()=>jee,resetMatchUpLineUps:()=>R$,resetScorecard:()=>C$,resetTieFormat:()=>E$,setDelegatedOutcome:()=>Vee,setMatchUpFormat:()=>_ee,setMatchUpStatus:()=>oU,setOrderOfFinish:()=>Gee,substituteParticipant:()=>Fee,tallyParticipantResults:()=>Pv,toggleParticipantCheckInState:()=>GR,tournamentMatchUps:()=>OR,updateTieMatchUpScore:()=>ec,validMatchUp:()=>GP,validMatchUps:()=>po});var See={};yt(See,{applyLineUps:()=>Hee,assignMatchUpSideParticipant:()=>Tee,assignTieMatchUpParticipantId:()=>z0,bulkMatchUpStatusUpdate:()=>Bee,checkInParticipant:()=>I$,checkOutParticipant:()=>v$,disableTieAutoCalc:()=>Lee,enableTieAutoCalc:()=>kee,findMatchUp:()=>$_,removeDelegatedOutcome:()=>xee,removeMatchUpSideParticipant:()=>w$,removeTieMatchUpParticipantId:()=>Pee,replaceTieMatchUpParticipantId:()=>b$,resetAdHocMatchUps:()=>jee,resetMatchUpLineUps:()=>R$,resetScorecard:()=>C$,resetTieFormat:()=>E$,setDelegatedOutcome:()=>Vee,setMatchUpFormat:()=>_ee,setMatchUpStatus:()=>oU,setOrderOfFinish:()=>Gee,substituteParticipant:()=>Fee,toggleParticipantCheckInState:()=>GR,updateTieMatchUpScore:()=>ec});function Tee({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:r,matchUpId:n,event:a}){var o,s;if(i&&typeof i!="string")return{error:Ks};if(!e)return{error:Ce};if(!n)return{error:Xr};let l=r===void 0;if(l&&(r=1),![1,2].includes(r))return ee({result:{error:oe,context:{sideNumber:r}}});let{matchUp:c,structure:u}=gi({drawDefinition:e,matchUpId:n,event:a});if(!c)return{error:an};if(!(!(u!=null&&u.structures)&&!(e.drawType&&e.drawType!==Lo)&&!((o=u==null?void 0:u.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:Gx};if(!i&&((s=c==null?void 0:c.score)!=null&&s.scoreStringSide1||Sr.includes(c==null?void 0:c.matchUpstatus)||c!=null&&c.matchUpStatus&&[ir,hr].includes(c.matchUpStatus)))return{error:vP,info:"matchUp has completed status or score"};if(c){if(c.sides=[1,2].map(d=>{var p;let m=((p=c.sides)==null?void 0:p.find(h=>h.sideNumber===d))??{sideNumber:d};return r===d?{...m,participantId:i}:m}),l)for(let d of c.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Et({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:c})}return{...Z,sidesSwapped:l}}function Na({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=gi({drawDefinition:r,event:s,matchUpId:a});if(!l)return{error:an};let c=ud({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return n||Et({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:r,matchUp:l}),c}function v$(t){var e;let i=[{[Zl]:!0},{[Rs]:!0},{[Ll]:!0},{[wp]:!0}],r=kt(t,i);if(r.error)return r;let n=iU(t,[{[nw]:nd,attr:{[DF]:!0}}]);if(n.error)return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,c=(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp,{matchUpStatus:u,score:d}=c??{};if(u&&BF.includes(u)||u&&Sr.includes(u)||_r({score:d}))return{error:iK};let p=Ch({matchUp:c});if(p!=null&&p.error)return p;let{checkedInParticipantIds:m,allRelevantParticipantIds:h}=p??{};if(!(h!=null&&h.includes(s)))return{error:Ks};if(!(m!=null&&m.includes(s)))return{error:EK};let f=I8({matchUp:c});if(f!=null&&f.error)return f;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=f??{},I=g==null?void 0:g.indexOf(s);return I!==void 0&&[0,1].includes(I)&&((v==null?void 0:v[I])??[]).forEach(y=>{Na({drawDefinition:o,matchUpId:l,timeItem:{itemType:E0,itemValue:y}})}),Na({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:E0}}),{...Z,checkedOut:!0}}function I$(t){var e;let i=[{[Zl]:!0},{[Rs]:!0},{[Ll]:!0},{[wp]:!0}],r=kt(t,i);if(r[dm])return r;let n=iU(t,[{[nw]:nd,attr:{[DF]:!0}}]);if(n[dm])return n;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,c=Ch({matchUp:(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp});if(c!=null&&c.error)return c;let{checkedInParticipantIds:u,allRelevantParticipantIds:d}=c??{};if(!(d!=null&&d.includes(s)))return{[dm]:Ks};let p={...Z,checkedIn:!0};return u!=null&&u.includes(s)||Na({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:R0}}),p}function GR(t){var e,i;let r=kt(t,[{[Ll]:!0,[Rs]:!0,[wp]:!0}]);if(r.error)return r;let n=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(n&&((e=t.tournamentRecords)==null?void 0:e[n]));if(!a)return{error:he};let o=(i=iU(t,[{[nw]:nd,attr:{[DF]:!0},[dm]:an}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:an};let{checkedInParticipantIds:s=[]}=Ch({matchUp:o}),{participantId:l,matchUpId:c,drawDefinition:u}=t;return l&&s.includes(l)?v$({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:o}):I$({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:o})}function y$({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:r}){var n,a;if(!t)return{error:he};if(!e)return{error:Ps};if(!r)return{error:ha};let o=Zr({drawDefinition:e}),{matchUp:s}=gi({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:an};let{matchUp:l,structure:c}=gi({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:r});if(!l)return{error:an};let{collectionPosition:u,drawPositions:d,collectionId:p,matchUpTieId:m,matchUpType:h}=l;if(h&&!YP([Ni,ui],h))return{error:kn};let{positionAssignments:f}=ei({structure:c}),g=f==null?void 0:f.filter(T=>d==null?void 0:d.includes(T.drawPosition)),{matchUp:v}=gi({matchUpId:m,drawDefinition:e,matchUpsMap:o}),I=((n=v==null?void 0:v.sides)==null?void 0:n.map(bt))??[],y=(g==null?void 0:g.map(bt))??[],b=[...I,...y],{participants:S}=Wi({tournamentRecord:t,participantFilters:{participantTypes:[ii],participantIds:b}}),{matchUp:w}=gi({matchUpId:m,inContext:!0,drawDefinition:e,matchUpsMap:o}),U=(a=cn({matchUp:v,drawDefinition:e,structure:c,event:r}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:u,teamParticipants:S,collectionId:p,matchUpType:h,dualMatchUp:v,tieMatchUp:s,tieFormat:U,structure:c,...Z}}function b$(t){var e,i,r,n,a,o,s,l,c,u,d,p,m,h,f,g;let v=y$(t);if(v.error)return v;let I="replaceTieMatchUpParticipantid",{existingParticipantId:y,tournamentRecord:b,newParticipantId:S,drawDefinition:w,substitution:U,event:T}=t;if(!y||!S)return ee({result:{error:vr},stack:I});if(y===S)return{...Z};let{inContextDualMatchUp:P,inContextTieMatchUp:R,collectionPosition:D,collectionId:E,dualMatchUp:N,tieMatchUp:A,tieFormat:M}=v,C=R==null?void 0:R.matchUpType,O=(e=R==null?void 0:R.sides)==null?void 0:e.find(z=>{var te,J,ie;return((te=z.participant)==null?void 0:te.participantId)===y||((ie=(J=z.participant)==null?void 0:J.individualParticipantIds)==null?void 0:ie.includes(y))});if(!O)return{error:Ji};let k=((i=Wi({tournamentRecord:b,participantFilters:{participantIds:[y,S]}}))==null?void 0:i.participants)??[];if(k.length!==2)return ee({result:{error:vr},stack:I});if(k[0].participantType!==k[1].participantType)return ee({result:{error:bs},stack:I});let{appliedPolicies:x}=Gt({tournamentRecord:b,drawDefinition:w,event:T}),F=((r=t.policyDefinitions)==null?void 0:r[Cr])??(x==null?void 0:x[Cr])??Sv[Cr],$=k.find(({participantId:z})=>z===S);if((t.enforceGender??((n=F==null?void 0:F.participants)==null?void 0:n.enforceGender))!==!1&&[li,Si].includes(R==null?void 0:R.gender)&&(R==null?void 0:R.gender)!==((a=$==null?void 0:$.person)==null?void 0:a.sex))return{error:rv,info:"Gender mismatch"};let _=(o=F==null?void 0:F.processCodes)==null?void 0:o.substitution;qw({tournamentId:b.tournamentId,eventId:T.eventId,inContextDualMatchUp:P,drawDefinition:w,dualMatchUp:N});let L=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:z})=>z===O.sideNumber);if(!L)return ee({result:{sideNumber:O.sideNumber,existingParticipantId:y,error:on},stack:I});if((c=(l=R==null?void 0:R.sides)==null?void 0:l.flatMap(z=>{var te,J;return((te=z.participant)==null?void 0:te.individualParticipantIds)||((J=z.participant)==null?void 0:J.participantId)||[]}))!=null&&c.includes(S))return ee({result:{error:IP},stack:I});let B=(d=(u=P==null?void 0:P.sides)==null?void 0:u.find(({sideNumber:z})=>z===O.sideNumber))==null?void 0:d.participantId,V=L.lineUp,G=V==null?void 0:V.find(({participantId:z})=>S===z),j=V==null?void 0:V.reduce((z,te)=>te.substitutionOrder>z?te.substitutionOrder:z,0),H=(V==null?void 0:V.map(z=>{var te;let J=Fe(z,!1,!0);if(![y,S].includes(J.participantId))return J;if(!U&&[y,S].includes(J.participantId)&&(J.collectionAssignments=(te=J.collectionAssignments)==null?void 0:te.filter(ie=>!(ie.collectionPosition===D&&ie.collectionId===E))),U&&y===J.participantId&&(J.collectionAssignments=J.collectionAssignments.map(ie=>ie.collectionPosition===D&&ie.collectionId===E&&ie.substitutionOrder===void 0?{...ie,substitutionOrder:j}:ie)),J.participantId===S){J.collectionAssignments||(J.collectionAssignments=[]);let ie={collectionId:E,collectionPosition:D};U&&(ie.previousParticipantId=y,ie.substitutionOrder=(j??0)+1),J.collectionAssignments.push(ie)}return J}))??[];if(!G){let z={collectionId:E,collectionPosition:D};U&&(z.substitutionOrder=(j??0)+1,z.previousParticipantId=y);let te={collectionAssignments:[z],participantId:S};H.push(te)}let W=C===ui,{assignedParticipantIds:Y}=C0({lineUp:V,collectionPosition:D,collectionId:E}),{assignedParticipantIds:q}=C0({lineUp:H,collectionPosition:D,collectionId:E});if(L.lineUp=H,B&&M){let z=Fh({participantId:B,lineUp:H,drawDefinition:w,tieFormat:M});if(z.error)return ee({result:z,stack:I})}else console.log("team participantId not found");let re,K;if(W){let{tournamentRecord:z}=t,te=Bo({participantIds:q,tournamentRecord:z});if(!te.participant){let ie=il({returnParticipant:!0,pairOverride:!0,tournamentRecord:z,participant:{participantRole:en,individualParticipantIds:q,participantType:st}});if(ie.error)return ee({result:ie,stack:I});re=(p=ie.participant)==null?void 0:p.participantId}te=Bo({participantIds:Y,tournamentRecord:z});let J=(m=te.participant)==null?void 0:m.participantId;J&&kh({participantIds:[J],tournamentRecord:z}).success&&(K=J)}if(U||((h=O.substitutions)==null?void 0:h.length)===1){if(U)_&&A&&(A.processCodes=ht([...(A==null?void 0:A.processCodes)??[],..._]));else for(let z of _||[]){let te=(f=A==null?void 0:A.processCodes)==null?void 0:f.lastIndexOf(z);te!==void 0&&((g=A==null?void 0:A.processCodes)==null||g.splice(te,1))}A&&Et({tournamentId:b==null?void 0:b.tournamentId,matchUp:A,context:I,drawDefinition:w})}return N&&Et({tournamentId:b==null?void 0:b.tournamentId,matchUp:N,context:I,drawDefinition:w}),{...Z,modifiedLineUp:H,participantRemoved:K,participantAdded:re}}function Dee({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:r,participantIds:n,collectionId:a}){var o;if(!a||!t||!Array.isArray(n))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:oe};let s=(i==null?void 0:i.lineUp)||((o=tp({participantId:e,drawDefinition:r}))==null?void 0:o.lineUp),l=[],c=[];return{modifiedLineUp:(s==null?void 0:s.map(u=>{var d;if(!n.includes(u.participantId))return u;let p=(d=u.collectionAssignments)==null?void 0:d.filter(m=>{let h=m.collectionId===a&&m.collectionPosition===t;return h&&(m.previousParticipantId&&l.push(m.previousParticipantId),c.push({participantId:u.participantId,...m})),!h});return{participantId:u.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:c,previousParticipantIds:l}}function VRe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var r,n;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===yr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Yi({event:s});(r=l==null?void 0:l.flights)==null||r.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(o)}),(n=s==null?void 0:s.drawDefinitions)==null||n.forEach(c=>{c.entries=(c.entries||[]).filter(o)})}return{...Z}}function HR({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:r}){let n="addIndividualParticipantIds";if(!r)return ee({result:{error:he},stack:n});if(!e||!t)return ee({result:{error:Ve},stack:n});let a=r.participants??[],o=a.find(d=>d.participantId===e);if(!o)return ee({result:{error:Ji},stack:n});if(o!=null&&o.participantType&&![ii,_a].includes(o.participantType))return ee({context:{participantType:o.participantType},result:{error:bs},stack:n});let s=t.filter(d=>{var p;return((p=a.find(m=>m.participantId===d))==null?void 0:p.participantType)!==wt});if(s.length)return ee({result:{error:Po,invalidParticipantIds:s},stack:n});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&XP({individualParticipantIds:c,tournamentRecord:r}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));let{topics:u}=qo();if(u.includes(Kr)){let d=a.find(({participantId:p})=>p===e);Tt({topic:Kr,payload:{participants:[d]}})}return VRe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:r}),{groupingParticipant:Fe(o,!1,!0),added:c.length,...Z}}function zR(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n,pairOverride:a,participant:o}=t;if(!n)return{error:he};if(!o)return{error:wh};if(!o.participantId)return il({tournamentRecord:n,participant:o});let{participant:s}=Mp({participantId:o.participantId,tournamentRecord:n});if(!s)return il({tournamentRecord:n,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:m,onlineResources:h,contacts:f,person:g}=o;if(m&&s.participantType!==m)return{error:UK};let v={};if(f&&(v.contacts=f),h&&(v.onlineResources=h),d&&typeof d=="string"&&(v.participantName=d),u&&typeof u=="string"&&(v.participantOtherName=u),Array.isArray(c)){let{participants:I}=Wi({participantFilters:{participantTypes:[wt]},tournamentRecord:n}),y=I==null?void 0:I.map(bt);if(y){let b=c.filter(S=>typeof S=="string"&&y.includes(S));([_a,di].includes(m||s.participantType)||m===st&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===nI.PAIR&&e&&(v.participantName=jRe({individualParticipants:I,newValues:v}))}}return Object.keys(CL).includes(p)&&(v.participantRole=p),Object.keys(nI).includes(m)&&(v.participantType=m),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===nI.INDIVIDUAL&&g&&GRe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,He(v)),i&&HR({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:r,tournamentRecord:n}),Tt({topic:Kr,payload:{tournamentId:n.tournamentId,participants:[s]}}),{participant:Fe(s),...Z}}function jRe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,r=t.filter(({participantId:n})=>i.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(r+="/Unknown"),r}function GRe({updateParticipantName:t,existingParticipant:e,newValues:i,person:r}){let n={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,sex:c}=r;c&&Object.keys(wL).includes(c)&&(n.sex=c);let u;if(l&&typeof l=="string"&&(n.personId=l),s&&typeof s=="string"&&(HRe(s)||s==="")&&(n.nationalityCode=s),a&&typeof a=="string"&&a.length>1&&(n.standardFamilyName=a,u=!0),o&&typeof o=="string"&&o.length>1&&(n.standardGivenName=o,u=!0),u&&t){let d=`${n.standardGivenName} ${n.standardFamilyName}`;i.participantName=d}Object.assign(e.person,n)}function HRe(t){return bc.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function z0(t){var e,i,r,n,a,o,s,l,c,u,d,p,m,h,f,g,v,I,y,b;let S=y$(t);if(S.error)return S;let w="assignTieMatchUpParticipantId",U=t.teamParticipantId,{tournamentRecord:T,drawDefinition:P,participantId:R,event:D}=t;if(!R)return ee({result:{error:vr},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ee({result:{error:eF},stack:w});let{inContextDualMatchUp:E,inContextTieMatchUp:N,relevantAssignments:A,collectionPosition:M,teamParticipants:C,collectionId:O,matchUpType:k,dualMatchUp:x,tieFormat:F}=S;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(ae=>{var ce,pe;return((ce=ae.participant)==null?void 0:ce.individualParticipantIds)||((pe=ae.participant)==null?void 0:pe.participantId)||[]}))!=null&&i.includes(R))return ee({result:{...Z},stack:w});U=U??(t.sideNumber?(n=(r=E==null?void 0:E.sides)==null?void 0:r.find(ae=>ae.sideNumber===t.sideNumber))==null?void 0:n.participantId:void 0);let $=(o=(a=Wi({participantFilters:{participantIds:[R]},tournamentRecord:T}))==null?void 0:a.participants)==null?void 0:o[0];if(!$)return ee({result:{error:Ji},stack:w});let{appliedPolicies:_}=Gt({tournamentRecord:T,drawDefinition:P,event:D}),L=((s=t.policyDefinitions)==null?void 0:s[Cr])??(_==null?void 0:_[Cr])??Sv[Cr];if((t.enforceGender??((l=L==null?void 0:L.participants)==null?void 0:l.enforceGender))!==!1&&[li,Si].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((c=$.person)==null?void 0:c.sex))return{error:rv,info:"Gender mismatch"};let{individualParticipantIds:B,participantType:V}=$;if(Bi(Ni)(k)&&V!==wt)return{error:bs};let G=V===wt?[R]:B,j=U&&(C==null?void 0:C.find(({participantId:ae})=>ae===U))||(C==null?void 0:C.find(({individualParticipantIds:ae})=>Dn(G,ae)));if(!j)return{error:cF};if(U||(U=j.participantId),!U)return{error:Ji};let H=(u=A==null?void 0:A.find(ae=>ae.participantId===(j==null?void 0:j.participantId)))==null?void 0:u.drawPosition,W=(p=(d=x==null?void 0:x.sides)==null?void 0:d.find(ae=>ae.participantId===U))==null?void 0:p.sideNumber,Y=(h=(m=N==null?void 0:N.sides)==null?void 0:m.find(ae=>H&&ae.drawPosition===H))==null?void 0:h.sideNumber,q=W??Y??t.sideNumber;if(!F)return{error:Zb};if(!((f=F.collectionDefinitions)!=null&&f.find(ae=>ae.collectionId===O)))return{error:hK};qw({tournamentId:T.tournamentId,eventId:D.eventId,inContextDualMatchUp:E,drawDefinition:P,dualMatchUp:x});let re=(g=x==null?void 0:x.sides)==null?void 0:g.find(ae=>ae.sideNumber===q),K=(v=N==null?void 0:N.sides)==null?void 0:v.find(ae=>ae.sideNumber===q),z=(b=(y=(re==null?void 0:re.lineUp)??((I=tp({participantId:U,drawDefinition:P}))==null?void 0:I.lineUp))==null?void 0:y.filter(ae=>{var ce;return(ce=ae.collectionAssignments)==null?void 0:ce.find(pe=>pe.collectionPosition===M&&pe.collectionId===O&&!pe.previousParticipantId)}))==null?void 0:b.map(ae=>ae==null?void 0:ae.participantId),te=(z==null?void 0:z.length)>1&&z||(V===st?$.individualParticipantIds:[R]),J=Dee({collectionPosition:M,teamParticipantId:U,dualMatchUpSide:re,drawDefinition:P,participantIds:te,collectionId:O});if(J.error)return ee({result:J,stack:w});let{modifiedLineUp:ie}=J,ne;if(k===ui){if(V!==st){let ae=XE({collectionPosition:M,teamParticipantId:U,drawDefinition:P,modifiedLineUp:ie,participantId:R,collectionId:O,tieFormat:F});if(ae!=null&&ae.error)return ee({result:ae,stack:w});if(ae=ue({side:K}),ae.error)return ae;ne=ae.deletedParticipantId,re&&(re.lineUp=ie),x&&Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:P})}else if(V===st)for(let ae of te)XE({collectionPosition:M,teamParticipantId:U,drawDefinition:P,modifiedLineUp:ie,participantId:ae,collectionId:O,tieFormat:F})}else{let ae=XE({collectionPosition:M,teamParticipantId:U,drawDefinition:P,modifiedLineUp:ie,participantId:R,collectionId:O,tieFormat:F});if(ae!=null&&ae.error)return ae}if(re&&(re.lineUp=ie),x&&Et({tournamentId:T==null?void 0:T.tournamentId,matchUp:x,context:w,drawDefinition:P}),ne){let{error:ae}=kh({participantIds:[ne],tournamentRecord:T});ae&&console.log("cleanup")}return{...Z,modifiedLineUp:ie};function ue({side:ae}){let ce;if(ae.participant){let pe=ae.participant.individualParticipantIds||[];if(pe.filter(Boolean).length===1){let{participant:Se}=Bo({participantIds:pe,tournamentRecord:T});pe.push(R);let{participant:Be}=Bo({participantIds:pe,tournamentRecord:T});if(!Be&&Se){Se.individualParticipantIds=pe;let Pe=zR({pairOverride:!0,tournamentRecord:T,participant:Se});if(Pe.error)return Pe}else ce=Se==null?void 0:Se.participantId}}else{let pe=il({participant:{individualParticipantIds:[R],participantRole:en,participantType:st},pairOverride:!0,tournamentRecord:T});if(pe.error)return pe}return{...Z,deletedParticipantId:ce}}}function XE({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:r,participantId:n,collectionId:a,tieFormat:o}){var s,l;let c=(s=tp({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,u=(l=r||c)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===n),d={collectionId:a,collectionPosition:t};if(u)u.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:n};r.push(p)}return Fh({participantId:e,lineUp:r,drawDefinition:i,tieFormat:o})}function Pee(t){var e,i,r,n,a,o,s,l,c,u,d,p,m,h,f,g,v,I,y,b,S,w;let{tournamentRecord:U,drawDefinition:T,participantId:P,event:R}=t,D="removeTieMatchUpParticiapantId";if(!P)return ee({result:{error:vr},stack:D});let E=y$(t);if(E.error)return E;let{appliedPolicies:N}=Gt({tournamentRecord:U,drawDefinition:T,event:R}),A=(r=(i=((e=t.policyDefinitions)==null?void 0:e[Cr])??(N==null?void 0:N[Cr])??Sv[Cr])==null?void 0:i.processCodes)==null?void 0:r.substitution,{inContextDualMatchUp:M,inContextTieMatchUp:C,relevantAssignments:O,collectionPosition:k,teamParticipants:x,collectionId:F,matchUpType:$,dualMatchUp:_,tieMatchUp:L,tieFormat:B}=E;if(!_)return ee({result:{error:Yn},stack:D});let V=(n=C==null?void 0:C.sides)==null?void 0:n.find(re=>{var K,z,te;return((K=re.participant)==null?void 0:K.participantId)===P||((te=(z=re.participant)==null?void 0:z.individualParticipantIds)==null?void 0:te.includes(P))});if(!V)return ee({result:{error:Ji},stack:D});if(!((a=V.substitutions)!=null&&a.length)&&(_r({score:C==null?void 0:C.score})||C!=null&&C.winningSide))return ee({result:{error:JK},stack:D});let G=(s=(o=M==null?void 0:M.sides)==null?void 0:o.find(({sideNumber:re})=>re===V.sideNumber))==null?void 0:s.participantId;if(!G)return ee({result:{error:Ji},stack:D});let j=(c=(l=Wi({participantFilters:{participantIds:[P]},tournamentRecord:U}))==null?void 0:l.participants)==null?void 0:c[0];if(!j)return ee({result:{error:Ji},stack:D});if($===Ni&&j.participantType===st)return ee({result:{error:rv},stack:D});let H=j.participantType===wt?[P]:j.individualParticipantIds;qw({tournamentId:U.tournamentId,eventId:R.eventId,inContextDualMatchUp:M,drawDefinition:T,dualMatchUp:_});let W=(u=_.sides)==null?void 0:u.find(({sideNumber:re})=>re===V.sideNumber);if(!W&&(((d=_.sides)==null?void 0:d.filter(({lineUp:re})=>!re).length)||0)<2){let re=x==null?void 0:x.map(({participantId:K})=>{var z;return{drawPosition:(z=O==null?void 0:O.find(te=>te.participantId===K))==null?void 0:z.drawPosition,teamParticipantId:K}});W=(p=_.sides)==null?void 0:p.find(K=>{var z;return((z=re==null?void 0:re.find(({drawPosition:te})=>te===K.drawPosition))==null?void 0:z.teamParticipantId)===G})}if(!W)return ee({result:{error:Ji,context:{participantId:P}}});let{modifiedLineUp:Y,previousParticipantIds:q}=Dee({collectionPosition:k,teamParticipantId:G,dualMatchUpSide:W,participantIds:H,drawDefinition:T,collectionId:F});if(W.lineUp=Y,G&&B&&Fh({participantId:G,lineUp:Y,drawDefinition:T,tieFormat:B}),$===ui&&j.participantType===wt){let re=(m=C==null?void 0:C.sides)==null?void 0:m.find(te=>te.sideNumber===(W==null?void 0:W.sideNumber)),{participantId:K}=re??{},z=K&&((f=(h=Wi({participantFilters:{participantIds:[K]},tournamentRecord:U,withDraws:!0}))==null?void 0:h.participants)==null?void 0:f[0]);if(z){let te=((g=z==null?void 0:z.individualParticipantIds)==null?void 0:g.filter(J=>J!==P))??[];if(q&&te.push(...q),te.length>2)return ee({result:{error:Po},stack:D});if((v=z.draws)!=null&&v.length){if(te.length===1){let{participant:J}=Bo({participantIds:te,tournamentRecord:U});if(!J){let ie=il({participant:{participantRole:en,individualParticipantIds:te,participantType:st},pairOverride:!0,tournamentRecord:U});if(ie.error)return ee({result:ie,stack:D})}}}else if(te.length){z.individualParticipantIds=te;let J=zR({participant:z,pairOverride:!0,tournamentRecord:U});if(J.error)return ee({result:J,stack:D})}else{let J=kh({participantIds:[K],tournamentRecord:U});J.error&&console.log("cleanup",{result:J})}}else return ee({result:{error:Ji},stack:D})}if(((I=V.substitutions)==null?void 0:I.length)===1&&!((S=(b=(y=C==null?void 0:C.sides)==null?void 0:y.find(re=>re.sideNumber!==V.sideNumber))==null?void 0:b.substitutions)!=null&&S.length)&&(w=L==null?void 0:L.processCodes)!=null&&w.length){for(let re of A||[]){let K=L.processCodes.lastIndexOf(re);L.processCodes.splice(K,1)}Et({tournamentId:U==null?void 0:U.tournamentId,matchUp:L,context:D,drawDefinition:T})}return Et({tournamentId:U==null?void 0:U.tournamentId,matchUp:_,context:D,drawDefinition:T}),{...Z,modifiedLineUp:Y}}function w$(t){var e,i;let r=kt(t,[{[Zl]:!0,[Rs]:!0,[wp]:!0}]);if(r.error)return r;let{drawDefinition:n,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:oe,sideNumber:a};let{matchUp:l,structure:c}=gi({drawDefinition:n,matchUpId:o,event:s});return l?va({structure:c})?((e=l.sides)==null||e.forEach(u=>{(!a||u.sideNumber===a)&&delete u.participantId}),Et({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:n,matchUp:l}),{...Z}):{error:Gx}:{error:an}}function zRe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:r,dualMatchUp:n,tieFormat:a,structure:o,matchUp:s,event:l,score:c}){var u;let d=Fe(n,void 0,!0);for(let m of(d==null?void 0:d.tieMatchUps)||[])m.matchUpId===s.matchUpId&&(m.winningSide=r,m.score=c,!_r({score:c})&&!e?Object.assign(m,{...rR}):e&&(m.matchUpStatus=e));a=a??((u=cn({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:u.tieFormat);let{winningSide:p}=Ww({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function WRe({matchUpStatuses:t=[Ft,jt,Ot],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:r}){var n;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(n=a==null?void 0:a.drawPositions)==null?void 0:n.find(d=>d!==i),s=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=r.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),c=Dn(s||[],t),u=Dn(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:c,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:l}}function qRe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=et({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===Cn)return{...Z};c=c??Zr({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:m}=Bm({drawPosition:i,matchUps:p}),h=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==m&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:f}=ei({drawDefinition:a,structureId:o});for(let g of h??[])YRe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:f,targetDrawPosition:i,tournamentRecord:r,sourceMatchUpId:n,drawDefinition:a,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...Z}}function YRe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:r,tournamentRecord:n,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var d,p,m;let h="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:I})=>c.matchUpId===I).sides)==null?void 0:d.find(I=>I.drawPosition===r))==null?void 0:p.sideNumber,v=(m=c.sides)==null?void 0:m.find(I=>I.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===r?void 0:g).filter(Boolean);let f=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=f&&Ft||[Ot,jt].includes(c.matchUpStatus)&&c.matchUpStatus||zi,[jt,Ot].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&gJ({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),Et({tournamentId:n==null?void 0:n.tournamentId,eventId:u==null?void 0:u.eventId,context:`${h}-${r}`,drawDefinition:o,matchUp:c}),{...Z}}function Nv(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:n,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,m=va({structure:u}),{drawPositions:h,winningSide:f}=l.matchUp||{};if(!m&&!h)return{error:Kb};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:I},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,byeMatchUp:S}}=l,w=Vs({...t,matchUpStatus:a||zi,removeWinningSide:!0});if(w.error)return w;let U;if(p){let{matchUpTieId:O,matchUpsMap:k}=t;if(U=ec({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:r,drawDefinition:n,matchUpsMap:k,event:d}),!e&&!U.removeWinningSide)return{...Z}}if(m)return{...Z};let{matchUps:T}=$t({afterRecoveryTimes:!1,inContext:!0,drawDefinition:n,matchUpsMap:o,structure:u}),{positionAssignments:P}=Tr({structure:u}),R=f-1,D=1-R,E=h[R],N=h[D],{winnerParticipantId:A,loserParticipantId:M}=(P==null?void 0:P.reduce((O,k)=>(k.drawPosition===N&&(O.loserParticipantId=k.participantId),k.drawPosition===E&&(O.winnerParticipantId=k.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},C=T.filter(O=>{var k;return(k=O.drawPositions)==null?void 0:k.includes(N)});if(b&&Ree({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:E,winnerParticipantId:A,tournamentRecord:r,winnerTargetLink:v,drawDefinition:n,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),y){let{winnerHadMatchUpStatus:O}=WRe({drawPositionMatchUps:C,loserDrawPosition:N,sourceMatchUps:T}),k=g.linkCondition===Gl;if(O&&k){let F=Math.min(...y.drawPositions);YM({targetLink:g,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:F,matchUpsMap:o,event:d})}let x=KRe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:M,tournamentRecord:r,loserTargetLink:g,drawDefinition:n,loserMatchUp:y,dualMatchUp:s,matchUpsMap:o,event:d});if(x.error)return x}if(S){let O=Math.min(...S.drawPositions);YM({sourceMatchUpId:c,targetLink:I,inContextDrawMatchUps:i,drawDefinition:n,drawPosition:O,matchUpsMap:o,event:d})}return{...Z,...U&&{tieMatchUpResult:U}}}function Ree({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:r,tournamentRecord:n,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var p,m;let{structureId:h,roundNumber:f}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:I}=et({drawDefinition:s,structureId:v});if(!I)return{error:Ri};let{positionAssignments:y}=Tr({structure:I});I.seedAssignments=(I.seedAssignments??[]).filter(P=>P.participantId!==r);let b=(p=y==null?void 0:y.find(P=>P.participantId===r))==null?void 0:p.drawPosition,{matchUps:S}=$t({drawDefinition:s,structure:I,event:d}),w=S.map(P=>P.drawPositions).flat(1/0).filter(Boolean),U=fa(w);if((b?U[b]:void 0)===1)y==null||y.forEach(P=>{P.participantId===r&&delete P.participantId});else{let P=S.filter(({drawPositions:R})=>R.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:P,winnerTargetLink:a})}let T=(m=c==null?void 0:c.drawMatchUps)==null?void 0:m.find(({matchUpId:P})=>P===l.matchUpId);T&&Et({tournamentId:n==null?void 0:n.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:T,context:g,drawDefinition:s})}return f&&qRe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:n,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:f,structureId:h}),{...Z}}function KRe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:r,sourceMatchUpId:n,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:c}){var u,d,p;let m="removeDirectedLoser",h=r.target.structureId,{structure:f}=et({drawDefinition:a,structureId:h});if(!f)return{error:Ri};let{positionAssignments:g}=Tr({structure:f}),v=(u=g==null?void 0:g.find(I=>I.participantId===e))==null?void 0:u.drawPosition;if(g==null||g.forEach(I=>{I.participantId===e&&delete I.participantId}),f.seedAssignments=(f.seedAssignments??[]).filter(I=>I.participantId!==e),l){let I=o==null?void 0:o.sides.reduce((S,w,U)=>w.drawPosition===v?U:S,void 0),y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:S})=>S===o.matchUpId),b=(p=y==null?void 0:y.sides)==null?void 0:p[I];b&&(delete b.lineUp,Et({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:y,context:m,drawDefinition:a}))}return{...Z}}function YM({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:r,matchUpsMap:n,targetLink:a,event:o}){let s=a.target.structureId;return Nw({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,drawPosition:r,structureId:s,event:o}),{...Z}}function JRe(t){var e,i;let{matchUpFormat:r,score:n}=t,a=(e=n==null?void 0:n.sets)==null?void 0:e.length,o=r&&_n(r),{setFormat:s,finalSetFormat:l,bestOf:c}=o??{};return((i=c&&a===c&&l||s)==null?void 0:i.timed)||!1}function XRe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:r}){var n;let a="attemptToSetMatchUpStatusBYE";if(r!=null&&r.winningSide)return ee({result:{error:zf},context:{matchUpStatus:Ft},stack:a});let{positionAssignments:o}=Tr({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(n=r.drawPositions)!=null&&n.some(l=>s==null?void 0:s.includes(l))?(r.matchUpStatus=Ft,r.matchUpStatusCodes=[],Et({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:r}),{...Z}):ee({result:{error:mK},info:"matchUp does not include BYE",stack:a})}function uI(t){var e;let{tournamentRecord:i,appliedPolicies:r,drawDefinition:n,matchUpsMap:a,targetData:o,structure:s,event:l}=t,c="doubleExitAdvancement";if(s.structureType===Cn)return ee({result:{...Z},stack:c});let{matchUp:u,targetMatchUps:d,targetLinks:p}=o,{loserMatchUp:m,winnerMatchUp:h,loserTargetDrawPosition:f}=d;if(m&&m.matchUpStatus!==Ft){let{loserTargetLink:g}=p;if((e=r==null?void 0:r.progression)!=null&&e.doubleExitPropagateBye){let v=Eee({loserTargetDrawPosition:f,tournamentRecord:i,loserTargetLink:g,drawDefinition:n,loserMatchUp:m,matchUpsMap:a,event:l});if(v.error)return ee({result:v,stack:c})}else{let{feedRound:v,drawPositions:I,matchUpId:y}=m,b=v?2:2-I.indexOf(f),S=BV({...t,targetMatchUp:m,walkoverWinningSide:b,tournamentRecord:i,sourceMatchUp:u,matchUpId:y});if(S.error)return ee({result:S,stack:c})}}if(h){let g=BV({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:i,sourceMatchUp:u});if(g.error)return ee({result:g,stack:c})}return ee({result:{...Z},stack:c})}function BV(t){var e,i,r;let{inContextDrawMatchUps:n,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:c}=t,u=o.structures.find(({structureId:H})=>H===l.structureId),d=t.matchUpStatus===hr?hr:ir,p=t.matchUpStatus===hr?Ot:jt,m="conditionallyAdvanceDrawPosition",h=c.drawMatchUps.find(H=>H.matchUpId===l.matchUpId);if(!h)return{error:Yn};let f=(s==null?void 0:s.drawPositions)||[],g=(e=h.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&Dn(f,g)&&(g=g.filter(H=>!f.includes(H))),v&&g.length>1)return ee({result:{error:Hf},stack:m});let{pairedPreviousMatchUpIsDoubleExit:I,pairedPreviousMatchUp:y}=hJ(t),b=Rn({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:o}),{targetMatchUps:S,targetLinks:w}=b,{loserTargetDrawPosition:U,winnerMatchUp:T,loserMatchUp:P}=S;if(P){let{loserTargetLink:H}=w,W=Eee({loserTargetDrawPosition:U,loserMatchUp:P,tournamentRecord:a,loserTargetLink:H,drawDefinition:o,matchUpsMap:c});if(W.error)return ee({result:W,stack:m})}let R=((i=h.drawPositions)==null?void 0:i.filter(Boolean))||[],D=R.length===1,E=t.walkoverWinningSide||D&&DS({drawPosition:R[0],matchUpId:l.matchUpId,inContextDrawMatchUps:n})||void 0,N=[jt,Ot].includes(h.matchUpStatus)&&!R.length,A=h.finishingRound===1,M=N&&!A?d:p,C=n.find(H=>H.matchUpId===y.matchUpId),O=[],k;s&&((s==null?void 0:s.structureId)===(C==null?void 0:C.structureId)?s.roundPosition<(y==null?void 0:y.roundPosition)?k=1:k=2:l.feedRound?s.structureId===l.structureId?k=2:k=1:E&&(k=3-E));let x=t.matchUpStatus,F=y==null?void 0:y.matchUpStatus;k===1?O=[{matchUpStatus:jU(x),previousMatchUpStatus:x,sideNumber:1},{matchUpStatus:jU(F),previousMatchUpStatus:F,sideNumber:2}]:k===2&&(O=[{matchUpStatus:jU(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:jU(x),previousMatchUpStatus:x,sideNumber:2}]),O.length&&(O=O.map(H=>He(H)));let $=Vs({...t,winningSide:E,matchUp:h,matchUpStatusCodes:O,context:m,matchUpStatus:M});if($.error)return ee({result:$,stack:m});if(N)return uI({...t,matchUpStatus:M,targetData:b});if(!T)return ee({result:{...Z},stack:m});let _=g.length===2?g[E-1]:g[0],{positionAssignments:L}=ei({structure:u}),B=L==null?void 0:L.find(H=>H.drawPosition===_),V=c.drawMatchUps.find(H=>H.matchUpId===T.matchUpId),G=(r=V==null?void 0:V.drawPositions)==null?void 0:r.filter(Boolean),j=G.length===1;if(_){if(B!=null&&B.bye){let H=Rn({matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o});if(j){let W=G.filter(Boolean)[0],Y=DS({drawPosition:W,matchUpId:V.matchUpId,inContextDrawMatchUps:n}),q=Vs({appliedPolicies:t.appliedPolicies,matchUpId:V.matchUpId,matchUp:V,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,winningSide:Y});return q.error?ee({result:q,stack:m}):DL({drawPositionToAdvance:W,matchUpId:V.matchUpId,inContextDrawMatchUps:n,drawDefinition:o,matchUpsMap:c})}else if([jt,Ot].includes(T.matchUpStatus)){let W=uI({...t,matchUpId:V.matchUpId,matchUpStatus:M,targetData:H});if(W.error)return ee({result:W,stack:m})}return ee({result:{...Z},stack:m})}return sg({matchUpId:T.matchUpId,drawPosition:_,inContextDrawMatchUps:n,drawDefinition:o})}else if(I){if(!V)return{error:Yn};if(j){let Y=G[0],q=DS({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawPosition:Y});console.log("existing drawPosition is winningSide",{walkoverWinningSide:q})}let H=[jt,Ot].includes(V.matchUpStatus)?p:d,W=Vs({matchUpId:V.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:V,matchUpStatusCodes:[],removeScore:!0,context:m,drawDefinition:o,matchUpStatus:H});if(W.error)return ee({result:W,stack:m});if(H===d){let Y=uI({...t,matchUpId:l.matchUpId,matchUpStatus:H,targetData:b});if(Y.error)return Y}}return ee({result:{...Z},stack:m})}function Eee(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:r,loserTargetLink:n,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=n==null?void 0:n.target)==null?void 0:e.structureId,{structure:c}=et({drawDefinition:a,structureId:l});return c?$a({drawPosition:i,tournamentRecord:r,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:td}}function jU(t){return t===ir?jt:t===hr?Ot:t}function ZRe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:r,structure:n,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=r===Ft,c=a.winningSide,u=[ir,hr].includes(r),d=Cw({matchUpStatus:r}),p=UM({matchUpStatus:r}),m=!d&&!p,h=t.matchUpTieId||c&&d&&!u,f=c&&u,g=()=>Vs({...t,removeScore:[Yu,jt].includes(r),matchUpStatus:r||zi});return m&&{error:rM}||h&&KM(t)||f&&QRe(t)||c&&Nv(t)||p&&g()||l&&XRe({tournamentRecord:e,drawDefinition:i,structure:n,matchUp:a})||!d&&{error:rM}||u&&eEe(t)||o&&KM(t)||ee({result:{error:zf},stack:s})}function QRe(t){let e=Nv(t);return e.error?e:uI(t)}function eEe(t){let e=KM({...t,removeScore:!0});return e.error?e:uI(t)}function KM(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=Nv(t);if(a.error)return ee({result:a,stack:i})}let r=!!t.matchUp.collectionId,n=Vs({...t,context:i});if(r){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=ec({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return ee({result:l,stack:i});Object.assign(n,{tieMatchUpResult:l})}return ee({result:n,stack:i})}function tEe({drawDefinition:t,structure:e,matchUp:i}){var r,n,a,o;let{drawPositions:s}=i,{positionAssignments:l}=ei({drawDefinition:t,structure:e}),c=(r=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:r.map(p=>{var m;let{extension:h}=ft({element:p,name:xc});return(m=h==null?void 0:h.value)==null?void 0:m.groupOrder}),{containerStructures:u}=gv({drawDefinition:t}),d=u[e.structureId];return{structureIds:(o=(a=(n=bv({drawDefinition:t,structureId:d}))==null?void 0:n.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var m;return Dn(c,((m=p.source)==null?void 0:m.finishingPositions)||[])}).map(p=>p.source.structureId)}}function Cee({drawDefinition:t,structure:e,matchUp:i}){let r=[];if(e.finishingPosition===fv&&Bc({drawDefinition:t,structure:e})){let{structureIds:n}=tEe({drawDefinition:t,structure:e,matchUp:i});n!=null&&n.length&&r.push(...n)}return{connectedStructureIds:r}}function iEe(t){var e,i,r;let n,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===rs){let u=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===c.target.structureId&&p.roundNumber===c.target.roundNumber&&p.sides.some(({participantId:m})=>m===u));if((d==null?void 0:d.matchUpStatus)===zi){let p=Rn({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!np({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:m}=et({structureId:d.structureId,drawDefinition:s}),h=ei({structure:m}).positionAssignments;for(let f of h||[])if(f.participantId===u){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(f.participantId=g,m==null?void 0:m.positionAssignments)m.positionAssignments=h;else if(m!=null&&m.structures){let v=Object.assign({},...(h||[]).map(I=>({[I.drawPosition]:I.participantId})));for(let I of m.structures)(i=I.positionAssignments)==null||i.forEach(y=>y.participantId=v[y.drawPosition])}_c({tournamentId:(r=t.tournamentRecord)==null?void 0:r.tournamentId,event:t.event,drawDefinition:s,structure:m}),n=!0}}}}return{...Z,qualifierReplaced:n}}function rEe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:c,winningSide:u}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===rs){let p=(i=l.sides.find(({sideNumber:f})=>f===u))==null?void 0:i.participantId,m=s.filter(f=>f.structureId===d.target.structureId&&f.roundNumber===d.target.roundNumber&&f.sides.some(({participantId:g,qualifier:v})=>v&&!g)),h=Uo(m);if((h==null?void 0:h.matchUpStatus)===zi){let f=Rn({matchUpId:h.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!np({inContextDrawMatchUps:s,drawDefinition:c,targetData:f})){let g=(r=h.sides.find(y=>y.qualifier&&!y.participantId))==null?void 0:r.drawPosition,{structure:v}=et({structureId:h.structureId,drawDefinition:c});if(!v)return{error:Ri};let I=ei({structure:v}).positionAssignments;for(let y of I||[])if(y.drawPosition===g&&!y.participantId){if(y.participantId=p,v.positionAssignments)v.positionAssignments=I;else if(v.structures){let b=Object.assign({},...(I||[]).map(S=>({[S.drawPosition]:S.participantId})));for(let S of v.structures)(n=S.positionAssignments)==null||n.forEach(w=>w.participantId=b[w.drawPosition])}_c({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:v}),o=!0}}}}return{...Z,qualifierPlaced:o}}function nEe(t){var e,i;let r="attemptToSetWinningSide",n,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:c,structure:u,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return ZL(t);if(d.winningSide&&d.winningSide!==c){let{connectedStructureIds:f}=Cee({drawDefinition:s,structure:u,matchUp:d});f.length&&(console.log({connectedStructureIds:f}),n=!0);let g=Nv(t);if(g.error)return g}let p=lX(t);if(p.error)return ee({result:p,stack:r});let m,h;return t.qualifierChanging&&(e=a==null?void 0:a[ty])!=null&&e.autoReplaceQualifiers&&(m=iEe(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[ty])!=null&&i.autoPlaceQualifiers&&(h=rEe(t).qualifierPlaced),ee({result:He({...Z,...p,connectedStructures:n,qualifierReplaced:m,qualifierPlaced:h}),stack:r})}var CS={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Mee(t){var e;let{inContextDrawMatchUps:i,appliedPolicies:r,drawDefinition:n,matchUpsMap:a,targetData:o,matchUp:s}=t,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";Qa({method:c,color:"brightyellow",iteration:l,keyColors:CS});let{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:m}}=o;if(p&&p.matchUpStatus!==Ft){let{stage:h,roundNumber:f,roundPosition:g}=p;Qa({winner:"winner",stage:h,roundNumber:f,roundPosition:g,keyColors:CS}),VV({...t,targetMatchUp:p,sourceMatchUp:s,iteration:l})}if(d&&d.matchUpStatus!==Ft){let h=i.find(({matchUpId:b})=>b===d.matchUpId),{structure:f}=et({drawDefinition:n,structureId:h.structureId}),{stage:g,roundNumber:v,roundPosition:I,feedRound:y}=d;if(Qa({loser:"loser",stage:g,roundNumber:v,roundPosition:I,keyColors:CS,feedRound:y}),(e=r==null?void 0:r.progression)==null?void 0:e.doubleExitPropagateBye)YM({drawPosition:m,targetLink:u,inContextDrawMatchUps:i,drawDefinition:n,matchUpsMap:a});else{let b=VV({...t,structure:f,targetMatchUp:d,iteration:l});if(b.error)return ee({result:b,stack:c})}}return ee({result:{...Z},stack:c})}function VV(t){var e,i,r,n,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:c,sourceMatchUp:u,targetMatchUp:d,matchUpsMap:p,structure:m,iteration:h}=t,f="conditionallyRemoveDrawPosition";Qa({method:f});let g=Rn({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:c}),{targetMatchUps:{winnerMatchUp:v}}=g,I=p==null?void 0:p.drawMatchUps.find(R=>R.matchUpId===d.matchUpId),y=[],b,S,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(R=>d.drawPositions.includes(R));else if(!u)w=(r=Hi((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:r[0];else if(S=(n=fJ({structureId:m.structureId,matchUp:u,matchUpsMap:p}))==null?void 0:n.pairedPreviousMatchUp,b=[ir,hr].includes(S==null?void 0:S.matchUpStatus),y=((a=S==null?void 0:S.drawPositions)==null?void 0:a.filter(Boolean))||[],[...Sr,Ft].includes(S==null?void 0:S.matchUpStatus)||(S==null?void 0:S.winningSide)){let R=u.drawPositions||[],D=(o=d.drawPositions)==null?void 0:o.filter(Boolean);Dn(R,D)&&(D=D==null?void 0:D.filter(E=>!R.includes(E))),w=R.concat(y).find(E=>D==null?void 0:D.includes(E))}if(v&&w){let{stage:R,roundNumber:D,roundPosition:E}=v;Qa({method:"removeDirectedWinner",drawPositionToRemove:w,keyColors:CS,color:"brightgreen",stage:R,roundNumber:D,roundPosition:E}),Ree({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:c,matchUpsMap:p})}let U=Mee({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:c,matchUpsMap:p,structure:m,iteration:h});if(U.error)return ee({result:U,stack:f});let T=aEe({pairedPreviousDoubleExit:b,noContextTargetMatchUp:I}),P=!b;return U=Vs({...t,matchUpId:d.matchUpId,matchUp:I,removeWinningSide:!0,matchUpStatusCodes:[],context:f,matchUpStatus:T,removeScore:P,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),U.error?ee({result:U,stack:f}):{...Z}}function aEe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Ft?Ft:t?[hr,Ot].includes(e==null?void 0:e.matchUpStatus)?Ot:jt:zi}function oEe(t){var e,i,r,n,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:c}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===rs){let d=(r=(i=l.sides)==null?void 0:i.find(({sideNumber:m})=>m===l.winningSide))==null?void 0:r.participantId,p=s.find(m=>{var h;return m.structureId===u.target.structureId&&m.roundNumber===u.target.roundNumber&&((h=m.sides)==null?void 0:h.some(({participantId:f})=>f===d))});if(p&&p.matchUpStatus===zi){let m=Rn({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!np({inContextDrawMatchUps:s,drawDefinition:c,targetData:m})){let{structure:h}=et({structureId:p.structureId,drawDefinition:c}),f=ei({structure:h}).positionAssignments;for(let g of f||[])if(g.participantId===d){if(g.participantId=void 0,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(I=>({[I.drawPosition]:I.participantId})));for(let I of(h==null?void 0:h.structures)||[])(n=I.positionAssignments)==null||n.forEach(y=>y.participantId=v[y.drawPosition])}_c({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:h}),o=!0}}}}return{qualifierRemoved:o}}function sEe(t){var e;let{matchUp:i,matchUpStatus:r,score:n,winningSide:a}=t,o="noDownStreamDependencies";if([ir,hr].includes(i==null?void 0:i.matchUpStatus)&&![ir,hr].includes(r)){let g=Mee(t);if(g.error)return ee({result:g,stack:o})}let s=r===ir,l=_r({score:n})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),c=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&JRe(t.inContextMatchUp),u=t.removeScore||!c&&![Xs,Ca].includes(r||Xs),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!_r({score:n}),p=r&&r!==zi,m=g=>{var v,I;let y,{structure:b,drawDefinition:S,dualMatchUp:w,disableAutoCalc:U}=t;if(w!=null&&w._disableAutoCalc&&U!==!1)return ZL(t);let{connectedStructureIds:T}=Cee({drawDefinition:S,structure:b,matchUp:i});T.length&&(console.log({connectedStructureIds:T}),y=!0),Object.assign(t,{removeScore:g});let P=Nv(t);if(P.error)return P;if(t.removingQualifier&&(I=(v=t.appliedPolicies)==null?void 0:v[ty])!=null&&I.autoRemoveQualifiers){let R=oEe(t);return{...Z,connectedStructures:y,...R}}return{...Z,connectedStructures:y}};if(d&&a&&t.isCollectionMatchUp)return jV(t);let h=[Yu,Ca].includes(r)&&t.dualWinningSideChange,f=(a||h)&&nEe(t)||l&&m(u)||p&&ZRe(t)||d&&m(u)||i&&jV({...t,removeScore:!0})||{...Z};return ee({result:f,stack:o})}function jV(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let n=Nv(t);if(n.error)return n}let r=Vs({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:n,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=ec({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:n,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return ee({result:r,stack:i})}function dd(t){var e;let i="addMatchUpScheduledTime",r=t.matchUp,{removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:c}=t;if(!c)return ee({result:{error:Xr},stack:i});if(!cv(l))return ee({result:{error:vo},stack:i});if(!r){let h=gi({drawDefinition:o,matchUpId:c});if(h.error)return ee({result:h,stack:i});r=h.matchUp}let u=ct(l),d=ep({matchUp:r}).scheduledDate,p=u&&!d;if((e=gL({matchUp:r}).timeModifiers||[])!=null&&e.length){let h=Nee({disableNotice:!0,removePriorValues:n,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:c,matchUp:r});if(h!=null&&h.error)return ee({result:h,stack:i})}let m=Th(l,!0,p);return Na({duplicateValues:!1,removePriorValues:n,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:c,timeItem:{itemType:yv,itemValue:m}})}function Nee({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,timeModifiers:n,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ee({result:{error:Xr},stack:s});if(n!==void 0&&!Array.isArray(n))return ee({info:ql("timeModifiers"),result:{error:oe},stack:s});if(!o){let d=gi({drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s});o=d.matchUp}let l=gL({matchUp:o}).timeModifiers||[],c=n.filter(d=>!l.includes(d));if(n.length&&!c.length)return{...Z};if(c.some(d=>vM.includes(d))){l=l.filter(p=>!vM.includes(p));let d=dd({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ee({result:d,stack:s})}let u=n!=null&&n.length?[...c,...l]:void 0;return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:hL,itemValue:u}})}function WR({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtIds:s}){var l,c;if(!i&&!e)return{error:he};if(!o)return{error:Xr};let u=gi({drawDefinition:r,matchUpId:o});if(u.error)return u;if(((l=u==null?void 0:u.matchUp)==null?void 0:l.matchUpType)!==Zs)return{error:kn};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:oe,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},m=tc({tournamentRecords:p});if(m.error)return m;let h=(c=m.courts)==null?void 0:c.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:oe,context:{courtIds:s}};d=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Au,itemDate:a,itemValue:d}})}function Av({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,venueId:o}){if(!i)return{error:he};if(!a)return{error:Xr};if(o){let s=Xu({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:vv,itemValue:o}})}function jh({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:he};if(!o)return{error:Xr};if(s){let c=Mh({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;Av({tournamentRecords:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,venueId:u})}return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:o,timeItem:{itemType:Qd,itemDate:a,itemValue:s}})}function ks(t,e){let i=R9.test(t)?t:fi(t),r=ct(t)||ct(e)||us(new Date);return new Date(`${r}T${i}`).getTime()}function qR({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:r,removePriorValues:n,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:l,drawMatchUps:c,matchUpId:u,schedule:d,event:p}){var m;if(!d)return{error:Ve,info:"Missing schedule"};if(!s)return{error:Ce};if(!u)return{error:Xr};let h="addMatchUpScheduleItems",f,g;if(c)f=c.find(N=>N.matchUpId===u);else{let N=gi({drawDefinition:s,event:p,matchUpId:u});if(N.error)return N;f=N.matchUp}let{endTime:v,courtId:I,courtIds:y,courtOrder:b,resumeTime:S,scheduledDate:w,scheduledTime:U,startTime:T,stopTime:P,timeModifiers:R,venueId:D}=d;e&&(!i||!r)&&({matchUpDependencies:i,matchUps:r}=Zo({drawDefinition:s}));let E=(m=i==null?void 0:i[u])==null?void 0:m.matchUpIds;if(d.scheduledDate&&e&&E){let N=r==null?void 0:r.filter(A=>{var M,C;return(((M=A.schedule)==null?void 0:M.scheduledDate)||ct((C=A.schedule)==null?void 0:C.scheduledTime))&&E.includes(A.matchUpId)}).map(({schedule:A})=>{let M=I0(A);return new Date(M).getTime()});if(N!=null&&N.length){let A=I0(d),M=new Date(A).getTime();if(Math.max(...N)>=M){if(t)return ee({result:{error:eM},stack:h});g=eM}}}if(w!==void 0){let N=YR({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,scheduledDate:w,matchUpId:u});if(N!=null&&N.error)return ee({result:N,stack:h,context:{scheduledDate:w}})}if(U!==void 0){let N=dd({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,scheduledTime:U,matchUpId:u,matchUp:f});if(N!=null&&N.error)return ee({result:N,stack:h,context:{scheduledTime:U}})}if(T!==void 0){let N=S$({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,matchUpId:u,startTime:T,event:p});if(N!=null&&N.error)return ee({result:N,stack:h,context:{startTime:T}})}if(P!==void 0){let N=D$({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,matchUpId:u,stopTime:P,event:p});if(N!=null&&N.error)return ee({result:N,stack:h,context:{stopTime:P}})}if(S!==void 0){let N=P$({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,resumeTime:S,matchUpId:u,event:p});if(N!=null&&N.error)return ee({result:N,stack:h,context:{resumeTime:S}})}if(v!==void 0){let N=T$({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,matchUpId:u,endTime:v,event:p});if(N!=null&&N.error)return ee({result:N,stack:h,context:{endTime:v}})}if(y!==void 0){let N=WR({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtIds:y});if(N!=null&&N.error)return ee({result:N,stack:h,context:{courtIds:y}})}if(I!==void 0&&w!==void 0){let N=jh({courtDayDate:w,disableNotice:!0,removePriorValues:n,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtId:I});if(N!=null&&N.error)return ee({result:N,stack:h,context:{courtId:I}})}if(D!==void 0){let N=Av({disableNotice:!0,removePriorValues:n,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,venueId:D});if(N!=null&&N.error)return ee({result:N,stack:h,context:{venueId:D}})}if(b!==void 0&&nt(b)){let N=U$({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,courtOrder:b,matchUpId:u});if(N!=null&&N.error)return ee({result:N,stack:h,context:{courtOrder:b}})}if(R!==void 0){let N=Nee({disableNotice:!0,removePriorValues:n,tournamentRecord:o,drawDefinition:s,timeModifiers:R,matchUpId:u,matchUp:f});if(N!=null&&N.error)return ee({result:N,stack:h,context:{timeModifiers:R}})}return l||Et({tournamentId:o==null?void 0:o.tournamentId,eventId:p==null?void 0:p.eventId,context:h,drawDefinition:s,matchUp:f}),g?{...Z,warnings:[g]}:{...Z}}function YR({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a}){if(!a)return{error:Xr};let o=t&&$l.test(t);if(t&&!o)return{error:Tn};let s={itemValue:ct(t),itemType:Iv};return Na({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:s})}function U$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,courtOrder:n,matchUpId:a}){if(!a)return{error:Xr};if(n&&!nt(n))return{error:oe,info:"courtOrder must be numeric"};let o=n&&Xe(n);return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:{itemType:mL,itemValue:o}})}function Aee({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,participantId:n,officialType:a,matchUpId:o}){if(!o)return{error:Xr};if(!n)return{error:vr};if(e){let l=Wi({tournamentRecord:e,participantFilters:{participantTypes:[wt],participantRoles:[EL]}}).participants??[];if(!kc({tournamentParticipants:l,participantId:n}))return{error:Ji}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:n};return a&&(s.itemSubTypes=[a]),Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:o,timeItem:s})}function S$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,startTime:a,event:o}){if(!n)return{error:Xr};if(!cv(a))return{error:vo};let{matchUp:s}=gi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=ep({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[pu,Dl,Ou].includes(u==null?void 0:u.itemType)).map(u=>ks(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||ks(a,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==ns));let u=Th(a,!0,!0);return Na({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:{itemType:ns,itemValue:u}})}else return{error:BK}}function T$({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,endTime:o,event:s}){if(!a)return{error:Xr};if(!cv(o))return{error:vo};let{matchUp:l}=gi({drawDefinition:r,event:s,matchUpId:a}),{scheduledDate:c}=ep({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[ns,Dl,pu].includes(d==null?void 0:d.itemType)).map(d=>ks(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||ks(o,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Ou));let d=Th(o,!0,!0);return Na({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:r,disableNotice:n,matchUpId:a,timeItem:{itemType:Ou,itemValue:d}})}else return{error:_K}}function D$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,stopTime:a,event:o}){if(!n)return{error:Xr};if(!cv(a))return{error:vo};let{matchUp:s}=gi({drawDefinition:i,event:o,matchUpId:n}),{scheduledDate:l}=ep({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((h,f)=>f.itemType===Ou||h,void 0))return{error:oF};let u=c.filter(h=>[ns,Dl,pu].includes(h==null?void 0:h.itemType)).sort((h,f)=>ks(h.itemValue,l)-ks(f.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===pu,m=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>ks(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(ks(a,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Th(a,!0,!0),itemType:pu};return Na({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:n,timeItem:h})}else return{error:$K}}function P$({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,resumeTime:n,matchUpId:a,event:o}){if(!a)return{error:Xr};if(!cv(n))return{error:vo};let{matchUp:s}=gi({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=ep({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((h,f)=>f.itemType===Ou||h,void 0))return{error:oF};let u=c.filter(h=>[ns,Dl,pu].includes(h==null?void 0:h.itemType)).sort((h,f)=>ks(h.itemValue,l)-ks(f.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===Dl,m=u.filter(h=>!p||h.createdAt!==d.createdAt).map(h=>ks(h.itemValue,l)).reduce((h,f)=>!h||f>h?f:h,void 0);if(ks(n,l)>m){if(s!=null&&s.timeItems&&p){let f=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==f)}let h={itemValue:Th(n,!0,!0),itemType:Dl};return Na({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:r,matchUpId:a,timeItem:h})}else return{error:Obe}}function lEe(t){var e;let{tournamentRecord:i,inContextMatchUp:r,structure:n,drawDefinition:a}=t,o=r.roundNumber,s=r.sides.find(w=>w.sideNumber===r.winningSide),l=r.sides.find(w=>w.sideNumber!==r.winningSide),{drawPosition:c,participantId:u}=s,{drawPosition:d,participantId:p}=l,m="swapWinnerLoser",{matchUps:h}=$t(t),f=h.filter(({drawPositions:w,roundNumber:U})=>(w==null?void 0:w.includes(c))&&U>o);no({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var U,T;w.drawPositions=((U=w.drawPositions)==null?void 0:U.map(P=>P===c?d:P))||[],Et({tournamentId:i==null?void 0:i.tournamentId,eventId:(T=t.event)==null?void 0:T.eventId,context:m,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=n,I=a.structures.filter(({stage:w,stageSequence:U})=>w===g&&U>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,S=[y==null?void 0:y.target.structureId,(e=b==null?void 0:b.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:U})=>w!==g&&S.includes(U)).forEach(({stage:w,stageSequence:U,structureId:T})=>{I.includes(T)||I.push(T),a.structures.filter(({stage:P,stageSequence:R})=>P===w&&R>U).forEach(({structureId:P})=>{I.includes(P)||I.push(P)})}),a.structures.filter(({structureId:w})=>I.includes(w)).forEach(w=>{let{positionAssignments:U}=ei({structure:w}),T=U==null?void 0:U.find(({participantId:R})=>R===u),P=U==null?void 0:U.find(({participantId:R})=>R===p);T&&(T.participantId=p),P&&(P.participantId=u)}),Vs({...t,context:m})}function aU(t){var e,i,r,n;let a="setMatchUpStatus";t.matchUpStatus&&[jt,ir].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:o,disableScoreValidation:s,tournamentRecords:l,tournamentRecord:c,disableAutoCalc:u,enableAutoCalc:d,drawDefinition:p,matchUpStatus:m,winningSide:h,matchUpId:f,event:g,score:v}=t;if(!p)return{error:Ce};if(m&&[Yu,Xs,Ca,zi].includes(m)&&h)return{error:oe,winningSide:h,matchUpStatus:m};if(![void 0,...G9].includes(m))return ee({result:{error:zf},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let I=Zr({drawDefinition:p}),{matchUps:y}=cr({nextMatchUps:!0,tournamentRecord:c,inContext:!0,drawDefinition:p,matchUpsMap:I,event:g}),b=I.drawMatchUps.find(j=>j.matchUpId===f),S=y==null?void 0:y.find(j=>j.matchUpId===f);if(!b||!y)return{error:an};if((b.winningSide||h)&&m===Ft)return{context:"Cannot have Bye with winningSide",error:fS,matchUpStatus:m};let w=S==null?void 0:S.structureId,{structure:U}=et({drawDefinition:p,structureId:w}),T=Bi(di)(b.matchUpType),P=(e=S==null?void 0:S.drawPositions)==null?void 0:e.filter(Boolean),R;if(T){if(u)Mt({extension:{name:Zf,value:!0},element:b});else if(d){let j=b.winningSide;In({name:Zf,element:b});let{winningSide:H,scoreStringSide1:W,scoreStringSide2:Y,set:q}=Ww({drawDefinition:p,matchUpsMap:I,structure:U,matchUp:b,event:g}),re={scoreStringSide1:W,scoreStringSide2:Y,sets:q?[q]:[]};R=H!==j,Object.assign(t,{winningSide:H,dualWinningSideChange:R,projectedWinningSide:H,score:re})}qw({tournamentId:c==null?void 0:c.tournamentId,inContextDualMatchUp:S,eventId:g==null?void 0:g.eventId,dualMatchUp:b,drawDefinition:p})}if(T&&m&&[Dh].includes(m))return{error:oe,info:"Not supported for matchUpType: TEAM"};let D=S==null?void 0:S.matchUpTieId,E=Rn({matchUpId:D||f,inContextDrawMatchUps:y,drawDefinition:p});if(v&&!T&&!s){let j=b.matchUpFormat??(U==null?void 0:U.matchUpFormat)??(p==null?void 0:p.matchUpFormat)??(g==null?void 0:g.matchUpFormat),H=D_({existingMatchUpStatus:b.matchUpStatus,matchUpFormat:j,matchUpStatus:m,winningSide:h,score:v});if(H.error)return H}let N=b!=null&&b.sides?[]:ei({drawDefinition:p,structureId:w}).positionAssignments,A=(i=S==null?void 0:S.sides)==null?void 0:i.map(j=>j.participantId).filter(Boolean).length,M=A&&A===2||b.collectionId&&va({structure:U})&&A&&A>=1||(P==null?void 0:P.length)===2&&(N==null?void 0:N.filter(j=>P.includes(j.drawPosition)).every(j=>j.participantId));if(m&&j9.includes(m)&&!M)return ee({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:m,requiredParticipants:M},result:{error:zf}});let C=((r=Gt({policyTypes:[ty,Vl],tournamentRecord:c,drawDefinition:p,event:g}))==null?void 0:r.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(C,t.policyDefinitions);let O=(S==null?void 0:S.stage)===qe&&S.finishingRound===1,k=O&&h,x=O&&b.winningSide&&!h&&(!t.matchUpStatus||t.matchUpStatus&&UM({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!_r({outcome:t.outcome})),F=k&&h!==b.winningSide&&b.winningSide;if(Object.assign(t,{inContextDrawMatchUps:y,qualifierAdvancing:k,qualifierChanging:F,removingQualifier:x,inContextMatchUp:S,appliedPolicies:C,matchUpTieId:D,matchUpsMap:I,targetData:E,structure:U,matchUp:b}),D){let{matchUp:j}=gi({matchUpId:D,inContext:!0,drawDefinition:p,matchUpsMap:I,event:g});if(j){let H=(n=cn({matchUp:j,drawDefinition:p,structure:U,event:g}))==null?void 0:n.tieFormat,{projectedWinningSide:W}=zRe({drawDefinition:p,matchUpStatus:m,dualMatchUp:j,matchUpsMap:I,winningSide:h,tieFormat:H,structure:U,matchUp:b,event:g,score:v}),Y=j.winningSide;R=W!==Y,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:R,projectedWinningSide:W,matchUpTieId:D,dualMatchUp:j,tieFormat:H})}}let $=np(t),_=Cw({matchUpStatus:m});if(!D){if($&&!h&&(m&&UM({matchUpStatus:m})||m&&[ir,hr].includes(m)))return{error:fS,activeDownstream:$,winningSide:h};if(h&&h===b.winningSide&&m&&!_)return{context:"winningSide must include directing matchUpStatus",error:fS,directingMatchUpStatus:_,matchUpStatus:m}}let{schedule:L}=t;if(L){let j=qR({disableNotice:!0,tournamentRecords:l,tournamentRecord:c,drawDefinition:p,matchUpId:f,schedule:L});if(j.error)return j}let B=!T&&!R&&h&&b.winningSide&&b.winningSide!==h;if(o&&B&&b.roundPosition)return lEe(t);let V=h&&!D||t.projectedWinningSide;Qa({activeDownstream:$,matchUpWinner:V,method:a,winningSide:h});let G=!$&&sEe(t)||V&&uEe(t)||_&&Oee(t)||{error:YK};return ee({result:G,stack:a})}function uEe(t){let{matchUp:e,winningSide:i,matchUpTieId:r,dualWinningSideChange:n}=t;return i===e.winningSide||r&&!n?Oee(t):ee({stack:"winningSideWithDownstreamDependencies",result:{error:iF},context:{winningSide:i,matchUp:e}})}function Oee(t){let{tournamentRecord:e,matchUp:i,event:r}=t,n=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!_r({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||n&&zi||Zi:t.matchUpStatus||Zi,o=t.removeScore||[Yu,jt].includes(a)&&![Xs,Ca].includes(a),s=Vs({...t,matchUpStatus:a,removeWinningSide:n,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=ec({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:r});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function kee({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r}){if(!e)return{error:Ce};let{matchUp:n}=gi({drawDefinition:e,matchUpId:i,event:r});return(n==null?void 0:n.matchUpType)!==Zs?{error:kn}:aU({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:r})}function xee({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:Ce};if(!i)return{error:Xr};let{matchUp:r}=gi({drawDefinition:t,event:e,matchUpId:i});return r?In({name:NP,element:r}):{error:an}}function cEe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:r,sideNumber:n,matchUpId:a,event:o}){var s,l,c,u,d;let p="substituteParticipant";if(!r)return{error:Ce};if(!a)return{error:Xr};if(!e||!t)return ee({result:{error:vr},stack:p});let{matchUp:m}=gi({drawDefinition:r,matchUpId:a,event:o});if(!m)return{error:an};if(!m.collectionId)return ee({result:{error:kn},stack:p});let h=Zr({drawDefinition:r}),{matchUps:f}=cr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:r,matchUpsMap:h}),g=f==null?void 0:f.find(I=>I.matchUpId===a),v=(l=(s=f==null?void 0:f.find(I=>I.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(I=>I.participant.individualParticipants.some(({participantId:y})=>y===e));return!v||n&&v.sideNumber!==n?{error:Ks}:(d=(u=(c=v.participant)==null?void 0:c.individualParticipants)==null?void 0:u.map(bt).filter(I=>I!==e))!=null&&d.includes(t)?b$({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:r,event:o}):ee({result:{error:Ks},stack:p})}function Fee(t){return cEe(t)}function Lee({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:Ce};let{matchUp:r}=gi({drawDefinition:t,matchUpId:e,event:i});return Mt({extension:{name:Zf,value:!0},element:r})}function _ee(t){let e="setMatchUpFormat",i=kt(t,[{tournamentRecord:!0},{[is]:S=>Ia({matchUpFormat:S}),[_l]:Xb,matchUpFormat:!0}]);if(i.error)return ee({result:i,stack:e});let{tournamentRecord:r,drawDefinition:n,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:m,event:h,force:f}=t;if(a&&!Array.isArray(a))return ee({result:{error:oe,scheduledDates:a},stack:e});if(c&&!YP([Wl,$o],c))return ee({result:{error:Ac},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],I=t.eventIds||d&&[d].filter(Boolean)||[],y=t.drawIds||m&&[m].filter(Boolean)||[];if((l||v!=null&&v.length)&&!n)return ee({result:{error:Ce},stack:e});if(m&&u&&n){let S=C_({tournamentRecord:r,drawDefinition:n,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(S.error)return S;g+=1}let b=S=>{let w=[];for(let U of S.structures||[]){if(Array.isArray(p)&&!p.includes(U.stage)||Array.isArray(o)&&!o.includes(U.stageSequence)||v!=null&&v.length&&!v.includes(U.structureId))continue;v!=null&&v.length&&U.matchUpFormat!==s&&(U.matchUpFormat=s,w.push(U.structureId),g+=1);let T=((f||a)&&$t({matchUpFilters:{matchUpStatuses:[zi]},structure:U}).matchUps)??[],P=(a&&$t({matchUpFilters:{matchUpStatuses:[zi]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:U}).matchUps)??[];if(T!=null&&T.length){let R=P?P.map(wr):T.map(wr);for(let D of T)R.includes(D.matchUpId)&&(D.matchUpFormat=a!=null&&a.length?s:void 0,Et({tournamentId:r==null?void 0:r.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:S,matchUp:D}))}}return!w.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1),w};for(let S of(r==null?void 0:r.events)||[])if(!(I!=null&&I.length&&!I.includes(S.eventId)||c&&c!==S.eventType||c===yr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||y!=null&&y.length)for(let w of S.drawDefinitions||[]){if(Array.isArray(y)&&!y.includes(w.drawId))continue;let U=b(w);pi({structureIds:U,drawDefinition:w})}else S.matchUpFormat!==s&&(S.matchUpFormat=s,g+=1);return g?{...Z,modificationsCount:g}:{...Z,info:ov}}function R$({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:r,event:n}){var a,o;if(!i)return{error:Ce};let s=(a=gi({drawDefinition:i,matchUpId:r}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:kn};let l=(o=gi({inContext:!0,drawDefinition:i,matchUpId:r,event:n}))==null?void 0:o.matchUp,c=0;return((s==null?void 0:s.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((l==null?void 0:l.sides)||[]).forEach(u=>{if(c+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=u.participantId;d&&p&&Fh({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Et({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:n==null?void 0:n.eventId,drawDefinition:i,matchUp:s})}),{...Z,modificationsCount:c}}function $ee(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,score:n}=t;if(!n)return{sets:[]};let a=n.sets||[],o=El({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=El({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=El({matchUpFormat:e,matchUpStatus:i,winningSide:r,sets:a}),c=o===l?s:o;return r&&(o=r===1?l:c,s=r===2?l:c),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function oU(t){var e;let i=kt(t,[{[wp]:!0,[Rs]:!0}]);if(i.error)return i;let r=ll(t);if(!t.drawDefinition){let I=t.tournamentRecord??(t.tournamentId&&r[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=I);let y=xn({eventId:t.eventId,drawId:t.drawId,tournamentRecord:I});if(y.error)return y;y.drawDefinition&&(t.drawDefinition=y.drawDefinition),t.event=y.event}let{disableScoreValidation:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:c,matchUpFormat:u,matchUpId:d,schedule:p,event:m,notes:h}=t,{policy:f}=Pp({policyType:Vl,tournamentRecord:o,event:m}),g=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(f==null?void 0:f.allowChangePropagation)!==void 0&&f.allowChangePropagation||void 0,{outcome:v}=t;if(v!=null&&v.winningSide&&![1,2].includes(v.winningSide))return{error:gP};if(u){let I=C_({tournamentRecord:o,drawDefinition:c,matchUpFormat:u,matchUpId:d,event:m});if(I.error)return I}if((e=v==null?void 0:v.score)!=null&&e.sets&&!v.score.scoreStringSide1){let{score:I}=$ee(v);v.score=I,v.score.sets=v.score.sets.filter(y=>y.side1Score||y.side2Score||y.side1TiebreakScore||y.side2TiebreakScore)}return aU({matchUpStatusCodes:v==null?void 0:v.matchUpStatusCodes,matchUpStatus:v==null?void 0:v.matchUpStatus,winningSide:v==null?void 0:v.winningSide,allowChangePropagation:g,disableScoreValidation:n,score:v==null?void 0:v.score,tournamentRecords:r,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:c,matchUpFormat:u,matchUpId:d,schedule:p,event:m,notes:h})}function Bee(t){if(!(t!=null&&t.outcomes))return{error:Ve};if(!Array.isArray(t.outcomes))return{error:Ve,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],r=i.reduce((n,a)=>n.includes(a.tournamentId)?n:n.concat(a.tournamentId),[]);for(let n of r){let a=e[n];if(!a)return{error:he};let o=i.filter(s=>s.tournamentId===n);if(o.length){let s=dEe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...Z}}function dEe(t){var e;let{tournamentRecords:i,tournamentRecord:r,outcomes:n,policyDefinitions:a}=t,o={};n.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=xn({tournamentRecord:r,eventId:s});for(let c of o[s]){let{drawId:u}=c,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:m}=c,h=oU({schedule:c==null?void 0:c.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:r,drawDefinition:d,matchUpFormat:p,matchUpId:m,outcome:c,drawId:u,event:l});if(h.error)return h}}}return{...Z}}function pEe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:r}){var n,a;if(!r&&!t)return{error:Ce};if(!i)return{error:Ve,info:"missing outcome"};if(!r&&!e)return{error:Yn};if(!r){let o=gi({drawDefinition:t,matchUpId:e});if(o.error)return o;r=o.matchUp}return typeof i!="object"||!((n=i.score)!=null&&n.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:oe}:Mt({element:r,extension:{name:NP,value:i}})}function Vee(t){return pEe(t)}function E$(t){var e,i;let r="resetTieFormat",{drawDefinition:n,event:a,uuids:o}=t,s=kt(t,[{[Zl]:!0,[wp]:!0}],r);if(s.error)return s;let l=iU(t,[{[nw]:nd}]);if(l[dm])return l;let c=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:u,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(u!=null&&u.tieMatchUps))return ee({result:{error:kn},info:"Must be a TEAM matchUp",stack:r});if(!u.tieFormat)return{...Z};let p=(i=cn({structure:d,drawDefinition:n,event:a}))==null?void 0:i.tieFormat;if(!p)return ee({result:{error:on},info:"No inherited tieFormat",stack:r});let m=[],h=[],f=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:I,collectionId:y}=v;h.push(y);let b=(u.tieMatchUps||[]).filter(S=>S.collectionId===y);if(b.length>I)b.sort((S,w)=>(S.matchUpStatus===zi?1:0)-(w.matchUpStatus===zi?1:0)),f.push(...b.slice(0,I)),m.push(...b.slice(3).map(wr));else if(f.push(...b),b.length<I){let S=I-b.length,w=jw({collectionDefinition:v,matchUpsLimit:S,matchUp:u,uuids:o});g.push(...w)}}for(let v of(u==null?void 0:u.tieMatchUps)||[])v.collectionId&&!h.includes(v.collectionId)&&m.push(v.matchUpId);return g.length&&(f.push(...g),Lc({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:n,tournamentId:c})),m.length&&Ku({matchUpIds:m,eventId:a==null?void 0:a.eventId,drawDefinition:n,tournamentId:c}),u&&(u.tieMatchUps=f,u.tieFormatId=void 0,u.tieFormat=void 0,Et({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:r,drawDefinition:n,tournamentId:c,matchUp:u})),{...Z,newMatchUps:g,deletedMatchUpIds:m}}function C$(t){var e,i,r;let{tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return ee({result:{error:Ce},stack:l});if(!o)return ee({result:{error:Xr},stack:l});if(!On(o))return ee({result:{error:oe,matchUpId:o},stack:l});let c=Zr({drawDefinition:a}),{matchUps:u}=cr({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:c}),d=c.drawMatchUps.find(I=>I.matchUpId===o),p=u==null?void 0:u.find(I=>I.matchUpId===o);if(!d||!u)return{error:an};if(d.matchUpType!==oo)return{error:kn};let m=Rn({inContextDrawMatchUps:u,drawDefinition:a,matchUpId:o}),h=p==null?void 0:p.structureId,{structure:f}=et({drawDefinition:a,structureId:h});if(Object.assign(t,{inContextDrawMatchUps:u,inContextMatchUp:p,matchUpsMap:c,targetData:m,structure:f,matchUp:d}),np(t))return{error:iF};if((e=d.tieMatchUps)!=null&&e.length)for(let I of d.tieMatchUps){let y=aU({matchUpId:I.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:n,drawDefinition:a,event:s});if(y.error)return ee({result:y,stack:l})}let g=(i=Gt({tournamentRecord:n,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=ec({event:t.event,removeScore:!0,tournamentRecord:n,appliedPolicies:g,drawDefinition:a,matchUpsMap:c,matchUpId:o});if(v.error)return ee({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let I=(r=cn({drawDefinition:a,structure:f,event:s}))==null?void 0:r.tieFormat;if(d.tieFormat&&I){let{matchUpCountDifference:y,descendantDifferences:b,ancestorDifferences:S,valueDifference:w}=ku({descendant:d.tieFormat,ancestor:I});if(b.collectionIds.length===1&&!S.collectionIds.length&&!S.groupsCount&&y===1&&w===1){let U=E$({tournamentRecord:n,drawDefinition:a,matchUpId:o,event:s});if(U.error)return U}}}return{...Z}}function jee(t){let e=kt(t,[{[Rs]:!0,[lv]:!0},{[QI]:{[rw]:!1,roundNumbers:!1},[T9]:"At least one must be provided",[ad]:Xn}]);if(e.error)return e;let i=hX(t);if(i.error)return i;let{matchUpIds:r}=i,n=Bi(oo)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of r){if(n){let u=C$({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error||t.removeAssignments&&R$({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return u}let c=aU({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=w$({...t,matchUpId:l});if(u.error)return u}}return{...Z}}function mEe({drawDefinition:t,finishingOrder:e}){var i;if(!t)return{error:Ce};let r="setOrderOfFinish";if(!Array.isArray(e))return ee({info:ql("finishingOrder"),result:{error:oe},stack:r});let{completedMatchUps:n,matchUpsMap:a}=wv({inContext:!0,drawDefinition:t}),o=(n==null?void 0:n.map(wr))??[],s=e.map(wr),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(n??[]).filter(({matchUpId:I})=>s.includes(I)).reduce((I,y)=>{let{matchUpTieId:b,matchUpType:S,roundNumber:w,structureId:U}=y;return I.matchUpTypes.includes(S)||I.matchUpTypes.push(S),I.roundNumbers.includes(w)||I.roundNumbers.push(w),I.structureIds.includes(U)||I.structureIds.push(U),I.matchUpTieIds.includes(b)||I.matchUpTieIds.push(b),I},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return ee({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:oe},stack:r});let p,m,h={},f=[],g=[];if(!e.every(({orderOfFinish:I,matchUpId:y})=>(f.push(y),I&&g.push(I),h[y]=I,p=o.includes(y),m=I===void 0||nt(I)&&Math.floor(I)>0,p&&m)))return ee({result:{error:p?oe:zf},info:!p&&"matchUps must be completed"||!m&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:r});let v=n==null?void 0:n.filter(I=>I.structureId===u[0]&&I.roundNumber===c[0]&&I.matchUpType===l[0]&&I.matchUpTieId===d[0]&&!f.includes(I.matchUpId));for(let I of v??[]){let{orderOfFinish:y}=I||{};if(y){if(!nt(y))return ee({context:{orderOfFinish:y,matchUp:I},result:{error:oe},stack:r});g.push(y)}}if(n9(g).length!==g.length||Math.max(...g)>g.length)return ee({info:"Values not unique or greater than expected number of values",result:{error:oe},stack:r});if(u.length){let I=KP({matchUpFilters:{matchUpIds:s},structureId:u[0],drawDefinition:t,matchUpsMap:a});if(I.error)return ee({result:I,stack:r});(i=I.completedMatchUps)==null||i.forEach(y=>y.orderOfFinish=h[y.matchUpId])}return{...Z}}function Gee(t){return mEe(t)}function Hee({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:r,event:n}){var a,o,s,l;if(!t)return{error:he};if(!e)return{error:ma};if(typeof i!="string")return{error:kn};if(!Array.isArray(r))return{error:oe,lineUps:r};let c="applyLineUps",u=t.participants||[],d=gi({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpId:i});if(d.error)return d;if(!d.matchUp)return{error:an};let{matchUp:p,structure:m}=d,{drawPositions:h,matchUpType:f}=p;if(f!==di)return{error:kn};if(!(h!=null&&h.length))return{error:Kb};let g=(a=cn({matchUp:p,drawDefinition:e,structure:m,event:n}))==null?void 0:a.tieFormat,v={};for(let y of r){if(!Array.isArray(y))return{error:oe,lineUp:y};let b={},S=[];for(let R of y){if(typeof R!="object")return{error:oe,lineUpAssignment:R};let{participantId:D,collectionAssignments:E=[]}=R;if(!Array.isArray(E))return{error:oe,collectionAssignments:E};let N=u.find(M=>M.participantId===D);if(!N)return{error:Ji};if(N.participantType!==wt)return{error:bs};let A=(s=(o=p.sides)==null?void 0:o.find(M=>{var C,O;return(O=(C=M.participant)==null?void 0:C.individualParticipantIds)==null?void 0:O.includes(D)}))==null?void 0:s.sideNumber;A&&S.push(A);for(let M of E){if(typeof M!="object")return{error:oe,collectionAssignment:M};let{collectionId:C,collectionPosition:O}=M,k=(l=g==null?void 0:g.collectionDefinitions)==null?void 0:l.find($=>$.collectionId===C);if(!k)return{error:oe,collectionId:C};let x=`${C}-${O}`;b[x]||(b[x]=[]);let F=b[x].length;if(Bi(Ni)(k.matchUpType)&&F||k.matchUpType===ui&&F>1)return{info:"Excessive collectionPosition assignments",error:oe};b[x].push(D)}}let w=Object.values(b);for(let R of w)if(R.length===2){let{participant:D}=Bo({tournamentParticipants:u,participantIds:R});if(!D){let E=il({participant:{participantType:st,participantRole:en,individualParticipantIds:R},pairOverride:!0,tournamentRecord:t});if(E.error)return E}}let U=fa(S),T=(U[1]||0)>(U[2]||0)&&1||(U[2]||0)>(U[1]||0)&&2||void 0,P=Object.keys(v).map(R=>parseInt(R));T&&!P.includes(T)&&(v[T]=y)}if(!Object.keys(v).length)return{error:dF};if(d=gi({drawDefinition:e,matchUpId:i}),d.error)return d;if(!d.matchUp)return{error:an};let{matchUp:I}=d;I.sides||(I.sides=[]);for(let y of[1,2]){let b=I.sides.find(w=>w.sideNumber===y),S=v[y];if(S)b?b.lineUp=S:I.sides.push({lineUp:S,sideNumber:y});else continue}return Et({tournamentId:t==null?void 0:t.tournamentId,context:c,drawDefinition:e,matchUp:I}),{...Z}}var M$={};yt(M$,{anonymizeTournamentRecord:()=>fte,generate:()=>zee,generateEventWithDraw:()=>ZR,generateOutcome:()=>L$,generateOutcomeFromScoreString:()=>N$,generateParticipants:()=>cU,generateTournamentRecord:()=>mte,modifyTournamentRecord:()=>gte,mutate:()=>hte});var zee={};yt(zee,{generateEventWithDraw:()=>ZR,generateOutcome:()=>L$,generateOutcomeFromScoreString:()=>N$,generateParticipants:()=>cU,generateTournamentRecord:()=>mte});function N$(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:r,scoreString:n}=t;if(!n)return{outcome:{...rR,winningSide:r,matchUpStatus:i}};if(r&&![1,2,void 0].includes(r))return{error:oe,winningSide:r};let a=n&&j0({scoreString:n}),o={},s=El({sets:a,matchUpFormat:e}),l=El({sets:a,reversed:!0,matchUpFormat:e});return r===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=j0({scoreString:o.scoreStringSide1}),He({outcome:{matchUpStatus:i,winningSide:r,score:o}})}function A$({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:r}){var n;let a=(((n=e==null?void 0:e[r.matchUpId])==null?void 0:n.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function pg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:r}){var n,a,o,s;let{individualParticipantIds:l}=jP(r);i=i??((n=r.schedule)==null?void 0:n.timeAfterRecovery);let c=m=>{t[m]||(t[m]=[]),t[m]=ht(t[m].concat(...l))},u=m=>{i&&(!e[m]||i>e[m])&&(e[m]=i)},d=((a=r.winnerTo)==null?void 0:a.matchUpId)||r.winnerMatchUpId;d&&(i&&u(d),c(d));let p=((o=r.loserTo)==null?void 0:o.matchUpId)||r.loserMatchUpId;p&&(i&&u(p),c(p)),(s=r.sidesTo)!=null&&s.length&&r.sidesTo.forEach(({matchUpId:m})=>{m&&(i&&u(m),c(m))})}function sU({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function hEe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:r,drawId:n}){t[i].potentialRecovery[n]||(t[i].potentialRecovery[n]=[]),t[i].potentialRecovery[n].push(e),t[i].potentialBookings[n]||(t[i].potentialBookings[n]=[]),t[i].potentialBookings[n].push({timeAfterRecovery:e,scheduleTime:r})}function by({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:r=0,matchUpNotBeforeTimes:n,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var c,u;let d=fi((c=l==null?void 0:l.schedule)==null?void 0:c.endTime),p=d?jn(d,Xe(o)):jn(s,Xe(r)+Xe(o)),m=i&&(d?jn(fi(d),i):jn(s,Xe(r)+Xe(i))),h=((u=a==null?void 0:a[l.matchUpId])==null?void 0:u.participantIds)||[],f=(l.roundPosition&&t[l.matchUpId]||[]).flat();h.forEach(g=>{sU({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&m||p;f.includes(g)?hEe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),pg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,timeAfterRecovery:p,matchUp:l})}function Wee({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:r,details:n}){var a,o,s,l,c;let u,d=(o=(a=n.minutesMap)==null?void 0:a[r])==null?void 0:o.recoveryMinutes,p=(((l=(s=n.minutesMap)==null?void 0:s[r])==null?void 0:l.averageMinutes)||0)+(d||0),m=jn(i,p),h=((c=e==null?void 0:e[r])==null?void 0:c.dependentMatchUpIds)||[];if(h.length){let f=h.reduce((g,v)=>{let I=t[v];if(!I)return g;let y={scheduleTime:I,matchUpId:v};return I&&!g.matchUpId||Pt(I)<Pt(g.scheduleTime)?y:g},{});f.scheduleTime&&Pt(m)>Pt(f.scheduleTime)&&(u=f)}return{scheduledDependent:u}}function fEe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(r=>{var n;return i===ui&&(((n=r==null?void 0:r.participant)==null?void 0:n.individualParticipants)||[])||(r==null?void 0:r.participant)&&[r.participant]||[]}).flat()}var lU="DO_NOT_SCHEDULE",gEe={DO_NOT_SCHEDULE:lU};function O$({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:r,scheduleTime:n,scheduleDate:a,matchUp:o}){let s=fEe(o).map(({person:m})=>m==null?void 0:m.personId);if(i){let m=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:h})=>h==null?void 0:h.personId);s.push(...m)}let l=s.map(m=>{var h;return(h=r[m])==null?void 0:h.map(f=>({...f,personId:m}))}).filter(Boolean).flat().filter(m=>m.requestType===lU&&Bl(a,m.date)),c=[],u=o==null?void 0:o.matchUpId,d=er(fi(n),ct(a)),p=fi(MF(d,t).toISOString());for(let m of l){let{requestId:h,startTime:f,endTime:g}=m;(n>f&&n<g||p>f&&p<g)&&(c.push({matchUpId:u,request:m,scheduleTime:n}),e[h]?(e[h].scheduleTimes.includes(n)||e[h].scheduleTimes.push(n),e[h].matchUpIds.includes(u)||e[h].matchUpIds.push(u)):e[h]={request:m,scheduleTimes:[n],matchUpIds:[u]})}return{conflicts:c}}function JM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:r}){let{matchUpType:n}=i,{individualParticipantIds:a}=jP(i),o=(t[i.matchUpId]||[]).filter(s=>!Dn(s,a)).flat();[...a,...o].forEach(s=>{if(sU({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[n]?l[n]+=r:r>0&&(l[n]=r),l[Eo]?l[Eo]+=r:r>0&&(l[Eo]=r),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function vEe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:r,dateScheduledMatchUps:n,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var p,m;let h=[];i||(n=d==null?void 0:d.filter(v=>{let I=v.schedule||{},y=v.matchUpStatus===Ft;return y&&h.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!y&&eU({schedule:I})&&(!c||v.schedule.scheduledDate===c)}),i=n.map(wr));let f=Array.isArray(l)?l.includes(c):l,g=f?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){JM({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let I=(p=v.schedule)==null?void 0:p.scheduledTime;if(I){o[v.matchUpId]=I;let y=(m=u==null?void 0:u[v.matchUpId])==null?void 0:m.recoveryMinutes;by({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:r,recoveryMinutes:y,scheduleTime:I,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:h,dateScheduledMatchUps:n,clearDate:f}}function IEe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:r,matchUpScheduleTimes:n,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(n),c=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),m=[Ft,Ot,Zi,Ca,dn,jt,ir,hr].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!m}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:m,tournamentId:h}=p;return d.matchUpMap[h]||(d.matchUpMap[h]={}),d.matchUpMap[h][m]?d.matchUpMap[h][m].push(p):d.matchUpMap[h][m]=[p],pg({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function KR({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:r,venueIds:n=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof r!="object")return{error:Ai};if(!po(s)&&!Array.isArray(i))return{error:Xl};a=a??jR({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(r).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:m}=Sw({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:m}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return eU({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let u=i==null?void 0:i.filter(d=>(!n.length||n.includes(d.schedule.venueId))&&d.matchUpStatus!==Ft);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:m})=>{let{event:h,scheduleTiming:f}=l[d],g=h==null?void 0:h.eventType,v={...f,defaultTiming:c,matchUpFormat:m},{averageMinutes:I,recoveryMinutes:y}=HP({timingDetails:v,eventType:g}),{courtId:b,venueId:S}=p,w=fi(p.scheduledTime),U=jn(w,I);return{recoveryMinutes:y,averageMinutes:I,periodLength:a,startTime:w,courtId:b,endTime:U,venueId:S}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function yEe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:r,clearScheduleDates:n,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Ai};s=s??jR({recoveryMinutes:i,averageMatchUpMinutes:r});let{courts:m,venues:h}=tc({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),f=(m==null?void 0:m.filter(S=>!u||u.includes(S.venueId)))??[];c=c??dg({courts:f,scheduleDate:l,startTime:!0}),p=p??dg({courts:f,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=KR({defaultRecoveryMinutes:i,averageMatchUpMinutes:r,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),I={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:r,clearScheduleDates:n,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:f},{scheduleTimes:y}=g$(I),b=(u==null?void 0:u.length)===1&&u[0]||(h==null?void 0:h.length)===1&&h[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(ga("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:y,venueId:b}}function bEe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let r=[],n=[],a,o,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(n=n.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,r.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:n}),n=c.matchUpIds),s=i?e:c.averageMinutes,o=c.recoveryMinutes,a=c.roundPeriodLength;return n.length&&r.push({matchUpIds:n,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:r}}function qee({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:r,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:m,venues:h}){var f;let g={},v=[],I=[],y=[];for(let b of h){let{rounds:S=[],venueId:w}=b,{scheduledRoundsDetails:U,greatestAverageMinutes:T,orderedMatchUpIds:P,minutesMap:R}=Zw({scheduleCompletedMatchUps:i,containedStructureIds:r,tournamentRecords:l,periodLength:c,matchUps:p,rounds:S});y.push(...P??[]);let{groupedRounds:D}=bEe({scheduledRoundsDetails:U,greatestAverageMinutes:T,garmanSinglePass:!0}),E,N,A=[];d&&({scheduleTimes:A,dateScheduledMatchUpIds:E,dateScheduledMatchUps:N}=yEe({averageMatchUpMinutes:(f=D[0])==null?void 0:f.averageMinutes,scheduleDate:ct(u),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let M=vEe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:E,greatestAverageMinutes:T,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:R,matchUps:p});({dateScheduledMatchUpIds:E,dateScheduledMatchUps:N}=M);let{byeScheduledMatchUpDetails:C,clearDate:O}=M;C!=null&&C.length&&I.push(...C);let{matchUpsToSchedule:k,matchUpMap:x}=IEe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:E,matchUpNotBeforeTimes:n,matchUpScheduleTimes:a,orderedMatchUpIds:P,clearDate:O,matchUps:p}),F=m.filter($=>$.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:F.length,greatestAverageMinutes:T,scheduledRoundsDetails:U,dateScheduledMatchUps:N,matchUpsToSchedule:k,scheduleTimes:A,groupedRounds:D,venueCourts:F,minutesMap:R,matchUpMap:x},s||v.push(...E)}return{allDateScheduledByeMatchUpDetails:I,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:y}}function wEe(t,e){let i=Pt(t.scheduleTime),r=Pt(t.timeAfterRecovery),n=Pt(e.scheduleTime),a=Pt(e.timeAfterRecovery),o=i===n||r===a,s=i>n&&i<a,l=n>i&&n<r,c=r>n&&r<a,u=a>i&&a<r;return He({hasOverlap:o||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function k$({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:r,matchUp:n,details:a}){var o,s,l,c,u;let d=(((o=i==null?void 0:i[n.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[n.matchUpId])==null?void 0:l.averageMinutes)||0,m=((u=(c=a==null?void 0:a.minutesMap)==null?void 0:c[n.matchUpId])==null?void 0:u.recoveryMinutes)||0,h=d.every(v=>{var I;sU({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let b=fi((I=n==null?void 0:n.schedule)==null?void 0:I.endTime),S=b?jn(b,Xe(m)):jn(r,Xe(p)+Xe(m));return![...Object.keys(y.potentialBookings).filter(w=>w!==n.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>wEe({scheduleTime:r,timeAfterRecovery:S},w).hasOverlap)}),f=e[n.matchUpId],g=(f?aw(er(f),er(r),!1):0)>=0;return{enoughTime:h&&g}}function x$({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:r}){let{enteredIndividualParticipantIds:n}=jP(r),{matchUpId:a,matchUpType:o}=r,s=(r.roundPosition&&e[a]||[]).flat(),l=ht(n.concat(...s));return l.forEach(c=>{sU({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[o,Eo].find(d=>{var p;let m=((p=u.counters)==null?void 0:p[d])||0,h=i[d]||0;return m&&h&&m>=h})}),relevantParticipantIds:l}}function wy({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:r=!0,matchUpDependencies:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var d,p,m;if(!s)return{error:he};if(!l&&(!c||!Array.isArray(c)))return{error:iv};if(!l&&(!u||typeof u!="object"))return{error:jK};let h,f=[],g=0;if(r&&!n){let y=Zo({tournamentRecords:o,tournamentRecord:s});n=y.matchUpDependencies,h=y.matchUps}h||(h=((d=Lr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=h.reduce((y,b)=>{let{matchUpId:S,drawId:w,matchUpStatus:U}=b;return(e||U!==Ft)&&(t||!Sr.includes(U))&&(y[w]?y[w].push(S):y[w]=[S]),y},{}),I=l==null?void 0:l.map(y=>y.matchUpId);for(let y of Object.keys(v)){let{drawDefinition:b}=cd({tournamentRecord:s,drawId:y});if(!b)continue;let S=v[y].filter(U=>(c==null?void 0:c.includes(U))??(I==null?void 0:I.includes(U))),w=Nn({inContext:!1,drawDefinition:b}).matchUps;for(let U of S){let T=((p=l==null?void 0:l.find(R=>R.matchUpId===U))==null?void 0:p.schedule)||u,P=qR({schedule:T,matchUpDependencies:n,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:h,tournamentRecords:o,tournamentRecord:s,checkChronology:r,drawDefinition:b,drawMatchUps:w,matchUpId:U});if((m=P==null?void 0:P.warnings)!=null&&m.length&&f.push(...P.warnings),P!=null&&P.success&&(g+=1),P.error)return P}}return f.length?{...Z,scheduled:g,warnings:f}:{...Z,scheduled:g}}function uU(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:r=!1,errorOnAnachronism:n,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:c,schedule:u}=t;if(t.matchUpIds&&!a)return wy(t);let d=kt(t,[{[sn]:!0},{[QI]:{matchUpContextIds:!1,matchUpDetails:!1},[_l]:oe,[ad]:Xn}]);if(d.error)return d;if((!c||a)&&!u)return{error:Ve,info:"schedule is required"};let p=[],m=0,{matchUpDependencies:h}=Zo({tournamentRecords:s});for(let f of Object.values(s)){let{tournamentId:g}=f,v=a==null?void 0:a.filter(y=>y.tournamentId===g).map(wr),I=c==null?void 0:c.filter(y=>(y==null?void 0:y.tournamentId)===g);if(v!=null&&v.length||I!=null&&I.length){let y=wy({matchUpDetails:I,scheduleCompletedMatchUps:i,scheduleByeMatchUps:r,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:o,tournamentRecords:s,tournamentRecord:f,checkChronology:l,matchUpIds:v,schedule:u});if((e=y.warnings)!=null&&e.length&&p.push(...y.warnings),y.scheduled&&(m+=y.scheduled),y.error)return y}}return p.length?{...Z,scheduled:m,warnings:p}:{...Z,scheduled:m}}function Yee({autoSchedulingAudit:t,tournamentRecords:e}){var i;Tt({topic:rg,payload:t});let r=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:r(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:r(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:r(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:r(t==null?void 0:t.requestConflicts),profileRoundsCount:n},o={itemType:eee,itemValue:a};for(let s of Object.values(e))Lh({tournamentRecord:s,timeItem:o})}function UEe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:m,courts:h,dryRun:f}){var g,v,I,y,b,S,w;let U={},T={},P={},R={},D={},E={},N={},A={},M={},C={};for(let x of n){let F=ct(x==null?void 0:x.scheduleDate),$=(x==null?void 0:x.venues)||[],_={},L={},B=(K,z)=>{K.forEach(te=>{let J=L[te].counters;J[z]?J[z]+=1:J[z]=1,J[Eo]?J[Eo]+=1:J[Eo]=1})};P[F]={},R[F]={},U[F]={},T[F]={},N[F]=[],A[F]=[],M[F]=[],C[F]=[];let V={};m.forEach(K=>{var z;(z=K.schedule)!=null&&z.scheduledDate&&Bl(F,ct(K.schedule.scheduledDate))&&pg({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:V,matchUp:K})});let{allDateScheduledByeMatchUpDetails:G,venueScheduledRoundDetails:j,allDateMatchUpIds:H}=qee({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:V,matchUpScheduleTimes:E,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:F,matchUps:m,courts:h,venues:$}),W=10,Y=0,q,re=10;for(;!q;){for(let{venueId:K}of $){let z=0,te=j[K];for(;te.courtsCount&&(g=te.scheduleTimes)!=null&&g.length&&(v=te.matchUpsToSchedule)!=null&&v.length&&z<=te.courtsCount;){let{scheduleTime:J,attempts:ie=0}=te.scheduleTimes.shift(),ne=te.matchUpsToSchedule.find(ue=>{var ae,ce;let{matchUpId:pe,matchUpType:Se}=ue,{participantIdsAtLimit:Be,relevantParticipantIds:Pe}=x$({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpDailyLimits:s,matchUp:ue});if(Be.length)return A[F].includes(pe)||A[F].push(pe),!1;let{scheduledDependent:at}=Wee({matchUpScheduleTimes:E,matchUpDependencies:o,scheduleTime:J,matchUpId:pe,details:te});if(at)return!1;let{dependenciesScheduled:de,remainingDependencies:Ie}=A$({matchUpScheduleTimes:E,matchUpDependencies:o,allDateMatchUpIds:H,matchUp:ue});if(!de)return R[F][pe]||(R[F][pe]=[]),R[F][pe].push({scheduleTime:J,remainingDependencies:Ie}),!1;let{enoughTime:me}=k$({individualParticipantProfiles:L,matchUpNotBeforeTimes:V,matchUpDependencies:o,scheduleTime:J,details:te,matchUp:ue});if(!me)return P[F][pe]||(P[F][pe]=[]),P[F][pe].push({scheduleTime:J}),!1;let Me=te.greatestAverageMinutes,{conflicts:be}=O$({potentials:e,averageMatchUpMinutes:Me,requestConflicts:C,personRequests:d,scheduleTime:J,scheduleDate:F,matchUp:ue});if(be!=null&&be.length)return D[F]||(D[F]=[]),D[F].push(...be),!1;B(Pe,Se);let _e=(ce=(ae=te.minutesMap)==null?void 0:ae[pe])==null?void 0:ce.recoveryMinutes;return by({matchUpPotentialParticipantIds:_,individualParticipantProfiles:L,matchUpNotBeforeTimes:V,averageMatchUpMinutes:Me,matchUpDependencies:o,recoveryMinutes:_e,scheduleTime:J,matchUp:ue}),E[pe]=J,!0});te.matchUpsToSchedule=te.matchUpsToSchedule.filter(({matchUpId:ue})=>ue!==(ne==null?void 0:ne.matchUpId)),ne?z+=1:(T[F][K]||(T[F][K]=[]),T[F][K].push({scheduleTime:J,attempts:ie+1}))}(I=te.matchUpsToSchedule)!=null&&I.length&&(T[F][K]=(y=T[F][K])==null?void 0:y.filter(J=>{let ie=J.attempts<W;return ie&&te.scheduleTimes.push(J),!ie})),(!((b=te.scheduleTimes)!=null&&b.length)||!((S=te.matchUpsToSchedule)!=null&&S.length))&&(te.complete=!0)}Y+=1,q=$.every(({venueId:K})=>j[K].complete)||Y===re}for(let{venueId:K}of $){let z=j[K].matchUpMap;Object.keys(z).forEach(te=>{let J=c[te];J&&Object.keys(z[te]).forEach(ie=>{let{drawDefinition:ne}=cd({tournamentRecord:J,drawId:ie});ne&&z[te][ie].forEach(({matchUpId:ue})=>{let ae=E[ue];if(ae){let ce=ae.split(":").map(qa).join(":"),pe=`${ct(F)}T${ce}`;f?N[F].push(ue):(dd({drawDefinition:ne,scheduledTime:pe,matchUpId:ue}).success&&N[F].push(ue),K&&Av({tournamentRecord:J,drawDefinition:ne,matchUpId:ue,venueId:K}))}})})}),M[F]=j[K].matchUpsToSchedule.map(wr),U[F][K]=j[K].scheduleTimes.sort((te,J)=>Pt(te.scheduleTime)-Pt(J.scheduleTime))}!f&&G!=null&&G.length&&uU({matchUpDetails:G,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of x.venues)for(let z of K.rounds){let te=(((w=z.matchUps)==null?void 0:w.map(({matchUpId:ie})=>ie))||[]).filter(ie=>N[F].includes(ie));z.canScheduledMatchUpIds=te;let J=Math.round(te.length/z.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=0),z.possibleToSchedulePct=J,z.matchUpsCount===te.length&&(z.possibleToSchedule=!0)}}let O=n.map(({scheduleDate:x})=>x),k={timeStamp:Date.now(),overLimitMatchUpIds:A,scheduledMatchUpIds:N,schedulingProfile:u,noTimeMatchUpIds:M,requestConflicts:C,scheduledDates:O};return Yee({tournamentRecords:c,autoSchedulingAudit:k}),{...Z,schedulingProfileModifications:t,schedulingProfileIssues:r,scheduleTimesRemaining:U,dateSchedulingProfiles:n,skippedScheduleTimes:T,recoveryTimeDeferredMatchUpIds:P,dependencyDeferredMatchUpIds:R,matchUpScheduleTimes:E,overLimitMatchUpIds:A,scheduledMatchUpIds:N,noTimeMatchUpIds:M,requestConflicts:C,scheduledDates:O}}function GV({averageMinutes:t,startTime:e,endTime:i,court:r,date:n}){if(!Array.isArray(r.dateAvailability))return{error:Ve,stack:"getEarliestCourtTime"};let a=dg({scheduleDate:n,courts:[r],startTime:!0}),o=dg({scheduleDate:n,courts:[r],endTime:!0});e=e||a,i=i||o;let s=nU({court:r,date:n}),{timeSlots:l}=Mv({courtDate:s}),c=er(e),u=er(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let m=er(p.startTime),h=er(p.endTime);if(m>u||h<c)return d;let f=c>m?c:m;if(aw(f,h)>=t){let g=fi(f.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function SEe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:r,dateSchedulingProfiles:n,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:m=[],courts:h,dryRun:f}){var g,v;let I={},y={},b={},S={},w={},U={},T={},P={},R={};for(let N of n??[]){let A=ct(N==null?void 0:N.scheduleDate),M=(N==null?void 0:N.venues)||[],C={},O={},k=(K,z)=>{K.forEach(te=>{let J=O[te].counters;J[z]?J[z]+=1:J[z]=1,J[Eo]?J[Eo]+=1:J[Eo]=1})};I[A]={},y[A]={},U[A]=[],T[A]=[],P[A]=[],R[A]=[];let x={};m==null||m.forEach(K=>{var z;(z=K.schedule)!=null&&z.scheduledDate&&Bl(A,ct(K.schedule.scheduledDate))&&pg({matchUpPotentialParticipantIds:C,matchUpNotBeforeTimes:x,matchUp:K})});let{allDateScheduledByeMatchUpDetails:F,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:_,allDateMatchUpIds:L}=qee({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:x,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:A,matchUps:m,courts:h,venues:M}),B=m==null?void 0:m.filter(({matchUpId:K})=>$.includes(K)),{bookings:V}=KR({dateScheduledMatchUps:B,tournamentRecords:c,scheduleDate:A,periodLength:u}),{virtualCourts:G}=VR({scheduleDate:A,periodLength:u,bookings:V,courts:h}),j=G==null?void 0:G.reduce((K,z)=>{let{earliestCourtTime:te,courtEndTime:J}=GV({date:A,averageMinutes:0,court:z});return(!K.startTime||er(te)<er(K.startTime))&&(K.startTime=te),(!K.endTime||er(J)>er(K.endTime))&&(K.endTime=J),K},{}),H=j.startTime,W=({courtId:K,booking:z})=>{var te;return(te=G==null?void 0:G.find(J=>J.courtId===K))==null?void 0:te.dateAvailability[0].bookings.push(z)},Y=10,q=0,re;for(;!re;){for(let{venueId:K}of M){let z=_[K],te=z.matchUpsToSchedule.length,J=[],ie=[],ne,ue=0;for(;!ne;){for(let ae of z.matchUpsToSchedule){if(ie.length===z.courtsCount||J.length===z.courtsCount){ne=!0;break}let{matchUpId:ce,matchUpType:pe}=ae,{participantIdsAtLimit:Se,relevantParticipantIds:Be}=x$({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:ae});if(Se.length){T[A].includes(ce)||T[A].push(ce);continue}let{dependenciesScheduled:Pe,remainingDependencies:at}=A$({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:L,matchUp:ae});if(!Pe){y[A][ce]||(y[A][ce]=[]),y[A][ce].push({remainingDependencies:at});continue}let de=[],Ie=G==null?void 0:G.reduce((me,Me)=>{var be,_e,Ne,se;if(ie.includes(Me.courtId))return me;let{earliestCourtTime:ge}=GV({averageMinutes:z.greatestAverageMinutes,startTime:H,date:A,court:Me});if(me.scheduleTime&&Pt(ge)>=Pt(me.scheduleTime))return me;let{scheduledDependent:we}=Wee({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:ge,matchUpId:ce,details:z});if(we)return me;let{enoughTime:De}=k$({individualParticipantProfiles:O,matchUpNotBeforeTimes:x,matchUpDependencies:o,scheduleTime:ge,details:z,matchUp:ae});if(!De)return I[A][ce]||(I[A][ce]=[]),I[A][ce].includes(ge)||I[A][ce].push(ge),me;let Le=((_e=(be=z.minutesMap)==null?void 0:be[ce])==null?void 0:_e.averageMinutes)||z.greatestAverageMinutes,{conflicts:ye}=O$({potentials:e,averageMatchUpMinutes:Le,requestConflicts:R,personRequests:p,scheduleTime:ge,scheduleDate:A,matchUp:ae});if(ye!=null&&ye.length)return de.push(...ye),!1;k(Be,pe);let Te=(se=(Ne=z.minutesMap)==null?void 0:Ne[ce])==null?void 0:se.recoveryMinutes;return by({matchUpPotentialParticipantIds:C,individualParticipantProfiles:O,matchUpNotBeforeTimes:x,averageMatchUpMinutes:Le,matchUpDependencies:o,recoveryMinutes:Te,scheduleTime:ge,matchUp:ae}),(!me.scheduleTime||Pt(ge)<Pt(me.scheduleTime))&&(me.averageMatchUpMinutes=Le,me.recoveryMinutes=Te,me.scheduleTime=ge,me.courtName=Me.courtName,me.courtId=Me.courtId),me},{});if(Ie.scheduleTime){let{averageMatchUpMinutes:me,recoveryMinutes:Me,scheduleTime:be,courtId:_e}=Ie;w[ce]=be,S[ce]=_e,J.push(ce),ie.push(_e);let Ne=be,se=jn(Ne,me);W({courtId:_e,booking:{averageMatchUpMinutes:me,recoveryMinutes:Me,periodLength:u,matchUpId:ce,startTime:Ne,courtId:_e,endTime:se,venueId:K}}),z.matchUpsToSchedule=z.matchUpsToSchedule.filter(ge=>ge.matchUpId!==ce)}else de!=null&&de.length&&(b[A]||(b[A]=[]),b[A].push(...de))}(ie.length===z.courtsCount||J.length===z.courtsCount||!z.matchUpsToSchedule.length)&&(ne=!0),z.matchUpsToSchedule.length&&J<z.courtsCount&&(er(H)<er(j.endTime)?H=jn(H,u):(ne=!0,z.complete=!0)),ue+=1,!ne&&ue>=te&&(ne=!0)}(g=z.matchUpsToSchedule)!=null&&g.length||(z.complete=!0)}q+=1,re=M.every(({venueId:K})=>_[K].complete)||q===Y}for(let{venueId:K}of M){let z=_[K].matchUpMap;Object.keys(z).forEach(te=>{let J=c[te];J&&Object.keys(z[te]).forEach(ie=>{let{drawDefinition:ne}=cd({tournamentRecord:J,drawId:ie});ne&&z[te][ie].forEach(({matchUpId:ue})=>{let ae=w[ue],ce=S[ue];if(ae){let pe=ae.split(":").map(qa).join(":"),Se=`${ct(A)}T${pe}`;f||(dd({drawDefinition:ne,scheduledTime:Se,matchUpId:ue}),jh({courtDayDate:A,tournamentRecords:c,tournamentRecord:J,drawDefinition:ne,matchUpId:ue,courtId:ce})),U[A].push(ue)}})})}),P[A]=_[K].matchUpsToSchedule.map(wr)}!f&&F!=null&&F.length&&uU({matchUpDetails:F,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let K of N.venues)for(let z of K.rounds){let te=(v=(z.matchUps??[]).map(({matchUpId:ie})=>ie))==null?void 0:v.filter(ie=>U[A].includes(ie));z.canScheduledMatchUpIds=te;let J=Math.round(((te==null?void 0:te.length)||0)/z.matchUpsCount*1e4)/100;(J===1/0||isNaN(J))&&(J=void 0),z.possibleToSchedulePct=J,z.matchUpsCount===(te==null?void 0:te.length)&&(z.possibleToSchedule=!0)}}let D=(n??[]).map(({scheduleDate:N})=>N),E={timeStamp:Date.now(),overLimitMatchUpIds:T,scheduledMatchUpIds:U,schedulingProfile:d,noTimeMatchUpIds:P,requestConflicts:R,scheduledDates:D};return Yee({tournamentRecords:c,autoSchedulingAudit:E}),{...Z,schedulingProfileModifications:t,schedulingProfileIssues:r,dateSchedulingProfiles:n,recoveryTimeDeferredMatchUpIds:I,dependencyDeferredMatchUpIds:y,matchUpScheduleTimes:w,overLimitMatchUpIds:T,scheduledMatchUpIds:U,noTimeMatchUpIds:P,requestConflicts:R,scheduledDates:D}}function JR(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=Sr,scheduledDates:r,venueIds:n}=t,a=ll(t),o=Ii(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Ai};let s=0;for(let l of o){let c=a[l],u=TEe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:r,venueIds:n});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...Z,clearedScheduleCount:s}}function TEe({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=Sr,tournamentRecord:i,scheduledDates:r,venueIds:n=[]}){if(typeof i!="object")return{error:he};if(!Array.isArray(e)||!Array.isArray(n))return{error:oe};n.length&&t.push("venueId");let a=Lr({matchUpFilters:{scheduledDates:r},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&eU({schedule:u,scheduleAttributes:t})&&(!(n!=null&&n.length)||n.includes(u.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let c in o){let{event:u,drawDefinition:d}=xn({tournamentRecord:i,drawId:c}),p=Nn({drawDefinition:d,matchUpFilters:{matchUpIds:o[c]}}).matchUps??[];for(let m of p){let h=!1;m.timeItems=(m.timeItems??[]).filter(f=>{let g=(f==null?void 0:f.itemType)&&![Au,Qd,vv,Iv,yv].includes(f==null?void 0:f.itemType);return g||(h=!0),g}),h&&(Et({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:m}),l+=1)}}return{...Z,clearedScheduleCount:l}}function XR(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:r,scheduleDates:n=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:c}=t,u=kt(t,[{[sn]:!0},{[is]:P=>!P||Array.isArray(P)&&P.every(Da),[I9]:!1,[ad]:Xn}]);if(u.error)return u;let d=ic({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...Z};let{modifications:p,issues:m=[],schedulingProfile:h=[]}=d,f=Object.assign({},...Object.values(a).map(P=>gv({tournamentRecord:P}).containedStructures)),g=n.map(P=>{if(Da(P))return ct(P)}).filter(Boolean),v=h.map(P=>P.scheduleDate).map(P=>Da(P)&&ct(P)).filter(P=>P&&(!n.length||g.includes(P)));if(!v.length)return{error:IK};if(r&&!l){let P=Array.isArray(r)?r:[];JR({tournamentRecords:a,scheduledDates:P})}let I=tc({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:y}=Us({matchUpFilters:{matchUpTypes:[Ni,ui]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=Zo({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:y}),{matchUpDailyLimits:S}=kR({tournamentRecords:a}),{personRequests:w}=kp({requestType:lU,tournamentRecords:a}),U=h.filter(P=>{let R=ct(P==null?void 0:P.scheduleDate);return v.includes(R)}).sort((P,R)=>new Date(P.scheduleDate).getTime()-new Date(R.scheduleDate).getTime()),T={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:m,dateSchedulingProfiles:U,containedStructureIds:f,matchUpDependencies:b,matchUpDailyLimits:S,clearScheduleDates:r,tournamentRecords:a,schedulingProfile:h,personRequests:w,periodLength:o,useGarman:s,matchUps:y,dryRun:l,courts:I};return c?SEe(T):UEe(T)}function Kee(t){let e=t||{};return e.tournamentId||(e.tournamentId=Yt()),e.startDate&&!Yd(e.startDate)&&!v0.test(e.startDate)?{error:Tn}:e.endDate&&!Yd(e.endDate)&&!v0.test(e.endDate)?{error:Tn}:(e.extensions&&(e.extensions=e.extensions.filter(Js)),{...e})}function F$({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:r,teamNames:n,accessor:a,uuids:o}){var s,l;if(!i)return{error:he};let c={},u=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===wt&&v===en),d=0;for(let g of u){let v=a&&((s=mm({element:g,accessor:a}))==null?void 0:s.value)||r&&((l=g.person)==null?void 0:l[r])||e&&g[e];if(v){if(!Object.keys(c).includes(v)){c[v]={participantName:(n==null?void 0:n[d])??v,participantId:(o==null?void 0:o.pop())??Yt(),individualParticipantIds:[],participantRole:en,participantType:ii};let I={value:r??e,name:pM};Mt({element:c[v],extension:I}),d+=1}c[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(c),m=(i.participants??[]).map(g=>{if(g.participantType!==ii||g.participantRole!==en)return;let{extension:v}=ft({name:pM,element:g}),I=v==null?void 0:v.value;if(p.includes(I))return g.participantId}).filter(Boolean),h=0,f=[];return Object.keys(c).forEach(g=>{let v=c[g],{participantId:I}=v;m.includes(I)||(i.participants||(i.participants=[]),t&&i.participants.push(v),f.push(v),h++)}),t&&h?(Tt({payload:{tournamentId:i.tournamentId,participants:f},topic:Fc}),{...Z,participantsAdded:h}):f.length?{...Z,newParticipants:f}:{error:Cbe}}var DEe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],PEe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Jee({count:t=1,participantsCount:e=32}={}){let i=hn(PEe),r=i.slice(0,t);return{cities:Ee(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Uo(r))}}function Xee({count:t=1,participantsCount:e=32}={}){let i=hn(DEe),r=i.slice(0,t).map(n=>Object.keys(n)).flat();return{states:Ee(0,e).map(n=>n<Math.min(t,i.length)?r[n]:Uo(r))}}function Zee({count:t=1,participantsCount:e=32}={}){let i=Ee(0,t).map(()=>Ee(0,5).map(()=>Ha(0,9)).join(""));return{postalCodes:Ee(0,e).map(r=>r<t?i[r]:Uo(i))}}function Qee(t){let{cities:e,states:i,postalCodes:r,nationalityCode:n,participantIndex:a}=t;return{postalCode:r==null?void 0:r[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:n}}var REe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function ZE(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![li,Si].includes(i))return{personData:[],error:oe};let r=Math.ceil(e*1.3),{lastNames:n,firstFemale:a,firstMale:o}=REe,s=bc.map(({iso:f})=>f).filter(Boolean),l=Math.ceil(r/n.length),c=Math.ceil(r/a.length),u=Math.ceil(r/o.length),d=Ee(0,l).flatMap(()=>{let f=Fe(n,!1,!0);return Ee(0,n.length).map(()=>ra(f))}),p=Ee(0,c).flatMap(()=>{let f=Fe(a,!1,!0);return Ee(0,a.length).map(()=>ra(f))}),m=Ee(0,u).flatMap(()=>{let f=Fe(o,!1,!0);return Ee(0,o.length).map(()=>ra(f))}),h={};for(let f=0;f<r;f++){let g=d.pop(),v=i||Uo([li,Si]),I=v===li?m.pop():p.pop(),y=Uo(s);h[`${I}${g}`]={nationalityCode:y,sex:v,firstName:I,lastName:g}}return{personData:Object.values(h).slice(0,e)}}function ete(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:r,isMock:n=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:oe};let c=(a==null?void 0:a[li])||l===li&&e||0,u=(a==null?void 0:a[Si])||l===Si&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&ZE({count:c,sex:li}).personData||[],m=u&&ZE({count:u,sex:Si}).personData||[],h=[...p,...m,...d&&ZE({count:d}).personData||[]],f=h.filter(T=>!l||c&&u||T.sex===l),g=[];if(Array.isArray(o)){let T=o.filter(P=>typeof P.firstName!="string"||typeof P.lastName!="string"||P.sex&&![li,Si].includes(P.sex)||P.nationalityCode&&(typeof P.nationalityCode!="string"||P.nationalityCode.length>3||!bc.find(({iso:R,ioc:D})=>[R,D].includes(P.nationalityCode)))?!1:(P.nationalityCode&&g.push(P.nationalityCode),!0));if(T.length)f=T;else return{error:oe}}let v=o?f:hn(f);if(v.length<e){let{maleFirstNames:T,maleLastNames:P,femaleFirstNames:R,femaleLastNames:D,nationalityCodes:E}=h.reduce((N,A)=>{let{firstName:M,lastName:C,nationalityCode:O}=A;return A.sex===li?(N.maleFirstNames.includes(M)||N.maleFirstNames.push(M),N.maleLastNames.includes(C)||N.maleLastNames.push(C)):(N.femaleFirstNames.includes(M)||N.femaleFirstNames.push(M),N.femaleLastNames.includes(C)||N.femaleLastNames.push(C)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ee(0,e-v.length).forEach(()=>{let N=l||Uo([li,Si]),A=Uo(E),M=Uo(N===li?T:R),C=Uo(N===li?P:D),O={firstName:M,lastName:C,sex:N,nationalityCode:A};v.push(O)})}let{ageMinDate:I,ageMaxDate:y}=Hw({consideredDate:r,category:s}),b=Xe((I==null?void 0:I.slice(0,4))||0)||Xe((y==null?void 0:y.slice(0,4))||0)-3,S=Xe((y==null?void 0:y.slice(0,4))||0)||Xe((I==null?void 0:I.slice(0,4))||0)+3,w=(I||y)&&[b,S],U=v.slice(0,e).map((T,P)=>{let[R,D]=w||[],E=w&&ra(Ee(R,D)),N=ra(Ee(0,365)),A=E&&Gwe(E,N);return Object.assign(He({extensions:i||[{name:"regionCode",value:P+1}],birthDate:A,isMock:n}),T)});return{persons:U.length&&U||v[0],nationalityCodes:g}}var EEe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function XM({nameRoot:t="TEAM",count:e=1}={}){let i=hn(EEe).slice(0,e);return i.length<e&&Ee(0,e-i.length).forEach(r=>i.push(`${t} ${r+1}`)),{names:i}}function ZM({idPrefix:t,participantType:e,index:i,uuids:r}){return t?`${t}-${e===wt?"I":"P"}-${i}`:(r==null?void 0:r.pop())||Yt()}function cU(t){let{rankingRange:e,scaledParticipantsCount:i}=t,{ratingsParameters:r=Ta,valuesInstanceLimit:n,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:c,participantsCount:u=32,participantType:d,personIds:p,idPrefix:m,uuids:h,personExtensions:f,addressProps:g,gendersCount:v,matchUpType:I,personData:y,sex:b,inContext:S,withISO2:w,withIOC:U,scaleAllParticipants:T}=t,P=d===st||I===Xd,R=d===ii||I===ii;e&&(!Array.isArray(e)||!e.every(ue=>ki(ue))||e.length!==2)&&(e=void 0),i=T?u:i;let D=1e3,E=i&&i>D?i:D;e=e||[1,E],e[1]+=1;let N=u*(P?2:R?8:1),A=ete({count:N,personExtensions:f,consideredDate:a,gendersCount:v,personData:y,category:o,sex:b});if(A.error)return A;let{nationalityCodes:M,persons:C}=A,O=[],k=[],x=[],F=[];if(typeof o=="object"){let{categoryName:ue,ageCategoryCode:ae,ratingType:ce}=o;if((ue||ae)&&!ce){let[pe,Se]=e||[];if(k=hn(Ee(pe,Se)).slice(0,i||Ha(20,30)),[st,ii].includes(d)){let[Be,Pe]=e||[];O=hn(Ee(Be,Pe)).slice(0,i||Ha(20,30))}}if(ce&&r[ce]){let{ratingMax:pe,ratingMin:Se,ratingAttributes:Be}=o,Pe={...r[ce],...Be||{}},{attributes:at={},decimalsCount:de,accessors:Ie,range:me,step:Me}=Pe,be=we=>{let De={},Le=Object.keys(we||{});for(let ye of Le){let Te=we[ye];if(typeof Te=="object"&&Te.generator){let{range:Ze}=Te,[je,ve]=Ze.slice().sort();De[ye]=Ha(je,ve)}else De[ye]=Te}return De},_e=me[0]>me[1]?2:.5,[Ne,se]=me.slice().sort(),ge=()=>Ee(0,2e3).map(()=>i9(Ne,se,_e,Me,de)).filter(we=>(!pe||we<=pe)&&(!Se||we>=Se)).slice(0,i||Ha(20,30)).map(we=>Ie?Object.assign({},...Ie.map(De=>({[De]:we})),be(at)):we);x=ge(),[st,ii].includes(d)&&(F=ge())}}let $=bc.filter(ue=>l==="IOC"&&ue.ioc||ue.iso);function _(ue){let ae=Math.ceil(N/ue);return n&&ae>n?Math.ceil(N/n):ue}let{postalCodesProfile:L,postalCodesCount:B,statesProfile:V,citiesProfile:G,citiesCount:j,statesCount:H}=g||{},W=ue=>Object.keys(ue).map(ae=>Ee(0,V[ae]).map(()=>ae)).flat(),Y=G&&W(G)||(g==null?void 0:g.cities)||Jee({count:j||N,participantsCount:N}).cities,q=V&&W(V)||(g==null?void 0:g.states)||Xee({count:H||N,participantsCount:N}).states,re=L&&W(L)||(g==null?void 0:g.postalCodes)||Zee({count:B||N,participantsCount:N}).postalCodes,K={cities:Y,states:q,postalCodes:re},z=_(s),te=z?hn($).slice(0,s):c?$.filter(ue=>c.includes(ue.iso)):$,J=hn(Ee(0,Math.ceil(N/(z||1))).map(()=>te).flat(1/0)),ie=XM({count:u}).names;return{participants:Ee(0,u).map(ue=>{let ae=P?2:R?8:1,ce=Ee(0,ae).map(at=>{let de=ue*ae+at;return ne(de)}),pe=ce.map(at=>at.participantId),Se=ce.map(at=>at.person.standardFamilyName).join("/"),Be=P?st:ii,Pe={participantId:ZM({participantType:Be,idPrefix:m,index:ue,uuids:h}),participantRole:en,participantName:P?Se:ie[ue],individualParticipantIds:pe,participantType:Be};return S&&(Pe.individualParticipants=ce),P||R?[Pe,...ce]:ce}).flat(),...Z};function ne(ue){let ae=C[ue],{nationalityCode:ce,participantExtensions:pe,participantTimeItems:Se,extensions:Be,firstName:Pe,birthDate:at,lastName:de,personId:Ie,sex:me}=ae||{},Me=Pe||"GivenName",be=de||"FamilyName",_e=`${Me} ${be}`,Ne=J[ue],se=(M==null?void 0:M.length)&&ce||Ne&&(l==="IOC"?Ne.ioc||Ne.iso:Ne.iso||Ne.ioc)||ce;J!=null&&J.length&&!se&&!ce&&console.log("%c Invalid Nationality Code",{participantIndex:ue,country:Ne});let ge=Qee({...K,participantIndex:ue,nationalityCode:se}),we=He({participantId:ZM({participantType:wt,index:ue,idPrefix:m,uuids:h}),extensions:pe,timeItems:Se,participantRole:en,participantType:wt,participantName:_e,person:{addresses:[ge],personId:Ie||(p==null?void 0:p.length)&&p[ue]||Yt(),standardFamilyName:be,standardGivenName:Me,nationalityCode:se,extensions:Be,birthDate:Da(at)?at:void 0,sex:me}});if(U&&se){let De=bc.find(({iso:Le})=>Le===se);De!=null&&De.ioc&&(we.person.iocNationalityCode=De.ioc),De!=null&&De.label&&(we.person.countryName=De.label)}if(w&&se){let De=bc.find(({iso:Le})=>Le===se);De!=null&&De.iso2&&(we.person.iso2NationalityCode=De.iso2),De!=null&&De.label&&(we.person.countryName=De.label)}if(o){let De=k[ue],Le=O[ue];GU({scaleValue:De,eventType:$m,scaleType:Oc,participant:we,category:o}),GU({scaleValue:Le,eventType:$c,scaleType:Oc,participant:we,category:o});let ye=x[ue],Te=F[ue];GU({scaleValue:ye,eventType:$m,scaleType:Cd,participant:we,category:o}),GU({scaleValue:Te,eventType:$c,scaleType:Cd,participant:we,category:o})}return we}}function GU({scaleValue:t,participant:e,eventType:i,scaleType:r,category:n}){let a=n.categoryName||n.ratingType||n.ageCategoryCode,o=[Om,r,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function tte({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:r}){var n;let a=0,o=0,s=0,l=0,c={},u={[li]:0,[Si]:0,[oa]:0,[Kp]:0,[Qs]:0};i=typeof i=="object"?i:Hm({namedFormat:e}),(n=i==null?void 0:i.collectionDefinitions)==null||n.filter(Boolean).forEach(h=>{let{category:f,collectionId:g,matchUpType:v,matchUpCount:I,gender:y}=h;if([li,Si].includes(y)){let b=I*(v===ui?2:1);u[y]<b&&(u[y]=b)}else y===oa&&(u[li]<I&&(u[li]=I),u[Si]<I&&(u[Si]=I));if(f){let b=JSON.stringify(f);c[b]=f}if(g||(h.collectionId=Yt()),Bi(ui)(v)){let b=I;l+=I,a=Math.max(a,b)}if(Bi(Ni)(v)){let b=I;s+=I,o=Math.max(o,b)}});let d=Object.keys(c).length?Math.max(s,l*2):Math.max(o,a*2),p=a*(r+t),m=o*(r+t);return{maxDoublesDraw:p,maxSinglesDraw:m,teamSize:d,genders:u}}function CEe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:r,participantType:n=wt}=t||{},a=r||0,o={[Si]:0,[oa]:0,[Kp]:0,[li]:0,[Qs]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:h=0,uniqueParticipants:f,tieFormatName:g,drawSize:v=0,eventType:I,tieFormat:y,category:b,gender:S,stage:w})=>{let U=I===$o,T=I===yr,P=!!(f||w===qe||b||S);if(T){u=Math.max(u,v+h),y=typeof y=="object"?y:Hm({namedFormat:g});let{teamSize:R,maxDoublesDraw:D,maxSinglesDraw:E,genders:N}=tte({alternatesCount:h,tieFormatName:g,tieFormat:y,drawSize:v});c=Math.max(c,R),l=Math.max(l,E),P||(s=Math.max(s,D)),Object.keys(N).forEach(A=>o[A]+=N[A])}else if(U)if(P){let R=(v+h)*2;d+=R,S&&(o[S]+=R)}else v+h&&v+h>s&&(s=v+h);else if(P){let R=v+h;S&&(o[S]+=R),d+=R}else v&&v>l&&(l=v+h)};if(e==null||e.forEach(h=>{let{tieFormatName:f,tieFormat:g,drawProfiles:v,eventType:I,category:y,gender:b}=h;if(v)for(let S of v){let{tieFormatName:w,tieFormat:U}=S;p({...S,tieFormatName:w||f,tieFormat:U||g,eventType:I,category:y,gender:b})}}),Array.isArray(i))for(let h of i)p(h);let m=Math.max(u*c,s*2,l);return s&&(n=st),(r||a)<m&&(r=m),r&&s&&[st,yr].includes(n)&&(l&&Math.floor(l/2)>s?r=Math.floor(l/2):(!l||s*2>=l)&&(r=Math.ceil(r/2))),r===void 0&&(r=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),r<a&&(r=a),{uniqueParticipantsCount:d,participantsCount:r,largestTeamDraw:u,largestTeamSize:c,participantType:n,gendersCount:o}}function ite({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:r,startDate:n,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=CEe({participantsProfile:t,eventProfiles:i,drawProfiles:r}),d=t==null?void 0:t.teamKey,p=cU({uuids:a,...t,consideredDate:n,participantsCount:o,participantType:s,gendersCount:u}).participants,m=0,h=Ss({tournamentRecord:e,participants:p});if(h.error)return h;if(m+=h.addedCount,d){let I=F$({tournamentRecord:e,...d});if(I.error)return I}let f=p.filter(({participantType:I})=>I===wt).map(bt),g=t!=null&&t.idPrefix?`${ii}-${t.idPrefix}`:void 0,v=Ee(0,l).map(I=>{let y=f.slice(I*c,(I+1)*c),b=ZM({index:I,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${I+1}`,participantRole:en,individualParticipantIds:y,participantType:ii,participantId:b}});return h=Ss({participants:v,tournamentRecord:e}),h.error?h:(m+=h.addedCount,{addedCount:m,...Z})}function rte({drawProfiles:t,category:e,gender:i}){let r={},n=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=Oe,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let m=(c||p)-l;return u||i||e||d===qe?(Object.keys(r).includes(d)||(r[d]=0),r[d]+=m):o[d]=Math.max(o[d],m),o},{}),a=Object.keys(r);return a.forEach(o=>n[o]+=r[o]),{stageParticipantsCount:n,uniqueParticipantsCount:r,uniqueParticipantStages:a}}function nte({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:r}){let n=e[Oe]||0,a=e[qe]||0;return{stageParticipants:{QUALIFYING:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:r.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+n)}}}var MEe={[jt]:2,[ir]:1,[hr]:1,[dn]:1,[Ot]:4};function L$(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:r=MEe,matchUpFormat:n=Ka,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ia({matchUpFormat:n}))return{error:Kx};if(typeof r!="object")return{error:oe};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:oe};let s=Object.keys(r).filter(T=>Object.keys(q9).includes(T)&&T!==Zi);if(Object.keys(s).reduce((T,P)=>T+r[P],0)>100)return{error:oe,matchUpStatusProfile:r};let l=s.reduce((T,P)=>(T.pointer=T.pointer+r[P],T.valueMap.push([T.pointer,P]),T),{pointer:0,valueMap:[]}),c=Ha(1,100),u=(l.valueMap.find(T=>c<=T[0])??[100,Zi])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([jt,Ot].includes(u)){i=i||Ha(1,2);let T={score:d,winningSide:i,matchUpStatus:u};if(!(u===Ot&&Ha(1,100)>100-e))return{outcome:T}}else if([ir,hr].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=_n(n),{bestOf:m,setFormat:h,finalSetFormat:f}=p??{},g=[],v=Ha(0,1),I=i?[i-1]:[...Ee(0,o).map(()=>v),1-v],y=[dn,Ot,Xs,ld].includes(u)&&(ra(Ee(1,m))||1),b;for(let T of Ee(1,(m??0)+1)){let P=T===m,{set:R,incomplete:D,winningSideNumber:E}=NEe({incomplete:y===T,matchUpStatus:u,pointsPerMinute:a,setFormat:P&&f||h,setNumber:T,weightedRange:I});if(g.push(R),D){b=E;break}if(yy({matchUp:{score:{sets:g},matchUpFormat:n}}).calculatedWinningSide)break}let S=yy({matchUp:{score:{sets:g},matchUpFormat:n}}),w=b?i||b:S.calculatedWinningSide,{score:U}=$ee({score:{sets:g},winningSide:w,matchUpStatus:u});return{outcome:{score:U,winningSide:w,matchUpStatus:u}}}function NEe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:r,setFormat:n,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=n,m=Ha(0,t.length-1),h=t[m],f;if(d){let g=p*e,v=Math.round(g*.2),I=g+ra([1,-1])*v,y=ewe(I,2),b=[y,I-y];h&&b.reverse(),f=t[m]+1;let S=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(r){let[T,P]=b;return Object.assign(o,{side1Score:T,side2Score:P}),Sr.includes(i)?{set:o,incomplete:r,winningSideNumber:f}:{set:o,incomplete:r}}S||(b[Ha(0,1)]+=1),S=b[0]>b[1]?1:2,S!==f&&b.reverse();let[w,U]=b;return Object.assign(o,{side1Score:w,side2Score:U,winningSide:f}),{set:o}}else{if(r)return o.side1Score=Ha(0,c),o.side2Score=Ha(0,c),Sr.includes(i)&&(f=t[m]+1),{set:o,incomplete:r,winningSideNumber:f};{let g=Ee(1,s+1).map(U=>Ee(0,s+2-U).map(()=>U)).flat(),v=g[Ha(0,g.length-1)],I=s&&P_({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),y=!I,b=t.length===1&&t[m]+1;if(!y){b?(I[0]>I[1]?1:2)!==b&&I.reverse():h&&I.reverse();let[U,T]=I;Object.assign(o,{side1Score:U,side2Score:T})}let S=vy({matchUpScoringFormat:{setFormat:n},setObject:o}),w;if(S.hasTiebreakCondition||y){let{NoAD:U,tiebreakTo:T}=l||u||{},P=Ee(1,T+1).map(E=>Ee(0,T+2-E).map(()=>E)).flat(),R=P[Ha(0,P.length-1)],D=wR({isSide1:!0,tiebreakNoAd:U,tiebreakTo:T,lowValue:R});if(D)if(y){let E=D[0]>D[1]?1:2;b?E!==b&&D.reverse():h&&D.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=D,w=D[0]>D[1]&&1||D[1]>D[0]&&2||void 0}else S.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=D:[o.side2TiebreakScore,o.side1TiebreakScore]=D}o.winningSide=S.winningSide||S.leadingSide||b||w}}return{set:o}}function W0(t){var e,i,r;let{matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:c,event:u}=t;if(!c)return{error:Ce};let d=t.matchUpFormat||c.matchUpFormat||(u==null?void 0:u.matchUpFormat),p=c.structures.slice().sort(Rh),m=0,{matchUps:h,matchUpsMap:f}=cr({contextFilters:{stages:[Oe,qe]},matchUpFilters:{matchUpTypes:[di],roundNumbers:[1]},inContext:!0,drawDefinition:c});if(h!=null&&h.length){let I=((e=u==null?void 0:u.category)==null?void 0:e.ageCategoryCode)||((i=u==null?void 0:u.category)==null?void 0:i.categoryName);if(I){let y=gee({singlesOnly:!0,tournamentRecord:s,drawDefinition:c,scaleAccessor:{scaleName:I,sortOrder:fee,scaleType:Oc},event:u});if(y.error)return y;let{lineUps:b,participantsToAdd:S}=y;Ss({tournamentRecord:s,participants:S}),Mt({element:c,extension:{name:Pu,value:b}})}else{let y=(r=h[0])==null?void 0:r.structureId,{positionAssignments:b}=ei({drawDefinition:c,structureId:y});if(b!=null&&b.length){let{participants:S}=Wi({participantFilters:{participantTypes:[di]},tournamentRecord:s}),w=U=>{let T=U.tieMatchUps.filter(Bi(Ni)),P=U.tieMatchUps.filter(Bi(ui));T.forEach((R,D)=>{let E=R.matchUpId;R.sides.forEach(N=>{var A;let{drawPosition:M}=N,C=S==null?void 0:S.find(O=>{var k;let{participantId:x}=O;return((k=b.find(F=>F.participantId===x))==null?void 0:k.drawPosition)===M});if(C){let O=(A=C.individualParticipantIds)==null?void 0:A[D];O&&z0({teamParticipantId:C.participantId,participantId:O,tournamentRecord:s,drawDefinition:c,tieMatchUpId:E,event:u})}})}),P.forEach((R,D)=>{let E=R.matchUpId;R.sides.forEach(N=>{var A,M;let{drawPosition:C}=N,O=S==null?void 0:S.find(k=>{var x;let{participantId:F}=k;return((x=b.find($=>$.participantId===F))==null?void 0:x.drawPosition)===C});O&&((M=(A=O.individualParticipantIds)==null?void 0:A.slice(D*2,D*2+2))==null||M.forEach(k=>{z0({teamParticipantId:O.participantId,participantId:k,tournamentRecord:s,drawDefinition:c,tieMatchUpId:E,event:u})}))})})};h.forEach(w)}}}let g=typeof a=="string"&&a,v=g&&Zi;for(let I of p){if(m>=l)break;let{matchUps:y}=$t({matchUpFilters:{matchUpTypes:[ui,Ni]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:f,structure:I,event:u}),b=y.filter(({winningSide:S})=>!S).sort(Ah).map(wr);for(let S of b){if(!isNaN(l)&&m>=l)break;let{matchUps:w}=$t({matchUpFilters:{matchUpTypes:[ui,Ni]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:f,structure:I,event:u}),U=w.find(P=>P.matchUpId===S),T=[ir,hr].includes(U.matchUpStatus);if(U!=null&&U.readyToScore&&!T){let P=AEe({winningSide:!o&&1,matchUpStatusProfile:n,tournamentRecord:s,drawDefinition:c,targetMatchUp:U,matchUpFormat:d,matchUpStatus:v,scoreString:g,event:u});if(P!=null&&P.error)return P;m+=1}}}return{...Z,completedCount:m}}function ate(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:r,drawDefinition:n,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===Ft)return;let{matchUpId:d}=a||{},{outcome:p}=N$({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),oU({tournamentRecord:r,policyDefinitions:i,drawDefinition:n,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function AEe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:r,drawDefinition:n,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||a)return ate(t);let{matchUpId:d}=s||{},{outcome:p}=L$({matchUpStatusProfile:e,matchUpFormat:o,winningSide:c});return oU({policyDefinitions:r,tournamentRecord:i,drawDefinition:n,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function ote({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:r,drawProfiles:n,event:a}){var o,s,l,c;let u=Yi({event:a}).flightProfile,{eventName:d,eventType:p,category:m}=a,{startDate:h}=r,f=[],g=(m==null?void 0:m.categoryName)||(m==null?void 0:m.ageCategoryCode)||(m==null?void 0:m.ratingType),v=(o=a.drawDefinitions)==null?void 0:o.map(({drawId:I})=>I);if(Array.isArray(u==null?void 0:u.flights))for(let[I,y]of u.flights.entries()){let{drawId:b,stage:S,drawName:w,drawEntries:U}=y;f.push(y.drawId);let T=n[I],{seedsCount:P,generate:R=!0}=T||{};if(R){let D=U.filter(ga(Ll)).map(ga(Ll)),E=g||d;if(r&&P&&P<=D.length&&Ee(1,P+1).forEach((O,k)=>{let x={scaleValue:O,scaleName:E,scaleType:Tl,eventType:p,scaleDate:h},F=D[k];ug({tournamentRecord:r,participantId:F,scaleItem:x})}),v==null?void 0:v.includes(b))break;let N=xR({...T,matchUpType:p,seedingScaleName:E,tournamentRecord:r,isMock:!0,drawEntries:U,drawName:w,drawId:b,event:a,stage:S});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:A}=N;if(!A)return{error:ma};let M=(s=n[I])==null?void 0:s.drawExtensions;if(Array.isArray(M)&&M.filter(Js).forEach(O=>Mt({element:A,extension:O})),N=_R({suppressNotifications:!0,tournamentRecord:r,drawDefinition:A,event:a}),N.error)return{error:N.error,drawIds:[]};if(T!=null&&T.withPlayoffs){let O=(l=A.structures)==null?void 0:l[0].structureId,k=lR({idPrefix:T.idPrefix,...T.withPlayoffs,tournamentRecord:r,drawDefinition:A,isMock:!0,structureId:O,event:a});if(k!=null&&k.error)return k}let C=T==null?void 0:T.completionGoal;if((T==null?void 0:T.automated)!==!1&&(e||C)){let O=T==null?void 0:T.matchUpFormat,k=W0({completeAllMatchUps:!C&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,completionGoal:C,drawDefinition:A,matchUpFormat:O,event:a});if(k.error)return{error:k.error,drawIds:[]};let x=k.completedCount;if((T==null?void 0:T.drawType)===Hl){let F=(c=A.structures)==null?void 0:c.find(L=>L.stage===Oe);if(!F)return{error:Ri};let $=_w({structureId:F.structureId,tournamentRecord:r,drawDefinition:A,event:a});if($.error)return{error:$.error,drawIds:[]};let _=C?C-(x??0):void 0;if($=W0({completeAllMatchUps:!C&&e,completionGoal:C?_:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:r,drawDefinition:A,matchUpFormat:O,event:a}),$.error)return{error:$.error,drawIds:[]}}}}}return{...Z,drawIds:f}}function ste(t){var e,i;let{participantsProfile:r={},uniqueParticipantsCount:n,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:c,uuids:u}=t,{category:d,gender:p,eventType:m}=c,h=Bi(Wl)(m)&&wt||Bi($o)(m)&&st||m,f=n[Oe]||0,g=n[qe]||0,v=(e=s.drawProfiles)!=null&&e.length?f+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,I=[li,Si].includes(p)?p:void 0,y=r!=null&&r.idPrefix?`E-${l}-${r==null?void 0:r.idPrefix}`:void 0,{participants:b}=cU({uuids:s.uuids||u,...r,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:h,participantsCount:v,ratingsParameters:a,category:d,idPrefix:y,sex:I}),S=Ss({tournamentRecord:o,participants:b});if(S.error)return S;let w=b==null?void 0:b.filter(({participantType:T})=>T===h),U=b==null?void 0:b.map(bt);return{uniqueDrawParticipants:w,uniqueParticipantIds:U}}function OEe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:r,event:n}){let{drawType:a=Bs,qualifyingPositions:o=0,stage:s=Oe,drawSize:l=0,drawName:c,drawId:u}=r,d=l-o,p=i.slice(0,d).map(bt);if(p.length){let f=Rl({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:n});if(f.error)return f}let m=p.map(f=>({entryStatus:Ma,entryStage:s,participantId:f})),h=BR({drawName:c||a,qualifyingPositions:o,drawEntries:m,drawId:u,event:n,stage:s});return h.error?h:{...Z}}function lte({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:r,drawProfiles:n,category:a,gender:o,event:s}){let l=0;for(let c of n){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=Oe,drawSize:m=0}=c,h=m-u,f=d||o||a||p===qe,g=f?t.slice(l,l+h):i[p||Oe]||[];f&&(l+=h);let v=OEe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:r,drawProfile:c,event:s});if(v.error)return v}return{...Z}}function ute(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:r,participantsProfile:n,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,publish:m,isMock:h,uuids:f}=t,g=d.gender,v=d.eventName,{eventType:I=Wl,policyDefinitions:y,drawProfiles:b=[],eventExtensions:S,surfaceCategory:w,tieFormatName:U,processCodes:T,discipline:P,eventLevel:R,timeItems:D,ballType:E,category:N}=d,A=d.eventId||Yt(),M=d.tieFormat||(I===yr?Hm({namedFormat:U,event:{eventId:A,category:N,gender:g},hydrateCollections:s,isMock:h}):void 0),C=u.participants;for(let Y of b)!g&&Y.gender&&(g=Y==null?void 0:Y.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:k,uniqueParticipantStages:x}=rte({drawProfiles:b,category:N,gender:g}),F=Bi(Wl)(I)&&wt||Bi($o)(I)&&st||I,{uniqueDrawParticipants:$=[],uniqueParticipantIds:_=[]}=x?ste({event:{eventType:I,category:N,gender:g},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,uuids:f}):{},{eventAttributes:L}=d;typeof L!="object"&&(L={});let B=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||B||"Generated Event";let V={...L,surfaceCategory:w,processCodes:T,discipline:P,eventLevel:R,eventName:v,eventType:I,tieFormat:M,ballType:E,category:N,eventId:A,gender:g};if(S!=null&&S.length&&Array.isArray(S)){let Y=S.filter(Js);Y!=null&&Y.length&&Object.assign(V,{extensions:Y})}if(Array.isArray(D)&&D.forEach(Y=>_h({event:H,timeItem:Y})),typeof y=="object")for(let Y of Object.keys(y))rp({policyDefinitions:{[Y]:y[Y]},event:V});V.category&&(V.category.categoryName=B);let G,j=rU({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:V});if(j.error)return j;let H=j==null?void 0:j.event,{stageParticipants:W}=nte({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:F,targetParticipants:C});if(b!=null&&b.length){let Y=lte({uniqueDrawParticipants:$,autoEntryPositions:o,stageParticipants:W,tournamentRecord:u,drawProfiles:b,category:N,gender:g,event:H});if(Y.error)return Y;let q=ote({matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawProfiles:b,event:H});if(q.error)return q;G=q.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let Y=$.map(bt);if(Y.length){let q=Rl({participantIds:Y,autoEntryPositions:o,tournamentRecord:u,entryStage:Oe,event:H});if(q.error)return q}}return m&&Cv({tournamentRecord:u,event:H}),{drawIds:G,eventId:A,uniqueParticipantIds:_}}function _$({tournamentRecords:t,scheduleDate:e,venueId:i,round:r}){if(!Da(e))return{error:Tn};let n="addSchedulingProfileRound",{extension:a}=ft({name:Fm,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>Bl(e,p.scheduleDate));if(!s){let{startDate:p,endDate:m}=TR({tournamentRecords:t}),h=new Date(e);if(p&&h<new Date(p)||m&&h>new Date(m))return{error:Tn};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(m=>!c.includes(m)).sort().map(m=>Ii(p[m])?u(p[m]):p[m]).flat().join("|");if(l.rounds.find(p=>u(p)===u(r)))return ee({result:{error:oK},stack:n});l.rounds.push(r);let d=Rv({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...Z}}function kEe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:oe};let i=gv({tournamentRecord:e}).containedStructures,r=Lr({tournamentRecord:e}).matchUps??[],{tournamentId:n}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:m,winnerFinishingPositionRange:h,roundSegment:f}=p,g=r.filter(v=>{var I;let y=(h==null?void 0:h.indexOf("-"))>0&&h.split("-").map(S=>+S),b=(I=v.finishingPositionRange)==null?void 0:I.winner;return v.drawId===m&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||Hi(b,y).length===2||ht(b).length===ht(y).length&&Hi(b,y).length===ht(b).length)})[0];if(g){let{eventId:v,roundNumber:I,drawName:y,structureName:b,roundName:S}=g,w=g.structureId;I&&!h&&(w=Object.keys(i).find(P=>i[P].includes(w))??w);let U={tournamentId:n,structureId:w,roundNumber:I,roundSegment:f,eventId:v,drawId:m},T=_$({tournamentRecords:{[n]:e},round:U,scheduleDate:s,venueId:d});if(T.error)return T;a.push({structureName:b,roundName:S,drawName:y,...U})}}}}return{scheduledRounds:a}}function ZR(t){var e,i,r;let n=kt(t,[{drawProfile:!0,_ofType:Ql}]);if(n.error)return n;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:c,hydrateCollections:u,randomWinningSide:d,ratingsParameters:p,tournamentRecord:m,isMock:h=!0,drawProfile:f,startDate:g,drawIndex:v,uuids:I}=t,y=Fe(f,!1,!0),{excessParticipantAlternates:b=!0,matchUpFormat:S=Ka,drawType:w=Bs,tournamentAlternates:U=0,alternatesCount:T=0,qualifyingPositions:P,qualifyingProfiles:R,generate:D=!0,eventExtensions:E,drawExtensions:N,completionGoal:A,tieFormatName:M,seedsCount:C,timeItems:O,drawName:k,category:x,idPrefix:F,publish:$,gender:_,stage:L}=y,B=y.drawSize||(y.ignoreDefaults?void 0:32),V=y.eventId||Yt(),G=f.eventType||f.matchUpType||Wl,j=G===$o?st:wt,H=typeof f.tieFormat=="object"&&f.tieFormat||G===ii&&Hm({event:{eventId:V,category:x,gender:_},namedFormat:M,hydrateCollections:u,isMock:h})||void 0,W=(x==null?void 0:x.categoryName)||(x==null?void 0:x.ageCategoryCode)||(x==null?void 0:x.ratingType),Y=f.eventName||W||`Generated ${G}`,q=(m==null?void 0:m.participants)||[],re=((R==null?void 0:R.map(de=>de.structureProfiles||[]).flat().reduce((de,Ie)=>{let me=!Ie.participantsCount||Ie.participantsCount>Ie.drawSize?Ie.drawSize:Ie.participantsCount||0;return de+me},0))||0)*(j===st?2:1),K=(!f.participantsCount||f.participantsCount>B?B:f.participantsCount)||0,z={eventName:Y,eventType:G,tieFormat:H,category:x,eventId:V,gender:_};Array.isArray(O)&&O.forEach(de=>_h({event:z,timeItem:de}));let{eventAttributes:te}=f;if(typeof te!="object"&&(te={}),Object.assign(z,te),(E==null?void 0:E.length)&&Array.isArray(E)){let de=E.filter(Js);de!=null&&de.length&&Object.assign(z,{extensions:de})}let J=[];if(re||f.uniqueParticipants||!m||_||x){let de=(K||0)+T+re,Ie=de,me={[li]:0,[Si]:0},Me,be;G===ii&&({teamSize:Me,genders:be}=tte({alternatesCount:T,tieFormatName:M,tieFormat:H,drawSize:B}),Object.keys(be).forEach(se=>{[li,Si].includes(se)&&be[se]&&(me[se]=B*be[se])}),Ie=Me*((B||0)+re));let _e=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,Ne=cU({...o,scaledParticipantsCount:f.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:Ie,consideredDate:m==null?void 0:m.startDate,sex:_||(o==null?void 0:o.sex),rankingRange:f.rankingRange,uuids:f.uuids||I,ratingsParameters:p,participantType:j,gendersCount:me,idPrefix:_e,category:x}).participants;if(z.category&&(z.category.categoryName=W),m){let se=Ss({participants:Ne,tournamentRecord:m});if(se.error)return se}if(Ne.forEach(({participantId:se})=>J.push(se)),q=Ne,G===ii){let se=be[li]?Ne.filter(({participantType:ve,person:qt})=>ve===wt&&(qt==null?void 0:qt.sex)===li).map(bt):[],ge=be[Si]?Ne.filter(({participantType:ve,person:qt})=>ve===wt&&(qt==null?void 0:qt.sex)===Si).map(bt):[],we=Ne.filter(({participantType:ve})=>ve===wt).map(bt).filter(ve=>!se.includes(ve)&&!ge.includes(ve)),De=Me-(be[li]+be[Si]),Le=0,ye=0,Te=0,Ze=Ee(0,de).map(ve=>{let qt=ge.slice(Le,Le+be[Si]),Xi=se.slice(ye,ye+be[li]),Ke=we.slice(Te,Te+De);return Le+=be[Si],ye+=be[li],Te+=De,{individualParticipantIds:[...qt,...Xi,...Ke],participantOtherName:`TM${ve+1}`,participantName:`Team ${ve+1}`,participantRole:en,participantType:ii,participantId:Yt()}}),je=Ss({participants:Ze,tournamentRecord:m});if(!je.success)return je;q=Ze}}let ie=de=>{let{participantType:Ie}=de;return Bi(Wl)(G)&&Ie===wt||Bi($o)(G)&&Ie===st?!0:G===ii&&Ie===ii},ne=de=>{var Ie,me;return!f.gender||((Ie=de.person)==null?void 0:Ie.sex)===f.gender?!0:(me=de.individualParticipantIds)==null?void 0:me.some(Me=>{let be=q.find(_e=>_e.participantId===Me);return be&&ne(be)})},ue=q.filter(ie).filter(ne).filter(({participantId:de})=>!a.includes(de)),ae=ue.slice(0,K).map(de=>de.participantId);if(h&&ae!=null&&ae.length){let de=Rl({autoEntryPositions:c,entryStage:L,tournamentRecord:m,participantIds:ae,event:z});if(de.error)return de}let ce=re?ue.slice(K,K+re).map(de=>de.participantId):0;if(h&&ce!=null&&ce.length){let de=0,Ie=1,me=(be,_e)=>be.stageSequence-_e.stageSequence,Me=(be,_e)=>be.roundTarget-_e.roundTarget;for(let be of R.sort(Me)){Ie=be.roundTarget||Ie;let _e=1,Ne;for(let se of be.structureProfiles.sort(me)){let ge=(se.drawSize||fF(se.participantsCount))-(Ne||0),we=ce.slice(de,de+ge),De=Rl({entryStage:qe,entryStageSequence:_e,autoEntryPositions:c,tournamentRecord:m,participantIds:we,roundTarget:Ie,event:z});if(De.error)return De;Ne=se.qualifyingPositions,de+=ge,_e+=1}Ie+=1}}let pe=b&&((e=m==null?void 0:m.participants)==null?void 0:e.filter(({participantId:de})=>!ae.includes(de)).filter(ie).filter(ne).slice(0,T||B-K||U).map(de=>de.participantId));if(h&&pe!=null&&pe.length){let de=Rl({participantIds:pe,autoEntryPositions:!1,entryStatus:Ro,tournamentRecord:m,event:z});if(de.error)return de.error}let Se=W||Y;m&&C&&C<=ae.length&&Ee(1,C+1).forEach((de,Ie)=>{let me={scaleName:Se,scaleDate:g,scaleType:fL,scaleValue:de,eventType:G},Me=ae[Ie];ug({tournamentRecord:m,participantId:Me,scaleItem:me})});let Be=xR({...Fe(f,!1,!0),tournamentRecord:m,seedingScaleName:Se,matchUpFormat:S,eventId:V,isMock:h,event:z});if(Be.error)return Be;if(!Be.drawDefinition)return{error:ma};let{drawDefinition:Pe}=Be,at=Pe.drawId;if(Array.isArray(N)&&N.filter(Js).forEach(de=>Mt({element:Pe,extension:de})),D){if(_R({drawDefinition:Pe,event:z,suppressNotifications:!0}),f.withPlayoffs){let Ie=(i=Pe.structures)==null?void 0:i[0].structureId,me=lR({...f.withPlayoffs,tournamentRecord:m,drawDefinition:Pe,structureId:Ie,idPrefix:F,isMock:h,event:z});if(me!=null&&me.error)return me}let de=f.automated===!1;if(h&&!de){let Ie=me=>{var Me;let be=W0({completeAllMatchUps:me.completeAllMatchUps,completionGoal:me.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:m,drawDefinition:Pe,matchUpFormat:S,event:z});if(be.error)return be;let _e=be.completedCount;if(w===Hl){let Ne=(Me=Pe.structures)==null?void 0:Me.find(we=>we.stage===Oe);if(!Ne)return{error:Ri};_w({structureId:Ne.structureId,tournamentRecord:m,drawDefinition:Pe,event:z});let se=A?A-(_e??0):void 0,ge=W0({completionGoal:A?se:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:m,drawDefinition:Pe,matchUpFormat:S,event:z});if(ge.error)return ge}};if(A&&Ie({completionGoal:A}),f.outcomes){let{matchUps:me}=Nn({inContext:!0,drawDefinition:Pe,event:z});for(let Me of f.outcomes){let{matchUpStatus:be=Zi,matchUpStatusCodes:_e,stageSequence:Ne=1,matchUpIndex:se=0,structureOrder:ge,matchUpFormat:we,drawPositions:De,roundPosition:Le,stage:ye=Oe,roundNumber:Te,winningSide:Ze,scoreString:je}=Me,ve=(me==null?void 0:me.reduce((At,Ei)=>{let{structureId:dr,matchUpId:mn}=Ei;return At[dr]?At[dr].push(mn):At[dr]=[mn],At},{}))??[],qt=Object.assign({},...Object.keys(ve).map((At,Ei)=>({[At]:Ei+1}))),Xi=(r=me==null?void 0:me.filter(At=>(!ye||At.stage===ye)&&(!Ne||At.stageSequence===Ne)&&(!Te||At.roundNumber===Te)&&(!Le||At.roundPosition===Le)&&(!ge||qt[At.structureId]===ge)&&(!De||Hi(De,At.drawPositions).length===2)))==null?void 0:r[se],Ke=ate({matchUpStatusCodes:_e,tournamentRecord:m,drawDefinition:Pe,targetMatchUp:Xi,matchUpFormat:we,matchUpStatus:be,scoreString:je,winningSide:Ze});if(Ke!=null&&Ke.error)return Ke}}l&&Ie({completeAllMatchUps:l})}$&&Cv({tournamentRecord:m,event:z})}else{let de=BR({drawEntries:Pe.entries,drawName:k||w,qualifyingPositions:P,drawId:at,event:z,stage:L});if(de.error)return de}return{...Z,event:He(z),uniqueParticipantIds:J,targetParticipants:q,drawDefinition:Pe,eventId:V,drawId:at}}var cte=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),xEe=cte;function q0(t){return parseInt(t)}function HV({startTime:t="",endTime:e=""}={}){if(!t||!e||!Rd.test(t)||!Rd.test(e))return!1;let[i,r]=t.split(":").map(q0),[n,a]=e.split(":").map(q0);return n<i?!1:!(i===n&&a<r)}function FEe(t,e){let[i,r]=t.startTime.split(":").map(q0),[n,a]=e.startTime.split(":").map(q0);return i<n?-1:i>n?1:r<a?-1:r>a?1:0}function dte({dateAvailability:t}){if(!t)return{error:yK};if(!Array.isArray(t))return{error:gS};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let r of t){if(typeof r!="object")return{error:gS};let{date:n,startTime:a,endTime:o,bookings:s=[]}=r;if(!a||!o)return{error:gS};if(n&&!$l.test(n))return{error:Tn,dateAvailability:{date:n},info:e};if(!Rd.test(a))return{error:vo,dateAvailability:{startTime:a},info:i};if(!Rd.test(o))return{error:vo,dateAvailability:{endTime:o},info:i};if(a===o)return{error:vo,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!HV({startTime:a,endTime:o}))return{error:vo,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:f0};for(let l of s){if(typeof l!="object")return{error:f0};let{startTime:c,endTime:u}=l;if(!Rd.test(c))return{error:vo,booking:{startTime:c},info:i};if(!Rd.test(u))return{error:vo,booking:{endTime:u},info:i};if(c===u)return{error:vo,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!HV({startTime:c,endTime:u}))return{error:vo,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function QR({tournamentRecord:t,disableNotice:e,venueId:i,courtId:r,court:n}){let{venue:a}=Xu({tournamentRecord:t,venueId:i});if(!a)return{error:av};a.courts||(a.courts=[]);let o={...cte(),venueId:i,courtId:r};if(o.courtId||(o.courtId=Yt()),a.courts.some(s=>s.courtId===o.courtId))return{error:FK};{let s=((n==null?void 0:n.dateAvailability)||[]).map(u=>{var d;return{...u,date:ct(u.date),startTime:fi(u.startTime),endTime:fi(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:m,bookingType:h})=>({startTime:fi(p),endTime:fi(m),bookingType:h}))}}),l=Object.keys(o);for(let u of l)if(n!=null&&n[u])if(u==="dateAvailability"){let d=dte({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[u]=n[u];let c=o;return a.courts.push(c),e||Tt({payload:{venue:a,tournamentId:t.tournamentId},topic:Sp,key:a.venueId}),{...Z,court:Fe(o),venueId:i}}}function $$(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:rd};let r=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},n=[],a;for(let o of Object.values(r)){let{venue:s}=Xu({tournamentRecord:o,venueId:i});if(s){let l=LEe({...t,tournamentRecord:o});for(let c of(l==null?void 0:l.courts)??[])n.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...Z,courtIds:n}:{error:av}}function LEe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:r,courtNames:n=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:rd};let m=Xu({tournamentRecord:r,venueId:d});if(m.error)return m;let{venue:h}=m;if(!ki(o)||!n)return{error:xK};o=o??n.length;let f=Ee(0,o).map(g=>{let v=a==null?void 0:a[g],I=v?p.map(y=>({date:us(y),startTime:s,endTime:c,...v})):e;return v&&s&&c&&I.push({startTime:s,endTime:c}),{courtName:n[g]||i&&(h==null?void 0:h.venueAbbreviation)&&`${h==null?void 0:h.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:I}}).map((g,v)=>{let I=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return QR({disableNotice:!0,tournamentRecord:r,courtId:I,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return f.length!==o?ee({info:"not all courts could be generated",result:{error:oe}}):(h&&Tt({payload:{venue:h,tournamentId:r.tournamentId},topic:Sp,key:h.venueId}),{...Z,courts:Fe(f)})}function pte({tournamentRecord:t,venueProfiles:e,uuids:i}){let{startDate:r,endDate:n}=t,a=[];for(let[o,s]of e.entries()){let{venueAbbreviation:l,venueId:c=(i==null?void 0:i.pop())??Yt(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:m,courtsCount:h,courtNames:f,venueName:g,idPrefix:v,courtIds:I}=s,y={venueName:g||`Venue ${o+1}`,venueAbbreviation:l,venueId:c},b=Dw({tournamentRecord:t,venue:y});if(b.error)return b;a.push(c);let S=Kf(r,n),w=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(S.map(T=>({date:us(T),startTime:d,endTime:p}))),U=$$({dateAvailability:u||w,tournamentRecord:t,courtTimings:m,courtsCount:h,courtNames:f,startTime:d,idPrefix:v,courtIds:I,endTime:p,venueId:c,dates:S});if(U.error)return U}return a}var _Ee=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function mte(t){let{tournamentAttributes:e,startDate:i,endDate:r}=t??{},{tournamentName:n=ra(_Ee),ratingsParameters:a=Ta,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:c,participantsProfile:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:m,policyDefinitions:h,schedulingProfile:f,periodLength:g,autoSchedule:v,eventProfiles:I,venueProfiles:y,drawProfiles:b,uuids:S}=t??{};if(i&&!Da(i)||r&&!Da(r))return{error:Tn};if(I&&!Array.isArray(I))return{error:oe};if(!i){let A=new Date;i=us(r??A),r=us(A.setDate(A.getDate()+7))}if(!r){let A=new Date(i);r=us(A.setDate(A.getDate()+7))}typeof e!="object"&&(e={});let w=Kee({...e,tournamentName:n,isMock:!0,startDate:i,endDate:r});if(s!=null&&s.length&&Array.isArray(s)){let A=s.filter(M=>Js({extension:M}));A!=null&&A.length&&Object.assign(w,{extensions:A,isMock:!0})}if(typeof h=="object")for(let A of Object.keys(h))rp({policyDefinitions:{[A]:h[A]},tournamentRecord:w});let U=ite({participantsProfile:u,tournamentRecord:w,eventProfiles:I,drawProfiles:b,startDate:i,uuids:S});if(!U.success)return U;let T=[],P=[],R=[];if(Array.isArray(b)){let A=0;for(let M of b){let C=ZR({allUniqueParticipantIds:T,matchUpStatusProfile:l,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,participantsProfile:u,randomWinningSide:m,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:M,startDate:i,drawIndex:A,uuids:S});if(C.error)return C;let{drawId:O,eventId:k,event:x,uniqueParticipantIds:F}=C;if(C=rU({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:x}),C.error)return C;O&&R.push(O),P.push(k),F!=null&&F.length&&T.push(...F),A+=1}}if(I){let A=0;for(let M of I){let C=ute({allUniqueParticipantIds:T,matchUpStatusProfile:l,participantsProfile:u,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:m,ratingsParameters:a,tournamentRecord:w,eventProfile:M,eventIndex:A,startDate:i,uuids:S});if(C.error)return C;let{eventId:O,drawIds:k,uniqueParticipantIds:x}=C;k&&R.push(...k),P.push(O),x!=null&&x.length&&T.push(...x),A+=1}}let D=y!=null&&y.length?pte({tournamentRecord:w,venueProfiles:y,uuids:S}):[],E,N={};if(f){let A=kEe({schedulingProfile:f,tournamentRecord:w});if(A.error)return A;if(E=A.scheduledRounds,v){let{tournamentId:M}=w,C={[M]:w};N=XR({scheduleCompletedMatchUps:o,tournamentRecords:C,periodLength:g})}}return IF(),He({...Z,tournamentRecord:w,scheduledRounds:E,schedulerResult:N,eventIds:P,venueIds:D,drawIds:R})}var hte={};yt(hte,{anonymizeTournamentRecord:()=>fte,modifyTournamentRecord:()=>gte});function fte({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:r,personIds:n=[],tournamentId:a}){var o,s,l,c,u;if(!i)return{error:he};let d=Array.isArray(t)?eV.concat(...t):eV,p=L=>{var B;return Array.isArray(t)?(B=L==null?void 0:L.extensions)==null?void 0:B.filter(V=>d.includes(V.name)):L==null?void 0:L.extensions},m={};i.extensions=p(i);let h=a||Yt();m[i.tournamentId]=h,i.tournamentId=h,i.createdAt=new Date().toISOString(),i.tournamentName=r||`Anonymized: ${us(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let L of i.participants||[]){let B=Yt();m[L.participantId]=B,L.participantId=B}for(let L of i.participants||[])Array.isArray(L.individualParticipantIds)&&(L.individualParticipantIds=L.individualParticipantIds.map(B=>m[B]));let f=0;for(let L of i.venues||[]){L.extensions=p(L),L.venueName=`Venue #${f}`,L.venueAbbreviation=`V${f}`;let B=Yt();m[L.venueId]=B,L.isMock=!0,f+=1}let g=1;for(let L of i.events||[]){L.extensions=p(L),L.isMock=!0;let B=Yt();m[L.eventId]=B,L.eventId=B;let V=((o=L.category)==null?void 0:o.categoryName)||((s=L.category)==null?void 0:s.ageCategoryCode)||((l=L.category)==null?void 0:l.ratingType)||L.gender;if(L.eventName=`Event ${g} ${V}`,Array.isArray(L.entries))for(let j of L.entries)j.participantId=m[j.participantId];for(let j of L.drawDefinitions||[]){j.extensions=p(j);let H=Yt();if(m[j.drawId]=H,j.drawId=H,j.isMock=!0,Array.isArray(j.entries))for(let Y of j.entries)Y.participantId=m[Y.participantId];let W=Y=>{Y.extensions=p(Y);let q=Yt();m[Y.structureId]=q,Y.structureId=q;for(let re of Y.positionAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of Y.seedAssignments||[])re.participantId&&(re.participantId=m[re.participantId]);for(let re of Y.matchUps||[]){re.isMock=!0;for(let K of re.sides||[])K.lineUp&&(K.lineUp=K.lineUp.map(({participantId:z,collectionAssignments:te})=>({participantId:m[z],collectionAssignments:te})))}};for(let Y of j.structures||[])if(W(Y),Array.isArray(Y.structures))for(let q of Y.structures)W(q);for(let Y of j.links||[])Y.source.structureId=m[Y.source.structureId],Y.target.structureId=m[Y.target.structureId]}let{extension:G}=ft({name:Fo,element:L});Array.isArray((c=G==null?void 0:G.value)==null?void 0:c.flights)&&((u=G==null?void 0:G.value.flights)==null||u.forEach(j=>{if(j.drawId=m[j.drawId],Array.isArray(j.drawEntries))for(let H of j.drawEntries)H.participantId=m[H.participantId]})),g+=1}let v=i.startDate||us(new Date),I=(i.participants||[]).filter(({participantType:L})=>L===wt),y=I.reduce((L,B)=>{var V;let G=(V=B.person)==null?void 0:V.sex;return[li,Si].includes(G)?L[G]+=1:L[Kp]+=1,L},{[li]:0,[Si]:0,[Kp]:0}),b=Object.assign({},...Object.keys(y).map(L=>{var B;return{[L]:((B=ete({category:{ageCategoryCode:"O18"},count:y[L],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:L}))==null?void 0:B.persons)||[]}})),S={[li]:0,[Si]:0,[Kp]:0},w=I.length,U=I.reduce((L,B)=>{var V,G;let j=((G=(V=B.person)==null?void 0:V.addresses)==null?void 0:G[0])||{},{city:H,state:W,postalCode:Y}=j;return L.cities.includes(H)||L.cities.push(H),L.states.includes(W)||L.states.push(W),L.postalCodes.includes(Y)||L.postalCodes.push(Y),L},{cities:[],postalCodes:[],states:[]}),T=U.postalCodes.length,P=U.cities.length,R=U.states.length,{cities:D}=Jee({count:P||w,participantsCount:w}),{states:E}=Xee({count:R||w,participantsCount:w}),{postalCodes:N}=Zee({count:T||w,participantsCount:w}),A={cities:D,states:E,postalCodes:N};I.forEach((L,B)=>{var V,G;let j=L==null?void 0:L.person,H=(j==null?void 0:j.sex)||Kp,W=(V=ct(j==null?void 0:j.birthDate))==null?void 0:V.split("-")[0],Y=S[H],q=b[H][Y];if(S[H]+=1,W){let[,re,K]=((G=q==null?void 0:q.birthDate)==null?void 0:G.split("-"))||[],z=[W,re,K].join("-");q.birthDate=z}if(j!=null&&j.addresses){let re=Qee({...A,participantIndex:B,nationalityCode:q.nationalityCode});q.addresses=[re]}q.personId=(n==null?void 0:n[B])||Yt(),e?(q.standardFamilyName=q.lastName,q.standardGivenName=q.firstName,L.participantName=`${q.standardGivenName} ${q.standardFamilyName}`):(q.standardFamilyName=j==null?void 0:j.standardFamilyName,q.standardGivenName=j==null?void 0:j.standardGivenName),delete q.firstName,delete q.lastName,q.extensions=p(j),L.person=q,m[j==null?void 0:j.personId]=q.personId}),(i.participants||[]).filter(({participantType:L})=>L===st).forEach(L=>{let{individualParticipantIds:B}=L;L.participantName=$Ee({individualParticipantIds:B,individualParticipants:I})});let M=(i.participants||[]).filter(({participantType:L})=>L===ii),C=M.length,O=XM({count:C}).names;M.forEach((L,B)=>{L.participantName=O[B]});let k=(i.participants||[]).filter(({participantType:L})=>L===_a),x=k.length,F=XM({count:x,nameRoot:"Group"}).names;k.forEach((L,B)=>{L.participantName=F[B]});let{extension:$}=ft({element:i,name:Fm});Array.isArray($==null?void 0:$.value)&&($==null||$.value.forEach(L=>{L.tournamentId=m[L.tournamentId],L.structureId=m[L.structureId],L.eventId=m[L.eventId],L.drawId=m[L.drawId]}));let{extension:_}=ft({element:i,name:pv});return Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(L=>{L.personId=m[L.personId]})),{...Z}}function $Ee({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:r})=>t.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function gte(t){var e,i,r;let{ratingsParameters:n=Ta,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,schedulingProfile:d,tournamentRecord:p,eventProfiles:m,periodLength:h,venueProfiles:f,autoSchedule:g,drawProfiles:v,uuids:I}=t;if(!p)return{error:he};let y=[],b=[],S=[];m==null||m.forEach(D=>{var E;let N=(E=p.events)==null?void 0:E.find((A,M)=>D.eventIndex!==void 0&&M===D.eventIndex||D.eventName&&A.eventName===D.eventName||D.eventId&&A.eventId===D.eventId);N!=null&&N.gender&&(D.gender=N.gender)});let w=((e=p.participants)==null?void 0:e.length)||void 0;w&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${w}`);let U=ite({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:m,drawProfiles:v,uuids:I});if(!U.success)return U;if(m){let D=((i=p.events)==null?void 0:i.length)||0;for(let E of m){let{ratingsParameters:N}=E,A=(r=p.events)==null?void 0:r.find((M,C)=>E.eventIndex!==void 0&&C===E.eventIndex||E.eventName&&M.eventName===E.eventName||E.eventId&&M.eventId===E.eventId);if(A){let{gender:M,category:C,eventType:O}=A,{drawProfiles:k,publish:x}=E,F=Bi(Wl)(O)&&wt||Bi($o)(O)&&st||O;if(k){let{stageParticipantsCount:$,uniqueParticipantsCount:_,uniqueParticipantStages:L}=rte({drawProfiles:k,category:C,gender:M}),{uniqueDrawParticipants:B=[],uniqueParticipantIds:V=[]}=L?ste({event:{eventType:O,category:C,gender:M},uniqueParticipantsCount:_,participantsProfile:a,ratingsParameters:N,tournamentRecord:p,eventProfile:E,uuids:I}):{};y.push(...V);let{stageParticipants:G}=nte({targetParticipants:p.participants||[],allUniqueParticipantIds:y,stageParticipantsCount:$,eventParticipantType:F}),j=lte({uniqueDrawParticipants:B,autoEntryPositions:l,stageParticipants:G,tournamentRecord:p,drawProfiles:k,category:C,gender:M,event:A});if(j.error||(j=ote({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:u,tournamentRecord:p,drawProfiles:k,event:A}),j.error))return j;S.push(...j.drawIds)}x&&Cv({tournamentRecord:p,event:A})}else{let M=ute({startDate:p.startDate,allUniqueParticipantIds:y,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:u,ratingsParameters:N,tournamentRecord:p,eventProfile:E,eventIndex:D,uuids:I});if(M.error)return M;let{eventId:C,drawIds:O,uniqueParticipantIds:k}=M;O&&S.push(...O),b.push(C),k!=null&&k.length&&y.push(...k),D+=1}}}if(v){let D=(p.events||[]).map(E=>{var N;return((N=E.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((E,N)=>E+N,0);for(let E of v){let N=ZR({startDate:p.startDate,allUniqueParticipantIds:y,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,ratingsParameters:n,tournamentRecord:p,drawProfile:E,drawIndex:D,uuids:I});if(N.error)return N;let{drawId:A,eventId:M,event:C,uniqueParticipantIds:O}=N;if(N=rU({tournamentRecord:p,event:C,internalUse:!0}),N.error)return N;A&&S.push(A),b.push(M),O!=null&&O.length&&y.push(...O),D+=1}}let T=f!=null&&f.length?pte({tournamentRecord:p,venueProfiles:f}):[],P,R={};if(d!=null&&d.length){let D={[p.tournamentId]:p},E=Rv({tournamentRecords:D,schedulingProfile:d});if(E.error)return E;if(g){let{tournamentId:N}=p,A={[N]:p};R=XR({tournamentRecords:A,periodLength:h})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:P,schedulerResult:R,...Z,eventIds:b,venueIds:T,drawIds:S}}var vte={};yt(vte,{addIndividualParticipantIds:()=>HR,addParticipant:()=>il,addParticipants:()=>Ss,addPenalty:()=>Lte,addPersonRequests:()=>Ste,addPersons:()=>_te,createGroupParticipant:()=>Cte,createTeamsFromParticipantAttributes:()=>F$,deleteParticipants:()=>kh,filterParticipants:()=>Aw,findParticipant:()=>Ete,getCompetitionParticipants:()=>M_,getPairedParticipant:()=>Bo,getParticipantEventDetails:()=>N_,getParticipantMembership:()=>A_,getParticipantScaleItem:()=>lg,getParticipantSchedules:()=>O_,getParticipantSignInStatus:()=>k_,getParticipantTimeItem:()=>SL,getParticipants:()=>Wi,getScaleValues:()=>uv,mergeParticipants:()=>Fte,modifyIndividualParticipantIds:()=>Tte,modifyParticipant:()=>zR,modifyParticipantName:()=>Mte,modifyParticipantOtherName:()=>Pte,modifyParticipantsSignInStatus:()=>Dte,modifyPenalty:()=>kte,modifyPersonRequests:()=>wte,mutate:()=>Ite,participantScaleItem:()=>Pl,query:()=>TQ,regenerateParticipantNames:()=>Rte,removeIndividualParticipantIds:()=>ML,removeParticipantIdsFromAllTeams:()=>XP,removePenalty:()=>Ate,removePersonRequests:()=>Ute,scaledTeamAssignment:()=>Nte,setParticipantScaleItem:()=>ug,setParticipantScaleItems:()=>xX,validateLineUp:()=>QP});var Ite={};yt(Ite,{addIndividualParticipantIds:()=>HR,addParticipant:()=>il,addParticipants:()=>Ss,addPenalty:()=>Lte,addPersonRequests:()=>Ste,addPersons:()=>_te,createGroupParticipant:()=>Cte,createTeamsFromParticipantAttributes:()=>F$,deleteParticipants:()=>kh,findParticipant:()=>Ete,mergeParticipants:()=>Fte,modifyIndividualParticipantIds:()=>Tte,modifyParticipant:()=>zR,modifyParticipantName:()=>Mte,modifyParticipantOtherName:()=>Pte,modifyParticipantsSignInStatus:()=>Dte,modifyPenalty:()=>kte,modifyPersonRequests:()=>wte,regenerateParticipantNames:()=>Rte,removeIndividualParticipantIds:()=>ML,removeParticipantIdsFromAllTeams:()=>XP,removePenalty:()=>Ate,removePersonRequests:()=>Ute,scaledTeamAssignment:()=>Nte,setParticipantScaleItem:()=>ug,setParticipantScaleItems:()=>xX});function yte(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function bte({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let r=i.filter(({requestType:n})=>n).map(n=>{let{date:a,startTime:o,endTime:s}=n;return n.requestType===lU&&(a=ct(a),o=fi(o),s=fi(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:n.requestType}:n}).filter(Boolean);for(let n of r)n.requestId=yte(),t[e].push(n);return{mergeCount:r.length}}function B$(t){let{tournamentRecords:e,personRequests:i}=t,r=kt(t,[{[sn]:!0}]);if(r.error)return r;if(!i)return{...Z};let n=Object.values(e);for(let a of n){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(kc({tournamentParticipants:o,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&Mt({element:a,extension:{value:s,name:pv}})}return{...Z}}function wte(t){let{tournamentRecords:e,requests:i,personId:r}=t,n=kt(t,[{[sn]:!0},{requests:!0,[ad]:Xn,[_l]:oe}]);if(n.error)return n;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:o}=kp({tournamentRecords:e}),s=c=>{o&&(o[c]=o[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(r&&o!=null&&o[r])s(r);else if(o)for(let c of Object.keys(o))s(c);let l=i.filter(c=>!c.requestId);return l.length&&bte({personRequests:o,personId:r,requests:l}),B$({tournamentRecords:e,personRequests:o})}function Ute(t){let{tournamentRecords:e,requestType:i,requestId:r,personId:n,date:a}=t,o=kt(t,[{[sn]:!0}]);if(o.error)return o;let{personRequests:s}=kp({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!r||p.requestId!==r)&&(!a||p.date!==a)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!r&&!n&&!a;if(!c){if(n&&s!=null&&s[n])l(n);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?In({name:pv,tournamentRecords:e,discover:!0}):B$({tournamentRecords:e,personRequests:s})}function Ste(t){let{tournamentRecords:e,personId:i,requests:r}=t,n=kt(t,[{[sn]:!0,[Iwe]:!0},{requests:!0,[ad]:Xn,[_l]:oe}]);if(n.error)return n;let{personRequests:a}=kp({tournamentRecords:e}),{mergeCount:o}=bte({personRequests:a,personId:i,requests:r});return o&&a?B$({tournamentRecords:e,personRequests:a}):{error:oe}}function Tte({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let r="modifyIndividualParticipantIds";if(!i)return ee({result:{error:he},stack:r});if(!e||!t)return ee({result:{error:Ve},stack:r});let n=i.participants||[],a=n.find(m=>m.participantId===e);if(!a)return ee({result:{error:Ji},stack:r});if(![ii,_a].includes(a.participantType))return ee({result:{error:bs},context:{participantType:a.participantType},stack:r});let o=t.filter(m=>{var h;return((h=n.find(f=>f.participantId===m))==null?void 0:h.participantType)!==wt});if(o.length)return ee({result:{error:Po,invalidParticipantIds:o},stack:r});let s=a.individualParticipantIds||[],l=t.filter(m=>!s.includes(m)),c=s.filter(m=>!t.includes(m)),u=HR({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return ee({result:u,stack:r});let d=ML({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ee({result:d,stack:r});let{topics:p}=qo();if(p.includes(Kr)){let m=n.find(({participantId:h})=>h===e);Tt({topic:Kr,payload:{tournamentId:i.tournamentId,participants:[m]}})}return{...u,...d}}function Dte({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:he};if(!Array.isArray(e))return{error:Ve};if(![uy,d8].includes(i))return{error:oe,signInState:i};let r=t.participants||[];if(!r.length)return{error:Qb};let n=r.map(bt),a=e.filter(c=>!n.includes(c));if(a.length)return{error:oe,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let c of r){let{participantId:u}=c;if(e.includes(u)){let d=GL({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:hw,itemValue:i,createdAt:s}});if(d.error)return d;o.push(c)}}let{topics:l}=qo();return o.length&&l.includes(Kr)&&Tt({topic:Kr,payload:{tournamentId:t.tournamentId,participants:o}}),{...Z}}function Pte({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:he};if(!e)return{error:vr};let{participant:r}=Mp({tournamentRecord:t,participantId:e});if(!r)return{error:Ji};r.participantOtherName=i;let{topics:n}=qo();return n.includes(Kr)&&Tt({topic:Kr,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Z}}function zV({personFormat:t,person:e}){let i=f=>f.replace(/\W/g,""),r=f=>/^[a-z]*$/.test(i(f)),n=f=>/^[A-Z]*$/.test(i(f)),a=f=>/^[LAST]{4}/.test(i(f)),o=f=>f.toLowerCase().indexOf("l")<f.toLowerCase().indexOf("f"),s=f=>f.indexOf(",")>=0,l=f=>f.toLowerCase().indexOf("f.")>=0,c=f=>f.toLowerCase().indexOf("f")<0,u=f=>f.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=TM((e==null?void 0:e.standardGivenName)??""),m=TM((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${m}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),r(t)?(p=p.toLowerCase(),m=m.toLowerCase()):n(t)?(p=p.toUpperCase(),m=m.toUpperCase()):a(t)&&(m=m.toUpperCase());let h=`${p}${d}${m}`;return c(t)?h=m:o(t)&&(s(t)?h=`${m},${d}${p}`:h=`${m}${d}${p}`),h}function BEe({participantMap:t,participant:e,formats:i}){let{participantType:r,individualParticipantIds:n,person:a}=e,o=r&&i[r];if(r!==Za&&o){let{personFormat:s,doublesJoiner:l}=o;r===wt&&(e.participantName=zV({person:a,personFormat:s})),r===st&&(e.participantName=n==null?void 0:n.map(c=>{var u;let d=(u=t[c])==null?void 0:u.person;return zV({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function Rte({tournamentRecord:t,formats:e}){if(!t)return{error:he};if(!Ii(e))return{error:Ve};let i=t.participants??[],r=q7(i,"participantId");for(let n of i)BEe({participant:n,participantMap:r,formats:e});return{...Z}}function Ete(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="string"&&typeof a!="string")return{error:Ve,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(o)){l=c.tournamentId;let u=c.participants||[];if(s=kc({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:r,participantId:n,personId:a}),s)break}return{participant:s,tournamentId:l,...Z}}function Cte({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=nJ,tournamentRecord:r,participantId:n,groupName:a}){if(!r)return{error:he};if(!a)return{error:Ve,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:oe};let o=(Wi({participantFilters:{participantTypes:[wt]},tournamentRecord:r}).participants??[]).map(u=>u.participantId);for(let u of t)if(!o.includes(u))return{error:bs,participantId:u};let s=He({participantId:n||Yt(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:_a,participantRole:i}),l=il({participant:s,tournamentRecord:r});if(l.error)return l;let{topics:c}=qo();return c.includes(Fc)&&Tt({topic:Fc,payload:{tournamentId:r.tournamentId,participants:[s]}}),{...Z,participant:Fe(s)}}function Mte({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:he};if(!i)return{error:vr};if(!e)return{error:Ve,info:"Missing participantName"};let{participant:r}=Mp({tournamentRecord:t,participantId:i});if(!r)return{error:Ji};r.participantName=e;let{topics:n}=qo();return n.includes(Kr)&&Tt({topic:Kr,payload:{tournamentId:t.tournamentId,participants:[r]}}),{...Z}}function Nte({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:r=0,scaledParticipants:n=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var p,m,h,f,g;if(!o)return{error:he};if(!Array.isArray(a)&&!nt(c)&&!u||!nt(r)||n&&!Array.isArray(n)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:oe};if(!s&&!n.length||!n&&!(e&&s))return{error:Ve,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==oo)return{error:Ac};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===Ma).map(bt)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:Ve};let v=e??n.map(({participantId:w})=>w);i&&(a==null||a.reverse(),r+=1),r>((a==null?void 0:a.length)||0)-1&&(r=0);let I=(a==null?void 0:a.slice(r).concat(...a.slice(0,r)))??[],y=[];for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(I.includes(U)){if(T!==Za)return{error:bs,participant:w};y.push(w)}}if(c&&y.length<c){let w=c-((y==null?void 0:y.length)||0),U=l??"Team",T=Ee(0,w).map(E=>({participantName:`${U} ${E+1}`,participantType:Za,participantRole:en})),{participants:P=[]}=Ss({participants:T,returnParticipants:!0,tournamentRecord:o}),R=P.map(bt),D=((m=o.participants)==null?void 0:m.filter(({participantId:E})=>R.includes(E)))??[];y.push(...D)}if(!y.length)return{error:cF};if(t)for(let w of y)w.individualParticipantIds=[];else{let w=y.map(U=>U).flat();e!=null&&e.length?v=v.filter(U=>!w.includes(U)):n=n==null?void 0:n.filter(({participantId:U})=>!w.includes(U))}if(!(e!=null&&e.length)&&!(n!=null&&n.length))return{error:bP,info:"Nothing to be done"};if(!n.length){for(let w of o.participants??[]){let{participantId:U,participantType:T}=w;if(!v.includes(U))continue;if(T!==wt)return{error:bs,participant:w};let P=(h=Pl({scaleAttributes:s,participant:w}))==null?void 0:h.scaleItem,R=s!=null&&s.accessor?(f=P==null?void 0:P.scaleValue)==null?void 0:f[s==null?void 0:s.accessor]:P==null?void 0:P.scaleValue,D={participantId:U,scaleValue:R};n.push(D)}if(!n.length)return{error:Ji}}n.sort((w,U)=>s!=null&&s.sortOrder?((U==null?void 0:U.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((U==null?void 0:U.scaleValue)||1/0));for(let w of n)if(!w.participantId)return{error:oe,scaledParticipant:w};let b=0;for(;b<n.length;){for(let w of y){if(b+1>n.length)break;let U=n[b];w.individualParticipantIds.push(U.participantId),b++}y.reverse()}let S=y.map(bt);for(let w of o.events??[]){if(w.eventType!==oo)continue;let U=(w.entries??[]).filter(T=>S.includes(T.participantId));for(let T of U){let P=T.participantId,R=(g=y.find(E=>E.participantId===P))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(E=>!R.includes(E.participantId)),(w.drawDefinitions??[]).forEach(E=>{E.entries=(E.entries??[]).filter(N=>!R.includes(N.participantId))});let{flightProfile:D}=Yi({event:w});((D==null?void 0:D.flights)||[]).forEach(E=>{E.drawEntries=(E.drawEntries||[]).filter(N=>!R.includes(N.participantId))})}}return{...Z,scaledParticipants:n}}function Ate(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ai};for(let i of Object.values(e)){let r=VEe({...t,tournamentRecord:i});if(r.error&&r.error!==qf)return r}return{...Z}}function VEe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:he};if(!e)return{error:aF};let i=(t==null?void 0:t.participants)??[],r=[],n=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,n||(a=l,n=!0)),s&&r.push(o),l.penaltyId!==e))}),a&&Tt({topic:Kr,payload:{tournamentId:t.tournamentId,participants:r}}),a?{...Z,penalty:a}:{error:qf}}var jEe=({penaltyId:t=Yt()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Ote=jEe;function kte(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Ai};for(let i of Object.values(e)){let r=GEe({...t,tournamentRecord:i});if(r.error&&r.error!==qf||r.success)return r}return{error:qf}}function GEe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:he};if(!e)return{error:oe,modifications:e};if(!i)return{error:aF};let r=(t==null?void 0:t.participants)??[],n=Object.keys(Ote()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>n.includes(l));if(!a.length)return{error:wP};let o,s=[];return r.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),o||(o=u)),u)),c&&s.push(l)}),o&&Tt({topic:Kr,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...Z,penalty:o}:{error:qf}}function xte(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ht(Object.keys(t).concat(Object.keys(e))).reduce((r,n)=>{if(!e[n])r[n]=t[n];else if(!t[n])r[n]=e[n];else if(typeof t[n]!=typeof e[n])r[n]=e[n];else if(Array.isArray(t[n]))if(i===!0||Array.isArray(i)&&i.includes(n)){let a=ht(t[n].map(o=>JSON.stringify(o)).concat(e[n].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));r[n]=a}else r[n]=e[n];else typeof t[n]=="object"?r[n]=xte(t[n],e[n],i):r[n]=e[n];return r},{})}function Fte({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:he};e.participants||(e.participants=[]);let r=t.filter(ga(Ll)).map(c=>({[c.participantId]:c})),n=Object.assign({},...r),a=[];e.participants=e.participants.map(c=>{if(n[c.participantId]){let u=xte(c,n[c.participantId],i);return a.push(u),u}return c});let o=e.participants.map(ga(Ll))||[],s=t.filter(({participantId:c})=>!o.includes(c)),{topics:l}=qo();return s.length&&(e.participants=e.participants.concat(...s),l.includes(Fc)&&Tt({topic:Fc,payload:{participants:s}})),a.length&&l.includes(Kr)&&Tt({topic:Kr,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...Z}}function Lte(t){var e;let{tournamentRecord:i,participantIds:r}=t,n=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(n)){let s=(e=Wi({tournamentRecord:o}).participants??[])==null?void 0:e.map(bt).filter(l=>r.includes(l));s.length&&(a=HEe({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...Z,penaltyId:a}:{error:Ji}}function HEe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:r,penaltyType:n,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:he};if(!i)return{error:vr};if(!n)return{error:kK};let u=((e==null?void 0:e.participants)??[]).filter(m=>i.includes(m.participantId));if(!u.length)return{error:Ji};let d=new Date().toISOString(),p=Object.assign(Ote({penaltyId:o}),{refereeParticipantId:t,penaltyCode:r,penaltyType:n,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(m=>Mt({element:p,extension:m})),u.forEach(m=>{m.penalties||(m.penalties=[]),m.penalties.push(p)}),Tt({topic:Kr,payload:{tournamentId:e.tournamentId,participants:u}}),{...Z,penaltyId:p.penaltyId}}function _te({participantRole:t=en,tournamentRecord:e,persons:i}){var r;if(!e)return{error:he};if(!Array.isArray(i))return{error:oe};if(!Object.keys(CL).includes(t))return{error:SK};let n=(e.participants||[]).map(({person:f})=>f==null?void 0:f.personId).filter(Boolean),a=[],o=i.filter(f=>f&&(!f.personId||!n.includes(f.personId))).map(f=>(f.personId||(f.personId=Yt()),a.push(f.personId),f)),s=(f,g)=>Object.assign({},...Object.keys(f).filter(v=>!g.includes(v)).map(v=>({[v]:f[v]}))),l=o.map(f=>He({extensions:f.participantExtensions,timeItems:f.participantTimeItems,participantType:wt,participantRole:t,person:s(f,["participantExtensions","participantTimeItems","pairedPersons"])})),c=0,u=0,d=Ss({participants:l,tournamentRecord:e});if(d.error)return d;u=d.addedCount||0;let p=[],m=((r=Wi({participantFilters:{participantTypes:[wt]},tournamentRecord:e}))==null?void 0:r.participants)??[];if(t===en&&i.filter(({pairedPersons:f})=>f).forEach(({personId:f,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let I=[f,v.personId].map(y=>kc({tournamentParticipants:m,personId:y})).filter(Boolean);if(I.length===2){let y=I.map(bt);p.push(He({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:en,individualParticipantIds:y,participantType:st}))}})}),p.length){if(d=Ss({participants:p,tournamentRecord:e}),d.error)return d;c=d.addedCount||0}let h=u+c;return{...Z,addedCount:h,newPersonIds:a}}var $te={};yt($te,{bulkUpdatePublishedEventIds:()=>V_,getAllEventData:()=>j_,getCourtInfo:()=>zP,getDrawData:()=>DR,getEventData:()=>PR,getEventPublishStatus:()=>mo,getPublishState:()=>Oh,getVenueData:()=>ag,mutate:()=>Bte,publishEvent:()=>Cv,publishEventSeeding:()=>Vte,publishOrderOfPlay:()=>Hte,query:()=>CQ,setEventDisplay:()=>$R,unPublishEvent:()=>zte,unPublishEventSeeding:()=>jte,unPublishOrderOfPlay:()=>Gte});var Bte={};yt(Bte,{publishEvent:()=>Cv,publishEventSeeding:()=>Vte,publishOrderOfPlay:()=>Hte,setEventDisplay:()=>$R,unPublishEvent:()=>zte,unPublishEventSeeding:()=>jte,unPublishOrderOfPlay:()=>Gte});function Vte({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:r,status:n=Xo,drawIds:a=[],event:o}){var s,l,c,u;if(!r)return{error:he};if(!o)return{error:Wt};let d=mo({event:o,status:n}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},m=(((c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames)||e)&&{...(u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames,...e},h=He({stageSeedingScaleNames:m,seedingScaleNames:p,published:!0,drawIds:a});return Ev({statusObject:{seeding:h},removePriorValues:t,status:n,event:o}),Tt({topic:o8,payload:{tournamentId:r.tournamentId,eventId:o.eventId,drawIds:a}}),{...Z}}function jte({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:r=Xo,drawIds:n,stages:a,event:o}){var s,l;if(!i)return{error:he};if(!o)return{error:Wt};let c=mo({event:o});if(c){let u=c.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&u!=null&&u.seedingScaleNames&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(n)&&u!=null&&u.drawIds&&(u.drawIds=u.drawIds.filter(d=>!n.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((s=u.seedingScaleNames)!=null&&s.length)&&!((l=u.drawIds)!=null&&l.length)||!a&&!e&&!(n!=null&&n.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),Ev({statusObject:{seeding:u},removePriorValues:t,status:r,event:o})}return Tt({topic:aL,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...Z}}function Gte(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:Ai};for(let i of Object.values(e)){let r=zEe({tournamentRecord:i,...t});if(r.error)return r}return{...Z}}function zEe({removePriorValues:t=!0,tournamentRecord:e,status:i=Xo}){if(!e)return{error:he};let r=`${Rp}.${Ep}`,{timeItem:n}=ul({element:e,itemType:r}),a=(n==null?void 0:n.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,ud({timeItem:{itemValue:a,itemType:r},element:e,removePriorValues:t}),Tt({topic:oL,payload:{tournamentId:e.tournamentId}}),{...Z}}function Hte(t){let e=ll(t);if(!Object.keys(e).length)return{error:Ai};for(let i of Object.values(e)){let r=WEe({tournamentRecord:i,...t});if(r.error)return r}return{...Z}}function WEe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:r=Xo,eventIds:n=[]}){if(!i)return{error:he};let a=`${Rp}.${Ep}`,{timeItem:o}=ul({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[r]:{}};return s[r].orderOfPlay={published:!0,scheduledDates:t,eventIds:n},ud({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),Tt({topic:s8,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:n}}),{...Z}}function zte({removePriorValues:t=!0,tournamentRecord:e,status:i=Xo,event:r}){if(!e)return{error:he};if(!r)return{error:Wt};let n=`${Rp}.${Ep}`,{timeItem:a}=Rw({itemType:n,event:r}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,_h({event:r,timeItem:{itemValue:o,itemType:n},removePriorValues:t}),Ev({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:r}),Tt({topic:nL,payload:{tournamentId:e.tournamentId,eventId:r.eventId}}),{eventId:r.eventId,...Z}}var Wte={};yt(Wte,{getEntryStatusReports:()=>YEe,getParticipantStats:()=>qEe,getStructureReports:()=>JEe,getVenuesReport:()=>ZEe});function qEe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:r,tournamentRecord:n,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,c,u,d,p;if(!n)return{error:he};if(s&&!Array.isArray(s))return{error:kn};if(s=s??Lr({tournamentRecord:n,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Xl};let m=[];e&&m.push(e),r&&m.push(r);let h=m.length?{participantIds:m}:{participantTypes:[Za]},f=Wi({participantFilters:h,tournamentRecord:n}).participants??[];if(!f.every(({participantType:E})=>E===Za))return{error:Po};m.length||m.push(...f.map(bt));let g=new Map,v=new Map,I=new Map,y=new Map,b=(E,N="")=>v.get(E)||v.set(E,{participantName:N,participantId:E,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(E);for(let E of f){let{participantId:N,individualParticipantIds:A}=E;y.set(N,A??[]),b(N,E.participantName)}if(r&&!y.get(r))return ee({result:{error:Ji},context:{teamParticipantId:r}});if(e&&!y.get(e))return ee({result:{error:Ji},context:{opponentParticipantId:e}});let S=[],w=E=>{let N=[[],[]];for(let M of E){let C=M.participant;if(C!=null&&C.participantName){g.set(C.participantId,{participantName:C.participantName,ratings:C.ratings});let O=v.get(C.participantId);O&&(O.participantName=C.participantName)}}let A=({side:M,individualParticipantIds:C})=>{var O,k,x,F,$;return M.participantId&&(!(C!=null&&C.length)||C.includes(M.participantId))&&[M.participantId]||((k=(O=M.participant)==null?void 0:O.individualParticipantIds)==null?void 0:k.length)&&(!(C!=null&&C.length)||Hi(C,(x=M.participant)==null?void 0:x.individualParticipantIds).length===(($=(F=M.participant)==null?void 0:F.individualParticipantIds)==null?void 0:$.length))&&M.participant.individualParticipantIds};if(y.size){let M=(C,O)=>{for(let k of E){if(!k.participant)continue;let x=A({individualParticipantIds:O,side:k});if(x!=null&&x.length){let F=k.sideNumber;if(!F)continue;let $=[C];i&&$.push(...x),N[F-1]=$;let _=v.get(C);for(let L of x.filter(Boolean))_&&!_.competitorIds.includes(L)&&_.competitorIds.push(L)}}};if(r)(!e||E.every(C=>C.participant&&(A({individualParticipantIds:y.get(r),side:C})||A({individualParticipantIds:y.get(e),side:C}))))&&M(r,y.get(r));else for(let[C,O]of y)M(C,O)}else if(i)for(let M of E){if(!M.participant)continue;let C=A({individualParticipantIds:[],side:M}),O=M.sideNumber;O&&(N[O-1]=C)}return N};for(let E of s){if(!Ii(E))return{error:kn};let{matchUpStatus:N,matchUpFormat:A,matchUpType:M,winningSide:C,score:O,sides:k}=E;if(!k||!O||M===Zs||N===Ft)continue;let x=w(k);if(!x.filter(Boolean).length)continue;let F=t&&C&&((l=Uw({matchUp:E}))==null?void 0:l.competitiveness);S.push(E);let $=KL({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),_=YJ({matchUpStatus:N,matchUpFormat:A,tallyPolicy:o,winningSide:C,score:O}),{pointsTally:L,tiebreaksTally:B}=KJ({matchUpFormat:A,score:O});x.forEach((V,G)=>{var j;for(let H of V){let W=(j=g.get(H))==null?void 0:j.participantName,Y=b(H,W);if(Y){let q=(J,ie)=>ie.forEach((ne,ue)=>Y[J][ue]+=ne),re=G?[...B].reverse():B,K=G?[...L].reverse():L,z=G?[..._].reverse():_,te=G?[...$].reverse():$;if(q("tiebreaks",re),q("points",K),q("games",z),q("sets",te),C){let J=C-1===G?0:1;Y.matchUps[J]+=1}if(F){let J=F.toLowerCase();Y.competitiveness[J]||(Y.competitiveness[J]=[0,0]),Y.competitiveness[J][G]+=1}if(N){let J=N.toLowerCase();Y.matchUpStatuses[J]||(Y.matchUpStatuses[J]=0),Y.matchUpStatuses[J]+=1}}}})}let U=["tiebreaks","matchUps","points","games","sets"],T=["competitive","routine","decisive"],P=new Map,R=(E,N)=>(E??0)+(N??0);for(let[E,N]of v.entries()){for(let A of U){let M=N[A].reduce(R);if(M){let C=N[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k,I.set(E,!0),P.has(O)||P.set(O,[]),(c=P.get(O))==null||c.push(k)}}for(let A of T){let M=(d=(u=N.competitiveness)==null?void 0:u[A])==null?void 0:d.reduce(R);if(M){let C=N.competitiveness[A][0]/M,O=`${A}Ratio`,k=parseFloat(C.toFixed(2));N[O]=k}}}if(!r){let E=(N,A)=>A-N;for(let N of v.values())for(let A of U){let M=`${A}Ratio`;if(typeof N[M]=="number"){let C=(p=P.get(M))==null?void 0:p.sort(E).indexOf(N[M]);if(typeof C=="number"&&C>=0){let O=`${A}Rank`;N[O]=C+1}}}}let D={relevantMatchUps:S,...Z};return r?(D.teamStats=v.get(r),e&&(D.opponentStats=v.get(e))):D.participatingTeamsCount=I.size,D.allParticipantStats=[...v.values()],D}function Y0({participant:t,eventType:e}){var i,r,n,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,c=(n=(r=t==null?void 0:t.person)==null?void 0:r.personOtherIds)==null?void 0:n[0],u=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:f})=>f===v_),p=d==null?void 0:d.scaleValue,{wtnRating:m,confidence:h}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:c,confidence:h,wtnRating:m,personId:l,tennisId:u}}function YEe({tournamentRecord:t}){if(!t)return{error:he};let e=t.tournamentId,{participantMap:i}=Wi({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),r=(Lr({matchUpFilters:{matchUpTypes:[pm,Xd]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:m,matchUpType:h})=>m==null?void 0:m.flatMap(f=>{var g,v;return h===Xd?(g=f==null?void 0:f.participant)==null?void 0:g.individualParticipantIds:((v=f==null?void 0:f.participant)==null?void 0:v.participantId)||f.participantId}).filter(Boolean)).filter(Boolean),n=[],a={},o={},s={},l=0,c=({id:m,entry:h,eventId:f,eventType:g})=>{var v;let{qualifyingSeeding:I,mainSeeding:y,entryStatus:b,entryStage:S,drawId:w}=h;a[m]||(a[m]=[]);let{participant:U,events:T}=(i==null?void 0:i[m])??{},P=Y0({participant:U,eventType:g}),R=(v=T==null?void 0:T[f])==null?void 0:v.ranking;b===u_&&n.push(m),a[m].push({participantType:U==null?void 0:U.participantType,participantId:m,tournamentId:e,eventType:g,eventId:f,drawId:w,entryStatus:b,entryStage:S,...P,ranking:R,mainSeeding:y,qualifyingSeeding:I})};for(let m of t.events??[]){let h={},f=U=>{h[U]||(h[U]={count:0}),h[U].count+=1},{drawDefinitions:g=[],eventType:v,eventId:I}=m,y=g.flatMap(U=>{let{drawId:T,entries:P}=U;l+=1;let R=({stage:A,stageSequence:M})=>A===Oe&&M===1||A===qe,D=(U.structures??[]).filter(R).flatMap(({positionAssignments:A})=>A).filter(Boolean).map(({participantId:A})=>A),E=({participantId:A})=>D.includes(A),N=A=>{var M,C,O,k,x,F,$,_;let{participantId:L,entryStatus:B,entryStage:V}=A;f(B);let G=(k=(O=(C=(M=i==null?void 0:i[L])==null?void 0:M.draws)==null?void 0:C[T])==null?void 0:O.seedAssignments)==null?void 0:k[Oe];return{qualifyingSeeding:(_=($=(F=(x=i==null?void 0:i[L])==null?void 0:x.draws)==null?void 0:F[T])==null?void 0:$.seedAssignments)==null?void 0:_[qe],participantId:L,mainSeeding:G,entryStatus:B,entryStage:V,drawId:T}};return P==null?void 0:P.filter(E).map(N)}),b=U=>{var T;let P=U.participantId,R=(T=i==null?void 0:i[P].participant.individualParticipantIds)==null?void 0:T.filter(D=>r.includes(D));return P&&{[P]:{individualParticipantIds:R}}};v===$c?(()=>{let U=Object.assign({},...y.map(b).filter(Boolean)),T=P=>{U[P.participantId].individualParticipantIds.forEach(R=>{c({id:R,eventType:v,eventId:I,entry:P})})};y.forEach(T)})():y.forEach(U=>{c({id:U==null?void 0:U.participantId,eventType:v,eventId:I,entry:U})});let S=Object.values(h).reduce((U,T)=>U+T.count,0);Object.keys(h).forEach(U=>{h[U].pct=h[U].count/S*100}),s[I]={tournamentId:e,eventId:I,entries:y,entryStatuses:h};let w=Object.assign({},...Jo.flatMap(U=>{var T,P;return[{[U+"_count"]:(T=h[U])==null?void 0:T.count},{[U+"_pct"]:(P=h[U])==null?void 0:P.pct}]}));o[I]={tournamentId:e,eventId:I,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:m,participantRole:h}})=>m===wt&&h===en),d=u.filter(({participant:m})=>!r.includes(m.participantId)).map(({participant:m})=>m.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:n,tournamentEntryReport:p}}function KEe({eventType:t,matchUps:e,eventId:i,drawId:r}){let n={},a=h=>{let f=h==null?void 0:h.matchUpFormat;f&&(n[f]||(n[f]=0),n[f]+=1)},o=e.filter(h=>i?h.eventId===i:h.drawId===r).reduce((h,f)=>(a(f),(f.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>h[g.participantId]=g),h),{}),s=Object.values(o),l=s.map(h=>Y0({participant:h,eventType:t})).filter(({wtnRating:h})=>h),c=(s.length-l.length)/s.length*100,u=l.reduce((h,f)=>{let{wtnRating:g,confidence:v}=f;return h.totalWTN+=g,h.totalConfidence+=v,h},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,m=Object.values(n).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:n,matchUpsCount:m,avgConfidence:p,pctNoRating:c,avgWTN:d}}function JEe({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var r;if(!i)return{error:Gf};let n={},a=Object.assign({},...(e??[]).map(({name:u,label:d,accessor:p})=>{var m,h,f;let g=(h=(m=ft({element:i,name:u}))==null?void 0:m.extension)==null?void 0:h.value,v=p?(f=mm({element:g,accessor:p}))==null?void 0:f.value:g;return{[d||u]:v}})),o=i==null?void 0:i.tournamentId,s=Lr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],l=u=>{var d,p,m;return(m=(p=(d=ul({itemType:YF,itemSubTypes:[Tl],element:{timeItems:u}}))==null?void 0:d.timeItem)==null?void 0:p.itemValue)==null?void 0:m.scaleBasis},c=(r=i==null?void 0:i.events)==null?void 0:r.flatMap(({timeItems:u,drawDefinitions:d=[],extensions:p,eventType:m,eventId:h,category:f})=>{var g,v,I,y,b;let S=(I=(v=(g=p==null?void 0:p.find(D=>D.name===Fo))==null?void 0:g.value)==null?void 0:v.flights)==null?void 0:I.map(D=>({[D.drawId]:D.flightNumber})),w=S&&Object.assign({},...S),U=((b=(y=p==null?void 0:p.find(D=>D.name===T0))==null?void 0:y.value)==null?void 0:b.length)||0,T=Object.values(w),P=w&&Math.min(...T),R=l(u);return n[h]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:U,seedingBasis:R?JSON.stringify(R):void 0,tournamentId:o,eventId:h},d.filter(D=>!t||!S||w[D.drawId]===P).flatMap(D=>{let{matchUpFormat:E,tieFormat:N,timeItems:A,extensions:M,structures:C,drawType:O,drawId:k}=D,{matchUpFormatCounts:x,matchUpsCount:F,avgConfidence:$,pctNoRating:_,avgWTN:L}=KEe({eventType:m,matchUps:s,drawId:k}),B=l(A)||R,V=XEe({extensions:M}),G=(V==null?void 0:V.length)||0;return n[h].totalPositionManipulations+=G,n[h].generatedDrawsCount+=1,G>n[h].maxPositionManipulations&&(n[h].maxPositionManipulations=G),C==null?void 0:C.filter(j=>j.stageSequence===1&&[qe,Oe,Yr,Fi].includes(j.stage)).map(j=>{var H,W,Y;let q=[Oe,Fi].includes(j.stage)?s.find(Te=>Te.structureId===j.structureId&&Te.finishingRound===1&&Te.winningSide):void 0,re=(W=(H=q==null?void 0:q.sides)==null?void 0:H.find(Te=>Te.sideNumber===q.winningSide))==null?void 0:W.participant,K=(re==null?void 0:re.participantType)===Za&&re.participantId,z=(re==null?void 0:re.participantType)===st?re.individualParticipants:[],te=Y0({participant:(z==null?void 0:z[0])||re,eventType:m}),{personId:J,personOtherId:ie,tennisId:ne,confidence:ue,wtnRating:ae}=te||{},ce=Y0({participant:z==null?void 0:z[1],eventType:m}),{personId:pe,personOtherId:Se,tennisId:Be,confidence:Pe,wtnRating:at}=ce||{},{ageCategoryCode:de,categoryName:Ie,subType:me}=f??{},Me=j.matchUpFormat||E,be=(x[Me]||0)/F*100,{tieFormatName:_e,tieFormatDesc:Ne}=G0(N),{tieFormatName:se,tieFormatDesc:ge}=G0(j.tieFormat),we=Ne===ge,De=!we&&se,Le=j.tieFormat&&!we&&ge,ye=((Y=V==null?void 0:V.filter(Te=>Te.structureId===j.structureId))==null?void 0:Y.length)||0;return{...a,tournamentId:o,eventId:h,structureId:j.structureId,drawId:k,eventType:m,category:me,categoryName:Ie,ageCategoryCode:de,flightNumber:w[k],drawType:O,stage:j.stage,seedingBasis:B?JSON.stringify(B):void 0,winningPersonId:J,winningPersonOtherId:ie,winningPersonTennisId:ne,winningPersonWTNrating:ae,winningPersonWTNconfidence:ue,winningPerson2Id:pe,winningPerson2OtherId:Se,winningPerson2TennisId:Be,winningPerson2WTNrating:at,winningPerson2WTNconfidence:Pe,winningTeamId:K,positionManipulations:ye,pctNoRating:_,matchUpFormat:Me,pctInitialMatchUpFormat:be,matchUpsCount:F,drawTieFormatName:_e,drawTieFormatDesc:Ne,tieFormatName:De,tieFormatDesc:Le,avgConfidence:$,avgWTN:L}})})});return{eventStructureReports:Object.values(n),structureReports:c}}function XEe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:r})=>r===S0))==null?void 0:e.value)==null?void 0:i.slice(1)}function ZEe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:r=[],dates:n=[]}){var a,o;if(!Array.isArray(n))return{error:oe,dates:n};if(!Array.isArray(r))return{error:oe,venueIds:r};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Ai};if(!n.every(Da))return{error:Tn};let s=tc({tournamentRecords:e,ignoreDisabled:t,dates:n});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(r!=null&&r.length)||r.includes(p)),c=(o=s.courts)==null?void 0:o.reduce((p,m)=>{var h;return(h=m.dateAvailability)==null||h.forEach(f=>{let g=f.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!n.length||n.includes(p)),u={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Us({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:u});return{venuesReport:l==null?void 0:l.map(p=>QEe(c,p,d))}}function QEe(t,e,i){let{venueId:r,courts:n,venueName:a}=e,o={};return t.forEach(s=>{var l;let c=0,u=0,d=0;for(let h of n){let f=h.dateAvailability.find(v=>v.date===s),g=(l=f&&Mv({courtDate:f}).timeSlots)==null?void 0:l.reduce((v,I)=>{let{startTime:y,endTime:b}=I,S=Pt(b)-Pt(y);return v+S},0);g&&(d+=1),c+=g}let p=i.filter(({schedule:h})=>h.venueId===r&&Bl(s,h.scheduledDate));p.forEach(({schedule:h})=>{let f=fi(h.scheduledTime),g=jn(f,h.averageMinutes),v=Pt(g)-Pt(f);u+=v});let m=c?(u/c*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:c,scheduledMinutes:u,percentUtilization:m}}),{venueId:r,venueName:a,venueReport:o}}var qte={};yt(qte,{addMatchUpCourtOrder:()=>U$,addMatchUpEndTime:()=>T$,addMatchUpOfficial:()=>Aee,addMatchUpResumeTime:()=>P$,addMatchUpScheduleItems:()=>qR,addMatchUpScheduledDate:()=>YR,addMatchUpScheduledTime:()=>dd,addMatchUpStartTime:()=>S$,addMatchUpStopTime:()=>D$,addSchedulingProfileRound:()=>_$,allocateTeamMatchUpCourts:()=>WR,assignMatchUpCourt:()=>jh,assignMatchUpVenue:()=>Av,bulkRescheduleMatchUps:()=>tie,bulkScheduleMatchUps:()=>uU,bulkScheduleTournamentMatchUps:()=>wy,bulkUpdateCourtAssignments:()=>Xte,calculateScheduleTimes:()=>V$,clearMatchUpSchedule:()=>rie,clearScheduledMatchUps:()=>JR,courtGridRows:()=>K_,findMatchUpFormatTiming:()=>RR,findVenue:()=>Xu,generateBookings:()=>KR,generateVirtualCourts:()=>VR,getPersonRequests:()=>kp,getProfileRounds:()=>CR,getScheduledRoundsDetails:()=>Zw,getSchedulingProfile:()=>ic,getSchedulingProfileIssues:()=>G_,matchUpScheduleChange:()=>iie,modifyMatchUpFormatTiming:()=>l$,mutate:()=>Yte,proAutoSchedule:()=>Jte,proConflicts:()=>Qte,publicFindCourt:()=>F8,query:()=>OQ,removeEventMatchUpFormatTiming:()=>LR,removeMatchUpCourtAssignment:()=>Kte,reorderUpcomingMatchUps:()=>eie,scheduleMatchUps:()=>Zte,scheduleProfileRounds:()=>XR,setMatchUpDailyLimits:()=>nie,setSchedulingProfile:()=>Rv,toggleParticipantCheckInState:()=>GR,validateSchedulingProfile:()=>ER});var Yte={};yt(Yte,{addMatchUpCourtOrder:()=>U$,addMatchUpEndTime:()=>T$,addMatchUpOfficial:()=>Aee,addMatchUpResumeTime:()=>P$,addMatchUpScheduleItems:()=>qR,addMatchUpScheduledDate:()=>YR,addMatchUpScheduledTime:()=>dd,addMatchUpStartTime:()=>S$,addMatchUpStopTime:()=>D$,addSchedulingProfileRound:()=>_$,allocateTeamMatchUpCourts:()=>WR,assignMatchUpCourt:()=>jh,assignMatchUpVenue:()=>Av,bulkRescheduleMatchUps:()=>tie,bulkScheduleMatchUps:()=>uU,bulkScheduleTournamentMatchUps:()=>wy,bulkUpdateCourtAssignments:()=>Xte,calculateScheduleTimes:()=>V$,clearMatchUpSchedule:()=>rie,clearScheduledMatchUps:()=>JR,courtGridRows:()=>K_,findMatchUpFormatTiming:()=>RR,findVenue:()=>Xu,generateBookings:()=>KR,generateVirtualCourts:()=>VR,matchUpScheduleChange:()=>iie,modifyMatchUpFormatTiming:()=>l$,proAutoSchedule:()=>Jte,proConflicts:()=>Qte,publicFindCourt:()=>F8,removeEventMatchUpFormatTiming:()=>LR,removeMatchUpCourtAssignment:()=>Kte,reorderUpcomingMatchUps:()=>eie,scheduleMatchUps:()=>Zte,scheduleProfileRounds:()=>XR,setMatchUpDailyLimits:()=>nie,setSchedulingProfile:()=>Rv,toggleParticipantCheckInState:()=>GR,validateSchedulingProfile:()=>ER});function V$({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:r,clearScheduleDates:n,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:Ai};o=o??jR({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=tc({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),m=d==null?void 0:d.filter(R=>!c||c.includes(R.venueId));l||(l=m==null?void 0:m.reduce((R,D)=>{var E,N;let A=((N=(E=D.dateAvailability)==null?void 0:E.find(M=>!M.date||Bl(s,M.date)))==null?void 0:N.startTime)??D.startTime;return A&&(!R||Pt(A)<Pt(R))?A:R},void 0)),u||(u=m==null?void 0:m.reduce((R,D)=>{var E,N;let A=((N=(E=D.dateAvailability)==null?void 0:E.find(M=>!M.date||Bl(s,M.date)))==null?void 0:N.endTime)??D.endTime;return A&&(!R||Pt(A)>Pt(R))?A:R},void 0));let h=Object.values(a),f=Object.assign({},...h.map(R=>(R.events??[]).map(D=>{let{scheduleTiming:E}=Sw({tournamentRecord:R,event:D});return{[D.eventId]:{event:D,scheduleTiming:E}}})).flat()),g=tU({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],I=(g==null?void 0:g.completedMatchUps)??[],y=[];y.push(...v),y.push(...I);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},S=y==null?void 0:y.map(({eventId:R,schedule:D,matchUpFormat:E})=>{let{event:N,scheduleTiming:A}=f[R],M=N==null?void 0:N.eventType,C={...A,defaultTiming:b,matchUpFormat:E},{averageMinutes:O,recoveryMinutes:k}=HP({eventType:M,timingDetails:C}),{courtId:x,venueId:F}=D,$=fi(D.scheduledTime),_=jn($,O);return{recoveryMinutes:k,averageMinutes:O,periodLength:o,startTime:$,endTime:_,courtId:x,venueId:F}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:r,averageMatchUpMinutes:i,date:s,clearScheduleDates:n,periodLength:o,startTime:l,endTime:u,bookings:S,courts:m},{scheduleTimes:U}=g$(w),T=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,P=y.map(wr);return{venueId:T,scheduleTimes:U,dateScheduledMatchUpIds:P}}function Kte(t){var e;let i=kt(t,[{[sn]:!0}]);if(i.error)return i;let{removePriorValues:r,tournamentRecords:n,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:c}=t,u=n[a];if(!u)return{error:he};let{drawDefinition:d,event:p}=cd({tournamentRecord:u,drawId:c});if(!d)return{error:Ce};let m=gi({drawDefinition:d,event:p,matchUpId:s});if(m.error)return m;if(((e=m==null?void 0:m.matchUp)==null?void 0:e.matchUpType)===Zs){let{itemValue:h}=Cp({timeItems:m.matchUp.timeItems??[],itemType:Au}),f=l&&h.filter(g=>g.courtId!==l);return Na({duplicateValues:!1,removePriorValues:r,tournamentRecord:u,drawDefinition:d,matchUpId:s,timeItem:{itemType:Au,itemValue:f}})}else return jh({tournamentRecord:u,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function Jte({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:r}){if(!po(r))return{error:oe};if(r.some(({hasContext:m})=>!m))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:yP};let n=tU({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(n.error)return n;let{rows:a}=n,o=[],s=m=>[(m.sides||[]).map(h=>{var f;return[h.participantId,(f=h.participant)==null?void 0:f.individualParticipantIds]}),(m.potentialParticipants||[]).flat().map(h=>[h.participantId,h.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((m,h)=>{let f=[],g=[];Object.values(h).forEach(I=>{if(Ii(I)&&(I.matchUpId&&(f.push(I.matchUpId),o.push(I)),I.sides)){let y=s(I);g.push(...y)}});let v=Object.values(h).filter(I=>Ii(I)&&!I.matchUpId);return m.concat({matchUpIds:f,availableCourts:v,rowId:h.rowId,participantIds:g})},[]);r.filter(({matchUpStatus:m})=>m&&m!==Ft&&(t||!Sr.includes(m))).sort(Ah);let c=Zo({matchUps:r.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;r.length&&l.length;){let m=l.shift(),h=[];for(;r.length&&m.availableCourts.length;){let f=r.concat(h).map(T=>T.matchUpId),g=r.shift(),v=g==null?void 0:g.matchUpId,I=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),y=v&&f.some(T=>c[v].matchUpIds.includes(T)),b=v&&d.some(T=>c[v].dependentMatchUpIds.includes(T)),S=m.matchUpIds.some(T=>I.includes(T)),w=s(g),U=m.participantIds.some(T=>w.includes(T));if(g&&!S&&!y&&!U&&!b){let T=m.availableCourts.shift();Object.assign(g.schedule,T.schedule),Object.assign(T,g),u.push(g),m.participantIds.push(...w),m.matchUpIds.push(v)}else g&&h.push(g)}r.push(...h),d.push(...m.matchUpIds)}let p=u.map(({matchUpId:m,tournamentId:h,schedule:f,drawId:g})=>({tournamentId:h,matchUpId:m,drawId:g,schedule:{...f,scheduledDate:i}}));return n=uU({tournamentRecords:e,matchUpDetails:p}),{...n,scheduled:u,notScheduled:r}}function Xte(t){let{courtDayDate:e}=t,i=kt(t,[{courtAssignments:!0,[ad]:Xn,[_l]:Ve},{[sn]:!0}]);if(i.error)return i;let r=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),n;return Object.keys(r).every(a=>{let o=t[sn][a];if(!o)return n={error:he},!1;let s=r[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=xn({tournamentRecord:o,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,m=jh({tournamentRecord:o,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(m.success)return m==null?void 0:m.success;n={error:HK}}),!0):(n={error:Ce},!1)})}),n||Z}function Zte(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:r=90,recoveryMinutes:n=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:m=30,scheduleDate:h,matchUpIds:f,venueIds:g,startTime:v,endTime:I,dryRun:y}=t,b=kt(t,[{[sn]:!0,[rw]:!0},{[is]:Da,[_l]:Tn,[gwe]:!0},{[is]:V=>!V||!isNaN(V),[bwe]:!1,[_l]:oe,[wwe]:!1,[Uwe]:!1}]);if(b.error)return b;let S=t.competitionMatchUps??Us({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Zo({includeParticipantDependencies:!0,matchUps:S,tournamentRecords:e}).matchUpDependencies;S.forEach(V=>{var G;(G=V.schedule)!=null&&G.scheduledDate&&Bl(h,ct(V.schedule.scheduledDate))&&pg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:V})});let U=f.map(V=>S.find(G=>G.matchUpId===V)).filter(Boolean),{venueId:T,scheduleTimes:P,dateScheduledMatchUpIds:R}=V$({tournamentRecords:e,remainingScheduleTimes:d,startTime:fi(v),endTime:fi(I),scheduleDate:ct(h),averageMatchUpMinutes:r,clearScheduleDates:p,periodLength:m,venueIds:g}),D={},E=[],N={},A={},M={};S.filter(({matchUpId:V})=>R==null?void 0:R.includes(V)).forEach(V=>{var G;JM({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:V,value:1});let j=(G=V.schedule)==null?void 0:G.scheduledTime;if(j){N[V.matchUpId]=j;let H=a==null?void 0:a[V.matchUpId];by({recoveryMinutes:H||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:j,matchUp:V})}});let C=U.filter(V=>{let G=R==null?void 0:R.includes(V.matchUpId),j=[Ft,Ot,Zi,Ca,dn,jt].includes(V==null?void 0:V.matchUpStatus);return!G&&!V.winningSide&&!j}),{matchUpMap:O,overLimitMatchUpIds:k,participantIdsAtLimit:x}=C.reduce((V,G)=>{let{drawId:j,tournamentId:H,matchUpType:W}=G,{participantIdsAtLimit:Y,relevantParticipantIds:q}=x$({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:c,matchUp:G});return Y!=null&&Y.length?(V.overLimitMatchUpIds.push(G.matchUpId),V.participantIdsAtLimit.push(...Y),V):(q.forEach(re=>{sU({individualParticipantProfiles:s,participantId:re});let K=s[re].counters;K[W]?K[W]+=1:K[W]=1,K[Eo]?K[Eo]+=1:K[Eo]=1}),V.matchUpMap[H]||(V.matchUpMap[H]={}),V.matchUpMap[H][j]?V.matchUpMap[H][j].push(G):V.matchUpMap[H][j]=[G],pg({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:G}),V)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});C=C.filter(({matchUpId:V})=>!k.includes(V));let F=0,$=(P==null?void 0:P.length)??0,{personRequests:_}=kp({tournamentRecords:e,requestType:lU});for(;P!=null&&P.length&&C.length&&F<=$;){F++;let{scheduleTime:V}=P.shift(),G=C.find(j=>{let{matchUpId:H}=j,{dependenciesScheduled:W,remainingDependencies:Y}=A$({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:j});if(!W)return M[H]||(M[H]=[]),M[H].push({scheduleTime:V,remainingDependencies:Y}),!1;let{enoughTime:q}=k$({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:V,matchUp:j});if(!q)return A[H]||(A[H]=[]),A[H].push({scheduleTime:V}),!1;let{conflicts:re}=O$({potentials:u,averageMatchUpMinutes:r,requestConflicts:D,personRequests:_,scheduleTime:V,scheduleDate:h,matchUp:j});if(re!=null&&re.length)return!1;let K=a==null?void 0:a[j.matchUpId];return by({recoveryMinutes:K||n,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:r,matchUpDependencies:w,scheduleTime:V,matchUp:j}),N[j.matchUpId]=V,!0});C=C.filter(({matchUpId:j})=>j!==(G==null?void 0:G.matchUpId)),G||E.push(V)}C.forEach(V=>{JM({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:V})});let L=[];Object.keys(O).forEach(V=>{let G=e[V];G&&Object.keys(O[V]).forEach(j=>{let{drawDefinition:H}=cd({tournamentRecord:G,drawId:j});H&&O[V][j].forEach(({matchUpId:W})=>{let Y=N[W];if(Y){let q=Y.split(":").map(qa).join(":"),re=`${ct(h)}T${q}`;y?L.push(W):(dd({drawDefinition:H,matchUpId:W,scheduledTime:re}).success&&L.push(W),T&&Av({tournamentRecords:e,tournamentRecord:G,drawDefinition:H,matchUpId:W,venueId:T}))}})})});let B=_F(C);return{...Z,requestConflicts:Object.values(D),remainingScheduleTimes:P==null?void 0:P.map(({scheduleTime:V})=>V),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:x,skippedScheduleTimes:E,overLimitMatchUpIds:k,scheduledMatchUpIds:L,noTimeMatchUpIds:B,recoveryTimeDeferred:A,dependencyDeferred:M}}function Qte({tournamentRecords:t,matchUps:e}){if(!po(e))return{error:Xl};if(e.some(({matchUpId:m,hasContext:h})=>m&&!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:yP};let i=Math.max(...e.map(({schedule:m})=>(m==null?void 0:m.courtOrder)||1).map(m=>Xe(m))),r=Ee(1,i+1).map(m=>e.filter(h=>{var f;return Xe((f=h.schedule)==null?void 0:f.courtOrder)===m})),n={},a={},o={};r.flat().filter(Boolean).sort(Ah).forEach(({schedule:m})=>delete m[US]);let s=ht(e.map(({drawId:m})=>m)),l=Zo({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=r.map((m,h)=>m.reduce((f,g)=>{if(!g.matchUpId)return f;let{matchUpId:v,winnerMatchUpId:I,loserMatchUpId:y,schedule:b,sides:S,potentialParticipants:w}=g,U=b==null?void 0:b.courtId;n[v]=h,a[U]=[],f.matchUpIds.push(v),o[v]=g;let T=l[v].matchUpIds;T.length&&f.sourceMatchUpIds.push(...T);let P=(S==null?void 0:S.map(D=>{var E;return[(E=D.participant)==null?void 0:E.individualParticipantIds,D.participantId]}).flat().filter(Boolean))??[],R=(w==null?void 0:w.flat().map(({individualParticipantIds:D,participantId:E})=>[D,E]).flat().filter(Boolean))||[];return f.participantIds.push(...R,...P),I&&f.targetMatchUpIds.push(I),y&&f.targetMatchUpIds.push(y),f},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(m,h)=>l[m].sources.reduce((f,g,v)=>g.includes(h)&&v+1||f,0),d=c.map(()=>[]),p=(m,h,f,g)=>{if(!o[m].schedule[US]){o[m].schedule[US]=h,o[m].schedule[A8]=g,d[n[m]].push({matchUpId:m,issueType:f,issueIds:g,issue:h});let v=o[m].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:m,issue:h,issueType:f,issueIds:g})}};return c.forEach((m,h)=>{let f=h?c[h-1]:void 0,g=c.slice(h+1),v={},I=fa(m.participantIds),y=Object.keys(I).filter(w=>I[w]>1),b=m.matchUpIds.filter(w=>l[w].participantIds.some(U=>y.includes(U)));b.forEach(w=>{v[w]||(v[w]={}),v[w][fd]||(v[w][fd]=b.filter(U=>U!==w))});let S=f&&m.participantIds.filter(w=>f.participantIds.includes(w));S&&S.forEach(w=>{let U=m.matchUpIds.concat(f.matchUpIds).filter(T=>l[T].participantIds.includes(w));U.forEach(T=>{v[T]||(v[T]={}),v[T][gd]||(v[T][gd]=U.filter(P=>P!==T))})}),m.matchUpIds.forEach(w=>{var U,T,P,R;let D=l[w].matchUpIds;for(let N of g){let A=N.matchUpIds.filter(M=>D.includes(M));A!=null&&A.length&&(A.forEach(M=>p(M,yM,uc,[w])),p(w,yM,uc,A))}if((U=v[w])!=null&&U[fd]&&p(w,fd,IM,v[w][fd]),m.sourceMatchUpIds.includes(w)){let N=m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w));p(w,fd,uc,N),m.matchUpIds.filter(A=>l[A].matchUpIds.includes(w)).forEach(A=>p(A,fd,uc,[w]))}let E=(T=f==null?void 0:f.matchUpIds)==null?void 0:T.filter(N=>u(w,N)>1);if(E!=null&&E.length&&(p(w,bM,uc,E),E.forEach(N=>p(N,bM,uc,[w]))),(P=v[w])!=null&&P[gd]&&p(w,gd,IM,v[w][gd]),(R=f==null?void 0:f.targetMatchUpIds)==null?void 0:R.includes(w)){let N=o[w].schedule.courtId,A=D.filter(M=>f.matchUpIds.includes(M));A.some(M=>o[M].schedule.courtId===N)||(A.forEach(M=>p(M,gd,uc,[w])),p(w,gd,uc,A))}})}),{courtIssues:a,rowIssues:d}}function eie(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ee({result:{error:Ai},stack:e});let{matchUpsContextIds:r,firstToLast:n}=t;if(!r)return ee({result:{error:Ve},stack:e});let a=r==null?void 0:r.length;if(!a)return{...Z};let o=0;return r.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,m=c+(n?-1:1);m<0&&(m=a-1),m===a&&(m=0);let h=r[m].schedule.scheduledTime,f=s({tournamentId:u,scheduledTime:h,matchUpId:p,drawId:d});if(f.success)o++;else return f}),o===a?Z:ee({result:{error:GK},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:m}=cd({tournamentRecord:p,drawId:d});return m?dd({drawDefinition:m,scheduledTime:c,matchUpId:u}):{error:ma}}}function tie(t){var e,i;let{scheduleChange:r,matchUpIds:n,dryRun:a}=t;if(!n||!Array.isArray(n))return{error:iv};if(typeof r!="object")return{error:oe};let o=ll(t),s=[],l=[];for(let u of Object.values(o)){let d=eCe({tournamentRecord:u,scheduleChange:r,matchUpIds:n,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=_F(d.notRescheduled),m=[];(e=d.rescheduled)==null||e.forEach(h=>{let{matchUpId:f}=h;p.includes(f)&&m.push(f),s.push(h)}),m.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:h})=>!m.includes(h)))||[])}let c=!!(s.length&&!l.length);return{...Z,rescheduled:s,notRescheduled:l,allRescheduled:c}}function eCe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:r}){var n;if(!t)return{error:he};if(!i||!Array.isArray(i))return{error:iv};if(typeof e!="object")return{error:oe};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...Z};if(s&&isNaN(s))return{error:oe};if(l&&isNaN(l))return{error:oe};let{matchUps:c}=Lr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:S})=>!Sr.includes(S),d=c==null?void 0:c.filter(S=>eU({schedule:S.schedule})).filter(S=>u({matchUpStatus:S.matchUpStatus}));if(!(d!=null&&d.length))return{...Z};let{tournamentInfo:p}=Bh({tournamentRecord:t}),{startDate:m,endDate:h}=p,f=d==null?void 0:d.reduce((S,w)=>{let{matchUpId:U,drawId:T}=w;return S[T]?S[T].push(U):S[T]=[U],S},{}),g=1440;for(let S of Object.keys(f)){let w=cd({tournamentRecord:t,drawId:S});if(w.error)return w;let U=w.drawDefinition,T=f[S].filter(P=>i.includes(P));for(let P of T)if(P&&U){let R=(n=d.find(C=>C.matchUpId===P))==null?void 0:n.schedule,{scheduledTime:D,scheduledDate:E}=R,N,A,M;if(!N&&l&&E){let C=ct(E);M=zv(C,l),N=new Date(M)<new Date(m)||new Date(M)>new Date(h)}if(s&&D){let C=ct(D),O=Pt(fi(D))+s;if(N=O<0||O>g,!N){let k=jn(D,s),x=C&&M||E===C&&C;A=x?`${x}T${k}`:k}}if(N)o.push(P);else{if(!r){if(A){let C=dd({scheduledTime:A,drawDefinition:U,matchUpId:P});if(C.error)return C}if(M){let C=YR({scheduledDate:M,drawDefinition:U,matchUpId:P});if(C.error)return C}}(A||M)&&a.push(P)}}}let v=Lr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],I=v.filter(({matchUpId:S})=>a.includes(S)),y=v.filter(({matchUpId:S})=>o.includes(S)),b=I.length&&!y.length;return{...Z,rescheduled:I,notRescheduled:y,allRescheduled:b}}function iie(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Ai};let{sourceMatchUpContextIds:r,targetMatchUpContextIds:n,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=r||{},{drawId:d,matchUpId:p,tournamentId:m}=n||{};if(!c&&!p)return ee({result:{error:Ve},stack:e});let{matchUps:h}=Us({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),f=h==null?void 0:h.find(({matchUpId:b})=>b===c),g=h==null?void 0:h.find(({matchUpId:b})=>b===p),v=0;if(o&&c&&!p){let b=I({tournamentId:u,matchUpId:c,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return ee({result:b,stack:e})}else if(a&&o&&c&&p){let b=I({tournamentId:u,matchUpId:c,courtId:o,matchUp:f,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return ee({result:b,stack:e,info:"source"});let S=I({tournamentId:m,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(S.success&&v++,S.error)return ee({result:S,stack:e,info:"target"})}else return{error:Ve};return v?Z:ee({result:{error:ov},stack:e});function I(b){let{tournamentRecords:S,tournamentId:w,matchUp:U,drawId:T}=b,P=S[w],{drawDefinition:R}=cd({tournamentRecord:P,drawId:T});return U.matchUpType===di?y({...b,tournamentRecord:P,drawDefinition:R}):jh({...b,tournamentRecord:P,drawDefinition:R})}function y({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,sourceCourtId:T,courtDayDate:P,matchUpId:R,matchUp:D,courtId:E}){let N=[E].concat(D.schedule.allocatedCourts.map(({courtId:A})=>A).filter(A=>A!==T));return WR({removePriorValues:b,tournamentRecords:S,tournamentRecord:w,drawDefinition:U,courtDayDate:P,matchUpId:R,courtIds:N})}}function rie({scheduleAttributes:t=[Au,Qd,vv,Iv,yv,ns,Ou,Dl,pu],tournamentRecord:e,drawDefinition:i,matchUpId:r}){var n,a;let o="clearMatchUpSchedule",s=i?(n=Nn({matchUpFilters:{matchUpIds:[r]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:n[0]:(a=Lr({matchUpFilters:{matchUpIds:[r]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:an};let l=(s.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return s.timeItems=l,Et({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...Z}}function nie(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:r}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof n!="object"||!Object.keys(n).length)return{error:Ai};if(typeof r!="object")return{error:qu};let a=Object.keys(n).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:oe};for(let o of a){let s=n[o],l=Mt({element:s,extension:{name:sw,value:{dailyLimits:r}}});if(l.error)return l}return{...Z}}var aie={};yt(aie,{addCollectionDefinition:()=>H$,addCollectionGroup:()=>die,aggregateTieFormats:()=>mie,compareTieFormats:()=>ku,getTieFormat:()=>B_,modifyCollectionDefinition:()=>j$,modifyTieFormat:()=>pie,mutate:()=>oie,orderCollectionDefinitions:()=>uie,query:()=>RQ,removeCollectionDefinition:()=>G$,removeCollectionGroup:()=>lie,tieFormatGenderValidityCheck:()=>nR,validateCollectionDefinition:()=>zw});var oie={};yt(oie,{addCollectionDefinition:()=>H$,addCollectionGroup:()=>die,aggregateTieFormats:()=>mie,modifyCollectionDefinition:()=>j$,modifyTieFormat:()=>pie,orderCollectionDefinitions:()=>uie,removeCollectionDefinition:()=>G$,removeCollectionGroup:()=>lie});function op({drawDefinition:t,structureId:e,matchUpId:i,structure:r,matchUp:n,eventId:a,event:o}){var s;let l="getTieFormat",c;if(e=(r==null?void 0:r.structureId)??e,i=(n==null?void 0:n.matchUpId)??i,(i||e)&&!t)return{error:Ce};if(a&&o)c=pc(o);else if(i){if(t&&(!n||!r)){let u=gi({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((s=u.matchUp)==null?void 0:s.matchUpType)!==Zs)return ee({result:{error:kn},stack:l});r||(r=u.structure),n||(n=u.matchUp)}c=sI({item:n,drawDefinition:t,structure:r,event:o})||sI({item:r,drawDefinition:t,structure:r,event:o})||pc(t)||pc(o)}else if(t&&e){if(!r){let u=et({drawDefinition:t,structureId:e});if(u.error)return u;r=u==null?void 0:u.structure}c=sI({item:r,drawDefinition:t,structure:r,event:o})||pc(t)||pc(o)}else c=pc(t)||pc(o);return c?{...Z,structure:r,tieFormat:c,matchUp:n}:ee({result:{error:Zb},stack:l})}function K0({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Sr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Yo&&!_r(t))}function QE({from:t,to:e}){let i=Object.keys(t),r=Hi(i,Object.keys(e)).length===i.length,n=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:r&&a,matchUpsCountChanges:n}}function tCe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:r,tieFormat:n,eventId:a,matchUp:o,event:s,uuids:l}){var c,u,d,p;let m="updateTieFormat",h=e==null?void 0:e.tournamentId,f=0,g=0,v=0,I=0,y=n==null?void 0:n.collectionDefinitions.reduce((R,D)=>(R[D.collectionId]=(R[D.collectionId]||0)+D.matchUpCount,R),{}),b=({tieFormat:R})=>{let D=R==null?void 0:R.collectionDefinitions.reduce((E,N)=>(E[N.collectionId]=(E[N.collectionId]||0)+N.matchUpCount,E),{});return QE({from:D,to:y}).equivalent},S=(c=op({drawDefinition:i}))==null?void 0:c.tieFormat,w=(u=op({event:s}))==null?void 0:u.tieFormat;if(s&&a){for(let R of s.drawDefinitions??[])U({drawDefinition:R});s.tieFormat=Vr(n),I+=1}else if(o){if(!o.tieMatchUps)return ee({result:{error:kn},stack:m});let R=fa((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:M})=>M)),D=QE({to:y,from:R}),{changes:E,changesArePossible:N,cannotChangeReaon:A}=WV({matchUp:o,check:D});if(D.equivalent)if(K0({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Vr(n),I+=1;else return ee({result:{error:tF},info:"matchUp is IN_PROGRESS or COMPLETE",stack:m});else if(N)P({tieFormat:n,matchUp:o,changes:E,uuids:l});else return ee({context:{collectionMap:y,matchUpMap:R},result:{error:tu},info:A||"specified changes not possible",stack:m});g+=1,Et({eventId:s==null?void 0:s.eventId,context:m,drawDefinition:i,tournamentId:h,matchUp:o})}else if(r){let R=(p=T({inheritedTieFormat:S??w,structure:r}))==null?void 0:p.modifiedMatchUpsCount;R&&(g+=R,f+=1,I+=1);let D=!r.tieFormat||ku({ancestor:r.tieFormat,descendant:n}).different;D&&(r.tieFormat=Vr(n),f+=1,I+=1),(R||D)&&i&&pi({structureIds:[r.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)U({drawDefinition:i}),i.tieFormat=Vr(n),I+=1;else return{error:Ce};return{modifiedStructuresCount:f,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:I,...Z,tieFormat:n};function U({drawDefinition:R}){var D;let E=R.structures||[],N=[];for(let A of E){if(A.tieFormat)continue;let M=(D=T({inheritedTieFormat:w,structure:A}))==null?void 0:D.modifiedMatchUpsCount;if(M){f+=1,g+=M;let C=A.structureId;N.push(C)}}return pi({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:R}),N.length}function T({inheritedTieFormat:R,structure:D}){var E,N;let A=0,M=((E=$t({matchUpFilters:{matchUpTypes:[di]},structure:D}))==null?void 0:E.matchUps)||[];for(let C of M){let O=K0({matchUp:C,updateInProgressMatchUps:t}),k=!1,x=fa((N=C.tieMatchUps)==null?void 0:N.map(({collectionId:$})=>$)),F=QE({from:x,to:y});if(F.equivalent)C.tieFormat&&b(C)&&O&&(C.tieFormat=Vr(n),k=!0);else{let{changes:$,changesArePossible:_}=WV({matchUp:C,check:F});if(_&&!C.tieFormat)P({changes:$,matchUp:C,tieFormat:n,uuids:l});else if(R)(!C.tieFormat||ku({ancestor:R,descendant:C.tieFormat}).different)&&(C.tieFormat=R,k=!0);else return ee({result:{error:Zb},stack:m})}k&&(A+=1,Et({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:m,eventId:a,matchUp:C}))}return{modifiedMatchUpsCount:A}}function P({uuids:R,matchUp:D,tieFormat:E,changes:N}){D.tieFormat=Vr(E);let A=[],M=[];return N.forEach(C=>{if(C.countChange>0){let O=Math.max(0,...D.tieMatchUps.filter(F=>F.collectionId===C.collectionId).map(ga("collectionPosition"))),k=E.collectionDefinitions.find(F=>F.collectionId===C.collectionId),x=jw({matchUpsLimit:C.countChange,collectionPositionOffset:O,collectionDefinition:k,matchUp:D,uuids:R});M.push(...Fe(x,!1,!0)),v+=M.length,D.tieMatchUps.push(...x)}else{let O=C.toBePlayedTieMatchUpIds.slice(0,Math.abs(C.countChange));console.log("remove",O.length),A.push(...O),D.tieMatchUps=D.tieMatchUps.filter(({matchUpId:k})=>!O.includes(k))}}),M.length&&Lc({matchUps:M,drawDefinition:i,tournamentId:h,eventId:a}),A.length&&Ku({matchUpIds:A,action:"updateTieFormat",drawDefinition:i,tournamentId:h,eventId:a}),{matchUpIdsRemoved:A,matchUpsAdded:M}}}function WV({check:t,matchUp:e}){let i="",r=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:n,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===n&&l.matchUpStatus===zi).map(ga("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),r.push({toBePlayedTieMatchUpIds:o,collectionId:n,countChange:a}),s}),changes:r,cannotChangeReaon:i}}function eE({drawDefinition:t,auditData:e}){let{extension:i}=ft({name:Lm,element:t}),r={name:Lm,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]};Mt({element:t,extension:r})}function j$({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:r,tieFormatName:n,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:m,gender:h,event:f,collectionValueProfiles:g,collectionValue:v,matchUpValue:I,scoreValue:y,setValue:b}){var S;let w="modifyCollectionDefinition";if(o&&!Ia({matchUpFormat:o}))return ee({result:{error:oe},context:{matchUpFormat:o},stack:w});if(r&&typeof r!="string")return ee({result:{error:oe},context:{collectionName:r},stack:w});if(h&&!Object.values(wL).includes(h))return ee({result:{error:oe},context:{gender:h},stack:w});if(p&&typeof p!="object")return ee({result:{error:oe},context:{category:p},stack:w});let U={collectionValueProfiles:g,collectionValue:v,matchUpValue:I,scoreValue:y,setValue:b};if(!Object.values(U).filter(Boolean).length&&!i&&!r&&!o&&!s&&!c)return ee({result:{error:Ve},stack:w});if(Object.values(U).filter(Boolean).length>1)return ee({info:"Only one value assignment allowed per collectionDefinition",result:{error:oe},stack:w});let T=op({drawDefinition:a,structureId:u,matchUpId:d,eventId:m,event:f});if(T.error)return ee({result:T,stack:w});let{matchUp:P,structure:R,tieFormat:D}=T,E=Vr(D),N=D==null?void 0:D.collectionDefinitions.find(B=>B.collectionId===l),A=E==null?void 0:E.collectionDefinitions.find(B=>B.collectionId===l);if(!N)return ee({info:"source collectionDefinition",result:{error:on},context:{collectionId:l},stack:w});let M=v??I??y??b;if(g){let B=aX({matchUpCount:s??(N==null?void 0:N.matchUpCount)??0,collectionValueProfiles:g});if(B.errors)return ee({result:{error:oe},info:B.errors,stack:w})}else if(M&&!nt(M))return ee({result:{error:oe},info:"value is not an integer",context:{value:M},stack:w});let C=(B,V)=>Hi(Object.keys(B),Object.keys(V)).length===Object.keys(B).length&&Hi(Object.values(B),Object.values(V)).length===Object.values(B).length,O=g&&(!N.collectionValueProfiles||!C(N.collectionValueProfiles,g)),k=nt(v)&&N.collectionValue!==v||nt(I)&&N.matchUpValue!==I||nt(y)&&N.scoreValue!==y||nt(b)&&N.setValue!==b||O,x=[];if(k&&(A.collectionValueProfiles=void 0,A.collectionValue=void 0,A.matchUpValue=void 0,A.scoreValue=void 0,A.setValue=void 0,Object.assign(A,U),x.push({collectionId:l,...He(U)})),(nt(y)||nt(b))&&A.collectionGroupNumber){let B=A.collectionGroupNumber;E.collectionDefinitions=E.collectionDefinitions.map(V=>{let{collectionGroupNumber:G,...j}=V;return G===B?j:V}),E.collectionGroups=E.collectionGroups.filter(({groupNumber:V})=>V!==B),x.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:$}=Vh(E),_=He({aggregateValue:F,valueGoal:$});if((_.aggregateValue!==(D==null?void 0:D.winCriteria.aggregateValue)||_.valueGoal!==(D==null?void 0:D.winCriteria.valueGoal))&&(E.winCriteria=_,x.push({collectionId:l,winCriteria:_})),nt(i)&&N.collectionOrder!==i&&(A.collectionOrder=i,x.push({collectionId:l,collectionOrder:i})),r&&N.collectionName!==r&&(A.collectionName=r,x.push({collectionId:l,collectionName:r})),o&&N.matchUpFormat!==o&&(A.matchUpFormat=o,x.push({collectionId:l,matchUpFormat:o})),nt(s)&&N.matchUpCount!==s&&(A.matchUpCount=s,x.push({collectionId:l,matchUpCount:s})),c&&N.matchUpType!==c)return ee({result:{error:UP},context:{matchUpType:c},stack:w});p&&N.category!==p&&(A.category=p,x.push({collectionId:l,category:p})),h&&N.gender!==h&&(A.gender=h,x.push({collectionId:l,gender:h}));let L=He(E);if(T=Kn({tieFormat:L}),T.error)return ee({result:T,stack:w});if(!x.length)return ee({result:{...Z,modifications:x}});if((D==null?void 0:D.tieFormatName)!==n?(L.tieFormatName=n,x.push({tieFormatName:n})):x.length&&(delete L.tieFormatName,x.push("tieFormatName removed: modifications without new tieFormatName")),T=tCe({tieFormat:L,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:R,eventId:m,matchUp:P,event:f}),!T.error){let{appliedPolicies:B}=Gt({tournamentRecord:e});if((S=B==null?void 0:B.audit)!=null&&S[Lm]){let V=He({collectionDefinition:A,drawId:a==null?void 0:a.drawId,action:w,structureId:u,matchUpId:d,eventId:m});eE({drawDefinition:a,auditData:V})}}return ee({result:{...T,modifications:x},stack:w})}function iCe({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:r,matchUpId:n,matchUp:a}){var o,s;let l=[];return n&&a?l=[a]:i&&r?l=((o=$t({matchUpFilters:{matchUpTypes:[di]},structure:r}))==null?void 0:o.matchUps)??[]:e&&(l=((s=Nn({matchUpFilters:{matchUpTypes:[di]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(c=>!c.winningSide&&c.matchUpStatus!==Zi&&(t||c.matchUpStatus!==Yo&&!_r(c)))}}function rCe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:r,tieFormat:n,event:a}){for(let o of r){let s=!!o.tieFormat;s&&(o.tieFormat=Vr(n));let l;if(t){let c=Gt({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=ec({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}s&&!l&&Et({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...Z}}function sie({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:r,tieFormatName:n,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:m,valueGoal:h}=Vh(l);l.winCriteria=He({aggregateValue:m,valueGoal:h}),(e&&e!==h||m&&!r)&&(n?l.tieFormatName=n:delete l.tieFormatName);let{targetMatchUps:f}=iCe({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:c,matchUp:u});rCe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:f,drawDefinition:a,tieFormat:l,event:p});let g=He(l),v=Kn({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:Ce};return pi({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...Z}}function lie({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:c}){var u;if(!e)return{error:Ve};if(isNaN(e))return{error:oe};let d="removeCollectionGroup",p=s?void 0:op({drawDefinition:r,structureId:a,matchUpId:o,eventId:l,event:c});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;s=s??(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=h==null?void 0:h.winCriteria.aggregateValue,v=Vr(h);if(p=Kn({tieFormat:v}),p.error)return ee({result:p,stack:d});let I=[];if(v.collectionDefinitions=v.collectionDefinitions.map(y=>{let{collectionGroupNumber:b,...S}=y;return b!==e?y:(I.push(y.collectionId),S)}),v.collectionGroups=v.collectionGroups.filter(({groupNumber:y})=>y!==e),p=sie({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:g,tournamentRecord:i,drawDefinition:r,tieFormatName:n,structureId:a,structure:m,tieFormat:v,matchUpId:o,matchUp:s,eventId:l,event:c}),!p.error){let{appliedPolicies:y}=Gt({tournamentRecord:i});if((u=y==null?void 0:y.audit)!=null&&u[Lm]){let b=He({drawId:r==null?void 0:r.drawId,collectionGroupNumber:e,action:d,structureId:a,matchUpId:o,eventId:l});eE({drawDefinition:r,auditData:b})}}return ee({result:{...p,modifiedCollectionIds:I},stack:d})}function mg({tieFormat:t,orderMap:e}){let i=Vr(t);return i.collectionDefinitions.forEach(r=>{let n=e[r.collectionId];n&&(r.collectionOrder=n)}),i.collectionDefinitions.sort((r,n)=>Yf(r.collectionOrder)-Yf(n.collectionOrder)),i}function uie({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:r,orderMap:n,eventId:a,matchUp:o,event:s}){if(typeof n!="object"||!Object.values(n).every(l=>nt(l)))return ee({result:{error:oe},context:{orderMap:n}});if(a&&s!=null&&s.tieFormat)qV({tournamentRecord:t,event:s,orderMap:n});else if(r){let l=e&&gi({drawDefinition:e,matchUpId:r});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:Yn};o!=null&&o.tieFormat&&(o.tieFormat=mg({tieFormat:o.tieFormat,orderMap:n}),Et({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=et({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=mg({tieFormat:c.tieFormat,orderMap:n}),cie({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:n}),pi({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)QM({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else if(s!=null&&s.tieFormat)qV({structureIds:[i],tournamentRecord:t,orderMap:n,event:s});else return{error:on}}else if(e!=null&&e.tieFormat)QM({tournamentRecord:t,drawDefinition:e,orderMap:n,event:s});else return{error:on};return{...Z}}function qV({tournamentRecord:t,structureIds:e,orderMap:i,event:r}){let n=mg({tieFormat:r.tieFormat,orderMap:i});e!=null&&e.length||(r.tieFormat=n);for(let a of r.drawDefinitions??[])QM({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:r})}function QM({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:r,event:n}){let a=e.tieFormat??(n==null?void 0:n.tieFormat),o=mg({tieFormat:a,orderMap:r});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=mg({tieFormat:l.tieFormat??e.tieFormat??(n==null?void 0:n.tieFormat),orderMap:r})),cie({eventId:n==null?void 0:n.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:r}),s.push(l.structureId));pi({drawDefinition:e,structureIds:s})}function cie({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:r,eventId:n}){var a;let o=(a=$t({matchUpFilters:{matchUpTypes:[di]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=mg({tieFormat:s.tieFormat,orderMap:r}),Et({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:n,matchUp:s}))}function G$({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:r,tieFormatName:n,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:c,event:u}){var d,p,m,h,f,g;let v="removeCollectionDefinition",I=c?void 0:op({drawDefinition:r,structureId:o,matchUpId:s,eventId:l,event:u});if(I!=null&&I.error)return ee({result:I,stack:v});let y=I==null?void 0:I.structure;c=c??(I==null?void 0:I.matchUp);let b=I==null?void 0:I.tieFormat,S=Vr(b);if(I=Kn({tieFormat:S}),I.error)return ee({result:I,stack:v});let w=(d=S==null?void 0:S.collectionDefinitions)==null?void 0:d.find(C=>C.collectionId===a);if(!w)return ee({result:{error:on,collectionId:a}});S.collectionDefinitions=S.collectionDefinitions.filter(C=>C.collectionId!==a),w.collectionGroupNumber&&(S.collectionDefinitions=S.collectionDefinitions.map(C=>{let{collectionGroupNumber:O,...k}=C;return k}),S.collectionGroups=S.collectionGroups.filter(({groupNumber:C})=>C!==w.collectionGroupNumber));let{aggregateValue:U,valueGoal:T}=Vh(S);S.winCriteria=He({aggregateValue:U,valueGoal:T});let P=b==null?void 0:b.winCriteria.valueGoal,R=b==null?void 0:b.winCriteria.aggregateValue;(P&&P!==T||U&&!R)&&(n?S.tieFormatName=n:delete S.tieFormatName);let D=[];s&&c?D=[c]:o&&y?D=((p=$t({matchUpFilters:{matchUpTypes:[di]},structure:y}))==null?void 0:p.matchUps)??[]:r?D=((m=Nn({matchUpFilters:{matchUpTypes:[di]},drawDefinition:r}))==null?void 0:m.matchUps)??[]:u&&(D=((h=Qu({matchUpFilters:{matchUpTypes:[di]},drawDefinition:r}))==null?void 0:h.matchUps)??[]);let E=(D||[]).filter(C=>{var O,k,x;let F=(k=(O=C.tieMatchUps)==null?void 0:O.filter(_=>_.collectionId===a))==null?void 0:k.some(_r),$=e&&C.tieFormat?(x=ku({descendant:C.tieFormat,ancestor:S}))==null?void 0:x.different:!1;return t&&!F||!C.winningSide&&C.matchUpStatus!==Zi&&(t||C.matchUpStatus!==Yo&&!_r(C)&&!$)});if(!E.length)return{error:ov};let{appliedPolicies:N}=Gt({tournamentRecord:i});if(s&&c&&t){let C=(f=c.tieMatchUps)==null?void 0:f.filter(O=>O.collectionId===a);for(let O of C??[]){let k=aU({matchUpId:O.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:r,event:u});if(k.error||(k=gi({drawDefinition:r,matchUpId:s}),k.error))return k;c=k==null?void 0:k.matchUp}}let A=[];for(let C of E){for(let O of(C==null?void 0:C.sides)??[])O.lineUp=(O.lineUp??[]).map(k=>({participantId:k.participantId,collectionAssignments:((k==null?void 0:k.collectionAssignments)??[]).filter(x=>x.collectionId!==a)}));if(C.tieMatchUps=(C.tieMatchUps??[]).filter(O=>{let k=O.collectionId===a;return k&&A.push(O.matchUpId),!k}),C.tieFormat&&(C.tieFormat=Vr(S)),t){let O=ec({matchUpId:C.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:r,event:u});if(O.error)return O}Et({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:r,context:v,matchUp:C})}A.length&&Ku({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:A,eventId:u==null?void 0:u.eventId,drawDefinition:r});let M=He(S);if(I=Kn({tieFormat:M}),I.error)return ee({result:I,stack:v});if(l&&u)u.tieFormat=M;else if(s&&c)c.tieFormat=M;else if(y)y.tieFormat=M;else if(r)r.tieFormat=M;else if(!c||!r)return{error:Ce};if(pi({drawDefinition:r,eventId:u==null?void 0:u.eventId}),(g=N==null?void 0:N.audit)==null?void 0:g[Lm]){let C=He({drawId:r==null?void 0:r.drawId,action:v,collectionId:a,structureId:o,matchUpId:s,eventId:l});eE({drawDefinition:r,auditData:C})}return{tieFormat:M,deletedMatchUpIds:A,targetMatchUps:E,...Z}}function die({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:r,collectionIds:n,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(n))return ee({result:{error:Ve},stack:d});let p=l?void 0:op({drawDefinition:r,structureId:o,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return ee({result:p,stack:d});let m=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let h=p==null?void 0:p.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,g=Vr(h);if(p=Kn({tieFormat:g}),p.error)return ee({result:p,stack:d});for(let I of g.collectionDefinitions){let{collectionId:y,collectionGroupNumber:b}=I;if(b&&n.includes(y))return ee({info:"collectionIds cannot be part of other collectionGroups",result:{error:oe},stack:d})}let v=(g.collectionGroups||[]).reduce((I,y)=>y.groupNumber>I?y.groupNumber:I,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(I=>n.includes(I.collectionId)?{...I,collectionGroupNumber:v}:I),g.collectionGroups=[...g.collecitonGroups||[],i],sie({updateInProgressMatchUps:t,originalValueGoal:f,tournamentRecord:e,drawDefinition:r,tieFormatName:a,structureId:o,structure:m,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function H$({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:r,policyDefinitions:n,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:m,uuids:h,event:f}){var g,v,I;let y="addCollectionDefinition",b=Gt({tournamentRecord:r,drawDefinition:s,event:f}).appliedPolicies??{},S=(n==null?void 0:n[Cr])??(b==null?void 0:b[Cr]);a=a??((g=S==null?void 0:S.participants)==null?void 0:g.enforceCategory);let w=(c??((v=S==null?void 0:S.participants)==null?void 0:v.enforceGender))!==!1,U=!!((i??(f==null?void 0:f.category))&&a!==!1),T=!!((o??(f==null?void 0:f.gender))&&w),P=zw({referenceCategory:i??(f==null?void 0:f.category),collectionDefinition:e,referenceGender:o,checkCategory:U,checkGender:T,event:f});if(P.error)return ee({result:P,stack:y});let R=p!=null&&p.tieFormat?void 0:op({drawDefinition:s,structureId:u,matchUpId:d,eventId:m,event:f});if(R!=null&&R.error)return ee({result:{error:R.error},stack:y});let D=R==null?void 0:R.structure;p=p??(R==null?void 0:R.matchUp);let E=(p==null?void 0:p.tieFormat)??(R==null?void 0:R.tieFormat),N=Vr(E);if(R=Kn({tieFormat:N}),R==null?void 0:R.error)return ee({result:{error:R.error},stack:y});if(!e.collectionId)e.collectionId=Yt();else if(N.collectionDefinitions.map(({collectionId:_})=>_).includes(e.collectionId))return ee({context:{collectionId:e.collectionId},result:{error:qK}});N.collectionDefinitions.push(e),N.collectionDefinitions.sort((_,L)=>(_.collectionOrder||0)-(L.collectionOrder||0)).forEach((_,L)=>_.collectionOrder=L+1);let{aggregateValue:A,valueGoal:M}=Vh(N);N.winCriteria=He({aggregateValue:A,valueGoal:M});let C=E==null?void 0:E.winCriteria.valueGoal,O=E==null?void 0:E.winCriteria.aggregateValue;(C&&C!==M||A&&!O)&&(l?N.tieFormatName=l:delete N.tieFormatName);let k=[],x=[],F=[],$=He(N);if(R=Kn({tieFormat:$}),R==null?void 0:R.error)return ee({result:{error:R.error},stack:y});if(m&&f){f.tieFormat=$;for(let _ of f.drawDefinitions??[])if(!_.tieFormat)for(let L of _.structures??[]){if(L.tieFormat)continue;let B=eC({updateInProgressMatchUps:t,collectionDefinition:e,structure:L,uuids:h});x.push(...B.newMatchUps),F.push(...B.targetMatchUps),k.push(L.structureId)}HU({modifiedMatchUps:F,eventId:f==null?void 0:f.eventId,modifiedStructureIds:k,tournamentRecord:r,drawDefinition:s,addedMatchUps:x,stack:y})}else if(u&&D){D.tieFormat=$;let _=eC({updateInProgressMatchUps:t,collectionDefinition:e,structure:D,uuids:h});x.push(..._.newMatchUps),F=_.targetMatchUps,HU({modifiedMatchUps:F,eventId:f==null?void 0:f.eventId,modifiedStructureIds:k,tournamentRecord:r,drawDefinition:s,addedMatchUps:x,stack:y})}else if(d&&p){if(!K0({matchUp:p,updateInProgressMatchUps:t}))return ee({result:{error:tF},stack:y});p.tieFormat=$;let _=jw({collectionDefinition:e,matchUp:p,uuids:h});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(..._),x.push(..._),HU({modifiedMatchUps:[p],eventId:f==null?void 0:f.eventId,modifiedStructureIds:k,tournamentRecord:r,drawDefinition:s,addedMatchUps:x,stack:y})}else if(s){s.tieFormat=$;for(let _ of s.structures??[]){let L=eC({updateInProgressMatchUps:t,collectionDefinition:e,structure:_,uuids:h});k.push(_.structureId),x.push(...L.newMatchUps),F.push(...L.targetMatchUps)}HU({modifiedMatchUps:F,eventId:f==null?void 0:f.eventId,tournamentRecord:r,drawDefinition:s,addedMatchUps:x,stack:y})}else return{error:Ce};if((I=b==null?void 0:b.audit)!=null&&I[Lm]){let _=He({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:y,structureId:u,matchUpId:d,eventId:m});eE({drawDefinition:s,auditData:_})}return{tieFormat:$,targetMatchUps:F,addedMatchUps:x,...Z}}function eC({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:r}){var n;let a=[],o=((n=$t({matchUpFilters:{matchUpTypes:[di]},structure:i}))==null?void 0:n.matchUps).filter(s=>K0({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=jw({collectionDefinition:e,matchUp:s,uuids:r});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function HU({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:r,addedMatchUps:n,eventId:a,stack:o}){Lc({tournamentId:e==null?void 0:e.tournamentId,matchUps:n,drawDefinition:r,eventId:a}),i==null||i.forEach(s=>{Et({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:r,context:o,matchUp:s,eventId:a})}),pi({structureIds:t,drawDefinition:r,eventId:a})}function pie({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:r,drawDefinition:n,structureId:a,matchUpId:o,eventId:s,uuids:l,event:c}){let u="modifyTieFormat";if(!Kn({tieFormat:i}).valid)return ee({result:{error:tu},info:"falied validation",stack:u});let d=op({drawDefinition:n,structureId:a,matchUpId:o,eventId:s,event:c});if(d.error)return ee({result:d,stack:u});let{matchUp:p,tieFormat:m}=d,h=Vr(m),f=ku({descendant:i,ancestor:h});if(f.invalid)return ee({context:{invalid:f.invalid},result:{error:tu},stack:u});if(!(f!=null&&f.different))return ee({result:{...Z},info:"Nothing to do",stack:u});let g=h.collectionDefinitions.map(({collectionId:T})=>T),v=i.collectionDefinitions.map(({collectionId:T})=>T),I=g.filter(T=>!v.includes(T)),y=i.collectionDefinitions.filter(({collectionId:T})=>!g.includes(T)),b=y.map(ga("collectionId")),S=[],w,U=i.tieFormatName;for(let T of i.collectionDefinitions){if(b.includes(T.collectionId))continue;let P=j$({updateInProgressMatchUps:t,...T,tournamentRecord:r,tieFormatName:U,drawDefinition:n,structureId:a,matchUpId:o,eventId:s,event:c});if(P.modifications&&S.push(...P.modifications),P.error)return ee({result:P,stack:u});P.tieFormat&&(w=P.tieFormat)}for(let T of y){let P=H$({updateInProgressMatchUps:t,collectionDefinition:T,tournamentRecord:r,drawDefinition:n,tieFormatName:U,structureId:a,matchUpId:o,matchUp:p,eventId:s,uuids:l,event:c});if(P.error)return ee({result:P,stack:u});P.tieFormat&&(w=P.tieFormat)}for(let T of I){let P=G$({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:r,drawDefinition:n,tieFormatName:U,collectionId:T,structureId:a,matchUpId:o,eventId:s,matchUp:p,event:c});if(P.error)return ee({result:P,stack:u});P.tieFormat&&(w=P.tieFormat)}return(m==null?void 0:m.tieFormatName)!==U?(w.tieFormatName=U,S.push({tieFormatName:U})):(S.length||b.length||I.length)&&(delete w.tieFormatName,S.push("tieFormatName removed: modifications without new tieFormatName")),w.collectionDefinitions=w.collectionDefinitions.sort((T,P)=>Yf(T.collectionOrder)-Yf(P.collectionOrder)).map((T,P)=>({...T,collectionOrder:P+1})),{processedTieFormat:Vr(w),modifications:S,...Z}}function mie({tournamentRecord:t}){if(!t)return{error:he};let e=0;for(let i of t.events??[]){let r=i.tieFormats??[],n=u=>{if(!u.tieFormat)return;let d;for(let p of r)ku({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=Fe(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Yt()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,r.push(p),e+=1}},a=i.eventType;n({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){n({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])n({tieFormat:d.tieFormat,eventType:a})}let o=(u,d)=>{var p;let m=(p=l.matchUps)==null?void 0:p.find(h=>h.matchUpId===u);m&&(m.tieFormatId=d,delete m.tieFormat,Et({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:m}))},s=u=>{let d=Fe(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Yt()),r.push(d),e+=1,o(u.matchUpId,d.tieFormatId)},l=Qu({matchUpFilters:{matchUpTypes:[Zs]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of r)u.tieFormat&&ku({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(u.matchUpId,d):s(u)}r.length&&(i.tieFormats=r)}return{...Z,addedCount:e}}var hie={};yt(hie,{addDrawDefinitionExtension:()=>CP,addEventExtension:()=>sd,addEventTimeItem:()=>_h,addExtension:()=>Mt,addNotes:()=>iR,addOnlineResource:()=>Iie,addParticipantExtension:()=>M9,addParticipantTimeItem:()=>GL,addTimeItem:()=>ud,addTournamentExtension:()=>kF,addTournamentTimeItem:()=>Lh,analyzeDraws:()=>Yw,analyzeTournament:()=>__,getAllowedDrawTypes:()=>UR,getAllowedMatchUpFormats:()=>x_,getAppliedPolicies:()=>Gt,getCompetitionDateRange:()=>TR,getCompetitionPenalties:()=>F_,getPolicyDefinitions:()=>Ju,getTournamentInfo:()=>Bh,getTournamentPenalties:()=>SR,getTournamentPersons:()=>L_,getTournamentStructures:()=>VL,getTournamentTimeItem:()=>Ew,mutate:()=>fie,query:()=>DQ,removeDrawDefinitionExtension:()=>N9,removeEventExtension:()=>MP,removeExtension:()=>In,removeNotes:()=>rX,removeParticipantExtension:()=>A9,removeTournamentExtension:()=>xF,setTournamentCategories:()=>wie,setTournamentDates:()=>tE,setTournamentEndDate:()=>Sie,setTournamentName:()=>yie,setTournamentNotes:()=>bie,setTournamentStartDate:()=>Uie,setTournamentStatus:()=>vie});var fie={};yt(fie,{addDrawDefinitionExtension:()=>CP,addEventExtension:()=>sd,addEventTimeItem:()=>_h,addExtension:()=>Mt,addNotes:()=>iR,addOnlineResource:()=>Iie,addParticipantExtension:()=>M9,addParticipantTimeItem:()=>GL,addTimeItem:()=>ud,addTournamentExtension:()=>kF,addTournamentTimeItem:()=>Lh,removeDrawDefinitionExtension:()=>N9,removeEventExtension:()=>MP,removeExtension:()=>In,removeNotes:()=>rX,removeParticipantExtension:()=>A9,removeTournamentExtension:()=>xF,setTournamentCategories:()=>wie,setTournamentDates:()=>tE,setTournamentEndDate:()=>Sie,setTournamentName:()=>yie,setTournamentNotes:()=>bie,setTournamentStartDate:()=>Uie,setTournamentStatus:()=>vie});var nCe="ABANDONED",aCe="ACTIVE",oCe="CANCELLED",sCe="COMPLETED",lCe="IN_PROGRESS",gie={ABANDONED:nCe,ACTIVE:aCe,CANCELLED:oCe,COMPLETED:sCe,IN_PROGRESS:lCe};function vie({tournamentRecord:t,status:e}){return t?e&&!Object.keys(gie).includes(e)?{error:oe,info:"Unknown status"}:(t.tournamentStatus=e,{...Z}):{error:he}}function Iie({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:r,personId:n,courtId:a,venueId:o}){var s,l,c;if(!t)return{error:he};if(!Ii(e))return{error:Ve};if(Hi(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return ee({result:{error:qu},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return ee({result:{error:on}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(r||n){let u=(t.participants??[]).find(d=>{var p;return n&&((p=d.person)==null?void 0:p.personId)===n||d.participantId===r});if(!u)return ee(n?{result:{error:on}}:{result:{error:Ji}});if(n){if(((l=u.person)==null?void 0:l.personId)!==n)return ee({result:{error:rv}});u.person.onlineResources||(u.person.onlineResources=[]),u.person.onlineResources.push(e)}else u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(a){let u=(c=(t.venues??[]).filter(d=>!o||d.venueId===o).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===a)))==null?void 0:c[0];if(!u)return ee({result:{error:ew}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(o){let u=(t.venues??[]).find(d=>d.venueId===o);if(!u)return ee({result:{error:av}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...Z}}function yie({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:r}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),r&&(t.formalName=r),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...Z}):{error:he}}function bie({tournamentRecord:t,notes:e}){return t?iR({element:t,notes:e}):{error:he}}function wie({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...Z}):{error:he}}function uCe({tournamentRecord:t}){var e,i;if(!t)return{error:he};let{startDate:r,endDate:n}=t,a=Kf(r,n),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,m)=>{let h=Pt(p.startTime),f=Pt(p.endTime);return m.startTime&&Pt(m.startTime)<h&&(p.startTime=m.startTime),m.endTime&&Pt(m.endTime)>f&&(p.endTime=m.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=a.map(p=>{var m;return((m=s.dateAvailability)==null?void 0:m.find(h=>h.date===p))??{date:p,startTime:l,endTime:c}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...Z}}function tE(t){var e;let{tournamentRecord:i,startDate:r,endDate:n}=t,a=kt(t,[{tournamentRecord:!0},{[RF]:{startDate:!1,endDate:!1},[_l]:Tn,[is]:p=>$l.test(p)}]);if(a.error)return a;if(n&&r&&new Date(n)<new Date(r))return{error:oe};let o;(r&&i.startDate&&new Date(r)>new Date(i.startDate)||n&&i.endDate&&new Date(n)<new Date(i.endDate))&&(o=!0);let s=Kf(i.startDate,i.endDate);r&&(i.startDate=r),n&&(i.endDate=n);let l=Kf(i.startDate,i.endDate),c=s.filter(p=>!l.includes(p)),u=l.filter(p=>!s.includes(p));for(let p of i.events??[])r&&p.startDate&&new Date(r)>new Date(p.startDate)&&(p.startDate=r),n&&p.endDate&&new Date(n)<new Date(p.endDate)&&(p.endDate=n);r&&i.endDate&&new Date(r)>new Date(i.endDate)&&(i.endDate=r),n&&i.startDate&&new Date(n)<new Date(i.startDate)&&(i.startDate=n);let d=o&&((e=cCe({tournamentRecord:i}))==null?void 0:e.unscheduledMatchUpIds);return uCe({tournamentRecord:i}),Tt({topic:a8,payload:{startDate:r,endDate:n}}),{...Z,unscheduledMatchUpIds:d,datesAdded:u,datesRemoved:c}}function Uie({tournamentRecord:t,startDate:e}){return tE({tournamentRecord:t,startDate:e})}function Sie({tournamentRecord:t,endDate:e}){return tE({tournamentRecord:t,endDate:e})}function cCe({tournamentRecord:t}){let e=Lr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),r=t.endDate&&new Date(t.endDate),n=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||r&&c>r)&&(a.push(l),n.includes(s.scheduledDate)||n.push(s.scheduledDate))}}return n.length&&!JR({scheduledDates:n,tournamentRecord:t}).clearedScheduleCount?{error:J7}:{unscheduledMatchUpIds:a}}var Tie={};yt(Tie,{addCourt:()=>QR,addCourts:()=>$$,addVenue:()=>Dw,deleteCourt:()=>Oie,deleteVenue:()=>Y$,deleteVenues:()=>Eie,disableCourts:()=>Cie,disableVenues:()=>Mie,enableCourts:()=>Nie,enableVenues:()=>Aie,generate:()=>Die,generateCourts:()=>f$,getCompetitionVenues:()=>Xw,getCourts:()=>i$,getVenuesAndCourts:()=>tc,modifyCourt:()=>K$,modifyCourtAvailability:()=>W$,modifyVenue:()=>kie,mutate:()=>Pie,publicFindVenue:()=>vL,query:()=>BQ});var Die={};yt(Die,{generateCourts:()=>f$});var Pie={};yt(Pie,{addCourt:()=>QR,addCourts:()=>$$,addVenue:()=>Dw,deleteCourt:()=>Oie,deleteVenue:()=>Y$,deleteVenues:()=>Eie,disableCourts:()=>Cie,disableVenues:()=>Mie,enableCourts:()=>Nie,enableVenues:()=>Aie,modifyCourt:()=>K$,modifyCourtAvailability:()=>W$,modifyVenue:()=>kie});function z$(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:he};if(!(t!=null&&t.courtId))return{error:bh};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r,venueMatchUps:n,courtId:a}=t,{schedulingProfile:o}=ic({tournamentRecord:i});if(Array.isArray(n))return{matchUps:l({matchUps:n,courtId:a})};let{matchUps:s}=Lr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:r});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var m,h,f;let g=(h=(m=p.schedule)==null?void 0:m.allocatedCourts)==null?void 0:h.map(({courtId:v})=>v);return((f=p.schedule)==null?void 0:f.courtId)===u||(g==null?void 0:g.includes(u))});return H0({matchUps:d,schedulingProfile:o})}}function dCe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:r}){if(!e)return{error:he};if(!r)return{error:rd};let{schedulingProfile:n}=ic({tournamentRecord:e}),{matchUps:a}=Lr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:r})};function o({matchUps:s,venueId:l}){let c=s.filter(u=>{var d,p,m;let h=(p=(d=u.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:f})=>f);return((m=u.schedule)==null?void 0:m.venueId)===l||(h==null?void 0:h.includes(l))});return H0({matchUps:c,schedulingProfile:n})}}function W$({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:r,courtId:n,force:a}){var o,s,l;if(!t)return{error:he};if(!n)return{error:bh};let c=dte({dateAvailability:e});if(c.error)return c;let{updatedDateAvailability:u,totalMergeCount:d}=pCe(e);e=u;let p=Mh({tournamentRecord:t,courtId:n});if(p.error)return p;let{court:m,venue:h}=p,{matchUps:f}=z$({tournamentRecord:t,venueMatchUps:r,courtId:n});if(f!=null&&f.length){let g=(o=Gt({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[od])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),I=[];I.length&&(v||console.log("throw error: scheduled court matchUps",I.length))}return m&&(m.dateAvailability=e,!i&&h&&Tt({payload:{venue:h,tournamentId:t.tournamentId},topic:Sp,key:h.venueId})),{...Z,totalMergeCount:d}}function pCe(t){let e=0,i=t.reduce((n,a)=>{let{date:o,startTime:s,endTime:l,bookings:c}=a;return n[o]||(n[o]=[]),n[o].push({startTime:s,endTime:l,bookings:c}),n},{}),r=[];return Object.keys(i).forEach(n=>{i[n].sort(FEe);let{mergedAvailability:a,mergeCount:o}=mCe(i[n]);r.push(...a.map(s=>({date:n,...s}))),e+=o}),{updatedDateAvailability:r,totalMergeCount:e}}function mCe(t){let e,i,r,n=t.length,a=0,o=[];for(;t.length&&n;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(n-=1,!e)e=c,r=d,i=u;else if(aw(er(i),er(c),!1)>0){let p={startTime:e,endTime:i};r!=null&&r.length&&(p.bookings=r),o.push(p),e=c,r=d,i=u}else d&&(r?r.push(d):r=d),i=u,a+=1}let s={startTime:e,endTime:i};return r!=null&&r.length&&(s.bookings=r),o.push(s),{mergedAvailability:o,mergeCount:a}}function q$({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:ZK,info:e}}function Rie({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:r}){let n="removeCourtAssignment";if(!i)return{error:Xr};if(!e&&!r)return{error:Ps};let a;if(!e){if(!t)return{error:he};({drawDefinition:e}=xn({tournamentRecord:t,drawId:r}))}if(e)({matchUp:a}=gi({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:he};let o=Lr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=iX({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[Qd,Au].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![Qd,Au].includes(o)),Et({tournamentId:t==null?void 0:t.tournamentId,context:n,drawDefinition:e,matchUp:a})),{...Z}):{error:an}}function Y$(t){var e,i,r;if(typeof(t==null?void 0:t.venueId)!="string")return{error:rd};let{tournamentRecord:n,venueId:a,force:o}=t,s=t.tournamentRecords||n&&{[n.tournamentId]:n}||{};if(!Object.keys(s).length)return{error:he};let l=Us({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],c=(e=Gt({tournamentRecord:n}))==null?void 0:e.appliedPolicies,u=o??((r=(i=c==null?void 0:c[od])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:r.venues);if(!l.length||u)for(let d of Object.values(s)){for(let m of l){let h=Rie({matchUpId:m.matchUpId,drawId:m.drawId,tournamentRecord:d});if(h.error)return h}let p;d.venues=(d.venues??[]).filter(m=>(m==null?void 0:m.venueId)!==a?!0:(p=!0,!1)),p&&Tt({payload:{venueId:a,tournamentId:d.tournamentId},topic:XF,key:a})}else return q$({matchUpsCount:l.length});return Qw({tournamentRecords:s}),{...Z}}function Eie({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:he};if(!Array.isArray(e))return{error:oe};for(let r of t.venues||[]){let{venueId:n}=r;if(e.includes(n)){let{venueId:a}=r,o=Y$({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...Z}}function Cie(t){let{courtIds:e,dates:i}=t,r=ll(t),n=[{[sn]:!0,[RP]:!0}],a=kt(t,n);if(a.error)return a;for(let o of Object.values(r))hCe({tournamentRecord:o,courtIds:e,dates:i});return{...Z}}function hCe({tournamentRecord:t,courtIds:e,dates:i}){let r=Array.isArray(i)&&i.length?{dates:i}:!0,n=a=>Mt({extension:{value:r,name:cs},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=n(o);if(s.error)return s}return{...Z}}function Mie(t){let{tournamentRecords:e,tournamentId:i,venueIds:r}=t,n=[{[sn]:!0,[EP]:!0}],a=kt(t,n);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];fCe({tournamentRecord:l,venueIds:r})}return{...Z}}function fCe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let r=Mt({creationTime:!1,element:i,extension:{name:cs,value:!0}});if(r.error)return r}return{...Z}}function Nie(t){let e=ll(t),i=[{[sn]:!0}];!t.enableAll&&i.push({[RP]:!0});let r=kt(t,i);if(r.error)return r;let{enableAll:n,courtIds:a,dates:o}=t;for(let s of Object.values(e))gCe({tournamentRecord:s,courtIds:a,enableAll:n,dates:o});return{...Z}}function gCe({tournamentRecord:t,courtIds:e,enableAll:i,dates:r}){for(let n of t.venues||[])for(let a of n.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(r)){let{extension:o}=ft({element:a,name:cs});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!r.includes(l))),Mt({extension:{name:cs,value:s},creationTime:!1,element:a})}}else In({element:a,name:cs});return{...Z}}function Aie(t){let e=ll(t),i=[{[sn]:!0}];!t.enableAll&&i.push({[EP]:!0});let r=kt(t,i);if(r.error)return r;let{venueIds:n,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||n!=null&&n.includes(s.venueId))&&In({element:s,name:cs});return{...Z}}function Oie(t){let{courtId:e,disableNotice:i,force:r}=t,n=ll(t),a=kt(t,[{[sn]:!0,[w9]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(n)){if(s=vCe({tournamentRecord:l,disableNotice:i,courtId:e,force:r}),s.error&&s.error!==ew)return s;s.success&&(o=!0)}return o?{...Z}:s}function vCe({tournamentRecord:t,disableNotice:e,courtId:i,force:r}){var n,a,o;let s=Mh({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:c}=z$({tournamentRecord:t,courtId:i}),u=(n=Gt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,d=r??((o=(a=u==null?void 0:u[od])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(c!=null&&c.length)||d){for(let p of c??[]){let m=Rie({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(m.error)return m}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||Tt({payload:{venue:l,tournamentId:t.tournamentId},topic:Sp,key:l.venueId}))}else return q$({matchUpsCount:c.length});return{...Z}}function K$(t){let{disableNotice:e,modifications:i,courtId:r,force:n,venueMatchUps:a}=t,o=ll(t);if(!Object.keys(o).length)return{error:Ai};let s,l;for(let c of Object.values(o)){let u=ICe({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:r,force:n});if(u!=null&&u.error)return u;s=!0}return s?{...Z}:l}function ICe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:r,courtId:n,force:a}){if(!t)return{error:he};if(!n)return{error:bh};if(!r||typeof r!="object")return{error:qu};let o=Mh({tournamentRecord:t,courtId:n});if(o.error)return o;let{venue:s,court:l}=o,c=Object.keys(xEe()).filter(p=>p!=="courtId");if(!Object.keys(r).filter(p=>c.includes(p)).length)return{error:wP};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(r).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:r[p]})),r.dateAvailability){let p=W$({dateAvailability:r.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:n,force:a});if(p.error)return p}return e||Tt({payload:{venue:s,tournamentId:t.tournamentId},topic:Sp,key:s==null?void 0:s.venueId}),{...Z,court:Fe(l)}}var yCe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),bCe=yCe;function kie(t){let{modifications:e,venueId:i,force:r}=t,n=ll(t);if(!Object.keys(n).length)return{error:Ai};if(typeof i!="string")return{error:rd};let a,o;for(let s of Object.values(n)){let l=wCe({tournamentRecord:s,modifications:e,venueId:i,force:r});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==av)return l}return Qw({tournamentRecords:n}),o?{...Z}:{error:a}}function wCe({tournamentRecord:t,modifications:e,venueId:i,force:r}){var n,a,o,s,l,c,u,d;if(!t)return{error:he};if(!e||typeof e!="object")return{error:qu};if(!i)return{error:rd};let p=(n=Gt({tournamentRecord:t}))==null?void 0:n.appliedPolicies,m=r??((o=(a=p==null?void 0:p[od])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:h}=dCe({tournamentRecord:t,venueId:i}),f=Xu({tournamentRecord:t,venueId:i});if(f.error)return f;let g=f.venue,v=Object.keys(bCe()).filter(T=>T!=="venueId");if(!Object.keys(e).filter(T=>v.includes(T)).length)return{error:wP};let I=v.filter(T=>!["courts","onlineResources"].includes(T)),y=Object.keys(e).filter(T=>I.includes(T));g&&y.forEach(T=>Object.assign(g,{[T]:e[T]}));let b=((s=g==null?void 0:g.courts)==null?void 0:s.map(T=>T.courtId))??[],S=((l=e.courts)==null?void 0:l.map(T=>T.courtId))||[],w=S.length?b.filter(T=>!S.includes(T)):(e==null?void 0:e.courts)&&b,U=[];if(w!=null&&w.length){let T=(u=(c=g==null?void 0:g.courts)==null?void 0:c.filter(P=>w.includes(P.courtId)))==null?void 0:u.map(P=>{var R;let D=z$({courtId:P.courtId,tournamentRecord:t,venueMatchUps:h});for(let E of D.matchUps??[])U.push({matchUpId:E.matchUpId,drawId:E.drawId});return((R=D.matchUps)==null?void 0:R.length)??0}).reduce((P,R)=>P+R);if(g&&(!T||m))g.courts=(d=g.courts)==null?void 0:d.filter(P=>S.includes(P.courtId)),wy({schedule:{courtId:"",scheduledDate:""},matchUpDetails:U,removePriorValues:!0,tournamentRecord:t});else return q$({matchUpsCount:T})}if(e.courts)for(let T of e.courts){let{courtId:P}=T||{},R=K$({modifications:T,disableNotice:!0,tournamentRecord:t,venueMatchUps:h,courtId:P,force:r});if(R.error===ew&&(R=QR({disableNotice:!0,tournamentRecord:t,venueId:i,court:T})),R.error)return R}return Qw({tournamentRecord:t}),g&&Tt({payload:{venue:g,tournamentId:t.tournamentId},topic:Sp,key:g==null?void 0:g.venueId}),{...Z,venue:Fe(g)}}var J$={};yt(J$,{JSON2CSV:()=>RCe,UUID:()=>Yt,UUIDS:()=>YUe,allNumeric:()=>o9,attributeFilter:()=>km,chunkArray:()=>xr,chunkByNth:()=>lM,chunkSizeProfile:()=>a9,constantToString:()=>zr,countValues:()=>rwe,createMap:()=>q7,dateTime:()=>Hwe,definedAttributes:()=>He,dehydrateMatchUps:()=>SCe,extractAttributes:()=>c8,flattenJSON:()=>X$,generateDateRange:()=>Kf,generateHashCode:()=>Ibe,generateRange:()=>Ee,generateTimeCode:()=>yte,groupValues:()=>r9,hasAttributeValues:()=>vbe,instanceCount:()=>fa,intersection:()=>Hi,isConvertableInteger:()=>nt,isNumeric:()=>ki,isOdd:()=>t9,isPowerOf2:()=>ws,makeDeepCopy:()=>Fe,matchUpSort:()=>Ah,nearestPowerOf2:()=>gF,nextPowerOf2:()=>sv,noNulls:()=>iwe,noNumeric:()=>s9,numericSort:()=>sr,occurrences:()=>awe,overlap:()=>Dn,randomMember:()=>Uo,randomPop:()=>ra,shuffleArray:()=>hn,structureSort:()=>Rh,subSort:()=>owe,undefinedToNull:()=>Z1,unique:()=>ht,visualizeScheduledMatchUps:()=>UCe});function UCe({scheduledMatchUps:t,showGlobalLog:e}){ESe();let i=t==null?void 0:t.reduce((n,{structureId:a})=>n.includes(a)?n:n.concat(a),[]),r=Array.isArray(i)&&{...i.map(n=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===n);return{[n]:`${a} ${o}`}})};i==null||i.forEach(n=>{var a;Qa({color:"blue",method:"draw",structure:r[n],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===n),s=((a=Pn({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{Qa({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:c,schedule:u})=>{let d=fi(u.scheduledTime);Qa({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&RSe()}function SCe({tournamentRecord:t}){if(!t)return{error:he};if(typeof t!="object"||!t.tournamentId)return{error:oe};let{matchUps:e}=Lr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=TCe({tournamentRecord:t});PCe(e,i)}return{...Z}}function TCe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let r of i.drawDefinitions||[]){r.matchUpFormat&&(e[r.drawId]=r.matchUpFormat);for(let n of r.structures||[]){n.matchUpFormat&&(e[n.structureId]=n.matchUpFormat);for(let a of n.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var DCe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function PCe(t,e={}){for(let i of t){let{structureId:r,drawId:n,eventId:a}=i,o=e[r]||e[n]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))DCe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function RCe(t,e){if(e&&typeof e!="object")return{error:oe};let{columnTransform:i={}}=e||{},{includeTransformAccessors:r,includeHeaderRow:n=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:m='"',columnJoiner:h=",",rowJoiner:f=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof h!="string"||typeof f!="string"||typeof g!="string"||typeof m!="string")return{error:oe};i=Object.assign({},...Object.keys(i).reverse().map(A=>({[A]:Array.isArray(i[A])?i[A]:[typeof i[A]=="string"&&i[A]].filter(Boolean)})));let v=t.filter(Boolean).map(A=>X$(A,g)),I=Object.values(i).flat();r&&l.push(...I);let y=v.reduce((A,M)=>Object.keys(M).every(C=>!A.includes(C)&&A.push(C)||!0)&&A,[]).filter(A=>!(l!=null&&l.length)||l.includes(A)),b=Object.assign({},...Object.keys(i).reverse().map(A=>i[A].map(M=>({[M]:A})).flat()).flat()),S=(A,M)=>e!=null&&e.sortOrder?e.sortOrder.includes(A)&&e.sortOrder.includes(M)&&e.sortOrder.indexOf(A)-e.sortOrder.indexOf(M)||!e.sortOrder.includes(M)&&-1:0,w=y.reduce((A,M)=>{let C=b[M];return C?A.includes(C)||A.push(C):A.push(M),A},[]).sort(S);Object.keys(u).forEach(A=>!w.includes(A)&&w.unshift(A)),Object.keys(i).forEach(A=>!w.includes(A)&&w.unshift(A)),typeof p=="object"&&Object.keys(p).forEach(A=>!w.includes(A)&&w.unshift(A));let U=w.map(A=>u[A]||A);if(s)return[U];let T=A=>`${m}${A}${m}`,P=[],R=A=>Object.values(w.reduce((M,C,O)=>{var k;let x=i[C],F=(x!=null&&x.length?A[x.find(L=>A[L])]:A[C])||(p==null?void 0:p[C])||"",$=((k=d[C])==null?void 0:k[F])||F,_=ta(c[C])?c[C]($):$;return M[C]=T(_),_&&(P[O]=(P[O]||0)+1),M},{})),D=v.map(R),E=o&&[...P].map((A,M)=>!A&&M).filter(ki).reverse();if(E){let A=M=>M.filter((C,O)=>!E.includes(O));D=D.map(A),U=A(U)}let N=D.map(A=>A.join(h));return a?N.map(A=>{let M=A.split(h);return Object.assign({},...M.map((C,O)=>({[U[O]]:C})))}):n?[U.map(T).join(h),...N].join(f):N.join(f)}function X$(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((r,n)=>typeof t[n]!="object"?(r[i.concat(n).join(e)]=t[n],r):Object.assign(r,X$(t[n],e,i.concat(n))),{})}var{FACTORY:YV}=k9;function ECe({tournamentRecord:t,value:e}){let{extension:i}=ft({element:t,name:YV}),r={name:YV,value:{...i==null?void 0:i.value,...e}};Mt({element:t,extension:r})}function xie({timeStamp:t}){let e=Sh(),i=IF();return i&&Object.values(e).forEach(r=>{ECe({tournamentRecord:r,value:{version:dP(),timeStamp:t}})}),i}function Fie({engineType:t,methodName:e,elapsed:i,params:r,result:n}){var a,o;let s=no();if(typeof s!="object")return;let l={method:e},c=(n==null?void 0:n.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),u=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||u,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(c||d)&&(l.params=r),!p&&(c||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||u)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=n),Object.keys(l).length>1&&g9(l,t)}function Z$({methodName:t,params:e,start:i}){let r={error:SP,methodName:t},n=i?Date.now()-i:0;return Fie({result:r,methodName:t,elapsed:n,params:e,engineType:"sync"}),r}function CCe(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:he};let r=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(r){let{event:o,drawDefinition:s,tournamentId:l}=xn({tournamentRecords:t,drawId:r});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=xn({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:ha};e.tournamentId=s,e.event=o}let n=e.tournamentId??Uh();if(!n&&e)return e;let a=t[n];return n&&!a?{error:he}:(a&&(e.tournamentRecord=a),e)}function Q$(t,e,i,r,n){delete t.success,delete t.error;let a=Date.now(),o=Uh();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||bF(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||Sh(),c=i?Fe(i,void 0,!0):void 0,u=i?CCe(l,i):void 0;if(u!=null&&u.error)return u;let d=MCe({params:u,tournamentRecords:l,tournamentRecord:s,methodName:r,method:e}),p=Date.now()-a;return Fie({result:d,methodName:r,elapsed:p,params:c,engineType:n}),d}function MCe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:r,method:n}){if(no())return n({tournamentRecords:t,tournamentRecord:e,...i});try{return n({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return PP({engineName:"engine",methodName:r,params:i,err:a})}}function iE(t){let{mutationStatus:e,tournamentId:i,directives:r,timeStamp:n}=t||{},{topics:a}=qo();for(let o of[...a].sort(NCe)){let s=m9({topic:o});s!=null&&s.length&&uM({topic:o,notices:s})}e&&n&&a.includes(hM)&&uM({notices:[{tournamentId:i,directives:r,timeStamp:n}],topic:hM})}var KV={[aL]:5,[nL]:5,[oL]:5,[rL]:5,[iL]:5,[eL]:5,[r8]:5,[n8]:5,[tL]:1,[$P]:1,[Kr]:5,[Sp]:5,[QF]:4,[JF]:4,[XF]:4,[ZF]:4,[_P]:3,[qF]:2};function NCe(t,e){return(KV[e]||0)-(KV[t]||0)}function ACe({convertExtensions:t,removeExtensions:e}){let i=Sh();return{tournamentId:Uh(),tournamentRecords:Fe(i,t,!1,e)}}function OCe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},r=(t==null?void 0:t.tournamentId)??Uh();if(typeof r!="string")return{};let n=bF(r);return{tournamentRecord:Fe(n,e,!1,i)}}function kCe(){var t;let e=Sh(),{extension:i}=ft({name:xm,tournamentRecords:e,discover:!0}),r=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(n=>{r.includes(n)||delete e[n]}),DP(e)}function JV(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:qu}:t!=null&&t.tournamentId?h9(e?Fe(t):t):{error:oe}}function rE(t,e=!0){if(typeof t!="object")return{error:qu};if(ZI(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:tM};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},ZI(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:tM};return DP(e?Fe(t):t)}function xCe(t,e,i,r,n,a){let o=v9(i,r,n,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ta(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(no())return u();try{return u()}catch(d){PP({engineName:"engine",methodName:l,params:c,err:d})}}}),{...Z,...t}}function Zh(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Lie(t,e){t.importMethods=(i,r,n,a)=>xCe(t,e,i,r,n,a),t.getTournament=i=>OCe(i),t.getState=i=>ACe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>dP(),t.reset=()=>(DP({}),Zh(t)),t.devContext=i=>(JI(i),Zh(t)),t.getDevContext=i=>no(i),t.newTournamentRecord=(i={})=>{let r=Kee(i),n=r.tournamentId;return r.error?r:(JV(r),ZI(n),{...Z,tournamentId:n})},t.setState=(i,r,n)=>{XI(r,n);let a=rE(i,r);return Zh(t,a)},t.setTournamentId=i=>ZI(i),t.getTournamentId=()=>Uh(),t.setTournamentRecord=(i,r,n)=>{XI(r,n);let a=JV(i,r);return Zh(t,a)},t.removeTournamentRecord=i=>{let r=f9(i);return Zh(t,r)},t.removeUnlinkedTournamentRecords=()=>{let i=kCe();return Zh(t,i)}}function FCe(t,e,i){if(!Array.isArray(e))return{error:oe,message:"directives must be an array"};let r=p9(),n=Date.now(),a=i&&Fe(Sh(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:oe,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:oe,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!r[u])return Z$({methodName:u,start:n,params:p});if(d){let h=o[o.length-1],f=Object.keys(d);for(let g of f)h[g]&&(p[g]=h[g])}let m=Q$(t,r[u],p,u,"sync");if(m!=null&&m.error)return a&&rE(a),{...m,rolledBack:!!a};o.push({...m,methodName:u})}let s=Date.now(),l=xie({timeStamp:s});return iE({directives:e,mutationStatus:l,timeStamp:s}),iw(),{success:o.every(c=>c.success),results:o}}function XV(t,e){if(!Ii(e))return{error:oe,message:"args must be an object"};let i=Object.values(e).filter(ta).length;if(i>1)return{message:"there must be only one arg with typeof function",error:oe};let r=i?Object.keys(e).find(m=>ta(e[m])):On(e.method)&&e.method;if(!r)return{error:SP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&Fe(Sh(),!1,!0),l=n||t[r]||hF()[r];if(!l)return Z$({methodName:r,params:o});let c=Q$(t,l,o,r,"sync")??{};c!=null&&c.error&&s&&rE(s);let u=Date.now(),d=xie({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&iE({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&iw(),c}var LCe=(()=>{let t={executionQueue:(e,i)=>FCe(t,e,i),execute:e=>XV(t,e)};return Lie(t,XV),t})(),eB=LCe;function ZV(t,e){if(!Ii(e))return{error:oe,message:"args must be an object"};let i=Object.values(e).filter(ta).length;if(i>1)return{message:"there must be only one arg with typeof function",error:oe};let r=i?Object.keys(e).find(l=>ta(e[l])):On(e.method)&&e.method;if(!r)return{error:SP};let{[r]:n,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=n||t[r]||hF()[r];return s?Q$(t,s,o,r,"ask"):Z$({methodName:r,params:o})}(()=>{let t={execute:e=>ZV(t,e)};return Lie(t,ZV),t})();var ym={},gc;function QV(t,e=!0){if(!t)return{error:Ve};if(typeof t!="object")return{error:qu};if(t.matchUpId)gc=t.matchUpId,ym[gc]=e?Fe(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(ym[i.matchUpId]=e?Fe(i):i,gc||(gc=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(ym[i.matchUpId]=e?Fe(i):i,gc||(gc=i.matchUpId));return e?Fe(t):t}function _Ce(){return ym[gc]}function $Ce(){return Object.values(ym)}function BCe(){gc=void 0,ym={}}function VCe(t){return Fe(ym[gc],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:n=>VCe(n),version:()=>dP(),reset:()=>(BCe(),{...Z}),drawId:void 0,error:void 0,success:!1,devContext:n=>(JI(n),t),setState:(n,a,o)=>{XI(a,o);let s=QV(n);return e(s)}};function e(n){return n!=null&&n.error?(t.error=n.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=n.drawId),t}return i([y_]),t;function i(n){n.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(no())return r({params:s,governor:a,methodName:o});try{return r({params:s,governor:a,methodName:o})}catch(l){PP({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function r({params:n,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(n==null?void 0:n.matchUp)||_Ce(),l=(n==null?void 0:n.matchUps)||$Ce(),c=(n==null?void 0:n.rollbackOnError)&&Fe(s,!1,!0);n={...n,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=a[o](n);if(u!=null&&u.error)return c&&QV(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(n==null?void 0:n.delayNotify)!==!0&&(n==null?void 0:n.doNotNotify)!==!0;return d&&iE(),(d||!(u!=null&&u.success)||n!=null&&n.doNotNotify)&&iw(),u}})();var tC=!1;(()=>{let t={version:()=>dP(),setDeepCopy:(r,n)=>(XI(r,n),t),devContext:r=>(JI(r),tC=!0,t)};return i([M$]),t;function e(r,n){let a=r({...n});return a!=null&&a.error||iE(),iw(),tC&&(JI(!1),tC=!1),a}function i(r){r.forEach(n=>{Object.keys(n).forEach(a=>{t[a]=o=>{try{let s=e(n[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&rE(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();eB.importMethods(H7,!0,1);var _ie=eB;function $ie(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function jCe(t){let{participation:e={},awardProfiles:i,startDate:r,eventType:n,drawSize:a,drawType:o,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,m=h=>!r&&!l||!h.dateRanges?!0:h.dateRanges.some(f=>{let g=!r||!f.startDate||new Date(r)>new Date(f.startDate),v=!l||!f.endDate||new Date(l)<=new Date(f.endDate);return g&&v});return{awardProfile:i.find(h=>{var f,g,v,I,y,b,S,w,U,T;return m(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((g=h.drawTypes)==null?void 0:g.includes(o)))&&(!((v=h.drawSizes)!=null&&v.length)||h.drawSizes.includes(a))&&(!((I=h.stages)!=null&&I.length)||h.stages.includes(p))&&(!((y=h.levels)!=null&&y.length)||h.levels.includes(c))&&(!h.maxDrawSize||a<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===a)&&(!h.maxLevel||c<=h.maxLevel)&&(!d||!((S=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&S.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===u)&&(!((w=h.category)!=null&&w.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((U=h.eventTypes)!=null&&U.length)||((T=h.eventTypes)==null?void 0:T.includes(n)))})}}function ej({participantWon:t,flightNumber:e,valueObj:i,drawSize:r,flights:n,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let I=v.find(y=>y.flight===g||y.f===g);return I.value||I.v}if(typeof v=="object"){let I=v.flights||v.f;if(Array.isArray(I))return I[g-1]}}},c=(g,v)=>{let I=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(nt(g)?g:0),y=$ie(a,g==null?void 0:g.level);return{value:l(v,y)||nt(y)&&y||I}},u=0,d,p,m,h,f=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(y=>{var b;return y.drawSize===r||((b=y.drawSizes)==null?void 0:b.includes(r))}),v=i.find(y=>y.drawSize&&y.threshold&&r>y.drawSize),I=i.find(y=>{var b;return!y.drawSize&&!((b=y.drawSizes)!=null&&b.length)});f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f],I=I==null?void 0:I[f]),p=c(g,e).value,m=c(v,e).value,h=c(I,e).value,u=p||m||h,d=p&&g.requireWin||m&&v.requireWin||(I==null?void 0:I.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[r],v=i;f!==void 0&&(g=g==null?void 0:g[f],v=v==null?void 0:v[f]),p=c(g,e).value,h=c(v,e).value,u=p||h,d=p?g.requireWin:v==null?void 0:v.requireWin}else nt(i)&&f===void 0&&(u=i);return e&&(s=n==null?void 0:n.pct)!=null&&s[e]&&(u=Math.round(u*n.pct[e])),{awardPoints:u,requireWin:d}}function GCe({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:r}){var n;if(!i)return{error:he};let{policyDefinitions:a}=Ju({policyTypes:[yS],tournamentRecord:i}),o=(e==null?void 0:e[yS])??(a==null?void 0:a[yS]);if(!o)return{error:hP};let s=o.awardProfiles,l=o.requireWinFirstRound,c=o.requireWinForPoints,{participants:u,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:m}=Wi({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=u==null?void 0:u.filter(I=>{var y;return(y=I.draws)==null?void 0:y.length}),f={},g={},v={};for(let I of h??[]){let{participantType:y,participantId:b,person:S,draws:w}=I;for(let U of w){let{drawId:T,structureParticipation:P,eventId:R}=U,D=d[R],E=p[T],N=E==null?void 0:E.drawType,{category:A,eventType:M}=D||{},C=U.startDate||D.startDate||i.startDate,O=U.endDate||D.endDate||i.endDate;if(M===oo&&b!==Za)continue;let k;if(s){let x=c,F=0,$=0,_=0,L;for(let B of P){let{finishingPositionRange:V,participationOrder:G,participantWon:j,flightNumber:H,rankingStage:W,winCount:Y}=B;F+=Y||0;let q=E==null?void 0:E.drawSize,{awardProfile:re}=jCe({awardProfiles:s,participation:B,eventType:M,startDate:C,category:A,drawSize:q,drawType:N,endDate:O,level:r});if(re){if(!q)continue;let K=Array.isArray(V)&&Math.max(...V),z=ht(V||[]).join("-"),te=K&&W!==qe&&(V==null?void 0:V.includes(q));re.requireWinForPoints!==void 0&&(x=re.requireWinForPoints),re.requireWinFirstRound!==void 0&&(l=re.requireWinFirstRound);let{finishingPositionPoints:J={},finishingPositionRanges:ie,finishingRound:ne,pointsPerWin:ue,flights:ae}=re,ce=Array.isArray(re.perWinPoints)?(n=re.perWinPoints)==null?void 0:n.find(Pe=>{var at;return(at=Pe.participationOrders)==null?void 0:at.includes(G)}):re.perWinPoints,pe=J.participationOrders,Se=0,Be;if((!pe||pe.includes(G))&&ie&&K){let Pe=ie[K];Pe&&({awardPoints:Se,requireWin:Be}=ej({flightNumber:H,valueObj:Pe,drawSize:q,flights:ae,level:r}))}if(!Se&&ne&&G===1&&K){let Pe=ne[K];Pe&&({awardPoints:Se,requireWin:Be}=ej({participantWon:j,flightNumber:H,valueObj:Pe,drawSize:q,flights:ae,level:r}))}if(te&&l!==void 0&&(x=l),Be!==void 0&&(x=Be),Se>$&&(!x||Y)&&($=Se,L=K),!Se&&ue&&Y&&(_+=Y*ue,L=z),!Se&&Y&&ce){let Pe=$ie(r,ce==null?void 0:ce.level);Pe?_+=Y*Pe:ce.value&&(_+=Y*ce.value)}}if(k=$+_,y===Za){let K=(I.matchUps||[]).filter(({structureId:z})=>z===B.structureId);for(let{matchUpId:z}of K){let te=m[z],J=te.sides.find(ie=>ie.participantId===b).sideNumber;if(te.winningSice===J)for(let ie of te.tieMatchUps)ie.winningSide}}}if(_||$){let B={winCount:F,positionPoints:$,rangeAccessor:L,perWinPoints:_,eventType:M,drawId:T,points:k},V=S==null?void 0:S.personId;V?(f[V]||(f[V]=[]),f[V].push(B)):y===st?(v[b]||(v[b]=[]),v[b].push(B)):y===Za&&(g[b]||(g[b]=[]),g[b].push(B))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:v,teamPoints:g,...Z}}var HCe={getTournamentPoints:GCe},zCe=HCe,WCe={calculateNewRatings:BX,generateDynamicRatings:VX},qCe=WCe,YCe={...zCe,...qCe};eB.importMethods(YCe);var KCe={[iy]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},JCe={[Du]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[fm,lI]}},XCe={[Du]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[fm,hy,jm],disabledActions:[]}]}},ZCe={[Du]:{policyName:"positionActionsDisabled",enabledStructures:!1}},QCe={[dv]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},e1e={[Vl]:{defaultMatchUpFormat:Ka,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[Oe]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},t1e={[Vl]:{requireAllPositionsAssigned:!1,stage:{[Oe]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Ka,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Ka,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},i1e={[Io]:{seedingProfile:{positioning:kP},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},r1e={POLICY_AVOIDANCE_COUNTRY:KCe,POLICY_POSITION_ACTIONS_DEFAULT:bX,POLICY_POSITION_ACTIONS_DISABLED:ZCe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:XCe,POLICY_POSITION_ACTIONS_UNRESTRICTED:JCe,POLICY_PRIVACY_DEFAULT:QCe,POLICY_ROUND_NAMING_DEFAULT:yL,POLICY_SCHEDULING_DEFAULT:_Q,POLICY_SCORING_DEFAULT:e1e,POLICY_SCORING_USTA:t1e,POLICY_SEEDING_ITF:i1e,POLICY_SEEDING_DEFAULT:UQ},n1e={ratingsParameters:Ta,matchUpFormats:aTe,countryToFlag:G8,tieFormats:dee,countries:bc,policies:r1e,flagIOC:vSe},a1e={};yt(a1e,{activeMatchUpStatuses:()=>BF,auditConstants:()=>DRe,completedMatchUpStatuses:()=>Sr,directingMatchUpStatuses:()=>H9,drawDefinitionConstants:()=>t8,entryStatusConstants:()=>vUe,errorConditionConstants:()=>kbe,eventConstants:()=>GUe,extensionConstants:()=>k9,flightConstants:()=>ORe,genderConstants:()=>wL,keyValueConstants:()=>NDe,matchUpActionConstants:()=>BTe,matchUpStatusConstants:()=>q9,matchUpTypes:()=>hUe,nonDirectingMatchUpStatuses:()=>z9,particicipantsRequiredMatchUpStatuses:()=>j9,participantConstants:()=>fUe,participantRoles:()=>CL,participantTypes:()=>nI,penaltyConstants:()=>S1e,policyConstants:()=>qwe,positionActionConstants:()=>FTe,ratingConstants:()=>aDe,recoveryTimeRequiredMatchUpStatuses:()=>rUe,requestConstants:()=>gEe,resultConstants:()=>bbe,scaleConstants:()=>Nwe,scheduleConstants:()=>$Ue,sortingConstants:()=>LRe,surfaceConstants:()=>C1e,tieFormatConstants:()=>SPe,timeItemConstants:()=>FUe,topicConstants:()=>dUe,tournamentConstants:()=>gie,upcomingMatchUpStatuses:()=>W9,validMatchUpStatuses:()=>G9,venueConstants:()=>A1e});var o1e="Coaching",s1e="Ball Abuse",l1e="Racket Abuse",u1e="Verbal Abuse",c1e="INELIGIBILITY",d1e="Physical Abuse",p1e="Unsportmanlike Conduct",m1e="Dress Code Violation",h1e="Equipment Violation",f1e="Leaving the court",g1e="Failure to complete",v1e="No Show",I1e="Other",y1e="REFUSAL_TO_PLAY",b1e="PROHIBITED_SUBSTANCE",w1e="Puncuality",U1e="Failure to sign in",S1e={COACHING:o1e,BALL_ABUSE:s1e,RACKET_ABUSE:l1e,VERBAL_ABUSE:u1e,PHYSICAL_ABUSE:d1e,INELIGIBILITY:c1e,UNSPORTSMANLIKE_CONDUCT:p1e,PROHIBITED_SUBSTANCE:b1e,DRESS_CODE_VIOLATION:m1e,EQUIMENT_VIOLATION:h1e,LEAVING_THE_COURT:f1e,REFUSAL_TO_PLAY:y1e,FAILURE_TO_COMPLETE:g1e,NO_SHOW:v1e,OTHER:I1e,PUNCTUALITY:w1e,FAILUIRE_TO_SIGN_IN:U1e},T1e="CLAY",D1e="HARD",P1e="GRASS",R1e="CARPET",E1e="ARTIFICIAL",C1e={CLAY:T1e,HARD:D1e,GRASS:P1e,CARPET:R1e,ARTIFICIAL:E1e},M1e="INDOOR",N1e="OUTDOOR",A1e={INDOOR:M1e,OUTDOOR:N1e};const O1e=Bt({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function k1e({matchUp:t,individualParticipant:e,spacer:i}){var r,n,a;const o=((r=e==null?void 0:e.person)==null?void 0:r.iso2NationalityCode)||"",s=o?(n=n1e.countryToFlag(o))==null?void 0:n.slice(0,4):"",l=document.createElement("span"),c=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=O1e({variant:c})),l.innerHTML=i?"":s,l}function iC({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n,side:a,type:o}){if(o==="scale")return mbe({individualParticipant:t,composition:e,className:i,matchUp:r,spacer:n});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&k1e({className:i,matchUp:r,individualParticipant:t,spacer:n})||o==="seeding"&&dbe({className:i,composition:e,matchUp:r,side:a})||l}const x1e="Qualifier",F1e="BYE",L1e="TBD";function tj(t){var e,i,r,n;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:c,composition:u}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},m=u==null?void 0:u.configuration,h={QUALIFIER:((e=m==null?void 0:m.placeHolders)==null?void 0:e.qualifier)||x1e,BYE:((i=m==null?void 0:m.placeHolders)==null?void 0:i.bye)||F1e,TBD:((r=m==null?void 0:m.placeHolders)==null?void 0:r.tbd)||L1e},f=l==null?void 0:l.participantName,g=U=>{as(p==null?void 0:p.participantClick)&&(U.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:U,matchUp:c,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const I=document.createElement("div");I.className=zye({variant:d});const y=(m==null?void 0:m.flags)&&iC({...t,type:"flag"});if(y)I.appendChild(y);else{const U=iC({type:"scale",...t});U&&I.appendChild(U)}const b=document.createElement("div");if(b.className=Wye({variant:d}),f){const U=document.createElement("span");if(a&&m!=null&&m.winnerColor)U.style.color=typeof m.winnerColor=="string"?m.winnerColor:"green";else if(m!=null&&m.genderColor){const T=(n=l==null?void 0:l.person)==null?void 0:n.sex,P=T==="MALE"&&"#2E86C1"||T==="FEMALE"&&"#AA336A"||"";U.style.color=typeof m.genderColor=="string"?m.genderColor:P}U.innerHTML=f,b.appendChild(U)}else{const U=document.createElement("abbr");U.className=Hye({variant:m.showAddress?"showAddress":""}),U.innerHTML=(o==null?void 0:o.bye)&&h.BYE||(o==null?void 0:o.qualifier)&&h.QUALIFIER||h.TBD,b.appendChild(U)}const S=iC({...t,className:cbe(),type:"seeding"});S&&b.appendChild(S),I.appendChild(b),v.appendChild(I);const w=ube(t);return v.appendChild(w),{element:v}}const _1e=Bt({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function $1e({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",r=document.createElement("div");r.className=_1e({variant:e});const n=document.createElement("abbr");return n.setAttribute("title",t),n.style.textDecoration="none",n.style.borderBottom="none",n.innerHTML=i,r.appendChild(n),r}function B1e(t){return t instanceof Element||t}const V1e=Bt({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function j1e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=V1e(),e}const G1e=Bt({flexDirection:"column",position:"relative",display:"flex"}),H1e=Bt({alignItems:"stretch",display:"flex"}),z1e=Bt({marginInlineEnd:".25rem",color:"green"});function W1e({dim:t="20px"}={}){const e=z1e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function Bie({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:r,participant:n,placeholder:a,sideNumber:o,matchUp:s}){var l,c,u;const{winningSide:d,matchUpType:p,isRoundRobin:m,matchUpStatus:h}=s||{},f=r==null?void 0:r.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(A=>A.sideNumber===o):void 0;n||(n=v==null?void 0:v.participant,g=f!=null&&f.allDrawPositions||f!=null&&f.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||m)?v==null?void 0:v.drawPosition:"");const I=p==="DOUBLES",y=I?(c=n==null?void 0:n.individualParticipants)==null?void 0:c[0]:n,b=I&&((u=n==null?void 0:n.individualParticipants)==null?void 0:u[1]),S=o===d||h==="BYE"&&n,w=(f==null?void 0:f.winnerChevron)&&S,U=f==null?void 0:f.teamLogo,T=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(h)&&!S,P=f==null?void 0:f.gameScoreOnly,R=document.createElement("div");if(R.className=i&&Yye({drawPosition:g,sideNumber:o}),R.classList.add("tmx-p"),R.setAttribute("id",n==null?void 0:n.participantId),U){const A=j1e({teamLogo:U});R.appendChild(A)}const D=document.createElement("div");D.className=qye({variant:I?"doubles":"singles"});const E=document.createElement("div");E.className=Kye({winnerChevron:w,isDoubles:I});const N=tj({individualParticipant:y,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;if(E.appendChild(N),b){const A=tj({individualParticipant:b,eventHandlers:e,isWinningSide:S,composition:r,sideNumber:o,matchUp:s,side:v}).element;E.appendChild(A)}else I&&a&&B1e(a)&&E.appendChild(a);if(D.appendChild(E),R.appendChild(D),i){const A=document.createElement("div");if(S&&!P){const M=W1e();typeof M=="string"?A.innerHTML=M:A.appendChild(M)}else if(T){const M=$1e({matchUpStatus:h});A.appendChild(M)}R.appendChild(A)}return R}const q1e=Bt({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",width:"460px",height:"1.5em"});function Y1e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:r,context:n}){var a;const o=document.createElement("div");o.className=q1e(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",r);const s=as(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:r,roundProfile:i,roundMatchUps:e,context:n,pointerEvent:d}));const l=s?"⋮":"",c=(a=i==null?void 0:i[r])==null?void 0:a.roundName,u=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${c}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=u||"",o}const Vie=Bt({flexDirection:"column",display:"flex"}),K1e=Bt({flexDirection:"row",display:"flex"}),jie=Bt({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",width:"460px",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),J1e=Bt({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),X1e=Bt({fontWeight:"bold",color:"blue",height:"1em"}),ij=Bt({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),Z1e=Bt({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function Q1e(){return Bt({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const eMe=Bt({});function tMe({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Bt(e)}function iMe({variant:t}){return Bt({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const rMe=Bt({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),nMe=Bt({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),rj=Bt({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function aMe({eventHandlers:t,entryStatus:e,sideNumber:i,className:r,matchUp:n}){const a=document.createElement("div");as(t==null?void 0:t.centerInfoClick)&&(a.onclick=u=>t.centerInfoClick({matchUp:n,sideNumber:i,pointerEvent:u})),a.className=yp(iMe({variant:i}),r),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=rMe();const s=document.createElement("div");s.className=nMe();const l=document.createElement("div");l.className=rj(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const c=document.createElement("div");return c.className=rj(),c.innerHTML=e||"",s.appendChild(c),o.appendChild(s),a.appendChild(o),{element:a}}const cI={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function oMe({composition:t,isDoubles:e,roundFactor:i=1}){const r=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),n=(t==null?void 0:t.configuration)||{},a=(n==null?void 0:n.connectorWidth)||16,o=n.centerInfo?cI.centerInfo*r:0,s=n.scheduleInfo?cI.scheduleInfo*r:0,l=(60+(n.showAddress?r:0))*(e?1.3:1)+o,c=l*i,u=(l+s)*i;return Bt({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const Gie=t=>Bt({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),sMe=Bt({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),Hie=Bt({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),lMe=Bt({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function uMe({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=Hie(),e.value=t,e}function cMe({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:r}){const n=r===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=r===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=r===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,c=l||a,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===r:void 0;let p;if(d)p=uMe({value:c});else if(p=document.createElement("p"),p.className=Hie({variant:n}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const m=document.createElement("span");m.className=sMe(),m.innerHTML=o&&!l?s:"",p.appendChild(m)}return p}function dMe({participantHeight:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:n}){var a,o,s,l;const c=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,u=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=n==null?void 0:n.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,m=r===2?t:t-1,h=Gie(m),f=I=>{as(e==null?void 0:e.scoreClick)&&(I.stopPropagation(),e.scoreClick({pointerEvent:I,matchUp:n}))},g=document.createElement("div");g.className=h({sideNumber:!p&&r,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=f;const v=document.createElement("div");v.className=lMe();for(const I of d||[]){const y=cMe({gameScoreOnly:u,scoreStripes:c,sideNumber:r,set:I});v.appendChild(y)}return g.appendChild(v),g}const pMe=Bt({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var zie={exports:{}};(function(t,e){(function(i,r){t.exports=r()})(Jye,function(){var i=1e3,r=6e4,n=36e5,a="millisecond",o="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",m="year",h="date",f="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,I={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(A){var M=["th","st","nd","rd"],C=A%100;return"["+A+(M[(C-20)%10]||M[C]||M[0])+"]"}},y=function(A,M,C){var O=String(A);return!O||O.length>=M?A:""+Array(M+1-O.length).join(C)+A},b={s:y,z:function(A){var M=-A.utcOffset(),C=Math.abs(M),O=Math.floor(C/60),k=C%60;return(M<=0?"+":"-")+y(O,2,"0")+":"+y(k,2,"0")},m:function A(M,C){if(M.date()<C.date())return-A(C,M);var O=12*(C.year()-M.year())+(C.month()-M.month()),k=M.clone().add(O,d),x=C-k<0,F=M.clone().add(O+(x?-1:1),d);return+(-(O+(C-k)/(x?k-F:F-k))||0)},a:function(A){return A<0?Math.ceil(A)||0:Math.floor(A)},p:function(A){return{M:d,y:m,w:u,d:c,D:h,h:l,m:s,s:o,ms:a,Q:p}[A]||String(A||"").toLowerCase().replace(/s$/,"")},u:function(A){return A===void 0}},S="en",w={};w[S]=I;var U="$isDayjsObject",T=function(A){return A instanceof E||!(!A||!A[U])},P=function A(M,C,O){var k;if(!M)return S;if(typeof M=="string"){var x=M.toLowerCase();w[x]&&(k=x),C&&(w[x]=C,k=x);var F=M.split("-");if(!k&&F.length>1)return A(F[0])}else{var $=M.name;w[$]=M,k=$}return!O&&k&&(S=k),k||!O&&S},R=function(A,M){if(T(A))return A.clone();var C=typeof M=="object"?M:{};return C.date=A,C.args=arguments,new E(C)},D=b;D.l=P,D.i=T,D.w=function(A,M){return R(A,{locale:M.$L,utc:M.$u,x:M.$x,$offset:M.$offset})};var E=function(){function A(C){this.$L=P(C.locale,null,!0),this.parse(C),this.$x=this.$x||C.x||{},this[U]=!0}var M=A.prototype;return M.parse=function(C){this.$d=function(O){var k=O.date,x=O.utc;if(k===null)return new Date(NaN);if(D.u(k))return new Date;if(k instanceof Date)return new Date(k);if(typeof k=="string"&&!/Z$/i.test(k)){var F=k.match(g);if(F){var $=F[2]-1||0,_=(F[7]||"0").substring(0,3);return x?new Date(Date.UTC(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)):new Date(F[1],$,F[3]||1,F[4]||0,F[5]||0,F[6]||0,_)}}return new Date(k)}(C),this.init()},M.init=function(){var C=this.$d;this.$y=C.getFullYear(),this.$M=C.getMonth(),this.$D=C.getDate(),this.$W=C.getDay(),this.$H=C.getHours(),this.$m=C.getMinutes(),this.$s=C.getSeconds(),this.$ms=C.getMilliseconds()},M.$utils=function(){return D},M.isValid=function(){return this.$d.toString()!==f},M.isSame=function(C,O){var k=R(C);return this.startOf(O)<=k&&k<=this.endOf(O)},M.isAfter=function(C,O){return R(C)<this.startOf(O)},M.isBefore=function(C,O){return this.endOf(O)<R(C)},M.$g=function(C,O,k){return D.u(C)?this[O]:this.set(k,C)},M.unix=function(){return Math.floor(this.valueOf()/1e3)},M.valueOf=function(){return this.$d.getTime()},M.startOf=function(C,O){var k=this,x=!!D.u(O)||O,F=D.p(C),$=function(W,Y){var q=D.w(k.$u?Date.UTC(k.$y,Y,W):new Date(k.$y,Y,W),k);return x?q:q.endOf(c)},_=function(W,Y){return D.w(k.toDate()[W].apply(k.toDate("s"),(x?[0,0,0,0]:[23,59,59,999]).slice(Y)),k)},L=this.$W,B=this.$M,V=this.$D,G="set"+(this.$u?"UTC":"");switch(F){case m:return x?$(1,0):$(31,11);case d:return x?$(1,B):$(0,B+1);case u:var j=this.$locale().weekStart||0,H=(L<j?L+7:L)-j;return $(x?V-H:V+(6-H),B);case c:case h:return _(G+"Hours",0);case l:return _(G+"Minutes",1);case s:return _(G+"Seconds",2);case o:return _(G+"Milliseconds",3);default:return this.clone()}},M.endOf=function(C){return this.startOf(C,!1)},M.$set=function(C,O){var k,x=D.p(C),F="set"+(this.$u?"UTC":""),$=(k={},k[c]=F+"Date",k[h]=F+"Date",k[d]=F+"Month",k[m]=F+"FullYear",k[l]=F+"Hours",k[s]=F+"Minutes",k[o]=F+"Seconds",k[a]=F+"Milliseconds",k)[x],_=x===c?this.$D+(O-this.$W):O;if(x===d||x===m){var L=this.clone().set(h,1);L.$d[$](_),L.init(),this.$d=L.set(h,Math.min(this.$D,L.daysInMonth())).$d}else $&&this.$d[$](_);return this.init(),this},M.set=function(C,O){return this.clone().$set(C,O)},M.get=function(C){return this[D.p(C)]()},M.add=function(C,O){var k,x=this;C=Number(C);var F=D.p(O),$=function(B){var V=R(x);return D.w(V.date(V.date()+Math.round(B*C)),x)};if(F===d)return this.set(d,this.$M+C);if(F===m)return this.set(m,this.$y+C);if(F===c)return $(1);if(F===u)return $(7);var _=(k={},k[s]=r,k[l]=n,k[o]=i,k)[F]||1,L=this.$d.getTime()+C*_;return D.w(L,this)},M.subtract=function(C,O){return this.add(-1*C,O)},M.format=function(C){var O=this,k=this.$locale();if(!this.isValid())return k.invalidDate||f;var x=C||"YYYY-MM-DDTHH:mm:ssZ",F=D.z(this),$=this.$H,_=this.$m,L=this.$M,B=k.weekdays,V=k.months,G=k.meridiem,j=function(Y,q,re,K){return Y&&(Y[q]||Y(O,x))||re[q].slice(0,K)},H=function(Y){return D.s($%12||12,Y,"0")},W=G||function(Y,q,re){var K=Y<12?"AM":"PM";return re?K.toLowerCase():K};return x.replace(v,function(Y,q){return q||function(re){switch(re){case"YY":return String(O.$y).slice(-2);case"YYYY":return D.s(O.$y,4,"0");case"M":return L+1;case"MM":return D.s(L+1,2,"0");case"MMM":return j(k.monthsShort,L,V,3);case"MMMM":return j(V,L);case"D":return O.$D;case"DD":return D.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return j(k.weekdaysMin,O.$W,B,2);case"ddd":return j(k.weekdaysShort,O.$W,B,3);case"dddd":return B[O.$W];case"H":return String($);case"HH":return D.s($,2,"0");case"h":return H(1);case"hh":return H(2);case"a":return W($,_,!0);case"A":return W($,_,!1);case"m":return String(_);case"mm":return D.s(_,2,"0");case"s":return String(O.$s);case"ss":return D.s(O.$s,2,"0");case"SSS":return D.s(O.$ms,3,"0");case"Z":return F}return null}(Y)||F.replace(":","")})},M.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},M.diff=function(C,O,k){var x,F=this,$=D.p(O),_=R(C),L=(_.utcOffset()-this.utcOffset())*r,B=this-_,V=function(){return D.m(F,_)};switch($){case m:x=V()/12;break;case d:x=V();break;case p:x=V()/3;break;case u:x=(B-L)/6048e5;break;case c:x=(B-L)/864e5;break;case l:x=B/n;break;case s:x=B/r;break;case o:x=B/i;break;default:x=B}return k?x:D.a(x)},M.daysInMonth=function(){return this.endOf(d).$D},M.$locale=function(){return w[this.$L]},M.locale=function(C,O){if(!C)return this.$L;var k=this.clone(),x=P(C,O,!0);return x&&(k.$L=x),k},M.clone=function(){return D.w(this.$d,this)},M.toDate=function(){return new Date(this.valueOf())},M.toJSON=function(){return this.isValid()?this.toISOString():null},M.toISOString=function(){return this.$d.toISOString()},M.toString=function(){return this.$d.toUTCString()},A}(),N=E.prototype;return R.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",c],["$M",d],["$y",m],["$D",h]].forEach(function(A){N[A[1]]=function(M){return this.$g(M,A[0],A[1])}}),R.extend=function(A,M){return A.$i||(A(M,E,R),A.$i=!0),R},R.locale=P,R.isDayjs=T,R.unix=function(A){return R(1e3*A)},R.en=w[S],R.Ls=w,R.p={},R})})(zie);var mMe=zie.exports;const hMe=j7(mMe);function fMe({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:r,venueAbbreviation:n,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=J$,l=s(i);let c=o(r),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=r?hMe(c).format(u):"Not scheduled",p=n&&(a==null?void 0:a.toString().startsWith(n))&&a||n&&a&&`${n} ${a}`||a||n||"",m=document.createElement("div");m.className=pMe(),m.classList.add("tmx-sch"),as(e==null?void 0:e.scheduleClick)&&(m.onclick=I=>e.scheduleClick({matchUp:t,pointerEvent:I}));const h=document.createElement("div");h.innerHTML=d,m.append(h);const f=I=>{as(e==null?void 0:e.venueClick)&&(I.stopPropagation(),e.venueClick({pointerEvent:I,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=f,v.innerHTML=p,g.append(v),m.append(g),m.onclick){const I=document.createElement("div");I.innerHTML="⋮",g.append(I)}return m}function nj({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:r,className:n,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},c=l==null?void 0:l.scheduleInfo,u=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&u,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!_ie.checkScoreHasValue({matchUp:a}),m=document.createElement("div");if(m.className=yp(G1e(),n),m.classList.add("tmx-sd"),m.setAttribute("sideNumber",r),c&&r===1){const g=fMe({matchUp:a,eventHandlers:e});m.appendChild(g)}const h=document.createElement("div");h.className=H1e();const f=Bie({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:r,matchUp:a});if(h.appendChild(f),d){const g=document.createElement("div");g.style.border="1px solid lightgray",h.appendChild(g)}if(u){const g=dMe({eventHandlers:e,composition:i,sideNumber:r,matchUp:a});h.appendChild(g)}if(p){const g=Gie(),v=y=>{as(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:a}))},I=document.createElement("div");I.className=g({sideNumber:!d&&r,fontSize:"small"}),I.onclick=v,I.innerHTML="[Score]",h.appendChild(I)}return m.appendChild(h),m}function gMe(t){const{composition:e,initialRoundNumber:i=1,matchUp:r,moeity:n,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=r,m=t.isFinalRound||parseInt(c)===1,h=p==="QUALIFYING"&&m,f=m,g=parseInt(l)===i,v=u==="DOUBLES",I=(o||r.isRoundRobin||r.collectionId||t.isLucky||t.isAdHoc)&&"mr"||f&&"noProgression"||(h||d)&&"m0"||n&&"m1"||"m2",y=oMe({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:I}),b=(e==null?void 0:e.configuration)||{},{resultsInfo:S,centerInfo:w}=b||{},U=t.eventHandlers||{},T=A=>{as(U==null?void 0:U.matchUpClick)&&U.matchUpClick({pointerEvent:A,matchUp:r})},P=document.createElement("div");P.className=yp(e.theme,t==null?void 0:t.className,"matchup",eMe()),P.classList.add("tmx-m"),P.setAttribute("id",r==null?void 0:r.matchUpId),P.onclick=T;const R=document.createElement("div");R.className=tMe({configuration:b});const D=({sideNumber:A})=>{var M,C,O;const k=(O=(C=(M=r==null?void 0:r.sides.find(x=>x.sideNumber===A))==null?void 0:M.participant)==null?void 0:C.entryStatus)==null?void 0:O.replace("_"," ");return aMe({eventHandlers:U,entryStatus:k,sideNumber:A,className:A===2&&y,matchUp:r})},E=nj({initialRoundNumber:i,eventHandlers:U,sideNumber:1,composition:e,matchUp:r}),N=nj({className:!w&&y,initialRoundNumber:i,eventHandlers:U,sideNumber:2,composition:e,matchUp:r});if(R.appendChild(E),w){const A=D({sideNumber:1}),M=D({sideNumber:2});R.appendChild(A.element),R.appendChild(M.element)}if(R.appendChild(N),S){const A=vMe({score:r.score});R.appendChild(A)}if(P.appendChild(R),a===r.matchUpId){const A=document.createElement("div");A.className=Q1e(),P.appendChild(A)}return P}function vMe({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),r=i==null?void 0:i[i.length-1],n=(r==null?void 0:r.side1PointsScore)||(r==null?void 0:r.side2PointsScore),a=document.createElement("div");if(a.className=Z1e(),n){const o=document.createElement("div");o.className=ij({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=ij({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function IMe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,isRoundRobin:n,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:c,matchUps:u,context:d,isLucky:p}){const m=u.filter(P=>P.roundNumber===l).sort((P,R)=>(P.roundPosition||0)-(R.roundPosition||0)),h=m.every(({roundPosition:P,drawPositions:R})=>!P&&!R),f=(o==null?void 0:o.configuration)||{},g=document.createElement("div");if(g.className=Vie(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",l),f.roundHeader){const P=Y1e({roundProfile:c,roundMatchUps:m,roundNumber:l,eventHandlers:i,context:d});g.appendChild(P)}const v=document.createElement("div");v.className=jie({variant:h?"adHoc":void 0});let I,y,b;if(n){const P=D=>D.reduce((E,N)=>N+E,0);m.sort((D,E)=>{const N=P(D.drawPositions)-P(E.drawPositions),A=Math.min(...D.drawPositions??[])-Math.min(...E.drawPositions??[]);return N||A});const R=m.reduce((D,E)=>(D[E.structureId]=E.structureName,D),{});I=Object.values(R),y=Object.keys(R),b=Object.keys(J$.instanceCount(m.map(({structureId:D})=>D))).length}else h&&m.sort((P,R)=>(P.roundOrder??0)-(R.roundOrder??0));const S=b&&m.length/b,w=Object.keys(c).map(P=>parseInt(P)),U=w.indexOf(l),T=U===0&&"first"||U===w.length-1&&"last";return m.forEach((P,R)=>{const D=S&&!(R%S),E=S&&Math.floor(R/S),N=S&&I[E];if(D){const C=document.createElement("div");C.className=J1e({variant:E,roundOrder:T}),v.appendChild(C);const O=document.createElement("div");if(O.className=X1e(),as(i==null?void 0:i.groupHeaderClick)){const{drawId:k,containerStructureId:x}=m[0];v.onclick=F=>i.groupHeaderClick({drawId:k,structureId:y[E],containerStructureId:x,pointerEvent:F})}l===t&&(O.innerHTML=N),v.appendChild(O)}const A=R%2===0;s?P.roundFactor=s:t>1&&(P.roundFactor=Math.pow(2,l-t));const M=gMe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:r,searchActive:a,composition:o,isAdHoc:h,isLucky:p,matchUp:P,moeity:A});v.appendChild(M)}),g.appendChild(v),g}function yMe({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:r,composition:n,structureId:a,finalColumn:o,matchUps:s,context:l}){var c;const{roundNumbers:u,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:m}=_ie.getRoundMatchUps({matchUps:s});a=a||(l==null?void 0:l.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const h=s.some(({isRoundRobin:I})=>I),f=p||m,g=document.createElement("div");g.className=K1e(),g.classList.add("tmx-str"),g.setAttribute("id",a);const v=Math.max(...u);for(const I of u){if(I<t)continue;const y=IMe({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:I===v,isRoundRobin:h,searchActive:r,composition:n,roundNumber:I,roundProfile:d,matchUps:s,context:l,isLucky:f});g.appendChild(y)}if(o){const I=document.createElement("div");I.className=Vie();const y=document.createElement("div");y.className=jie(),y.appendChild(o),I.appendChild(y),g.appendChild(I)}return g}const aj=Bt({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function bMe({content:t,theme:e}){const i=document.createElement("div");return i.className=e?yp(aj(),e):aj(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:Gh}=V7({theme:{lineHeights:{scheduleInfo:`${cI.scheduleInfo}rem`,centerInfo:`${cI.centerInfo}rem`,gameScore:`${cI.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),oj=Gh("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),wMe=Gh("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),UMe=Gh("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),SMe=Gh("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),sj=Gh("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),TMe=Gh("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),DMe=Gh("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),PMe={Australian:{configuration:{flags:!0},theme:oj},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:sj},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:sj},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:UMe},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:wMe},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:SMe},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:DMe},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:oj},Night:{configuration:{flags:!0},theme:TMe}},{MALE:RMe,FEMALE:EMe}=qT,{PAIR:CMe}=lz,MMe="utr",NMe={utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},Wie=t=>(e,i,r)=>{var d;const n=e.getColumn().getDefinition(),a=n.field==="side1"&&1||n.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,c=e.getValue(),u=s.participant||c.participant||s.person&&s;if(u){const p=NMe[MMe],m=f=>Bie({eventHandlers:{participantClick:g=>nu(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{participantDetail:"TEAM",winnerColor:!0,genderColor:!0,scaleAttributes:p,flag:!1}},matchUp:s.matchUp,participant:f,placeholder:i,sideNumber:a}),h=f=>{const g=document.createElement("div");return g.className="flexrow flexjustifystart",f.individualParticipants.forEach((v,I)=>{if(g.appendChild(m(v)),!I){const y=document.createElement("span");y.style.width="1em",y.innerHTML="&nbsp;",g.appendChild(y)}}),g};return r==="sideBySide"&&u.participantType===CMe?h(u):m(u)}if(l){const p=n.field===s.winningSide;o.style.color=p?"green":"red"}else{const p=(c==null?void 0:c.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),m=p===RMe&&"#2E86C1"||p===EMe&&"#AA336A"||"";o.style.color=m}return o.innerHTML=(m1(c)?c.participantName:c)||"",o};function AMe(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return"";const{competitiveProfile:i,score:r}=e,n=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(r){const{competitiveness:s}=i;n.style.fontSize="smaller",n.style.color=a[s],n.innerHTML=s}return n}function OMe(t){const e=t.getRow().getData();if(!e.readyToScore)return"";const i=e.matchUp.matchUpStatus==="WALKOVER",r=document.createElement("span");return r.classList.add("scoreCell"),e.score?(r.style.fontSize="smaller",r.innerHTML=e.score):i?r.innerHTML="WO":(r.style.fontSize="smaller",r.style.color="blue",r.innerHTML="--- --- ---"),r}function eN(t,e){var n,a,o,s;const i=(t==null?void 0:t.person)||((n=t==null?void 0:t.participant)==null?void 0:n.person),r=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||r?i!=null&&i.standardFamilyName&&!(r!=null&&r.standardFamilyName)||r!=null&&r.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(r!=null&&r.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(r==null?void 0:r.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}function kMe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function xMe({data:t}){const e=t.some(r=>r.courtName),i=r=>{const n=document.createElement("div");n.className="has-text-warning-dark",n.innerHTML="Select participant";const a=()=>console.log("boo");return r.getValue().participantName&&Wie(a)(r,n)};return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Oi,minWidth:50,width:50},{formatter:"rownum",headerSort:!1,hozAlign:qd,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"scheduledDate",title:"Date",width:110},{visible:!!e,field:"courtName",title:"Court",width:100},{field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:i,sorter:eN,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:i,sorter:eN,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{formatter:OMe,sorter:kMe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:fye,formatter:AMe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:qd,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70}]}var FMe=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};const{TEAM:LMe}=gH,lj=t=>{var M,C,O,k,x;const{potentialParticipants:e,structureName:i,matchUpType:r,roundNumber:n,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:m,courtName:h}=s||{},f=F=>{var $;return(($=F.person)==null?void 0:$.standardFamilyName)||F.participantName},g=(e==null?void 0:e.map(F=>({participantName:F.map(f).filter(Boolean).join(" or ")})))||[],v=((M=u==null?void 0:u[0])==null?void 0:M.participant)||g.shift(),I=((C=u==null?void 0:u[1])==null?void 0:C.participant)||g.shift(),y={participantName:v==null?void 0:v.participantName,sex:(O=v==null?void 0:v.person)==null?void 0:O.sex,participant:v},b={participantName:I==null?void 0:I.participantName,sex:(k=I==null?void 0:I.person)==null?void 0:k.sex,participant:I},S=u.flatMap(({participant:F})=>{var $;return($=F==null?void 0:F.individualParticipantIds)!=null&&$.length?F.individualParticipantIds:F==null?void 0:F.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,U=!!d.winningSide,T=!!(d.winningSide||d.readyToScore),P=(x=d.score)==null?void 0:x.scoreStringSide1,R=u.flatMap(F=>{var _,L,B;const $=(_=F.participant)==null?void 0:_.person;return $?[$.standardGivenName,$.standardFamilyName]:(B=(L=F.participant)==null?void 0:L.individualParticipants)==null?void 0:B.map(({person:V})=>[V.standardGivenName,V.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),D=FMe([R,v==null?void 0:v.participantName,I==null?void 0:I.participantName].filter(Boolean).join(" ")).toLowerCase(),E=t.collectionId?LMe:r,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,A={score:P,matchUpStatus:t.matchUpStatus,readyToScore:T,complete:U,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:S,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:T,scheduleTime:m,matchUpType:r,scoreDetail:A,winningSide:w,roundNumber:n,searchText:D,courtName:h,eventType:E,matchUpId:a,roundName:o,complete:U,eventId:l,matchUp:t,drawId:c,side1:y,side2:b,score:P}},{CONTAINER:_Me}=AT;async function $Me(t){const{drawId:e,structureId:i,eventData:r}=t;let n,a,o,s,l=t.matchUps;const c=()=>{var y,b;const v=(y=r==null?void 0:r.drawsData)==null?void 0:y.find(S=>S.drawId===e);return a=(b=v==null?void 0:v.structures)==null?void 0:b.find(S=>S.structureId===i),s=(a==null?void 0:a.structureType)===_Me,(a!=null&&a.roundMatchUps?Object.values((a==null?void 0:a.roundMatchUps)||{}).flat():[]).filter(({matchUpStatus:S})=>S!=="BYE").filter(({sides:S})=>!o||S.find(w=>{var U,T;return(T=(U=w.participant)==null?void 0:U.participantName)==null?void 0:T.toLowerCase().includes(o==null?void 0:o.toLowerCase())}))};l||(l=await c()),r&&l.forEach(v=>v.eventName=r.eventInfo.eventName);const u=()=>l.map(lj),d=()=>c().map(lj),p=v=>{v.participantFilter&&(o=v.participantFilter),n.replaceData(d())},m=u(),h=xMe({data:m}),f=s?["roundName","structureName"]:["roundName"];return(v=>{aP({anchorId:"flightDisplay"});const I=document.getElementById("flightDisplay");n=new jb(I,{groupHeader:[hye,y=>y],headerSortElement:$7(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:f,columns:h,data:v})})(m),{table:n,replaceTableData:p}}const BMe=t=>t.reduce((e,i)=>e+parseFloat(i),0),uj=t=>parseFloat((BMe(t)/t.length).toFixed(2));function cj(t){var p,m;const{participantResult:e,drawPosition:i,participantId:r,participantMap:n}=t,a=(p=e==null?void 0:e.ratingVariation)!=null&&p.length?uj(e.ratingVariation):0,o=(m=e==null?void 0:e.pressureScores)!=null&&m.length?uj(e.pressureScores):0,s=`${(e==null?void 0:e.pointsWon)||0}/${(e==null?void 0:e.pointsLost)||0}`,l=`${(e==null?void 0:e.gamesWon)||0}/${(e==null?void 0:e.gamesLost)||0}`,c=`${(e==null?void 0:e.setsWon)||0}/${(e==null?void 0:e.setsLost)||0}`,u=(e==null?void 0:e.groupOrder)||(e==null?void 0:e.provisionalOrder),d=n[r];return{participantName:d.participantName,groupName:d.groupName,...e,averageVariation:a,averagePressure:o,participantId:r,pointsResult:s,drawPosition:i,participant:d,gamesResult:l,setsResult:c,order:u}}function J0(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:t-e}function Qh(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function dj(t,e){return!t&&!e||t&&!e?-1:e&&!t?1:e-t}function VMe({isAdHoc:t}){return[{formatter:Wie(({event:e,cell:i,...r})=>console.log("cell clicked",{event:e,cell:i,undefined:void 0,params:r})),sorter:eN,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,title:"Name",widthGrow:2,frozen:!0},{headerHozAlign:Oi,headerWordWrap:!0,title:"Match W/L",hozAlign:Oi,maxWidth:80,field:"result"},{formatter:Qh,headerHozAlign:Oi,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Oi,maxWidth:80},{headerHozAlign:Oi,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Oi,maxWidth:80},{formatter:Qh,headerHozAlign:Oi,headerWordWrap:!0,title:"Set Win%",hozAlign:Oi,field:"setsPct",maxWidth:80},{headerHozAlign:Oi,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Oi,maxWidth:80},{formatter:Qh,headerHozAlign:Oi,headerWordWrap:!0,title:"Game Win%",hozAlign:Oi,field:"gamesPct",maxWidth:80},{headerHozAlign:Oi,headerWordWrap:!0,field:"pointsResult",title:"Points W/L",hozAlign:Oi,maxWidth:80},{formatter:Qh,headerHozAlign:Oi,headerWordWrap:!0,title:"Points Win%",field:"pointsPct",hozAlign:Oi,maxWidth:80},{formatter:Qh,field:"averagePressure",headerHozAlign:Oi,sorter:dj,hozAlign:Oi,maxWidth:70,title:"PS"},{formatter:Qh,field:"averageVariation",headerHozAlign:Oi,sorter:dj,hozAlign:Oi,maxWidth:70,title:"RV"},{headerHozAlign:Oi,field:"pressureOrder",sorter:J0,hozAlign:Oi,visible:t,title:"Order",maxWidth:80},{headerHozAlign:Oi,sorter:J0,visible:!t,hozAlign:Oi,title:"Order",field:"order",maxWidth:80},{field:"groupName",visible:!1,title:"Group"}]}async function jMe({drawId:t,structureId:e,eventData:i,participants:r=[]}){var b,S;let n,a,o;const s=(b=i==null?void 0:i.drawsData)==null?void 0:b.find(w=>w.drawId===t);let l=(S=s==null?void 0:s.structures)==null?void 0:S.find(w=>w.structureId===e);const c=ET.isAdHoc({structure:l}),u=w=>(w??[]).reduce((U,T)=>(U[T.participantId]=T,U),{}),d={},p=()=>{var T,P;const w=(T=i==null?void 0:i.drawsData)==null?void 0:T.find(R=>R.drawId===t);return l=(P=w==null?void 0:w.structures)==null?void 0:P.find(R=>R.structureId===e),o||(o=u(r)),(l!=null&&l.roundMatchUps?Object.values(l.roundMatchUps).flat():[]).forEach(({sides:R,structureName:D,structureId:E})=>{d[E]=D,R.forEach(N=>{N.participantId&&(o[N.participantId].groupName=D)})}),((l==null?void 0:l.participantResults)??[]).filter(R=>{var E;const D=o[R.participantId];return!a||((E=D==null?void 0:D.participantName)==null?void 0:E.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},m=p(),h=()=>m==null?void 0:m.map(w=>cj({...w,participantMap:o})).sort((w,U)=>c?J0(w.pressureOrder,U.pressureOrder):J0(w.order,U.order)),f=()=>{var w;return(w=p())==null?void 0:w.map(U=>cj({...U,participantMap:o}))},g=w=>{(w==null?void 0:w.participantFilter)!==void 0&&(a=w.participantFilter),n.replaceData(f())},v=h(),I=VMe({isAdHoc:c});return(w=>{aP({anchorId:"flightDisplay"});const U=document.getElementById("flightDisplay"),T=Object.values(d).length>1?["groupName"]:void 0;n=new jb(U,{headerSortElement:$7(["averageVariation","averagePressure","participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),height:window.innerHeight*.85,groupHeader:[P=>P],placeholder:"No participants",renderHorizontal:"virtual",index:"matchUpId",groupBy:T,columns:I,data:w})})(v),{table:n,replaceTableData:g}}const{CONTAINER:GMe}=AT;function HMe(t){const{callback:e,structure:i,existingView:r}=t,n=l=>r!==l&&nu(e)&&e({refresh:!0,view:l}),a=(i==null?void 0:i.structureType)===GMe,o=fhe.isAdHoc({structure:i}),s=[];return r!==U2&&s.push({onClick:()=>n(U2),label:o?"Columns":"Draw",close:!0}),r!==T2&&s.push({onClick:()=>n(T2),label:"Table view",close:!0}),(o||a)&&r!==S2&&s.push({onClick:()=>n(S2),label:"Statistics",close:!0}),{label:"Display",id:"roundDisplayButton",options:s,selection:!1,location:Nm,align:Nm}}function pj({tournamentId:t,eventId:e,header:i,flightDisplay:r,displayFormat:n}){const a=()=>{var s;return(s=document.getElementById("structureButton"))==null?void 0:s.remove()},o=()=>{var s;return(s=document.getElementById("roundDisplayButton"))==null?void 0:s.remove()};O7({tournamentId:t,eventId:e}).then(s=>{var y,b,S,w,U;const l=((y=s==null?void 0:s.data)==null?void 0:y.eventData)||(s==null?void 0:s.data),c=((b=s==null?void 0:s.data)==null?void 0:b.participants)||[];window!=null&&window.dev&&(window.dev.eventData=l.drawsData);const u=T=>Object.values(T.roundMatchUps||{}).flat(),d=T=>{var P;return(P=T.structures)==null?void 0:P.some(R=>u(R).length>0)},p=l==null?void 0:l.drawsData.filter(d),m=(w=(S=l.eventInfo)==null?void 0:S.display)==null?void 0:w.compositionName,h=PMe[m??"National"];h.configuration.genderColor=!0;const f=T=>{var A,M;const P=p[T];if(!P)return;const R=P.drawId,D=({view:C})=>{C&&(n=C),f(T)},E=C=>{var L;const O=(L=P.structures)==null?void 0:L[C];o();const k=HMe({callback:D,structure:O}),x=sm({button:k});i.appendChild(x);const F=O.structureId,$=Object.values(O.roundMatchUps||{}).flat();if(ET.isAdHoc({structure:O})&&$.sort(eP.matchUpScheduleSort),r.innerHTML=P.drawName,Jp(r),n==="roundsColumns"){const B=bMe({content:yMe({context:{drawId:R,structureId:F},matchUps:$,composition:h,structure:O}),theme:h.theme});r.appendChild(B)}else n==="roundsStats"?jMe({drawId:R,structureId:F,eventData:l,participants:c}):$Me({drawId:R,structureId:F,eventData:l})};if(((A=P.structures)==null?void 0:A.length)>1){const C=P.structures.map(({structureName:x},F)=>({onClick:()=>E(F),label:x,close:!0})),O={label:P.structures[0].structureName,options:C,id:"structureButton",modifyLabel:!0,selection:!0,location:qd},k=sm({button:O});i.appendChild(k)}(M=P.structures)!=null&&M[0]&&E(0)},g=p.map(({drawName:T},P)=>({onClick:()=>f(P),label:T,close:!0})),v={label:(U=p==null?void 0:p[0])==null?void 0:U.drawName,options:g,modifyLabel:!0,id:"flightButton",selection:!0,location:qd},I=sm({button:v,stateChange:a});i.appendChild(I),f(0)})}function Jp(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}function zMe(t,e,i,r,n){if(n){const a=e.target.value;n(a)?(r.innerHTML="",r.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(r.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),r.classList.add("is-danger"))}}var Co="top",rl="bottom",nl="right",Mo="left",tB="auto",dU=[Co,rl,nl,Mo],hg="start",Uy="end",WMe="clippingParents",qie="viewport",jv="popper",qMe="reference",mj=dU.reduce(function(t,e){return t.concat([e+"-"+hg,e+"-"+Uy])},[]),Yie=[].concat(dU,[tB]).reduce(function(t,e){return t.concat([e,e+"-"+hg,e+"-"+Uy])},[]),YMe="beforeRead",KMe="read",JMe="afterRead",XMe="beforeMain",ZMe="main",QMe="afterMain",eNe="beforeWrite",tNe="write",iNe="afterWrite",rNe=[YMe,KMe,JMe,XMe,ZMe,QMe,eNe,tNe,iNe];function xu(t){return t?(t.nodeName||"").toLowerCase():null}function Ts(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function zm(t){var e=Ts(t).Element;return t instanceof e||t instanceof Element}function js(t){var e=Ts(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function iB(t){if(typeof ShadowRoot>"u")return!1;var e=Ts(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function nNe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var r=e.styles[i]||{},n=e.attributes[i]||{},a=e.elements[i];!js(a)||!xu(a)||(Object.assign(a.style,r),Object.keys(n).forEach(function(o){var s=n[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function aNe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(r){var n=e.elements[r],a=e.attributes[r]||{},o=Object.keys(e.styles.hasOwnProperty(r)?e.styles[r]:i[r]),s=o.reduce(function(l,c){return l[c]="",l},{});!js(n)||!xu(n)||(Object.assign(n.style,s),Object.keys(a).forEach(function(l){n.removeAttribute(l)}))})}}const Kie={name:"applyStyles",enabled:!0,phase:"write",fn:nNe,effect:aNe,requires:["computeStyles"]};function mu(t){return t.split("-")[0]}var bm=Math.max,X0=Math.min,fg=Math.round;function tN(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Jie(){return!/^((?!chrome|android).)*safari/i.test(tN())}function gg(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var r=t.getBoundingClientRect(),n=1,a=1;e&&js(t)&&(n=t.offsetWidth>0&&fg(r.width)/t.offsetWidth||1,a=t.offsetHeight>0&&fg(r.height)/t.offsetHeight||1);var o=zm(t)?Ts(t):window,s=o.visualViewport,l=!Jie()&&i,c=(r.left+(l&&s?s.offsetLeft:0))/n,u=(r.top+(l&&s?s.offsetTop:0))/a,d=r.width/n,p=r.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function rB(t){var e=gg(t),i=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:r}}function Xie(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&iB(i)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function jc(t){return Ts(t).getComputedStyle(t)}function oNe(t){return["table","td","th"].indexOf(xu(t))>=0}function xp(t){return((zm(t)?t.ownerDocument:t.document)||window.document).documentElement}function nE(t){return xu(t)==="html"?t:t.assignedSlot||t.parentNode||(iB(t)?t.host:null)||xp(t)}function hj(t){return!js(t)||jc(t).position==="fixed"?null:t.offsetParent}function sNe(t){var e=/firefox/i.test(tN()),i=/Trident/i.test(tN());if(i&&js(t)){var r=jc(t);if(r.position==="fixed")return null}var n=nE(t);for(iB(n)&&(n=n.host);js(n)&&["html","body"].indexOf(xu(n))<0;){var a=jc(n);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return n;n=n.parentNode}return null}function pU(t){for(var e=Ts(t),i=hj(t);i&&oNe(i)&&jc(i).position==="static";)i=hj(i);return i&&(xu(i)==="html"||xu(i)==="body"&&jc(i).position==="static")?e:i||sNe(t)||e}function nB(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function dI(t,e,i){return bm(t,X0(e,i))}function lNe(t,e,i){var r=dI(t,e,i);return r>i?i:r}function Zie(){return{top:0,right:0,bottom:0,left:0}}function Qie(t){return Object.assign({},Zie(),t)}function ere(t,e){return e.reduce(function(i,r){return i[r]=t,i},{})}var uNe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Qie(typeof e!="number"?e:ere(e,dU))};function cNe(t){var e,i=t.state,r=t.name,n=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=mu(i.placement),l=nB(s),c=[Mo,nl].indexOf(s)>=0,u=c?"height":"width";if(!(!a||!o)){var d=uNe(n.padding,i),p=rB(a),m=l==="y"?Co:Mo,h=l==="y"?rl:nl,f=i.rects.reference[u]+i.rects.reference[l]-o[l]-i.rects.popper[u],g=o[l]-i.rects.reference[l],v=pU(a),I=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,y=f/2-g/2,b=d[m],S=I-p[u]-d[h],w=I/2-p[u]/2+y,U=dI(b,w,S),T=l;i.modifiersData[r]=(e={},e[T]=U,e.centerOffset=U-w,e)}}function dNe(t){var e=t.state,i=t.options,r=i.element,n=r===void 0?"[data-popper-arrow]":r;n!=null&&(typeof n=="string"&&(n=e.elements.popper.querySelector(n),!n)||Xie(e.elements.popper,n)&&(e.elements.arrow=n))}const pNe={name:"arrow",enabled:!0,phase:"main",fn:cNe,effect:dNe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function vg(t){return t.split("-")[1]}var mNe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function hNe(t,e){var i=t.x,r=t.y,n=e.devicePixelRatio||1;return{x:fg(i*n)/n||0,y:fg(r*n)/n||0}}function fj(t){var e,i=t.popper,r=t.popperRect,n=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=o.x,m=p===void 0?0:p,h=o.y,f=h===void 0?0:h,g=typeof u=="function"?u({x:m,y:f}):{x:m,y:f};m=g.x,f=g.y;var v=o.hasOwnProperty("x"),I=o.hasOwnProperty("y"),y=Mo,b=Co,S=window;if(c){var w=pU(i),U="clientHeight",T="clientWidth";if(w===Ts(i)&&(w=xp(i),jc(w).position!=="static"&&s==="absolute"&&(U="scrollHeight",T="scrollWidth")),w=w,n===Co||(n===Mo||n===nl)&&a===Uy){b=rl;var P=d&&w===S&&S.visualViewport?S.visualViewport.height:w[U];f-=P-r.height,f*=l?1:-1}if(n===Mo||(n===Co||n===rl)&&a===Uy){y=nl;var R=d&&w===S&&S.visualViewport?S.visualViewport.width:w[T];m-=R-r.width,m*=l?1:-1}}var D=Object.assign({position:s},c&&mNe),E=u===!0?hNe({x:m,y:f},Ts(i)):{x:m,y:f};if(m=E.x,f=E.y,l){var N;return Object.assign({},D,(N={},N[b]=I?"0":"",N[y]=v?"0":"",N.transform=(S.devicePixelRatio||1)<=1?"translate("+m+"px, "+f+"px)":"translate3d("+m+"px, "+f+"px, 0)",N))}return Object.assign({},D,(e={},e[b]=I?f+"px":"",e[y]=v?m+"px":"",e.transform="",e))}function fNe(t){var e=t.state,i=t.options,r=i.gpuAcceleration,n=r===void 0?!0:r,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,c={placement:mu(e.placement),variation:vg(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:n,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,fj(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,fj(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const gNe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:fNe,data:{}};var zU={passive:!0};function vNe(t){var e=t.state,i=t.instance,r=t.options,n=r.scroll,a=n===void 0?!0:n,o=r.resize,s=o===void 0?!0:o,l=Ts(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,zU)}),s&&l.addEventListener("resize",i.update,zU),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,zU)}),s&&l.removeEventListener("resize",i.update,zU)}}const INe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:vNe,data:{}};var yNe={left:"right",right:"left",bottom:"top",top:"bottom"};function MS(t){return t.replace(/left|right|bottom|top/g,function(e){return yNe[e]})}var bNe={start:"end",end:"start"};function gj(t){return t.replace(/start|end/g,function(e){return bNe[e]})}function aB(t){var e=Ts(t),i=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:i,scrollTop:r}}function oB(t){return gg(xp(t)).left+aB(t).scrollLeft}function wNe(t,e){var i=Ts(t),r=xp(t),n=i.visualViewport,a=r.clientWidth,o=r.clientHeight,s=0,l=0;if(n){a=n.width,o=n.height;var c=Jie();(c||!c&&e==="fixed")&&(s=n.offsetLeft,l=n.offsetTop)}return{width:a,height:o,x:s+oB(t),y:l}}function UNe(t){var e,i=xp(t),r=aB(t),n=(e=t.ownerDocument)==null?void 0:e.body,a=bm(i.scrollWidth,i.clientWidth,n?n.scrollWidth:0,n?n.clientWidth:0),o=bm(i.scrollHeight,i.clientHeight,n?n.scrollHeight:0,n?n.clientHeight:0),s=-r.scrollLeft+oB(t),l=-r.scrollTop;return jc(n||i).direction==="rtl"&&(s+=bm(i.clientWidth,n?n.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function sB(t){var e=jc(t),i=e.overflow,r=e.overflowX,n=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+n+r)}function tre(t){return["html","body","#document"].indexOf(xu(t))>=0?t.ownerDocument.body:js(t)&&sB(t)?t:tre(nE(t))}function pI(t,e){var i;e===void 0&&(e=[]);var r=tre(t),n=r===((i=t.ownerDocument)==null?void 0:i.body),a=Ts(r),o=n?[a].concat(a.visualViewport||[],sB(r)?r:[]):r,s=e.concat(o);return n?s:s.concat(pI(nE(o)))}function iN(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function SNe(t,e){var i=gg(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function vj(t,e,i){return e===qie?iN(wNe(t,i)):zm(e)?SNe(e,i):iN(UNe(xp(t)))}function TNe(t){var e=pI(nE(t)),i=["absolute","fixed"].indexOf(jc(t).position)>=0,r=i&&js(t)?pU(t):t;return zm(r)?e.filter(function(n){return zm(n)&&Xie(n,r)&&xu(n)!=="body"}):[]}function DNe(t,e,i,r){var n=e==="clippingParents"?TNe(t):[].concat(e),a=[].concat(n,[i]),o=a[0],s=a.reduce(function(l,c){var u=vj(t,c,r);return l.top=bm(u.top,l.top),l.right=X0(u.right,l.right),l.bottom=X0(u.bottom,l.bottom),l.left=bm(u.left,l.left),l},vj(t,o,r));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function ire(t){var e=t.reference,i=t.element,r=t.placement,n=r?mu(r):null,a=r?vg(r):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(n){case Co:l={x:o,y:e.y-i.height};break;case rl:l={x:o,y:e.y+e.height};break;case nl:l={x:e.x+e.width,y:s};break;case Mo:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var c=n?nB(n):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case hg:l[c]=l[c]-(e[u]/2-i[u]/2);break;case Uy:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function Sy(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=r===void 0?t.placement:r,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?WMe:s,c=i.rootBoundary,u=c===void 0?qie:c,d=i.elementContext,p=d===void 0?jv:d,m=i.altBoundary,h=m===void 0?!1:m,f=i.padding,g=f===void 0?0:f,v=Qie(typeof g!="number"?g:ere(g,dU)),I=p===jv?qMe:jv,y=t.rects.popper,b=t.elements[h?I:p],S=DNe(zm(b)?b:b.contextElement||xp(t.elements.popper),l,u,o),w=gg(t.elements.reference),U=ire({reference:w,element:y,strategy:"absolute",placement:n}),T=iN(Object.assign({},y,U)),P=p===jv?T:w,R={top:S.top-P.top+v.top,bottom:P.bottom-S.bottom+v.bottom,left:S.left-P.left+v.left,right:P.right-S.right+v.right},D=t.modifiersData.offset;if(p===jv&&D){var E=D[n];Object.keys(R).forEach(function(N){var A=[nl,rl].indexOf(N)>=0?1:-1,M=[Co,rl].indexOf(N)>=0?"y":"x";R[N]+=E[M]*A})}return R}function PNe(t,e){e===void 0&&(e={});var i=e,r=i.placement,n=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?Yie:l,u=vg(r),d=u?s?mj:mj.filter(function(h){return vg(h)===u}):dU,p=d.filter(function(h){return c.indexOf(h)>=0});p.length===0&&(p=d);var m=p.reduce(function(h,f){return h[f]=Sy(t,{placement:f,boundary:n,rootBoundary:a,padding:o})[mu(f)],h},{});return Object.keys(m).sort(function(h,f){return m[h]-m[f]})}function RNe(t){if(mu(t)===tB)return[];var e=MS(t);return[gj(t),e,gj(e)]}function ENe(t){var e=t.state,i=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,m=i.flipVariations,h=m===void 0?!0:m,f=i.allowedAutoPlacements,g=e.options.placement,v=mu(g),I=v===g,y=l||(I||!h?[MS(g)]:RNe(g)),b=[g].concat(y).reduce(function(B,V){return B.concat(mu(V)===tB?PNe(e,{placement:V,boundary:u,rootBoundary:d,padding:c,flipVariations:h,allowedAutoPlacements:f}):V)},[]),S=e.rects.reference,w=e.rects.popper,U=new Map,T=!0,P=b[0],R=0;R<b.length;R++){var D=b[R],E=mu(D),N=vg(D)===hg,A=[Co,rl].indexOf(E)>=0,M=A?"width":"height",C=Sy(e,{placement:D,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),O=A?N?nl:Mo:N?rl:Co;S[M]>w[M]&&(O=MS(O));var k=MS(O),x=[];if(a&&x.push(C[E]<=0),s&&x.push(C[O]<=0,C[k]<=0),x.every(function(B){return B})){P=D,T=!1;break}U.set(D,x)}if(T)for(var F=h?3:1,$=function(V){var G=b.find(function(j){var H=U.get(j);if(H)return H.slice(0,V).every(function(W){return W})});if(G)return P=G,"break"},_=F;_>0;_--){var L=$(_);if(L==="break")break}e.placement!==P&&(e.modifiersData[r]._skip=!0,e.placement=P,e.reset=!0)}}const CNe={name:"flip",enabled:!0,phase:"main",fn:ENe,requiresIfExists:["offset"],data:{_skip:!1}};function Ij(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function yj(t){return[Co,nl,rl,Mo].some(function(e){return t[e]>=0})}function MNe(t){var e=t.state,i=t.name,r=e.rects.reference,n=e.rects.popper,a=e.modifiersData.preventOverflow,o=Sy(e,{elementContext:"reference"}),s=Sy(e,{altBoundary:!0}),l=Ij(o,r),c=Ij(s,n,a),u=yj(l),d=yj(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const NNe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:MNe};function ANe(t,e,i){var r=mu(t),n=[Mo,Co].indexOf(r)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*n,[Mo,nl].indexOf(r)>=0?{x:s,y:o}:{x:o,y:s}}function ONe(t){var e=t.state,i=t.options,r=t.name,n=i.offset,a=n===void 0?[0,0]:n,o=Yie.reduce(function(u,d){return u[d]=ANe(d,e.rects,a),u},{}),s=o[e.placement],l=s.x,c=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=o}const kNe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:ONe};function xNe(t){var e=t.state,i=t.name;e.modifiersData[i]=ire({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const FNe={name:"popperOffsets",enabled:!0,phase:"read",fn:xNe,data:{}};function LNe(t){return t==="x"?"y":"x"}function _Ne(t){var e=t.state,i=t.options,r=t.name,n=i.mainAxis,a=n===void 0?!0:n,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,m=p===void 0?!0:p,h=i.tetherOffset,f=h===void 0?0:h,g=Sy(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=mu(e.placement),I=vg(e.placement),y=!I,b=nB(v),S=LNe(b),w=e.modifiersData.popperOffsets,U=e.rects.reference,T=e.rects.popper,P=typeof f=="function"?f(Object.assign({},e.rects,{placement:e.placement})):f,R=typeof P=="number"?{mainAxis:P,altAxis:P}:Object.assign({mainAxis:0,altAxis:0},P),D=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,E={x:0,y:0};if(w){if(a){var N,A=b==="y"?Co:Mo,M=b==="y"?rl:nl,C=b==="y"?"height":"width",O=w[b],k=O+g[A],x=O-g[M],F=m?-T[C]/2:0,$=I===hg?U[C]:T[C],_=I===hg?-T[C]:-U[C],L=e.elements.arrow,B=m&&L?rB(L):{width:0,height:0},V=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Zie(),G=V[A],j=V[M],H=dI(0,U[C],B[C]),W=y?U[C]/2-F-H-G-R.mainAxis:$-H-G-R.mainAxis,Y=y?-U[C]/2+F+H+j+R.mainAxis:_+H+j+R.mainAxis,q=e.elements.arrow&&pU(e.elements.arrow),re=q?b==="y"?q.clientTop||0:q.clientLeft||0:0,K=(N=D==null?void 0:D[b])!=null?N:0,z=O+W-K-re,te=O+Y-K,J=dI(m?X0(k,z):k,O,m?bm(x,te):x);w[b]=J,E[b]=J-O}if(s){var ie,ne=b==="x"?Co:Mo,ue=b==="x"?rl:nl,ae=w[S],ce=S==="y"?"height":"width",pe=ae+g[ne],Se=ae-g[ue],Be=[Co,Mo].indexOf(v)!==-1,Pe=(ie=D==null?void 0:D[S])!=null?ie:0,at=Be?pe:ae-U[ce]-T[ce]-Pe+R.altAxis,de=Be?ae+U[ce]+T[ce]-Pe-R.altAxis:Se,Ie=m&&Be?lNe(at,ae,de):dI(m?at:pe,ae,m?de:Se);w[S]=Ie,E[S]=Ie-ae}e.modifiersData[r]=E}}const $Ne={name:"preventOverflow",enabled:!0,phase:"main",fn:_Ne,requiresIfExists:["offset"]};function BNe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function VNe(t){return t===Ts(t)||!js(t)?aB(t):BNe(t)}function jNe(t){var e=t.getBoundingClientRect(),i=fg(e.width)/t.offsetWidth||1,r=fg(e.height)/t.offsetHeight||1;return i!==1||r!==1}function GNe(t,e,i){i===void 0&&(i=!1);var r=js(e),n=js(e)&&jNe(e),a=xp(e),o=gg(t,n,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!i)&&((xu(e)!=="body"||sB(a))&&(s=VNe(e)),js(e)?(l=gg(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=oB(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function HNe(t){var e=new Map,i=new Set,r=[];t.forEach(function(a){e.set(a.name,a)});function n(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&n(l)}}),r.push(a)}return t.forEach(function(a){i.has(a.name)||n(a)}),r}function zNe(t){var e=HNe(t);return rNe.reduce(function(i,r){return i.concat(e.filter(function(n){return n.phase===r}))},[])}function WNe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function qNe(t){var e=t.reduce(function(i,r){var n=i[r.name];return i[r.name]=n?Object.assign({},n,r,{options:Object.assign({},n.options,r.options),data:Object.assign({},n.data,r.data)}):r,i},{});return Object.keys(e).map(function(i){return e[i]})}var bj={placement:"bottom",modifiers:[],strategy:"absolute"};function wj(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(r){return!(r&&typeof r.getBoundingClientRect=="function")})}function YNe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,r=i===void 0?[]:i,n=e.defaultOptions,a=n===void 0?bj:n;return function(s,l,c){c===void 0&&(c=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},bj,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,m={state:u,setOptions:function(v){var I=typeof v=="function"?v(u.options):v;f(),u.options=Object.assign({},a,u.options,I),u.scrollParents={reference:zm(s)?pI(s):s.contextElement?pI(s.contextElement):[],popper:pI(l)};var y=zNe(qNe([].concat(r,u.options.modifiers)));return u.orderedModifiers=y.filter(function(b){return b.enabled}),h(),m.update()},forceUpdate:function(){if(!p){var v=u.elements,I=v.reference,y=v.popper;if(wj(I,y)){u.rects={reference:GNe(I,pU(y),u.options.strategy==="fixed"),popper:rB(y)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(R){return u.modifiersData[R.name]=Object.assign({},R.data)});for(var b=0;b<u.orderedModifiers.length;b++){if(u.reset===!0){u.reset=!1,b=-1;continue}var S=u.orderedModifiers[b],w=S.fn,U=S.options,T=U===void 0?{}:U,P=S.name;typeof w=="function"&&(u=w({state:u,options:T,name:P,instance:m})||u)}}}},update:WNe(function(){return new Promise(function(g){m.forceUpdate(),g(u)})}),destroy:function(){f(),p=!0}};if(!wj(s,l))return m;m.setOptions(c).then(function(g){!p&&c.onFirstUpdate&&c.onFirstUpdate(g)});function h(){u.orderedModifiers.forEach(function(g){var v=g.name,I=g.options,y=I===void 0?{}:I,b=g.effect;if(typeof b=="function"){var S=b({state:u,name:v,instance:m,options:y}),w=function(){};d.push(S||w)}})}function f(){d.forEach(function(g){return g()}),d=[]}return m}}var KNe=[INe,FNe,gNe,Kie,kNe,CNe,$Ne,pNe,NNe],JNe=YNe({defaultModifiers:KNe}),XNe="tippy-box",rre="tippy-content",ZNe="tippy-backdrop",nre="tippy-arrow",are="tippy-svg-arrow",Hp={passive:!0,capture:!0},ore=function(){return document.body};function rC(t,e,i){if(Array.isArray(t)){var r=t[e];return r??(Array.isArray(i)?i[e]:i)}return t}function lB(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function sre(t,e){return typeof t=="function"?t.apply(void 0,e):t}function Uj(t,e){if(e===0)return t;var i;return function(r){clearTimeout(i),i=setTimeout(function(){t(r)},e)}}function QNe(t){return t.split(/\s+/).filter(Boolean)}function rf(t){return[].concat(t)}function Sj(t,e){t.indexOf(e)===-1&&t.push(e)}function eAe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function tAe(t){return t.split("-")[0]}function Z0(t){return[].slice.call(t)}function Tj(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function mI(){return document.createElement("div")}function aE(t){return["Element","Fragment"].some(function(e){return lB(t,e)})}function iAe(t){return lB(t,"NodeList")}function rAe(t){return lB(t,"MouseEvent")}function nAe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function aAe(t){return aE(t)?[t]:iAe(t)?Z0(t):Array.isArray(t)?t:Z0(document.querySelectorAll(t))}function nC(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function Dj(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function oAe(t){var e,i=rf(t),r=i[0];return r!=null&&(e=r.ownerDocument)!=null&&e.body?r.ownerDocument:document}function sAe(t,e){var i=e.clientX,r=e.clientY;return t.every(function(n){var a=n.popperRect,o=n.popperState,s=n.props,l=s.interactiveBorder,c=tAe(o.placement),u=o.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,m=c==="right"?u.left.x:0,h=c==="left"?u.right.x:0,f=a.top-r+d>l,g=r-a.bottom-p>l,v=a.left-i+m>l,I=i-a.right-h>l;return f||g||v||I})}function aC(t,e,i){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(n){t[r](n,i)})}function Pj(t,e){for(var i=e;i;){var r;if(t.contains(i))return!0;i=i.getRootNode==null||(r=i.getRootNode())==null?void 0:r.host}return!1}var eu={isTouch:!1},Rj=0;function lAe(){eu.isTouch||(eu.isTouch=!0,window.performance&&document.addEventListener("mousemove",lre))}function lre(){var t=performance.now();t-Rj<20&&(eu.isTouch=!1,document.removeEventListener("mousemove",lre)),Rj=t}function uAe(){var t=document.activeElement;if(nAe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function cAe(){document.addEventListener("touchstart",lAe,Hp),window.addEventListener("blur",uAe)}var dAe=typeof window<"u"&&typeof document<"u",pAe=dAe?!!window.msCrypto:!1,mAe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},hAe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},gl=Object.assign({appendTo:ore,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},mAe,hAe),fAe=Object.keys(gl),gAe=function(e){var i=Object.keys(e);i.forEach(function(r){gl[r]=e[r]})};function ure(t){var e=t.plugins||[],i=e.reduce(function(r,n){var a=n.name,o=n.defaultValue;if(a){var s;r[a]=t[a]!==void 0?t[a]:(s=gl[a])!=null?s:o}return r},{});return Object.assign({},t,i)}function vAe(t,e){var i=e?Object.keys(ure(Object.assign({},gl,{plugins:e}))):fAe,r=i.reduce(function(n,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return n;if(a==="content")n[a]=o;else try{n[a]=JSON.parse(o)}catch{n[a]=o}return n},{});return r}function Ej(t,e){var i=Object.assign({},e,{content:sre(e.content,[t])},e.ignoreAttributes?{}:vAe(t,e.plugins));return i.aria=Object.assign({},gl.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var IAe=function(){return"innerHTML"};function rN(t,e){t[IAe()]=e}function Cj(t){var e=mI();return t===!0?e.className=nre:(e.className=are,aE(t)?e.appendChild(t):rN(e,t)),e}function Mj(t,e){aE(e.content)?(rN(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?rN(t,e.content):t.textContent=e.content)}function nN(t){var e=t.firstElementChild,i=Z0(e.children);return{box:e,content:i.find(function(r){return r.classList.contains(rre)}),arrow:i.find(function(r){return r.classList.contains(nre)||r.classList.contains(are)}),backdrop:i.find(function(r){return r.classList.contains(ZNe)})}}function cre(t){var e=mI(),i=mI();i.className=XNe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var r=mI();r.className=rre,r.setAttribute("data-state","hidden"),Mj(r,t.props),e.appendChild(i),i.appendChild(r),n(t.props,t.props);function n(a,o){var s=nN(e),l=s.box,c=s.content,u=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&Mj(c,t.props),o.arrow?u?a.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(Cj(o.arrow))):l.appendChild(Cj(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:n}}cre.$$tippy=!0;var yAe=1,WU=[],oC=[];function bAe(t,e){var i=Ej(t,Object.assign({},gl,ure(Tj(e)))),r,n,a,o=!1,s=!1,l=!1,c=!1,u,d,p,m=[],h=Uj(z,i.interactiveDebounce),f,g=yAe++,v=null,I=eAe(i.plugins),y={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},b={id:g,reference:t,popper:mI(),popperInstance:v,props:i,state:y,plugins:I,clearDelayTimeouts:at,setProps:de,setContent:Ie,show:me,hide:Me,hideWithInteractivity:be,enable:Be,disable:Pe,unmount:_e,destroy:Ne};if(!i.render)return b;var S=i.render(b),w=S.popper,U=S.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+b.id,b.popper=w,t._tippy=b,w._tippy=b;var T=I.map(function(se){return se.fn(b)}),P=t.hasAttribute("aria-expanded");return q(),F(),O(),k("onCreate",[b]),i.showOnCreate&&pe(),w.addEventListener("mouseenter",function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&A().addEventListener("mousemove",h)}),b;function R(){var se=b.props.touch;return Array.isArray(se)?se:[se,0]}function D(){return R()[0]==="hold"}function E(){var se;return!!((se=b.props.render)!=null&&se.$$tippy)}function N(){return f||t}function A(){var se=N().parentNode;return se?oAe(se):document}function M(){return nN(w)}function C(se){return b.state.isMounted&&!b.state.isVisible||eu.isTouch||u&&u.type==="focus"?0:rC(b.props.delay,se?0:1,gl.delay)}function O(se){se===void 0&&(se=!1),w.style.pointerEvents=b.props.interactive&&!se?"":"none",w.style.zIndex=""+b.props.zIndex}function k(se,ge,we){if(we===void 0&&(we=!0),T.forEach(function(Le){Le[se]&&Le[se].apply(Le,ge)}),we){var De;(De=b.props)[se].apply(De,ge)}}function x(){var se=b.props.aria;if(se.content){var ge="aria-"+se.content,we=w.id,De=rf(b.props.triggerTarget||t);De.forEach(function(Le){var ye=Le.getAttribute(ge);if(b.state.isVisible)Le.setAttribute(ge,ye?ye+" "+we:we);else{var Te=ye&&ye.replace(we,"").trim();Te?Le.setAttribute(ge,Te):Le.removeAttribute(ge)}})}}function F(){if(!(P||!b.props.aria.expanded)){var se=rf(b.props.triggerTarget||t);se.forEach(function(ge){b.props.interactive?ge.setAttribute("aria-expanded",b.state.isVisible&&ge===N()?"true":"false"):ge.removeAttribute("aria-expanded")})}}function $(){A().removeEventListener("mousemove",h),WU=WU.filter(function(se){return se!==h})}function _(se){if(!(eu.isTouch&&(l||se.type==="mousedown"))){var ge=se.composedPath&&se.composedPath()[0]||se.target;if(!(b.props.interactive&&Pj(w,ge))){if(rf(b.props.triggerTarget||t).some(function(we){return Pj(we,ge)})){if(eu.isTouch||b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else k("onClickOutside",[b,se]);b.props.hideOnClick===!0&&(b.clearDelayTimeouts(),b.hide(),s=!0,setTimeout(function(){s=!1}),b.state.isMounted||G())}}}function L(){l=!0}function B(){l=!1}function V(){var se=A();se.addEventListener("mousedown",_,!0),se.addEventListener("touchend",_,Hp),se.addEventListener("touchstart",B,Hp),se.addEventListener("touchmove",L,Hp)}function G(){var se=A();se.removeEventListener("mousedown",_,!0),se.removeEventListener("touchend",_,Hp),se.removeEventListener("touchstart",B,Hp),se.removeEventListener("touchmove",L,Hp)}function j(se,ge){W(se,function(){!b.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&ge()})}function H(se,ge){W(se,ge)}function W(se,ge){var we=M().box;function De(Le){Le.target===we&&(aC(we,"remove",De),ge())}if(se===0)return ge();aC(we,"remove",d),aC(we,"add",De),d=De}function Y(se,ge,we){we===void 0&&(we=!1);var De=rf(b.props.triggerTarget||t);De.forEach(function(Le){Le.addEventListener(se,ge,we),m.push({node:Le,eventType:se,handler:ge,options:we})})}function q(){D()&&(Y("touchstart",K,{passive:!0}),Y("touchend",te,{passive:!0})),QNe(b.props.trigger).forEach(function(se){if(se!=="manual")switch(Y(se,K),se){case"mouseenter":Y("mouseleave",te);break;case"focus":Y(pAe?"focusout":"blur",J);break;case"focusin":Y("focusout",J);break}})}function re(){m.forEach(function(se){var ge=se.node,we=se.eventType,De=se.handler,Le=se.options;ge.removeEventListener(we,De,Le)}),m=[]}function K(se){var ge,we=!1;if(!(!b.state.isEnabled||ie(se)||s)){var De=((ge=u)==null?void 0:ge.type)==="focus";u=se,f=se.currentTarget,F(),!b.state.isVisible&&rAe(se)&&WU.forEach(function(Le){return Le(se)}),se.type==="click"&&(b.props.trigger.indexOf("mouseenter")<0||o)&&b.props.hideOnClick!==!1&&b.state.isVisible?we=!0:pe(se),se.type==="click"&&(o=!we),we&&!De&&Se(se)}}function z(se){var ge=se.target,we=N().contains(ge)||w.contains(ge);if(!(se.type==="mousemove"&&we)){var De=ce().concat(w).map(function(Le){var ye,Te=Le._tippy,Ze=(ye=Te.popperInstance)==null?void 0:ye.state;return Ze?{popperRect:Le.getBoundingClientRect(),popperState:Ze,props:i}:null}).filter(Boolean);sAe(De,se)&&($(),Se(se))}}function te(se){var ge=ie(se)||b.props.trigger.indexOf("click")>=0&&o;if(!ge){if(b.props.interactive){b.hideWithInteractivity(se);return}Se(se)}}function J(se){b.props.trigger.indexOf("focusin")<0&&se.target!==N()||b.props.interactive&&se.relatedTarget&&w.contains(se.relatedTarget)||Se(se)}function ie(se){return eu.isTouch?D()!==se.type.indexOf("touch")>=0:!1}function ne(){ue();var se=b.props,ge=se.popperOptions,we=se.placement,De=se.offset,Le=se.getReferenceClientRect,ye=se.moveTransition,Te=E()?nN(w).arrow:null,Ze=Le?{getBoundingClientRect:Le,contextElement:Le.contextElement||N()}:t,je={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(Xi){var Ke=Xi.state;if(E()){var At=M(),Ei=At.box;["placement","reference-hidden","escaped"].forEach(function(dr){dr==="placement"?Ei.setAttribute("data-placement",Ke.placement):Ke.attributes.popper["data-popper-"+dr]?Ei.setAttribute("data-"+dr,""):Ei.removeAttribute("data-"+dr)}),Ke.attributes.popper={}}}},ve=[{name:"offset",options:{offset:De}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ye}},je];E()&&Te&&ve.push({name:"arrow",options:{element:Te,padding:3}}),ve.push.apply(ve,(ge==null?void 0:ge.modifiers)||[]),b.popperInstance=JNe(Ze,w,Object.assign({},ge,{placement:we,onFirstUpdate:p,modifiers:ve}))}function ue(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function ae(){var se=b.props.appendTo,ge,we=N();b.props.interactive&&se===ore||se==="parent"?ge=we.parentNode:ge=sre(se,[we]),ge.contains(w)||ge.appendChild(w),b.state.isMounted=!0,ne()}function ce(){return Z0(w.querySelectorAll("[data-tippy-root]"))}function pe(se){b.clearDelayTimeouts(),se&&k("onTrigger",[b,se]),V();var ge=C(!0),we=R(),De=we[0],Le=we[1];eu.isTouch&&De==="hold"&&Le&&(ge=Le),ge?r=setTimeout(function(){b.show()},ge):b.show()}function Se(se){if(b.clearDelayTimeouts(),k("onUntrigger",[b,se]),!b.state.isVisible){G();return}if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(se.type)>=0&&o)){var ge=C(!1);ge?n=setTimeout(function(){b.state.isVisible&&b.hide()},ge):a=requestAnimationFrame(function(){b.hide()})}}function Be(){b.state.isEnabled=!0}function Pe(){b.hide(),b.state.isEnabled=!1}function at(){clearTimeout(r),clearTimeout(n),cancelAnimationFrame(a)}function de(se){if(!b.state.isDestroyed){k("onBeforeUpdate",[b,se]),re();var ge=b.props,we=Ej(t,Object.assign({},ge,Tj(se),{ignoreAttributes:!0}));b.props=we,q(),ge.interactiveDebounce!==we.interactiveDebounce&&($(),h=Uj(z,we.interactiveDebounce)),ge.triggerTarget&&!we.triggerTarget?rf(ge.triggerTarget).forEach(function(De){De.removeAttribute("aria-expanded")}):we.triggerTarget&&t.removeAttribute("aria-expanded"),F(),O(),U&&U(ge,we),b.popperInstance&&(ne(),ce().forEach(function(De){requestAnimationFrame(De._tippy.popperInstance.forceUpdate)})),k("onAfterUpdate",[b,se])}}function Ie(se){b.setProps({content:se})}function me(){var se=b.state.isVisible,ge=b.state.isDestroyed,we=!b.state.isEnabled,De=eu.isTouch&&!b.props.touch,Le=rC(b.props.duration,0,gl.duration);if(!(se||ge||we||De)&&!N().hasAttribute("disabled")&&(k("onShow",[b],!1),b.props.onShow(b)!==!1)){if(b.state.isVisible=!0,E()&&(w.style.visibility="visible"),O(),V(),b.state.isMounted||(w.style.transition="none"),E()){var ye=M(),Te=ye.box,Ze=ye.content;nC([Te,Ze],0)}p=function(){var ve;if(!(!b.state.isVisible||c)){if(c=!0,w.offsetHeight,w.style.transition=b.props.moveTransition,E()&&b.props.animation){var qt=M(),Xi=qt.box,Ke=qt.content;nC([Xi,Ke],Le),Dj([Xi,Ke],"visible")}x(),F(),Sj(oC,b),(ve=b.popperInstance)==null||ve.forceUpdate(),k("onMount",[b]),b.props.animation&&E()&&H(Le,function(){b.state.isShown=!0,k("onShown",[b])})}},ae()}}function Me(){var se=!b.state.isVisible,ge=b.state.isDestroyed,we=!b.state.isEnabled,De=rC(b.props.duration,1,gl.duration);if(!(se||ge||we)&&(k("onHide",[b],!1),b.props.onHide(b)!==!1)){if(b.state.isVisible=!1,b.state.isShown=!1,c=!1,o=!1,E()&&(w.style.visibility="hidden"),$(),G(),O(!0),E()){var Le=M(),ye=Le.box,Te=Le.content;b.props.animation&&(nC([ye,Te],De),Dj([ye,Te],"hidden"))}x(),F(),b.props.animation?E()&&j(De,b.unmount):b.unmount()}}function be(se){A().addEventListener("mousemove",h),Sj(WU,h),h(se)}function _e(){b.state.isVisible&&b.hide(),b.state.isMounted&&(ue(),ce().forEach(function(se){se._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),oC=oC.filter(function(se){return se!==b}),b.state.isMounted=!1,k("onHidden",[b]))}function Ne(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),re(),delete t._tippy,b.state.isDestroyed=!0,k("onDestroy",[b]))}}function mU(t,e){e===void 0&&(e={});var i=gl.plugins.concat(e.plugins||[]);cAe();var r=Object.assign({},e,{plugins:i}),n=aAe(t),a=n.reduce(function(o,s){var l=s&&bAe(s,r);return l&&o.push(l),o},[]);return aE(t)?a[0]:a}mU.defaultProps=gl;mU.setDefaultProps=gAe;mU.currentInput=eu;Object.assign({},Kie,{effect:function(e){var i=e.state,r={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,r.popper),i.styles=r,i.elements.arrow&&Object.assign(i.elements.arrow.style,r.arrow)}});mU.setDefaultProps({render:cre});function Nj(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Nm?e.style.marginLeft="1em":e.style.marginRight="1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&mU(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=As),e}const wAe=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":p1;const i=(r,n,a)=>{const o=t.getElementsByClassName(`options_${r}`)[0];o&&(o.style.display=e!=null&&e.length?n:a)};i(d1,FU,As),i(qd,As,FU),i(Oi,As,FU),i(Nm,As,FU)};function UAe(t){var v;const{table:e,targetClassName:i,items:r=[],onSelection:n}=t,a=!!t.target,o=t.target||i&&((v=document.getElementsByClassName(i))==null?void 0:v[0]);if(!o)return{};let s=0,l=0;const c={},u={};let d;if(a){Jp(o);const I=SAe();Object.assign(c,I.elements),o.appendChild(I.anchor)}const p=Object.assign({},...[d1,qd,Oi,Nm,b2].map(I=>{var b;const y=(b=o.getElementsByClassName(`options_${I}`))==null?void 0:b[0];return Jp(y),{[I]:y}}).filter(Boolean)),m=wAe({target:o}),h=(I,y)=>{nu(y.onClick)&&(I.stopPropagation(),!y.disabled&&y.onClick(I,e),y.stateChange&&m())},f={onClick:()=>{},location:Nm};for(const I of r){const y={...f};m1(I)&&Object.assign(y,I);const b=p[y.location];if(!b){console.log(y.location,p);continue}if(y.location===d1&&(s+=1),y.location===b2){if(nu(y.headerClick)){const S=o.getElementsByClassName("panelHeader")[0];S&&(S.onclick=y.headerClick)}l+=1}if(!y.hide&&(y.input||y.placeholder||y.search)){const S=document.createElement("p");S.style.marginRight="1em",S.className=`control ${y.search?"has-icons-left has-icons-right":""}`;const w=document.createElement("input");if(y.focus&&(d=w),w.className="input font-medium",w.setAttribute("type","text"),w.setAttribute("autocomplete","cc-number"),w.setAttribute("placeholder",I.placeholder||p1),y.id&&(u[y.id]=w),y.id&&w.setAttribute("id",y.id),y.onKeyDown&&w.addEventListener("keydown",U=>y.onKeyDown(U,y)),y.onChange&&w.addEventListener("change",U=>y.onChange(U,y)),y.onKeyUp&&w.addEventListener("keyup",U=>{y.clearSearch&&U.key==="Escape"&&(U.stopPropagation(),w.value="",y.clearSearch()),y.onKeyUp(U,y)}),y.class&&w.classList.add(y.class),y.visible===!1&&(S.style.display=As),y.value&&(w.value=y.value),S.appendChild(w),y.search){const U=document.createElement("span");if(U.className="icon is-small is-left font-medium",U.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',S.appendChild(U),nu(y.clearSearch)){const T=document.createElement("span");T.className="icon is-small is-right font-medium",T.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',T.onclick=P=>{P.stopPropagation(),w.value="",y.clearSearch()},S.appendChild(T)}}if(I.validator){const U=document.createElement("p");U.className="help font-medium",S.appendChild(U),w.addEventListener("input",T=>zMe(I,T,w,U,I.validator))}y.id&&(c[y.id]=S,S.id=y.id),b==null||b.appendChild(S);continue}if(!y.hide&&y.text){const S=document.createElement("div");S.className="font-medium",y.id&&(c[y.id]=S,S.id=y.id),S.innerHTML=y.text,S.onclick=w=>h(w,y),b==null||b.appendChild(S);continue}if(!(!y.id&&(!(y!=null&&y.label)||y.hide))){if(y.options){const S=sm({target:b,button:y,stateChange:m});y.visible===!1&&(S.style.display=As),y.id&&(c[y.id]=S)}else if(m1(y.selection)){const{selection:{options:S,actions:w},actionPlacement:U,threshold:T=8,...P}=y;if((S==null?void 0:S.length)<T){S.length&&(U===w2?S.unshift({divider:!0}):S.push({divider:!0})),w.forEach(E=>{const{label:N,...A}=E,M={...A,label:`<p style="font-weight: bold">${N}</p>`};U===w2?S.unshift(M):S.push(M)});const R={...P,options:S},D=sm({target:b,button:R,stateChange:m});R.visible===!1&&(D.style.display=As),R.id&&(c[y.id]=D)}else{const R=Nj(y);R.onclick=D=>{D.stopPropagation()},y.id&&(c[y.id]=R),b==null||b.appendChild(R)}}else{const S=Nj(y);S.onclick=w=>h(w,y),y.id&&(c[y.id]=S),b==null||b.appendChild(S)}(!(y!=null&&y.label)||y.hide)&&(c[y.id].style.display=As)}}const g=o.getElementsByClassName("panelHeader")[0];return g&&(g.style.display=l?p1:As),e==null||e.on("rowSelectionChanged",(I,y)=>{nu(n)&&n(y),s&&m(y)}),m(),d&&setTimeout(()=>d.focus(),200),{elements:c,inputs:u}}function SAe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=As,t.appendChild(e);const i=document.createElement("div");i.className=tfe,i.style.flexWrap="wrap-reverse;";const r={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};r.optionsOverlay.className="options_overlay",r.optionsCenter.className="options_center",r.optionsRight.className="options_right",r.optionsLeft.className="options_left";for(const n of Object.values(r))i.appendChild(n);return t.appendChild(i),{elements:r,anchor:t,header:e}}function TAe(t){const e=mye(t),i=[{onKeyDown:n=>n.keyCode===8&&n.target.value.length===1&&e(""),onChange:n=>e(n.target.value),onKeyUp:n=>e(n.target.value),clearSearch:()=>e(""),placeholder:"Search tournaments",location:qd,search:!0}],r=document.getElementById($j);UAe({target:r,items:i})}function DAe(t){var c,u;const e=document.createElement("span"),i=document.createElement("table"),r=t.getValue();i.style.width="400px";const n="4em",a=document.createElement("tr"),o=r.tournamentImageURL||((u=(c=r.onlineResources)==null?void 0:c.find(({name:d,resourceType:p})=>d==="tournamentImage"&&p==="URL"))==null?void 0:u.identifier),s=o?`<img src='${o}' style='width: ${n}' alt=''>`:"",l=`<td style='min-width: ${n}'>${s}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${r.tournamentName}</strong></div><div style='margin-left: 1em'>${r.startDate} / ${r.endDate}</div></td>`;return a.innerHTML=l,i.appendChild(a),e.appendChild(i),e}function PAe(){return[{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Oi,minWidth:50,width:50},{formatter:DAe,cellClick:(e,i)=>{const r=i.getRow().getData().tournamentId;if(r){const n=`/${iT}/${r}`;Am.router.navigate(n)}},field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3}]}function RAe({providerAbbr:t}){const e=s=>console.log("Network error",{error:s});let i;const r=({providerAbbr:s})=>{setTimeout(()=>{const c=u=>{var d;return((d=u==null?void 0:u.data)==null?void 0:d.calendar)&&i.replaceData(u.data.calendar)};W1({providerAbbr:s}).then(c,e)},1e3)},n=PAe(),a=s=>{aP({anchorId:uC});const l=document.getElementById(uC);i=new jb(l,{responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.9,placeholder:"No tournaments",responsiveLayout:"collapse",index:"tournament.tournamentId",headerVisible:!1,layout:"fitColumns",reactiveData:!0,data:s,columns:n}),i.on("tableBuilt",()=>{TAe(i)})},o=s=>{s.tournaments.sort((l,c)=>new Date(c.tournament.startDate).getTime()-new Date(l.tournament.startDate).getTime()),a(s.tournaments)};if(t){const s=l=>{var c;(c=l==null?void 0:l.data)!=null&&c.calendar&&o(l.data.calendar)};W1({providerAbbr:t}).then(s,e)}return{table:i,replaceTableData:r}}function EAe({startDate:t,endDate:e}){const i=new Date(t),r=new Date(e),n=["January","February","March","April","May","June","July","August","September","October","November","December"],a=i.getDate()===r.getDate(),o=i.getFullYear()===r.getFullYear(),s=o&&i.getMonth()===r.getMonth(),l=c=>[c.getFullYear(),c.getMonth()+1,c.getDate()].join("/");return a&&o&&s?`${n[i.getMonth()]} ${i.getDate()}, ${i.getFullYear()}`:o&&s?`${n[i.getMonth()]} ${i.getDate()}-${r.getDate()}, ${i.getFullYear()}`:o?`${n[i.getMonth()]} ${i.getDate()} - ${n[r.getMonth()]} ${r.getDate()}, ${i.getFullYear()}`:`${l(i)} - ${l(r)}`}async function CAe(t){var o,s,l,c,u;const e=document.getElementById(yre);Jp(e);const i=((o=t==null?void 0:t.data)==null?void 0:o.tournamentInfo)??{},r=(s=i.onlineResources)==null?void 0:s.find(d=>d.name==="tournamentImage"),n=document.getElementById(Bj);if(r!=null&&r.identifier?n.innerHTML=`<img src="${r.identifier}" alt="${i.name}" style="max-height: 20em" />`:Jp(n),i.tournamentName){const d=document.getElementById(_j),p=`<h1>${i.tournamentName}</h1>`,m=`<h2>${EAe(i)}</h2>`;d.innerHTML=`${p}${m}`}const a=document.getElementById(iI("Info"));if(i.notes?(a.innerHTML=i.notes,Y1("Info"),OE("Info")):(Jp(a),kE("Info")),(l=i.eventInfo)!=null&&l.length){const d=i.tournamentId,p=document.getElementById(iI("Events"));Jp(p);const m=document.createElement("div"),h=document.createElement("div");h.id="flightDisplay";const f=i.eventInfo.map(({eventId:b,eventName:S})=>({onClick:()=>pj({tournamentId:d,eventId:b,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),label:S,close:!0})),g={label:i.eventInfo[0].eventName,options:f,id:"eventButton",modifyLabel:!0,selection:!0,location:qd},I=sm({button:g,stateChange:()=>{var b,S;(b=document.getElementById("structureButton"))==null||b.remove(),(S=document.getElementById("flightButton"))==null||S.remove()}}),y=i.eventInfo[0].eventId;m.className="block",m.appendChild(I),p.appendChild(m),p.appendChild(h),pj({tournamentId:d,eventId:y,header:m,flightDisplay:h,displayFormat:"roundsColumns"}),OE("Events"),Am.tab||Y1("Events")}else kE("Events");if((u=(c=i.publishState)==null?void 0:c.orderOfPlay)!=null&&u.published){const d=document.getElementById(iI("Schedule")),p=document.createElement("div");p.style.width="100%",p.className="block",p.id="scheduleHeader",d.appendChild(p);const m=document.createElement("div");m.id="tournamentSchedule",d.appendChild(m),OE("Schedule")}else kE("Schedule")}const MAe=""+new URL("courthive-transparent-logo-ScJ-jfxv.png",import.meta.url).href;function NAe(){document.querySelector(`#${Ty}`).innerHTML=`
  <div>
    <a href="https://courthive.com" target="_blank">
      <img src="${MAe}" class="logo" alt="Vite logo" />
    </a>
    <h1 class="name">CourtHive</h1>
  </div>
`}var AAe=/([:*])(\w+)/g,OAe="([^/]+)",kAe=/\*/g,xAe="?(?:.*)",FAe=/\/\?/g,LAe="/?([^/]+|)",_Ae="(?:/^|^)",$Ae="";function dre(t){return t===void 0&&(t="/"),cB()?location.pathname+location.search+location.hash:t}function $r(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function Q0(t){return typeof t=="string"}function BAe(t){return typeof t=="function"}function eT(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function VAe(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,r,n){return i===null&&(i={}),i[e[n]]=decodeURIComponent(r),i},null)}function tT(t){var e=$r(t).split(/\?(.*)?$/);return[$r(e[0]),e.slice(1).join("")]}function uB(t){for(var e={},i=t.split("&"),r=0;r<i.length;r++){var n=i[r].split("=");if(n[0]!==""){var a=decodeURIComponent(n[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(n[1]||""))):e[a]=decodeURIComponent(n[1]||"")}}return e}function pre(t,e){var i=tT($r(t.currentLocationPath)),r=i[0],n=i[1],a=n===""?null:uB(n),o=[],s;if(Q0(e.path)){if(s=_Ae+$r(e.path).replace(AAe,function(d,p,m){return o.push(m),OAe}).replace(kAe,xAe).replace(FAe,LAe)+"$",$r(e.path)===""&&$r(r)==="")return{url:r,queryString:n,hashString:eT(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,$Ae),c=r.match(l);if(c){var u=Q0(e.path)?VAe(c,o):c.groups?c.groups:c.slice(1);return{url:$r(r.replace(new RegExp("^"+t.instance.root),"")),queryString:n,hashString:eT(t.to),route:e,data:u,params:a}}return!1}function mre(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Hh(t,e){return typeof t[e]>"u"||t[e]===!0}function jAe(t){if(!t)return{};var e=t.split(","),i={},r;return e.forEach(function(n){var a=n.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":r||(r={}),r.strategy=a[1];break;case"resolveOptionsHash":r||(r={}),r.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),r&&(i.resolveOptions=r),i}function cB(){return typeof window<"u"}function GAe(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(r){i[r]&&(e[r]||(e[r]=[]),e[r].push(i[r]))})}),e}function lu(t,e,i){var r=e||{},n=0;(function a(){if(!t[n]){i&&i(r);return}Array.isArray(t[n])?(t.splice.apply(t,[n,1].concat(t[n][0](r)?t[n][1]:t[n][2])),a()):t[n](r,function(o){typeof o>"u"||o===!0?(n+=1,a()):i&&i(r)})})()}lu.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function Aj(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=dre(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function sC(t,e){for(var i=0;i<t.instance.routes.length;i++){var r=t.instance.routes[i],n=pre(t,r);if(n&&(t.matches||(t.matches=[]),t.matches.push(n),t.resolveOptions.strategy==="ONE")){e();return}}e()}function HAe(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function zAe(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var Oj=cB(),WAe=mre();function qAe(t,e){if(Hh(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),r=Oj&&t.resolveOptions&&t.resolveOptions.hash===!0;WAe?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",r?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!r){var n=location.hash;location.hash="",location.hash=n}t.instance.__freezeListening=!1},1))):Oj&&(window.location.href=t.to)}e()}function hre(t,e){var i=t.instance;if(!i.lastResolved()){e();return}lu(i.lastResolved().map(function(r){return function(n,a){if(!r.route.hooks||!r.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(r.route.path,t.currentLocationPath,!1);if(r.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(c){return r.route.path===c.route.path}):!1;o=!l}if(Hh(t.navigateOptions,"callHooks")&&o){lu(r.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function YAe(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Hh(t.navigateOptions,"callHooks")?lu(t.match.route.hooks.before.map(function(i){return function(n,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function KAe(t,e){Hh(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function JAe(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Hh(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function XAe(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(r){r.route.hooks&&r.route.hooks.already&&Hh(t.navigateOptions,"callHooks")&&r.route.hooks.already.forEach(function(n){return n(t.match)})}),e(!1);return}e()}function ZAe(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var r=tT(t.currentLocationPath),n=r[0],a=r[1],o=eT(t.to);i.path=$r(n);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?uB(a):null};t.matches=[s],t.match=s}e()}function QAe(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function eOe(t,e){t.instance._setCurrent(null),e()}function fre(t,e){Hh(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var gre=[XAe,YAe,KAe,JAe],kj=[hre,ZAe,lu.if(function(t){var e=t.notFoundHandled;return e},gre.concat([fre]),[QAe,eOe])];function aN(){return aN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},aN.apply(this,arguments)}function xj(t,e){var i=0;function r(){if(i===t.matches.length){fre(t,e);return}lu(gre,aN({},t,{match:t.matches[i]}),function(){i+=1,r()})}hre(t,r)}function lC(t){t.instance.__markAsClean(t)}function oN(){return oN=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t},oN.apply(this,arguments)}var Fj="[data-navigo]";function tOe(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:Fj},r=this,n="/",a=null,o=[],s=!1,l,c=mre(),u=cB();t?n=$r(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(F){return F.indexOf("#")>=0&&(i.hash===!0?F=F.split("#")[1]||"/":F=F.split("#")[0]),F}function p(F){return $r(n+"/"+$r(F))}function m(F,$,_,L){return F=Q0(F)?p(F):F,{name:L||$r(String(F)),path:F,handler:$,hooks:GAe(_)}}function h(F,$,_){var L=this;return typeof F=="object"&&!(F instanceof RegExp)?(Object.keys(F).forEach(function(B){if(typeof F[B]=="function")L.on(B,F[B]);else{var V=F[B],G=V.uses,j=V.as,H=V.hooks;o.push(m(B,G,[l,H],j))}}),this):(typeof F=="function"&&(_=$,$=F,F=n),o.push(m(F,$,[l,_])),this)}function f(F,$){if(r.__dirty){r.__waiting.push(function(){return r.resolve(F,$)});return}else r.__dirty=!0;F=F?$r(n)+"/"+$r(F):void 0;var _={instance:r,to:F,currentLocationPath:F,navigateOptions:{},resolveOptions:oN({},i,$)};return lu([Aj,sC,lu.if(function(L){var B=L.matches;return B&&B.length>0},xj,kj)],_,lC),_.matches?_.matches:!1}function g(F,$){if(r.__dirty){r.__waiting.push(function(){return r.navigate(F,$)});return}else r.__dirty=!0;F=$r(n)+"/"+$r(F);var _={instance:r,to:F,navigateOptions:$||{},resolveOptions:$&&$.resolveOptions?$.resolveOptions:i,currentLocationPath:d(F)};lu([HAe,zAe,sC,lu.if(function(L){var B=L.matches;return B&&B.length>0},xj,kj),qAe,lC],_,lC)}function v(F,$,_){var L=D(F,$);return L!==null?(g(L.replace(new RegExp("^/?"+n),""),_),!0):!1}function I(F){return this.routes=o=o.filter(function($){return Q0(F)?$r($.path)!==$r(F):BAe(F)?F!==$.handler:String($.path)!==String(F)}),this}function y(){c&&(this.__popstateListener=function(){r.__freezeListening||f()},window.addEventListener("popstate",this.__popstateListener))}function b(){this.routes=o=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function S(F,$){return r._notFoundRoute=m("*",F,[l,$],"__NOT_FOUND__"),this}function w(){if(u)return U().forEach(function(F){if(F.getAttribute("data-navigo")==="false"||F.getAttribute("target")==="_blank"){F.hasListenerAttached&&F.removeEventListener("click",F.navigoHandler);return}F.hasListenerAttached||(F.hasListenerAttached=!0,F.navigoHandler=function($){if(($.ctrlKey||$.metaKey)&&$.target.tagName.toLowerCase()==="a")return!1;var _=F.getAttribute("href");if(typeof _>"u"||_===null)return!1;if(_.match(/^(http|https)/)&&typeof URL<"u")try{var L=new URL(_);_=L.pathname+L.search}catch{}var B=jAe(F.getAttribute("data-navigo-options"));s||($.preventDefault(),$.stopPropagation(),r.navigate($r(_),B))},F.addEventListener("click",F.navigoHandler))}),r}function U(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||Fj)):[]}function T(F){return"/"+n+"/"+$r(F)}function P(F){return l=F,this}function R(){return a}function D(F,$,_){var L=o.find(function(G){return G.name===F}),B=null;if(L){if(B=L.path,$)for(var V in $)B=B.replace(":"+V,$[V]);B=B.match(/^\//)?B:"/"+B}return B&&_&&!_.includeRoot&&(B=B.replace(new RegExp("^/"+n),"")),B}function E(F){return F.getAttribute("href")}function N(F){var $=tT($r(F)),_=$[0],L=$[1],B=L===""?null:uB(L),V=eT(F),G=m(_,function(){},[l],_);return{url:_,queryString:L,hashString:V,route:G,data:null,params:B}}function A(){return N($r(dre(n)).replace(new RegExp("^"+n),""))}function M(F){var $={instance:r,currentLocationPath:F,to:F,navigateOptions:{},resolveOptions:i};return sC($,function(){}),$.matches?$.matches:!1}function C(F,$,_){typeof $<"u"&&(typeof _>"u"||_)&&($=p($));var L={instance:r,to:$,currentLocationPath:$};Aj(L,function(){}),typeof F=="string"&&(F=typeof _>"u"||_?p(F):F);var B=pre(L,{name:String(F),path:F,handler:function(){},hooks:{}});return B||!1}function O(F,$,_){return typeof $=="string"&&($=k($)),$?($.hooks[F]||($.hooks[F]=[]),$.hooks[F].push(_),function(){$.hooks[F]=$.hooks[F].filter(function(L){return L!==_})}):(console.warn("Route doesn't exists: "+$),function(){})}function k(F){return typeof F=="string"?o.find(function($){return $.name===p(F)}):o.find(function($){return $.handler===F})}function x(F){F.instance.__dirty=!1,F.instance.__waiting.length>0&&F.instance.__waiting.shift()()}this.root=n,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=x,this.on=h,this.off=I,this.resolve=f,this.navigate=g,this.navigateByName=v,this.destroy=b,this.notFound=S,this.updatePageLinks=w,this.link=T,this.hooks=P,this.extractGETParameters=function(F){return tT(d(F))},this.lastResolved=R,this.generate=D,this.getLinkPath=E,this.match=M,this.matchLocation=C,this.getCurrentLocation=A,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=k,this._pathToMatchObject=N,this._clean=$r,this._checkForAHash=d,this._setCurrent=function(F){return a=r.current=F},y.call(this),w.call(this)}var iOe={};function rOe(){window.location.host.startsWith("localhost")||iOe.PUBLIC_URL;const t=document.getElementById("back"),e=!0,i=new tOe("/",{hash:e});return i.on("/",()=>{t.style.display="none",pS(Ty),NAe()}),i.on("/tournaments/:providerAbbr",({data:r})=>{t.style.display="none";const n=r.providerAbbr.toUpperCase();pS(sN),RAe({providerAbbr:n})}),i.on("/tournament/:tournamentId",({data:r})=>{t.style.display="block";const n=r.tournamentId;Am.tournamentId=n,pS(iT),A7({tournamentId:n}).then(CAe)}),i.notFound(()=>{i.navigate("/")}),i.resolve(),i}const nOe=document.body;nOe.appendChild(JIe());pye();Am.router=rOe();
//# sourceMappingURL=index-gKA0lVy4.js.map
